var ey=Object.defineProperty;var ty=(i,e,s)=>e in i?ey(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var Lo=(i,e,s)=>(ty(i,typeof e!="symbol"?e+"":e,s),s);function _mergeNamespaces(i,e){for(var s=0;s<e.length;s++){const o=e[s];if(typeof o!="string"&&!Array.isArray(o)){for(const a in o)if(a!=="default"&&!(a in i)){const d=Object.getOwnPropertyDescriptor(o,a);d&&Object.defineProperty(i,a,d.get?d:{enumerable:!0,get:()=>o[a]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function s(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(a){if(a.ep)return;a.ep=!0;const d=s(a);fetch(a.href,d)}})();const nouislider_min="",microtip="",all="",ContextMenu$1="",charts="",wgl2di="",slickgrid="";var global$1=typeof window<"u"?window:null,ssr=global$1===null,document$1=ssr?void 0:global$1.document,addEventListener="addEventListener",removeEventListener="removeEventListener",getBoundingClientRect="getBoundingClientRect",gutterStartDragging="_a",aGutterSize="_b",bGutterSize="_c",HORIZONTAL="horizontal",NOOP$2=function(){return!1},calc=ssr?"calc":["","-webkit-","-moz-","-o-"].filter(function(i){var e=document$1.createElement("div");return e.style.cssText="width:"+i+"calc(9px)",!!e.style.length}).shift()+"calc",isString=function(i){return typeof i=="string"||i instanceof String},elementOrSelector=function(i){if(isString(i)){var e=document$1.querySelector(i);if(!e)throw new Error("Selector "+i+" did not match a DOM element");return e}return i},getOption=function(i,e,s){var o=i[e];return o!==void 0?o:s},getGutterSize=function(i,e,s,o){if(e){if(o==="end")return 0;if(o==="center")return i/2}else if(s){if(o==="start")return 0;if(o==="center")return i/2}return i},defaultGutterFn=function(i,e){var s=document$1.createElement("div");return s.className="gutter gutter-"+e,s},defaultElementStyleFn=function(i,e,s){var o={};return isString(e)?o[i]=e:o[i]=calc+"("+e+"% - "+s+"px)",o},defaultGutterStyleFn=function(i,e){var s;return s={},s[i]=e+"px",s},Split=function(i,e){if(e===void 0&&(e={}),ssr)return{};var s=i,o,a,d,g,_,j;Array.from&&(s=Array.from(s));var _e=elementOrSelector(s[0]),et=_e.parentNode,tt=getComputedStyle?getComputedStyle(et):null,rt=tt?tt.flexDirection:null,it=getOption(e,"sizes")||s.map(function(){return 100/s.length}),ot=getOption(e,"minSize",100),ct=Array.isArray(ot)?ot:s.map(function(){return ot}),ft=getOption(e,"maxSize",1/0),dt=Array.isArray(ft)?ft:s.map(function(){return ft}),pt=getOption(e,"expandToMin",!1),gt=getOption(e,"gutterSize",10),Ct=getOption(e,"gutterAlign","center"),xt=getOption(e,"snapOffset",30),at=Array.isArray(xt)?xt:s.map(function(){return xt}),Bt=getOption(e,"dragInterval",1),Ht=getOption(e,"direction",HORIZONTAL),sr=getOption(e,"cursor",Ht===HORIZONTAL?"col-resize":"row-resize"),mr=getOption(e,"gutter",defaultGutterFn),hr=getOption(e,"elementStyle",defaultElementStyleFn),Er=getOption(e,"gutterStyle",defaultGutterStyleFn);Ht===HORIZONTAL?(o="width",a="clientX",d="left",g="right",_="clientWidth"):Ht==="vertical"&&(o="height",a="clientY",d="top",g="bottom",_="clientHeight");function Lr(dn,xr,Yr,Rn){var Ln=hr(o,xr,Yr,Rn);Object.keys(Ln).forEach(function(pr){dn.style[pr]=Ln[pr]})}function sn(dn,xr,Yr){var Rn=Er(o,xr,Yr);Object.keys(Rn).forEach(function(Ln){dn.style[Ln]=Rn[Ln]})}function vr(){return j.map(function(dn){return dn.size})}function Zr(dn){return"touches"in dn?dn.touches[0][a]:dn[a]}function Hr(dn){var xr=j[this.a],Yr=j[this.b],Rn=xr.size+Yr.size;xr.size=dn/this.size*Rn,Yr.size=Rn-dn/this.size*Rn,Lr(xr.element,xr.size,this[aGutterSize],xr.i),Lr(Yr.element,Yr.size,this[bGutterSize],Yr.i)}function cr(dn){var xr,Yr=j[this.a],Rn=j[this.b];this.dragging&&(xr=Zr(dn)-this.start+(this[aGutterSize]-this.dragOffset),Bt>1&&(xr=Math.round(xr/Bt)*Bt),xr<=Yr.minSize+Yr.snapOffset+this[aGutterSize]?xr=Yr.minSize+this[aGutterSize]:xr>=this.size-(Rn.minSize+Rn.snapOffset+this[bGutterSize])&&(xr=this.size-(Rn.minSize+this[bGutterSize])),xr>=Yr.maxSize-Yr.snapOffset+this[aGutterSize]?xr=Yr.maxSize+this[aGutterSize]:xr<=this.size-(Rn.maxSize-Rn.snapOffset+this[bGutterSize])&&(xr=this.size-(Rn.maxSize+this[bGutterSize])),Hr.call(this,xr),getOption(e,"onDrag",NOOP$2)(vr()))}function lr(){var dn=j[this.a].element,xr=j[this.b].element,Yr=dn[getBoundingClientRect](),Rn=xr[getBoundingClientRect]();this.size=Yr[o]+Rn[o]+this[aGutterSize]+this[bGutterSize],this.start=Yr[d],this.end=Yr[g]}function Fr(dn){if(!getComputedStyle)return null;var xr=getComputedStyle(dn);if(!xr)return null;var Yr=dn[_];return Yr===0?null:(Ht===HORIZONTAL?Yr-=parseFloat(xr.paddingLeft)+parseFloat(xr.paddingRight):Yr-=parseFloat(xr.paddingTop)+parseFloat(xr.paddingBottom),Yr)}function an(dn){var xr=Fr(et);if(xr===null||ct.reduce(function(pr,nn){return pr+nn},0)>xr)return dn;var Yr=0,Rn=[],Ln=dn.map(function(pr,nn){var mn=xr*pr/100,Vr=getGutterSize(gt,nn===0,nn===dn.length-1,Ct),Mr=ct[nn]+Vr;return mn<Mr?(Yr+=Mr-mn,Rn.push(0),Mr):(Rn.push(mn-Mr),mn)});return Yr===0?dn:Ln.map(function(pr,nn){var mn=pr;if(Yr>0&&Rn[nn]-Yr>0){var Vr=Math.min(Yr,Rn[nn]-Yr);Yr-=Vr,mn=pr-Vr}return mn/xr*100})}function kn(){var dn=this,xr=j[dn.a].element,Yr=j[dn.b].element;dn.dragging&&getOption(e,"onDragEnd",NOOP$2)(vr()),dn.dragging=!1,global$1[removeEventListener]("mouseup",dn.stop),global$1[removeEventListener]("touchend",dn.stop),global$1[removeEventListener]("touchcancel",dn.stop),global$1[removeEventListener]("mousemove",dn.move),global$1[removeEventListener]("touchmove",dn.move),dn.stop=null,dn.move=null,xr[removeEventListener]("selectstart",NOOP$2),xr[removeEventListener]("dragstart",NOOP$2),Yr[removeEventListener]("selectstart",NOOP$2),Yr[removeEventListener]("dragstart",NOOP$2),xr.style.userSelect="",xr.style.webkitUserSelect="",xr.style.MozUserSelect="",xr.style.pointerEvents="",Yr.style.userSelect="",Yr.style.webkitUserSelect="",Yr.style.MozUserSelect="",Yr.style.pointerEvents="",dn.gutter.style.cursor="",dn.parent.style.cursor="",document$1.body.style.cursor=""}function ms(dn){if(!("button"in dn&&dn.button!==0)){var xr=this,Yr=j[xr.a].element,Rn=j[xr.b].element;xr.dragging||getOption(e,"onDragStart",NOOP$2)(vr()),dn.preventDefault(),xr.dragging=!0,xr.move=cr.bind(xr),xr.stop=kn.bind(xr),global$1[addEventListener]("mouseup",xr.stop),global$1[addEventListener]("touchend",xr.stop),global$1[addEventListener]("touchcancel",xr.stop),global$1[addEventListener]("mousemove",xr.move),global$1[addEventListener]("touchmove",xr.move),Yr[addEventListener]("selectstart",NOOP$2),Yr[addEventListener]("dragstart",NOOP$2),Rn[addEventListener]("selectstart",NOOP$2),Rn[addEventListener]("dragstart",NOOP$2),Yr.style.userSelect="none",Yr.style.webkitUserSelect="none",Yr.style.MozUserSelect="none",Yr.style.pointerEvents="none",Rn.style.userSelect="none",Rn.style.webkitUserSelect="none",Rn.style.MozUserSelect="none",Rn.style.pointerEvents="none",xr.gutter.style.cursor=sr,xr.parent.style.cursor=sr,document$1.body.style.cursor=sr,lr.call(xr),xr.dragOffset=Zr(dn)-xr.end}}it=an(it);var Zn=[];j=s.map(function(dn,xr){var Yr={element:elementOrSelector(dn),size:it[xr],minSize:ct[xr],maxSize:dt[xr],snapOffset:at[xr],i:xr},Rn;if(xr>0&&(Rn={a:xr-1,b:xr,dragging:!1,direction:Ht,parent:et},Rn[aGutterSize]=getGutterSize(gt,xr-1===0,!1,Ct),Rn[bGutterSize]=getGutterSize(gt,!1,xr===s.length-1,Ct),rt==="row-reverse"||rt==="column-reverse")){var Ln=Rn.a;Rn.a=Rn.b,Rn.b=Ln}if(xr>0){var pr=mr(xr,Ht,Yr.element);sn(pr,gt,xr),Rn[gutterStartDragging]=ms.bind(Rn),pr[addEventListener]("mousedown",Rn[gutterStartDragging]),pr[addEventListener]("touchstart",Rn[gutterStartDragging]),et.insertBefore(pr,Yr.element),Rn.gutter=pr}return Lr(Yr.element,Yr.size,getGutterSize(gt,xr===0,xr===s.length-1,Ct),xr),xr>0&&Zn.push(Rn),Yr});function As(dn){var xr=dn.i===Zn.length,Yr=xr?Zn[dn.i-1]:Zn[dn.i];lr.call(Yr);var Rn=xr?Yr.size-dn.minSize-Yr[bGutterSize]:dn.minSize+Yr[aGutterSize];Hr.call(Yr,Rn)}j.forEach(function(dn){var xr=dn.element[getBoundingClientRect]()[o];xr<dn.minSize&&(pt?As(dn):dn.minSize=xr)});function Rs(dn){var xr=an(dn);xr.forEach(function(Yr,Rn){if(Rn>0){var Ln=Zn[Rn-1],pr=j[Ln.a],nn=j[Ln.b];pr.size=xr[Rn-1],nn.size=Yr,Lr(pr.element,pr.size,Ln[aGutterSize],pr.i),Lr(nn.element,nn.size,Ln[bGutterSize],nn.i)}})}function Gn(dn,xr){Zn.forEach(function(Yr){if(xr!==!0?Yr.parent.removeChild(Yr.gutter):(Yr.gutter[removeEventListener]("mousedown",Yr[gutterStartDragging]),Yr.gutter[removeEventListener]("touchstart",Yr[gutterStartDragging])),dn!==!0){var Rn=hr(o,Yr.a.size,Yr[aGutterSize]);Object.keys(Rn).forEach(function(Ln){j[Yr.a].element.style[Ln]="",j[Yr.b].element.style[Ln]=""})}})}return{setSizes:Rs,getSizes:vr,collapse:function(xr){As(j[xr])},destroy:Gn,parent:et,pairs:Zn}};function createEl(i,e,s){const o=document.createElement(i);return e&&addElProps(o,e),s&&s.append(o),o}function createSVGEl(i,e,s){const o=document.createElementNS("http://www.w3.org/2000/svg",i);if(e)for(var a in e)if((a==="styles"||a==="style")&&typeof e[a]=="object")for(var d in e[a])o.style[d]=e[a][d];else if(a==="text")o.textContent=e[a];else if(a==="classes")for(var g of e[a])o.classList.add(g);else o.setAttributeNS(null,a,e[a]);return s&&s.append(o),o}function splitPane(i,e={}){const s=e.direction||"horizontal",o=e.number||2,a=[],d=s==="horizontal"?["split-horizontal"]:["split-vertical"];for(let g=0;g<o;g++)a.push(createEl("div",{classes:d},i));return Split(a,{direction:s,gutterSize:5,cursor:"pointer",sizes:e.sizes,onDragEnd:()=>window.dispatchEvent(new Event("resize"))}),a}function createMenuIcon(i,e,s){const o={},a=e.tooltip;a&&Object.assign(o,{"aria-label":a.text,role:"tooltip","data-microtip-size":a.size||"small","data-microtip-position":a.position||"bottom-left"});const d=createEl("span",o);return createEl("i",{classes:["ciview-menu-icon"].concat(i.split(" ")),styles:{fontSize:e.size||"18px"}},d),e.func&&d.addEventListener("click",g=>e.func(g)),s&&s.append(d),d}function addElProps(i,e){for(var s in e)if((s==="styles"||s==="style")&&typeof e[s]=="object")for(var o in e[s])i.style[o]=e[s][o];else if(s==="text")i.textContent=e[s];else if(s==="classes")for(var a of e[s])i.classList.add(a);else i.setAttribute(s,e[s])}function makeSortable(i,e={}){let s=null,o=!1;function a(_e){return this.after(s),_e.preventDefault(),!1}function d(_e){o=!1,s.classList.remove("mdv-element-dragged"),e.sortEnded&&e.sortEnded(Array.from(i.children).slice(1))}function g(_e){e.handle?_e.target.classList.contains(e.handle)?o=!0:o=!1:o=!0}function _(_e){if(!o)return _e.preventDefault(),!1;s=this,this.classList.add("mdv-element-dragged"),_e.dataTransfer.setDragImage(createEl("div",{}),0,0)}let j=createEl("div",{styles:{height:"5px"}});i.prepend(j),j.addEventListener("dragover",a);for(let _e=0;_e<i.children.length;_e++){const et=i.children[_e];et.draggable=!0,et.addEventListener("dragover",a),et.addEventListener("dragstart",_),et.addEventListener("dragend",d),et.addEventListener("mousedown",g)}}function makeResizable(i,e={}){if(i.__resizeinfo__)return;const s={resize:i.style.resize,overflow:i.style.overflow};i.style.overflow="hidden",e.onresizeend&&(s.onresize=addResizeListener(i,(_,j)=>{e.onresizeend(_,j)},e.onResizeStart)),createEl("div",{classes:["resizer-both"]},i).addEventListener("mousedown",a,!1);function a(_){s.startX=_.clientX,s.startY=_.clientY,s.startWidth=parseInt(document.defaultView.getComputedStyle(i).width,10),s.startHeight=parseInt(document.defaultView.getComputedStyle(i).height,10),document.documentElement.addEventListener("mousemove",d,!1),document.documentElement.addEventListener("mouseup",g,!1)}function d(_){i.style.width=s.startWidth+_.clientX-s.startX+"px",i.style.height=s.startHeight+_.clientY-s.startY+"px"}function g(_){document.documentElement.removeEventListener("mousemove",d,!1),document.documentElement.removeEventListener("mouseup",g,!1)}i.__resizeinfo__=s}function removeResizable(i){if(!i.__resizeinfo__)return;const e=i.__resizeinfo__;i.style.resize=e.resize,i.style.overflow=e.overflow,e.onresize&&i.removeEventListener("mouseup",e.onresize),delete i.__resizeinfo__}function removeDraggable(i){const e=i.__draginfo__;e&&(e.handle.style.cursor=e.cursor,i.style.position=e.position,e.handle.onmousedown=null,delete i.__draginfo__)}class MDVProgress{constructor(e,s){this.el=e,this.max=s.max||100,e.classList.add("mdv-progress-outer"),this.bar=createEl("div",{classes:["mdv-progress-inner"]},e),this.text=createEl("div",{classes:["mdv-progress-text"]},e),this.setText(s.text||""),this.setValue(s.value||0)}setText(e){this.text.textContent=e}setValue(e){this.bar.style.width=`${Math.round(e/this.max*100)}%`}}function makeDraggable(i,e={}){e.doc||(e.doc=document);let s=0,o=0,a=0,d=0,g=e.handle?i.querySelector(e.handle):i,_=null;e.contain&&(_={dir:e.contain}),g.onmousedown=j,i.__draginfo__={handle:g,cursor:g.style.cursor,position:i.style.position},g.style.cursor="move",i.style.position="absolute",i.style.margin="0px 0px 0px 0px",i.__doc__=e.doc;function j(tt){tt=tt||window.event,tt.preventDefault(),a=tt.clientX,d=tt.clientY,e.ondragstart&&e.ondragstart(i),_&&(_.p_bb=i.parentElement.getBoundingClientRect(),_.c_bb=i.getBoundingClientRect()),i.__doc__.onmouseup=et,i.__doc__.onmousemove=_e}function _e(tt){tt=tt||window.event,tt.preventDefault(),tt.stopPropagation(),s=a-tt.clientX,o=d-tt.clientY,a=tt.clientX,d=tt.clientY;let rt=i.offsetTop-o,it=i.offsetLeft-s;_&&(rt<0||rt+_.c_bb.height>_.p_bb.height&&_.dir!=="topleft"||it<0||it+_.c_bb.width>_.p_bb.width&&_.dir!=="topleft")||(e.y_axis||(i.style.top=rt+"px"),i.style.left=it+"px")}function et(){e.ondragend&&e.ondragend(),i.__doc__.onmouseup=null,i.__doc__.onmousemove=null}}function addResizeListener(i,e,s){let o=i.getBoundingClientRect(),a=o.width,d=o.height;const g=_=>{let j=i.getBoundingClientRect();(j.width!==a||j.height!==d)&&e(j.width,j.height),a=j.width,d=j.height};return s&&i.addEventListener("mousedown",s),i.addEventListener("mouseup",g),g}function getElDim(i){var e=i.getBoundingClientRect(),s=window.pageXOffset||document.documentElement.scrollLeft,o=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+o,left:e.left+s,height:e.height,width:e.width}}function getRandomString(i=6,e){i||(i=6),e=e&&e.toLowerCase();let s="",o=0,a=e=="a"?10:0,d=e=="n"?10:62;for(;o++<i;){let g=Math.random()*(d-a)+a<<0;s+=String.fromCharCode(g+=g>9?g<36?55:61:48)}return s}function debounce(i,e){let s;return(...o)=>{clearTimeout(s),s=setTimeout(()=>{i.apply(this,o)},e)}}class ContextMenu{constructor(e){this.setItemFunction=e,this.menus=[]}show(e,s){this.menus.length>0&&this.remove();const o=this.setItemFunction(s);this._addMenu(o,e.pageX,e.pageY),console.log(e.clientY),e.stopPropagation(),this.removeFunc=()=>{this.remove()},this._getDocument().body.addEventListener("click",this.removeFunc)}remove(){for(let e of this.menus)e.remove();this.menus=[],this.removeFunc&&this._getDocument().body.removeEventListener("click",this.removeFunc)}_addMenu(e,s,o){let a=document.createElement("div");const d=this._getDocument();let g=this.menus.length;a.classList.add("ciview-ctm-main");for(let j of e)this._addItem(a,j,g);d.body.append(a);const _=a.getBoundingClientRect();s+_.width>d.body.clientWidth&&(s=d.body.clientWidth-_.width-3),a.style.left=s+"px",a.style.top=o+"px",this.menus.push(a)}_getDocument(){return this.__doc__?this.__doc__:document}_showSubmenu(e,s,o){for(let d=o+1;d<this.menus.length;d++)this.menus[d].remove();this.menus=this.menus.slice(0,o+1);const a=e.getBoundingClientRect();this._addMenu(s,a.left+a.width+1,a.top)}_addItem(e,s,o){const a=document.createElement("div");if(a.classList.add("ciview-ctm-item"),s.ghosted?a.classList.add("ciview-ctm-ghosted"):a.classList.add("ciview-ctm-active"),s.icon){const g=document.createElement("i");for(let _ of s.icon.split(" "))g.classList.add(_);g.classList.add("ciview-ctm-left-icon"),a.appendChild(g)}const d=document.createElement("span");if(d.appendChild(document.createTextNode(s.text)),a.append(d),s.subitems){const g=document.createElement("i");g.classList.add("fas","fa-caret-right","ciview-ctm-right-icon"),a.appendChild(g)}a.addEventListener("click",g=>{if(s.func&&!s.ghosted&&s.func(g),s.subitems){this._showSubmenu(a,s.subitems,o);for(let _ of e.children)_.classList.remove("ciview-ctm-selected");a.classList.add("ciview-ctm-selected")}else this.remove();g.stopPropagation()}),e.append(a)}}class BaseDialog{constructor(e={},s){e.doc=e.doc||document,this.config=e,this.buttons={};const o=e.width?e.width+"px":"",a=e.height?e.height+"px":"";if(this.outer=createEl("div",{classes:["ciview-dlg-outer"],styles:{width:o,height:a}}),this.header=createEl("div",{classes:["ciview-dlg-header"]},this.outer),createEl("span",{classes:["ciview-dlg-header-text"],text:e.title},this.header),createEl("i",{classes:["fas","fa-times","ciview-dlg-close-icon"]},this.header).addEventListener("click",()=>{this.close()}),this.dialog=createEl("div",{classes:["ciview-dlg-content"]},this.outer),makeResizable(this.outer,{onresizeend:(j,_e)=>{this.onResize(j,_e)}}),makeDraggable(this.outer,{doc:e.doc,handle:".ciview-dlg-header"}),e.columns&&this._createColumns(e.columns),e.footer&&this._addFooter(),e.buttons){this.footer||this._addFooter();for(let j of e.buttons)this._addButton(j)}this.init(s),e.doc.body.append(this.outer);const d=e.doc.body.getBoundingClientRect(),g=this.outer.getBoundingClientRect();e.maxHeight&&g.height>e.maxHeight&&(g.height=e.maxHeight,this.outer.style.height=e.maxHeight+"px");let _=this.config.position;if(_||(_=[d.width/2-g.width/2,d.height/2-g.height/2]),_[0]+g.width>d.width){let j=d.width-g.width;_[0]=j<0?0:j}if(_[1]+g.height>d.height){let j=d.height-g.height;_[1]=j<0?0:j}this.outer.style.left=_[0]+"px",this.outer.style.top=_[1]+"px"}_addFooter(){this.footer=createEl("div",{styles:{flex:"0 0 auto",padding:"5px",justifyContent:"center",display:"flex",gap:"1em"}},this.outer)}_addButton(e){const s=createEl("button",{text:e.text,classes:["ciview-button"]},this.footer);s.addEventListener("click",()=>this[e.method]()),e.id&&(this.buttons[e.id]=s)}disableButton(e,s){s?this.buttons[e].classList.add("ciview-disabled"):this.buttons[e].classList.remove("ciview-disabled")}_createColumns(e){this.dialog.style.display="flex",this.dialog.style.flexDirection="row",this.columns=[];for(let s=0;s<e;s++)this.columns.push(createEl("div",{styles:{height:"100%",flexBasis:"0",flexGrow:"1",padding:"0px 4px",flexDirection:"column",alignItems:"stretch"}},this.dialog))}close(){this.config.onclose&&this.config.onclose(),this.outer.remove()}init(){}onResize(e,s){}}BaseDialog.experiment={};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var nouisliderExports={},nouislider={get exports(){return nouisliderExports},set exports(i){nouisliderExports=i}};(function(i,e){(function(s,o){o(e)})(commonjsGlobal,function(s){s.PipsMode=void 0,function(Ot){Ot.Range="range",Ot.Steps="steps",Ot.Positions="positions",Ot.Count="count",Ot.Values="values"}(s.PipsMode||(s.PipsMode={})),s.PipsType=void 0,function(Ot){Ot[Ot.None=-1]="None",Ot[Ot.NoValue=0]="NoValue",Ot[Ot.LargeValue=1]="LargeValue",Ot[Ot.SmallValue=2]="SmallValue"}(s.PipsType||(s.PipsType={}));function o(Ot){return a(Ot)&&typeof Ot.from=="function"}function a(Ot){return typeof Ot=="object"&&typeof Ot.to=="function"}function d(Ot){Ot.parentElement.removeChild(Ot)}function g(Ot){return Ot!=null}function _(Ot){Ot.preventDefault()}function j(Ot){return Ot.filter(function(_t){return this[_t]?!1:this[_t]=!0},{})}function _e(Ot,_t){return Math.round(Ot/_t)*_t}function et(Ot,_t){var Ir=Ot.getBoundingClientRect(),en=Ot.ownerDocument,ln=en.documentElement,zn=gt(en);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(zn.x=0),_t?Ir.top+zn.y-ln.clientTop:Ir.left+zn.x-ln.clientLeft}function tt(Ot){return typeof Ot=="number"&&!isNaN(Ot)&&isFinite(Ot)}function rt(Ot,_t,Ir){Ir>0&&(ft(Ot,_t),setTimeout(function(){dt(Ot,_t)},Ir))}function it(Ot){return Math.max(Math.min(Ot,100),0)}function ot(Ot){return Array.isArray(Ot)?Ot:[Ot]}function ct(Ot){Ot=String(Ot);var _t=Ot.split(".");return _t.length>1?_t[1].length:0}function ft(Ot,_t){Ot.classList&&!/\s/.test(_t)?Ot.classList.add(_t):Ot.className+=" "+_t}function dt(Ot,_t){Ot.classList&&!/\s/.test(_t)?Ot.classList.remove(_t):Ot.className=Ot.className.replace(new RegExp("(^|\\b)"+_t.split(" ").join("|")+"(\\b|$)","gi")," ")}function pt(Ot,_t){return Ot.classList?Ot.classList.contains(_t):new RegExp("\\b"+_t+"\\b").test(Ot.className)}function gt(Ot){var _t=window.pageXOffset!==void 0,Ir=(Ot.compatMode||"")==="CSS1Compat",en=_t?window.pageXOffset:Ir?Ot.documentElement.scrollLeft:Ot.body.scrollLeft,ln=_t?window.pageYOffset:Ir?Ot.documentElement.scrollTop:Ot.body.scrollTop;return{x:en,y:ln}}function Ct(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function xt(){var Ot=!1;try{var _t=Object.defineProperty({},"passive",{get:function(){Ot=!0}});window.addEventListener("test",null,_t)}catch{}return Ot}function at(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Bt(Ot,_t){return 100/(_t-Ot)}function Ht(Ot,_t,Ir){return _t*100/(Ot[Ir+1]-Ot[Ir])}function sr(Ot,_t){return Ht(Ot,Ot[0]<0?_t+Math.abs(Ot[0]):_t-Ot[0],0)}function mr(Ot,_t){return _t*(Ot[1]-Ot[0])/100+Ot[0]}function hr(Ot,_t){for(var Ir=1;Ot>=_t[Ir];)Ir+=1;return Ir}function Er(Ot,_t,Ir){if(Ir>=Ot.slice(-1)[0])return 100;var en=hr(Ir,Ot),ln=Ot[en-1],zn=Ot[en],jn=_t[en-1],ys=_t[en];return jn+sr([ln,zn],Ir)/Bt(jn,ys)}function Lr(Ot,_t,Ir){if(Ir>=100)return Ot.slice(-1)[0];var en=hr(Ir,_t),ln=Ot[en-1],zn=Ot[en],jn=_t[en-1],ys=_t[en];return mr([ln,zn],(Ir-jn)*Bt(jn,ys))}function sn(Ot,_t,Ir,en){if(en===100)return en;var ln=hr(en,Ot),zn=Ot[ln-1],jn=Ot[ln];return Ir?en-zn>(jn-zn)/2?jn:zn:_t[ln-1]?Ot[ln-1]+_e(en-Ot[ln-1],_t[ln-1]):en}var vr=function(){function Ot(_t,Ir,en){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[en||!1],this.xNumSteps=[!1],this.snap=Ir;var ln,zn=[];for(Object.keys(_t).forEach(function(jn){zn.push([ot(_t[jn]),jn])}),zn.sort(function(jn,ys){return jn[0][0]-ys[0][0]}),ln=0;ln<zn.length;ln++)this.handleEntryPoint(zn[ln][1],zn[ln][0]);for(this.xNumSteps=this.xSteps.slice(0),ln=0;ln<this.xNumSteps.length;ln++)this.handleStepPoint(ln,this.xNumSteps[ln])}return Ot.prototype.getDistance=function(_t){for(var Ir=[],en=0;en<this.xNumSteps.length-1;en++)Ir[en]=Ht(this.xVal,_t,en);return Ir},Ot.prototype.getAbsoluteDistance=function(_t,Ir,en){var ln=0;if(_t<this.xPct[this.xPct.length-1])for(;_t>this.xPct[ln+1];)ln++;else _t===this.xPct[this.xPct.length-1]&&(ln=this.xPct.length-2);!en&&_t===this.xPct[ln+1]&&ln++,Ir===null&&(Ir=[]);var zn,jn=1,ys=Ir[ln],Bn=0,cs=0,hs=0,Ss=0;for(en?zn=(_t-this.xPct[ln])/(this.xPct[ln+1]-this.xPct[ln]):zn=(this.xPct[ln+1]-_t)/(this.xPct[ln+1]-this.xPct[ln]);ys>0;)Bn=this.xPct[ln+1+Ss]-this.xPct[ln+Ss],Ir[ln+Ss]*jn+100-zn*100>100?(cs=Bn*zn,jn=(ys-100*zn)/Ir[ln+Ss],zn=1):(cs=Ir[ln+Ss]*Bn/100*jn,jn=0),en?(hs=hs-cs,this.xPct.length+Ss>=1&&Ss--):(hs=hs+cs,this.xPct.length-Ss>=1&&Ss++),ys=Ir[ln+Ss]*jn;return _t+hs},Ot.prototype.toStepping=function(_t){return _t=Er(this.xVal,this.xPct,_t),_t},Ot.prototype.fromStepping=function(_t){return Lr(this.xVal,this.xPct,_t)},Ot.prototype.getStep=function(_t){return _t=sn(this.xPct,this.xSteps,this.snap,_t),_t},Ot.prototype.getDefaultStep=function(_t,Ir,en){var ln=hr(_t,this.xPct);return(_t===100||Ir&&_t===this.xPct[ln-1])&&(ln=Math.max(ln-1,1)),(this.xVal[ln]-this.xVal[ln-1])/en},Ot.prototype.getNearbySteps=function(_t){var Ir=hr(_t,this.xPct);return{stepBefore:{startValue:this.xVal[Ir-2],step:this.xNumSteps[Ir-2],highestStep:this.xHighestCompleteStep[Ir-2]},thisStep:{startValue:this.xVal[Ir-1],step:this.xNumSteps[Ir-1],highestStep:this.xHighestCompleteStep[Ir-1]},stepAfter:{startValue:this.xVal[Ir],step:this.xNumSteps[Ir],highestStep:this.xHighestCompleteStep[Ir]}}},Ot.prototype.countStepDecimals=function(){var _t=this.xNumSteps.map(ct);return Math.max.apply(null,_t)},Ot.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},Ot.prototype.convert=function(_t){return this.getStep(this.toStepping(_t))},Ot.prototype.handleEntryPoint=function(_t,Ir){var en;if(_t==="min"?en=0:_t==="max"?en=100:en=parseFloat(_t),!tt(en)||!tt(Ir[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(en),this.xVal.push(Ir[0]);var ln=Number(Ir[1]);en?this.xSteps.push(isNaN(ln)?!1:ln):isNaN(ln)||(this.xSteps[0]=ln),this.xHighestCompleteStep.push(0)},Ot.prototype.handleStepPoint=function(_t,Ir){if(Ir){if(this.xVal[_t]===this.xVal[_t+1]){this.xSteps[_t]=this.xHighestCompleteStep[_t]=this.xVal[_t];return}this.xSteps[_t]=Ht([this.xVal[_t],this.xVal[_t+1]],Ir,0)/Bt(this.xPct[_t],this.xPct[_t+1]);var en=(this.xVal[_t+1]-this.xVal[_t])/this.xNumSteps[_t],ln=Math.ceil(Number(en.toFixed(3))-1),zn=this.xVal[_t]+this.xNumSteps[_t]*ln;this.xHighestCompleteStep[_t]=zn}},Ot}(),Zr={to:function(Ot){return Ot===void 0?"":Ot.toFixed(2)},from:Number},Hr={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},cr={tooltips:".__tooltips",aria:".__aria"};function lr(Ot,_t){if(!tt(_t))throw new Error("noUiSlider: 'step' is not numeric.");Ot.singleStep=_t}function Fr(Ot,_t){if(!tt(_t))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");Ot.keyboardPageMultiplier=_t}function an(Ot,_t){if(!tt(_t))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");Ot.keyboardMultiplier=_t}function kn(Ot,_t){if(!tt(_t))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");Ot.keyboardDefaultStep=_t}function ms(Ot,_t){if(typeof _t!="object"||Array.isArray(_t))throw new Error("noUiSlider: 'range' is not an object.");if(_t.min===void 0||_t.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");Ot.spectrum=new vr(_t,Ot.snap||!1,Ot.singleStep)}function Zn(Ot,_t){if(_t=ot(_t),!Array.isArray(_t)||!_t.length)throw new Error("noUiSlider: 'start' option is incorrect.");Ot.handles=_t.length,Ot.start=_t}function As(Ot,_t){if(typeof _t!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");Ot.snap=_t}function Rs(Ot,_t){if(typeof _t!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");Ot.animate=_t}function Gn(Ot,_t){if(typeof _t!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");Ot.animationDuration=_t}function dn(Ot,_t){var Ir=[!1],en;if(_t==="lower"?_t=[!0,!1]:_t==="upper"&&(_t=[!1,!0]),_t===!0||_t===!1){for(en=1;en<Ot.handles;en++)Ir.push(_t);Ir.push(!1)}else{if(!Array.isArray(_t)||!_t.length||_t.length!==Ot.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");Ir=_t}Ot.connect=Ir}function xr(Ot,_t){switch(_t){case"horizontal":Ot.ort=0;break;case"vertical":Ot.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Yr(Ot,_t){if(!tt(_t))throw new Error("noUiSlider: 'margin' option must be numeric.");_t!==0&&(Ot.margin=Ot.spectrum.getDistance(_t))}function Rn(Ot,_t){if(!tt(_t))throw new Error("noUiSlider: 'limit' option must be numeric.");if(Ot.limit=Ot.spectrum.getDistance(_t),!Ot.limit||Ot.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Ln(Ot,_t){var Ir;if(!tt(_t)&&!Array.isArray(_t))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(_t)&&!(_t.length===2||tt(_t[0])||tt(_t[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(_t!==0){for(Array.isArray(_t)||(_t=[_t,_t]),Ot.padding=[Ot.spectrum.getDistance(_t[0]),Ot.spectrum.getDistance(_t[1])],Ir=0;Ir<Ot.spectrum.xNumSteps.length-1;Ir++)if(Ot.padding[0][Ir]<0||Ot.padding[1][Ir]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var en=_t[0]+_t[1],ln=Ot.spectrum.xVal[0],zn=Ot.spectrum.xVal[Ot.spectrum.xVal.length-1];if(en/(zn-ln)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function pr(Ot,_t){switch(_t){case"ltr":Ot.dir=0;break;case"rtl":Ot.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function nn(Ot,_t){if(typeof _t!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var Ir=_t.indexOf("tap")>=0,en=_t.indexOf("drag")>=0,ln=_t.indexOf("fixed")>=0,zn=_t.indexOf("snap")>=0,jn=_t.indexOf("hover")>=0,ys=_t.indexOf("unconstrained")>=0,Bn=_t.indexOf("drag-all")>=0,cs=_t.indexOf("smooth-steps")>=0;if(ln){if(Ot.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Yr(Ot,Ot.start[1]-Ot.start[0])}if(ys&&(Ot.margin||Ot.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");Ot.events={tap:Ir||zn,drag:en,dragAll:Bn,smoothSteps:cs,fixed:ln,snap:zn,hover:jn,unconstrained:ys}}function mn(Ot,_t){if(_t!==!1)if(_t===!0||a(_t)){Ot.tooltips=[];for(var Ir=0;Ir<Ot.handles;Ir++)Ot.tooltips.push(_t)}else{if(_t=ot(_t),_t.length!==Ot.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");_t.forEach(function(en){if(typeof en!="boolean"&&!a(en))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),Ot.tooltips=_t}}function Vr(Ot,_t){if(_t.length!==Ot.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");Ot.handleAttributes=_t}function Mr(Ot,_t){if(!a(_t))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");Ot.ariaFormat=_t}function Cn(Ot,_t){if(!o(_t))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");Ot.format=_t}function is(Ot,_t){if(typeof _t!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");Ot.keyboardSupport=_t}function ts(Ot,_t){Ot.documentElement=_t}function Qn(Ot,_t){if(typeof _t!="string"&&_t!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");Ot.cssPrefix=_t}function Xs(Ot,_t){if(typeof _t!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof Ot.cssPrefix=="string"?(Ot.cssClasses={},Object.keys(_t).forEach(function(Ir){Ot.cssClasses[Ir]=Ot.cssPrefix+_t[Ir]})):Ot.cssClasses=_t}function bt(Ot){var _t={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:Zr,format:Zr},Ir={step:{r:!1,t:lr},keyboardPageMultiplier:{r:!1,t:Fr},keyboardMultiplier:{r:!1,t:an},keyboardDefaultStep:{r:!1,t:kn},start:{r:!0,t:Zn},connect:{r:!0,t:dn},direction:{r:!0,t:pr},snap:{r:!1,t:As},animate:{r:!1,t:Rs},animationDuration:{r:!1,t:Gn},range:{r:!0,t:ms},orientation:{r:!1,t:xr},margin:{r:!1,t:Yr},limit:{r:!1,t:Rn},padding:{r:!1,t:Ln},behaviour:{r:!0,t:nn},ariaFormat:{r:!1,t:Mr},format:{r:!1,t:Cn},tooltips:{r:!1,t:mn},keyboardSupport:{r:!0,t:is},documentElement:{r:!1,t:ts},cssPrefix:{r:!0,t:Qn},cssClasses:{r:!0,t:Xs},handleAttributes:{r:!1,t:Vr}},en={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:Hr,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};Ot.format&&!Ot.ariaFormat&&(Ot.ariaFormat=Ot.format),Object.keys(Ir).forEach(function(Bn){if(!g(Ot[Bn])&&en[Bn]===void 0){if(Ir[Bn].r)throw new Error("noUiSlider: '"+Bn+"' is required.");return}Ir[Bn].t(_t,g(Ot[Bn])?Ot[Bn]:en[Bn])}),_t.pips=Ot.pips;var ln=document.createElement("div"),zn=ln.style.msTransform!==void 0,jn=ln.style.transform!==void 0;_t.transformRule=jn?"transform":zn?"msTransform":"webkitTransform";var ys=[["left","top"],["right","bottom"]];return _t.style=ys[_t.dir][_t.ort],_t}function gs(Ot,_t,Ir){var en=Ct(),ln=at(),zn=ln&&xt(),jn=Ot,ys,Bn,cs,hs,Ss,us=_t.spectrum,Hs=[],Ps=[],Ns=[],wo=0,Co={},Jo=Ot.ownerDocument,na=_t.documentElement||Jo.documentElement,js=Jo.body,_u=Jo.dir==="rtl"||_t.ort===1?0:100;function Po(Dt,Wt){var rr=Jo.createElement("div");return Wt&&ft(rr,Wt),Dt.appendChild(rr),rr}function yu(Dt,Wt){var rr=Po(Dt,_t.cssClasses.origin),kr=Po(rr,_t.cssClasses.handle);if(Po(kr,_t.cssClasses.touchArea),kr.setAttribute("data-handle",String(Wt)),_t.keyboardSupport&&(kr.setAttribute("tabindex","0"),kr.addEventListener("keydown",function(_n){return So(_n,Wt)})),_t.handleAttributes!==void 0){var fn=_t.handleAttributes[Wt];Object.keys(fn).forEach(function(_n){kr.setAttribute(_n,fn[_n])})}return kr.setAttribute("role","slider"),kr.setAttribute("aria-orientation",_t.ort?"vertical":"horizontal"),Wt===0?ft(kr,_t.cssClasses.handleLower):Wt===_t.handles-1&&ft(kr,_t.cssClasses.handleUpper),rr}function ga(Dt,Wt){return Wt?Po(Dt,_t.cssClasses.connect):!1}function wu(Dt,Wt){var rr=Po(Wt,_t.cssClasses.connects);Bn=[],cs=[],cs.push(ga(rr,Dt[0]));for(var kr=0;kr<_t.handles;kr++)Bn.push(yu(Wt,kr)),Ns[kr]=kr,cs.push(ga(rr,Dt[kr+1]))}function Eu(Dt){ft(Dt,_t.cssClasses.target),_t.dir===0?ft(Dt,_t.cssClasses.ltr):ft(Dt,_t.cssClasses.rtl),_t.ort===0?ft(Dt,_t.cssClasses.horizontal):ft(Dt,_t.cssClasses.vertical);var Wt=getComputedStyle(Dt).direction;return Wt==="rtl"?ft(Dt,_t.cssClasses.textDirectionRtl):ft(Dt,_t.cssClasses.textDirectionLtr),Po(Dt,_t.cssClasses.base)}function Kl(Dt,Wt){return!_t.tooltips||!_t.tooltips[Wt]?!1:Po(Dt.firstChild,_t.cssClasses.tooltip)}function Il(){return jn.hasAttribute("disabled")}function ko(Dt){var Wt=Bn[Dt];return Wt.hasAttribute("disabled")}function _a(){Ss&&($o("update"+cr.tooltips),Ss.forEach(function(Dt){Dt&&d(Dt)}),Ss=null)}function ks(){_a(),Ss=Bn.map(Kl),Do("update"+cr.tooltips,function(Dt,Wt,rr){if(!(!Ss||!_t.tooltips)&&Ss[Wt]!==!1){var kr=Dt[Wt];_t.tooltips[Wt]!==!0&&(kr=_t.tooltips[Wt].to(rr[Wt])),Ss[Wt].innerHTML=kr}})}function Ol(){$o("update"+cr.aria),Do("update"+cr.aria,function(Dt,Wt,rr,kr,fn){Ns.forEach(function(_n){var Jn=Bn[_n],Mn=Io(Ps,_n,0,!0,!0,!0),$s=Io(Ps,_n,100,!0,!0,!0),Ds=fn[_n],Us=String(_t.ariaFormat.to(rr[_n]));Mn=us.fromStepping(Mn).toFixed(1),$s=us.fromStepping($s).toFixed(1),Ds=us.fromStepping(Ds).toFixed(1),Jn.children[0].setAttribute("aria-valuemin",Mn),Jn.children[0].setAttribute("aria-valuemax",$s),Jn.children[0].setAttribute("aria-valuenow",Ds),Jn.children[0].setAttribute("aria-valuetext",Us)})})}function Cl(Dt){if(Dt.mode===s.PipsMode.Range||Dt.mode===s.PipsMode.Steps)return us.xVal;if(Dt.mode===s.PipsMode.Count){if(Dt.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var Wt=Dt.values-1,rr=100/Wt,kr=[];Wt--;)kr[Wt]=Wt*rr;return kr.push(100),Nl(kr,Dt.stepped)}return Dt.mode===s.PipsMode.Positions?Nl(Dt.values,Dt.stepped):Dt.mode===s.PipsMode.Values?Dt.stepped?Dt.values.map(function(fn){return us.fromStepping(us.getStep(us.toStepping(fn)))}):Dt.values:[]}function Nl(Dt,Wt){return Dt.map(function(rr){return us.fromStepping(Wt?us.getStep(rr):rr)})}function nu(Dt){function Wt(Ds,Us){return Number((Ds+Us).toFixed(7))}var rr=Cl(Dt),kr={},fn=us.xVal[0],_n=us.xVal[us.xVal.length-1],Jn=!1,Mn=!1,$s=0;return rr=j(rr.slice().sort(function(Ds,Us){return Ds-Us})),rr[0]!==fn&&(rr.unshift(fn),Jn=!0),rr[rr.length-1]!==_n&&(rr.push(_n),Mn=!0),rr.forEach(function(Ds,Us){var Gs,Ts,Ys,zs=Ds,Zs=rr[Us+1],Qs,Rl,Vl,Ul,xu,Su,iu,_l=Dt.mode===s.PipsMode.Steps;for(_l&&(Gs=us.xNumSteps[Us]),Gs||(Gs=Zs-zs),Zs===void 0&&(Zs=zs),Gs=Math.max(Gs,1e-7),Ts=zs;Ts<=Zs;Ts=Wt(Ts,Gs)){for(Qs=us.toStepping(Ts),Rl=Qs-$s,xu=Rl/(Dt.density||1),Su=Math.round(xu),iu=Rl/Su,Ys=1;Ys<=Su;Ys+=1)Vl=$s+Ys*iu,kr[Vl.toFixed(5)]=[us.fromStepping(Vl),0];Ul=rr.indexOf(Ts)>-1?s.PipsType.LargeValue:_l?s.PipsType.SmallValue:s.PipsType.NoValue,!Us&&Jn&&Ts!==Zs&&(Ul=0),Ts===Zs&&Mn||(kr[Qs.toFixed(5)]=[Ts,Ul]),$s=Qs}}),kr}function Fl(Dt,Wt,rr){var kr,fn,_n=Jo.createElement("div"),Jn=(kr={},kr[s.PipsType.None]="",kr[s.PipsType.NoValue]=_t.cssClasses.valueNormal,kr[s.PipsType.LargeValue]=_t.cssClasses.valueLarge,kr[s.PipsType.SmallValue]=_t.cssClasses.valueSub,kr),Mn=(fn={},fn[s.PipsType.None]="",fn[s.PipsType.NoValue]=_t.cssClasses.markerNormal,fn[s.PipsType.LargeValue]=_t.cssClasses.markerLarge,fn[s.PipsType.SmallValue]=_t.cssClasses.markerSub,fn),$s=[_t.cssClasses.valueHorizontal,_t.cssClasses.valueVertical],Ds=[_t.cssClasses.markerHorizontal,_t.cssClasses.markerVertical];ft(_n,_t.cssClasses.pips),ft(_n,_t.ort===0?_t.cssClasses.pipsHorizontal:_t.cssClasses.pipsVertical);function Us(Ts,Ys){var zs=Ys===_t.cssClasses.value,Zs=zs?$s:Ds,Qs=zs?Jn:Mn;return Ys+" "+Zs[_t.ort]+" "+Qs[Ts]}function Gs(Ts,Ys,zs){if(zs=Wt?Wt(Ys,zs):zs,zs!==s.PipsType.None){var Zs=Po(_n,!1);Zs.className=Us(zs,_t.cssClasses.marker),Zs.style[_t.style]=Ts+"%",zs>s.PipsType.NoValue&&(Zs=Po(_n,!1),Zs.className=Us(zs,_t.cssClasses.value),Zs.setAttribute("data-value",String(Ys)),Zs.style[_t.style]=Ts+"%",Zs.innerHTML=String(rr.to(Ys)))}}return Object.keys(Dt).forEach(function(Ts){Gs(Ts,Dt[Ts][0],Dt[Ts][1])}),_n}function Mo(){hs&&(d(hs),hs=null)}function Eo(Dt){Mo();var Wt=nu(Dt),rr=Dt.filter,kr=Dt.format||{to:function(fn){return String(Math.round(fn))}};return hs=jn.appendChild(Fl(Wt,rr,kr)),hs}function Ho(){var Dt=ys.getBoundingClientRect(),Wt="offset"+["Width","Height"][_t.ort];return _t.ort===0?Dt.width||ys[Wt]:Dt.height||ys[Wt]}function bo(Dt,Wt,rr,kr){var fn=function(Jn){var Mn=$l(Jn,kr.pageOffset,kr.target||Wt);if(!Mn||Il()&&!kr.doNotReject||pt(jn,_t.cssClasses.tap)&&!kr.doNotReject||Dt===en.start&&Mn.buttons!==void 0&&Mn.buttons>1||kr.hover&&Mn.buttons)return!1;zn||Mn.preventDefault(),Mn.calcPoint=Mn.points[_t.ort],rr(Mn,kr)},_n=[];return Dt.split(" ").forEach(function(Jn){Wt.addEventListener(Jn,fn,zn?{passive:!0}:!1),_n.push([Jn,fn])}),_n}function $l(Dt,Wt,rr){var kr=Dt.type.indexOf("touch")===0,fn=Dt.type.indexOf("mouse")===0,_n=Dt.type.indexOf("pointer")===0,Jn=0,Mn=0;if(Dt.type.indexOf("MSPointer")===0&&(_n=!0),Dt.type==="mousedown"&&!Dt.buttons&&!Dt.touches)return!1;if(kr){var $s=function(Gs){var Ts=Gs.target;return Ts===rr||rr.contains(Ts)||Dt.composed&&Dt.composedPath().shift()===rr};if(Dt.type==="touchstart"){var Ds=Array.prototype.filter.call(Dt.touches,$s);if(Ds.length>1)return!1;Jn=Ds[0].pageX,Mn=Ds[0].pageY}else{var Us=Array.prototype.find.call(Dt.changedTouches,$s);if(!Us)return!1;Jn=Us.pageX,Mn=Us.pageY}}return Wt=Wt||gt(Jo),(fn||_n)&&(Jn=Dt.clientX+Wt.x,Mn=Dt.clientY+Wt.y),Dt.pageOffset=Wt,Dt.points=[Jn,Mn],Dt.cursor=fn||_n,Dt}function Zl(Dt){var Wt=Dt-et(ys,_t.ort),rr=Wt*100/Ho();return rr=it(rr),_t.dir?100-rr:rr}function bu(Dt){var Wt=100,rr=!1;return Bn.forEach(function(kr,fn){if(!ko(fn)){var _n=Ps[fn],Jn=Math.abs(_n-Dt),Mn=Jn===100&&Wt===100,$s=Jn<Wt,Ds=Jn<=Wt&&Dt>_n;($s||Ds||Mn)&&(rr=fn,Wt=Jn)}}),rr}function ba(Dt,Wt){Dt.type==="mouseout"&&Dt.target.nodeName==="HTML"&&Dt.relatedTarget===null&&Fo(Dt,Wt)}function go(Dt,Wt){if(navigator.appVersion.indexOf("MSIE 9")===-1&&Dt.buttons===0&&Wt.buttonsProperty!==0)return Fo(Dt,Wt);var rr=(_t.dir?-1:1)*(Dt.calcPoint-Wt.startCalcPoint),kr=rr*100/Wt.baseSize;Wo(rr>0,kr,Wt.locations,Wt.handleNumbers,Wt.connect)}function Fo(Dt,Wt){Wt.handle&&(dt(Wt.handle,_t.cssClasses.active),wo-=1),Wt.listeners.forEach(function(rr){na.removeEventListener(rr[0],rr[1])}),wo===0&&(dt(jn,_t.cssClasses.drag),$a(),Dt.cursor&&(js.style.cursor="",js.removeEventListener("selectstart",_))),_t.events.smoothSteps&&(Wt.handleNumbers.forEach(function(rr){Ms(rr,Ps[rr],!0,!0,!1,!1)}),Wt.handleNumbers.forEach(function(rr){_s("update",rr)})),Wt.handleNumbers.forEach(function(rr){_s("change",rr),_s("set",rr),_s("end",rr)})}function xo(Dt,Wt){if(!Wt.handleNumbers.some(ko)){var rr;if(Wt.handleNumbers.length===1){var kr=Bn[Wt.handleNumbers[0]];rr=kr.children[0],wo+=1,ft(rr,_t.cssClasses.active)}Dt.stopPropagation();var fn=[],_n=bo(en.move,na,go,{target:Dt.target,handle:rr,connect:Wt.connect,listeners:fn,startCalcPoint:Dt.calcPoint,baseSize:Ho(),pageOffset:Dt.pageOffset,handleNumbers:Wt.handleNumbers,buttonsProperty:Dt.buttons,locations:Ps.slice()}),Jn=bo(en.end,na,Fo,{target:Dt.target,handle:rr,listeners:fn,doNotReject:!0,handleNumbers:Wt.handleNumbers}),Mn=bo("mouseout",na,ba,{target:Dt.target,handle:rr,listeners:fn,doNotReject:!0,handleNumbers:Wt.handleNumbers});fn.push.apply(fn,_n.concat(Jn,Mn)),Dt.cursor&&(js.style.cursor=getComputedStyle(Dt.target).cursor,Bn.length>1&&ft(jn,_t.cssClasses.drag),js.addEventListener("selectstart",_,!1)),Wt.handleNumbers.forEach(function($s){_s("start",$s)})}}function Ao(Dt){Dt.stopPropagation();var Wt=Zl(Dt.calcPoint),rr=bu(Wt);rr!==!1&&(_t.events.snap||rt(jn,_t.cssClasses.tap,_t.animationDuration),Ms(rr,Wt,!0,!0),$a(),_s("slide",rr,!0),_s("update",rr,!0),_t.events.snap?xo(Dt,{handleNumbers:[rr]}):(_s("change",rr,!0),_s("set",rr,!0)))}function jo(Dt){var Wt=Zl(Dt.calcPoint),rr=us.getStep(Wt),kr=us.fromStepping(rr);Object.keys(Co).forEach(function(fn){fn.split(".")[0]==="hover"&&Co[fn].forEach(function(_n){_n.call(Sn,kr)})})}function So(Dt,Wt){if(Il()||ko(Wt))return!1;var rr=["Left","Right"],kr=["Down","Up"],fn=["PageDown","PageUp"],_n=["Home","End"];_t.dir&&!_t.ort?rr.reverse():_t.ort&&!_t.dir&&(kr.reverse(),fn.reverse());var Jn=Dt.key.replace("Arrow",""),Mn=Jn===fn[0],$s=Jn===fn[1],Ds=Jn===kr[0]||Jn===rr[0]||Mn,Us=Jn===kr[1]||Jn===rr[1]||$s,Gs=Jn===_n[0],Ts=Jn===_n[1];if(!Ds&&!Us&&!Gs&&!Ts)return!0;Dt.preventDefault();var Ys;if(Us||Ds){var zs=Ds?0:1,Zs=Rt(Wt),Qs=Zs[zs];if(Qs===null)return!1;Qs===!1&&(Qs=us.getDefaultStep(Ps[Wt],Ds,_t.keyboardDefaultStep)),$s||Mn?Qs*=_t.keyboardPageMultiplier:Qs*=_t.keyboardMultiplier,Qs=Math.max(Qs,1e-7),Qs=(Ds?-1:1)*Qs,Ys=Hs[Wt]+Qs}else Ts?Ys=_t.spectrum.xVal[_t.spectrum.xVal.length-1]:Ys=_t.spectrum.xVal[0];return Ms(Wt,us.toStepping(Ys),!0,!0),_s("slide",Wt),_s("update",Wt),_s("change",Wt),_s("set",Wt),!1}function Bs(Dt){Dt.fixed||Bn.forEach(function(Wt,rr){bo(en.start,Wt.children[0],xo,{handleNumbers:[rr]})}),Dt.tap&&bo(en.start,ys,Ao,{}),Dt.hover&&bo(en.move,ys,jo,{hover:!0}),Dt.drag&&cs.forEach(function(Wt,rr){if(!(Wt===!1||rr===0||rr===cs.length-1)){var kr=Bn[rr-1],fn=Bn[rr],_n=[Wt],Jn=[kr,fn],Mn=[rr-1,rr];ft(Wt,_t.cssClasses.draggable),Dt.fixed&&(_n.push(kr.children[0]),_n.push(fn.children[0])),Dt.dragAll&&(Jn=Bn,Mn=Ns),_n.forEach(function($s){bo(en.start,$s,xo,{handles:Jn,handleNumbers:Mn,connect:Wt})})}})}function Do(Dt,Wt){Co[Dt]=Co[Dt]||[],Co[Dt].push(Wt),Dt.split(".")[0]==="update"&&Bn.forEach(function(rr,kr){_s("update",kr)})}function Al(Dt){return Dt===cr.aria||Dt===cr.tooltips}function $o(Dt){var Wt=Dt&&Dt.split(".")[0],rr=Wt?Dt.substring(Wt.length):Dt;Object.keys(Co).forEach(function(kr){var fn=kr.split(".")[0],_n=kr.substring(fn.length);(!Wt||Wt===fn)&&(!rr||rr===_n)&&(!Al(_n)||rr===_n)&&delete Co[kr]})}function _s(Dt,Wt,rr){Object.keys(Co).forEach(function(kr){var fn=kr.split(".")[0];Dt===fn&&Co[kr].forEach(function(_n){_n.call(Sn,Hs.map(_t.format.to),Wt,Hs.slice(),rr||!1,Ps.slice(),Sn)})})}function Io(Dt,Wt,rr,kr,fn,_n,Jn){var Mn;return Bn.length>1&&!_t.events.unconstrained&&(kr&&Wt>0&&(Mn=us.getAbsoluteDistance(Dt[Wt-1],_t.margin,!1),rr=Math.max(rr,Mn)),fn&&Wt<Bn.length-1&&(Mn=us.getAbsoluteDistance(Dt[Wt+1],_t.margin,!0),rr=Math.min(rr,Mn))),Bn.length>1&&_t.limit&&(kr&&Wt>0&&(Mn=us.getAbsoluteDistance(Dt[Wt-1],_t.limit,!1),rr=Math.min(rr,Mn)),fn&&Wt<Bn.length-1&&(Mn=us.getAbsoluteDistance(Dt[Wt+1],_t.limit,!0),rr=Math.max(rr,Mn))),_t.padding&&(Wt===0&&(Mn=us.getAbsoluteDistance(0,_t.padding[0],!1),rr=Math.max(rr,Mn)),Wt===Bn.length-1&&(Mn=us.getAbsoluteDistance(100,_t.padding[1],!0),rr=Math.min(rr,Mn))),Jn||(rr=us.getStep(rr)),rr=it(rr),rr===Dt[Wt]&&!_n?!1:rr}function xa(Dt,Wt){var rr=_t.ort;return(rr?Wt:Dt)+", "+(rr?Dt:Wt)}function Wo(Dt,Wt,rr,kr,fn){var _n=rr.slice(),Jn=kr[0],Mn=_t.events.smoothSteps,$s=[!Dt,Dt],Ds=[Dt,!Dt];kr=kr.slice(),Dt&&kr.reverse(),kr.length>1?kr.forEach(function(Gs,Ts){var Ys=Io(_n,Gs,_n[Gs]+Wt,$s[Ts],Ds[Ts],!1,Mn);Ys===!1?Wt=0:(Wt=Ys-_n[Gs],_n[Gs]=Ys)}):$s=Ds=[!0];var Us=!1;kr.forEach(function(Gs,Ts){Us=Ms(Gs,rr[Gs]+Wt,$s[Ts],Ds[Ts],!1,Mn)||Us}),Us&&(kr.forEach(function(Gs){_s("update",Gs),_s("slide",Gs)}),fn!=null&&_s("drag",Jn))}function Bo(Dt,Wt){return _t.dir?100-Dt-Wt:Dt}function Bl(Dt,Wt){Ps[Dt]=Wt,Hs[Dt]=us.fromStepping(Wt);var rr=Bo(Wt,0)-_u,kr="translate("+xa(rr+"%","0")+")";Bn[Dt].style[_t.transformRule]=kr,Xo(Dt),Xo(Dt+1)}function $a(){Ns.forEach(function(Dt){var Wt=Ps[Dt]>50?-1:1,rr=3+(Bn.length+Wt*Dt);Bn[Dt].style.zIndex=String(rr)})}function Ms(Dt,Wt,rr,kr,fn,_n){return fn||(Wt=Io(Ps,Dt,Wt,rr,kr,!1,_n)),Wt===!1?!1:(Bl(Dt,Wt),!0)}function Xo(Dt){if(cs[Dt]){var Wt=0,rr=100;Dt!==0&&(Wt=Ps[Dt-1]),Dt!==cs.length-1&&(rr=Ps[Dt]);var kr=rr-Wt,fn="translate("+xa(Bo(Wt,kr)+"%","0")+")",_n="scale("+xa(kr/100,"1")+")";cs[Dt].style[_t.transformRule]=fn+" "+_n}}function Oo(Dt,Wt){return Dt===null||Dt===!1||Dt===void 0||(typeof Dt=="number"&&(Dt=String(Dt)),Dt=_t.format.from(Dt),Dt!==!1&&(Dt=us.toStepping(Dt)),Dt===!1||isNaN(Dt))?Ps[Wt]:Dt}function Yo(Dt,Wt,rr){var kr=ot(Dt),fn=Ps[0]===void 0;Wt=Wt===void 0?!0:Wt,_t.animate&&!fn&&rt(jn,_t.cssClasses.tap,_t.animationDuration),Ns.forEach(function(Mn){Ms(Mn,Oo(kr[Mn],Mn),!0,!1,rr)});var _n=Ns.length===1?0:1;if(fn&&us.hasNoSize()&&(rr=!0,Ps[0]=0,Ns.length>1)){var Jn=100/(Ns.length-1);Ns.forEach(function(Mn){Ps[Mn]=Mn*Jn})}for(;_n<Ns.length;++_n)Ns.forEach(function(Mn){Ms(Mn,Ps[Mn],!0,!0,rr)});$a(),Ns.forEach(function(Mn){_s("update",Mn),kr[Mn]!==null&&Wt&&_s("set",Mn)})}function zl(Dt){Yo(_t.start,Dt)}function qo(Dt,Wt,rr,kr){if(Dt=Number(Dt),!(Dt>=0&&Dt<Ns.length))throw new Error("noUiSlider: invalid handle number, got: "+Dt);Ms(Dt,Oo(Wt,Dt),!0,!0,kr),_s("update",Dt),rr&&_s("set",Dt)}function zo(Dt){if(Dt===void 0&&(Dt=!1),Dt)return Hs.length===1?Hs[0]:Hs.slice(0);var Wt=Hs.map(_t.format.to);return Wt.length===1?Wt[0]:Wt}function Et(){for($o(cr.aria),$o(cr.tooltips),Object.keys(_t.cssClasses).forEach(function(Dt){dt(jn,_t.cssClasses[Dt])});jn.firstChild;)jn.removeChild(jn.firstChild);delete jn.noUiSlider}function Rt(Dt){var Wt=Ps[Dt],rr=us.getNearbySteps(Wt),kr=Hs[Dt],fn=rr.thisStep.step,_n=null;if(_t.snap)return[kr-rr.stepBefore.startValue||null,rr.stepAfter.startValue-kr||null];fn!==!1&&kr+fn>rr.stepAfter.startValue&&(fn=rr.stepAfter.startValue-kr),kr>rr.thisStep.startValue?_n=rr.thisStep.step:rr.stepBefore.step===!1?_n=!1:_n=kr-rr.stepBefore.highestStep,Wt===100?fn=null:Wt===0&&(_n=null);var Jn=us.countStepDecimals();return fn!==null&&fn!==!1&&(fn=Number(fn.toFixed(Jn))),_n!==null&&_n!==!1&&(_n=Number(_n.toFixed(Jn))),[_n,fn]}function Ft(){return Ns.map(Rt)}function or(Dt,Wt){var rr=zo(),kr=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];kr.forEach(function(_n){Dt[_n]!==void 0&&(Ir[_n]=Dt[_n])});var fn=bt(Ir);kr.forEach(function(_n){Dt[_n]!==void 0&&(_t[_n]=fn[_n])}),us=fn.spectrum,_t.margin=fn.margin,_t.limit=fn.limit,_t.padding=fn.padding,_t.pips?Eo(_t.pips):Mo(),_t.tooltips?ks():_a(),Ps=[],Yo(g(Dt.start)?Dt.start:rr,Wt)}function Gr(){ys=Eu(jn),wu(_t.connect,ys),Bs(_t.events),Yo(_t.start),_t.pips&&Eo(_t.pips),_t.tooltips&&ks(),Ol()}Gr();var Sn={destroy:Et,steps:Ft,on:Do,off:$o,get:zo,set:Yo,setHandle:qo,reset:zl,__moveHandles:function(Dt,Wt,rr){Wo(Dt,Wt,Ps,rr)},options:Ir,updateOptions:or,target:jn,removePips:Mo,removeTooltips:_a,getPositions:function(){return Ps.slice()},getTooltips:function(){return Ss},getOrigins:function(){return Bn},pips:Eo};return Sn}function xs(Ot,_t){if(!Ot||!Ot.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+Ot);if(Ot.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var Ir=bt(_t),en=gs(Ot,Ir,_t);return Ot.noUiSlider=en,en}var Ls={__spectrum:vr,cssClasses:Hr,create:xs};s.create=xs,s.cssClasses=Hr,s.default=Ls,Object.defineProperty(s,"__esModule",{value:!0})})})(nouislider,nouisliderExports);const noUiSlider=getDefaultExportFromCjs(nouisliderExports);class SettingsDialog extends BaseDialog{constructor(e,s){super(e,s)}init(e){this.controls=[];for(let s of e){let o=createEl("div",{styles:{}},this.dialog);if(s.type!=="button"&&createEl("label",{text:s.label},o),s.info&&this.addInfoIcon(s.info,o),!this[s.type]){console.warn(`SettingsDialog doesn't have a method '${s.type}'`);continue}this.controls[s.label]=this[s.type](s,o)}}initLilGui(e){const s=new lgui({container:this.dialog});for(let o of e)switch(o.type){case"dropdown":s.add(o,"current_value",o.values[0].map(a=>a[o.values[1]])).name(o.label).onChange(o.func);break;case"check":o.current_value===void 0&&(o.current_value=!1),s.add(o,"current_value").name(o.label).onChange(o.func);break;case"button":s.add(o,"func").name(o.label);break;case"slider":s.add(o,"current_value",o.min,o.max).name(o.label).onChange(o.func);break;case"spinner":s.add(o,"current_value",o.min,o.max).name(o.label).onChange(o.func);break;case"radiobuttons":s.add(o,"current_value",o.choices).name(o.label).onChange(o.func);break;case"text":case"textbox":default:s.add(o,"current_value").name(o.label).onChange(o.func)}}folder(e,s){}spinner(e,s){let o=createEl("input",{type:"number",value:e.current_value,max:e.max||null,min:e.min||0,step:e.step||1},s);o.addEventListener("change",a=>{e.func(parseInt(o.value))})}radiobuttons(e,s){const o=createEl("div",{classes:["ciview-radio-group"]},s);for(let a of e.choices){createEl("span",{text:a[0]},o);const d=createEl("input",{type:"radio",name:e.label,value:a[1]},o);d.checked=e.current_value===a[1],d.addEventListener("click",g=>{e.func(g.currentTarget.value)})}}button(e,s){s.style.textAlign="center",createEl("button",{classes:["ciview-button"],text:e.label},s).addEventListener("click",o=>{e.func()})}slider(e,s){const o=createEl("div",{},s);noUiSlider.create(o,{start:[e.current_value||0],range:{min:[e.min||0],max:[e.max||1]},step:e.step||null,tooltips:!0,documentElement:e.doc||this.config.doc});const a=d=>{e.func(parseFloat(d[0]))};return o.noUiSlider.on("end",a),e.continuous&&(console.log("adding update listener for ",e.label),o.noUiSlider.on("update",a)),o}check(e,s){const o=createEl("input",{type:"checkbox"},s);o.checked=e.current_value,o.addEventListener("click",a=>{e.func(o.checked)})}multidropdown(e,s){const o=createEl("select",{multiple:!0,styles:{maxWidth:"200px",height:"100px"}});createEl("br",{},s);for(let d of e.values[0]){const g=d[e.values[2]],_={text:d[e.values[1]],value:g};e.current_value.indexOf(g)!==-1&&(_.selected=!0),createEl("option",_,o)}return s.append(o),createEl("br",{},s),createEl("button",{classes:["ciview-button-sm"],text:"Change"},s).addEventListener("click",d=>{e.func(Array.from(o.selectedOptions).map(g=>g.value))}),o}dropdown(e,s){const o=createEl("select",{styles:{maxWidth:"200px"}});for(let a of e.values[0])createEl("option",{text:a[e.values[1]],value:a[e.values[2]]},o);return s.append(o),o.value=e.current_value,o.addEventListener("change",a=>{e.func(o.value),o.title=o.value,e.onchange&&e.onchange(this.controls,o.value)}),o}doubleslider(e,s){const o=createEl("div",{styles:{}},s);noUiSlider.create(o,{tooltips:!0,start:[e.current_value[0],e.current_value[1]],range:{min:[e.min],max:[e.max]},documentElement:e.doc});const a=d=>{e.func(parseFloat(d[0]),parseFloat(d[1]))};return o.noUiSlider.on("end",a),e.continuous&&o.noUiSlider.on("update",a),o}text(e,s){const o=createEl("input",{value:e.current_value,size:10,styles:{flex:1}},s);o.addEventListener("keyup",a=>{if(e.only_update_on_enter){a.key==="Enter"&&e.func(o.value);return}e.func(o.value)})}textbox(e,s){const o=createEl("textarea",{styles:{width:"100%"}},s);o.value=e.current_value,o.addEventListener("input",a=>{e.func(o.value)}),o.addEventListener("blur",a=>{e.func(o.value)})}addInfoIcon(e,s){const o=createEl("span",{"aria-label":e.text,role:"tooltip","data-microtip-size":"medium","data-microtip-position":e.position,styles:{marginLeft:"5px"},classes:["ttt"]},s);return createEl("i",{classes:["fas","fa-info"]},o),o}}class BaseChart{constructor(e,s,o){Lo(this,"getQunatile");o.color_by&&o.color_by.column&&(o.color_by=o.color_by.column.field),this.config=JSON.parse(JSON.stringify(o)),this.config.id||(this.config.id=getRandomString()),this.__doc__=document,this.dataStore=e,this.listeners={},this.div=typeof s=="string"?document.getElementById(s):s,this.div.classList.add("ciview-chart-panel"),this.titleBar=createEl("div",{classes:["ciview-chart-titlebar"]}),this.title=createEl("div",{classes:["ciview-chart-title"],text:o.title},this.titleBar),this.menuSpace=createEl("div",{classes:["ciview-chart-menuspace"]},this.titleBar),this.contentDiv=createEl("div",{classes:["ciview-chart-content"]}),o.title_color&&(this.titleBar.style.backgroundColor=o.title_color),this.resetButton=this.addMenuIcon("fas fa-sync","remove filter"),this.resetButton.style.display="none",this.resetButton.addEventListener("click",()=>{this.removeFilter(),this.resetButton.style.display="none"}),this.dataStore.addListener(this.config.id,(a,d)=>{a==="filtered"?this.onDataFiltered(d):a==="data_changed"?this.onDataChanged(d):a==="data_added"?this.onDataAdded(d):a==="data_highlighted"&&this.onDataHighlighted&&this.onDataHighlighted(d)}),this.contextMenu=new ContextMenu(a=>this.getContextMenu(a)),this.addMenuIcon("fas fa-bars","more").addEventListener("click",a=>this.contextMenu.show(a)),this.addMenuIcon("fas fa-cog","settings").addEventListener("click",a=>this._openSettingsDialog(a)),this.legendIcon=this.addMenuIcon("fas fa-info",o.legend||"No description",{size:"medium"}),this.div.append(this.titleBar),this.div.append(this.contentDiv),this.listeners={},this._setDimensions()}_getContentDimensions(){return{top:5,left:5,height:this.height,width:this.width-5}}getFilter(){}setFilter(){}addListener(e,s){this.listeners[e]=s}removeListener(e){delete this.listeners[e]}_callListeners(e,s){for(let o in this.listeners)this.listeners[o](e,s)}addMenuIcon(e,s,o={}){const a=createEl("span",{"aria-label":s,"data-microtip-color":"red",role:"tooltip","data-microtip-size":o.size||"small","data-microtip-position":o.position||"bottom-left",styles:{margin:"0px 1px"}},this.menuSpace);return createEl("i",{classes:["ciview-chart-icon"].concat(e.split(" "))},a),o.func&&a.addEventListener("click",d=>o.func(d)),a}removeFilter(){}onDataFiltered(e){}onDataChanged(e){const s=e.columns;if(!e.hasFiltered){let o=this.config.param,a=!1;typeof this.config.param=="string"&&(o=[this.config.param]);for(let d of o)if(s.indexOf(d)!==-1){a=!0;break}a&&this.onDataFiltered()}s.indexOf(this.config.color_by)!==-1&&this.colorByColumn(this.config.color_by)}getColorLegend(){const e={overideValues:{colorLogScale:this.config.log_color_scale}};return this._addTrimmedColor(this.config.color_by,e),this.dataStore.getColorLegend(this.config.color_by,e)}_addTrimmedColor(e,s){const o=this.config.trim_color_scale,a=this.dataStore.columnIndex[e];o&&o!=="none"&&a.quantiles&&a.quantiles!=="NA"&&(s.overideValues.min=a.quantiles[o][0],s.overideValues.max=a.quantiles[o][1])}setColorLegend(){if(!this.config.color_legend.display){this.legend&&(this.config.color_legend.pos=[this.legend.offsetLeft,this.legend.offsetTop],this.legend.remove(),delete this.legend);return}const e=this._getContentDimensions();let s=0,o=0;if(this.legend)o=this.legend.style.left,s=this.legend.style.top,this.legend.remove();else{const a=this.config.color_legend;a.pos||(a.pos=[e.left,e.top]),o=a.pos[0]+"px",s=a.pos[1]+"px"}if(this.legend=this.getColorLegend(),!this.legend){console.warn("no color legend");return}this.contentDiv.append(this.legend),this.legend.style.left=o,this.legend.style.top=s,this.legend.__doc__=this.__doc__}getColorFunction(e,s){this.config.color_by=e;const o={asArray:s,overideValues:{colorLogScale:this.config.log_color_scale}};this._addTrimmedColor(e,o);const a=this.dataStore.getColorFunction(e,o);return this.config.color_legend||(this.config.color_legend={display:!0}),this.setColorLegend(),a}onColumnRemoved(e){let s=this.config.param,o=!1;typeof this.config.param=="string"&&(s=[this.config.param]);for(let a of s)if(e===a){o=!0;break}return o?(this.remove(!1),!0):(this.colorByColumn&&this.config.color_by===e&&(delete this.config.color_by,this.colorByDefault()),!1)}onDataAdded(e){this.onDataFiltered()}addToolTip(){this._tooltip=createEl("div",{classes:["ciview-tooltip"],stlyles:{display:"none",position:"absolute"}},this.__doc__.body)}showToolTip(e,s){this._tooltip.innerHTML=s,this._tooltip.style.display="inline-block",this._tooltip.style.left=3+e.clientX+"px",this._tooltip.style.top=3+e.clientY+"px"}hideToolTip(){this._tooltip.style.display="none"}remove(){this.titleBar.remove(),this.contentDiv.remove(),this.dataStore.removeListener(this.config.id),this._tooltip&&this._tooltip.remove()}getSettings(){const e=this.config;let s=[{type:"text",label:"Chart Name",current_value:e.title,func:a=>{this.setTitle(a)}}];const o=this.getColorOptions();if(o.colorby){const a=o.colorby==="all"?["int32","text","integer","double"]:o.colorby,d=this.dataStore.getColumnList(a);d.push({name:"None",field:"_none"}),s.push({label:"Color By",type:"dropdown",values:[d,"name","field"],current_value:e.color_by||"_none",func:g=>{g==="_none"?(delete e.color_by,this.colorByDefault()):(e.color_by=g,this.colorByColumn(g))}}),o.color_overlay!==void 0&&s.push({label:"Color Overlay",type:"slider",current_value:e.color_overlay,func:g=>{e.color_overlay=g,this.colorByColumn(e.color_by)}}),s.push({label:"Show Color Legend",type:"check",current_value:e.color_legend?e.color_legend.display:!0,func:g=>{e.color_by&&(e.color_legend.display=g,this.setColorLegend())}}),s.push({label:"SymLog Color Scale",type:"check",current_value:e.log_color_scale,func:g=>{e.log_color_scale=g,e.color_by&&this.colorByColumn(e.color_by)}}),s.push({type:"radiobuttons",label:"Trim Color Scale to Percentile",current_value:e.trim_color_scale||"none",choices:[["No Trim","none"],["0.001","0.001"],["0.01","0.01"],["0.05","0.05"]],func:g=>{e.trim_color_scale=g,e.color_by&&this.colorByColumn(e.color_by)}})}return s}_addUnpinIcon(){this.unpinIcon=this.addMenuIcon("fas fa-thumbtack","unpin chart"),this.unpinIcon.addEventListener("click",e=>{this.unpinIcon.remove(),this.unpinChart()})}_openSettingsDialog(e){this.settingsDialog||(this.settingsDialog=new SettingsDialog({maxHeight:400,doc:this.__doc__||document,width:300,title:"Settings",position:[e.pageX,e.pageY],onclose:()=>this.settingsDialog=null},this.getSettings()))}getContextMenu(e){let s=[];return this.getImage&&(s=s.concat([{text:"create svg image",icon:"far fa-image",func:()=>this.downloadImage("svg")},{text:"create png image",icon:"far fa-image",func:()=>this.downloadImage("png")}])),this.pinChart&&!this.isPinned&&s.push({text:"pin chart",icon:"fas fa-thumbtack",func:()=>{this.pinChart(),this._addUnpinIcon()}}),this.addToContextMenu&&(s=s.concat(this.addToContextMenu())),s}getDiv(){return this.div}changeBaseDocument(e){this.contextMenu.__doc__=e,this.__doc__=e,this.settingsDialog&&this.settingsDialog.close(),this.legend&&(this.legend.__doc__=e),this._tooltip&&(this._tooltip.remove(),this.addToolTip())}_setConfigValue(e,s,o){return e[s]===void 0&&(e[s]=o),e[s]}drawChart(){}getConfig(){return this.legend&&(this.config.color_legend={display:!0,pos:[this.legend.offsetLeft,this.legend.offsetTop]}),JSON.parse(JSON.stringify(this.config))}getColorOptions(){return{}}setSize(e,s){e&&(this.div.style.height=s+"px",this.div.style.width=e+"px"),this._setDimensions()}_setDimensions(){const e=this.div.getBoundingClientRect(),s=Math.round(e.height),o=Math.round(e.width);this.config.size=[o,s];const a=this.contentDiv.getBoundingClientRect();this.height=Math.round(a.height),this.width=o}downloadImage(e){const s=this.contentDiv.style.color;this.contentDiv.style.color="black",this.getImage(o=>{let a=document.createElement("a"),d=this.config.title||"image";if(a.download=d+"."+e,e==="svg")a.href="data:image/svg+xml,"+encodeURIComponent(o);else{let g=o.toDataURL("image/png");g=g.replace(/^data:image\/png/,"data:application/octet-stream"),a.href=g}a.click(),a.remove(),this.contentDiv.style.color=s},e)}setTitle(e){this.title.textContent=e,this.config.title=e}getImageFromSVG(e,s){var o=e.cloneNode(!0);copyStylesInline(o,e);var a=document.createElement("canvas");o.style.top="0px",a.width=e.width.baseVal.value,a.height=e.height.baseVal.value;var d=a.getContext("2d");d.clearRect(0,0,a.width,a.height);var g=new XMLSerializer().serializeToString(o),_=window.URL||window.webkitURL||window,j=new Image,_e=new Blob([g],{type:"image/svg+xml;charset=utf-8"}),et=_.createObjectURL(_e);j.src=et,j.onload=function(){d.drawImage(j,0,0),s(a,d)}}}BaseChart.types={};function copyStylesInline(i,e){for(var s=["svg","g"],o=0;o<i.childNodes.length;o++){var a=i.childNodes[o];if(s.indexOf(a.tagName)!=-1){copyStylesInline(a,e.childNodes[o]);continue}var d=e.childNodes[o].currentStyle||window.getComputedStyle(e.childNodes[o]);if(!(d=="undefined"||d==null))for(var g=0;g<d.length;g++)a.style.setProperty(d[g],d.getPropertyValue(d[g]))}}class PopOutWindow{constructor(e,s,o={}){let a=this;const d=document.documentElement.className;let g=URL.createObjectURL(new Blob([],{type:"text/html"}));g=o.url||g;const _=o;this.window=window.open(g,"win"+new Date().getTime(),`width=${_.width||800},
            height=${_.height||400},
            screenX=${_.screenX||200},
            screenY=${_.screenY||200}
            ;modal=yes`),this.window.addEventListener("load",function(){let j=a.window.document;j.documentElement.className=d,this.setTimeout(()=>{j.documentElement.className=d},1e3),j.write("<head>");let _e=document.head.innerHTML;if(j.write(_e),_.stylesheets)for(let tt of _.stylesheets)j.write(`<link rel="stylesheet" type="text/css" href="${tt}">`);j.write("</head>"),j.write("<body><body>"),_.title&&(j.title=_.title),e&&e(j,a.getDimensions()),a.onclose=s,a.window.addEventListener("beforeunload",function(tt){a.closing(j)}),_.stayInFront&&(a.focusListener=()=>{a.window.focus()},document.body.addEventListener("mousedown",a.focusListener));const et=_.onresize;et&&a.window.addEventListener("resize",function(tt){clearTimeout(a.resizeTO),a.resizeTO=setTimeout(()=>{et(j,a.getDimensions())},200)})})}getDimensions(){const e=this.window;return{width:e.innerWidth-10,height:e.innerHeight-10}}closing(e){this.onclose&&this.onclose(e),this.focusListener&&document.body.removeEventListener("mousedown",this.focusListener)}close(){this.window.close()}}class Dimension{constructor(e){this.filterBuffer=new SharedArrayBuffer(e.size),this.parent=e,this.filterArray=new Uint8Array(this.filterBuffer),this.filterArguments=null,this.filterIndexes=null,this.filterMethod=null}removeFilter(e=!0){if(!this.filterMethod)return;const s=this.parent.filterArray,o=this.filterArray,a=this.parent,d=this.parent.size;delete this.filterArguments,delete this.filterColumns,delete this.filterMethod;for(let g=0;g<d;g++)o[g]===1&&(--s[g]==0&&a.filterSize++,o[g]=0);if(this.bgfArray)for(let g=0;g<d;g++)this.bgfArray[g]===0&&(--s[g]===0&&a.filterSize++,o[g]=2);e&&this.parent._callListeners("filtered",this)}getLocalFilter(){return this.filterArray}filterOnIndex(e){const s=this.parent.filterArray,o=this.parent.size,a=this.filterArray,d=this.parent;for(let g=0;g<o;g++)e.has(g)?(a[g]===1&&--s[g]===0&&d.filterSize++,a[g]=0):(a[g]===0&&++s[g]===1&&d.filterSize--,a[g]=1)}filter(e,s,o,a=!0){const d=performance.now();if(this.filterColumns=s,this.filterArguments=o,this.filterMethod=e,this[e](o,s),this.bgfArray){const g=this.parent.filterArray,_=this.parent.size,j=this.filterArray,_e=this.parent;for(let et=0;et<_;et++)this.bgfArray[et]===0&&(++g[et]===1&&_e.filterSize--,j[et]=2)}a&&this.parent._callListeners("filtered",this),console.log(`method${e}: ${performance.now()-d}`)}reFilterOnDataChanged(e){if(this.filterMethod&&this.filterColumns){for(let s of this.filterColumns)if(typeof s=="string"&&e.indexOf(s)!==-1)return this.filter(this.filterMethod,this.filterColumns,this.filterArguments,!1),!0}return!1}updateSize(){let e=new SharedArrayBuffer(this.parent.size),s=new Uint8Array(e);s.set(this.filterArray),this.filterBuffer=e,this.filterArray=s,this.bgfArray&&(this.bgfData,this.setBackgroundFilter(b.column.b.cat)),this.filterMethod&&this.filter(this.filterMethod,this.filterColumns,this.filterArguments,!1)}setBackgroundFilter(e,s){const o=this.parent.columnIndex[e],a=o.values.indexOf(s),d=o.data;this.bgfData={column:e,cat:s},this.bgfArray=new Uint8Array(this.parent.size);for(let g=0;g<this.parent.size;g++)d[g]===a?this.bgfArray[g]=1:this.filterArray[g]=2}clearBackGroundFilter(){this.bgfArray=null,this.bgfData=null}destroy(e=!0){this.removeFilter(e),this.filterBuffer=null,this.localFilter=null,this.parent.dimensions.splice(this.parent.dimensions.indexOf(this),1)}}Dimension.types={base_dimension:Dimension};class CategoryDimension extends Dimension{constructor(e){super(e),this.worker=new Worker(new URL(""+new URL("catWorker-68e8ef4d.js",import.meta.url).href,self.location))}filterCategories(e,s){const o=e,a=this.parent,d=a.columnIndex[s[0]],g=d.data,_=a.filterArray,j=this.filterArray,_e=d.values,et=new Set,tt=this.parent.size;if(typeof o=="string"){const rt=_e.indexOf(o);if(d.datatype==="multitext"){const it=d.stringLength;for(let ot=0;ot<tt;ot++){const ct=ot*it;let ft=!1;for(let dt=ct;dt<ct+it;dt++)if(g[dt]===rt){ft=!0;break}ft?(j[ot]===1&&--_[ot]===0&&a.filterSize++,j[ot]=0):(j[ot]===0&&++_[ot]===1&&a.filterSize--,j[ot]=1)}}else for(let it=0;it<tt;it++)g[it]===rt?(j[it]===1&&--_[it]===0&&a.filterSize++,j[it]=0):(j[it]===0&&++_[it]===1&&a.filterSize--,j[it]=1)}else{for(let rt of o)et.add(_e.indexOf(rt));if(d.datatype==="multitext"){const rt=d.stringLength;let it=o.operand==="and";for(let ot=0;ot<tt;ot++){const ct=ot*rt;let ft=!1,dt=0;for(let pt=ct;pt<ct+rt&&g[pt]!==65535;pt++)if(et.has(g[pt]))if(it){if(dt++,dt===o.length){ft=!0;break}}else{ft=!0;break}ft?(j[ot]===1&&--_[ot]===0&&a.filterSize++,j[ot]=0):(j[ot]===0&&++_[ot]===1&&a.filterSize--,j[ot]=1)}}else for(let rt=0;rt<tt;rt++)et.has(g[rt])?(j[rt]===1&&--_[rt]===0&&a.filterSize++,j[rt]=0):(j[rt]===0&&++_[rt]===1&&a.filterSize--,j[rt]=1)}}filterMultipleCategories(e,s){const o=this.parent,a=[],d=[];for(let _e=0;_e<s.length;_e++){const et=o.columnIndex[s[_e]];a.push(et.data),d.push(et.values.indexOf(e[_e]))}const g=o.filterArray,_=this.filterArray,j=o.size;for(let _e=0;_e<j;_e++){let et=!0;for(let tt=0;tt<a.length;tt++)if(a[tt][_e]!==d[tt]){et=!1;break}et?(_[_e]===1&&--g[_e]===0&&o.filterSize++,_[_e]=0):(_[_e]===0&&++g[_e]===1&&o.filterSize--,_[_e]=1)}}getSankeyData(e,s,o={}){const a=this.parent.columnIndex[s[0]],d=this.parent.columnIndex[s[1]];o.values=a.values,o.values2=d.values,o.method=o.method||"sankey",o.method==="proportion"&&(o.cats=o.category==null?null:this.parent.columnIndex[s[2]].buffer);const g=performance.now(),_=j=>{console.log(`calc sankey ${a.name} ${d.name} : ${performance.now()-g}`),e(j.data),this.worker.removeEventListener("message",_)};this.worker.addEventListener("message",_),this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,a.buffer,o,d.buffer])}getCategories(e,s,o={}){const a=this.parent.columnIndex[s];o.values=a.values,o.datatype=a.datatype,o.stringLength=a.stringLength,performance.now();const d=g=>{e(g.data),this.worker.removeEventListener("message",d)};this.worker.addEventListener("message",d),this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,a.buffer,o])}destroy(){super.destroy(),this.worker.terminate()}}Dimension.types.category_dimension=CategoryDimension;class RangeDimension extends Dimension{constructor(e,s){super(e,s),this.worker=new Worker(new URL(""+new URL("binWorker-880d69a8.js",import.meta.url).href,self.location))}filterSquare(e,s){let o=null;typeof s[0]!="string"?o=s[0]:o=this.parent.columnIndex[s[0]].data;const a=this.parent.columnIndex[s[1]].data,d=this.parent.filterArray,g=this.parent,_=e.range1,j=e.range2,_e=this.filterArray;for(let et=0;et<this.parent.size;et++){const tt=o[et],rt=a[et];tt<_[0]||tt>_[1]||rt<j[0]||rt>j[1]||isNaN(tt)||isNaN(rt)?(_e[et]===0&&++d[et]===1&&g.filterSize--,_e[et]=1):(_e[et]===1&&--d[et]===0&&g.filterSize++,_e[et]=0)}}filterPoly(e,s){const o=e;let a=Number.MAX_VALUE,d=Number.MAX_VALUE,g=Number.MIN_VALUE,_=Number.MIN_VALUE;for(let ct of o)a=Math.min(a,ct[0]),g=Math.max(g,ct[0]),d=Math.min(d,ct[1]),_=Math.max(_,ct[1]);let j=null;typeof s[0]!="string"?j=s[0]:j=this.parent.columnIndex[s[0]].data;const _e=this.parent.columnIndex[s[1]].data,et=this.parent.filterArray,tt=this.parent,rt=tt.size,it=o,ot=this.filterArray;for(let ct=0;ct<rt;ct++){let ft=j[ct],dt=_e[ct],pt=!1;if(ft<a||ft>g||dt<d||dt>_||isNaN(ft)||isNaN(dt))ot[ct]===0&&++et[ct]===1&&tt.filterSize--,ot[ct]=1;else{for(let gt=0,Ct=it.length-1;gt<it.length;Ct=gt++){let xt=it[gt][0],at=it[gt][1],Bt=it[Ct][0],Ht=it[Ct][1];at>dt!=Ht>dt&&ft<(Bt-xt)*(dt-at)/(Ht-at)+xt&&(pt=!pt)}pt?(ot[ct]===1&&--et[ct]===0&&tt.filterSize++,ot[ct]=0):(ot[ct]===0&&++et[ct]===1&&tt.filterSize--,ot[ct]=1)}}}filterRange(e,s){const o=e.min,a=e.max,d=this.parent.columnIndex[s[0]].data,g=this.parent.filterArray,_=this.filterArray,j=this.parent;for(let _e=0;_e<this.parent.size;_e++){const et=d[_e];et<o||et>a||isNaN(et)?(_[_e]===0&&++g[_e]===1&&j.filterSize--,_[_e]=1):(_[_e]===1&&--g[_e]===0&&j.filterSize++,_[_e]=0)}}getBins(e,s,o={}){const a=this.parent.columnIndex[s];o.bins=o.bins===void 0?10:o.bins,o.min=o.min===void 0?a.minMax[0]:o.min,o.max=o.max===void 0?a.minMax[1]:o.max;const d=performance.now(),g=_=>{console.log(`calculate bins ${a.name} : ${performance.now()-d}`),e(_.data)};this.worker.onmessage=g,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,[a.buffer,a.datatype],o])}destroy(){super.destroy(),this.worker.terminate()}}Dimension.types.range_dimension=RangeDimension;class CatColDimension extends Dimension{constructor(e){super(e),this.worker=new Worker(new URL(""+new URL("catColWorker-2a4aab4d.js",import.meta.url).href,self.location))}getAverages(e,s,o={}){o.method=o.method||"mean";const a=performance.now(),d=this.parent.columnIndex;this.worker.onmessage=_=>{console.log(`calc averages  ${performance.now()-a}`),e(_.data)},o.values=d[s[0]].values;const g=[];for(let _=1;_<s.length;_++)g.push([d[s[_]].buffer,d[s[_]].datatype]);this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,d[s[0]].buffer,g,o])}destroy(){super.destroy(),this.worker.terminate()}}Dimension.types.catcol_dimension=CatColDimension;class CatRangeDimension extends RangeDimension{constructor(e,s){super(e,s),this.worker.terminate(),this.worker=new Worker(new URL(""+new URL("boxPlotWorker-d69acdb3.js",import.meta.url).href,self.location))}getKernalDensity(e,s,o={}){const a=performance.now(),d=this.parent.columnIndex[s[0]],g=this.parent.columnIndex[s[1]];this.parent.getMinMaxForColumn(s[1]),o.type="kernal_density",o.scaletrim&&(o.scaletrim=g.quantiles[o.scaletrim]),o.values=d.values;const _=j=>{console.log(`calculate violin ${d.name} : ${performance.now()-a}`),e(j.data)};this.worker.onmessage=_,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,d.buffer,[g.buffer,g.datatype],o])}getMultiBoxPlotData(e,s,o={}){const a=this.parent.columnIndex,d=performance.now(),g=s.map(j=>[a[j].buffer,c.Index[j].datatype]);o.analysis="multi",o.cat=this.parent.getColumnValues(s[0]).indexOf(o.category);const _=j=>{console.log(`calculate multiboxplot cols:${s.length} time: ${performance.now()-d}`),e(j.data)};this.worker.onmessage=_,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,g.slice(1),g[0],o])}getBoxPlotData(e,s,o={}){const a=performance.now(),d=this.parent.columnIndex[s[0]],g=this.parent.columnIndex[s[1]];o.analysis="boxplot",o.values=d.values;const _=j=>{console.log(`calculate boxplot ${d.name} : ${performance.now()-a}`),e(j.data)};this.worker.onmessage=_,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,d.buffer,[g.buffer,g.datatype],o])}}Dimension.types.catrange_dimension=CatRangeDimension;class DensityDimension extends RangeDimension{constructor(e){super(e),this.worker.terminate(),this.worker=new Worker(new URL(""+new URL("densityWorker-2040e813.js",import.meta.url).href,self.location))}getDensityContours(e,s,o={}){const a=performance.now(),d=this.parent.columnIndex;this.worker.onmessage=g=>{console.log(`calc density contours  ${performance.now()-a}`),e(g.data)},this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,[d[s[0]].buffer,d[s[0]].datatype],[d[s[1]].buffer,d[s[1]].datatype],d[s[2]].buffer,o])}}Dimension.types.density_dimension=DensityDimension;function ascending$1(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function bisector(i){let e=i,s=i;i.length===1&&(e=(g,_)=>i(g)-_,s=ascendingComparator(i));function o(g,_,j,_e){for(j==null&&(j=0),_e==null&&(_e=g.length);j<_e;){const et=j+_e>>>1;s(g[et],_)<0?j=et+1:_e=et}return j}function a(g,_,j,_e){for(j==null&&(j=0),_e==null&&(_e=g.length);j<_e;){const et=j+_e>>>1;s(g[et],_)>0?_e=et:j=et+1}return j}function d(g,_,j,_e){j==null&&(j=0),_e==null&&(_e=g.length);const et=o(g,_,j,_e-1);return et>j&&e(g[et-1],_)>-e(g[et],_)?et-1:et}return{left:o,center:d,right:a}}function ascendingComparator(i){return(e,s)=>ascending$1(i(e),s)}function number$2(i){return i===null?NaN:+i}const ascendingBisect=bisector(ascending$1),bisectRight=ascendingBisect.right;bisector(number$2).center;const bisect=bisectRight;class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const s=this._partials;let o=0;for(let a=0;a<this._n&&a<32;a++){const d=s[a],g=e+d,_=Math.abs(e)<Math.abs(d)?e-(g-d):d-(g-e);_&&(s[o++]=_),e=g}return s[o]=e,this._n=o+1,this}valueOf(){const e=this._partials;let s=this._n,o,a,d,g=0;if(s>0){for(g=e[--s];s>0&&(o=g,a=e[--s],g=o+a,d=a-(g-o),!d););s>0&&(d<0&&e[s-1]<0||d>0&&e[s-1]>0)&&(a=d*2,o=g+a,a==o-g&&(g=o))}return g}}class InternMap extends Map{constructor(e,s=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:s}}),e!=null)for(const[o,a]of e)this.set(o,a)}get(e){return super.get(intern_get(this,e))}has(e){return super.has(intern_get(this,e))}set(e,s){return super.set(intern_set(this,e),s)}delete(e){return super.delete(intern_delete(this,e))}}function intern_get({_intern:i,_key:e},s){const o=e(s);return i.has(o)?i.get(o):s}function intern_set({_intern:i,_key:e},s){const o=e(s);return i.has(o)?i.get(o):(i.set(o,s),s)}function intern_delete({_intern:i,_key:e},s){const o=e(s);return i.has(o)&&(s=i.get(s),i.delete(o)),s}function keyof(i){return i!==null&&typeof i=="object"?i.valueOf():i}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(i,e,s){var o,a=-1,d,g,_;if(e=+e,i=+i,s=+s,i===e&&s>0)return[i];if((o=e<i)&&(d=i,i=e,e=d),(_=tickIncrement(i,e,s))===0||!isFinite(_))return[];if(_>0){let j=Math.round(i/_),_e=Math.round(e/_);for(j*_<i&&++j,_e*_>e&&--_e,g=new Array(d=_e-j+1);++a<d;)g[a]=(j+a)*_}else{_=-_;let j=Math.round(i*_),_e=Math.round(e*_);for(j/_<i&&++j,_e/_>e&&--_e,g=new Array(d=_e-j+1);++a<d;)g[a]=(j+a)/_}return o&&g.reverse(),g}function tickIncrement(i,e,s){var o=(e-i)/Math.max(0,s),a=Math.floor(Math.log(o)/Math.LN10),d=o/Math.pow(10,a);return a>=0?(d>=e10?10:d>=e5?5:d>=e2?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(d>=e10?10:d>=e5?5:d>=e2?2:1)}function tickStep(i,e,s){var o=Math.abs(e-i)/Math.max(0,s),a=Math.pow(10,Math.floor(Math.log(o)/Math.LN10)),d=o/a;return d>=e10?a*=10:d>=e5?a*=5:d>=e2&&(a*=2),e<i?-a:a}function max$2(i,e){let s;if(e===void 0)for(const o of i)o!=null&&(s<o||s===void 0&&o>=o)&&(s=o);else{let o=-1;for(let a of i)(a=e(a,++o,i))!=null&&(s<a||s===void 0&&a>=a)&&(s=a)}return s}function min$2(i,e){let s;if(e===void 0)for(const o of i)o!=null&&(s>o||s===void 0&&o>=o)&&(s=o);else{let o=-1;for(let a of i)(a=e(a,++o,i))!=null&&(s>a||s===void 0&&a>=a)&&(s=a)}return s}function quantileSorted(i,e,s=number$2){if(o=i.length){if((e=+e)<=0||o<2)return+s(i[0],0,i);if(e>=1)return+s(i[o-1],o-1,i);var o,a=(o-1)*e,d=Math.floor(a),g=+s(i[d],d,i),_=+s(i[d+1],d+1,i);return g+(_-g)*(a-d)}}function range$1(i,e,s){i=+i,e=+e,s=(a=arguments.length)<2?(e=i,i=0,1):a<3?1:+s;for(var o=-1,a=Math.max(0,Math.ceil((e-i)/s))|0,d=new Array(a);++o<a;)d[o]=i+o*s;return d}function sum(i,e){let s=0;if(e===void 0)for(let o of i)(o=+o)&&(s+=o);else{let o=-1;for(let a of i)(a=+e(a,++o,i))&&(s+=a)}return s}function initRange(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}const implicit=Symbol("implicit");function ordinal(){var i=new InternMap,e=[],s=[],o=implicit;function a(d){let g=i.get(d);if(g===void 0){if(o!==implicit)return o;i.set(d,g=e.push(d)-1)}return s[g%s.length]}return a.domain=function(d){if(!arguments.length)return e.slice();e=[],i=new InternMap;for(const g of d)i.has(g)||i.set(g,e.push(g)-1);return a},a.range=function(d){return arguments.length?(s=Array.from(d),a):s.slice()},a.unknown=function(d){return arguments.length?(o=d,a):o},a.copy=function(){return ordinal(e,s).unknown(o)},initRange.apply(a,arguments),a}function band(){var i=ordinal().unknown(void 0),e=i.domain,s=i.range,o=0,a=1,d,g,_=!1,j=0,_e=0,et=.5;delete i.unknown;function tt(){var rt=e().length,it=a<o,ot=it?a:o,ct=it?o:a;d=(ct-ot)/Math.max(1,rt-j+_e*2),_&&(d=Math.floor(d)),ot+=(ct-ot-d*(rt-j))*et,g=d*(1-j),_&&(ot=Math.round(ot),g=Math.round(g));var ft=range$1(rt).map(function(dt){return ot+d*dt});return s(it?ft.reverse():ft)}return i.domain=function(rt){return arguments.length?(e(rt),tt()):e()},i.range=function(rt){return arguments.length?([o,a]=rt,o=+o,a=+a,tt()):[o,a]},i.rangeRound=function(rt){return[o,a]=rt,o=+o,a=+a,_=!0,tt()},i.bandwidth=function(){return g},i.step=function(){return d},i.round=function(rt){return arguments.length?(_=!!rt,tt()):_},i.padding=function(rt){return arguments.length?(j=Math.min(1,_e=+rt),tt()):j},i.paddingInner=function(rt){return arguments.length?(j=Math.min(1,rt),tt()):j},i.paddingOuter=function(rt){return arguments.length?(_e=+rt,tt()):_e},i.align=function(rt){return arguments.length?(et=Math.max(0,Math.min(1,rt)),tt()):et},i.copy=function(){return band(e(),[o,a]).round(_).paddingInner(j).paddingOuter(_e).align(et)},initRange.apply(tt(),arguments)}function define(i,e,s){i.prototype=e.prototype=s,s.constructor=i}function extend(i,e){var s=Object.create(i.prototype);for(var o in e)s[o]=e[o];return s}function Color(){}var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(i){var e,s;return i=(i+"").trim().toLowerCase(),(e=reHex.exec(i))?(s=e[1].length,e=parseInt(e[1],16),s===6?rgbn(e):s===3?new Rgb(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):s===8?rgba(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):s===4?rgba(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=reRgbInteger.exec(i))?new Rgb(e[1],e[2],e[3],1):(e=reRgbPercent.exec(i))?new Rgb(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=reRgbaInteger.exec(i))?rgba(e[1],e[2],e[3],e[4]):(e=reRgbaPercent.exec(i))?rgba(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=reHslPercent.exec(i))?hsla(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent.exec(i))?hsla(e[1],e[2]/100,e[3]/100,e[4]):named.hasOwnProperty(i)?rgbn(named[i]):i==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(i){return new Rgb(i>>16&255,i>>8&255,i&255,1)}function rgba(i,e,s,o){return o<=0&&(i=e=s=NaN),new Rgb(i,e,s,o)}function rgbConvert(i){return i instanceof Color||(i=color(i)),i?(i=i.rgb(),new Rgb(i.r,i.g,i.b,i.opacity)):new Rgb}function rgb(i,e,s,o){return arguments.length===1?rgbConvert(i):new Rgb(i,e,s,o??1)}function Rgb(i,e,s,o){this.r=+i,this.g=+e,this.b=+s,this.opacity=+o}define(Rgb,rgb,extend(Color,{brighter(i){return i=i==null?brighter:Math.pow(brighter,i),new Rgb(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?darker:Math.pow(darker,i),new Rgb(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity)?1:this.opacity)*255)}`}function rgb_formatRgb(){const i=clampa(this.opacity);return`${i===1?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${i===1?")":`, ${i})`}`}function clampa(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function clampi(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function hex(i){return i=clampi(i),(i<16?"0":"")+i.toString(16)}function hsla(i,e,s,o){return o<=0?i=e=s=NaN:s<=0||s>=1?i=e=NaN:e<=0&&(i=NaN),new Hsl(i,e,s,o)}function hslConvert(i){if(i instanceof Hsl)return new Hsl(i.h,i.s,i.l,i.opacity);if(i instanceof Color||(i=color(i)),!i)return new Hsl;if(i instanceof Hsl)return i;i=i.rgb();var e=i.r/255,s=i.g/255,o=i.b/255,a=Math.min(e,s,o),d=Math.max(e,s,o),g=NaN,_=d-a,j=(d+a)/2;return _?(e===d?g=(s-o)/_+(s<o)*6:s===d?g=(o-e)/_+2:g=(e-s)/_+4,_/=j<.5?d+a:2-d-a,g*=60):_=j>0&&j<1?0:g,new Hsl(g,_,j,i.opacity)}function hsl(i,e,s,o){return arguments.length===1?hslConvert(i):new Hsl(i,e,s,o??1)}function Hsl(i,e,s,o){this.h=+i,this.s=+e,this.l=+s,this.opacity=+o}define(Hsl,hsl,extend(Color,{brighter(i){return i=i==null?brighter:Math.pow(brighter,i),new Hsl(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?darker:Math.pow(darker,i),new Hsl(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,e=isNaN(i)||isNaN(this.s)?0:this.s,s=this.l,o=s+(s<.5?s:1-s)*e,a=2*s-o;return new Rgb(hsl2rgb(i>=240?i-240:i+120,a,o),hsl2rgb(i,a,o),hsl2rgb(i<120?i+240:i-120,a,o),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=clampa(this.opacity);return`${i===1?"hsl(":"hsla("}${clamph(this.h)}, ${clampt(this.s)*100}%, ${clampt(this.l)*100}%${i===1?")":`, ${i})`}`}}));function clamph(i){return i=(i||0)%360,i<0?i+360:i}function clampt(i){return Math.max(0,Math.min(1,i||0))}function hsl2rgb(i,e,s){return(i<60?e+(s-e)*i/60:i<180?s:i<240?e+(s-e)*(240-i)/60:e)*255}const constant$5=i=>()=>i;function linear$2(i,e){return function(s){return i+s*e}}function exponential(i,e,s){return i=Math.pow(i,s),e=Math.pow(e,s)-i,s=1/s,function(o){return Math.pow(i+o*e,s)}}function gamma(i){return(i=+i)==1?nogamma:function(e,s){return s-e?exponential(e,s,i):constant$5(isNaN(e)?s:e)}}function nogamma(i,e){var s=e-i;return s?linear$2(i,s):constant$5(isNaN(i)?e:i)}const interpolateRgb=function i(e){var s=gamma(e);function o(a,d){var g=s((a=rgb(a)).r,(d=rgb(d)).r),_=s(a.g,d.g),j=s(a.b,d.b),_e=nogamma(a.opacity,d.opacity);return function(et){return a.r=g(et),a.g=_(et),a.b=j(et),a.opacity=_e(et),a+""}}return o.gamma=i,o}(1);function numberArray(i,e){e||(e=[]);var s=i?Math.min(e.length,i.length):0,o=e.slice(),a;return function(d){for(a=0;a<s;++a)o[a]=i[a]*(1-d)+e[a]*d;return o}}function isNumberArray(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function genericArray(i,e){var s=e?e.length:0,o=i?Math.min(s,i.length):0,a=new Array(o),d=new Array(s),g;for(g=0;g<o;++g)a[g]=interpolate$1(i[g],e[g]);for(;g<s;++g)d[g]=e[g];return function(_){for(g=0;g<o;++g)d[g]=a[g](_);return d}}function date(i,e){var s=new Date;return i=+i,e=+e,function(o){return s.setTime(i*(1-o)+e*o),s}}function interpolateNumber(i,e){return i=+i,e=+e,function(s){return i*(1-s)+e*s}}function object(i,e){var s={},o={},a;(i===null||typeof i!="object")&&(i={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in i?s[a]=interpolate$1(i[a],e[a]):o[a]=e[a];return function(d){for(a in s)o[a]=s[a](d);return o}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(i){return function(){return i}}function one(i){return function(e){return i(e)+""}}function interpolateString(i,e){var s=reA.lastIndex=reB.lastIndex=0,o,a,d,g=-1,_=[],j=[];for(i=i+"",e=e+"";(o=reA.exec(i))&&(a=reB.exec(e));)(d=a.index)>s&&(d=e.slice(s,d),_[g]?_[g]+=d:_[++g]=d),(o=o[0])===(a=a[0])?_[g]?_[g]+=a:_[++g]=a:(_[++g]=null,j.push({i:g,x:interpolateNumber(o,a)})),s=reB.lastIndex;return s<e.length&&(d=e.slice(s),_[g]?_[g]+=d:_[++g]=d),_.length<2?j[0]?one(j[0].x):zero(e):(e=j.length,function(_e){for(var et=0,tt;et<e;++et)_[(tt=j[et]).i]=tt.x(_e);return _.join("")})}function interpolate$1(i,e){var s=typeof e,o;return e==null||s==="boolean"?constant$5(e):(s==="number"?interpolateNumber:s==="string"?(o=color(e))?(e=o,interpolateRgb):interpolateString:e instanceof color?interpolateRgb:e instanceof Date?date:isNumberArray(e)?numberArray:Array.isArray(e)?genericArray:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?object:interpolateNumber)(i,e)}function interpolateRound(i,e){return i=+i,e=+e,function(s){return Math.round(i*(1-s)+e*s)}}var degrees=180/Math.PI,identity$6={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(i,e,s,o,a,d){var g,_,j;return(g=Math.sqrt(i*i+e*e))&&(i/=g,e/=g),(j=i*s+e*o)&&(s-=i*j,o-=e*j),(_=Math.sqrt(s*s+o*o))&&(s/=_,o/=_,j/=_),i*o<e*s&&(i=-i,e=-e,j=-j,g=-g),{translateX:a,translateY:d,rotate:Math.atan2(e,i)*degrees,skewX:Math.atan(j)*degrees,scaleX:g,scaleY:_}}var svgNode;function parseCss(i){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return e.isIdentity?identity$6:decompose(e.a,e.b,e.c,e.d,e.e,e.f)}function parseSvg(i){return i==null||(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",i),!(i=svgNode.transform.baseVal.consolidate()))?identity$6:(i=i.matrix,decompose(i.a,i.b,i.c,i.d,i.e,i.f))}function interpolateTransform(i,e,s,o){function a(_e){return _e.length?_e.pop()+" ":""}function d(_e,et,tt,rt,it,ot){if(_e!==tt||et!==rt){var ct=it.push("translate(",null,e,null,s);ot.push({i:ct-4,x:interpolateNumber(_e,tt)},{i:ct-2,x:interpolateNumber(et,rt)})}else(tt||rt)&&it.push("translate("+tt+e+rt+s)}function g(_e,et,tt,rt){_e!==et?(_e-et>180?et+=360:et-_e>180&&(_e+=360),rt.push({i:tt.push(a(tt)+"rotate(",null,o)-2,x:interpolateNumber(_e,et)})):et&&tt.push(a(tt)+"rotate("+et+o)}function _(_e,et,tt,rt){_e!==et?rt.push({i:tt.push(a(tt)+"skewX(",null,o)-2,x:interpolateNumber(_e,et)}):et&&tt.push(a(tt)+"skewX("+et+o)}function j(_e,et,tt,rt,it,ot){if(_e!==tt||et!==rt){var ct=it.push(a(it)+"scale(",null,",",null,")");ot.push({i:ct-4,x:interpolateNumber(_e,tt)},{i:ct-2,x:interpolateNumber(et,rt)})}else(tt!==1||rt!==1)&&it.push(a(it)+"scale("+tt+","+rt+")")}return function(_e,et){var tt=[],rt=[];return _e=i(_e),et=i(et),d(_e.translateX,_e.translateY,et.translateX,et.translateY,tt,rt),g(_e.rotate,et.rotate,tt,rt),_(_e.skewX,et.skewX,tt,rt),j(_e.scaleX,_e.scaleY,et.scaleX,et.scaleY,tt,rt),_e=et=null,function(it){for(var ot=-1,ct=rt.length,ft;++ot<ct;)tt[(ft=rt[ot]).i]=ft.x(it);return tt.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");function constants(i){return function(){return i}}function number$1(i){return+i}var unit=[0,1];function identity$5(i){return i}function normalize$2(i,e){return(e-=i=+i)?function(s){return(s-i)/e}:constants(isNaN(e)?NaN:.5)}function clamper(i,e){var s;return i>e&&(s=i,i=e,e=s),function(o){return Math.max(i,Math.min(e,o))}}function bimap(i,e,s){var o=i[0],a=i[1],d=e[0],g=e[1];return a<o?(o=normalize$2(a,o),d=s(g,d)):(o=normalize$2(o,a),d=s(d,g)),function(_){return d(o(_))}}function polymap(i,e,s){var o=Math.min(i.length,e.length)-1,a=new Array(o),d=new Array(o),g=-1;for(i[o]<i[0]&&(i=i.slice().reverse(),e=e.slice().reverse());++g<o;)a[g]=normalize$2(i[g],i[g+1]),d[g]=s(e[g],e[g+1]);return function(_){var j=bisect(i,_,1,o)-1;return d[j](a[j](_))}}function copy(i,e){return e.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function transformer(){var i=unit,e=unit,s=interpolate$1,o,a,d,g=identity$5,_,j,_e;function et(){var rt=Math.min(i.length,e.length);return g!==identity$5&&(g=clamper(i[0],i[rt-1])),_=rt>2?polymap:bimap,j=_e=null,tt}function tt(rt){return rt==null||isNaN(rt=+rt)?d:(j||(j=_(i.map(o),e,s)))(o(g(rt)))}return tt.invert=function(rt){return g(a((_e||(_e=_(e,i.map(o),interpolateNumber)))(rt)))},tt.domain=function(rt){return arguments.length?(i=Array.from(rt,number$1),et()):i.slice()},tt.range=function(rt){return arguments.length?(e=Array.from(rt),et()):e.slice()},tt.rangeRound=function(rt){return e=Array.from(rt),s=interpolateRound,et()},tt.clamp=function(rt){return arguments.length?(g=rt?!0:identity$5,et()):g!==identity$5},tt.interpolate=function(rt){return arguments.length?(s=rt,et()):s},tt.unknown=function(rt){return arguments.length?(d=rt,tt):d},function(rt,it){return o=rt,a=it,et()}}function continuous(){return transformer()(identity$5,identity$5)}function formatDecimal(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function formatDecimalParts(i,e){if((s=(i=e?i.toExponential(e-1):i.toExponential()).indexOf("e"))<0)return null;var s,o=i.slice(0,s);return[o.length>1?o[0]+o.slice(2):o,+i.slice(s+1)]}function exponent(i){return i=formatDecimalParts(Math.abs(i)),i?i[1]:NaN}function formatGroup(i,e){return function(s,o){for(var a=s.length,d=[],g=0,_=i[0],j=0;a>0&&_>0&&(j+_+1>o&&(_=Math.max(1,o-j)),d.push(s.substring(a-=_,a+_)),!((j+=_+1)>o));)_=i[g=(g+1)%i.length];return d.reverse().join(e)}}function formatNumerals(i){return function(e){return e.replace(/[0-9]/g,function(s){return i[+s]})}}var re$1=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(i){if(!(e=re$1.exec(i)))throw new Error("invalid format: "+i);var e;return new FormatSpecifier({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function formatTrim(i){e:for(var e=i.length,s=1,o=-1,a;s<e;++s)switch(i[s]){case".":o=a=s;break;case"0":o===0&&(o=s),a=s;break;default:if(!+i[s])break e;o>0&&(o=0);break}return o>0?i.slice(0,o)+i.slice(a+1):i}var prefixExponent;function formatPrefixAuto(i,e){var s=formatDecimalParts(i,e);if(!s)return i+"";var o=s[0],a=s[1],d=a-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,g=o.length;return d===g?o:d>g?o+new Array(d-g+1).join("0"):d>0?o.slice(0,d)+"."+o.slice(d):"0."+new Array(1-d).join("0")+formatDecimalParts(i,Math.max(0,e+d-1))[0]}function formatRounded(i,e){var s=formatDecimalParts(i,e);if(!s)return i+"";var o=s[0],a=s[1];return a<0?"0."+new Array(-a).join("0")+o:o.length>a+1?o.slice(0,a+1)+"."+o.slice(a+1):o+new Array(a-o.length+2).join("0")}const formatTypes={"%":(i,e)=>(i*100).toFixed(e),b:i=>Math.round(i).toString(2),c:i=>i+"",d:formatDecimal,e:(i,e)=>i.toExponential(e),f:(i,e)=>i.toFixed(e),g:(i,e)=>i.toPrecision(e),o:i=>Math.round(i).toString(8),p:(i,e)=>formatRounded(i*100,e),r:formatRounded,s:formatPrefixAuto,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function identity$4(i){return i}var map$1=Array.prototype.map,prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(i){var e=i.grouping===void 0||i.thousands===void 0?identity$4:formatGroup(map$1.call(i.grouping,Number),i.thousands+""),s=i.currency===void 0?"":i.currency[0]+"",o=i.currency===void 0?"":i.currency[1]+"",a=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?identity$4:formatNumerals(map$1.call(i.numerals,String)),g=i.percent===void 0?"%":i.percent+"",_=i.minus===void 0?"":i.minus+"",j=i.nan===void 0?"NaN":i.nan+"";function _e(tt){tt=formatSpecifier(tt);var rt=tt.fill,it=tt.align,ot=tt.sign,ct=tt.symbol,ft=tt.zero,dt=tt.width,pt=tt.comma,gt=tt.precision,Ct=tt.trim,xt=tt.type;xt==="n"?(pt=!0,xt="g"):formatTypes[xt]||(gt===void 0&&(gt=12),Ct=!0,xt="g"),(ft||rt==="0"&&it==="=")&&(ft=!0,rt="0",it="=");var at=ct==="$"?s:ct==="#"&&/[boxX]/.test(xt)?"0"+xt.toLowerCase():"",Bt=ct==="$"?o:/[%p]/.test(xt)?g:"",Ht=formatTypes[xt],sr=/[defgprs%]/.test(xt);gt=gt===void 0?6:/[gprs]/.test(xt)?Math.max(1,Math.min(21,gt)):Math.max(0,Math.min(20,gt));function mr(hr){var Er=at,Lr=Bt,sn,vr,Zr;if(xt==="c")Lr=Ht(hr)+Lr,hr="";else{hr=+hr;var Hr=hr<0||1/hr<0;if(hr=isNaN(hr)?j:Ht(Math.abs(hr),gt),Ct&&(hr=formatTrim(hr)),Hr&&+hr==0&&ot!=="+"&&(Hr=!1),Er=(Hr?ot==="("?ot:_:ot==="-"||ot==="("?"":ot)+Er,Lr=(xt==="s"?prefixes[8+prefixExponent/3]:"")+Lr+(Hr&&ot==="("?")":""),sr){for(sn=-1,vr=hr.length;++sn<vr;)if(Zr=hr.charCodeAt(sn),48>Zr||Zr>57){Lr=(Zr===46?a+hr.slice(sn+1):hr.slice(sn))+Lr,hr=hr.slice(0,sn);break}}}pt&&!ft&&(hr=e(hr,1/0));var cr=Er.length+hr.length+Lr.length,lr=cr<dt?new Array(dt-cr+1).join(rt):"";switch(pt&&ft&&(hr=e(lr+hr,lr.length?dt-Lr.length:1/0),lr=""),it){case"<":hr=Er+hr+Lr+lr;break;case"=":hr=Er+lr+hr+Lr;break;case"^":hr=lr.slice(0,cr=lr.length>>1)+Er+hr+Lr+lr.slice(cr);break;default:hr=lr+Er+hr+Lr;break}return d(hr)}return mr.toString=function(){return tt+""},mr}function et(tt,rt){var it=_e((tt=formatSpecifier(tt),tt.type="f",tt)),ot=Math.max(-8,Math.min(8,Math.floor(exponent(rt)/3)))*3,ct=Math.pow(10,-ot),ft=prefixes[8+ot/3];return function(dt){return it(ct*dt)+ft}}return{format:_e,formatPrefix:et}}var locale,format,formatPrefix;defaultLocale({thousands:",",grouping:[3],currency:["$",""]});function defaultLocale(i){return locale=formatLocale(i),format=locale.format,formatPrefix=locale.formatPrefix,locale}function precisionFixed(i){return Math.max(0,-exponent(Math.abs(i)))}function precisionPrefix(i,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(e)/3)))*3-exponent(Math.abs(i)))}function precisionRound(i,e){return i=Math.abs(i),e=Math.abs(e)-i,Math.max(0,exponent(e)-exponent(i))+1}function tickFormat(i,e,s,o){var a=tickStep(i,e,s),d;switch(o=formatSpecifier(o??",f"),o.type){case"s":{var g=Math.max(Math.abs(i),Math.abs(e));return o.precision==null&&!isNaN(d=precisionPrefix(a,g))&&(o.precision=d),formatPrefix(o,g)}case"":case"e":case"g":case"p":case"r":{o.precision==null&&!isNaN(d=precisionRound(a,Math.max(Math.abs(i),Math.abs(e))))&&(o.precision=d-(o.type==="e"));break}case"f":case"%":{o.precision==null&&!isNaN(d=precisionFixed(a))&&(o.precision=d-(o.type==="%")*2);break}}return format(o)}function linearish(i){var e=i.domain;return i.ticks=function(s){var o=e();return ticks(o[0],o[o.length-1],s??10)},i.tickFormat=function(s,o){var a=e();return tickFormat(a[0],a[a.length-1],s??10,o)},i.nice=function(s){s==null&&(s=10);var o=e(),a=0,d=o.length-1,g=o[a],_=o[d],j,_e,et=10;for(_<g&&(_e=g,g=_,_=_e,_e=a,a=d,d=_e);et-- >0;){if(_e=tickIncrement(g,_,s),_e===j)return o[a]=g,o[d]=_,e(o);if(_e>0)g=Math.floor(g/_e)*_e,_=Math.ceil(_/_e)*_e;else if(_e<0)g=Math.ceil(g*_e)/_e,_=Math.floor(_*_e)/_e;else break;j=_e}return i},i}function linear$1(){var i=continuous();return i.copy=function(){return copy(i,linear$1())},initRange.apply(i,arguments),linearish(i)}function transformSymlog(i){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/i))}}function transformSymexp(i){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*i}}function symlogish(i){var e=1,s=i(transformSymlog(e),transformSymexp(e));return s.constant=function(o){return arguments.length?i(transformSymlog(e=+o),transformSymexp(e)):e},linearish(s)}function symlog(){var i=symlogish(transformer());return i.copy=function(){return copy(i,symlog()).constant(i.constant())},initRange.apply(i,arguments)}var xhtml="http://www.w3.org/1999/xhtml";const namespaces={svg:"http://www.w3.org/2000/svg",xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(i){var e=i+="",s=e.indexOf(":");return s>=0&&(e=i.slice(0,s))!=="xmlns"&&(i=i.slice(s+1)),namespaces.hasOwnProperty(e)?{space:namespaces[e],local:i}:i}function creatorInherit(i){return function(){var e=this.ownerDocument,s=this.namespaceURI;return s===xhtml&&e.documentElement.namespaceURI===xhtml?e.createElement(i):e.createElementNS(s,i)}}function creatorFixed(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function creator(i){var e=namespace(i);return(e.local?creatorFixed:creatorInherit)(e)}function none(){}function selector(i){return i==null?none:function(){return this.querySelector(i)}}function selection_select(i){typeof i!="function"&&(i=selector(i));for(var e=this._groups,s=e.length,o=new Array(s),a=0;a<s;++a)for(var d=e[a],g=d.length,_=o[a]=new Array(g),j,_e,et=0;et<g;++et)(j=d[et])&&(_e=i.call(j,j.__data__,et,d))&&("__data__"in j&&(_e.__data__=j.__data__),_[et]=_e);return new Selection$1(o,this._parents)}function array$1(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function empty$1(){return[]}function selectorAll(i){return i==null?empty$1:function(){return this.querySelectorAll(i)}}function arrayAll(i){return function(){return array$1(i.apply(this,arguments))}}function selection_selectAll(i){typeof i=="function"?i=arrayAll(i):i=selectorAll(i);for(var e=this._groups,s=e.length,o=[],a=[],d=0;d<s;++d)for(var g=e[d],_=g.length,j,_e=0;_e<_;++_e)(j=g[_e])&&(o.push(i.call(j,j.__data__,_e,g)),a.push(j));return new Selection$1(o,a)}function matcher(i){return function(){return this.matches(i)}}function childMatcher(i){return function(e){return e.matches(i)}}var find$1=Array.prototype.find;function childFind(i){return function(){return find$1.call(this.children,i)}}function childFirst(){return this.firstElementChild}function selection_selectChild(i){return this.select(i==null?childFirst:childFind(typeof i=="function"?i:childMatcher(i)))}var filter=Array.prototype.filter;function children(){return Array.from(this.children)}function childrenFilter(i){return function(){return filter.call(this.children,i)}}function selection_selectChildren(i){return this.selectAll(i==null?children:childrenFilter(typeof i=="function"?i:childMatcher(i)))}function selection_filter(i){typeof i!="function"&&(i=matcher(i));for(var e=this._groups,s=e.length,o=new Array(s),a=0;a<s;++a)for(var d=e[a],g=d.length,_=o[a]=[],j,_e=0;_e<g;++_e)(j=d[_e])&&i.call(j,j.__data__,_e,d)&&_.push(j);return new Selection$1(o,this._parents)}function sparse(i){return new Array(i.length)}function selection_enter(){return new Selection$1(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}EnterNode.prototype={constructor:EnterNode,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function constant$4(i){return function(){return i}}function bindIndex(i,e,s,o,a,d){for(var g=0,_,j=e.length,_e=d.length;g<_e;++g)(_=e[g])?(_.__data__=d[g],o[g]=_):s[g]=new EnterNode(i,d[g]);for(;g<j;++g)(_=e[g])&&(a[g]=_)}function bindKey(i,e,s,o,a,d,g){var _,j,_e=new Map,et=e.length,tt=d.length,rt=new Array(et),it;for(_=0;_<et;++_)(j=e[_])&&(rt[_]=it=g.call(j,j.__data__,_,e)+"",_e.has(it)?a[_]=j:_e.set(it,j));for(_=0;_<tt;++_)it=g.call(i,d[_],_,d)+"",(j=_e.get(it))?(o[_]=j,j.__data__=d[_],_e.delete(it)):s[_]=new EnterNode(i,d[_]);for(_=0;_<et;++_)(j=e[_])&&_e.get(rt[_])===j&&(a[_]=j)}function datum(i){return i.__data__}function selection_data(i,e){if(!arguments.length)return Array.from(this,datum);var s=e?bindKey:bindIndex,o=this._parents,a=this._groups;typeof i!="function"&&(i=constant$4(i));for(var d=a.length,g=new Array(d),_=new Array(d),j=new Array(d),_e=0;_e<d;++_e){var et=o[_e],tt=a[_e],rt=tt.length,it=arraylike(i.call(et,et&&et.__data__,_e,o)),ot=it.length,ct=_[_e]=new Array(ot),ft=g[_e]=new Array(ot),dt=j[_e]=new Array(rt);s(et,tt,ct,ft,dt,it,e);for(var pt=0,gt=0,Ct,xt;pt<ot;++pt)if(Ct=ct[pt]){for(pt>=gt&&(gt=pt+1);!(xt=ft[gt])&&++gt<ot;);Ct._next=xt||null}}return g=new Selection$1(g,o),g._enter=_,g._exit=j,g}function arraylike(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function selection_exit(){return new Selection$1(this._exit||this._groups.map(sparse),this._parents)}function selection_join(i,e,s){var o=this.enter(),a=this,d=this.exit();return typeof i=="function"?(o=i(o),o&&(o=o.selection())):o=o.append(i+""),e!=null&&(a=e(a),a&&(a=a.selection())),s==null?d.remove():s(d),o&&a?o.merge(a).order():a}function selection_merge(i){for(var e=i.selection?i.selection():i,s=this._groups,o=e._groups,a=s.length,d=o.length,g=Math.min(a,d),_=new Array(a),j=0;j<g;++j)for(var _e=s[j],et=o[j],tt=_e.length,rt=_[j]=new Array(tt),it,ot=0;ot<tt;++ot)(it=_e[ot]||et[ot])&&(rt[ot]=it);for(;j<a;++j)_[j]=s[j];return new Selection$1(_,this._parents)}function selection_order(){for(var i=this._groups,e=-1,s=i.length;++e<s;)for(var o=i[e],a=o.length-1,d=o[a],g;--a>=0;)(g=o[a])&&(d&&g.compareDocumentPosition(d)^4&&d.parentNode.insertBefore(g,d),d=g);return this}function selection_sort(i){i||(i=ascending);function e(tt,rt){return tt&&rt?i(tt.__data__,rt.__data__):!tt-!rt}for(var s=this._groups,o=s.length,a=new Array(o),d=0;d<o;++d){for(var g=s[d],_=g.length,j=a[d]=new Array(_),_e,et=0;et<_;++et)(_e=g[et])&&(j[et]=_e);j.sort(e)}return new Selection$1(a,this._parents).order()}function ascending(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function selection_call(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function selection_nodes(){return Array.from(this)}function selection_node(){for(var i=this._groups,e=0,s=i.length;e<s;++e)for(var o=i[e],a=0,d=o.length;a<d;++a){var g=o[a];if(g)return g}return null}function selection_size(){let i=0;for(const e of this)++i;return i}function selection_empty(){return!this.node()}function selection_each(i){for(var e=this._groups,s=0,o=e.length;s<o;++s)for(var a=e[s],d=0,g=a.length,_;d<g;++d)(_=a[d])&&i.call(_,_.__data__,d,a);return this}function attrRemove$1(i){return function(){this.removeAttribute(i)}}function attrRemoveNS$1(i){return function(){this.removeAttributeNS(i.space,i.local)}}function attrConstant$1(i,e){return function(){this.setAttribute(i,e)}}function attrConstantNS$1(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function attrFunction$1(i,e){return function(){var s=e.apply(this,arguments);s==null?this.removeAttribute(i):this.setAttribute(i,s)}}function attrFunctionNS$1(i,e){return function(){var s=e.apply(this,arguments);s==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,s)}}function selection_attr(i,e){var s=namespace(i);if(arguments.length<2){var o=this.node();return s.local?o.getAttributeNS(s.space,s.local):o.getAttribute(s)}return this.each((e==null?s.local?attrRemoveNS$1:attrRemove$1:typeof e=="function"?s.local?attrFunctionNS$1:attrFunction$1:s.local?attrConstantNS$1:attrConstant$1)(s,e))}function defaultView(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function styleRemove$1(i){return function(){this.style.removeProperty(i)}}function styleConstant$1(i,e,s){return function(){this.style.setProperty(i,e,s)}}function styleFunction$1(i,e,s){return function(){var o=e.apply(this,arguments);o==null?this.style.removeProperty(i):this.style.setProperty(i,o,s)}}function selection_style(i,e,s){return arguments.length>1?this.each((e==null?styleRemove$1:typeof e=="function"?styleFunction$1:styleConstant$1)(i,e,s??"")):styleValue(this.node(),i)}function styleValue(i,e){return i.style.getPropertyValue(e)||defaultView(i).getComputedStyle(i,null).getPropertyValue(e)}function propertyRemove(i){return function(){delete this[i]}}function propertyConstant(i,e){return function(){this[i]=e}}function propertyFunction(i,e){return function(){var s=e.apply(this,arguments);s==null?delete this[i]:this[i]=s}}function selection_property(i,e){return arguments.length>1?this.each((e==null?propertyRemove:typeof e=="function"?propertyFunction:propertyConstant)(i,e)):this.node()[i]}function classArray(i){return i.trim().split(/^|\s+/)}function classList(i){return i.classList||new ClassList(i)}function ClassList(i){this._node=i,this._names=classArray(i.getAttribute("class")||"")}ClassList.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function classedAdd(i,e){for(var s=classList(i),o=-1,a=e.length;++o<a;)s.add(e[o])}function classedRemove(i,e){for(var s=classList(i),o=-1,a=e.length;++o<a;)s.remove(e[o])}function classedTrue(i){return function(){classedAdd(this,i)}}function classedFalse(i){return function(){classedRemove(this,i)}}function classedFunction(i,e){return function(){(e.apply(this,arguments)?classedAdd:classedRemove)(this,i)}}function selection_classed(i,e){var s=classArray(i+"");if(arguments.length<2){for(var o=classList(this.node()),a=-1,d=s.length;++a<d;)if(!o.contains(s[a]))return!1;return!0}return this.each((typeof e=="function"?classedFunction:e?classedTrue:classedFalse)(s,e))}function textRemove(){this.textContent=""}function textConstant$1(i){return function(){this.textContent=i}}function textFunction$1(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function selection_text(i){return arguments.length?this.each(i==null?textRemove:(typeof i=="function"?textFunction$1:textConstant$1)(i)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(i){return function(){this.innerHTML=i}}function htmlFunction(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function selection_html(i){return arguments.length?this.each(i==null?htmlRemove:(typeof i=="function"?htmlFunction:htmlConstant)(i)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(i){var e=typeof i=="function"?i:creator(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function constantNull(){return null}function selection_insert(i,e){var s=typeof i=="function"?i:creator(i),o=e==null?constantNull:typeof e=="function"?e:selector(e);return this.select(function(){return this.insertBefore(s.apply(this,arguments),o.apply(this,arguments)||null)})}function remove(){var i=this.parentNode;i&&i.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function selection_cloneDeep(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function selection_clone(i){return this.select(i?selection_cloneDeep:selection_cloneShallow)}function selection_datum(i){return arguments.length?this.property("__data__",i):this.node().__data__}function contextListener(i){return function(e){i.call(this,e,this.__data__)}}function parseTypenames$1(i){return i.trim().split(/^|\s+/).map(function(e){var s="",o=e.indexOf(".");return o>=0&&(s=e.slice(o+1),e=e.slice(0,o)),{type:e,name:s}})}function onRemove(i){return function(){var e=this.__on;if(e){for(var s=0,o=-1,a=e.length,d;s<a;++s)d=e[s],(!i.type||d.type===i.type)&&d.name===i.name?this.removeEventListener(d.type,d.listener,d.options):e[++o]=d;++o?e.length=o:delete this.__on}}}function onAdd(i,e,s){return function(){var o=this.__on,a,d=contextListener(e);if(o){for(var g=0,_=o.length;g<_;++g)if((a=o[g]).type===i.type&&a.name===i.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=d,a.options=s),a.value=e;return}}this.addEventListener(i.type,d,s),a={type:i.type,name:i.name,value:e,listener:d,options:s},o?o.push(a):this.__on=[a]}}function selection_on(i,e,s){var o=parseTypenames$1(i+""),a,d=o.length,g;if(arguments.length<2){var _=this.node().__on;if(_){for(var j=0,_e=_.length,et;j<_e;++j)for(a=0,et=_[j];a<d;++a)if((g=o[a]).type===et.type&&g.name===et.name)return et.value}return}for(_=e?onAdd:onRemove,a=0;a<d;++a)this.each(_(o[a],e,s));return this}function dispatchEvent(i,e,s){var o=defaultView(i),a=o.CustomEvent;typeof a=="function"?a=new a(e,s):(a=o.document.createEvent("Event"),s?(a.initEvent(e,s.bubbles,s.cancelable),a.detail=s.detail):a.initEvent(e,!1,!1)),i.dispatchEvent(a)}function dispatchConstant(i,e){return function(){return dispatchEvent(this,i,e)}}function dispatchFunction(i,e){return function(){return dispatchEvent(this,i,e.apply(this,arguments))}}function selection_dispatch(i,e){return this.each((typeof e=="function"?dispatchFunction:dispatchConstant)(i,e))}function*selection_iterator(){for(var i=this._groups,e=0,s=i.length;e<s;++e)for(var o=i[e],a=0,d=o.length,g;a<d;++a)(g=o[a])&&(yield g)}var root=[null];function Selection$1(i,e){this._groups=i,this._parents=e}function selection(){return new Selection$1([[document.documentElement]],root)}function selection_selection(){return this}Selection$1.prototype=selection.prototype={constructor:Selection$1,select:selection_select,selectAll:selection_selectAll,selectChild:selection_selectChild,selectChildren:selection_selectChildren,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,selection:selection_selection,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch,[Symbol.iterator]:selection_iterator};function select(i){return typeof i=="string"?new Selection$1([[document.querySelector(i)]],[document.documentElement]):new Selection$1([[i]],root)}function sourceEvent(i){let e;for(;e=i.sourceEvent;)i=e;return i}function pointer(i,e){if(i=sourceEvent(i),e===void 0&&(e=i.currentTarget),e){var s=e.ownerSVGElement||e;if(s.createSVGPoint){var o=s.createSVGPoint();return o.x=i.clientX,o.y=i.clientY,o=o.matrixTransform(e.getScreenCTM().inverse()),[o.x,o.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[i.clientX-a.left-e.clientLeft,i.clientY-a.top-e.clientTop]}}return[i.pageX,i.pageY]}function identity$3(i){return i}var top=1,right=2,bottom=3,left=4,epsilon$3=1e-6;function translateX(i){return"translate("+i+",0)"}function translateY(i){return"translate(0,"+i+")"}function number(i){return e=>+i(e)}function center(i,e){return e=Math.max(0,i.bandwidth()-e*2)/2,i.round()&&(e=Math.round(e)),s=>+i(s)+e}function entering(){return!this.__axis}function axis(i,e){var s=[],o=null,a=null,d=6,g=6,_=3,j=typeof window<"u"&&window.devicePixelRatio>1?0:.5,_e=i===top||i===left?-1:1,et=i===left||i===right?"x":"y",tt=i===top||i===bottom?translateX:translateY;function rt(it){var ot=o??(e.ticks?e.ticks.apply(e,s):e.domain()),ct=a??(e.tickFormat?e.tickFormat.apply(e,s):identity$3),ft=Math.max(d,0)+_,dt=e.range(),pt=+dt[0]+j,gt=+dt[dt.length-1]+j,Ct=(e.bandwidth?center:number)(e.copy(),j),xt=it.selection?it.selection():it,at=xt.selectAll(".domain").data([null]),Bt=xt.selectAll(".tick").data(ot,e).order(),Ht=Bt.exit(),sr=Bt.enter().append("g").attr("class","tick"),mr=Bt.select("line"),hr=Bt.select("text");at=at.merge(at.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Bt=Bt.merge(sr),mr=mr.merge(sr.append("line").attr("stroke","currentColor").attr(et+"2",_e*d)),hr=hr.merge(sr.append("text").attr("fill","currentColor").attr(et,_e*ft).attr("dy",i===top?"0em":i===bottom?"0.71em":"0.32em")),it!==xt&&(at=at.transition(it),Bt=Bt.transition(it),mr=mr.transition(it),hr=hr.transition(it),Ht=Ht.transition(it).attr("opacity",epsilon$3).attr("transform",function(Er){return isFinite(Er=Ct(Er))?tt(Er+j):this.getAttribute("transform")}),sr.attr("opacity",epsilon$3).attr("transform",function(Er){var Lr=this.parentNode.__axis;return tt((Lr&&isFinite(Lr=Lr(Er))?Lr:Ct(Er))+j)})),Ht.remove(),at.attr("d",i===left||i===right?g?"M"+_e*g+","+pt+"H"+j+"V"+gt+"H"+_e*g:"M"+j+","+pt+"V"+gt:g?"M"+pt+","+_e*g+"V"+j+"H"+gt+"V"+_e*g:"M"+pt+","+j+"H"+gt),Bt.attr("opacity",1).attr("transform",function(Er){return tt(Ct(Er)+j)}),mr.attr(et+"2",_e*d),hr.attr(et,_e*ft).text(ct),xt.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",i===right?"start":i===left?"end":"middle"),xt.each(function(){this.__axis=Ct})}return rt.scale=function(it){return arguments.length?(e=it,rt):e},rt.ticks=function(){return s=Array.from(arguments),rt},rt.tickArguments=function(it){return arguments.length?(s=it==null?[]:Array.from(it),rt):s.slice()},rt.tickValues=function(it){return arguments.length?(o=it==null?null:Array.from(it),rt):o&&o.slice()},rt.tickFormat=function(it){return arguments.length?(a=it,rt):a},rt.tickSize=function(it){return arguments.length?(d=g=+it,rt):d},rt.tickSizeInner=function(it){return arguments.length?(d=+it,rt):d},rt.tickSizeOuter=function(it){return arguments.length?(g=+it,rt):g},rt.tickPadding=function(it){return arguments.length?(_=+it,rt):_},rt.offset=function(it){return arguments.length?(j=+it,rt):j},rt}function axisBottom(i){return axis(bottom,i)}function axisLeft(i){return axis(left,i)}function getColorLegend(i,e,s={}){const o=i.length,a=s.type||"color",d=a==="circle"?20:12,g=o*d+(o+2)*2,_=createEl("div",{styles:{width:"120px",height:(g>215?215:g)+35+"px",position:"absolute",border:"0.5px solid black"},classes:["legend-container"]});createEl("div",{styles:{height:"20px",whiteSpace:"nowrap"},classes:["legend-title"],text:s.label},_);const j=createEl("div",{styles:{overflowY:"auto",overflowX:"hidden",height:"calc(100% - 10px)",width:"100%"},classes:["legend-body"]},_),_e=createSVGEl("svg",{height:g,width:180,styles:{position:"relative"}},j),et=createSVGEl("g",{},_e),tt=a==="color"?14:a==="line"?20:30;for(let rt=0;rt<o;rt++){a==="color"?createSVGEl("rect",{y:(rt+1)*2+rt*d,x:2,height:"10",width:"10",styles:{fill:i[rt]}},et):a==="line"?createSVGEl("rect",{y:(rt+1)*2+rt*d,x:2,height:"10",width:i[rt],styles:{fill:"gray"}},et):a==="circle"&&createSVGEl("circle",{cy:(rt+1)*2+rt*d+4,cx:15,r:i[rt],styles:{fill:"gray"}},et);const it=createSVGEl("text",{y:(rt+1)*2+rt*d+6+3,x:tt,"alignment-baseline":"center",styles:{"font-size":"12px",fill:"currentcolor"},text:e[rt]===""?"none":e[rt]},et);select(it).style("fill","currentcolor")}return makeDraggable(_,{handle:".legend-body"}),makeResizable(_),_}function getColorBar(i,e={}){const s=e,o=i.length,a=i.map((it,ot)=>[Math.floor(ot/o*100)+"%",it]),d=s.width||120,g=s.height||45,_=createSVGEl("svg",{height:g,width:d,styles:{position:"relative"}}),j=select(_).append("g"),_e=getRandomString();s.label&&j.append("text").text(s.label).attr("x",10).style("fill","currentColor").attr("alignment-baseline","hanging").style("font-size","12px");const et=j.append("defs").append("linearGradient").attr("id",_e).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");let tt=g;if(s.label&&(tt-=10),s.range&&(tt-=25),j.append("rect").attr("x",s.range?10:0).attr("y",s.label?10:0).attr("width",s.range?d-20:20).attr("height",tt).style("fill",`url(#${_e})`),a.forEach(it=>{et.append("stop").attr("offset",it[0]).attr("stop-color",it[1]).attr("stop-opacity",1)}),s.range){const it=linear$1().domain([s.range[0],s.range[1]]).range([0,d-20]),ot=axisBottom(it).tickFormat((ct,ft)=>ct>=1e4?Number.parseFloat(ct).toPrecision(2):ct).ticks(Math.ceil(d/20));j.append("g").call(ot).attr("transform",`translate(10,${g-25})`).selectAll("text").style("text-anchor","end").attr("dx","-.4em").attr("dy",".4em").attr("transform","rotate(-45)")}const rt=createEl("div",{height:g,width:d,styles:{position:"absolute"},classes:["legend-container"]});return rt.append(_),makeDraggable(rt),rt}class DataStore{constructor(e,s={}){if(this.size=e,this.filterSize=e,this.columns=[],this.columnIndex={},this.listeners={},this.indexes={},this.filterBuffer=new SharedArrayBuffer(e),this.filterArray=new Uint8Array(this.filterBuffer),this.dimensions=[],this.name=s.name,this.textDecoder=new TextDecoder,this.columnGroups={},this.subtypeToGroup={},this.subgroups={},this.subgroupDataSources=new Set,this.accessOtherDataStore=[],this.syncColumnColors=[],this.linkColumns=[],this.columnsWithData=[],this.dirtyColumns={added:{},removed:{},data_changed:{},colors_changed:{}},this.dirtyMetadata=new Set,s.offsets&&(s.offsets.values=s.offsets.values||{},this.offsets=s.offsets),this.images=s.images,this.genome_browser=s.genome_browser,s.columns)for(let o of s.columns)this.addColumn(o,o.data);if(s.columnGroups)for(let o of s.columnGroups)this.addColumnGroup(o);if(s.large_images&&(this.large_images=s.large_images),s.links){this.links=s.links;for(let o in s.links){const a=s.links[o];if(a.rows_as_columns){const d=a.rows_as_columns.subgroups;this.subgroupDataSources.add(o);for(let g in d)this.subgroups[g]={subgroup:d[g],dataSource:o,name_column:a.rows_as_columns.name_column}}a.access_data&&this.accessOtherDataStore.push({dataSource:o,index:a.index}),a.sync_column_colors&&this.syncColumnColors.push({dataSource:o,columns:a.sync_column_colors}),a.columns&&this.linkColumns.push({dataSource:o,columns:a.columns})}}}isFiltered(){return this.filterSize!==this.size}addListener(e,s){this.listeners[e]=s}removeListener(e){delete this.listeners[e]}_callListeners(e,s){for(let o in this.listeners)this.listeners[o](e,s)}removeAllFilters(){this.filterArray.fill(0);let e=[];for(let s of this.dimensions){if(s.noclear){e.push(s);continue}if(s.filterArray.fill(0),s.filterMethod=null,s.bgfArray)for(let o=0;o<this.size;o++)s.bgfArray[o]===0&&(s.filterArray[o]=2)}this.filterSize=this.size;for(let s of e){const o=s.filterArray;for(let a=0;a<o.length;a++)o[a]===1&&++this.filterArray[a]===1&&this.filterSize--}this._callListeners("filtered","all_removed")}dataChanged(e,s=!0){let o=!1;for(let a of this.dimensions)a.reFilterOnDataChanged(e)&&(o=!0);if(s)for(let a of e)this.setColumnIsDirty(a);o&&this._callListeners("filtered"),this._callListeners("data_changed",{columns:e,hasFiltered:o})}dataHighlighted(e,s){this.highightedData=e,this._callListeners("data_highlighted",{indexes:e,source:s})}getHighlightedData(){return this.highightedData}triggerFilter(){this._callListeners("filtered")}setColumnIsDirty(e){this.dirtyColumns.added[e]||(this.dirtyColumns.data_changed[e]=!0)}setAllColumnsClean(){this.dirtyColumns.added={},this.dirtyColumns.removed={},this.dirtyColumns.data_changed={},this.dirtyColumns.colors_changed={},this.dirtyMetadata.clear()}getFilter(){return this.filterArray}isRowFiltered(e){return this.filterArray[e]===0}_calculateCategories(e){let s=e.values,o=e.data;for(let a of s);for(let a=0;a<o.length;a++)s[o[a]]}addColumn(e,s=null,o=!1){let a={name:e.name,field:e.field,datatype:e.datatype};a.field||(a.field=e.name),e.colors&&(a.colors=e.colors),e.editable&&(a.editable=!0),e.is_url&&(a.is_url=!0),e.subgroup&&(a.subgroup=e.subgroup,a.sgindex=e.sgindex,a.sgtype=e.sgtype),e.datatype==="text"||e.datatype==="multitext"?(a.stringLength=e.stringLength,a.values=e.values||[`Error: no values for '${a.name}'`]):e.datatype==="double"||e.datatype==="integer"||e.datatype==="int32"?(a.colorLogScale=e.colorLogScale,a.minMax=e.minMax,a.quantiles=e.quantiles):a.stringLength=e.stringLength,this.columns.push(a),this.columnIndex[a.field]=a,s&&this.setColumnData(e.field,s),o&&(this.dirtyColumns.added[e.field]=!0)}getSuggestedValues(e,s,o=10){const a=this.columnIndex[s],d=e.toLowerCase(),g=e.toUpperCase(),_=[];if(a.datatype==="unique"){const j=new TextEncoder,_e=j.encode(d),et=j.encode(g),tt=e.length,rt=a.data,it=a.stringLength;for(let ot=0;ot<rt.length-tt;ot++){let ct=!0;for(let ft=0;ft<tt;ft++)if(_e[ft]!=rt[ot+ft]&&et[ft]!=rt[ot+ft]){ct=!1;break}if(ct){const ft=Math.floor(ot/it),dt=this.textDecoder.decode(a.data.slice(ft*it,ft*it+it)).replaceAll("\0","");if(_.push({value:dt,index:ft}),_.length>o)break}}}else if(a.datatype==="text"||a.datatype==="multitext"){const j=e.length;for(let _e=0;_e<a.values.length;_e++){const et=a.values[_e];for(let tt=0;tt<et.length-j;tt++){let rt=!0;for(let it=tt;it<tt<j;it++)if(e[tt]!==d[it]&&e[tt]!==g){rt=!1;break}if(rt)break}_.push({value:et,index:_e})}}return _}addColumnFromField(e){const s=e.split("|");let o=this.subtypeToGroup[s[0]],a=null;o?a=o.subgroups[s[0]]:(o=this.subgroups[s[0]],a=o.subgroup),this.columnIndex[e]||this.addColumn({name:s[1],field:e,datatype:"double",subgroup:a.name,sgindex:s[2],sgtype:a.type})}getColumnList(e=null,s=!1){const o=[],a={},d=Object.keys(this.subgroups).map(_e=>(a[_e]=[],_e)),g=Array.isArray(e),_=d.length!==0;for(let _e in this.columnIndex){const et=this.columnIndex[_e];if(e){if(g){if(e.indexOf(et.datatype)===-1)continue}else if(e==="number"){if(et.datatype==="text"||et.datatype==="unique"||et.datatype==="multitext")continue}else if(e!=="all"&&e!==et.datatype)continue}if(_){let tt=!1;for(let rt of d)if(et.field.startsWith(`${rt}|`)){const it=this.subgroups[rt];a[rt].push({name:et.name,field:et.field,datatype:et.datatype,subgroup:{dataSource:it.dataSource,name_column:it.name_column}}),tt=!0;break}if(tt)continue}o.push({name:et.name,field:et.field,datatype:et.datatype})}let j=o.sort((_e,et)=>_e.name.localeCompare(et.name));if(_)for(let _e in a)a[_e].sort((et,tt)=>et.name.localeCompare(tt.name)),j=j.concat(a[_e]);return s&&j.push({name:"None",field:"__none__"}),j}getDimension(e){if(!Dimension.types[e])throw`Adding non existent Dimension: ${e}`;const s=new Dimension.types[e](this);return this.dimensions.push(s),s}getRowAsObject(e,s){s||(s=this.columnsWithData);const o={};for(let a of s){const d=this.columnIndex[a];let g=d.data[e];if(d.datatype==="text")g=d.values[g];else if(d.datatype==="double"||d.datatype==="integer"||d.datatype==="int32")isNaN(g)&&(g="missing");else if(d.datatype=="multitext"){const _=d.data.slice(e*d.stringLength,e*d.stringLength+d.stringLength);g=Array.from(_.filter(j=>j!=65535)).map(j=>d.values[j]).join(", ")}else g=this.textDecoder.decode(d.data.slice(e*d.stringLength,e*d.stringLength+d.stringLength)),g=g.replaceAll("\0","");o[a]=g}return o.__index__=e,o}getFirstFilteredIndex(){for(let e=0;e<this.size;e++)if(this.filterArray[e]===0)return e}getFilteredValues(e){const s=new Array(this.filterSize);let o=0;for(let a=0;a<this.size;a++)this.filterArray[a]===0&&(s[o]=this.getRowText(a,e),o++);return s}getRowText(e,s){return this.getRowAsObject(e,[s])[s]}setColumnOffset(e,s){if(!this.offsets)throw new Error("Attempting to set offsets but none are specified in config");e.filter=e.filter||"all";const o=this.offsets.values;let a=o[e.filter];a||(a={},o[e.filter]=a);let d=a[e.group];d||(d={offsets:[0,0],rotation:0},a[e.group]=d),this.updateColumnOffsets(e,e.rotation,s),this.dirtyMetadata.add("offsets")}_getRotationOrigin(e,s,o){const a=this.offsets,d=this.columnIndex[e],g=d.values.indexOf(s),_=d.data,j=this.columnIndex[a.param[0]],_e=this.columnIndex[a.param[1]];let et=null,tt=null;a.background_filter&&(tt=this.columnIndex[a.background_filter],et=tt.values.indexOf(o));let rt=[Number.MAX_VALUE,Number.MIN_VALUE],it=[Number.MAX_VALUE,Number.MIN_VALUE];for(let ct=0;ct<this.size;ct++)tt&&tt.data[ct]!==et||_[ct]===g&&(rt[0]=Math.min(rt[0],j.originalData[ct]),rt[1]=Math.max(rt[1],j.originalData[ct]),it[0]=Math.min(it[0],_e.originalData[ct]),it[1]=Math.max(it[1],_e.originalData[ct]));const ot=ct=>ct[0]+(ct[1]-ct[0])/2;return[ot(rt),ot(it)]}initiateOffsets(){const e=this.offsets,s=this.columnIndex[e.param[0]],o=this.columnIndex[e.param[1]];s.originalData=new Float32Array(s.data),o.originalData=new Float32Array(o.data)}_getOffsetValues(e,s){const o=this.offsets;let a=null,d=null;if(o.background_filter){const j=this.columnIndex[o.background_filter];a=j.data,d=j.values}const g=this.columnIndex[o.groups],_=[];for(let j in o.values)if(!(e&&j!==e.filter))for(let _e in o.values[j]){if(e&&_e!==e.group)continue;let et=o.values[j][_e];const tt={index:g.values.indexOf(_e)};if(j!=="all"&&(tt.filterData=a,tt.filterValue=d.indexOf(j)),s&&(et.rotation_center||(et.rotation_center=this._getRotationOrigin(o.groups,_e,j)),tt.rotation_center=[et.rotation_center[0]+et.offsets[0],et.rotation_center[1]+et.offsets[1]]),e?s?(tt.rotation=e.rotation,et.rotation+=e.rotation):(et.offsets[0]+=e.offsets[0],et.offsets[1]+=e.offsets[1],tt.offsets=e.offsets):s?tt.rotation=et.rotation:tt.offsets=et.offsets,s){const rt=Math.PI/180*tt.rotation;tt.cos=Math.cos(rt),tt.sin=Math.sin(rt)}_.push(tt)}return _}resetColumnOffsets(e,s,o){e=e||"all";const a=this.offsets;if(!a)throw new Error("Attempting to reset offsets but none are specified in config");delete this.offsets.values[e][s];let d=null,g=null;e!=="all"&&(d=this.columnIndex[this.offsets.background_filter],g=d.values.indexOf(e));const _=this.getColumnValues(a.groups).indexOf(s),j=this.columnIndex[a.groups].data,_e=this.columnIndex[a.param[0]],et=this.columnIndex[a.param[1]];for(let tt=0;tt<this.size;tt++)d&&d[tt]!==g||j[tt]===_&&(et.data[tt]=et.originalData[tt],_e.data[tt]=_e.originalData[tt]);o&&this.dataChanged([a.param[0],a.param[1]],!1),this.dirtyMetadata.add("offsets")}updateColumnOffsets(e,s=!1,o=!1){const a=this.offsets,g=this.columnIndex[a.groups].data,_=this.columnIndex[a.param[0]],j=this.columnIndex[a.param[1]],_e=this._getOffsetValues(e,s);for(let et=0;et<this.size;et++)for(let tt of _e)if(!(tt.filterData&&tt.filterData[et]!==tt.filterValue)&&g[et]===tt.index)if(s){let rt=tt.rotation_center[0],it=tt.rotation_center[1],ot=tt.cos*(_.data[et]-rt)+tt.sin*(j.data[et]-it)+rt,ct=tt.cos*(j.data[et]-it)-tt.sin*(_.data[et]-rt)+it;_.data[et]=ot,j.data[et]=ct}else _.data[et]=_.data[et]+tt.offsets[0],j.data[et]=j.data[et]+tt.offsets[1];o&&this.dataChanged([a.param[0],a.param[1]],!1)}getColumnIndex(e){if(this.indexes[e])return this.indexes[e];const s=this.columnIndex[e],o={};if(s.datatype==="unique")for(let a=0;a<this.size;a++){let d=this.textDecoder.decode(s.data.slice(a*s.stringLength,a*s.stringLength+s.stringLength)).replaceAll("\0","");d.includes("#")&&(d=d.split("#")[1]),o[d]=a}else for(let a=0;a<this.size;a++)o[s.values[s.data[a]]]=a;return this.indexes[e]=o,o}getDataAsBlob(e,s="all",o="	",a=`
`){let d=null;typeof s!="string"&&(d=s);const g=[],_=["index"].concat(e);for(let _e of e){const et=this.columnIndex[_e];_.push(et.name)}const j=d?d.length:this.size;g.push(_.join(o));for(let _e=0;_e<j;_e++){let et=_e;if(d)et=d[_e];else if(s==="filtered"&&this.filterArray[_e]===1)continue;const tt=this.getRowAsObject(et,e),rt=[_e].concat(e.map(it=>tt[it]));g.push(rt.join(o))}return new Blob([g.join(a)],{type:"text/plain"})}setColumnData(e,s){let o=this.columnIndex[e];if(!o)throw`column ${e} is not present in data store`;let a=null;if(Array.isArray(s)?a=this._convertColumn(o,s):a=s,o.buffer=a,o.datatype==="integer"||o.datatype=="double"||o.datatype==="int32"){const d=o.data=o.datatype==="int32"?new Int32Array(a):new Float32Array(a);if(!o.minMax){let g=Number.MAX_VALUE,_=Number.MIN_VALUE;for(let j=0;j<d.length;j++){let _e=d[j];isNaN(_e)||(g=_e<g?_e:g,_=_e>_?_e:_)}o.minMax=[g,_]}if(!o.quantiles){const g=o.data.filter(_=>!isNaN(_)).sort();o.quantiles={};for(let _ of[.05,.01,.001])o.quantiles[_]=[quantileSorted(g,_),quantileSorted(g,1-_)]}}else o.datatype==="multitext"?o.data=new Uint16Array(a):o.data=new Uint8Array(a);this.columnsWithData.push(e)}appendColumnData(e,s,o){let a=this.columnIndex[e],d=Uint8Array,g=o;a.datatype==="integer"||a.datatype==="double"?(g=g*4,d=Float32Array):a.datatype==="int32"?(g=g*4,d=Int32Array):a.datatype==="unique"&&(g=g*a.stringLength);let _=new SharedArrayBuffer(g),j=new d(_);j.set(a.data),j.set(new d(s),a.data.length),a.data=j,a.buffer=_}addDataToStore(e,s){const o=s+this.size;for(let g of e)this.appendColumnData(g.column,g.data,o);let a=new SharedArrayBuffer(o),d=new Uint8Array(a);d.set(this.filterArray),this.filterBuffer=a,this.filterArray=d,this.size=o,this.filterSize+=s;for(let g of this.dimensions)g.updateSize();this._callListeners("data_added",this.size)}cleanColumnData(e){const s={},o=this.columnIndex[e];for(let g in o.values)s[g]=0;for(let g=0;g<this.size;g++)s[o.data[g]]++;const a=[],d={};for(let g=0;g<o.values.length;g++)s[g]!==0&&(a.push(o.values[g]),d[g]=a.length-1);for(let g=0;g<this.size;g++)o.data[g]=d[o.data[g]];o.values=a,this.setColumnIsDirty(e),this.dataChanged([e])}_convertColumn(e,s){const o=s.length;if(e.datatype==="text"){const a=new SharedArrayBuffer(this.size),d={};for(let _e=0;_e<o;_e++){const et=s[_e];d[et]===void 0?d[et]=1:d[et]++}const g=[];for(let _e in d)g.push([_e,d[_e]]);e.values=[];const _={};g.sort((_e,et)=>et[1]-_e[1]);for(let _e=0;_e<g.length;_e++)e.values.push(g[_e][0]),_[g[_e][0]]=_e;const j=new Uint8Array(a);for(let _e=0;_e<o;_e++)j[_e]=_[s[_e]];return a}else if(e.datatype==="integer"||e.datatype==="double"||e.datatype==="int32"){const a=new SharedArrayBuffer(this.size*4),d=e.datatype==="int32"?new Int32Array(a):new Float32Array(a);for(let g=0;g<o;g++)d[g]=s[g];return a}else if(e.datatype==="multitext"){let a=new Set,d=0;for(let tt=0;tt<o;tt++){const it=s[tt].split(",");d=Math.max(d,it.length),it.forEach(ot=>a.add(ot.trim()))}a.delete("");const g=new SharedArrayBuffer(this.size*d*2),_=new Uint16Array(g);_.fill(65535);const j=new Array(a.size),_e={};let et=0;for(let tt of a)_e[tt]=et,j[et]=tt,et++;for(let tt=0;tt<o;tt++){const rt=tt*d,it=s[tt];if(it==="")continue;const ot=it.split(",");ot.sort();for(let ct=0;ct<ot.length;ct++)_[rt+ct]=_e[ot[ct].trim()]}return e.values=j,e.stringLength=d,g}else{let a=0;for(let _=0;_<o;_++)a=Math.max(a,s[_].length);e.stringLength=a;const d=new TextEncoder,g=new SharedArrayBuffer(this.size*a);for(let _=0;_<o;_++){const j=d.encode(s[_].substring(0,a));new Uint8Array(g,_*a,a).set(j,0)}return g}}getColorFunction(e,s={}){const o=this.columnIndex[e],a=o.data,d=s.overideValues||{};let g=this.getColumnColors(e,s);if(o.datatype==="text")return _=>g[a[_]];if(o.datatype==="integer"||o.datatype==="double"||o.datatype==="int32"){const _=d.min==null?o.minMax[0]:d.min,j=d.max==null?o.minMax[1]:d.max,_e=s.bins||100,et=(j-_)/_e,tt=s.asArray?[255,255,255]:"#ffffff";return s.useValue?rt=>{if(isNaN(rt))return tt;let it=Math.floor((rt-_)/et);return it<0?it=0:it>=g.length&&(it=g.length-1),g[it]}:rt=>{const it=a[rt];if(isNaN(it))return tt;let ot=Math.floor((it-_)/et);return ot<0?ot=0:ot>=g.length&&(ot=g.length-1),g[ot]}}}getColorForCategory(e,s){const a=this.columnIndex[e].values.indexOf(s);return this.getColumnColors(e)[a]}getColorLegend(e,s={}){const o=this.getColumnColors(e,s),a=this.columnIndex[e],d=s.name||a.name;if(a.datatype==="integer"||a.datatype==="double"||a.datatype==="int32"){let g=a.minMaX;if(s.overideValues){const _=s.overideValues;g=[_.min==null?a.minMax[0]:_.min,_.max==null?a.minMax[1]:_.max]}return getColorBar(o,{range:g,label:d})}if(a.datatype==="text")return getColorLegend(o,a.values,{label:d})}getValueToColor(e){const s={},o=this.getColumnColors(e),a=this.getColumnValues(e);for(let d=0;d<a.length;d++)s[a[d]]=o[d];return s}getColumnQuantile(e,s){const o=this.columnIndex[e];if(s&&s!=="none"){if(o.quantiles&&o.quantiles!=="NA")return[o.quantiles[s][0],o.quantiles[s][1]]}else return o.minMax}setColumnColors(e,s,o=!1){const a=this.columnIndex[e];if(s.length!==a.values.length)throw new Error(`${e} being set with incorrect number of columns `);a.colors=s.slice(0),this.dirtyColumns.colors_changed[e]=!0,o&&this.dataChanged([e],!1)}getColumnColors(e,s={}){const o=this.columnIndex[e],a=s.asArray;if(o.datatype==="double"||o.datatype==="integer"||o.datattype==="int32"){const d=s.overideValues||{},g=d.colors||o.colors||defaultIPalette,_=d.min||o.minMax[0],j=d.max||o.minMax[1],_e=linspace(_,j,g.length),et=linear$1().domain(_e).range(g).clamp(!0),tt=s.bins||100,rt=(j-_)/tt;let it=new Array(tt+1);for(let ct=0;ct<tt+1;ct++)it[ct]=et(_+ct*rt),a&&(it[ct]=rgbToRGB(it[ct]));let ot=o.colorLogScale;if(d.colorLogScale!=null&&(ot=d.colorLogScale),ot){const ct=symlog().domain([_,j]).range([0,tt]).clamp(!0),ft=new Array(tt+1);for(let dt=0;dt<tt+1;dt++)ft[dt]=it[Math.floor(ct(_+dt*rt))];it=ft}return it}else if(o.datatype==="text"||o.datatype==="multitext"){let d=o.colors;if(!d){const g=o.values.length,_=defaultPalette.length;if(g<_)d=defaultPalette.slice(0,g);else{d=[];const j=Math.floor(g/_);for(let _e=0;_e<j;_e++)d=d.concat(defaultPalette);d=d.concat(defaultPalette.slice(0,g%_))}}return a&&(d=d.map(g=>hexToRGB(g))),d}}addColumnGroup(e){e.columns||(e.columns=[]),this.columnGroups[e.name]=e}getColumnGroup(e){const s=this.columnGroups[e];return s?s.columns:null}getRawColumn(e){return this.columnIndex[e].data}getMinMaxForColumn(e){return this.columnIndex[e].minMax}getColumnRange(e){const s=this.columnIndex[e];return s.minMax?s.minMax[1]-s.minMax[0]:(console.error("unknown minMax for column "+e),[0,50])}getColumnInfo(e){const s=this.columnIndex[e];return{name:s.name,field:s.field,datatype:s.datatype,stringLength:s.stringLength,subgroup:s.subgroup,sgindex:s.sgindex,sgtype:s.sgtype}}getLoadedColumns(){return this.columns.filter(e=>e.data!=null).map(e=>e.field)}getAllColumns(){return this.columns.map(e=>e.field)}getColumnValues(e){return this.columnIndex[e].values}getColumnName(e){const s=this.columnIndex[e];return s?s.name:null}removeColumn(e,s=!1,o=!1){const a=this.columnIndex[e];a.data=null,a.buffer=null,this.columns=this.columns.filter(g=>g.field!==e),delete this.columnIndex[e];const d=this.columnsWithData.indexOf(e);d!==-1&&this.columnsWithData.splice(d,1),s&&(this.dirtyColumns.added[e]?delete this.dirtyColumns.added[e]:this.dirtyColumns.removed[e]=!0),o&&this._callListeners("column_removed",e)}}function linspace(i,e,s){for(var o=[],a=(e-i)/(s-1),d=0;d<s-1;)o.push(i+d*a),d++;return o.push(e),o}function hexToRGB(i){i=i.replace("#","");var e=parseInt(i,16),s=e>>16&255,o=e>>8&255,a=e&255;return[s,o,a]}function RGBToHex(i){return"#"+i.map(e=>{const s=e.toString(16);return s.length===1?"0"+s:s}).join("")}function rgbToRGB(i){return i?(i=i.substring(4,i.length-1).split(", "),i.map(e=>parseInt(e))):[255,255,255]}const defaultPalette=["#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#1CE6FF","#FF34FF","#FF4A46","#008941","#676FA6","#A30059","#FFDBE5","#7A4900","#0000A6","#63FFAC","#B79762","#004D43","#8FB0FF","#997D87","#5A0007","#809693","#FEFFE6","#1B4400","#4FC601","#3B5DFF","#4A3B53","#FF2F80","#61615A","#BA0900","#6B7900","#00C2A0","#FFAA92","#FF90C9","#B903AA","#D16100","#DDEFFF","#000035","#7B4F4B","#A1C299","#300018","#0AA6D8","#013349","#00846F","#372101","#FFB500","#C2FFED","#A079BF","#CC0744","#C0B9B2","#C2FF99","#001E09","#00489C","#6F0062","#0CBD66","#EEC3FF","#456D75","#B77B68","#7A87A1","#788D66","#885578","#FAD09F","#FF8A9A","#D157A0","#BEC459","#456648","#0086ED","#886F4C","#34362D","#B4A8BD","#00A6AA","#452C2C","#636375","#A3C8C9","#FF913F","#938A81","#575329","#00FECF","#B05B6F","#8CD0FF","#3B9700","#04F757","#C8A1A1","#1E6E00","#7900D7","#A77500","#6367A9","#A05837","#6B002C","#772600","#D790FF","#9B9700","#549E79","#FFF69F","#201625","#72418F","#BC23FF","#99ADC0","#3A2465","#922329","#5B4534","#FDE8DC"],defaultIPalette=["#3288bd","#66c2a5","#abdda4","#e6f598","#fee08b","#fdae61","#f46d43","#d53e4f"];class CustomDialog extends BaseDialog{constructor(e){e.buttons&&(e.footer=!0,e._buttons=e.buttons,delete e.buttons),e.width=e.width||300,super(e,e)}init(e){if(this.controlValues={},this.controls={},e._buttons)for(let s of e._buttons)this.addButton(s);if(e.text){const s=createEl("div",{},this.dialog);s.innerHTML=e.text}if(e.controls)for(let s of e.controls){s.id||(s.id=s.label);let o=createEl("div",{styles:{padding:"5px"}},this.dialog);if(s.type!=="button"){const a=s.type==="checkbox"?"inline":"block";createEl("label",{text:s.label,styles:{fontWeight:"bold",display:a,marginBottom:"3px"}},o)}this[s.type](s,o),s.description&&createEl("div",{text:s.description,styles:{fontSize:"12px"}},o)}}radiobuttons(e,s){const o=createEl("div",{},s);this.controlValues[e.id]=e.current_value;for(let a of e.choices){createEl("span",{text:a[0]},o);const d=createEl("input",{type:"radio",name:e.label,value:a[1]},o);d.checked=e.current_value===a[1],d.addEventListener("click",g=>{const _=g.currentTarget.value;this.controlValues[e.id]=_,e.func&&e.func(_,this)})}}slider(e,s){const o=createEl("div",{},s);noUiSlider.create(o,{start:[e.current_value],range:{min:[e.min],max:[e.max]},step:e.step||null,tooltips:!0,documentElement:e.doc||document}),this.controlValues[e.id]=e.current_value,o.noUiSlider.on("end",a=>{const d=parseFloat(a[0]);this.controlValues[e.id]=d,e.func&&e.func(d)})}changeDropDownContent(e,s){const o=this.controls[e];for(;o.length!==0;)o.remove(0);for(let a of s)createEl("option",{text:a.text,value:a.value},o);this.controlValues[e]=o.value}dropdown(e,s){const o=createEl("select",{styles:{maxWidth:"200px"}});for(let a of e.items)createEl("option",{text:a.text,value:a.value},o);s.append(o),e.current_value&&(o.value=e.current_value),this.controlValues[e.id]=o.value,o.addEventListener("change",a=>{this.controlValues[e.id]=o.value,e.func&&e.func(o.value,this)}),this.controls[e.id]=o}checkboxgroup(e,s){const o=this,a=createEl("div",{},s);function d(_,j){createEl("button",{text:_,classes:["ciview-button-sm"]},a).addEventListener("click",()=>{for(let et of e.checkboxes)o.controls[et.id].checked=j,o.controlValues[et.id]=j})}d("Check All",!0),d("Uncheck All",!1);const g=createEl("div",{},s);for(let _ of e.checkboxes){const j=createEl("div",{styles:{display:"inline-block",padding:"3px"}},g);createEl("span",{styles:{fontSize:"13px"},text:_.label},j),_.id=`${e.id}_${_.id}`,this.checkbox(_,j)}}checkbox(e,s){const o=e.current_value,a=createEl("input",{type:"checkbox",classes:["mdv-checkbox"]},s);a.checked=e.current_value,this.controlValues[e.id]=o,a.addEventListener("click",d=>{this.controlValues[e.id]=a.checked,e.func&&e.func(a.checked)}),this.controls[e.id]=a}text(e,s){const o=e.defaultValue||"",a=createEl("input",{value:o},s);this.controlValues[e.id]=o,a.addEventListener("keyup",()=>{this.controlValues[e.id]=a.value}),this.controls[e.id]=a}buttonClicked(e){e.method(this.controlValues,this.controls)!=="noclose"&&this.close()}addButton(e){createEl("button",{text:e.text,classes:["ciview-button"]},this.footer).addEventListener("click",()=>this.buttonClicked(e))}}const linear=i=>+i;function cubicInOut(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var noop$4={value:()=>{}};function dispatch(){for(var i=0,e=arguments.length,s={},o;i<e;++i){if(!(o=arguments[i]+"")||o in s||/[\s.]/.test(o))throw new Error("illegal type: "+o);s[o]=[]}return new Dispatch(s)}function Dispatch(i){this._=i}function parseTypenames(i,e){return i.trim().split(/^|\s+/).map(function(s){var o="",a=s.indexOf(".");if(a>=0&&(o=s.slice(a+1),s=s.slice(0,a)),s&&!e.hasOwnProperty(s))throw new Error("unknown type: "+s);return{type:s,name:o}})}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(i,e){var s=this._,o=parseTypenames(i+"",s),a,d=-1,g=o.length;if(arguments.length<2){for(;++d<g;)if((a=(i=o[d]).type)&&(a=get$1(s[a],i.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++d<g;)if(a=(i=o[d]).type)s[a]=set$1(s[a],i.name,e);else if(e==null)for(a in s)s[a]=set$1(s[a],i.name,null);return this},copy:function(){var i={},e=this._;for(var s in e)i[s]=e[s].slice();return new Dispatch(i)},call:function(i,e){if((a=arguments.length-2)>0)for(var s=new Array(a),o=0,a,d;o<a;++o)s[o]=arguments[o+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(d=this._[i],o=0,a=d.length;o<a;++o)d[o].value.apply(e,s)},apply:function(i,e,s){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var o=this._[i],a=0,d=o.length;a<d;++a)o[a].value.apply(e,s)}};function get$1(i,e){for(var s=0,o=i.length,a;s<o;++s)if((a=i[s]).name===e)return a.value}function set$1(i,e,s){for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i[o]=noop$4,i=i.slice(0,o).concat(i.slice(o+1));break}return s!=null&&i.push({name:e,value:s}),i}var frame=0,timeout$1=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance=="object"&&performance.now?performance:Date,setFrame=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function(i,e,s){if(typeof i!="function")throw new TypeError("callback is not a function");s=(s==null?now():+s)+(e==null?0:+e),!this._next&&taskTail!==this&&(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=i,this._time=s,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};function timer(i,e,s){var o=new Timer;return o.restart(i,e,s),o}function timerFlush(){now(),++frame;for(var i=taskHead,e;i;)(e=clockNow-i._time)>=0&&i._call.call(void 0,e),i=i._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout$1=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var i=clock.now(),e=i-clockLast;e>pokeDelay&&(clockSkew-=e,clockLast=i)}function nap(){for(var i,e=taskHead,s,o=1/0;e;)e._call?(o>e._time&&(o=e._time),i=e,e=e._next):(s=e._next,e._next=null,e=i?i._next=s:taskHead=s);taskTail=i,sleep(o)}function sleep(i){if(!frame){timeout$1&&(timeout$1=clearTimeout(timeout$1));var e=i-clockNow;e>24?(i<1/0&&(timeout$1=setTimeout(wake,i-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake))}}function timeout(i,e,s){var o=new Timer;return e=e==null?0:+e,o.restart(a=>{o.stop(),i(a+e)},e,s),o}var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(i,e,s,o,a,d){var g=i.__transition;if(!g)i.__transition={};else if(s in g)return;create$3(i,s,{name:e,index:o,group:a,on:emptyOn,tween:emptyTween,time:d.time,delay:d.delay,duration:d.duration,ease:d.ease,timer:null,state:CREATED})}function init(i,e){var s=get(i,e);if(s.state>CREATED)throw new Error("too late; already scheduled");return s}function set(i,e){var s=get(i,e);if(s.state>STARTED)throw new Error("too late; already running");return s}function get(i,e){var s=i.__transition;if(!s||!(s=s[e]))throw new Error("transition not found");return s}function create$3(i,e,s){var o=i.__transition,a;o[e]=s,s.timer=timer(d,0,s.time);function d(_e){s.state=SCHEDULED,s.timer.restart(g,s.delay,s.time),s.delay<=_e&&g(_e-s.delay)}function g(_e){var et,tt,rt,it;if(s.state!==SCHEDULED)return j();for(et in o)if(it=o[et],it.name===s.name){if(it.state===STARTED)return timeout(g);it.state===RUNNING?(it.state=ENDED,it.timer.stop(),it.on.call("interrupt",i,i.__data__,it.index,it.group),delete o[et]):+et<e&&(it.state=ENDED,it.timer.stop(),it.on.call("cancel",i,i.__data__,it.index,it.group),delete o[et])}if(timeout(function(){s.state===STARTED&&(s.state=RUNNING,s.timer.restart(_,s.delay,s.time),_(_e))}),s.state=STARTING,s.on.call("start",i,i.__data__,s.index,s.group),s.state===STARTING){for(s.state=STARTED,a=new Array(rt=s.tween.length),et=0,tt=-1;et<rt;++et)(it=s.tween[et].value.call(i,i.__data__,s.index,s.group))&&(a[++tt]=it);a.length=tt+1}}function _(_e){for(var et=_e<s.duration?s.ease.call(null,_e/s.duration):(s.timer.restart(j),s.state=ENDING,1),tt=-1,rt=a.length;++tt<rt;)a[tt].call(i,et);s.state===ENDING&&(s.on.call("end",i,i.__data__,s.index,s.group),j())}function j(){s.state=ENDED,s.timer.stop(),delete o[e];for(var _e in o)return;delete i.__transition}}function interrupt(i,e){var s=i.__transition,o,a,d=!0,g;if(s){e=e==null?null:e+"";for(g in s){if((o=s[g]).name!==e){d=!1;continue}a=o.state>STARTING&&o.state<ENDING,o.state=ENDED,o.timer.stop(),o.on.call(a?"interrupt":"cancel",i,i.__data__,o.index,o.group),delete s[g]}d&&delete i.__transition}}function selection_interrupt(i){return this.each(function(){interrupt(this,i)})}function tweenRemove(i,e){var s,o;return function(){var a=set(this,i),d=a.tween;if(d!==s){o=s=d;for(var g=0,_=o.length;g<_;++g)if(o[g].name===e){o=o.slice(),o.splice(g,1);break}}a.tween=o}}function tweenFunction(i,e,s){var o,a;if(typeof s!="function")throw new Error;return function(){var d=set(this,i),g=d.tween;if(g!==o){a=(o=g).slice();for(var _={name:e,value:s},j=0,_e=a.length;j<_e;++j)if(a[j].name===e){a[j]=_;break}j===_e&&a.push(_)}d.tween=a}}function transition_tween(i,e){var s=this._id;if(i+="",arguments.length<2){for(var o=get(this.node(),s).tween,a=0,d=o.length,g;a<d;++a)if((g=o[a]).name===i)return g.value;return null}return this.each((e==null?tweenRemove:tweenFunction)(s,i,e))}function tweenValue(i,e,s){var o=i._id;return i.each(function(){var a=set(this,o);(a.value||(a.value={}))[e]=s.apply(this,arguments)}),function(a){return get(a,o).value[e]}}function interpolate(i,e){var s;return(typeof e=="number"?interpolateNumber:e instanceof color?interpolateRgb:(s=color(e))?(e=s,interpolateRgb):interpolateString)(i,e)}function attrRemove(i){return function(){this.removeAttribute(i)}}function attrRemoveNS(i){return function(){this.removeAttributeNS(i.space,i.local)}}function attrConstant(i,e,s){var o,a=s+"",d;return function(){var g=this.getAttribute(i);return g===a?null:g===o?d:d=e(o=g,s)}}function attrConstantNS(i,e,s){var o,a=s+"",d;return function(){var g=this.getAttributeNS(i.space,i.local);return g===a?null:g===o?d:d=e(o=g,s)}}function attrFunction(i,e,s){var o,a,d;return function(){var g,_=s(this),j;return _==null?void this.removeAttribute(i):(g=this.getAttribute(i),j=_+"",g===j?null:g===o&&j===a?d:(a=j,d=e(o=g,_)))}}function attrFunctionNS(i,e,s){var o,a,d;return function(){var g,_=s(this),j;return _==null?void this.removeAttributeNS(i.space,i.local):(g=this.getAttributeNS(i.space,i.local),j=_+"",g===j?null:g===o&&j===a?d:(a=j,d=e(o=g,_)))}}function transition_attr(i,e){var s=namespace(i),o=s==="transform"?interpolateTransformSvg:interpolate;return this.attrTween(i,typeof e=="function"?(s.local?attrFunctionNS:attrFunction)(s,o,tweenValue(this,"attr."+i,e)):e==null?(s.local?attrRemoveNS:attrRemove)(s):(s.local?attrConstantNS:attrConstant)(s,o,e))}function attrInterpolate(i,e){return function(s){this.setAttribute(i,e.call(this,s))}}function attrInterpolateNS(i,e){return function(s){this.setAttributeNS(i.space,i.local,e.call(this,s))}}function attrTweenNS(i,e){var s,o;function a(){var d=e.apply(this,arguments);return d!==o&&(s=(o=d)&&attrInterpolateNS(i,d)),s}return a._value=e,a}function attrTween(i,e){var s,o;function a(){var d=e.apply(this,arguments);return d!==o&&(s=(o=d)&&attrInterpolate(i,d)),s}return a._value=e,a}function transition_attrTween(i,e){var s="attr."+i;if(arguments.length<2)return(s=this.tween(s))&&s._value;if(e==null)return this.tween(s,null);if(typeof e!="function")throw new Error;var o=namespace(i);return this.tween(s,(o.local?attrTweenNS:attrTween)(o,e))}function delayFunction(i,e){return function(){init(this,i).delay=+e.apply(this,arguments)}}function delayConstant(i,e){return e=+e,function(){init(this,i).delay=e}}function transition_delay(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?delayFunction:delayConstant)(e,i)):get(this.node(),e).delay}function durationFunction(i,e){return function(){set(this,i).duration=+e.apply(this,arguments)}}function durationConstant(i,e){return e=+e,function(){set(this,i).duration=e}}function transition_duration(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?durationFunction:durationConstant)(e,i)):get(this.node(),e).duration}function easeConstant(i,e){if(typeof e!="function")throw new Error;return function(){set(this,i).ease=e}}function transition_ease(i){var e=this._id;return arguments.length?this.each(easeConstant(e,i)):get(this.node(),e).ease}function easeVarying(i,e){return function(){var s=e.apply(this,arguments);if(typeof s!="function")throw new Error;set(this,i).ease=s}}function transition_easeVarying(i){if(typeof i!="function")throw new Error;return this.each(easeVarying(this._id,i))}function transition_filter(i){typeof i!="function"&&(i=matcher(i));for(var e=this._groups,s=e.length,o=new Array(s),a=0;a<s;++a)for(var d=e[a],g=d.length,_=o[a]=[],j,_e=0;_e<g;++_e)(j=d[_e])&&i.call(j,j.__data__,_e,d)&&_.push(j);return new Transition$1(o,this._parents,this._name,this._id)}function transition_merge(i){if(i._id!==this._id)throw new Error;for(var e=this._groups,s=i._groups,o=e.length,a=s.length,d=Math.min(o,a),g=new Array(o),_=0;_<d;++_)for(var j=e[_],_e=s[_],et=j.length,tt=g[_]=new Array(et),rt,it=0;it<et;++it)(rt=j[it]||_e[it])&&(tt[it]=rt);for(;_<o;++_)g[_]=e[_];return new Transition$1(g,this._parents,this._name,this._id)}function start(i){return(i+"").trim().split(/^|\s+/).every(function(e){var s=e.indexOf(".");return s>=0&&(e=e.slice(0,s)),!e||e==="start"})}function onFunction(i,e,s){var o,a,d=start(e)?init:set;return function(){var g=d(this,i),_=g.on;_!==o&&(a=(o=_).copy()).on(e,s),g.on=a}}function transition_on(i,e){var s=this._id;return arguments.length<2?get(this.node(),s).on.on(i):this.each(onFunction(s,i,e))}function removeFunction(i){return function(){var e=this.parentNode;for(var s in this.__transition)if(+s!==i)return;e&&e.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(i){var e=this._name,s=this._id;typeof i!="function"&&(i=selector(i));for(var o=this._groups,a=o.length,d=new Array(a),g=0;g<a;++g)for(var _=o[g],j=_.length,_e=d[g]=new Array(j),et,tt,rt=0;rt<j;++rt)(et=_[rt])&&(tt=i.call(et,et.__data__,rt,_))&&("__data__"in et&&(tt.__data__=et.__data__),_e[rt]=tt,schedule(_e[rt],e,s,rt,_e,get(et,s)));return new Transition$1(d,this._parents,e,s)}function transition_selectAll(i){var e=this._name,s=this._id;typeof i!="function"&&(i=selectorAll(i));for(var o=this._groups,a=o.length,d=[],g=[],_=0;_<a;++_)for(var j=o[_],_e=j.length,et,tt=0;tt<_e;++tt)if(et=j[tt]){for(var rt=i.call(et,et.__data__,tt,j),it,ot=get(et,s),ct=0,ft=rt.length;ct<ft;++ct)(it=rt[ct])&&schedule(it,e,s,ct,rt,ot);d.push(rt),g.push(et)}return new Transition$1(d,g,e,s)}var Selection=selection.prototype.constructor;function transition_selection(){return new Selection(this._groups,this._parents)}function styleNull(i,e){var s,o,a;return function(){var d=styleValue(this,i),g=(this.style.removeProperty(i),styleValue(this,i));return d===g?null:d===s&&g===o?a:a=e(s=d,o=g)}}function styleRemove(i){return function(){this.style.removeProperty(i)}}function styleConstant(i,e,s){var o,a=s+"",d;return function(){var g=styleValue(this,i);return g===a?null:g===o?d:d=e(o=g,s)}}function styleFunction(i,e,s){var o,a,d;return function(){var g=styleValue(this,i),_=s(this),j=_+"";return _==null&&(j=_=(this.style.removeProperty(i),styleValue(this,i))),g===j?null:g===o&&j===a?d:(a=j,d=e(o=g,_))}}function styleMaybeRemove(i,e){var s,o,a,d="style."+e,g="end."+d,_;return function(){var j=set(this,i),_e=j.on,et=j.value[d]==null?_||(_=styleRemove(e)):void 0;(_e!==s||a!==et)&&(o=(s=_e).copy()).on(g,a=et),j.on=o}}function transition_style(i,e,s){var o=(i+="")=="transform"?interpolateTransformCss:interpolate;return e==null?this.styleTween(i,styleNull(i,o)).on("end.style."+i,styleRemove(i)):typeof e=="function"?this.styleTween(i,styleFunction(i,o,tweenValue(this,"style."+i,e))).each(styleMaybeRemove(this._id,i)):this.styleTween(i,styleConstant(i,o,e),s).on("end.style."+i,null)}function styleInterpolate(i,e,s){return function(o){this.style.setProperty(i,e.call(this,o),s)}}function styleTween(i,e,s){var o,a;function d(){var g=e.apply(this,arguments);return g!==a&&(o=(a=g)&&styleInterpolate(i,g,s)),o}return d._value=e,d}function transition_styleTween(i,e,s){var o="style."+(i+="");if(arguments.length<2)return(o=this.tween(o))&&o._value;if(e==null)return this.tween(o,null);if(typeof e!="function")throw new Error;return this.tween(o,styleTween(i,e,s??""))}function textConstant(i){return function(){this.textContent=i}}function textFunction(i){return function(){var e=i(this);this.textContent=e??""}}function transition_text(i){return this.tween("text",typeof i=="function"?textFunction(tweenValue(this,"text",i)):textConstant(i==null?"":i+""))}function textInterpolate(i){return function(e){this.textContent=i.call(this,e)}}function textTween(i){var e,s;function o(){var a=i.apply(this,arguments);return a!==s&&(e=(s=a)&&textInterpolate(a)),e}return o._value=i,o}function transition_textTween(i){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(i==null)return this.tween(e,null);if(typeof i!="function")throw new Error;return this.tween(e,textTween(i))}function transition_transition(){for(var i=this._name,e=this._id,s=newId(),o=this._groups,a=o.length,d=0;d<a;++d)for(var g=o[d],_=g.length,j,_e=0;_e<_;++_e)if(j=g[_e]){var et=get(j,e);schedule(j,i,s,_e,g,{time:et.time+et.delay+et.duration,delay:0,duration:et.duration,ease:et.ease})}return new Transition$1(o,this._parents,i,s)}function transition_end(){var i,e,s=this,o=s._id,a=s.size();return new Promise(function(d,g){var _={value:g},j={value:function(){--a===0&&d()}};s.each(function(){var _e=set(this,o),et=_e.on;et!==i&&(e=(i=et).copy(),e._.cancel.push(_),e._.interrupt.push(_),e._.end.push(j)),_e.on=e}),a===0&&d()})}var id$1=0;function Transition$1(i,e,s,o){this._groups=i,this._parents=e,this._name=s,this._id=o}function newId(){return++id$1}var selection_prototype=selection.prototype;Transition$1.prototype={constructor:Transition$1,select:transition_select,selectAll:transition_selectAll,selectChild:selection_prototype.selectChild,selectChildren:selection_prototype.selectChildren,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition:transition_transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,textTween:transition_textTween,remove:transition_remove,tween:transition_tween,delay:transition_delay,duration:transition_duration,ease:transition_ease,easeVarying:transition_easeVarying,end:transition_end,[Symbol.iterator]:selection_prototype[Symbol.iterator]};var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(i,e){for(var s;!(s=i.__transition)||!(s=s[e]);)if(!(i=i.parentNode))throw new Error(`transition ${e} not found`);return s}function selection_transition(i){var e,s;i instanceof Transition$1?(e=i._id,i=i._name):(e=newId(),(s=defaultTiming).time=now(),i=i==null?null:i+"");for(var o=this._groups,a=o.length,d=0;d<a;++d)for(var g=o[d],_=g.length,j,_e=0;_e<_;++_e)(j=g[_e])&&schedule(j,i,e,_e,g,s||inherit(j,e));return new Transition$1(o,this._parents,i,e)}selection.prototype.interrupt=selection_interrupt;selection.prototype.transition=selection_transition;function defaultSeparation(i,e){return i.parent===e.parent?1:2}function meanX(i){return i.reduce(meanXReduce,0)/i.length}function meanXReduce(i,e){return i+e.x}function maxY(i){return 1+i.reduce(maxYReduce,0)}function maxYReduce(i,e){return Math.max(i,e.y)}function leafLeft(i){for(var e;e=i.children;)i=e[0];return i}function leafRight(i){for(var e;e=i.children;)i=e[e.length-1];return i}function cluster(){var i=defaultSeparation,e=1,s=1,o=!1;function a(d){var g,_=0;d.eachAfter(function(rt){var it=rt.children;it?(rt.x=meanX(it),rt.y=maxY(it)):(rt.x=g?_+=i(rt,g):0,rt.y=0,g=rt)});var j=leafLeft(d),_e=leafRight(d),et=j.x-i(j,_e)/2,tt=_e.x+i(_e,j)/2;return d.eachAfter(o?function(rt){rt.x=(rt.x-d.x)*e,rt.y=(d.y-rt.y)*s}:function(rt){rt.x=(rt.x-et)/(tt-et)*e,rt.y=(1-(d.y?rt.y/d.y:1))*s})}return a.separation=function(d){return arguments.length?(i=d,a):i},a.size=function(d){return arguments.length?(o=!1,e=+d[0],s=+d[1],a):o?null:[e,s]},a.nodeSize=function(d){return arguments.length?(o=!0,e=+d[0],s=+d[1],a):o?[e,s]:null},a}function count$1(i){var e=0,s=i.children,o=s&&s.length;if(!o)e=1;else for(;--o>=0;)e+=s[o].value;i.value=e}function node_count(){return this.eachAfter(count$1)}function node_each(i,e){let s=-1;for(const o of this)i.call(e,o,++s,this);return this}function node_eachBefore(i,e){for(var s=this,o=[s],a,d,g=-1;s=o.pop();)if(i.call(e,s,++g,this),a=s.children)for(d=a.length-1;d>=0;--d)o.push(a[d]);return this}function node_eachAfter(i,e){for(var s=this,o=[s],a=[],d,g,_,j=-1;s=o.pop();)if(a.push(s),d=s.children)for(g=0,_=d.length;g<_;++g)o.push(d[g]);for(;s=a.pop();)i.call(e,s,++j,this);return this}function node_find(i,e){let s=-1;for(const o of this)if(i.call(e,o,++s,this))return o}function node_sum(i){return this.eachAfter(function(e){for(var s=+i(e.data)||0,o=e.children,a=o&&o.length;--a>=0;)s+=o[a].value;e.value=s})}function node_sort(i){return this.eachBefore(function(e){e.children&&e.children.sort(i)})}function node_path(i){for(var e=this,s=leastCommonAncestor(e,i),o=[e];e!==s;)e=e.parent,o.push(e);for(var a=o.length;i!==s;)o.splice(a,0,i),i=i.parent;return o}function leastCommonAncestor(i,e){if(i===e)return i;var s=i.ancestors(),o=e.ancestors(),a=null;for(i=s.pop(),e=o.pop();i===e;)a=i,i=s.pop(),e=o.pop();return a}function node_ancestors(){for(var i=this,e=[i];i=i.parent;)e.push(i);return e}function node_descendants(){return Array.from(this)}function node_leaves(){var i=[];return this.eachBefore(function(e){e.children||i.push(e)}),i}function node_links(){var i=this,e=[];return i.each(function(s){s!==i&&e.push({source:s.parent,target:s})}),e}function*node_iterator(){var i=this,e,s=[i],o,a,d;do for(e=s.reverse(),s=[];i=e.pop();)if(yield i,o=i.children)for(a=0,d=o.length;a<d;++a)s.push(o[a]);while(s.length)}function hierarchy(i,e){i instanceof Map?(i=[void 0,i],e===void 0&&(e=mapChildren)):e===void 0&&(e=objectChildren);for(var s=new Node(i),o,a=[s],d,g,_,j;o=a.pop();)if((g=e(o.data))&&(j=(g=Array.from(g)).length))for(o.children=g,_=j-1;_>=0;--_)a.push(d=g[_]=new Node(g[_])),d.parent=o,d.depth=o.depth+1;return s.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function objectChildren(i){return i.children}function mapChildren(i){return Array.isArray(i)?i[1]:null}function copyData(i){i.data.value!==void 0&&(i.value=i.data.value),i.data=i.data.data}function computeHeight(i){var e=0;do i.height=e;while((i=i.parent)&&i.height<++e)}function Node(i){this.data=i,this.depth=this.height=0,this.parent=null}Node.prototype=hierarchy.prototype={constructor:Node,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,find:node_find,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy,[Symbol.iterator]:node_iterator};class SVGChart extends BaseChart{constructor(e,s,o,a={}){super(e,s,o),this.svg=select(this.contentDiv).append("svg").attr("width",this.width).attr("height",this.height),this.config.axis=this.config.axis||{};const d=this.config.axis;function g(et,tt,rt){et[tt]==null&&(et[tt]=rt)}for(let et of[["x",25],["y",40],["ry",25],["tx",25]]){const tt=a[et[0]];if(tt){d[et[0]]=d[et[0]]||{};const rt=d[et[0]];g(rt,"textSize",13),g(rt,"label",""),g(rt,"size",tt.size||et[1]),g(rt,"tickfont",10)}}this._setMargins(),this.graph_area=this.svg.append("g").attr("transform",`translate(${this.margins.left},${this.margins.top})`),this.ry_axis_svg=this.svg.append("g"),this.tx_axis_svg=this.svg.append("g"),this.x_axis_svg=this.svg.append("g"),this.y_axis_svg=this.svg.append("g");const _=a.x;_&&(_.custom||(this.x_scale=_.type==="band"?band():linear$1(),this.x_axis_call=axisBottom(this.x_scale)),this.x_axis_label=this.x_axis_svg.append("text").style("text-anchor","middle").style("fill","black").attr("alignment-baseline","auto"));const j=a.y;j&&(j.custom||(this.y_scale=j.type==="band"?band():linear$1(),this.y_axis_call=axisLeft(this.y_scale)),this.y_axis_label=this.y_axis_svg.append("text").attr("text-anchor","middle").style("fill","black").attr("alignment-baseline","auto"));const _e=a.ry;_e&&_e.label&&(this.ry_axis_label=this.ry_axis_svg.append("text").attr("text-anchor","middle").style("fill","black").attr("alignment-baseline","text-top"))}_setMargins(){const e=this.config.axis;this.margins={top:e.tx?e.tx.size:10,right:e.ry?e.ry.size:10,bottom:e.x?e.x.size:10,left:e.y?e.y.size:10}}_getContentDimensions(){return{top:this.margins.top,left:this.margins.left,height:this.height-this.margins.bottom-this.margins.top,width:this.width-this.margins.left-this.margins.right}}setAxisSize(e,s){switch(e){case"tx":this.margins.top=s;break;case"y":this.config.axis.y.size=s,this.margins.left=s;break;case"x":this.config.axis.x.size=s,this.margins.bottom=s}this.graph_area.attr("transform",`translate(${this.margins.left},${this.margins.top})`)}updateAxis(){const e=this._getContentDimensions(),s=this.config.axis;if(this.ry_axis_svg.attr("transform",`translate(${e.left+e.width},${e.top})`),this.tx_axis_svg.attr("transform",`translate(${e.left},0)`),this.x_axis_svg.attr("transform",`translate(${e.left},${this.height-this.margins.bottom})`),this.y_axis_svg.attr("transform",`translate(${e.left},${e.top})`),s.x&&(this.x_scale&&(this.x_scale.range([0,e.width]),this.x_axis_svg.selectAll(".tick text").attr("font-family","Helvetica"),this.x_axis_svg.transition().call(this.x_axis_call),s.x.rotate_labels?this.x_axis_svg.selectAll(".tick text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".10em").attr("transform","rotate(-45)"):this.x_axis_svg.selectAll(".tick text").style("text-anchor",null).attr("dx",null).attr("dy",".71em").attr("transform",null),this.x_axis_svg.selectAll(".tick text").attr("font-size",s.x.tickfont)),this.x_axis_label.attr("x",e.width/2).attr("y",this.margins.bottom-4).text(this.config.axis.x.label).attr("font-size",this.config.axis.x.textsize+"px").attr("font-family","Helvetica")),s.y){if(this.y_scale){if(this.y_scale.range([0,e.height]),e.height/this.y_scale.domain().length<8){const a=Math.round(this.y_scale.domain().length/(e.height/10));this.y_axis_call.tickFormat((d,g)=>g%a==0?d:"")}else this.y_axis_call.tickFormat(null);this.y_axis_svg.transition().call(this.y_axis_call),s.y.rotate_labels?this.y_axis_svg.selectAll(".tick text").style("text-anchor","end").attr("dy","1em").attr("transform","rotate(+45)"):this.y_axis_svg.selectAll(".tick text").style("text-anchor",null).attr("dx",null).attr("dy","0.32em").attr("transform",null),this.y_axis_svg.selectAll(".tick text").attr("font-size",s.y.tickfont).attr("font-family","Helvetica")}this.y_axis_label.attr("x",-e.height/2).attr("y",-e.left+10).attr("transform","rotate(-90)").text(this.config.axis.y.label).attr("font-size",this.config.axis.y.textsize+"px").attr("font-family","Helvetica")}this.ry_axis_label&&this.ry_axis_label.attr("x",e.height/2).attr("y",-this.margins.right+15).attr("transform","rotate(90)").text(this.config.axis.ry.label).attr("font-size",this.config.axis.ry.textsize+"px")}setSize(e,s){super.setSize(e,s),this.svg&&this.svg.attr("width",this.width).attr("height",this.height)}drawXTree(e,s,o,a){select(this.contentDiv).transition().duration(400).ease(linear);const d=this._getContentDimensions(),j=cluster().size([d.width,o])(e).descendants(),_e=d.width/s;for(let et of j)et.children||(et.x=_e/2+_e*et.data.order);for(let et of j)if(!et.children){let tt=et.parent;for(;tt;)tt.x=tt.children[0].x+(tt.children[1].x-tt.children[0].x)/2,tt=tt.parent}this.tx_axis_svg.selectAll(".tree-link").data(j.slice(1)).join("path").attr("class","tree-link").style("stroke","currentColor").style("fill","none").style("stroke-width","1px").transition("trans").attr("d",et=>{let tt=et.x;return et.children||(tt=_e/2+_e*et.data.order),`M ${tt} ${et.y+a} L${tt} ${et.parent.y+a} L${et.parent.x} ${et.parent.y+a}`})}drawYTree(e,s){select(this.contentDiv).transition().duration(400).ease(linear);const o=this._getContentDimensions(),a=this.margins.right,_=cluster().size([o.height,a])(e).descendants(),j=o.height/s;for(let _e of _)_e.children||(_e.x=j/2+j*_e.data.order);for(let _e of _)if(!_e.children){let et=_e.parent;for(;et;)et.x=et.children[0].x+(et.children[1].x-et.children[0].x)/2,et=et.parent}this.ry_axis_svg.selectAll(".tree-link").data(_.slice(1)).join("path").attr("class","tree-link").style("stroke","currentColor").style("fill","none").style("stroke-width","1px").transition("trans").attr("d",_e=>{let et=_e.x;return _e.children||(et=j/2+j*_e.data.order),`M ${a-_e.y} ${et} L${a-_e.parent.y} ${et} L${a-_e.parent.y} ${_e.parent.x}`})}getSettings(){const e=super.getSettings(),s=this.config;let o=[];return this.config.axis.y&&(o=o.concat([{type:"check",current_value:s.axis.y.rotate_labels,label:"Rotate Y axis labels",func:a=>{s.axis.y.rotate_labels=a,this.setSize()}},{type:"slider",max:20,min:4,step:1,doc:this.__doc__,current_value:s.axis.y.tickfont,label:"Y axis text size",func:a=>{s.axis.y.tickfont=a,this.setSize()}},{type:"slider",max:200,min:20,step:1,doc:this.__doc__,current_value:s.axis.y.size,label:"Y axis width",func:a=>{this.setAxisSize("y",a),this.setSize()}}])),this.config.axis.x&&(o=o.concat([{type:"check",current_value:s.axis.x.rotate_labels,label:"Rotate X axis labels",func:a=>{s.axis.x.rotate_labels=a,this.updateAxis()}},{type:"slider",max:20,min:4,step:1,doc:this.__doc__,current_value:s.axis.x.tickfont,label:"X axis text size",func:a=>{s.axis.x.tickfont=a,this.setSize()}},{type:"slider",max:200,min:20,step:1,doc:this.__doc__,current_value:s.axis.x.size,label:"X axis Height",func:a=>{this.setAxisSize("x",a),this.setSize()}}])),e.concat(o)}_addLegendToSVG(e){const s=this[e];if(!s)return;const o=[s.offsetLeft,s.offsetTop];s._leg=s.querySelector("g"),s._leg_g=select(s._leg).attr("transform",`translate(${o[0]},${o[1]})`),this.svg.node().append(s._leg_g.node())}_removeLegendFromSVG(e){const s=this[e];s&&(s._leg_g.attr("transform","translate(0,0)"),this.legend.querySelector("svg").append(s._leg),delete this.legend._leg,delete this.legend._leg_g)}getImage(e,s){this.addToImage&&this.addToImage(),this._addLegendToSVG("legend"),this.extra_legends&&this.extra_legends.forEach(a=>this._addLegendToSVG(a));const o=new XMLSerializer().serializeToString(this.svg.node());s==="png"?this.getImageFromSVG(this.svg.node(),a=>{e(a),this.removeFromImage&&this.removeFromImage(),this._removeLegendFromSVG("legend"),this.extra_legends&&this.extra_legends.forEach(d=>this._removeLegendFromSVG(d))}):(e(o),this.removeFromImage&&this.removeFromImage(),this._removeLegendFromSVG("legend"),this.extra_legends&&this.extra_legends.forEach(a=>this._removeLegendFromSVG(a)))}}const nonpassivecapture={capture:!0,passive:!1};function noevent$1(i){i.preventDefault(),i.stopImmediatePropagation()}function dragDisable(i){var e=i.document.documentElement,s=select(i).on("dragstart.drag",noevent$1,nonpassivecapture);"onselectstart"in e?s.on("selectstart.drag",noevent$1,nonpassivecapture):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function yesdrag(i,e){var s=i.document.documentElement,o=select(i).on("dragstart.drag",null);e&&(o.on("click.drag",noevent$1,nonpassivecapture),setTimeout(function(){o.on("click.drag",null)},0)),"onselectstart"in s?o.on("selectstart.drag",null):(s.style.MozUserSelect=s.__noselect,delete s.__noselect)}const constant$3=i=>()=>i;function BrushEvent(i,{sourceEvent:e,target:s,selection:o,mode:a,dispatch:d}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},selection:{value:o,enumerable:!0,configurable:!0},mode:{value:a,enumerable:!0,configurable:!0},_:{value:d}})}function nopropagation(i){i.stopImmediatePropagation()}function noevent(i){i.preventDefault(),i.stopImmediatePropagation()}var MODE_DRAG={name:"drag"},MODE_SPACE={name:"space"},MODE_HANDLE={name:"handle"},MODE_CENTER={name:"center"};const{abs:abs$2,max:max$1,min:min$1}=Math;function number1(i){return[+i[0],+i[1]]}function number2(i){return[number1(i[0]),number1(i[1])]}var X$1={name:"x",handles:["w","e"].map(type),input:function(i,e){return i==null?null:[[+i[0],e[0][1]],[+i[1],e[1][1]]]},output:function(i){return i&&[i[0][0],i[1][0]]}},Y$1={name:"y",handles:["n","s"].map(type),input:function(i,e){return i==null?null:[[e[0][0],+i[0]],[e[1][0],+i[1]]]},output:function(i){return i&&[i[0][1],i[1][1]]}},cursors={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},flipX={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},flipY={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},signsX={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},signsY={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function type(i){return{type:i}}function defaultFilter(i){return!i.ctrlKey&&!i.button}function defaultExtent(){var i=this.ownerSVGElement||this;return i.hasAttribute("viewBox")?(i=i.viewBox.baseVal,[[i.x,i.y],[i.x+i.width,i.y+i.height]]):[[0,0],[i.width.baseVal.value,i.height.baseVal.value]]}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function local(i){for(;!i.__brush;)if(!(i=i.parentNode))return;return i.__brush}function empty(i){return i[0][0]===i[1][0]||i[0][1]===i[1][1]}function brushX(){return brush(X$1)}function brush(i){var e=defaultExtent,s=defaultFilter,o=defaultTouchable,a=!0,d=dispatch("start","brush","end"),g=6,_;function j(ft){var dt=ft.property("__brush",ct).selectAll(".overlay").data([type("overlay")]);dt.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cursors.overlay).merge(dt).each(function(){var gt=local(this).extent;select(this).attr("x",gt[0][0]).attr("y",gt[0][1]).attr("width",gt[1][0]-gt[0][0]).attr("height",gt[1][1]-gt[0][1])}),ft.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cursors.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var pt=ft.selectAll(".handle").data(i.handles,function(gt){return gt.type});pt.exit().remove(),pt.enter().append("rect").attr("class",function(gt){return"handle handle--"+gt.type}).attr("cursor",function(gt){return cursors[gt.type]}),ft.each(_e).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",rt).filter(o).on("touchstart.brush",rt).on("touchmove.brush",it).on("touchend.brush touchcancel.brush",ot).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}j.move=function(ft,dt,pt){ft.tween?ft.on("start.brush",function(gt){et(this,arguments).beforestart().start(gt)}).on("interrupt.brush end.brush",function(gt){et(this,arguments).end(gt)}).tween("brush",function(){var gt=this,Ct=gt.__brush,xt=et(gt,arguments),at=Ct.selection,Bt=i.input(typeof dt=="function"?dt.apply(this,arguments):dt,Ct.extent),Ht=interpolate$1(at,Bt);function sr(mr){Ct.selection=mr===1&&Bt===null?null:Ht(mr),_e.call(gt),xt.brush()}return at!==null&&Bt!==null?sr:sr(1)}):ft.each(function(){var gt=this,Ct=arguments,xt=gt.__brush,at=i.input(typeof dt=="function"?dt.apply(gt,Ct):dt,xt.extent),Bt=et(gt,Ct).beforestart();interrupt(gt),xt.selection=at===null?null:at,_e.call(gt),Bt.start(pt).brush(pt).end(pt)})},j.clear=function(ft,dt){j.move(ft,null,dt)};function _e(){var ft=select(this),dt=local(this).selection;dt?(ft.selectAll(".selection").style("display",null).attr("x",dt[0][0]).attr("y",dt[0][1]).attr("width",dt[1][0]-dt[0][0]).attr("height",dt[1][1]-dt[0][1]),ft.selectAll(".handle").style("display",null).attr("x",function(pt){return pt.type[pt.type.length-1]==="e"?dt[1][0]-g/2:dt[0][0]-g/2}).attr("y",function(pt){return pt.type[0]==="s"?dt[1][1]-g/2:dt[0][1]-g/2}).attr("width",function(pt){return pt.type==="n"||pt.type==="s"?dt[1][0]-dt[0][0]+g:g}).attr("height",function(pt){return pt.type==="e"||pt.type==="w"?dt[1][1]-dt[0][1]+g:g})):ft.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function et(ft,dt,pt){var gt=ft.__brush.emitter;return gt&&(!pt||!gt.clean)?gt:new tt(ft,dt,pt)}function tt(ft,dt,pt){this.that=ft,this.args=dt,this.state=ft.__brush,this.active=0,this.clean=pt}tt.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(ft,dt){return this.starting?(this.starting=!1,this.emit("start",ft,dt)):this.emit("brush",ft),this},brush:function(ft,dt){return this.emit("brush",ft,dt),this},end:function(ft,dt){return--this.active===0&&(delete this.state.emitter,this.emit("end",ft,dt)),this},emit:function(ft,dt,pt){var gt=select(this.that).datum();d.call(ft,this.that,new BrushEvent(ft,{sourceEvent:dt,target:j,selection:i.output(this.state.selection),mode:pt,dispatch:d}),gt)}};function rt(ft){if(_&&!ft.touches||!s.apply(this,arguments))return;var dt=this,pt=ft.target.__data__.type,gt=(a&&ft.metaKey?pt="overlay":pt)==="selection"?MODE_DRAG:a&&ft.altKey?MODE_CENTER:MODE_HANDLE,Ct=i===Y$1?null:signsX[pt],xt=i===X$1?null:signsY[pt],at=local(dt),Bt=at.extent,Ht=at.selection,sr=Bt[0][0],mr,hr,Er=Bt[0][1],Lr,sn,vr=Bt[1][0],Zr,Hr,cr=Bt[1][1],lr,Fr,an=0,kn=0,ms,Zn=Ct&&xt&&a&&ft.shiftKey,As,Rs,Gn=Array.from(ft.touches||[ft],Mr=>{const Cn=Mr.identifier;return Mr=pointer(Mr,dt),Mr.point0=Mr.slice(),Mr.identifier=Cn,Mr});interrupt(dt);var dn=et(dt,arguments,!0).beforestart();if(pt==="overlay"){Ht&&(ms=!0);const Mr=[Gn[0],Gn[1]||Gn[0]];at.selection=Ht=[[mr=i===Y$1?sr:min$1(Mr[0][0],Mr[1][0]),Lr=i===X$1?Er:min$1(Mr[0][1],Mr[1][1])],[Zr=i===Y$1?vr:max$1(Mr[0][0],Mr[1][0]),lr=i===X$1?cr:max$1(Mr[0][1],Mr[1][1])]],Gn.length>1&&pr(ft)}else mr=Ht[0][0],Lr=Ht[0][1],Zr=Ht[1][0],lr=Ht[1][1];hr=mr,sn=Lr,Hr=Zr,Fr=lr;var xr=select(dt).attr("pointer-events","none"),Yr=xr.selectAll(".overlay").attr("cursor",cursors[pt]);if(ft.touches)dn.moved=Ln,dn.ended=nn;else{var Rn=select(ft.view).on("mousemove.brush",Ln,!0).on("mouseup.brush",nn,!0);a&&Rn.on("keydown.brush",mn,!0).on("keyup.brush",Vr,!0),dragDisable(ft.view)}_e.call(dt),dn.start(ft,gt.name);function Ln(Mr){for(const Cn of Mr.changedTouches||[Mr])for(const is of Gn)is.identifier===Cn.identifier&&(is.cur=pointer(Cn,dt));if(Zn&&!As&&!Rs&&Gn.length===1){const Cn=Gn[0];abs$2(Cn.cur[0]-Cn[0])>abs$2(Cn.cur[1]-Cn[1])?Rs=!0:As=!0}for(const Cn of Gn)Cn.cur&&(Cn[0]=Cn.cur[0],Cn[1]=Cn.cur[1]);ms=!0,noevent(Mr),pr(Mr)}function pr(Mr){const Cn=Gn[0],is=Cn.point0;var ts;switch(an=Cn[0]-is[0],kn=Cn[1]-is[1],gt){case MODE_SPACE:case MODE_DRAG:{Ct&&(an=max$1(sr-mr,min$1(vr-Zr,an)),hr=mr+an,Hr=Zr+an),xt&&(kn=max$1(Er-Lr,min$1(cr-lr,kn)),sn=Lr+kn,Fr=lr+kn);break}case MODE_HANDLE:{Gn[1]?(Ct&&(hr=max$1(sr,min$1(vr,Gn[0][0])),Hr=max$1(sr,min$1(vr,Gn[1][0])),Ct=1),xt&&(sn=max$1(Er,min$1(cr,Gn[0][1])),Fr=max$1(Er,min$1(cr,Gn[1][1])),xt=1)):(Ct<0?(an=max$1(sr-mr,min$1(vr-mr,an)),hr=mr+an,Hr=Zr):Ct>0&&(an=max$1(sr-Zr,min$1(vr-Zr,an)),hr=mr,Hr=Zr+an),xt<0?(kn=max$1(Er-Lr,min$1(cr-Lr,kn)),sn=Lr+kn,Fr=lr):xt>0&&(kn=max$1(Er-lr,min$1(cr-lr,kn)),sn=Lr,Fr=lr+kn));break}case MODE_CENTER:{Ct&&(hr=max$1(sr,min$1(vr,mr-an*Ct)),Hr=max$1(sr,min$1(vr,Zr+an*Ct))),xt&&(sn=max$1(Er,min$1(cr,Lr-kn*xt)),Fr=max$1(Er,min$1(cr,lr+kn*xt)));break}}Hr<hr&&(Ct*=-1,ts=mr,mr=Zr,Zr=ts,ts=hr,hr=Hr,Hr=ts,pt in flipX&&Yr.attr("cursor",cursors[pt=flipX[pt]])),Fr<sn&&(xt*=-1,ts=Lr,Lr=lr,lr=ts,ts=sn,sn=Fr,Fr=ts,pt in flipY&&Yr.attr("cursor",cursors[pt=flipY[pt]])),at.selection&&(Ht=at.selection),As&&(hr=Ht[0][0],Hr=Ht[1][0]),Rs&&(sn=Ht[0][1],Fr=Ht[1][1]),(Ht[0][0]!==hr||Ht[0][1]!==sn||Ht[1][0]!==Hr||Ht[1][1]!==Fr)&&(at.selection=[[hr,sn],[Hr,Fr]],_e.call(dt),dn.brush(Mr,gt.name))}function nn(Mr){if(nopropagation(Mr),Mr.touches){if(Mr.touches.length)return;_&&clearTimeout(_),_=setTimeout(function(){_=null},500)}else yesdrag(Mr.view,ms),Rn.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);xr.attr("pointer-events","all"),Yr.attr("cursor",cursors.overlay),at.selection&&(Ht=at.selection),empty(Ht)&&(at.selection=null,_e.call(dt)),dn.end(Mr,gt.name)}function mn(Mr){switch(Mr.keyCode){case 16:{Zn=Ct&&xt;break}case 18:{gt===MODE_HANDLE&&(Ct&&(Zr=Hr-an*Ct,mr=hr+an*Ct),xt&&(lr=Fr-kn*xt,Lr=sn+kn*xt),gt=MODE_CENTER,pr(Mr));break}case 32:{(gt===MODE_HANDLE||gt===MODE_CENTER)&&(Ct<0?Zr=Hr-an:Ct>0&&(mr=hr-an),xt<0?lr=Fr-kn:xt>0&&(Lr=sn-kn),gt=MODE_SPACE,Yr.attr("cursor",cursors.selection),pr(Mr));break}default:return}noevent(Mr)}function Vr(Mr){switch(Mr.keyCode){case 16:{Zn&&(As=Rs=Zn=!1,pr(Mr));break}case 18:{gt===MODE_CENTER&&(Ct<0?Zr=Hr:Ct>0&&(mr=hr),xt<0?lr=Fr:xt>0&&(Lr=sn),gt=MODE_HANDLE,pr(Mr));break}case 32:{gt===MODE_SPACE&&(Mr.altKey?(Ct&&(Zr=Hr-an*Ct,mr=hr+an*Ct),xt&&(lr=Fr-kn*xt,Lr=sn+kn*xt),gt=MODE_CENTER):(Ct<0?Zr=Hr:Ct>0&&(mr=hr),xt<0?lr=Fr:xt>0&&(Lr=sn),gt=MODE_HANDLE),Yr.attr("cursor",cursors[pt]),pr(Mr));break}default:return}noevent(Mr)}}function it(ft){et(this,arguments).moved(ft)}function ot(ft){et(this,arguments).ended(ft)}function ct(){var ft=this.__brush||{selection:null};return ft.extent=number2(e.apply(this,arguments)),ft.dim=i,ft}return j.extent=function(ft){return arguments.length?(e=typeof ft=="function"?ft:constant$3(number2(ft)),j):e},j.filter=function(ft){return arguments.length?(s=typeof ft=="function"?ft:constant$3(!!ft),j):s},j.touchable=function(ft){return arguments.length?(o=typeof ft=="function"?ft:constant$3(!!ft),j):o},j.handleSize=function(ft){return arguments.length?(g=+ft,j):g},j.keyModifiers=function(ft){return arguments.length?(a=!!ft,j):a},j.on=function(){var ft=d.on.apply(d,arguments);return ft===d?j:ft},j}class HistogramChart extends SVGChart{constructor(e,s,o){Array.isArray(o.param)&&(o.param=o.param[0]);const a=e.getColumnName(o.param);o.axis||(o.axis={x:{size:30,label:a,textsize:13},y:{size:45,label:"frequency",textsize:13}}),o.title||(o.title=a),super(e,s,o,{x:{},y:{}});const d=this.config;d.type="bar_chart";const g=this.dataStore.getMinMaxForColumn(o.param);this._setConfigValue(d,"display_max",g[1]),this._setConfigValue(d,"display_min",g[0]),this._setConfigValue(d,"bin_number",10),this.brush=brushX().on("end",_=>{const j=_.selection;if(j==null)return;const _e=this.margins.left;this.setRange(this.x_scale.invert(j[0]-_e),this.x_scale.invert(j[1]-_e))}),this._setBrushExtent(),this.dim=this.dataStore.getDimension("range_dimension"),this.filter=null,this.binFiltered=new Array(this.config.bin_number).fill(!1),this.onDataFiltered(null,!0)}_setBrushExtent(){this.brush.extent([[this.margins.left,0],[this.width-this.margins.right,this.height-this.margins.bottom]]),this.svg.call(this.brush)}setSize(e,s){super.setSize(e,s),this._setBrushExtent(),this.drawChart(),this.svg.call(this.brush.move,null)}remove(e=!0){this.dim.destroy(e),super.remove()}removeFilter(){this.dim.removeFilter(),this.filter=null,this.binFiltered=new Array(this.config.bin_number).fill(!1),this.drawChart(),this.svg.call(this.brush.move,null)}_calculateFilterBins(){const e=this.config,s=e.bin_number;if(this.binFiltered=new Array(s).fill(!1),!this.filter)return;const o=(e.display_max-e.display_min)/e.bin_number;let a=e.display_min;for(let d=0;d<e.bin_number;d++){const g=a+d*o;(g<=this.filter[0]||g>this.filter[1])&&(this.binFiltered[d]=!0)}}setRange(e,s){this.filter=[e,s],this._calculateFilterBins(),this.dim.filter("filterRange",[this.config.param],{min:e,max:s}),this.drawChart(),this.resetButton.style.display="inline"}getFilter(){if(!this.filter)return null;const e={};return e[this.config.param]=this.filter.slice(0),e}onDataFiltered(e){if(this.dim===e||this.isPinned)return;const s=this.config.bin_number,o={bins:this.config.bin_number,max:this.config.display_max,min:this.config.display_min};e==="all_removed"&&(this.filter=null,this.binFiltered.fill(!1),this.svg.call(this.brush.move,null),this.resetButton.style.display="none"),this.dim.getBins(a=>{this.originalBinData=a,this.binData=a.slice(0,s),this.binData[s-1]+=a[s],this.drawChart()},this.config.param,o)}drawChart(){const e=select(this.contentDiv).transition().duration(400).ease(linear),s=this._getContentDimensions(),o=this.config.bin_number,a=(s.width-(o+1)*3)/o;let d=Math.max(...this.binData);d=d||1,this.x_scale.domain([this.config.display_min,this.config.display_max]),this.y_scale.domain([d,0]),this.updateAxis();const g=s.height/d,_=this;this.graph_area.selectAll(".bar").data(this.binData).join("rect").transition(e).style("fill",(j,_e)=>_.binFiltered[_e]?"gray":"blue").attr("class","bar").attr("x",(j,_e)=>(_e+1)*3+_e*a).attr("width",a).attr("y",j=>s.height-j*g).attr("height",j=>j*g)}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}getSettings(){const e=super.getSettings(),s=this.config,o=this.dataStore.getMinMaxForColumn(s.param);return e.concat([{type:"doubleslider",min:o[0],max:o[1],doc:this.__doc__||document,current_value:[s.display_min,s.display_max],label:"max min values",info:{text:`Sometimes outliers can skew the histogram to one side.
                     Setting a min/max value will add all counts less/greater than the 
                     value specified to the first/last bin.`,position:"left"},func:(a,d)=>{s.display_min=a,s.display_max=d,this._calculateFilterBins(),this.onDataFiltered()}},{type:"spinner",max:100,min:2,current_value:s.bin_number,label:"Number of bins",func:a=>{s.bin_number=a,this._calculateFilterBins(),this.onDataFiltered()}}])}}BaseChart.types.bar_chart={name:"Histogram",class:HistogramChart,params:[{type:"number",name:"Frequency Data"}]};class CategoryChart extends SVGChart{constructor(e,s,o,a){Array.isArray(o.param)&&(o.param=o.param[0]),o.title=o.title||e.getColumnName(o.param),super(e,s,o,a),this.dim=this.dataStore.getDimension("category_dimension"),this.colors=this.dataStore.getColumnColors(o.param),this.filter=[]}remove(e=!0){this.dim.destroy(e),super.remove()}setSize(e,s){super.setSize(e,s),this.drawChart()}removeFilter(){this.dim.removeFilter(),this.filter=[],this.drawChart()}filterCategories(e,s){if(s)if(this.filter.indexOf(e)!==-1)this.filter=this.filter.filter(o=>o!==e);else if(this.filter.length==0){const o=this.dataStore.getColumnValues(this.config.param);this.filter=o.filter(a=>a!==e)}else this.filter.push(e);else this.filter=[e];this.resetButton.style.display="inline",this.drawChart(100),this.dim.filter("filterCategories",[this.config.param],this.filter)}getFilter(){const e={};return!this.filter||this.filter.length===0?null:(e[this.config.param]=this.filter.slice(0),e)}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}updateData(){const e=this.config;if(this.rowData=this.data.slice(0),e.filter_zeros&&(this.rowData=this.rowData.filter(s=>s[0]!==0)),e.sort==="size"&&this.rowData.sort((s,o)=>o[0]-s[0]),e.sort==="name"){const s=this.dataStore.getColumnValues(e.param);this.rowData.sort((o,a)=>s[o[1]].localeCompare(s[a[1]]))}this.rowData.length>40&&!e.show_limit&&(e.show_limit=40),e.show_limit&&e.show_limit<this.rowData.length&&this.rowData.splice(e.show_limit)}onDataFiltered(e){if(this.dim===e||this.isPinned)return;e==="all_removed"&&(this.filter=[],this.resetButton.style.display="none");const s={};this.dim.getCategories(o=>{this.data=new Array(o.length),this.maxCount=1,this.config;for(let a=0;a<o.length;a++)this.data[a]=[o[a],a],this.maxCount=Math.max(o[a],this.maxCount);this.updateData(),this.drawChart()},this.config.param,s)}}var wordcloud2Exports={},wordcloud2={get exports(){return wordcloud2Exports},set exports(i){wordcloud2Exports=i}};/*!
 * wordcloud2.js
 * http://timdream.org/wordcloud2.js/
 *
 * Copyright 2011 - 2019 Tim Guan-tin Chien and contributors.
 * Released under the MIT license
 */(function(i){window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var o=[void 0],a="zero-timeout-message",d=function(_){var j=o.length;return o.push(_),window.postMessage(a+j.toString(36),"*"),j};return window.addEventListener("message",function(_){if(!(typeof _.data!="string"||_.data.substr(0,a.length)!==a)){_.stopImmediatePropagation();var j=parseInt(_.data.substr(a.length),36);o[j]&&(o[j](),o[j]=void 0)}},!0),window.clearImmediate=function(_){o[_]&&(o[_]=void 0)},d}()||function(o){window.setTimeout(o,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(o){window.clearTimeout(o)}}()),function(e){var s=function(){var _e=document.createElement("canvas");if(!_e||!_e.getContext)return!1;var et=_e.getContext("2d");return!(!et||!et.getImageData||!et.fillText||!Array.prototype.some||!Array.prototype.push)}(),o=function(){if(s){for(var _e=document.createElement("canvas").getContext("2d"),et=20,tt,rt;et;){if(_e.font=et.toString(10)+"px sans-serif",_e.measureText("").width===tt&&_e.measureText("m").width===rt)return et+1;tt=_e.measureText("").width,rt=_e.measureText("m").width,et--}return 0}}(),a=function(j){if(Array.isArray(j)){var _e=j.slice();return _e.splice(0,2),_e}else return[]},d=function(_e){for(var et,tt,rt=_e.length;rt;)et=Math.floor(Math.random()*rt),tt=_e[--rt],_e[rt]=_e[et],_e[et]=tt;return _e},g={},_=function(_e,et){if(!s)return;var tt=Math.floor(Math.random()*Date.now());Array.isArray(_e)||(_e=[_e]),_e.forEach(function(Ln,pr){if(typeof Ln=="string"){if(_e[pr]=document.getElementById(Ln),!_e[pr])throw new Error("The element id specified is not found.")}else if(!Ln.tagName&&!Ln.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")});var rt={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(et)for(var it in et)it in rt&&(rt[it]=et[it]);if(typeof rt.weightFactor!="function"){var ot=rt.weightFactor;rt.weightFactor=function(pr){return pr*ot}}if(typeof rt.shape!="function")switch(rt.shape){case"circle":default:rt.shape="circle";break;case"cardioid":rt.shape=function(pr){return 1-Math.sin(pr)};break;case"diamond":rt.shape=function(pr){var nn=pr%(2*Math.PI/4);return 1/(Math.cos(nn)+Math.sin(nn))};break;case"square":rt.shape=function(pr){return Math.min(1/Math.abs(Math.cos(pr)),1/Math.abs(Math.sin(pr)))};break;case"triangle-forward":rt.shape=function(pr){var nn=pr%(2*Math.PI/3);return 1/(Math.cos(nn)+Math.sqrt(3)*Math.sin(nn))};break;case"triangle":case"triangle-upright":rt.shape=function(pr){var nn=(pr+Math.PI*3/2)%(2*Math.PI/3);return 1/(Math.cos(nn)+Math.sqrt(3)*Math.sin(nn))};break;case"pentagon":rt.shape=function(pr){var nn=(pr+.955)%(2*Math.PI/5);return 1/(Math.cos(nn)+.726543*Math.sin(nn))};break;case"star":rt.shape=function(pr){var nn=(pr+.955)%(2*Math.PI/10);return(pr+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-nn)+3.07768*Math.sin(2*Math.PI/10-nn)):1/(Math.cos(nn)+3.07768*Math.sin(nn))};break}rt.gridSize=Math.max(Math.floor(rt.gridSize),4);var ct=rt.gridSize,ft=ct-rt.maskGapWidth,dt=Math.abs(rt.maxRotation-rt.minRotation),pt=Math.abs(Math.floor(rt.rotationSteps)),gt=Math.min(rt.maxRotation,rt.minRotation),Ct,xt,at,Bt,Ht,sr,mr;function hr(Ln,pr){return"hsl("+(Math.random()*360).toFixed()+","+(Math.random()*30+70).toFixed()+"%,"+(Math.random()*(pr-Ln)+Ln).toFixed()+"%)"}switch(rt.color){case"random-dark":mr=function(){return hr(10,50)};break;case"random-light":mr=function(){return hr(50,90)};break;default:typeof rt.color=="function"&&(mr=rt.color);break}var Er;typeof rt.fontWeight=="function"&&(Er=rt.fontWeight);var Lr=null;typeof rt.classes=="function"&&(Lr=rt.classes);var sn=!1,vr=[],Zr,Hr=function(pr){var nn=pr.currentTarget,mn=nn.getBoundingClientRect(),Vr,Mr;pr.touches?(Vr=pr.touches[0].clientX,Mr=pr.touches[0].clientY):(Vr=pr.clientX,Mr=pr.clientY);var Cn=Vr-mn.left,is=Mr-mn.top,ts=Math.floor(Cn*(nn.width/mn.width||1)/ct),Qn=Math.floor(is*(nn.height/mn.height||1)/ct);return vr[ts][Qn]},cr=function(pr){var nn=Hr(pr);if(Zr!==nn){if(Zr=nn,!nn){rt.hover(void 0,void 0,pr);return}rt.hover(nn.item,nn.dimension,pr)}},lr=function(pr){var nn=Hr(pr);nn&&(rt.click(nn.item,nn.dimension,pr),pr.preventDefault())},Fr=[],an=function(pr){if(Fr[pr])return Fr[pr];var nn=pr*8,mn=nn,Vr=[];for(pr===0&&Vr.push([Bt[0],Bt[1],0]);mn--;){var Mr=1;rt.shape!=="circle"&&(Mr=rt.shape(mn/nn*2*Math.PI)),Vr.push([Bt[0]+pr*Mr*Math.cos(-mn/nn*2*Math.PI),Bt[1]+pr*Mr*Math.sin(-mn/nn*2*Math.PI)*rt.ellipticity,mn/nn*2*Math.PI])}return Fr[pr]=Vr,Vr},kn=function(){return rt.abortThreshold>0&&new Date().getTime()-sr>rt.abortThreshold},ms=function(){return rt.rotateRatio===0||Math.random()>rt.rotateRatio?0:dt===0?gt:pt>0?gt+Math.floor(Math.random()*pt)*dt/(pt-1):gt+Math.random()*dt},Zn=function(pr,nn,mn,Vr){var Mr=rt.weightFactor(nn);if(Mr<=rt.minSize)return!1;var Cn=1;Mr<o&&(Cn=function(){for(var Ns=2;Ns*Mr<o;)Ns+=2;return Ns}());var is;Er?is=Er(pr,nn,Mr,Vr):is=rt.fontWeight;var ts=document.createElement("canvas"),Qn=ts.getContext("2d",{willReadFrequently:!0});Qn.font=is+" "+(Mr*Cn).toString(10)+"px "+rt.fontFamily;var Xs=Qn.measureText(pr).width/Cn,bt=Math.max(Mr*Cn,Qn.measureText("m").width,Qn.measureText("").width)/Cn,gs=Xs+bt*2,xs=bt*3,Ls=Math.ceil(gs/ct),Ot=Math.ceil(xs/ct);gs=Ls*ct,xs=Ot*ct;var _t=-Xs/2,Ir=-bt*.4,en=Math.ceil((gs*Math.abs(Math.sin(mn))+xs*Math.abs(Math.cos(mn)))/ct),ln=Math.ceil((gs*Math.abs(Math.cos(mn))+xs*Math.abs(Math.sin(mn)))/ct),zn=ln*ct,jn=en*ct;ts.setAttribute("width",zn),ts.setAttribute("height",jn),Qn.scale(1/Cn,1/Cn),Qn.translate(zn*Cn/2,jn*Cn/2),Qn.rotate(-mn),Qn.font=is+" "+(Mr*Cn).toString(10)+"px "+rt.fontFamily,Qn.fillStyle="#000",Qn.textBaseline="middle",Qn.fillText(pr,_t*Cn,(Ir+Mr*.5)*Cn);var ys=Qn.getImageData(0,0,zn,jn).data;if(kn())return!1;for(var Bn=[],cs=ln,hs,Ss,us,Hs=[en/2,ln/2,en/2,ln/2];cs--;)for(hs=en;hs--;){us=ct;e:for(;us--;)for(Ss=ct;Ss--;)if(ys[((hs*ct+us)*zn+(cs*ct+Ss))*4+3]){Bn.push([cs,hs]),cs<Hs[3]&&(Hs[3]=cs),cs>Hs[1]&&(Hs[1]=cs),hs<Hs[0]&&(Hs[0]=hs),hs>Hs[2]&&(Hs[2]=hs);break e}}return{mu:Cn,occupied:Bn,bounds:Hs,gw:ln,gh:en,fillTextOffsetX:_t,fillTextOffsetY:Ir,fillTextWidth:Xs,fillTextHeight:bt,fontSize:Mr}},As=function(pr,nn,mn,Vr,Mr){for(var Cn=Mr.length;Cn--;){var is=pr+Mr[Cn][0],ts=nn+Mr[Cn][1];if(is>=xt||ts>=at||is<0||ts<0){if(!rt.drawOutOfBound)return!1;continue}if(!Ct[is][ts])return!1}return!0},Rs=function(pr,nn,mn,Vr,Mr,Cn,is,ts,Qn,Xs){var bt=mn.fontSize,gs;mr?gs=mr(Vr,Mr,bt,Cn,is,Xs):gs=rt.color;var xs;Er?xs=Er(Vr,Mr,bt,Xs):xs=rt.fontWeight;var Ls;Lr?Ls=Lr(Vr,Mr,bt,Xs):Ls=rt.classes,_e.forEach(function(Ot){if(Ot.getContext){var _t=Ot.getContext("2d"),Ir=mn.mu;_t.save(),_t.scale(1/Ir,1/Ir),_t.font=xs+" "+(bt*Ir).toString(10)+"px "+rt.fontFamily,_t.fillStyle=gs,_t.translate((pr+mn.gw/2)*ct*Ir,(nn+mn.gh/2)*ct*Ir),ts!==0&&_t.rotate(-ts),_t.textBaseline="middle",_t.fillText(Vr,mn.fillTextOffsetX*Ir,(mn.fillTextOffsetY+bt*.5)*Ir),_t.restore()}else{var en=document.createElement("span"),ln="";ln="rotate("+-ts/Math.PI*180+"deg) ",mn.mu!==1&&(ln+="translateX(-"+mn.fillTextWidth/4+"px) scale("+1/mn.mu+")");var zn={position:"absolute",display:"block",font:xs+" "+bt*mn.mu+"px "+rt.fontFamily,left:(pr+mn.gw/2)*ct+mn.fillTextOffsetX+"px",top:(nn+mn.gh/2)*ct+mn.fillTextOffsetY+"px",width:mn.fillTextWidth+"px",height:mn.fillTextHeight+"px",lineHeight:bt+"px",whiteSpace:"nowrap",transform:ln,webkitTransform:ln,msTransform:ln,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};gs&&(zn.color=gs),en.textContent=Vr;for(var jn in zn)en.style[jn]=zn[jn];if(Qn)for(var ys in Qn)en.setAttribute(ys,Qn[ys]);Ls&&(en.className+=Ls),Ot.appendChild(en)}})},Gn=function(pr,nn,mn,Vr,Mr){if(!(pr>=xt||nn>=at||pr<0||nn<0)){if(Ct[pr][nn]=!1,mn){var Cn=_e[0].getContext("2d");Cn.fillRect(pr*ct,nn*ct,ft,ft)}sn&&(vr[pr][nn]={item:Mr,dimension:Vr})}},dn=function(pr,nn,mn,Vr,Mr,Cn){var is=Mr.occupied,ts=rt.drawMask,Qn;ts&&(Qn=_e[0].getContext("2d"),Qn.save(),Qn.fillStyle=rt.maskColor);var Xs;if(sn){var bt=Mr.bounds;Xs={x:(pr+bt[3])*ct,y:(nn+bt[0])*ct,w:(bt[1]-bt[3]+1)*ct,h:(bt[2]-bt[0]+1)*ct}}for(var gs=is.length;gs--;){var xs=pr+is[gs][0],Ls=nn+is[gs][1];xs>=xt||Ls>=at||xs<0||Ls<0||Gn(xs,Ls,ts,Xs,Cn)}ts&&Qn.restore()},xr=function Ln(pr){var nn,mn,Vr;Array.isArray(pr)?(nn=pr[0],mn=pr[1]):(nn=pr.word,mn=pr.weight,Vr=pr.attributes);var Mr=ms(),Cn=a(pr),is=Zn(nn,mn,Mr,Cn);if(!is||kn())return!1;if(!rt.drawOutOfBound&&!rt.shrinkToFit){var ts=is.bounds;if(ts[1]-ts[3]+1>xt||ts[2]-ts[0]+1>at)return!1}for(var Qn=Ht+1,Xs=function(xs){var Ls=Math.floor(xs[0]-is.gw/2),Ot=Math.floor(xs[1]-is.gh/2),_t=is.gw,Ir=is.gh;return As(Ls,Ot,_t,Ir,is.occupied)?(Rs(Ls,Ot,is,nn,mn,Ht-Qn,xs[2],Mr,Vr,Cn),dn(Ls,Ot,_t,Ir,is,pr),!0):!1};Qn--;){var bt=an(Ht-Qn);rt.shuffle&&(bt=[].concat(bt),d(bt));var gs=bt.some(Xs);if(gs)return!0}return rt.shrinkToFit?(Array.isArray(pr)?pr[1]=pr[1]*3/4:pr.weight=pr.weight*3/4,Ln(pr)):!1},Yr=function(pr,nn,mn){if(nn)return!_e.some(function(Vr){var Mr=new CustomEvent(pr,{detail:mn||{}});return!Vr.dispatchEvent(Mr)},this);_e.forEach(function(Vr){var Mr=new CustomEvent(pr,{detail:mn||{}});Vr.dispatchEvent(Mr)},this)},Rn=function(){var pr=_e[0];if(pr.getContext)xt=Math.ceil(pr.width/ct),at=Math.ceil(pr.height/ct);else{var nn=pr.getBoundingClientRect();xt=Math.ceil(nn.width/ct),at=Math.ceil(nn.height/ct)}if(Yr("wordcloudstart",!0)){Bt=rt.origin?[rt.origin[0]/ct,rt.origin[1]/ct]:[xt/2,at/2],Ht=Math.floor(Math.sqrt(xt*xt+at*at)),Ct=[];var mn,Vr,Mr;if(!pr.getContext||rt.clearCanvas)for(_e.forEach(function(_t){if(_t.getContext){var Ir=_t.getContext("2d");Ir.fillStyle=rt.backgroundColor,Ir.clearRect(0,0,xt*(ct+1),at*(ct+1)),Ir.fillRect(0,0,xt*(ct+1),at*(ct+1))}else _t.textContent="",_t.style.backgroundColor=rt.backgroundColor,_t.style.position="relative"}),mn=xt;mn--;)for(Ct[mn]=[],Vr=at;Vr--;)Ct[mn][Vr]=!0;else{var Cn=document.createElement("canvas").getContext("2d");Cn.fillStyle=rt.backgroundColor,Cn.fillRect(0,0,1,1);var is=Cn.getImageData(0,0,1,1).data,ts=pr.getContext("2d").getImageData(0,0,xt*ct,at*ct).data;mn=xt;for(var Qn,Xs;mn--;)for(Ct[mn]=[],Vr=at;Vr--;){Xs=ct;e:for(;Xs--;)for(Qn=ct;Qn--;)for(Mr=4;Mr--;)if(ts[((Vr*ct+Xs)*xt*ct+(mn*ct+Qn))*4+Mr]!==is[Mr]){Ct[mn][Vr]=!1;break e}Ct[mn][Vr]!==!1&&(Ct[mn][Vr]=!0)}ts=Cn=is=void 0}if(rt.hover||rt.click){for(sn=!0,mn=xt+1;mn--;)vr[mn]=[];rt.hover&&pr.addEventListener("mousemove",cr),rt.click&&(pr.addEventListener("click",lr),pr.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),pr.addEventListener("wordcloudstart",function _t(){pr.removeEventListener("wordcloudstart",_t),pr.removeEventListener("mousemove",cr),pr.removeEventListener("click",lr),Zr=void 0})}Mr=0;var bt,gs;rt.wait!==0?(bt=window.setTimeout,gs=window.clearTimeout):(bt=window.setImmediate,gs=window.clearImmediate);var xs=function(Ir,en){_e.forEach(function(ln){ln.addEventListener(Ir,en)},this)},Ls=function(Ir,en){_e.forEach(function(ln){ln.removeEventListener(Ir,en)},this)},Ot=function _t(){Ls("wordcloudstart",_t),gs(g[tt])};xs("wordcloudstart",Ot),g[tt]=bt(function _t(){if(Mr>=rt.list.length){gs(g[tt]),Yr("wordcloudstop",!1),Ls("wordcloudstart",Ot),delete g[tt];return}sr=new Date().getTime();var Ir=xr(rt.list[Mr]),en=!Yr("wordclouddrawn",!0,{item:rt.list[Mr],drawn:Ir});if(kn()||en){gs(g[tt]),rt.abort(),Yr("wordcloudabort",!1),Yr("wordcloudstop",!1),Ls("wordcloudstart",Ot),delete g[tt];return}Mr++,g[tt]=bt(_t,rt.wait)},rt.wait)}};Rn()};_.isSupported=s,_.minFontSize=o,_.stop=function(){if(g)for(var _e in g)window.clearImmediate(g[_e])},i.exports?i.exports=_:e.WordCloud=_}(commonjsGlobal)})(wordcloud2);class RowChart extends CategoryChart{constructor(e,s,o){super(e,s,o,{x:{}}),this.config.type="row_chart",this.onDataFiltered(null),this.labelg=this.graph_area.append("g"),this.wordcloudCanvas=createEl("canvas",{styles:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"}},this.contentDiv)}drawWordCloud(e){const s=this.dataStore.getColumnValues(this.config.param),o=this.dataStore.getColumnColors(this.config.param),a=it=>this.filter.length>0&&this.filter.indexOf(it)===-1?"lightgray":o[s.indexOf(it)],d=(it,ot,ct)=>this.filterCategories(it[0],ct.shiftKey),g=e.map(it=>[s[it[1]],Math.log(it[0])]),_=Math.max(...g.map(it=>it[1])),j=this.wordcloudCanvas;j.width=this.contentDiv.clientWidth,j.height=this.contentDiv.clientHeight;const _e=this.config.wordSize/_,et=Math.PI/2;j.style.display="block",this.graph_area.style.display="none";const tt=getComputedStyle(j).getPropertyValue("--main_panel_color"),rt={list:g,color:a,click:d,weightFactor:_e,backgroundColor:tt,minRotation:-et,maxRotation:et,rotationSteps:2};console.log("wordcloud options",rt),wordcloud2Exports(j,rt)}drawChart(e=400){const s=this.config,o=select(this.contentDiv).transition().duration(e).ease(linear),a=this.width-this.margins.left-this.margins.right,d=this.height-this.margins.bottom-this.margins.top,g=this.dataStore.getColumnColors(this.config.param),_=this.dataStore.getColumnValues(this.config.param),j=a/this.maxCount,_e=this;let et=this.rowData;if(this.maxCount,s.exclude_categories){const ot=new Set;for(let ct of s.exclude_categories)ot.add(_.indexOf(ct));et=this.rowData.filter((ct,ft)=>!ot.has(ft)),et.reduce((ct,ft)=>Math.max(ct[0],ft[0]))}if(this.config.wordcloud){this.drawWordCloud(et);return}this.wordcloudCanvas.style.display="none",this.graph_area.style.display="block";const tt=et.length,rt=(d-(tt+1)*3)/tt;let it=Math.round(rt);it=it>20?20:it,this.x_scale.domain([0,this.maxCount]),this.updateAxis(),this.labelg.selectAll(".row-bar").data(et,ot=>ot[1]).join("rect").attr("class","row-bar").on("click",(ot,ct)=>{_e.filterCategories(_[ct[1]],ot.shiftKey)}).transition(o).style("fill",ot=>{const ct=ot[1];return _e.filter.length>0&&_e.filter.indexOf(_[ct])===-1?"lightgray":g[ct]}).attr("class","row-bar").attr("x",0).attr("width",ot=>ot[0]*j).attr("y",(ot,ct)=>(ct+1)*3+ct*rt).attr("height",rt),this.graph_area.selectAll(".row-text").data(et,ot=>ot[1]).join("text").on("click",(ot,ct)=>{_e.filterCategories(_[ct[1]],ot.shiftKey)}).attr("class","row-text").transition(o).text(ot=>_[ot[1]]===""?"none":_[ot[1]]).attr("font-size",it+"px").attr("x",5).style("fill","currentColor").attr("y",(ot,ct)=>(ct+1)*3+ct*rt+rt/2).attr("dominant-baseline","central")}getSettings(){const e=super.getSettings(),s=this.config;if(s.wordcloud)return this.getWordCloudSettings();const o=Math.max(this.data.length||60);return e.concat([{type:"spinner",label:"Max Rows",current_value:s.show_limit||o,max:o,func:a=>{s.show_limit=a,this.updateData(),this.drawChart()}},{type:"check",label:"Hide zero values",current_value:s.filter_zeros,func:a=>{s.filter_zeros=a,this.updateData(),this.drawChart()}},{type:"radiobuttons",label:"Sort Order",current_value:s.sort||"default",choices:[["Default","default"],["Size","size"],["Name","name"]],func:a=>{s.sort=a,this.updateData(),this.drawChart()}},{type:"check",label:"Display as WordCloud",current_value:s.wordcloud,func:a=>{s.wordcloud=a,this.drawChart()}}])}getWordCloudSettings(){super.getSettings();const e=this.config;return[{type:"slider",label:"Word Size",current_value:e.wordSize||100,min:10,max:100,func:s=>{e.wordSize=s,this.drawChart()}}]}}BaseChart.types.row_chart={class:RowChart,name:"Row Chart",params:[{type:["text","multitext"],name:"Category"}]};BaseChart.types.wordcloud={class:RowChart,name:"Word Cloud",params:[{type:["text","multitext"],name:"Category"}],init:(i,e)=>{i.wordcloud=!0,i.wordSize=20}};function EventData(){var i=!1,e=!1;this.stopPropagation=function(){i=!0},this.isPropagationStopped=function(){return i},this.stopImmediatePropagation=function(){e=!0},this.isImmediatePropagationStopped=function(){return e}}function Event$1(){var i=[];this.subscribe=function(e){i.push(e)},this.unsubscribe=function(e){for(var s=i.length-1;s>=0;s--)i[s]===e&&i.splice(s,1)},this.notify=function(e,s,o){s=s||new EventData,o=o||this;for(var a,d=0;d<i.length&&!(s.isPropagationStopped()||s.isImmediatePropagationStopped());d++)a=i[d].call(o,s,e);return a}}function EventHandler(){var i=[];this.subscribe=function(e,s){return i.push({event:e,handler:s}),e.subscribe(s),this},this.unsubscribe=function(e,s){for(var o=i.length;o--;)if(i[o].event===e&&i[o].handler===s){i.splice(o,1),e.unsubscribe(s);return}return this},this.unsubscribeAll=function(){for(var e=i.length;e--;)i[e].event.unsubscribe(i[e].handler);return i=[],this}}function Range(i,e,s,o){s===void 0&&o===void 0&&(s=i,o=e),this.fromRow=Math.min(i,s),this.fromCell=Math.min(e,o),this.toRow=Math.max(i,s),this.toCell=Math.max(e,o),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(a,d){return a>=this.fromRow&&a<=this.toRow&&d>=this.fromCell&&d<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}function NonDataItem(){this.__nonDataRow=!0}function Group(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.selectChecked=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}Group.prototype=new NonDataItem;Group.prototype.equals=function(i){return this.value===i.value&&this.count===i.count&&this.collapsed===i.collapsed&&this.title===i.title};function GroupTotals(){this.__groupTotals=!0,this.group=null,this.initialized=!1}GroupTotals.prototype=new NonDataItem;function EditorLock(){var i=null;this.isActive=function(e){return e?i===e:i!==null},this.activate=function(e){if(e!==i){if(i!==null)throw new Error("SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController");if(!e.commitCurrentEdit)throw new Error("SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()");if(!e.cancelCurrentEdit)throw new Error("SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()");i=e}},this.deactivate=function(e){if(i){if(i!==e)throw new Error("SlickGrid.EditorLock.deactivate: specified editController is not the currently active one");i=null}},this.commitCurrentEdit=function(){return i?i.commitCurrentEdit():!0},this.cancelCurrentEdit=function(){return i?i.cancelCurrentEdit():!0}}function TreeColumns(i){var e={};function s(){o(i)}function o(tt){tt.forEach(function(rt){e[rt.id]=rt,rt.columns&&o(rt.columns)})}function a(tt,rt){return tt.filter(function(it){var ot=rt.call(it);return ot&&it.columns&&(it.columns=a(it.columns,rt)),ot&&(!it.columns||it.columns.length)})}function d(tt,rt){tt.sort(function(it,ot){var ct=g(rt.getColumnIndex(it.id)),ft=g(rt.getColumnIndex(ot.id));return ct-ft}).forEach(function(it){it.columns&&d(it.columns,rt)})}function g(tt){return typeof tt>"u"?-1:tt}function _(tt){if(tt.length)for(var rt in tt)return _(tt[rt]);else return tt.columns?1+_(tt.columns):1}function j(tt,rt,it){var ot=[];if(it=it||0,rt==it)return tt.length&&tt.forEach(function(ft){ft.columns&&(ft.extractColumns=function(){return _e(ft)})}),tt;for(var ct in tt)tt[ct].columns&&(ot=ot.concat(j(tt[ct].columns,rt,it+1)));return ot}function _e(tt){var rt=[];if(tt.hasOwnProperty("length"))for(var it=0;it<tt.length;it++)rt=rt.concat(_e(tt[it]));else if(tt.hasOwnProperty("columns"))rt=rt.concat(_e(tt.columns));else return tt;return rt}function et(){return JSON.parse(JSON.stringify(nodesArray))}s(),this.hasDepth=function(){for(var tt in i)if(i[tt].hasOwnProperty("columns"))return!0;return!1},this.getTreeColumns=function(){return i},this.extractColumns=function(){return this.hasDepth()?_e(i):i},this.getDepth=function(){return _(i)},this.getColumnsInDepth=function(tt){return j(i,tt)},this.getColumnsInGroup=function(tt){return _e(tt)},this.visibleColumns=function(){return a(et(),function(){return this.visible})},this.filter=function(tt){return a(et(),tt)},this.reOrder=function(tt){return d(i,tt)},this.getById=function(tt){return e[tt]},this.getInIds=function(tt){return tt.map(function(rt){return e[rt]})}}var Map$1="Map"in window?window.Map:function(){var e={};this.get=function(s){return e[s]},this.set=function(s,o){e[s]=o},this.has=function(s){return s in e},this.delete=function(s){delete e[s]}};const Slick={Event:Event$1,EventData,EventHandler,Range,Map:Map$1,NonDataRow:NonDataItem,Group,GroupTotals,EditorLock,GlobalEditorLock:new EditorLock,TreeColumns,keyCode:{SPACE:8,BACKSPACE:8,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,RIGHT:39,TAB:9,UP:38,A:65},preClickClassName:"slick-edit-preclick",GridAutosizeColsMode:{None:"NOA",LegacyOff:"LOF",LegacyForceFit:"LFF",IgnoreViewport:"IGV",FitColsToViewport:"FCV",FitViewportToCols:"FVC"},ColAutosizeMode:{Locked:"LCK",Guide:"GUI",Content:"CON",ContentIntelligent:"CTI"},RowSelectionMode:{FirstRow:"FS1",FirstNRows:"FSN",AllRows:"ALL",LastRow:"LS1"},ValueFilterMode:{None:"NONE",DeDuplicate:"DEDP",GetGreatestAndSub:"GR8T",GetLongestTextAndSub:"LNSB",GetLongestText:"LNSC"},WidthEvalMode:{CanvasTextSize:"CANV",HTML:"HTML"}};var jqueryExports={},jquery={get exports(){return jqueryExports},set exports(i){jqueryExports=i}};/*!
 * jQuery JavaScript Library v3.6.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2022-08-26T17:52Z
 */(function(i){(function(e,s){i.exports=e.document?s(e,!0):function(o){if(!o.document)throw new Error("jQuery requires a window with a document");return s(o)}})(typeof window<"u"?window:commonjsGlobal,function(e,s){var o=[],a=Object.getPrototypeOf,d=o.slice,g=o.flat?function(nt){return o.flat.call(nt)}:function(nt){return o.concat.apply([],nt)},_=o.push,j=o.indexOf,_e={},et=_e.toString,tt=_e.hasOwnProperty,rt=tt.toString,it=rt.call(Object),ot={},ct=function(st){return typeof st=="function"&&typeof st.nodeType!="number"&&typeof st.item!="function"},ft=function(st){return st!=null&&st===st.window},dt=e.document,pt={type:!0,src:!0,nonce:!0,noModule:!0};function gt(nt,st,lt){lt=lt||dt;var ut,mt,vt=lt.createElement("script");if(vt.text=nt,st)for(ut in pt)mt=st[ut]||st.getAttribute&&st.getAttribute(ut),mt&&vt.setAttribute(ut,mt);lt.head.appendChild(vt).parentNode.removeChild(vt)}function Ct(nt){return nt==null?nt+"":typeof nt=="object"||typeof nt=="function"?_e[et.call(nt)]||"object":typeof nt}var xt="3.6.1",at=function(nt,st){return new at.fn.init(nt,st)};at.fn=at.prototype={jquery:xt,constructor:at,length:0,toArray:function(){return d.call(this)},get:function(nt){return nt==null?d.call(this):nt<0?this[nt+this.length]:this[nt]},pushStack:function(nt){var st=at.merge(this.constructor(),nt);return st.prevObject=this,st},each:function(nt){return at.each(this,nt)},map:function(nt){return this.pushStack(at.map(this,function(st,lt){return nt.call(st,lt,st)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(at.grep(this,function(nt,st){return(st+1)%2}))},odd:function(){return this.pushStack(at.grep(this,function(nt,st){return st%2}))},eq:function(nt){var st=this.length,lt=+nt+(nt<0?st:0);return this.pushStack(lt>=0&&lt<st?[this[lt]]:[])},end:function(){return this.prevObject||this.constructor()},push:_,sort:o.sort,splice:o.splice},at.extend=at.fn.extend=function(){var nt,st,lt,ut,mt,vt,yt=arguments[0]||{},Gt=1,$t=arguments.length,Qt=!1;for(typeof yt=="boolean"&&(Qt=yt,yt=arguments[Gt]||{},Gt++),typeof yt!="object"&&!ct(yt)&&(yt={}),Gt===$t&&(yt=this,Gt--);Gt<$t;Gt++)if((nt=arguments[Gt])!=null)for(st in nt)ut=nt[st],!(st==="__proto__"||yt===ut)&&(Qt&&ut&&(at.isPlainObject(ut)||(mt=Array.isArray(ut)))?(lt=yt[st],mt&&!Array.isArray(lt)?vt=[]:!mt&&!at.isPlainObject(lt)?vt={}:vt=lt,mt=!1,yt[st]=at.extend(Qt,vt,ut)):ut!==void 0&&(yt[st]=ut));return yt},at.extend({expando:"jQuery"+(xt+Math.random()).replace(/\D/g,""),isReady:!0,error:function(nt){throw new Error(nt)},noop:function(){},isPlainObject:function(nt){var st,lt;return!nt||et.call(nt)!=="[object Object]"?!1:(st=a(nt),st?(lt=tt.call(st,"constructor")&&st.constructor,typeof lt=="function"&&rt.call(lt)===it):!0)},isEmptyObject:function(nt){var st;for(st in nt)return!1;return!0},globalEval:function(nt,st,lt){gt(nt,{nonce:st&&st.nonce},lt)},each:function(nt,st){var lt,ut=0;if(Bt(nt))for(lt=nt.length;ut<lt&&st.call(nt[ut],ut,nt[ut])!==!1;ut++);else for(ut in nt)if(st.call(nt[ut],ut,nt[ut])===!1)break;return nt},makeArray:function(nt,st){var lt=st||[];return nt!=null&&(Bt(Object(nt))?at.merge(lt,typeof nt=="string"?[nt]:nt):_.call(lt,nt)),lt},inArray:function(nt,st,lt){return st==null?-1:j.call(st,nt,lt)},merge:function(nt,st){for(var lt=+st.length,ut=0,mt=nt.length;ut<lt;ut++)nt[mt++]=st[ut];return nt.length=mt,nt},grep:function(nt,st,lt){for(var ut,mt=[],vt=0,yt=nt.length,Gt=!lt;vt<yt;vt++)ut=!st(nt[vt],vt),ut!==Gt&&mt.push(nt[vt]);return mt},map:function(nt,st,lt){var ut,mt,vt=0,yt=[];if(Bt(nt))for(ut=nt.length;vt<ut;vt++)mt=st(nt[vt],vt,lt),mt!=null&&yt.push(mt);else for(vt in nt)mt=st(nt[vt],vt,lt),mt!=null&&yt.push(mt);return g(yt)},guid:1,support:ot}),typeof Symbol=="function"&&(at.fn[Symbol.iterator]=o[Symbol.iterator]),at.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(nt,st){_e["[object "+st+"]"]=st.toLowerCase()});function Bt(nt){var st=!!nt&&"length"in nt&&nt.length,lt=Ct(nt);return ct(nt)||ft(nt)?!1:lt==="array"||st===0||typeof st=="number"&&st>0&&st-1 in nt}var Ht=function(nt){var st,lt,ut,mt,vt,yt,Gt,$t,Qt,_r,jr,fr,Cr,Fn,Kn,In,oo,to,No,Is="sizzle"+1*new Date,rs=nt.document,Ro=0,ws=0,_i=Hl(),ou=Hl(),zu=Hl(),Ks=Hl(),Pl=function(Tt,zt){return Tt===zt&&(jr=!0),0},yl={}.hasOwnProperty,ro=[],El=ro.pop,To=ro.push,Vo=ro.push,Tu=ro.slice,Gl=function(Tt,zt){for(var Xt=0,Pr=Tt.length;Xt<Pr;Xt++)if(Tt[Xt]===zt)return Xt;return-1},Cu="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Cs="[\\x20\\t\\r\\n\\f]",Ql="(?:\\\\[\\da-fA-F]{1,6}"+Cs+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Sp="\\["+Cs+"*("+Ql+")(?:"+Cs+"*([*^$|!~]?=)"+Cs+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Ql+"))|)"+Cs+"*\\]",_d=":("+Ql+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Sp+")*)|.*)\\)|)",Zp=new RegExp(Cs+"+","g"),au=new RegExp("^"+Cs+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Cs+"+$","g"),Vu=new RegExp("^"+Cs+"*,"+Cs+"*"),Uu=new RegExp("^"+Cs+"*([>+~]|"+Cs+")"+Cs+"*"),_h=new RegExp(Cs+"|>"),lu=new RegExp(_d),ep=new RegExp("^"+Ql+"$"),cu={ID:new RegExp("^#("+Ql+")"),CLASS:new RegExp("^\\.("+Ql+")"),TAG:new RegExp("^("+Ql+"|[*])"),ATTR:new RegExp("^"+Sp),PSEUDO:new RegExp("^"+_d),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Cs+"*(even|odd|(([+-]|)(\\d*)n|)"+Cs+"*(?:([+-]|)"+Cs+"*(\\d+)|))"+Cs+"*\\)|)","i"),bool:new RegExp("^(?:"+Cu+")$","i"),needsContext:new RegExp("^"+Cs+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Cs+"*((?:-\\d)?\\d*)"+Cs+"*\\)|)(?=[^-]|$)","i")},tp=/HTML$/i,rp=/^(?:input|select|textarea|button)$/i,Tp=/^h\d$/i,uu=/^[^{]+\{\s*\[native \w/,Cp=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Gu=/[+~]/,xl=new RegExp("\\\\[\\da-fA-F]{1,6}"+Cs+"?|\\\\([^\\r\\n\\f])","g"),Sl=function(Tt,zt){var Xt="0x"+Tt.slice(1)-65536;return zt||(Xt<0?String.fromCharCode(Xt+65536):String.fromCharCode(Xt>>10|55296,Xt&1023|56320))},np=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ip=function(Tt,zt){return zt?Tt==="\0"?"":Tt.slice(0,-1)+"\\"+Tt.charCodeAt(Tt.length-1).toString(16)+" ":"\\"+Tt},Jl=function(){fr()},sp=Ru(function(Tt){return Tt.disabled===!0&&Tt.nodeName.toLowerCase()==="fieldset"},{dir:"parentNode",next:"legend"});try{Vo.apply(ro=Tu.call(rs.childNodes),rs.childNodes),ro[rs.childNodes.length].nodeType}catch{Vo={apply:ro.length?function(zt,Xt){To.apply(zt,Tu.call(Xt))}:function(zt,Xt){for(var Pr=zt.length,er=0;zt[Pr++]=Xt[er++];);zt.length=Pr-1}}}function Os(Tt,zt,Xt,Pr){var er,Dr,Kr,yn,vn,Vn,Hn,qn=zt&&zt.ownerDocument,ds=zt?zt.nodeType:9;if(Xt=Xt||[],typeof Tt!="string"||!Tt||ds!==1&&ds!==9&&ds!==11)return Xt;if(!Pr&&(fr(zt),zt=zt||Cr,Kn)){if(ds!==11&&(vn=Cp.exec(Tt)))if(er=vn[1]){if(ds===9)if(Kr=zt.getElementById(er)){if(Kr.id===er)return Xt.push(Kr),Xt}else return Xt;else if(qn&&(Kr=qn.getElementById(er))&&No(zt,Kr)&&Kr.id===er)return Xt.push(Kr),Xt}else{if(vn[2])return Vo.apply(Xt,zt.getElementsByTagName(Tt)),Xt;if((er=vn[3])&&lt.getElementsByClassName&&zt.getElementsByClassName)return Vo.apply(Xt,zt.getElementsByClassName(er)),Xt}if(lt.qsa&&!Ks[Tt+" "]&&(!In||!In.test(Tt))&&(ds!==1||zt.nodeName.toLowerCase()!=="object")){if(Hn=Tt,qn=zt,ds===1&&(_h.test(Tt)||Uu.test(Tt))){for(qn=Gu.test(Tt)&&ap(zt.parentNode)||zt,(qn!==zt||!lt.scope)&&((yn=zt.getAttribute("id"))?yn=yn.replace(np,ip):zt.setAttribute("id",yn=Is)),Vn=yt(Tt),Dr=Vn.length;Dr--;)Vn[Dr]=(yn?"#"+yn:":scope")+" "+Au(Vn[Dr]);Hn=Vn.join(",")}try{return Vo.apply(Xt,qn.querySelectorAll(Hn)),Xt}catch{Ks(Tt,!0)}finally{yn===Is&&zt.removeAttribute("id")}}}return $t(Tt.replace(au,"$1"),zt,Xt,Pr)}function Hl(){var Tt=[];function zt(Xt,Pr){return Tt.push(Xt+" ")>ut.cacheLength&&delete zt[Tt.shift()],zt[Xt+" "]=Pr}return zt}function Ko(Tt){return Tt[Is]=!0,Tt}function Zo(Tt){var zt=Cr.createElement("fieldset");try{return!!Tt(zt)}catch{return!1}finally{zt.parentNode&&zt.parentNode.removeChild(zt),zt=null}}function op(Tt,zt){for(var Xt=Tt.split("|"),Pr=Xt.length;Pr--;)ut.attrHandle[Xt[Pr]]=zt}function Hu(Tt,zt){var Xt=zt&&Tt,Pr=Xt&&Tt.nodeType===1&&zt.nodeType===1&&Tt.sourceIndex-zt.sourceIndex;if(Pr)return Pr;if(Xt){for(;Xt=Xt.nextSibling;)if(Xt===zt)return-1}return Tt?1:-1}function Qp(Tt){return function(zt){var Xt=zt.nodeName.toLowerCase();return Xt==="input"&&zt.type===Tt}}function Jp(Tt){return function(zt){var Xt=zt.nodeName.toLowerCase();return(Xt==="input"||Xt==="button")&&zt.type===Tt}}function Ap(Tt){return function(zt){return"form"in zt?zt.parentNode&&zt.disabled===!1?"label"in zt?"label"in zt.parentNode?zt.parentNode.disabled===Tt:zt.disabled===Tt:zt.isDisabled===Tt||zt.isDisabled!==!Tt&&sp(zt)===Tt:zt.disabled===Tt:"label"in zt?zt.disabled===Tt:!1}}function Ml(Tt){return Ko(function(zt){return zt=+zt,Ko(function(Xt,Pr){for(var er,Dr=Tt([],Xt.length,zt),Kr=Dr.length;Kr--;)Xt[er=Dr[Kr]]&&(Xt[er]=!(Pr[er]=Xt[er]))})})}function ap(Tt){return Tt&&typeof Tt.getElementsByTagName<"u"&&Tt}lt=Os.support={},vt=Os.isXML=function(Tt){var zt=Tt&&Tt.namespaceURI,Xt=Tt&&(Tt.ownerDocument||Tt).documentElement;return!tp.test(zt||Xt&&Xt.nodeName||"HTML")},fr=Os.setDocument=function(Tt){var zt,Xt,Pr=Tt?Tt.ownerDocument||Tt:rs;return Pr==Cr||Pr.nodeType!==9||!Pr.documentElement||(Cr=Pr,Fn=Cr.documentElement,Kn=!vt(Cr),rs!=Cr&&(Xt=Cr.defaultView)&&Xt.top!==Xt&&(Xt.addEventListener?Xt.addEventListener("unload",Jl,!1):Xt.attachEvent&&Xt.attachEvent("onunload",Jl)),lt.scope=Zo(function(er){return Fn.appendChild(er).appendChild(Cr.createElement("div")),typeof er.querySelectorAll<"u"&&!er.querySelectorAll(":scope fieldset div").length}),lt.attributes=Zo(function(er){return er.className="i",!er.getAttribute("className")}),lt.getElementsByTagName=Zo(function(er){return er.appendChild(Cr.createComment("")),!er.getElementsByTagName("*").length}),lt.getElementsByClassName=uu.test(Cr.getElementsByClassName),lt.getById=Zo(function(er){return Fn.appendChild(er).id=Is,!Cr.getElementsByName||!Cr.getElementsByName(Is).length}),lt.getById?(ut.filter.ID=function(er){var Dr=er.replace(xl,Sl);return function(Kr){return Kr.getAttribute("id")===Dr}},ut.find.ID=function(er,Dr){if(typeof Dr.getElementById<"u"&&Kn){var Kr=Dr.getElementById(er);return Kr?[Kr]:[]}}):(ut.filter.ID=function(er){var Dr=er.replace(xl,Sl);return function(Kr){var yn=typeof Kr.getAttributeNode<"u"&&Kr.getAttributeNode("id");return yn&&yn.value===Dr}},ut.find.ID=function(er,Dr){if(typeof Dr.getElementById<"u"&&Kn){var Kr,yn,vn,Vn=Dr.getElementById(er);if(Vn){if(Kr=Vn.getAttributeNode("id"),Kr&&Kr.value===er)return[Vn];for(vn=Dr.getElementsByName(er),yn=0;Vn=vn[yn++];)if(Kr=Vn.getAttributeNode("id"),Kr&&Kr.value===er)return[Vn]}return[]}}),ut.find.TAG=lt.getElementsByTagName?function(er,Dr){if(typeof Dr.getElementsByTagName<"u")return Dr.getElementsByTagName(er);if(lt.qsa)return Dr.querySelectorAll(er)}:function(er,Dr){var Kr,yn=[],vn=0,Vn=Dr.getElementsByTagName(er);if(er==="*"){for(;Kr=Vn[vn++];)Kr.nodeType===1&&yn.push(Kr);return yn}return Vn},ut.find.CLASS=lt.getElementsByClassName&&function(er,Dr){if(typeof Dr.getElementsByClassName<"u"&&Kn)return Dr.getElementsByClassName(er)},oo=[],In=[],(lt.qsa=uu.test(Cr.querySelectorAll))&&(Zo(function(er){var Dr;Fn.appendChild(er).innerHTML="<a id='"+Is+"'></a><select id='"+Is+"-\r\\' msallowcapture=''><option selected=''></option></select>",er.querySelectorAll("[msallowcapture^='']").length&&In.push("[*^$]="+Cs+`*(?:''|"")`),er.querySelectorAll("[selected]").length||In.push("\\["+Cs+"*(?:value|"+Cu+")"),er.querySelectorAll("[id~="+Is+"-]").length||In.push("~="),Dr=Cr.createElement("input"),Dr.setAttribute("name",""),er.appendChild(Dr),er.querySelectorAll("[name='']").length||In.push("\\["+Cs+"*name"+Cs+"*="+Cs+`*(?:''|"")`),er.querySelectorAll(":checked").length||In.push(":checked"),er.querySelectorAll("a#"+Is+"+*").length||In.push(".#.+[+~]"),er.querySelectorAll("\\\f"),In.push("[\\r\\n\\f]")}),Zo(function(er){er.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var Dr=Cr.createElement("input");Dr.setAttribute("type","hidden"),er.appendChild(Dr).setAttribute("name","D"),er.querySelectorAll("[name=d]").length&&In.push("name"+Cs+"*[*^$|!~]?="),er.querySelectorAll(":enabled").length!==2&&In.push(":enabled",":disabled"),Fn.appendChild(er).disabled=!0,er.querySelectorAll(":disabled").length!==2&&In.push(":enabled",":disabled"),er.querySelectorAll("*,:x"),In.push(",.*:")})),(lt.matchesSelector=uu.test(to=Fn.matches||Fn.webkitMatchesSelector||Fn.mozMatchesSelector||Fn.oMatchesSelector||Fn.msMatchesSelector))&&Zo(function(er){lt.disconnectedMatch=to.call(er,"*"),to.call(er,"[s!='']:x"),oo.push("!=",_d)}),In=In.length&&new RegExp(In.join("|")),oo=oo.length&&new RegExp(oo.join("|")),zt=uu.test(Fn.compareDocumentPosition),No=zt||uu.test(Fn.contains)?function(er,Dr){var Kr=er.nodeType===9?er.documentElement:er,yn=Dr&&Dr.parentNode;return er===yn||!!(yn&&yn.nodeType===1&&(Kr.contains?Kr.contains(yn):er.compareDocumentPosition&&er.compareDocumentPosition(yn)&16))}:function(er,Dr){if(Dr){for(;Dr=Dr.parentNode;)if(Dr===er)return!0}return!1},Pl=zt?function(er,Dr){if(er===Dr)return jr=!0,0;var Kr=!er.compareDocumentPosition-!Dr.compareDocumentPosition;return Kr||(Kr=(er.ownerDocument||er)==(Dr.ownerDocument||Dr)?er.compareDocumentPosition(Dr):1,Kr&1||!lt.sortDetached&&Dr.compareDocumentPosition(er)===Kr?er==Cr||er.ownerDocument==rs&&No(rs,er)?-1:Dr==Cr||Dr.ownerDocument==rs&&No(rs,Dr)?1:_r?Gl(_r,er)-Gl(_r,Dr):0:Kr&4?-1:1)}:function(er,Dr){if(er===Dr)return jr=!0,0;var Kr,yn=0,vn=er.parentNode,Vn=Dr.parentNode,Hn=[er],qn=[Dr];if(!vn||!Vn)return er==Cr?-1:Dr==Cr?1:vn?-1:Vn?1:_r?Gl(_r,er)-Gl(_r,Dr):0;if(vn===Vn)return Hu(er,Dr);for(Kr=er;Kr=Kr.parentNode;)Hn.unshift(Kr);for(Kr=Dr;Kr=Kr.parentNode;)qn.unshift(Kr);for(;Hn[yn]===qn[yn];)yn++;return yn?Hu(Hn[yn],qn[yn]):Hn[yn]==rs?-1:qn[yn]==rs?1:0}),Cr},Os.matches=function(Tt,zt){return Os(Tt,null,null,zt)},Os.matchesSelector=function(Tt,zt){if(fr(Tt),lt.matchesSelector&&Kn&&!Ks[zt+" "]&&(!oo||!oo.test(zt))&&(!In||!In.test(zt)))try{var Xt=to.call(Tt,zt);if(Xt||lt.disconnectedMatch||Tt.document&&Tt.document.nodeType!==11)return Xt}catch{Ks(zt,!0)}return Os(zt,Cr,null,[Tt]).length>0},Os.contains=function(Tt,zt){return(Tt.ownerDocument||Tt)!=Cr&&fr(Tt),No(Tt,zt)},Os.attr=function(Tt,zt){(Tt.ownerDocument||Tt)!=Cr&&fr(Tt);var Xt=ut.attrHandle[zt.toLowerCase()],Pr=Xt&&yl.call(ut.attrHandle,zt.toLowerCase())?Xt(Tt,zt,!Kn):void 0;return Pr!==void 0?Pr:lt.attributes||!Kn?Tt.getAttribute(zt):(Pr=Tt.getAttributeNode(zt))&&Pr.specified?Pr.value:null},Os.escape=function(Tt){return(Tt+"").replace(np,ip)},Os.error=function(Tt){throw new Error("Syntax error, unrecognized expression: "+Tt)},Os.uniqueSort=function(Tt){var zt,Xt=[],Pr=0,er=0;if(jr=!lt.detectDuplicates,_r=!lt.sortStable&&Tt.slice(0),Tt.sort(Pl),jr){for(;zt=Tt[er++];)zt===Tt[er]&&(Pr=Xt.push(er));for(;Pr--;)Tt.splice(Xt[Pr],1)}return _r=null,Tt},mt=Os.getText=function(Tt){var zt,Xt="",Pr=0,er=Tt.nodeType;if(er){if(er===1||er===9||er===11){if(typeof Tt.textContent=="string")return Tt.textContent;for(Tt=Tt.firstChild;Tt;Tt=Tt.nextSibling)Xt+=mt(Tt)}else if(er===3||er===4)return Tt.nodeValue}else for(;zt=Tt[Pr++];)Xt+=mt(zt);return Xt},ut=Os.selectors={cacheLength:50,createPseudo:Ko,match:cu,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Tt){return Tt[1]=Tt[1].replace(xl,Sl),Tt[3]=(Tt[3]||Tt[4]||Tt[5]||"").replace(xl,Sl),Tt[2]==="~="&&(Tt[3]=" "+Tt[3]+" "),Tt.slice(0,4)},CHILD:function(Tt){return Tt[1]=Tt[1].toLowerCase(),Tt[1].slice(0,3)==="nth"?(Tt[3]||Os.error(Tt[0]),Tt[4]=+(Tt[4]?Tt[5]+(Tt[6]||1):2*(Tt[3]==="even"||Tt[3]==="odd")),Tt[5]=+(Tt[7]+Tt[8]||Tt[3]==="odd")):Tt[3]&&Os.error(Tt[0]),Tt},PSEUDO:function(Tt){var zt,Xt=!Tt[6]&&Tt[2];return cu.CHILD.test(Tt[0])?null:(Tt[3]?Tt[2]=Tt[4]||Tt[5]||"":Xt&&lu.test(Xt)&&(zt=yt(Xt,!0))&&(zt=Xt.indexOf(")",Xt.length-zt)-Xt.length)&&(Tt[0]=Tt[0].slice(0,zt),Tt[2]=Xt.slice(0,zt)),Tt.slice(0,3))}},filter:{TAG:function(Tt){var zt=Tt.replace(xl,Sl).toLowerCase();return Tt==="*"?function(){return!0}:function(Xt){return Xt.nodeName&&Xt.nodeName.toLowerCase()===zt}},CLASS:function(Tt){var zt=_i[Tt+" "];return zt||(zt=new RegExp("(^|"+Cs+")"+Tt+"("+Cs+"|$)"))&&_i(Tt,function(Xt){return zt.test(typeof Xt.className=="string"&&Xt.className||typeof Xt.getAttribute<"u"&&Xt.getAttribute("class")||"")})},ATTR:function(Tt,zt,Xt){return function(Pr){var er=Os.attr(Pr,Tt);return er==null?zt==="!=":zt?(er+="",zt==="="?er===Xt:zt==="!="?er!==Xt:zt==="^="?Xt&&er.indexOf(Xt)===0:zt==="*="?Xt&&er.indexOf(Xt)>-1:zt==="$="?Xt&&er.slice(-Xt.length)===Xt:zt==="~="?(" "+er.replace(Zp," ")+" ").indexOf(Xt)>-1:zt==="|="?er===Xt||er.slice(0,Xt.length+1)===Xt+"-":!1):!0}},CHILD:function(Tt,zt,Xt,Pr,er){var Dr=Tt.slice(0,3)!=="nth",Kr=Tt.slice(-4)!=="last",yn=zt==="of-type";return Pr===1&&er===0?function(vn){return!!vn.parentNode}:function(vn,Vn,Hn){var qn,ds,Fs,Yn,no,mo,fo=Dr!==Kr?"nextSibling":"previousSibling",ls=vn.parentNode,fu=yn&&vn.nodeName.toLowerCase(),du=!Hn&&!yn,ao=!1;if(ls){if(Dr){for(;fo;){for(Yn=vn;Yn=Yn[fo];)if(yn?Yn.nodeName.toLowerCase()===fu:Yn.nodeType===1)return!1;mo=fo=Tt==="only"&&!mo&&"nextSibling"}return!0}if(mo=[Kr?ls.firstChild:ls.lastChild],Kr&&du){for(Yn=ls,Fs=Yn[Is]||(Yn[Is]={}),ds=Fs[Yn.uniqueID]||(Fs[Yn.uniqueID]={}),qn=ds[Tt]||[],no=qn[0]===Ro&&qn[1],ao=no&&qn[2],Yn=no&&ls.childNodes[no];Yn=++no&&Yn&&Yn[fo]||(ao=no=0)||mo.pop();)if(Yn.nodeType===1&&++ao&&Yn===vn){ds[Tt]=[Ro,no,ao];break}}else if(du&&(Yn=vn,Fs=Yn[Is]||(Yn[Is]={}),ds=Fs[Yn.uniqueID]||(Fs[Yn.uniqueID]={}),qn=ds[Tt]||[],no=qn[0]===Ro&&qn[1],ao=no),ao===!1)for(;(Yn=++no&&Yn&&Yn[fo]||(ao=no=0)||mo.pop())&&!((yn?Yn.nodeName.toLowerCase()===fu:Yn.nodeType===1)&&++ao&&(du&&(Fs=Yn[Is]||(Yn[Is]={}),ds=Fs[Yn.uniqueID]||(Fs[Yn.uniqueID]={}),ds[Tt]=[Ro,ao]),Yn===vn)););return ao-=er,ao===Pr||ao%Pr===0&&ao/Pr>=0}}},PSEUDO:function(Tt,zt){var Xt,Pr=ut.pseudos[Tt]||ut.setFilters[Tt.toLowerCase()]||Os.error("unsupported pseudo: "+Tt);return Pr[Is]?Pr(zt):Pr.length>1?(Xt=[Tt,Tt,"",zt],ut.setFilters.hasOwnProperty(Tt.toLowerCase())?Ko(function(er,Dr){for(var Kr,yn=Pr(er,zt),vn=yn.length;vn--;)Kr=Gl(er,yn[vn]),er[Kr]=!(Dr[Kr]=yn[vn])}):function(er){return Pr(er,0,Xt)}):Pr}},pseudos:{not:Ko(function(Tt){var zt=[],Xt=[],Pr=Gt(Tt.replace(au,"$1"));return Pr[Is]?Ko(function(er,Dr,Kr,yn){for(var vn,Vn=Pr(er,null,yn,[]),Hn=er.length;Hn--;)(vn=Vn[Hn])&&(er[Hn]=!(Dr[Hn]=vn))}):function(er,Dr,Kr){return zt[0]=er,Pr(zt,null,Kr,Xt),zt[0]=null,!Xt.pop()}}),has:Ko(function(Tt){return function(zt){return Os(Tt,zt).length>0}}),contains:Ko(function(Tt){return Tt=Tt.replace(xl,Sl),function(zt){return(zt.textContent||mt(zt)).indexOf(Tt)>-1}}),lang:Ko(function(Tt){return ep.test(Tt||"")||Os.error("unsupported lang: "+Tt),Tt=Tt.replace(xl,Sl).toLowerCase(),function(zt){var Xt;do if(Xt=Kn?zt.lang:zt.getAttribute("xml:lang")||zt.getAttribute("lang"))return Xt=Xt.toLowerCase(),Xt===Tt||Xt.indexOf(Tt+"-")===0;while((zt=zt.parentNode)&&zt.nodeType===1);return!1}}),target:function(Tt){var zt=nt.location&&nt.location.hash;return zt&&zt.slice(1)===Tt.id},root:function(Tt){return Tt===Fn},focus:function(Tt){return Tt===Cr.activeElement&&(!Cr.hasFocus||Cr.hasFocus())&&!!(Tt.type||Tt.href||~Tt.tabIndex)},enabled:Ap(!1),disabled:Ap(!0),checked:function(Tt){var zt=Tt.nodeName.toLowerCase();return zt==="input"&&!!Tt.checked||zt==="option"&&!!Tt.selected},selected:function(Tt){return Tt.parentNode&&Tt.parentNode.selectedIndex,Tt.selected===!0},empty:function(Tt){for(Tt=Tt.firstChild;Tt;Tt=Tt.nextSibling)if(Tt.nodeType<6)return!1;return!0},parent:function(Tt){return!ut.pseudos.empty(Tt)},header:function(Tt){return Tp.test(Tt.nodeName)},input:function(Tt){return rp.test(Tt.nodeName)},button:function(Tt){var zt=Tt.nodeName.toLowerCase();return zt==="input"&&Tt.type==="button"||zt==="button"},text:function(Tt){var zt;return Tt.nodeName.toLowerCase()==="input"&&Tt.type==="text"&&((zt=Tt.getAttribute("type"))==null||zt.toLowerCase()==="text")},first:Ml(function(){return[0]}),last:Ml(function(Tt,zt){return[zt-1]}),eq:Ml(function(Tt,zt,Xt){return[Xt<0?Xt+zt:Xt]}),even:Ml(function(Tt,zt){for(var Xt=0;Xt<zt;Xt+=2)Tt.push(Xt);return Tt}),odd:Ml(function(Tt,zt){for(var Xt=1;Xt<zt;Xt+=2)Tt.push(Xt);return Tt}),lt:Ml(function(Tt,zt,Xt){for(var Pr=Xt<0?Xt+zt:Xt>zt?zt:Xt;--Pr>=0;)Tt.push(Pr);return Tt}),gt:Ml(function(Tt,zt,Xt){for(var Pr=Xt<0?Xt+zt:Xt;++Pr<zt;)Tt.push(Pr);return Tt})}},ut.pseudos.nth=ut.pseudos.eq;for(st in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})ut.pseudos[st]=Qp(st);for(st in{submit:!0,reset:!0})ut.pseudos[st]=Jp(st);function ju(){}ju.prototype=ut.filters=ut.pseudos,ut.setFilters=new ju,yt=Os.tokenize=function(Tt,zt){var Xt,Pr,er,Dr,Kr,yn,vn,Vn=ou[Tt+" "];if(Vn)return zt?0:Vn.slice(0);for(Kr=Tt,yn=[],vn=ut.preFilter;Kr;){(!Xt||(Pr=Vu.exec(Kr)))&&(Pr&&(Kr=Kr.slice(Pr[0].length)||Kr),yn.push(er=[])),Xt=!1,(Pr=Uu.exec(Kr))&&(Xt=Pr.shift(),er.push({value:Xt,type:Pr[0].replace(au," ")}),Kr=Kr.slice(Xt.length));for(Dr in ut.filter)(Pr=cu[Dr].exec(Kr))&&(!vn[Dr]||(Pr=vn[Dr](Pr)))&&(Xt=Pr.shift(),er.push({value:Xt,type:Dr,matches:Pr}),Kr=Kr.slice(Xt.length));if(!Xt)break}return zt?Kr.length:Kr?Os.error(Tt):ou(Tt,yn).slice(0)};function Au(Tt){for(var zt=0,Xt=Tt.length,Pr="";zt<Xt;zt++)Pr+=Tt[zt].value;return Pr}function Ru(Tt,zt,Xt){var Pr=zt.dir,er=zt.next,Dr=er||Pr,Kr=Xt&&Dr==="parentNode",yn=ws++;return zt.first?function(vn,Vn,Hn){for(;vn=vn[Pr];)if(vn.nodeType===1||Kr)return Tt(vn,Vn,Hn);return!1}:function(vn,Vn,Hn){var qn,ds,Fs,Yn=[Ro,yn];if(Hn){for(;vn=vn[Pr];)if((vn.nodeType===1||Kr)&&Tt(vn,Vn,Hn))return!0}else for(;vn=vn[Pr];)if(vn.nodeType===1||Kr)if(Fs=vn[Is]||(vn[Is]={}),ds=Fs[vn.uniqueID]||(Fs[vn.uniqueID]={}),er&&er===vn.nodeName.toLowerCase())vn=vn[Pr]||vn;else{if((qn=ds[Dr])&&qn[0]===Ro&&qn[1]===yn)return Yn[2]=qn[2];if(ds[Dr]=Yn,Yn[2]=Tt(vn,Vn,Hn))return!0}return!1}}function Lu(Tt){return Tt.length>1?function(zt,Xt,Pr){for(var er=Tt.length;er--;)if(!Tt[er](zt,Xt,Pr))return!1;return!0}:Tt[0]}function _g(Tt,zt,Xt){for(var Pr=0,er=zt.length;Pr<er;Pr++)Os(Tt,zt[Pr],Xt);return Xt}function _c(Tt,zt,Xt,Pr,er){for(var Dr,Kr=[],yn=0,vn=Tt.length,Vn=zt!=null;yn<vn;yn++)(Dr=Tt[yn])&&(!Xt||Xt(Dr,Pr,er))&&(Kr.push(Dr),Vn&&zt.push(yn));return Kr}function lp(Tt,zt,Xt,Pr,er,Dr){return Pr&&!Pr[Is]&&(Pr=lp(Pr)),er&&!er[Is]&&(er=lp(er,Dr)),Ko(function(Kr,yn,vn,Vn){var Hn,qn,ds,Fs=[],Yn=[],no=yn.length,mo=Kr||_g(zt||"*",vn.nodeType?[vn]:vn,[]),fo=Tt&&(Kr||!zt)?_c(mo,Fs,Tt,vn,Vn):mo,ls=Xt?er||(Kr?Tt:no||Pr)?[]:yn:fo;if(Xt&&Xt(fo,ls,vn,Vn),Pr)for(Hn=_c(ls,Yn),Pr(Hn,[],vn,Vn),qn=Hn.length;qn--;)(ds=Hn[qn])&&(ls[Yn[qn]]=!(fo[Yn[qn]]=ds));if(Kr){if(er||Tt){if(er){for(Hn=[],qn=ls.length;qn--;)(ds=ls[qn])&&Hn.push(fo[qn]=ds);er(null,ls=[],Hn,Vn)}for(qn=ls.length;qn--;)(ds=ls[qn])&&(Hn=er?Gl(Kr,ds):Fs[qn])>-1&&(Kr[Hn]=!(yn[Hn]=ds))}}else ls=_c(ls===yn?ls.splice(no,ls.length):ls),er?er(null,yn,ls,Vn):Vo.apply(yn,ls)})}function cp(Tt){for(var zt,Xt,Pr,er=Tt.length,Dr=ut.relative[Tt[0].type],Kr=Dr||ut.relative[" "],yn=Dr?1:0,vn=Ru(function(qn){return qn===zt},Kr,!0),Vn=Ru(function(qn){return Gl(zt,qn)>-1},Kr,!0),Hn=[function(qn,ds,Fs){var Yn=!Dr&&(Fs||ds!==Qt)||((zt=ds).nodeType?vn(qn,ds,Fs):Vn(qn,ds,Fs));return zt=null,Yn}];yn<er;yn++)if(Xt=ut.relative[Tt[yn].type])Hn=[Ru(Lu(Hn),Xt)];else{if(Xt=ut.filter[Tt[yn].type].apply(null,Tt[yn].matches),Xt[Is]){for(Pr=++yn;Pr<er&&!ut.relative[Tt[Pr].type];Pr++);return lp(yn>1&&Lu(Hn),yn>1&&Au(Tt.slice(0,yn-1).concat({value:Tt[yn-2].type===" "?"*":""})).replace(au,"$1"),Xt,yn<Pr&&cp(Tt.slice(yn,Pr)),Pr<er&&cp(Tt=Tt.slice(Pr)),Pr<er&&Au(Tt))}Hn.push(Xt)}return Lu(Hn)}function em(Tt,zt){var Xt=zt.length>0,Pr=Tt.length>0,er=function(Dr,Kr,yn,vn,Vn){var Hn,qn,ds,Fs=0,Yn="0",no=Dr&&[],mo=[],fo=Qt,ls=Dr||Pr&&ut.find.TAG("*",Vn),fu=Ro+=fo==null?1:Math.random()||.1,du=ls.length;for(Vn&&(Qt=Kr==Cr||Kr||Vn);Yn!==du&&(Hn=ls[Yn])!=null;Yn++){if(Pr&&Hn){for(qn=0,!Kr&&Hn.ownerDocument!=Cr&&(fr(Hn),yn=!Kn);ds=Tt[qn++];)if(ds(Hn,Kr||Cr,yn)){vn.push(Hn);break}Vn&&(Ro=fu)}Xt&&((Hn=!ds&&Hn)&&Fs--,Dr&&no.push(Hn))}if(Fs+=Yn,Xt&&Yn!==Fs){for(qn=0;ds=zt[qn++];)ds(no,mo,Kr,yn);if(Dr){if(Fs>0)for(;Yn--;)no[Yn]||mo[Yn]||(mo[Yn]=El.call(vn));mo=_c(mo)}Vo.apply(vn,mo),Vn&&!Dr&&mo.length>0&&Fs+zt.length>1&&Os.uniqueSort(vn)}return Vn&&(Ro=fu,Qt=fo),no};return Xt?Ko(er):er}return Gt=Os.compile=function(Tt,zt){var Xt,Pr=[],er=[],Dr=zu[Tt+" "];if(!Dr){for(zt||(zt=yt(Tt)),Xt=zt.length;Xt--;)Dr=cp(zt[Xt]),Dr[Is]?Pr.push(Dr):er.push(Dr);Dr=zu(Tt,em(er,Pr)),Dr.selector=Tt}return Dr},$t=Os.select=function(Tt,zt,Xt,Pr){var er,Dr,Kr,yn,vn,Vn=typeof Tt=="function"&&Tt,Hn=!Pr&&yt(Tt=Vn.selector||Tt);if(Xt=Xt||[],Hn.length===1){if(Dr=Hn[0]=Hn[0].slice(0),Dr.length>2&&(Kr=Dr[0]).type==="ID"&&zt.nodeType===9&&Kn&&ut.relative[Dr[1].type]){if(zt=(ut.find.ID(Kr.matches[0].replace(xl,Sl),zt)||[])[0],zt)Vn&&(zt=zt.parentNode);else return Xt;Tt=Tt.slice(Dr.shift().value.length)}for(er=cu.needsContext.test(Tt)?0:Dr.length;er--&&(Kr=Dr[er],!ut.relative[yn=Kr.type]);)if((vn=ut.find[yn])&&(Pr=vn(Kr.matches[0].replace(xl,Sl),Gu.test(Dr[0].type)&&ap(zt.parentNode)||zt))){if(Dr.splice(er,1),Tt=Pr.length&&Au(Dr),!Tt)return Vo.apply(Xt,Pr),Xt;break}}return(Vn||Gt(Tt,Hn))(Pr,zt,!Kn,Xt,!zt||Gu.test(Tt)&&ap(zt.parentNode)||zt),Xt},lt.sortStable=Is.split("").sort(Pl).join("")===Is,lt.detectDuplicates=!!jr,fr(),lt.sortDetached=Zo(function(Tt){return Tt.compareDocumentPosition(Cr.createElement("fieldset"))&1}),Zo(function(Tt){return Tt.innerHTML="<a href='#'></a>",Tt.firstChild.getAttribute("href")==="#"})||op("type|href|height|width",function(Tt,zt,Xt){if(!Xt)return Tt.getAttribute(zt,zt.toLowerCase()==="type"?1:2)}),(!lt.attributes||!Zo(function(Tt){return Tt.innerHTML="<input/>",Tt.firstChild.setAttribute("value",""),Tt.firstChild.getAttribute("value")===""}))&&op("value",function(Tt,zt,Xt){if(!Xt&&Tt.nodeName.toLowerCase()==="input")return Tt.defaultValue}),Zo(function(Tt){return Tt.getAttribute("disabled")==null})||op(Cu,function(Tt,zt,Xt){var Pr;if(!Xt)return Tt[zt]===!0?zt.toLowerCase():(Pr=Tt.getAttributeNode(zt))&&Pr.specified?Pr.value:null}),Os}(e);at.find=Ht,at.expr=Ht.selectors,at.expr[":"]=at.expr.pseudos,at.uniqueSort=at.unique=Ht.uniqueSort,at.text=Ht.getText,at.isXMLDoc=Ht.isXML,at.contains=Ht.contains,at.escapeSelector=Ht.escape;var sr=function(nt,st,lt){for(var ut=[],mt=lt!==void 0;(nt=nt[st])&&nt.nodeType!==9;)if(nt.nodeType===1){if(mt&&at(nt).is(lt))break;ut.push(nt)}return ut},mr=function(nt,st){for(var lt=[];nt;nt=nt.nextSibling)nt.nodeType===1&&nt!==st&&lt.push(nt);return lt},hr=at.expr.match.needsContext;function Er(nt,st){return nt.nodeName&&nt.nodeName.toLowerCase()===st.toLowerCase()}var Lr=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function sn(nt,st,lt){return ct(st)?at.grep(nt,function(ut,mt){return!!st.call(ut,mt,ut)!==lt}):st.nodeType?at.grep(nt,function(ut){return ut===st!==lt}):typeof st!="string"?at.grep(nt,function(ut){return j.call(st,ut)>-1!==lt}):at.filter(st,nt,lt)}at.filter=function(nt,st,lt){var ut=st[0];return lt&&(nt=":not("+nt+")"),st.length===1&&ut.nodeType===1?at.find.matchesSelector(ut,nt)?[ut]:[]:at.find.matches(nt,at.grep(st,function(mt){return mt.nodeType===1}))},at.fn.extend({find:function(nt){var st,lt,ut=this.length,mt=this;if(typeof nt!="string")return this.pushStack(at(nt).filter(function(){for(st=0;st<ut;st++)if(at.contains(mt[st],this))return!0}));for(lt=this.pushStack([]),st=0;st<ut;st++)at.find(nt,mt[st],lt);return ut>1?at.uniqueSort(lt):lt},filter:function(nt){return this.pushStack(sn(this,nt||[],!1))},not:function(nt){return this.pushStack(sn(this,nt||[],!0))},is:function(nt){return!!sn(this,typeof nt=="string"&&hr.test(nt)?at(nt):nt||[],!1).length}});var vr,Zr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Hr=at.fn.init=function(nt,st,lt){var ut,mt;if(!nt)return this;if(lt=lt||vr,typeof nt=="string")if(nt[0]==="<"&&nt[nt.length-1]===">"&&nt.length>=3?ut=[null,nt,null]:ut=Zr.exec(nt),ut&&(ut[1]||!st))if(ut[1]){if(st=st instanceof at?st[0]:st,at.merge(this,at.parseHTML(ut[1],st&&st.nodeType?st.ownerDocument||st:dt,!0)),Lr.test(ut[1])&&at.isPlainObject(st))for(ut in st)ct(this[ut])?this[ut](st[ut]):this.attr(ut,st[ut]);return this}else return mt=dt.getElementById(ut[2]),mt&&(this[0]=mt,this.length=1),this;else return!st||st.jquery?(st||lt).find(nt):this.constructor(st).find(nt);else{if(nt.nodeType)return this[0]=nt,this.length=1,this;if(ct(nt))return lt.ready!==void 0?lt.ready(nt):nt(at)}return at.makeArray(nt,this)};Hr.prototype=at.fn,vr=at(dt);var cr=/^(?:parents|prev(?:Until|All))/,lr={children:!0,contents:!0,next:!0,prev:!0};at.fn.extend({has:function(nt){var st=at(nt,this),lt=st.length;return this.filter(function(){for(var ut=0;ut<lt;ut++)if(at.contains(this,st[ut]))return!0})},closest:function(nt,st){var lt,ut=0,mt=this.length,vt=[],yt=typeof nt!="string"&&at(nt);if(!hr.test(nt)){for(;ut<mt;ut++)for(lt=this[ut];lt&&lt!==st;lt=lt.parentNode)if(lt.nodeType<11&&(yt?yt.index(lt)>-1:lt.nodeType===1&&at.find.matchesSelector(lt,nt))){vt.push(lt);break}}return this.pushStack(vt.length>1?at.uniqueSort(vt):vt)},index:function(nt){return nt?typeof nt=="string"?j.call(at(nt),this[0]):j.call(this,nt.jquery?nt[0]:nt):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(nt,st){return this.pushStack(at.uniqueSort(at.merge(this.get(),at(nt,st))))},addBack:function(nt){return this.add(nt==null?this.prevObject:this.prevObject.filter(nt))}});function Fr(nt,st){for(;(nt=nt[st])&&nt.nodeType!==1;);return nt}at.each({parent:function(nt){var st=nt.parentNode;return st&&st.nodeType!==11?st:null},parents:function(nt){return sr(nt,"parentNode")},parentsUntil:function(nt,st,lt){return sr(nt,"parentNode",lt)},next:function(nt){return Fr(nt,"nextSibling")},prev:function(nt){return Fr(nt,"previousSibling")},nextAll:function(nt){return sr(nt,"nextSibling")},prevAll:function(nt){return sr(nt,"previousSibling")},nextUntil:function(nt,st,lt){return sr(nt,"nextSibling",lt)},prevUntil:function(nt,st,lt){return sr(nt,"previousSibling",lt)},siblings:function(nt){return mr((nt.parentNode||{}).firstChild,nt)},children:function(nt){return mr(nt.firstChild)},contents:function(nt){return nt.contentDocument!=null&&a(nt.contentDocument)?nt.contentDocument:(Er(nt,"template")&&(nt=nt.content||nt),at.merge([],nt.childNodes))}},function(nt,st){at.fn[nt]=function(lt,ut){var mt=at.map(this,st,lt);return nt.slice(-5)!=="Until"&&(ut=lt),ut&&typeof ut=="string"&&(mt=at.filter(ut,mt)),this.length>1&&(lr[nt]||at.uniqueSort(mt),cr.test(nt)&&mt.reverse()),this.pushStack(mt)}});var an=/[^\x20\t\r\n\f]+/g;function kn(nt){var st={};return at.each(nt.match(an)||[],function(lt,ut){st[ut]=!0}),st}at.Callbacks=function(nt){nt=typeof nt=="string"?kn(nt):at.extend({},nt);var st,lt,ut,mt,vt=[],yt=[],Gt=-1,$t=function(){for(mt=mt||nt.once,ut=st=!0;yt.length;Gt=-1)for(lt=yt.shift();++Gt<vt.length;)vt[Gt].apply(lt[0],lt[1])===!1&&nt.stopOnFalse&&(Gt=vt.length,lt=!1);nt.memory||(lt=!1),st=!1,mt&&(lt?vt=[]:vt="")},Qt={add:function(){return vt&&(lt&&!st&&(Gt=vt.length-1,yt.push(lt)),function _r(jr){at.each(jr,function(fr,Cr){ct(Cr)?(!nt.unique||!Qt.has(Cr))&&vt.push(Cr):Cr&&Cr.length&&Ct(Cr)!=="string"&&_r(Cr)})}(arguments),lt&&!st&&$t()),this},remove:function(){return at.each(arguments,function(_r,jr){for(var fr;(fr=at.inArray(jr,vt,fr))>-1;)vt.splice(fr,1),fr<=Gt&&Gt--}),this},has:function(_r){return _r?at.inArray(_r,vt)>-1:vt.length>0},empty:function(){return vt&&(vt=[]),this},disable:function(){return mt=yt=[],vt=lt="",this},disabled:function(){return!vt},lock:function(){return mt=yt=[],!lt&&!st&&(vt=lt=""),this},locked:function(){return!!mt},fireWith:function(_r,jr){return mt||(jr=jr||[],jr=[_r,jr.slice?jr.slice():jr],yt.push(jr),st||$t()),this},fire:function(){return Qt.fireWith(this,arguments),this},fired:function(){return!!ut}};return Qt};function ms(nt){return nt}function Zn(nt){throw nt}function As(nt,st,lt,ut){var mt;try{nt&&ct(mt=nt.promise)?mt.call(nt).done(st).fail(lt):nt&&ct(mt=nt.then)?mt.call(nt,st,lt):st.apply(void 0,[nt].slice(ut))}catch(vt){lt.apply(void 0,[vt])}}at.extend({Deferred:function(nt){var st=[["notify","progress",at.Callbacks("memory"),at.Callbacks("memory"),2],["resolve","done",at.Callbacks("once memory"),at.Callbacks("once memory"),0,"resolved"],["reject","fail",at.Callbacks("once memory"),at.Callbacks("once memory"),1,"rejected"]],lt="pending",ut={state:function(){return lt},always:function(){return mt.done(arguments).fail(arguments),this},catch:function(vt){return ut.then(null,vt)},pipe:function(){var vt=arguments;return at.Deferred(function(yt){at.each(st,function(Gt,$t){var Qt=ct(vt[$t[4]])&&vt[$t[4]];mt[$t[1]](function(){var _r=Qt&&Qt.apply(this,arguments);_r&&ct(_r.promise)?_r.promise().progress(yt.notify).done(yt.resolve).fail(yt.reject):yt[$t[0]+"With"](this,Qt?[_r]:arguments)})}),vt=null}).promise()},then:function(vt,yt,Gt){var $t=0;function Qt(_r,jr,fr,Cr){return function(){var Fn=this,Kn=arguments,In=function(){var to,No;if(!(_r<$t)){if(to=fr.apply(Fn,Kn),to===jr.promise())throw new TypeError("Thenable self-resolution");No=to&&(typeof to=="object"||typeof to=="function")&&to.then,ct(No)?Cr?No.call(to,Qt($t,jr,ms,Cr),Qt($t,jr,Zn,Cr)):($t++,No.call(to,Qt($t,jr,ms,Cr),Qt($t,jr,Zn,Cr),Qt($t,jr,ms,jr.notifyWith))):(fr!==ms&&(Fn=void 0,Kn=[to]),(Cr||jr.resolveWith)(Fn,Kn))}},oo=Cr?In:function(){try{In()}catch(to){at.Deferred.exceptionHook&&at.Deferred.exceptionHook(to,oo.stackTrace),_r+1>=$t&&(fr!==Zn&&(Fn=void 0,Kn=[to]),jr.rejectWith(Fn,Kn))}};_r?oo():(at.Deferred.getStackHook&&(oo.stackTrace=at.Deferred.getStackHook()),e.setTimeout(oo))}}return at.Deferred(function(_r){st[0][3].add(Qt(0,_r,ct(Gt)?Gt:ms,_r.notifyWith)),st[1][3].add(Qt(0,_r,ct(vt)?vt:ms)),st[2][3].add(Qt(0,_r,ct(yt)?yt:Zn))}).promise()},promise:function(vt){return vt!=null?at.extend(vt,ut):ut}},mt={};return at.each(st,function(vt,yt){var Gt=yt[2],$t=yt[5];ut[yt[1]]=Gt.add,$t&&Gt.add(function(){lt=$t},st[3-vt][2].disable,st[3-vt][3].disable,st[0][2].lock,st[0][3].lock),Gt.add(yt[3].fire),mt[yt[0]]=function(){return mt[yt[0]+"With"](this===mt?void 0:this,arguments),this},mt[yt[0]+"With"]=Gt.fireWith}),ut.promise(mt),nt&&nt.call(mt,mt),mt},when:function(nt){var st=arguments.length,lt=st,ut=Array(lt),mt=d.call(arguments),vt=at.Deferred(),yt=function(Gt){return function($t){ut[Gt]=this,mt[Gt]=arguments.length>1?d.call(arguments):$t,--st||vt.resolveWith(ut,mt)}};if(st<=1&&(As(nt,vt.done(yt(lt)).resolve,vt.reject,!st),vt.state()==="pending"||ct(mt[lt]&&mt[lt].then)))return vt.then();for(;lt--;)As(mt[lt],yt(lt),vt.reject);return vt.promise()}});var Rs=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;at.Deferred.exceptionHook=function(nt,st){e.console&&e.console.warn&&nt&&Rs.test(nt.name)&&e.console.warn("jQuery.Deferred exception: "+nt.message,nt.stack,st)},at.readyException=function(nt){e.setTimeout(function(){throw nt})};var Gn=at.Deferred();at.fn.ready=function(nt){return Gn.then(nt).catch(function(st){at.readyException(st)}),this},at.extend({isReady:!1,readyWait:1,ready:function(nt){(nt===!0?--at.readyWait:at.isReady)||(at.isReady=!0,!(nt!==!0&&--at.readyWait>0)&&Gn.resolveWith(dt,[at]))}}),at.ready.then=Gn.then;function dn(){dt.removeEventListener("DOMContentLoaded",dn),e.removeEventListener("load",dn),at.ready()}dt.readyState==="complete"||dt.readyState!=="loading"&&!dt.documentElement.doScroll?e.setTimeout(at.ready):(dt.addEventListener("DOMContentLoaded",dn),e.addEventListener("load",dn));var xr=function(nt,st,lt,ut,mt,vt,yt){var Gt=0,$t=nt.length,Qt=lt==null;if(Ct(lt)==="object"){mt=!0;for(Gt in lt)xr(nt,st,Gt,lt[Gt],!0,vt,yt)}else if(ut!==void 0&&(mt=!0,ct(ut)||(yt=!0),Qt&&(yt?(st.call(nt,ut),st=null):(Qt=st,st=function(_r,jr,fr){return Qt.call(at(_r),fr)})),st))for(;Gt<$t;Gt++)st(nt[Gt],lt,yt?ut:ut.call(nt[Gt],Gt,st(nt[Gt],lt)));return mt?nt:Qt?st.call(nt):$t?st(nt[0],lt):vt},Yr=/^-ms-/,Rn=/-([a-z])/g;function Ln(nt,st){return st.toUpperCase()}function pr(nt){return nt.replace(Yr,"ms-").replace(Rn,Ln)}var nn=function(nt){return nt.nodeType===1||nt.nodeType===9||!+nt.nodeType};function mn(){this.expando=at.expando+mn.uid++}mn.uid=1,mn.prototype={cache:function(nt){var st=nt[this.expando];return st||(st={},nn(nt)&&(nt.nodeType?nt[this.expando]=st:Object.defineProperty(nt,this.expando,{value:st,configurable:!0}))),st},set:function(nt,st,lt){var ut,mt=this.cache(nt);if(typeof st=="string")mt[pr(st)]=lt;else for(ut in st)mt[pr(ut)]=st[ut];return mt},get:function(nt,st){return st===void 0?this.cache(nt):nt[this.expando]&&nt[this.expando][pr(st)]},access:function(nt,st,lt){return st===void 0||st&&typeof st=="string"&&lt===void 0?this.get(nt,st):(this.set(nt,st,lt),lt!==void 0?lt:st)},remove:function(nt,st){var lt,ut=nt[this.expando];if(ut!==void 0){if(st!==void 0)for(Array.isArray(st)?st=st.map(pr):(st=pr(st),st=st in ut?[st]:st.match(an)||[]),lt=st.length;lt--;)delete ut[st[lt]];(st===void 0||at.isEmptyObject(ut))&&(nt.nodeType?nt[this.expando]=void 0:delete nt[this.expando])}},hasData:function(nt){var st=nt[this.expando];return st!==void 0&&!at.isEmptyObject(st)}};var Vr=new mn,Mr=new mn,Cn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,is=/[A-Z]/g;function ts(nt){return nt==="true"?!0:nt==="false"?!1:nt==="null"?null:nt===+nt+""?+nt:Cn.test(nt)?JSON.parse(nt):nt}function Qn(nt,st,lt){var ut;if(lt===void 0&&nt.nodeType===1)if(ut="data-"+st.replace(is,"-$&").toLowerCase(),lt=nt.getAttribute(ut),typeof lt=="string"){try{lt=ts(lt)}catch{}Mr.set(nt,st,lt)}else lt=void 0;return lt}at.extend({hasData:function(nt){return Mr.hasData(nt)||Vr.hasData(nt)},data:function(nt,st,lt){return Mr.access(nt,st,lt)},removeData:function(nt,st){Mr.remove(nt,st)},_data:function(nt,st,lt){return Vr.access(nt,st,lt)},_removeData:function(nt,st){Vr.remove(nt,st)}}),at.fn.extend({data:function(nt,st){var lt,ut,mt,vt=this[0],yt=vt&&vt.attributes;if(nt===void 0){if(this.length&&(mt=Mr.get(vt),vt.nodeType===1&&!Vr.get(vt,"hasDataAttrs"))){for(lt=yt.length;lt--;)yt[lt]&&(ut=yt[lt].name,ut.indexOf("data-")===0&&(ut=pr(ut.slice(5)),Qn(vt,ut,mt[ut])));Vr.set(vt,"hasDataAttrs",!0)}return mt}return typeof nt=="object"?this.each(function(){Mr.set(this,nt)}):xr(this,function(Gt){var $t;if(vt&&Gt===void 0)return $t=Mr.get(vt,nt),$t!==void 0||($t=Qn(vt,nt),$t!==void 0)?$t:void 0;this.each(function(){Mr.set(this,nt,Gt)})},null,st,arguments.length>1,null,!0)},removeData:function(nt){return this.each(function(){Mr.remove(this,nt)})}}),at.extend({queue:function(nt,st,lt){var ut;if(nt)return st=(st||"fx")+"queue",ut=Vr.get(nt,st),lt&&(!ut||Array.isArray(lt)?ut=Vr.access(nt,st,at.makeArray(lt)):ut.push(lt)),ut||[]},dequeue:function(nt,st){st=st||"fx";var lt=at.queue(nt,st),ut=lt.length,mt=lt.shift(),vt=at._queueHooks(nt,st),yt=function(){at.dequeue(nt,st)};mt==="inprogress"&&(mt=lt.shift(),ut--),mt&&(st==="fx"&&lt.unshift("inprogress"),delete vt.stop,mt.call(nt,yt,vt)),!ut&&vt&&vt.empty.fire()},_queueHooks:function(nt,st){var lt=st+"queueHooks";return Vr.get(nt,lt)||Vr.access(nt,lt,{empty:at.Callbacks("once memory").add(function(){Vr.remove(nt,[st+"queue",lt])})})}}),at.fn.extend({queue:function(nt,st){var lt=2;return typeof nt!="string"&&(st=nt,nt="fx",lt--),arguments.length<lt?at.queue(this[0],nt):st===void 0?this:this.each(function(){var ut=at.queue(this,nt,st);at._queueHooks(this,nt),nt==="fx"&&ut[0]!=="inprogress"&&at.dequeue(this,nt)})},dequeue:function(nt){return this.each(function(){at.dequeue(this,nt)})},clearQueue:function(nt){return this.queue(nt||"fx",[])},promise:function(nt,st){var lt,ut=1,mt=at.Deferred(),vt=this,yt=this.length,Gt=function(){--ut||mt.resolveWith(vt,[vt])};for(typeof nt!="string"&&(st=nt,nt=void 0),nt=nt||"fx";yt--;)lt=Vr.get(vt[yt],nt+"queueHooks"),lt&&lt.empty&&(ut++,lt.empty.add(Gt));return Gt(),mt.promise(st)}});var Xs=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,bt=new RegExp("^(?:([+-])=|)("+Xs+")([a-z%]*)$","i"),gs=["Top","Right","Bottom","Left"],xs=dt.documentElement,Ls=function(nt){return at.contains(nt.ownerDocument,nt)},Ot={composed:!0};xs.getRootNode&&(Ls=function(nt){return at.contains(nt.ownerDocument,nt)||nt.getRootNode(Ot)===nt.ownerDocument});var _t=function(nt,st){return nt=st||nt,nt.style.display==="none"||nt.style.display===""&&Ls(nt)&&at.css(nt,"display")==="none"};function Ir(nt,st,lt,ut){var mt,vt,yt=20,Gt=ut?function(){return ut.cur()}:function(){return at.css(nt,st,"")},$t=Gt(),Qt=lt&&lt[3]||(at.cssNumber[st]?"":"px"),_r=nt.nodeType&&(at.cssNumber[st]||Qt!=="px"&&+$t)&&bt.exec(at.css(nt,st));if(_r&&_r[3]!==Qt){for($t=$t/2,Qt=Qt||_r[3],_r=+$t||1;yt--;)at.style(nt,st,_r+Qt),(1-vt)*(1-(vt=Gt()/$t||.5))<=0&&(yt=0),_r=_r/vt;_r=_r*2,at.style(nt,st,_r+Qt),lt=lt||[]}return lt&&(_r=+_r||+$t||0,mt=lt[1]?_r+(lt[1]+1)*lt[2]:+lt[2],ut&&(ut.unit=Qt,ut.start=_r,ut.end=mt)),mt}var en={};function ln(nt){var st,lt=nt.ownerDocument,ut=nt.nodeName,mt=en[ut];return mt||(st=lt.body.appendChild(lt.createElement(ut)),mt=at.css(st,"display"),st.parentNode.removeChild(st),mt==="none"&&(mt="block"),en[ut]=mt,mt)}function zn(nt,st){for(var lt,ut,mt=[],vt=0,yt=nt.length;vt<yt;vt++)ut=nt[vt],ut.style&&(lt=ut.style.display,st?(lt==="none"&&(mt[vt]=Vr.get(ut,"display")||null,mt[vt]||(ut.style.display="")),ut.style.display===""&&_t(ut)&&(mt[vt]=ln(ut))):lt!=="none"&&(mt[vt]="none",Vr.set(ut,"display",lt)));for(vt=0;vt<yt;vt++)mt[vt]!=null&&(nt[vt].style.display=mt[vt]);return nt}at.fn.extend({show:function(){return zn(this,!0)},hide:function(){return zn(this)},toggle:function(nt){return typeof nt=="boolean"?nt?this.show():this.hide():this.each(function(){_t(this)?at(this).show():at(this).hide()})}});var jn=/^(?:checkbox|radio)$/i,ys=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Bn=/^$|^module$|\/(?:java|ecma)script/i;(function(){var nt=dt.createDocumentFragment(),st=nt.appendChild(dt.createElement("div")),lt=dt.createElement("input");lt.setAttribute("type","radio"),lt.setAttribute("checked","checked"),lt.setAttribute("name","t"),st.appendChild(lt),ot.checkClone=st.cloneNode(!0).cloneNode(!0).lastChild.checked,st.innerHTML="<textarea>x</textarea>",ot.noCloneChecked=!!st.cloneNode(!0).lastChild.defaultValue,st.innerHTML="<option></option>",ot.option=!!st.lastChild})();var cs={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};cs.tbody=cs.tfoot=cs.colgroup=cs.caption=cs.thead,cs.th=cs.td,ot.option||(cs.optgroup=cs.option=[1,"<select multiple='multiple'>","</select>"]);function hs(nt,st){var lt;return typeof nt.getElementsByTagName<"u"?lt=nt.getElementsByTagName(st||"*"):typeof nt.querySelectorAll<"u"?lt=nt.querySelectorAll(st||"*"):lt=[],st===void 0||st&&Er(nt,st)?at.merge([nt],lt):lt}function Ss(nt,st){for(var lt=0,ut=nt.length;lt<ut;lt++)Vr.set(nt[lt],"globalEval",!st||Vr.get(st[lt],"globalEval"))}var us=/<|&#?\w+;/;function Hs(nt,st,lt,ut,mt){for(var vt,yt,Gt,$t,Qt,_r,jr=st.createDocumentFragment(),fr=[],Cr=0,Fn=nt.length;Cr<Fn;Cr++)if(vt=nt[Cr],vt||vt===0)if(Ct(vt)==="object")at.merge(fr,vt.nodeType?[vt]:vt);else if(!us.test(vt))fr.push(st.createTextNode(vt));else{for(yt=yt||jr.appendChild(st.createElement("div")),Gt=(ys.exec(vt)||["",""])[1].toLowerCase(),$t=cs[Gt]||cs._default,yt.innerHTML=$t[1]+at.htmlPrefilter(vt)+$t[2],_r=$t[0];_r--;)yt=yt.lastChild;at.merge(fr,yt.childNodes),yt=jr.firstChild,yt.textContent=""}for(jr.textContent="",Cr=0;vt=fr[Cr++];){if(ut&&at.inArray(vt,ut)>-1){mt&&mt.push(vt);continue}if(Qt=Ls(vt),yt=hs(jr.appendChild(vt),"script"),Qt&&Ss(yt),lt)for(_r=0;vt=yt[_r++];)Bn.test(vt.type||"")&&lt.push(vt)}return jr}var Ps=/^([^.]*)(?:\.(.+)|)/;function Ns(){return!0}function wo(){return!1}function Co(nt,st){return nt===Jo()==(st==="focus")}function Jo(){try{return dt.activeElement}catch{}}function na(nt,st,lt,ut,mt,vt){var yt,Gt;if(typeof st=="object"){typeof lt!="string"&&(ut=ut||lt,lt=void 0);for(Gt in st)na(nt,Gt,lt,ut,st[Gt],vt);return nt}if(ut==null&&mt==null?(mt=lt,ut=lt=void 0):mt==null&&(typeof lt=="string"?(mt=ut,ut=void 0):(mt=ut,ut=lt,lt=void 0)),mt===!1)mt=wo;else if(!mt)return nt;return vt===1&&(yt=mt,mt=function($t){return at().off($t),yt.apply(this,arguments)},mt.guid=yt.guid||(yt.guid=at.guid++)),nt.each(function(){at.event.add(this,st,mt,ut,lt)})}at.event={global:{},add:function(nt,st,lt,ut,mt){var vt,yt,Gt,$t,Qt,_r,jr,fr,Cr,Fn,Kn,In=Vr.get(nt);if(nn(nt))for(lt.handler&&(vt=lt,lt=vt.handler,mt=vt.selector),mt&&at.find.matchesSelector(xs,mt),lt.guid||(lt.guid=at.guid++),($t=In.events)||($t=In.events=Object.create(null)),(yt=In.handle)||(yt=In.handle=function(oo){return typeof at<"u"&&at.event.triggered!==oo.type?at.event.dispatch.apply(nt,arguments):void 0}),st=(st||"").match(an)||[""],Qt=st.length;Qt--;)Gt=Ps.exec(st[Qt])||[],Cr=Kn=Gt[1],Fn=(Gt[2]||"").split(".").sort(),Cr&&(jr=at.event.special[Cr]||{},Cr=(mt?jr.delegateType:jr.bindType)||Cr,jr=at.event.special[Cr]||{},_r=at.extend({type:Cr,origType:Kn,data:ut,handler:lt,guid:lt.guid,selector:mt,needsContext:mt&&at.expr.match.needsContext.test(mt),namespace:Fn.join(".")},vt),(fr=$t[Cr])||(fr=$t[Cr]=[],fr.delegateCount=0,(!jr.setup||jr.setup.call(nt,ut,Fn,yt)===!1)&&nt.addEventListener&&nt.addEventListener(Cr,yt)),jr.add&&(jr.add.call(nt,_r),_r.handler.guid||(_r.handler.guid=lt.guid)),mt?fr.splice(fr.delegateCount++,0,_r):fr.push(_r),at.event.global[Cr]=!0)},remove:function(nt,st,lt,ut,mt){var vt,yt,Gt,$t,Qt,_r,jr,fr,Cr,Fn,Kn,In=Vr.hasData(nt)&&Vr.get(nt);if(!(!In||!($t=In.events))){for(st=(st||"").match(an)||[""],Qt=st.length;Qt--;){if(Gt=Ps.exec(st[Qt])||[],Cr=Kn=Gt[1],Fn=(Gt[2]||"").split(".").sort(),!Cr){for(Cr in $t)at.event.remove(nt,Cr+st[Qt],lt,ut,!0);continue}for(jr=at.event.special[Cr]||{},Cr=(ut?jr.delegateType:jr.bindType)||Cr,fr=$t[Cr]||[],Gt=Gt[2]&&new RegExp("(^|\\.)"+Fn.join("\\.(?:.*\\.|)")+"(\\.|$)"),yt=vt=fr.length;vt--;)_r=fr[vt],(mt||Kn===_r.origType)&&(!lt||lt.guid===_r.guid)&&(!Gt||Gt.test(_r.namespace))&&(!ut||ut===_r.selector||ut==="**"&&_r.selector)&&(fr.splice(vt,1),_r.selector&&fr.delegateCount--,jr.remove&&jr.remove.call(nt,_r));yt&&!fr.length&&((!jr.teardown||jr.teardown.call(nt,Fn,In.handle)===!1)&&at.removeEvent(nt,Cr,In.handle),delete $t[Cr])}at.isEmptyObject($t)&&Vr.remove(nt,"handle events")}},dispatch:function(nt){var st,lt,ut,mt,vt,yt,Gt=new Array(arguments.length),$t=at.event.fix(nt),Qt=(Vr.get(this,"events")||Object.create(null))[$t.type]||[],_r=at.event.special[$t.type]||{};for(Gt[0]=$t,st=1;st<arguments.length;st++)Gt[st]=arguments[st];if($t.delegateTarget=this,!(_r.preDispatch&&_r.preDispatch.call(this,$t)===!1)){for(yt=at.event.handlers.call(this,$t,Qt),st=0;(mt=yt[st++])&&!$t.isPropagationStopped();)for($t.currentTarget=mt.elem,lt=0;(vt=mt.handlers[lt++])&&!$t.isImmediatePropagationStopped();)(!$t.rnamespace||vt.namespace===!1||$t.rnamespace.test(vt.namespace))&&($t.handleObj=vt,$t.data=vt.data,ut=((at.event.special[vt.origType]||{}).handle||vt.handler).apply(mt.elem,Gt),ut!==void 0&&($t.result=ut)===!1&&($t.preventDefault(),$t.stopPropagation()));return _r.postDispatch&&_r.postDispatch.call(this,$t),$t.result}},handlers:function(nt,st){var lt,ut,mt,vt,yt,Gt=[],$t=st.delegateCount,Qt=nt.target;if($t&&Qt.nodeType&&!(nt.type==="click"&&nt.button>=1)){for(;Qt!==this;Qt=Qt.parentNode||this)if(Qt.nodeType===1&&!(nt.type==="click"&&Qt.disabled===!0)){for(vt=[],yt={},lt=0;lt<$t;lt++)ut=st[lt],mt=ut.selector+" ",yt[mt]===void 0&&(yt[mt]=ut.needsContext?at(mt,this).index(Qt)>-1:at.find(mt,this,null,[Qt]).length),yt[mt]&&vt.push(ut);vt.length&&Gt.push({elem:Qt,handlers:vt})}}return Qt=this,$t<st.length&&Gt.push({elem:Qt,handlers:st.slice($t)}),Gt},addProp:function(nt,st){Object.defineProperty(at.Event.prototype,nt,{enumerable:!0,configurable:!0,get:ct(st)?function(){if(this.originalEvent)return st(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[nt]},set:function(lt){Object.defineProperty(this,nt,{enumerable:!0,configurable:!0,writable:!0,value:lt})}})},fix:function(nt){return nt[at.expando]?nt:new at.Event(nt)},special:{load:{noBubble:!0},click:{setup:function(nt){var st=this||nt;return jn.test(st.type)&&st.click&&Er(st,"input")&&js(st,"click",Ns),!1},trigger:function(nt){var st=this||nt;return jn.test(st.type)&&st.click&&Er(st,"input")&&js(st,"click"),!0},_default:function(nt){var st=nt.target;return jn.test(st.type)&&st.click&&Er(st,"input")&&Vr.get(st,"click")||Er(st,"a")}},beforeunload:{postDispatch:function(nt){nt.result!==void 0&&nt.originalEvent&&(nt.originalEvent.returnValue=nt.result)}}}};function js(nt,st,lt){if(!lt){Vr.get(nt,st)===void 0&&at.event.add(nt,st,Ns);return}Vr.set(nt,st,!1),at.event.add(nt,st,{namespace:!1,handler:function(ut){var mt,vt,yt=Vr.get(this,st);if(ut.isTrigger&1&&this[st]){if(yt.length)(at.event.special[st]||{}).delegateType&&ut.stopPropagation();else if(yt=d.call(arguments),Vr.set(this,st,yt),mt=lt(this,st),this[st](),vt=Vr.get(this,st),yt!==vt||mt?Vr.set(this,st,!1):vt={},yt!==vt)return ut.stopImmediatePropagation(),ut.preventDefault(),vt&&vt.value}else yt.length&&(Vr.set(this,st,{value:at.event.trigger(at.extend(yt[0],at.Event.prototype),yt.slice(1),this)}),ut.stopImmediatePropagation())}})}at.removeEvent=function(nt,st,lt){nt.removeEventListener&&nt.removeEventListener(st,lt)},at.Event=function(nt,st){if(!(this instanceof at.Event))return new at.Event(nt,st);nt&&nt.type?(this.originalEvent=nt,this.type=nt.type,this.isDefaultPrevented=nt.defaultPrevented||nt.defaultPrevented===void 0&&nt.returnValue===!1?Ns:wo,this.target=nt.target&&nt.target.nodeType===3?nt.target.parentNode:nt.target,this.currentTarget=nt.currentTarget,this.relatedTarget=nt.relatedTarget):this.type=nt,st&&at.extend(this,st),this.timeStamp=nt&&nt.timeStamp||Date.now(),this[at.expando]=!0},at.Event.prototype={constructor:at.Event,isDefaultPrevented:wo,isPropagationStopped:wo,isImmediatePropagationStopped:wo,isSimulated:!1,preventDefault:function(){var nt=this.originalEvent;this.isDefaultPrevented=Ns,nt&&!this.isSimulated&&nt.preventDefault()},stopPropagation:function(){var nt=this.originalEvent;this.isPropagationStopped=Ns,nt&&!this.isSimulated&&nt.stopPropagation()},stopImmediatePropagation:function(){var nt=this.originalEvent;this.isImmediatePropagationStopped=Ns,nt&&!this.isSimulated&&nt.stopImmediatePropagation(),this.stopPropagation()}},at.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},at.event.addProp),at.each({focus:"focusin",blur:"focusout"},function(nt,st){at.event.special[nt]={setup:function(){return js(this,nt,Co),!1},trigger:function(){return js(this,nt),!0},_default:function(lt){return Vr.get(lt.target,nt)},delegateType:st}}),at.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(nt,st){at.event.special[nt]={delegateType:st,bindType:st,handle:function(lt){var ut,mt=this,vt=lt.relatedTarget,yt=lt.handleObj;return(!vt||vt!==mt&&!at.contains(mt,vt))&&(lt.type=yt.origType,ut=yt.handler.apply(this,arguments),lt.type=st),ut}}}),at.fn.extend({on:function(nt,st,lt,ut){return na(this,nt,st,lt,ut)},one:function(nt,st,lt,ut){return na(this,nt,st,lt,ut,1)},off:function(nt,st,lt){var ut,mt;if(nt&&nt.preventDefault&&nt.handleObj)return ut=nt.handleObj,at(nt.delegateTarget).off(ut.namespace?ut.origType+"."+ut.namespace:ut.origType,ut.selector,ut.handler),this;if(typeof nt=="object"){for(mt in nt)this.off(mt,st,nt[mt]);return this}return(st===!1||typeof st=="function")&&(lt=st,st=void 0),lt===!1&&(lt=wo),this.each(function(){at.event.remove(this,nt,lt,st)})}});var _u=/<script|<style|<link/i,Po=/checked\s*(?:[^=]|=\s*.checked.)/i,yu=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function ga(nt,st){return Er(nt,"table")&&Er(st.nodeType!==11?st:st.firstChild,"tr")&&at(nt).children("tbody")[0]||nt}function wu(nt){return nt.type=(nt.getAttribute("type")!==null)+"/"+nt.type,nt}function Eu(nt){return(nt.type||"").slice(0,5)==="true/"?nt.type=nt.type.slice(5):nt.removeAttribute("type"),nt}function Kl(nt,st){var lt,ut,mt,vt,yt,Gt,$t;if(st.nodeType===1){if(Vr.hasData(nt)&&(vt=Vr.get(nt),$t=vt.events,$t)){Vr.remove(st,"handle events");for(mt in $t)for(lt=0,ut=$t[mt].length;lt<ut;lt++)at.event.add(st,mt,$t[mt][lt])}Mr.hasData(nt)&&(yt=Mr.access(nt),Gt=at.extend({},yt),Mr.set(st,Gt))}}function Il(nt,st){var lt=st.nodeName.toLowerCase();lt==="input"&&jn.test(nt.type)?st.checked=nt.checked:(lt==="input"||lt==="textarea")&&(st.defaultValue=nt.defaultValue)}function ko(nt,st,lt,ut){st=g(st);var mt,vt,yt,Gt,$t,Qt,_r=0,jr=nt.length,fr=jr-1,Cr=st[0],Fn=ct(Cr);if(Fn||jr>1&&typeof Cr=="string"&&!ot.checkClone&&Po.test(Cr))return nt.each(function(Kn){var In=nt.eq(Kn);Fn&&(st[0]=Cr.call(this,Kn,In.html())),ko(In,st,lt,ut)});if(jr&&(mt=Hs(st,nt[0].ownerDocument,!1,nt,ut),vt=mt.firstChild,mt.childNodes.length===1&&(mt=vt),vt||ut)){for(yt=at.map(hs(mt,"script"),wu),Gt=yt.length;_r<jr;_r++)$t=mt,_r!==fr&&($t=at.clone($t,!0,!0),Gt&&at.merge(yt,hs($t,"script"))),lt.call(nt[_r],$t,_r);if(Gt)for(Qt=yt[yt.length-1].ownerDocument,at.map(yt,Eu),_r=0;_r<Gt;_r++)$t=yt[_r],Bn.test($t.type||"")&&!Vr.access($t,"globalEval")&&at.contains(Qt,$t)&&($t.src&&($t.type||"").toLowerCase()!=="module"?at._evalUrl&&!$t.noModule&&at._evalUrl($t.src,{nonce:$t.nonce||$t.getAttribute("nonce")},Qt):gt($t.textContent.replace(yu,""),$t,Qt))}return nt}function _a(nt,st,lt){for(var ut,mt=st?at.filter(st,nt):nt,vt=0;(ut=mt[vt])!=null;vt++)!lt&&ut.nodeType===1&&at.cleanData(hs(ut)),ut.parentNode&&(lt&&Ls(ut)&&Ss(hs(ut,"script")),ut.parentNode.removeChild(ut));return nt}at.extend({htmlPrefilter:function(nt){return nt},clone:function(nt,st,lt){var ut,mt,vt,yt,Gt=nt.cloneNode(!0),$t=Ls(nt);if(!ot.noCloneChecked&&(nt.nodeType===1||nt.nodeType===11)&&!at.isXMLDoc(nt))for(yt=hs(Gt),vt=hs(nt),ut=0,mt=vt.length;ut<mt;ut++)Il(vt[ut],yt[ut]);if(st)if(lt)for(vt=vt||hs(nt),yt=yt||hs(Gt),ut=0,mt=vt.length;ut<mt;ut++)Kl(vt[ut],yt[ut]);else Kl(nt,Gt);return yt=hs(Gt,"script"),yt.length>0&&Ss(yt,!$t&&hs(nt,"script")),Gt},cleanData:function(nt){for(var st,lt,ut,mt=at.event.special,vt=0;(lt=nt[vt])!==void 0;vt++)if(nn(lt)){if(st=lt[Vr.expando]){if(st.events)for(ut in st.events)mt[ut]?at.event.remove(lt,ut):at.removeEvent(lt,ut,st.handle);lt[Vr.expando]=void 0}lt[Mr.expando]&&(lt[Mr.expando]=void 0)}}}),at.fn.extend({detach:function(nt){return _a(this,nt,!0)},remove:function(nt){return _a(this,nt)},text:function(nt){return xr(this,function(st){return st===void 0?at.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=st)})},null,nt,arguments.length)},append:function(){return ko(this,arguments,function(nt){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var st=ga(this,nt);st.appendChild(nt)}})},prepend:function(){return ko(this,arguments,function(nt){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var st=ga(this,nt);st.insertBefore(nt,st.firstChild)}})},before:function(){return ko(this,arguments,function(nt){this.parentNode&&this.parentNode.insertBefore(nt,this)})},after:function(){return ko(this,arguments,function(nt){this.parentNode&&this.parentNode.insertBefore(nt,this.nextSibling)})},empty:function(){for(var nt,st=0;(nt=this[st])!=null;st++)nt.nodeType===1&&(at.cleanData(hs(nt,!1)),nt.textContent="");return this},clone:function(nt,st){return nt=nt??!1,st=st??nt,this.map(function(){return at.clone(this,nt,st)})},html:function(nt){return xr(this,function(st){var lt=this[0]||{},ut=0,mt=this.length;if(st===void 0&&lt.nodeType===1)return lt.innerHTML;if(typeof st=="string"&&!_u.test(st)&&!cs[(ys.exec(st)||["",""])[1].toLowerCase()]){st=at.htmlPrefilter(st);try{for(;ut<mt;ut++)lt=this[ut]||{},lt.nodeType===1&&(at.cleanData(hs(lt,!1)),lt.innerHTML=st);lt=0}catch{}}lt&&this.empty().append(st)},null,nt,arguments.length)},replaceWith:function(){var nt=[];return ko(this,arguments,function(st){var lt=this.parentNode;at.inArray(this,nt)<0&&(at.cleanData(hs(this)),lt&&lt.replaceChild(st,this))},nt)}}),at.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(nt,st){at.fn[nt]=function(lt){for(var ut,mt=[],vt=at(lt),yt=vt.length-1,Gt=0;Gt<=yt;Gt++)ut=Gt===yt?this:this.clone(!0),at(vt[Gt])[st](ut),_.apply(mt,ut.get());return this.pushStack(mt)}});var ks=new RegExp("^("+Xs+")(?!px)[a-z%]+$","i"),Ol=/^--/,Cl=function(nt){var st=nt.ownerDocument.defaultView;return(!st||!st.opener)&&(st=e),st.getComputedStyle(nt)},Nl=function(nt,st,lt){var ut,mt,vt={};for(mt in st)vt[mt]=nt.style[mt],nt.style[mt]=st[mt];ut=lt.call(nt);for(mt in st)nt.style[mt]=vt[mt];return ut},nu=new RegExp(gs.join("|"),"i"),Fl="[\\x20\\t\\r\\n\\f]",Mo=new RegExp("^"+Fl+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Fl+"+$","g");(function(){function nt(){if(Qt){$t.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Qt.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",xs.appendChild($t).appendChild(Qt);var _r=e.getComputedStyle(Qt);lt=_r.top!=="1%",Gt=st(_r.marginLeft)===12,Qt.style.right="60%",vt=st(_r.right)===36,ut=st(_r.width)===36,Qt.style.position="absolute",mt=st(Qt.offsetWidth/3)===12,xs.removeChild($t),Qt=null}}function st(_r){return Math.round(parseFloat(_r))}var lt,ut,mt,vt,yt,Gt,$t=dt.createElement("div"),Qt=dt.createElement("div");Qt.style&&(Qt.style.backgroundClip="content-box",Qt.cloneNode(!0).style.backgroundClip="",ot.clearCloneStyle=Qt.style.backgroundClip==="content-box",at.extend(ot,{boxSizingReliable:function(){return nt(),ut},pixelBoxStyles:function(){return nt(),vt},pixelPosition:function(){return nt(),lt},reliableMarginLeft:function(){return nt(),Gt},scrollboxSize:function(){return nt(),mt},reliableTrDimensions:function(){var _r,jr,fr,Cr;return yt==null&&(_r=dt.createElement("table"),jr=dt.createElement("tr"),fr=dt.createElement("div"),_r.style.cssText="position:absolute;left:-11111px;border-collapse:separate",jr.style.cssText="border:1px solid",jr.style.height="1px",fr.style.height="9px",fr.style.display="block",xs.appendChild(_r).appendChild(jr).appendChild(fr),Cr=e.getComputedStyle(jr),yt=parseInt(Cr.height,10)+parseInt(Cr.borderTopWidth,10)+parseInt(Cr.borderBottomWidth,10)===jr.offsetHeight,xs.removeChild(_r)),yt}}))})();function Eo(nt,st,lt){var ut,mt,vt,yt,Gt=Ol.test(st),$t=nt.style;return lt=lt||Cl(nt),lt&&(yt=lt.getPropertyValue(st)||lt[st],Gt&&(yt=yt.replace(Mo,"$1")),yt===""&&!Ls(nt)&&(yt=at.style(nt,st)),!ot.pixelBoxStyles()&&ks.test(yt)&&nu.test(st)&&(ut=$t.width,mt=$t.minWidth,vt=$t.maxWidth,$t.minWidth=$t.maxWidth=$t.width=yt,yt=lt.width,$t.width=ut,$t.minWidth=mt,$t.maxWidth=vt)),yt!==void 0?yt+"":yt}function Ho(nt,st){return{get:function(){if(nt()){delete this.get;return}return(this.get=st).apply(this,arguments)}}}var bo=["Webkit","Moz","ms"],$l=dt.createElement("div").style,Zl={};function bu(nt){for(var st=nt[0].toUpperCase()+nt.slice(1),lt=bo.length;lt--;)if(nt=bo[lt]+st,nt in $l)return nt}function ba(nt){var st=at.cssProps[nt]||Zl[nt];return st||(nt in $l?nt:Zl[nt]=bu(nt)||nt)}var go=/^(none|table(?!-c[ea]).+)/,Fo={position:"absolute",visibility:"hidden",display:"block"},xo={letterSpacing:"0",fontWeight:"400"};function Ao(nt,st,lt){var ut=bt.exec(st);return ut?Math.max(0,ut[2]-(lt||0))+(ut[3]||"px"):st}function jo(nt,st,lt,ut,mt,vt){var yt=st==="width"?1:0,Gt=0,$t=0;if(lt===(ut?"border":"content"))return 0;for(;yt<4;yt+=2)lt==="margin"&&($t+=at.css(nt,lt+gs[yt],!0,mt)),ut?(lt==="content"&&($t-=at.css(nt,"padding"+gs[yt],!0,mt)),lt!=="margin"&&($t-=at.css(nt,"border"+gs[yt]+"Width",!0,mt))):($t+=at.css(nt,"padding"+gs[yt],!0,mt),lt!=="padding"?$t+=at.css(nt,"border"+gs[yt]+"Width",!0,mt):Gt+=at.css(nt,"border"+gs[yt]+"Width",!0,mt));return!ut&&vt>=0&&($t+=Math.max(0,Math.ceil(nt["offset"+st[0].toUpperCase()+st.slice(1)]-vt-$t-Gt-.5))||0),$t}function So(nt,st,lt){var ut=Cl(nt),mt=!ot.boxSizingReliable()||lt,vt=mt&&at.css(nt,"boxSizing",!1,ut)==="border-box",yt=vt,Gt=Eo(nt,st,ut),$t="offset"+st[0].toUpperCase()+st.slice(1);if(ks.test(Gt)){if(!lt)return Gt;Gt="auto"}return(!ot.boxSizingReliable()&&vt||!ot.reliableTrDimensions()&&Er(nt,"tr")||Gt==="auto"||!parseFloat(Gt)&&at.css(nt,"display",!1,ut)==="inline")&&nt.getClientRects().length&&(vt=at.css(nt,"boxSizing",!1,ut)==="border-box",yt=$t in nt,yt&&(Gt=nt[$t])),Gt=parseFloat(Gt)||0,Gt+jo(nt,st,lt||(vt?"border":"content"),yt,ut,Gt)+"px"}at.extend({cssHooks:{opacity:{get:function(nt,st){if(st){var lt=Eo(nt,"opacity");return lt===""?"1":lt}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(nt,st,lt,ut){if(!(!nt||nt.nodeType===3||nt.nodeType===8||!nt.style)){var mt,vt,yt,Gt=pr(st),$t=Ol.test(st),Qt=nt.style;if($t||(st=ba(Gt)),yt=at.cssHooks[st]||at.cssHooks[Gt],lt!==void 0){if(vt=typeof lt,vt==="string"&&(mt=bt.exec(lt))&&mt[1]&&(lt=Ir(nt,st,mt),vt="number"),lt==null||lt!==lt)return;vt==="number"&&!$t&&(lt+=mt&&mt[3]||(at.cssNumber[Gt]?"":"px")),!ot.clearCloneStyle&&lt===""&&st.indexOf("background")===0&&(Qt[st]="inherit"),(!yt||!("set"in yt)||(lt=yt.set(nt,lt,ut))!==void 0)&&($t?Qt.setProperty(st,lt):Qt[st]=lt)}else return yt&&"get"in yt&&(mt=yt.get(nt,!1,ut))!==void 0?mt:Qt[st]}},css:function(nt,st,lt,ut){var mt,vt,yt,Gt=pr(st),$t=Ol.test(st);return $t||(st=ba(Gt)),yt=at.cssHooks[st]||at.cssHooks[Gt],yt&&"get"in yt&&(mt=yt.get(nt,!0,lt)),mt===void 0&&(mt=Eo(nt,st,ut)),mt==="normal"&&st in xo&&(mt=xo[st]),lt===""||lt?(vt=parseFloat(mt),lt===!0||isFinite(vt)?vt||0:mt):mt}}),at.each(["height","width"],function(nt,st){at.cssHooks[st]={get:function(lt,ut,mt){if(ut)return go.test(at.css(lt,"display"))&&(!lt.getClientRects().length||!lt.getBoundingClientRect().width)?Nl(lt,Fo,function(){return So(lt,st,mt)}):So(lt,st,mt)},set:function(lt,ut,mt){var vt,yt=Cl(lt),Gt=!ot.scrollboxSize()&&yt.position==="absolute",$t=Gt||mt,Qt=$t&&at.css(lt,"boxSizing",!1,yt)==="border-box",_r=mt?jo(lt,st,mt,Qt,yt):0;return Qt&&Gt&&(_r-=Math.ceil(lt["offset"+st[0].toUpperCase()+st.slice(1)]-parseFloat(yt[st])-jo(lt,st,"border",!1,yt)-.5)),_r&&(vt=bt.exec(ut))&&(vt[3]||"px")!=="px"&&(lt.style[st]=ut,ut=at.css(lt,st)),Ao(lt,ut,_r)}}}),at.cssHooks.marginLeft=Ho(ot.reliableMarginLeft,function(nt,st){if(st)return(parseFloat(Eo(nt,"marginLeft"))||nt.getBoundingClientRect().left-Nl(nt,{marginLeft:0},function(){return nt.getBoundingClientRect().left}))+"px"}),at.each({margin:"",padding:"",border:"Width"},function(nt,st){at.cssHooks[nt+st]={expand:function(lt){for(var ut=0,mt={},vt=typeof lt=="string"?lt.split(" "):[lt];ut<4;ut++)mt[nt+gs[ut]+st]=vt[ut]||vt[ut-2]||vt[0];return mt}},nt!=="margin"&&(at.cssHooks[nt+st].set=Ao)}),at.fn.extend({css:function(nt,st){return xr(this,function(lt,ut,mt){var vt,yt,Gt={},$t=0;if(Array.isArray(ut)){for(vt=Cl(lt),yt=ut.length;$t<yt;$t++)Gt[ut[$t]]=at.css(lt,ut[$t],!1,vt);return Gt}return mt!==void 0?at.style(lt,ut,mt):at.css(lt,ut)},nt,st,arguments.length>1)}});function Bs(nt,st,lt,ut,mt){return new Bs.prototype.init(nt,st,lt,ut,mt)}at.Tween=Bs,Bs.prototype={constructor:Bs,init:function(nt,st,lt,ut,mt,vt){this.elem=nt,this.prop=lt,this.easing=mt||at.easing._default,this.options=st,this.start=this.now=this.cur(),this.end=ut,this.unit=vt||(at.cssNumber[lt]?"":"px")},cur:function(){var nt=Bs.propHooks[this.prop];return nt&&nt.get?nt.get(this):Bs.propHooks._default.get(this)},run:function(nt){var st,lt=Bs.propHooks[this.prop];return this.options.duration?this.pos=st=at.easing[this.easing](nt,this.options.duration*nt,0,1,this.options.duration):this.pos=st=nt,this.now=(this.end-this.start)*st+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),lt&&lt.set?lt.set(this):Bs.propHooks._default.set(this),this}},Bs.prototype.init.prototype=Bs.prototype,Bs.propHooks={_default:{get:function(nt){var st;return nt.elem.nodeType!==1||nt.elem[nt.prop]!=null&&nt.elem.style[nt.prop]==null?nt.elem[nt.prop]:(st=at.css(nt.elem,nt.prop,""),!st||st==="auto"?0:st)},set:function(nt){at.fx.step[nt.prop]?at.fx.step[nt.prop](nt):nt.elem.nodeType===1&&(at.cssHooks[nt.prop]||nt.elem.style[ba(nt.prop)]!=null)?at.style(nt.elem,nt.prop,nt.now+nt.unit):nt.elem[nt.prop]=nt.now}}},Bs.propHooks.scrollTop=Bs.propHooks.scrollLeft={set:function(nt){nt.elem.nodeType&&nt.elem.parentNode&&(nt.elem[nt.prop]=nt.now)}},at.easing={linear:function(nt){return nt},swing:function(nt){return .5-Math.cos(nt*Math.PI)/2},_default:"swing"},at.fx=Bs.prototype.init,at.fx.step={};var Do,Al,$o=/^(?:toggle|show|hide)$/,_s=/queueHooks$/;function Io(){Al&&(dt.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(Io):e.setTimeout(Io,at.fx.interval),at.fx.tick())}function xa(){return e.setTimeout(function(){Do=void 0}),Do=Date.now()}function Wo(nt,st){var lt,ut=0,mt={height:nt};for(st=st?1:0;ut<4;ut+=2-st)lt=gs[ut],mt["margin"+lt]=mt["padding"+lt]=nt;return st&&(mt.opacity=mt.width=nt),mt}function Bo(nt,st,lt){for(var ut,mt=(Ms.tweeners[st]||[]).concat(Ms.tweeners["*"]),vt=0,yt=mt.length;vt<yt;vt++)if(ut=mt[vt].call(lt,st,nt))return ut}function Bl(nt,st,lt){var ut,mt,vt,yt,Gt,$t,Qt,_r,jr="width"in st||"height"in st,fr=this,Cr={},Fn=nt.style,Kn=nt.nodeType&&_t(nt),In=Vr.get(nt,"fxshow");lt.queue||(yt=at._queueHooks(nt,"fx"),yt.unqueued==null&&(yt.unqueued=0,Gt=yt.empty.fire,yt.empty.fire=function(){yt.unqueued||Gt()}),yt.unqueued++,fr.always(function(){fr.always(function(){yt.unqueued--,at.queue(nt,"fx").length||yt.empty.fire()})}));for(ut in st)if(mt=st[ut],$o.test(mt)){if(delete st[ut],vt=vt||mt==="toggle",mt===(Kn?"hide":"show"))if(mt==="show"&&In&&In[ut]!==void 0)Kn=!0;else continue;Cr[ut]=In&&In[ut]||at.style(nt,ut)}if($t=!at.isEmptyObject(st),!(!$t&&at.isEmptyObject(Cr))){jr&&nt.nodeType===1&&(lt.overflow=[Fn.overflow,Fn.overflowX,Fn.overflowY],Qt=In&&In.display,Qt==null&&(Qt=Vr.get(nt,"display")),_r=at.css(nt,"display"),_r==="none"&&(Qt?_r=Qt:(zn([nt],!0),Qt=nt.style.display||Qt,_r=at.css(nt,"display"),zn([nt]))),(_r==="inline"||_r==="inline-block"&&Qt!=null)&&at.css(nt,"float")==="none"&&($t||(fr.done(function(){Fn.display=Qt}),Qt==null&&(_r=Fn.display,Qt=_r==="none"?"":_r)),Fn.display="inline-block")),lt.overflow&&(Fn.overflow="hidden",fr.always(function(){Fn.overflow=lt.overflow[0],Fn.overflowX=lt.overflow[1],Fn.overflowY=lt.overflow[2]})),$t=!1;for(ut in Cr)$t||(In?"hidden"in In&&(Kn=In.hidden):In=Vr.access(nt,"fxshow",{display:Qt}),vt&&(In.hidden=!Kn),Kn&&zn([nt],!0),fr.done(function(){Kn||zn([nt]),Vr.remove(nt,"fxshow");for(ut in Cr)at.style(nt,ut,Cr[ut])})),$t=Bo(Kn?In[ut]:0,ut,fr),ut in In||(In[ut]=$t.start,Kn&&($t.end=$t.start,$t.start=0))}}function $a(nt,st){var lt,ut,mt,vt,yt;for(lt in nt)if(ut=pr(lt),mt=st[ut],vt=nt[lt],Array.isArray(vt)&&(mt=vt[1],vt=nt[lt]=vt[0]),lt!==ut&&(nt[ut]=vt,delete nt[lt]),yt=at.cssHooks[ut],yt&&"expand"in yt){vt=yt.expand(vt),delete nt[ut];for(lt in vt)lt in nt||(nt[lt]=vt[lt],st[lt]=mt)}else st[ut]=mt}function Ms(nt,st,lt){var ut,mt,vt=0,yt=Ms.prefilters.length,Gt=at.Deferred().always(function(){delete $t.elem}),$t=function(){if(mt)return!1;for(var jr=Do||xa(),fr=Math.max(0,Qt.startTime+Qt.duration-jr),Cr=fr/Qt.duration||0,Fn=1-Cr,Kn=0,In=Qt.tweens.length;Kn<In;Kn++)Qt.tweens[Kn].run(Fn);return Gt.notifyWith(nt,[Qt,Fn,fr]),Fn<1&&In?fr:(In||Gt.notifyWith(nt,[Qt,1,0]),Gt.resolveWith(nt,[Qt]),!1)},Qt=Gt.promise({elem:nt,props:at.extend({},st),opts:at.extend(!0,{specialEasing:{},easing:at.easing._default},lt),originalProperties:st,originalOptions:lt,startTime:Do||xa(),duration:lt.duration,tweens:[],createTween:function(jr,fr){var Cr=at.Tween(nt,Qt.opts,jr,fr,Qt.opts.specialEasing[jr]||Qt.opts.easing);return Qt.tweens.push(Cr),Cr},stop:function(jr){var fr=0,Cr=jr?Qt.tweens.length:0;if(mt)return this;for(mt=!0;fr<Cr;fr++)Qt.tweens[fr].run(1);return jr?(Gt.notifyWith(nt,[Qt,1,0]),Gt.resolveWith(nt,[Qt,jr])):Gt.rejectWith(nt,[Qt,jr]),this}}),_r=Qt.props;for($a(_r,Qt.opts.specialEasing);vt<yt;vt++)if(ut=Ms.prefilters[vt].call(Qt,nt,_r,Qt.opts),ut)return ct(ut.stop)&&(at._queueHooks(Qt.elem,Qt.opts.queue).stop=ut.stop.bind(ut)),ut;return at.map(_r,Bo,Qt),ct(Qt.opts.start)&&Qt.opts.start.call(nt,Qt),Qt.progress(Qt.opts.progress).done(Qt.opts.done,Qt.opts.complete).fail(Qt.opts.fail).always(Qt.opts.always),at.fx.timer(at.extend($t,{elem:nt,anim:Qt,queue:Qt.opts.queue})),Qt}at.Animation=at.extend(Ms,{tweeners:{"*":[function(nt,st){var lt=this.createTween(nt,st);return Ir(lt.elem,nt,bt.exec(st),lt),lt}]},tweener:function(nt,st){ct(nt)?(st=nt,nt=["*"]):nt=nt.match(an);for(var lt,ut=0,mt=nt.length;ut<mt;ut++)lt=nt[ut],Ms.tweeners[lt]=Ms.tweeners[lt]||[],Ms.tweeners[lt].unshift(st)},prefilters:[Bl],prefilter:function(nt,st){st?Ms.prefilters.unshift(nt):Ms.prefilters.push(nt)}}),at.speed=function(nt,st,lt){var ut=nt&&typeof nt=="object"?at.extend({},nt):{complete:lt||!lt&&st||ct(nt)&&nt,duration:nt,easing:lt&&st||st&&!ct(st)&&st};return at.fx.off?ut.duration=0:typeof ut.duration!="number"&&(ut.duration in at.fx.speeds?ut.duration=at.fx.speeds[ut.duration]:ut.duration=at.fx.speeds._default),(ut.queue==null||ut.queue===!0)&&(ut.queue="fx"),ut.old=ut.complete,ut.complete=function(){ct(ut.old)&&ut.old.call(this),ut.queue&&at.dequeue(this,ut.queue)},ut},at.fn.extend({fadeTo:function(nt,st,lt,ut){return this.filter(_t).css("opacity",0).show().end().animate({opacity:st},nt,lt,ut)},animate:function(nt,st,lt,ut){var mt=at.isEmptyObject(nt),vt=at.speed(st,lt,ut),yt=function(){var Gt=Ms(this,at.extend({},nt),vt);(mt||Vr.get(this,"finish"))&&Gt.stop(!0)};return yt.finish=yt,mt||vt.queue===!1?this.each(yt):this.queue(vt.queue,yt)},stop:function(nt,st,lt){var ut=function(mt){var vt=mt.stop;delete mt.stop,vt(lt)};return typeof nt!="string"&&(lt=st,st=nt,nt=void 0),st&&this.queue(nt||"fx",[]),this.each(function(){var mt=!0,vt=nt!=null&&nt+"queueHooks",yt=at.timers,Gt=Vr.get(this);if(vt)Gt[vt]&&Gt[vt].stop&&ut(Gt[vt]);else for(vt in Gt)Gt[vt]&&Gt[vt].stop&&_s.test(vt)&&ut(Gt[vt]);for(vt=yt.length;vt--;)yt[vt].elem===this&&(nt==null||yt[vt].queue===nt)&&(yt[vt].anim.stop(lt),mt=!1,yt.splice(vt,1));(mt||!lt)&&at.dequeue(this,nt)})},finish:function(nt){return nt!==!1&&(nt=nt||"fx"),this.each(function(){var st,lt=Vr.get(this),ut=lt[nt+"queue"],mt=lt[nt+"queueHooks"],vt=at.timers,yt=ut?ut.length:0;for(lt.finish=!0,at.queue(this,nt,[]),mt&&mt.stop&&mt.stop.call(this,!0),st=vt.length;st--;)vt[st].elem===this&&vt[st].queue===nt&&(vt[st].anim.stop(!0),vt.splice(st,1));for(st=0;st<yt;st++)ut[st]&&ut[st].finish&&ut[st].finish.call(this);delete lt.finish})}}),at.each(["toggle","show","hide"],function(nt,st){var lt=at.fn[st];at.fn[st]=function(ut,mt,vt){return ut==null||typeof ut=="boolean"?lt.apply(this,arguments):this.animate(Wo(st,!0),ut,mt,vt)}}),at.each({slideDown:Wo("show"),slideUp:Wo("hide"),slideToggle:Wo("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(nt,st){at.fn[nt]=function(lt,ut,mt){return this.animate(st,lt,ut,mt)}}),at.timers=[],at.fx.tick=function(){var nt,st=0,lt=at.timers;for(Do=Date.now();st<lt.length;st++)nt=lt[st],!nt()&&lt[st]===nt&&lt.splice(st--,1);lt.length||at.fx.stop(),Do=void 0},at.fx.timer=function(nt){at.timers.push(nt),at.fx.start()},at.fx.interval=13,at.fx.start=function(){Al||(Al=!0,Io())},at.fx.stop=function(){Al=null},at.fx.speeds={slow:600,fast:200,_default:400},at.fn.delay=function(nt,st){return nt=at.fx&&at.fx.speeds[nt]||nt,st=st||"fx",this.queue(st,function(lt,ut){var mt=e.setTimeout(lt,nt);ut.stop=function(){e.clearTimeout(mt)}})},function(){var nt=dt.createElement("input"),st=dt.createElement("select"),lt=st.appendChild(dt.createElement("option"));nt.type="checkbox",ot.checkOn=nt.value!=="",ot.optSelected=lt.selected,nt=dt.createElement("input"),nt.value="t",nt.type="radio",ot.radioValue=nt.value==="t"}();var Xo,Oo=at.expr.attrHandle;at.fn.extend({attr:function(nt,st){return xr(this,at.attr,nt,st,arguments.length>1)},removeAttr:function(nt){return this.each(function(){at.removeAttr(this,nt)})}}),at.extend({attr:function(nt,st,lt){var ut,mt,vt=nt.nodeType;if(!(vt===3||vt===8||vt===2)){if(typeof nt.getAttribute>"u")return at.prop(nt,st,lt);if((vt!==1||!at.isXMLDoc(nt))&&(mt=at.attrHooks[st.toLowerCase()]||(at.expr.match.bool.test(st)?Xo:void 0)),lt!==void 0){if(lt===null){at.removeAttr(nt,st);return}return mt&&"set"in mt&&(ut=mt.set(nt,lt,st))!==void 0?ut:(nt.setAttribute(st,lt+""),lt)}return mt&&"get"in mt&&(ut=mt.get(nt,st))!==null?ut:(ut=at.find.attr(nt,st),ut??void 0)}},attrHooks:{type:{set:function(nt,st){if(!ot.radioValue&&st==="radio"&&Er(nt,"input")){var lt=nt.value;return nt.setAttribute("type",st),lt&&(nt.value=lt),st}}}},removeAttr:function(nt,st){var lt,ut=0,mt=st&&st.match(an);if(mt&&nt.nodeType===1)for(;lt=mt[ut++];)nt.removeAttribute(lt)}}),Xo={set:function(nt,st,lt){return st===!1?at.removeAttr(nt,lt):nt.setAttribute(lt,lt),lt}},at.each(at.expr.match.bool.source.match(/\w+/g),function(nt,st){var lt=Oo[st]||at.find.attr;Oo[st]=function(ut,mt,vt){var yt,Gt,$t=mt.toLowerCase();return vt||(Gt=Oo[$t],Oo[$t]=yt,yt=lt(ut,mt,vt)!=null?$t:null,Oo[$t]=Gt),yt}});var Yo=/^(?:input|select|textarea|button)$/i,zl=/^(?:a|area)$/i;at.fn.extend({prop:function(nt,st){return xr(this,at.prop,nt,st,arguments.length>1)},removeProp:function(nt){return this.each(function(){delete this[at.propFix[nt]||nt]})}}),at.extend({prop:function(nt,st,lt){var ut,mt,vt=nt.nodeType;if(!(vt===3||vt===8||vt===2))return(vt!==1||!at.isXMLDoc(nt))&&(st=at.propFix[st]||st,mt=at.propHooks[st]),lt!==void 0?mt&&"set"in mt&&(ut=mt.set(nt,lt,st))!==void 0?ut:nt[st]=lt:mt&&"get"in mt&&(ut=mt.get(nt,st))!==null?ut:nt[st]},propHooks:{tabIndex:{get:function(nt){var st=at.find.attr(nt,"tabindex");return st?parseInt(st,10):Yo.test(nt.nodeName)||zl.test(nt.nodeName)&&nt.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),ot.optSelected||(at.propHooks.selected={get:function(nt){var st=nt.parentNode;return st&&st.parentNode&&st.parentNode.selectedIndex,null},set:function(nt){var st=nt.parentNode;st&&(st.selectedIndex,st.parentNode&&st.parentNode.selectedIndex)}}),at.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){at.propFix[this.toLowerCase()]=this});function qo(nt){var st=nt.match(an)||[];return st.join(" ")}function zo(nt){return nt.getAttribute&&nt.getAttribute("class")||""}function Et(nt){return Array.isArray(nt)?nt:typeof nt=="string"?nt.match(an)||[]:[]}at.fn.extend({addClass:function(nt){var st,lt,ut,mt,vt,yt;return ct(nt)?this.each(function(Gt){at(this).addClass(nt.call(this,Gt,zo(this)))}):(st=Et(nt),st.length?this.each(function(){if(ut=zo(this),lt=this.nodeType===1&&" "+qo(ut)+" ",lt){for(vt=0;vt<st.length;vt++)mt=st[vt],lt.indexOf(" "+mt+" ")<0&&(lt+=mt+" ");yt=qo(lt),ut!==yt&&this.setAttribute("class",yt)}}):this)},removeClass:function(nt){var st,lt,ut,mt,vt,yt;return ct(nt)?this.each(function(Gt){at(this).removeClass(nt.call(this,Gt,zo(this)))}):arguments.length?(st=Et(nt),st.length?this.each(function(){if(ut=zo(this),lt=this.nodeType===1&&" "+qo(ut)+" ",lt){for(vt=0;vt<st.length;vt++)for(mt=st[vt];lt.indexOf(" "+mt+" ")>-1;)lt=lt.replace(" "+mt+" "," ");yt=qo(lt),ut!==yt&&this.setAttribute("class",yt)}}):this):this.attr("class","")},toggleClass:function(nt,st){var lt,ut,mt,vt,yt=typeof nt,Gt=yt==="string"||Array.isArray(nt);return ct(nt)?this.each(function($t){at(this).toggleClass(nt.call(this,$t,zo(this),st),st)}):typeof st=="boolean"&&Gt?st?this.addClass(nt):this.removeClass(nt):(lt=Et(nt),this.each(function(){if(Gt)for(vt=at(this),mt=0;mt<lt.length;mt++)ut=lt[mt],vt.hasClass(ut)?vt.removeClass(ut):vt.addClass(ut);else(nt===void 0||yt==="boolean")&&(ut=zo(this),ut&&Vr.set(this,"__className__",ut),this.setAttribute&&this.setAttribute("class",ut||nt===!1?"":Vr.get(this,"__className__")||""))}))},hasClass:function(nt){var st,lt,ut=0;for(st=" "+nt+" ";lt=this[ut++];)if(lt.nodeType===1&&(" "+qo(zo(lt))+" ").indexOf(st)>-1)return!0;return!1}});var Rt=/\r/g;at.fn.extend({val:function(nt){var st,lt,ut,mt=this[0];return arguments.length?(ut=ct(nt),this.each(function(vt){var yt;this.nodeType===1&&(ut?yt=nt.call(this,vt,at(this).val()):yt=nt,yt==null?yt="":typeof yt=="number"?yt+="":Array.isArray(yt)&&(yt=at.map(yt,function(Gt){return Gt==null?"":Gt+""})),st=at.valHooks[this.type]||at.valHooks[this.nodeName.toLowerCase()],(!st||!("set"in st)||st.set(this,yt,"value")===void 0)&&(this.value=yt))})):mt?(st=at.valHooks[mt.type]||at.valHooks[mt.nodeName.toLowerCase()],st&&"get"in st&&(lt=st.get(mt,"value"))!==void 0?lt:(lt=mt.value,typeof lt=="string"?lt.replace(Rt,""):lt??"")):void 0}}),at.extend({valHooks:{option:{get:function(nt){var st=at.find.attr(nt,"value");return st??qo(at.text(nt))}},select:{get:function(nt){var st,lt,ut,mt=nt.options,vt=nt.selectedIndex,yt=nt.type==="select-one",Gt=yt?null:[],$t=yt?vt+1:mt.length;for(vt<0?ut=$t:ut=yt?vt:0;ut<$t;ut++)if(lt=mt[ut],(lt.selected||ut===vt)&&!lt.disabled&&(!lt.parentNode.disabled||!Er(lt.parentNode,"optgroup"))){if(st=at(lt).val(),yt)return st;Gt.push(st)}return Gt},set:function(nt,st){for(var lt,ut,mt=nt.options,vt=at.makeArray(st),yt=mt.length;yt--;)ut=mt[yt],(ut.selected=at.inArray(at.valHooks.option.get(ut),vt)>-1)&&(lt=!0);return lt||(nt.selectedIndex=-1),vt}}}}),at.each(["radio","checkbox"],function(){at.valHooks[this]={set:function(nt,st){if(Array.isArray(st))return nt.checked=at.inArray(at(nt).val(),st)>-1}},ot.checkOn||(at.valHooks[this].get=function(nt){return nt.getAttribute("value")===null?"on":nt.value})}),ot.focusin="onfocusin"in e;var Ft=/^(?:focusinfocus|focusoutblur)$/,or=function(nt){nt.stopPropagation()};at.extend(at.event,{trigger:function(nt,st,lt,ut){var mt,vt,yt,Gt,$t,Qt,_r,jr,fr=[lt||dt],Cr=tt.call(nt,"type")?nt.type:nt,Fn=tt.call(nt,"namespace")?nt.namespace.split("."):[];if(vt=jr=yt=lt=lt||dt,!(lt.nodeType===3||lt.nodeType===8)&&!Ft.test(Cr+at.event.triggered)&&(Cr.indexOf(".")>-1&&(Fn=Cr.split("."),Cr=Fn.shift(),Fn.sort()),$t=Cr.indexOf(":")<0&&"on"+Cr,nt=nt[at.expando]?nt:new at.Event(Cr,typeof nt=="object"&&nt),nt.isTrigger=ut?2:3,nt.namespace=Fn.join("."),nt.rnamespace=nt.namespace?new RegExp("(^|\\.)"+Fn.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,nt.result=void 0,nt.target||(nt.target=lt),st=st==null?[nt]:at.makeArray(st,[nt]),_r=at.event.special[Cr]||{},!(!ut&&_r.trigger&&_r.trigger.apply(lt,st)===!1))){if(!ut&&!_r.noBubble&&!ft(lt)){for(Gt=_r.delegateType||Cr,Ft.test(Gt+Cr)||(vt=vt.parentNode);vt;vt=vt.parentNode)fr.push(vt),yt=vt;yt===(lt.ownerDocument||dt)&&fr.push(yt.defaultView||yt.parentWindow||e)}for(mt=0;(vt=fr[mt++])&&!nt.isPropagationStopped();)jr=vt,nt.type=mt>1?Gt:_r.bindType||Cr,Qt=(Vr.get(vt,"events")||Object.create(null))[nt.type]&&Vr.get(vt,"handle"),Qt&&Qt.apply(vt,st),Qt=$t&&vt[$t],Qt&&Qt.apply&&nn(vt)&&(nt.result=Qt.apply(vt,st),nt.result===!1&&nt.preventDefault());return nt.type=Cr,!ut&&!nt.isDefaultPrevented()&&(!_r._default||_r._default.apply(fr.pop(),st)===!1)&&nn(lt)&&$t&&ct(lt[Cr])&&!ft(lt)&&(yt=lt[$t],yt&&(lt[$t]=null),at.event.triggered=Cr,nt.isPropagationStopped()&&jr.addEventListener(Cr,or),lt[Cr](),nt.isPropagationStopped()&&jr.removeEventListener(Cr,or),at.event.triggered=void 0,yt&&(lt[$t]=yt)),nt.result}},simulate:function(nt,st,lt){var ut=at.extend(new at.Event,lt,{type:nt,isSimulated:!0});at.event.trigger(ut,null,st)}}),at.fn.extend({trigger:function(nt,st){return this.each(function(){at.event.trigger(nt,st,this)})},triggerHandler:function(nt,st){var lt=this[0];if(lt)return at.event.trigger(nt,st,lt,!0)}}),ot.focusin||at.each({focus:"focusin",blur:"focusout"},function(nt,st){var lt=function(ut){at.event.simulate(st,ut.target,at.event.fix(ut))};at.event.special[st]={setup:function(){var ut=this.ownerDocument||this.document||this,mt=Vr.access(ut,st);mt||ut.addEventListener(nt,lt,!0),Vr.access(ut,st,(mt||0)+1)},teardown:function(){var ut=this.ownerDocument||this.document||this,mt=Vr.access(ut,st)-1;mt?Vr.access(ut,st,mt):(ut.removeEventListener(nt,lt,!0),Vr.remove(ut,st))}}});var Gr=e.location,Sn={guid:Date.now()},Dt=/\?/;at.parseXML=function(nt){var st,lt;if(!nt||typeof nt!="string")return null;try{st=new e.DOMParser().parseFromString(nt,"text/xml")}catch{}return lt=st&&st.getElementsByTagName("parsererror")[0],(!st||lt)&&at.error("Invalid XML: "+(lt?at.map(lt.childNodes,function(ut){return ut.textContent}).join(`
`):nt)),st};var Wt=/\[\]$/,rr=/\r?\n/g,kr=/^(?:submit|button|image|reset|file)$/i,fn=/^(?:input|select|textarea|keygen)/i;function _n(nt,st,lt,ut){var mt;if(Array.isArray(st))at.each(st,function(vt,yt){lt||Wt.test(nt)?ut(nt,yt):_n(nt+"["+(typeof yt=="object"&&yt!=null?vt:"")+"]",yt,lt,ut)});else if(!lt&&Ct(st)==="object")for(mt in st)_n(nt+"["+mt+"]",st[mt],lt,ut);else ut(nt,st)}at.param=function(nt,st){var lt,ut=[],mt=function(vt,yt){var Gt=ct(yt)?yt():yt;ut[ut.length]=encodeURIComponent(vt)+"="+encodeURIComponent(Gt??"")};if(nt==null)return"";if(Array.isArray(nt)||nt.jquery&&!at.isPlainObject(nt))at.each(nt,function(){mt(this.name,this.value)});else for(lt in nt)_n(lt,nt[lt],st,mt);return ut.join("&")},at.fn.extend({serialize:function(){return at.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var nt=at.prop(this,"elements");return nt?at.makeArray(nt):this}).filter(function(){var nt=this.type;return this.name&&!at(this).is(":disabled")&&fn.test(this.nodeName)&&!kr.test(nt)&&(this.checked||!jn.test(nt))}).map(function(nt,st){var lt=at(this).val();return lt==null?null:Array.isArray(lt)?at.map(lt,function(ut){return{name:st.name,value:ut.replace(rr,`\r
`)}}):{name:st.name,value:lt.replace(rr,`\r
`)}}).get()}});var Jn=/%20/g,Mn=/#.*$/,$s=/([?&])_=[^&]*/,Ds=/^(.*?):[ \t]*([^\r\n]*)$/mg,Us=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Gs=/^(?:GET|HEAD)$/,Ts=/^\/\//,Ys={},zs={},Zs="*/".concat("*"),Qs=dt.createElement("a");Qs.href=Gr.href;function Rl(nt){return function(st,lt){typeof st!="string"&&(lt=st,st="*");var ut,mt=0,vt=st.toLowerCase().match(an)||[];if(ct(lt))for(;ut=vt[mt++];)ut[0]==="+"?(ut=ut.slice(1)||"*",(nt[ut]=nt[ut]||[]).unshift(lt)):(nt[ut]=nt[ut]||[]).push(lt)}}function Vl(nt,st,lt,ut){var mt={},vt=nt===zs;function yt(Gt){var $t;return mt[Gt]=!0,at.each(nt[Gt]||[],function(Qt,_r){var jr=_r(st,lt,ut);if(typeof jr=="string"&&!vt&&!mt[jr])return st.dataTypes.unshift(jr),yt(jr),!1;if(vt)return!($t=jr)}),$t}return yt(st.dataTypes[0])||!mt["*"]&&yt("*")}function Ul(nt,st){var lt,ut,mt=at.ajaxSettings.flatOptions||{};for(lt in st)st[lt]!==void 0&&((mt[lt]?nt:ut||(ut={}))[lt]=st[lt]);return ut&&at.extend(!0,nt,ut),nt}function xu(nt,st,lt){for(var ut,mt,vt,yt,Gt=nt.contents,$t=nt.dataTypes;$t[0]==="*";)$t.shift(),ut===void 0&&(ut=nt.mimeType||st.getResponseHeader("Content-Type"));if(ut){for(mt in Gt)if(Gt[mt]&&Gt[mt].test(ut)){$t.unshift(mt);break}}if($t[0]in lt)vt=$t[0];else{for(mt in lt){if(!$t[0]||nt.converters[mt+" "+$t[0]]){vt=mt;break}yt||(yt=mt)}vt=vt||yt}if(vt)return vt!==$t[0]&&$t.unshift(vt),lt[vt]}function Su(nt,st,lt,ut){var mt,vt,yt,Gt,$t,Qt={},_r=nt.dataTypes.slice();if(_r[1])for(yt in nt.converters)Qt[yt.toLowerCase()]=nt.converters[yt];for(vt=_r.shift();vt;)if(nt.responseFields[vt]&&(lt[nt.responseFields[vt]]=st),!$t&&ut&&nt.dataFilter&&(st=nt.dataFilter(st,nt.dataType)),$t=vt,vt=_r.shift(),vt){if(vt==="*")vt=$t;else if($t!=="*"&&$t!==vt){if(yt=Qt[$t+" "+vt]||Qt["* "+vt],!yt){for(mt in Qt)if(Gt=mt.split(" "),Gt[1]===vt&&(yt=Qt[$t+" "+Gt[0]]||Qt["* "+Gt[0]],yt)){yt===!0?yt=Qt[mt]:Qt[mt]!==!0&&(vt=Gt[0],_r.unshift(Gt[1]));break}}if(yt!==!0)if(yt&&nt.throws)st=yt(st);else try{st=yt(st)}catch(jr){return{state:"parsererror",error:yt?jr:"No conversion from "+$t+" to "+vt}}}}return{state:"success",data:st}}at.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Gr.href,type:"GET",isLocal:Us.test(Gr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Zs,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":at.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(nt,st){return st?Ul(Ul(nt,at.ajaxSettings),st):Ul(at.ajaxSettings,nt)},ajaxPrefilter:Rl(Ys),ajaxTransport:Rl(zs),ajax:function(nt,st){typeof nt=="object"&&(st=nt,nt=void 0),st=st||{};var lt,ut,mt,vt,yt,Gt,$t,Qt,_r,jr,fr=at.ajaxSetup({},st),Cr=fr.context||fr,Fn=fr.context&&(Cr.nodeType||Cr.jquery)?at(Cr):at.event,Kn=at.Deferred(),In=at.Callbacks("once memory"),oo=fr.statusCode||{},to={},No={},Is="canceled",rs={readyState:0,getResponseHeader:function(ws){var _i;if($t){if(!vt)for(vt={};_i=Ds.exec(mt);)vt[_i[1].toLowerCase()+" "]=(vt[_i[1].toLowerCase()+" "]||[]).concat(_i[2]);_i=vt[ws.toLowerCase()+" "]}return _i==null?null:_i.join(", ")},getAllResponseHeaders:function(){return $t?mt:null},setRequestHeader:function(ws,_i){return $t==null&&(ws=No[ws.toLowerCase()]=No[ws.toLowerCase()]||ws,to[ws]=_i),this},overrideMimeType:function(ws){return $t==null&&(fr.mimeType=ws),this},statusCode:function(ws){var _i;if(ws)if($t)rs.always(ws[rs.status]);else for(_i in ws)oo[_i]=[oo[_i],ws[_i]];return this},abort:function(ws){var _i=ws||Is;return lt&&lt.abort(_i),Ro(0,_i),this}};if(Kn.promise(rs),fr.url=((nt||fr.url||Gr.href)+"").replace(Ts,Gr.protocol+"//"),fr.type=st.method||st.type||fr.method||fr.type,fr.dataTypes=(fr.dataType||"*").toLowerCase().match(an)||[""],fr.crossDomain==null){Gt=dt.createElement("a");try{Gt.href=fr.url,Gt.href=Gt.href,fr.crossDomain=Qs.protocol+"//"+Qs.host!=Gt.protocol+"//"+Gt.host}catch{fr.crossDomain=!0}}if(fr.data&&fr.processData&&typeof fr.data!="string"&&(fr.data=at.param(fr.data,fr.traditional)),Vl(Ys,fr,st,rs),$t)return rs;Qt=at.event&&fr.global,Qt&&at.active++===0&&at.event.trigger("ajaxStart"),fr.type=fr.type.toUpperCase(),fr.hasContent=!Gs.test(fr.type),ut=fr.url.replace(Mn,""),fr.hasContent?fr.data&&fr.processData&&(fr.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(fr.data=fr.data.replace(Jn,"+")):(jr=fr.url.slice(ut.length),fr.data&&(fr.processData||typeof fr.data=="string")&&(ut+=(Dt.test(ut)?"&":"?")+fr.data,delete fr.data),fr.cache===!1&&(ut=ut.replace($s,"$1"),jr=(Dt.test(ut)?"&":"?")+"_="+Sn.guid+++jr),fr.url=ut+jr),fr.ifModified&&(at.lastModified[ut]&&rs.setRequestHeader("If-Modified-Since",at.lastModified[ut]),at.etag[ut]&&rs.setRequestHeader("If-None-Match",at.etag[ut])),(fr.data&&fr.hasContent&&fr.contentType!==!1||st.contentType)&&rs.setRequestHeader("Content-Type",fr.contentType),rs.setRequestHeader("Accept",fr.dataTypes[0]&&fr.accepts[fr.dataTypes[0]]?fr.accepts[fr.dataTypes[0]]+(fr.dataTypes[0]!=="*"?", "+Zs+"; q=0.01":""):fr.accepts["*"]);for(_r in fr.headers)rs.setRequestHeader(_r,fr.headers[_r]);if(fr.beforeSend&&(fr.beforeSend.call(Cr,rs,fr)===!1||$t))return rs.abort();if(Is="abort",In.add(fr.complete),rs.done(fr.success),rs.fail(fr.error),lt=Vl(zs,fr,st,rs),!lt)Ro(-1,"No Transport");else{if(rs.readyState=1,Qt&&Fn.trigger("ajaxSend",[rs,fr]),$t)return rs;fr.async&&fr.timeout>0&&(yt=e.setTimeout(function(){rs.abort("timeout")},fr.timeout));try{$t=!1,lt.send(to,Ro)}catch(ws){if($t)throw ws;Ro(-1,ws)}}function Ro(ws,_i,ou,zu){var Ks,Pl,yl,ro,El,To=_i;$t||($t=!0,yt&&e.clearTimeout(yt),lt=void 0,mt=zu||"",rs.readyState=ws>0?4:0,Ks=ws>=200&&ws<300||ws===304,ou&&(ro=xu(fr,rs,ou)),!Ks&&at.inArray("script",fr.dataTypes)>-1&&at.inArray("json",fr.dataTypes)<0&&(fr.converters["text script"]=function(){}),ro=Su(fr,ro,rs,Ks),Ks?(fr.ifModified&&(El=rs.getResponseHeader("Last-Modified"),El&&(at.lastModified[ut]=El),El=rs.getResponseHeader("etag"),El&&(at.etag[ut]=El)),ws===204||fr.type==="HEAD"?To="nocontent":ws===304?To="notmodified":(To=ro.state,Pl=ro.data,yl=ro.error,Ks=!yl)):(yl=To,(ws||!To)&&(To="error",ws<0&&(ws=0))),rs.status=ws,rs.statusText=(_i||To)+"",Ks?Kn.resolveWith(Cr,[Pl,To,rs]):Kn.rejectWith(Cr,[rs,To,yl]),rs.statusCode(oo),oo=void 0,Qt&&Fn.trigger(Ks?"ajaxSuccess":"ajaxError",[rs,fr,Ks?Pl:yl]),In.fireWith(Cr,[rs,To]),Qt&&(Fn.trigger("ajaxComplete",[rs,fr]),--at.active||at.event.trigger("ajaxStop")))}return rs},getJSON:function(nt,st,lt){return at.get(nt,st,lt,"json")},getScript:function(nt,st){return at.get(nt,void 0,st,"script")}}),at.each(["get","post"],function(nt,st){at[st]=function(lt,ut,mt,vt){return ct(ut)&&(vt=vt||mt,mt=ut,ut=void 0),at.ajax(at.extend({url:lt,type:st,dataType:vt,data:ut,success:mt},at.isPlainObject(lt)&&lt))}}),at.ajaxPrefilter(function(nt){var st;for(st in nt.headers)st.toLowerCase()==="content-type"&&(nt.contentType=nt.headers[st]||"")}),at._evalUrl=function(nt,st,lt){return at.ajax({url:nt,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(ut){at.globalEval(ut,st,lt)}})},at.fn.extend({wrapAll:function(nt){var st;return this[0]&&(ct(nt)&&(nt=nt.call(this[0])),st=at(nt,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&st.insertBefore(this[0]),st.map(function(){for(var lt=this;lt.firstElementChild;)lt=lt.firstElementChild;return lt}).append(this)),this},wrapInner:function(nt){return ct(nt)?this.each(function(st){at(this).wrapInner(nt.call(this,st))}):this.each(function(){var st=at(this),lt=st.contents();lt.length?lt.wrapAll(nt):st.append(nt)})},wrap:function(nt){var st=ct(nt);return this.each(function(lt){at(this).wrapAll(st?nt.call(this,lt):nt)})},unwrap:function(nt){return this.parent(nt).not("body").each(function(){at(this).replaceWith(this.childNodes)}),this}}),at.expr.pseudos.hidden=function(nt){return!at.expr.pseudos.visible(nt)},at.expr.pseudos.visible=function(nt){return!!(nt.offsetWidth||nt.offsetHeight||nt.getClientRects().length)},at.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var iu={0:200,1223:204},_l=at.ajaxSettings.xhr();ot.cors=!!_l&&"withCredentials"in _l,ot.ajax=_l=!!_l,at.ajaxTransport(function(nt){var st,lt;if(ot.cors||_l&&!nt.crossDomain)return{send:function(ut,mt){var vt,yt=nt.xhr();if(yt.open(nt.type,nt.url,nt.async,nt.username,nt.password),nt.xhrFields)for(vt in nt.xhrFields)yt[vt]=nt.xhrFields[vt];nt.mimeType&&yt.overrideMimeType&&yt.overrideMimeType(nt.mimeType),!nt.crossDomain&&!ut["X-Requested-With"]&&(ut["X-Requested-With"]="XMLHttpRequest");for(vt in ut)yt.setRequestHeader(vt,ut[vt]);st=function(Gt){return function(){st&&(st=lt=yt.onload=yt.onerror=yt.onabort=yt.ontimeout=yt.onreadystatechange=null,Gt==="abort"?yt.abort():Gt==="error"?typeof yt.status!="number"?mt(0,"error"):mt(yt.status,yt.statusText):mt(iu[yt.status]||yt.status,yt.statusText,(yt.responseType||"text")!=="text"||typeof yt.responseText!="string"?{binary:yt.response}:{text:yt.responseText},yt.getAllResponseHeaders()))}},yt.onload=st(),lt=yt.onerror=yt.ontimeout=st("error"),yt.onabort!==void 0?yt.onabort=lt:yt.onreadystatechange=function(){yt.readyState===4&&e.setTimeout(function(){st&&lt()})},st=st("abort");try{yt.send(nt.hasContent&&nt.data||null)}catch(Gt){if(st)throw Gt}},abort:function(){st&&st()}}}),at.ajaxPrefilter(function(nt){nt.crossDomain&&(nt.contents.script=!1)}),at.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(nt){return at.globalEval(nt),nt}}}),at.ajaxPrefilter("script",function(nt){nt.cache===void 0&&(nt.cache=!1),nt.crossDomain&&(nt.type="GET")}),at.ajaxTransport("script",function(nt){if(nt.crossDomain||nt.scriptAttrs){var st,lt;return{send:function(ut,mt){st=at("<script>").attr(nt.scriptAttrs||{}).prop({charset:nt.scriptCharset,src:nt.url}).on("load error",lt=function(vt){st.remove(),lt=null,vt&&mt(vt.type==="error"?404:200,vt.type)}),dt.head.appendChild(st[0])},abort:function(){lt&&lt()}}}});var Ll=[],su=/(=)\?(?=&|$)|\?\?/;at.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var nt=Ll.pop()||at.expando+"_"+Sn.guid++;return this[nt]=!0,nt}}),at.ajaxPrefilter("json jsonp",function(nt,st,lt){var ut,mt,vt,yt=nt.jsonp!==!1&&(su.test(nt.url)?"url":typeof nt.data=="string"&&(nt.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&su.test(nt.data)&&"data");if(yt||nt.dataTypes[0]==="jsonp")return ut=nt.jsonpCallback=ct(nt.jsonpCallback)?nt.jsonpCallback():nt.jsonpCallback,yt?nt[yt]=nt[yt].replace(su,"$1"+ut):nt.jsonp!==!1&&(nt.url+=(Dt.test(nt.url)?"&":"?")+nt.jsonp+"="+ut),nt.converters["script json"]=function(){return vt||at.error(ut+" was not called"),vt[0]},nt.dataTypes[0]="json",mt=e[ut],e[ut]=function(){vt=arguments},lt.always(function(){mt===void 0?at(e).removeProp(ut):e[ut]=mt,nt[ut]&&(nt.jsonpCallback=st.jsonpCallback,Ll.push(ut)),vt&&ct(mt)&&mt(vt[0]),vt=mt=void 0}),"script"}),ot.createHTMLDocument=function(){var nt=dt.implementation.createHTMLDocument("").body;return nt.innerHTML="<form></form><form></form>",nt.childNodes.length===2}(),at.parseHTML=function(nt,st,lt){if(typeof nt!="string")return[];typeof st=="boolean"&&(lt=st,st=!1);var ut,mt,vt;return st||(ot.createHTMLDocument?(st=dt.implementation.createHTMLDocument(""),ut=st.createElement("base"),ut.href=dt.location.href,st.head.appendChild(ut)):st=dt),mt=Lr.exec(nt),vt=!lt&&[],mt?[st.createElement(mt[1])]:(mt=Hs([nt],st,vt),vt&&vt.length&&at(vt).remove(),at.merge([],mt.childNodes))},at.fn.load=function(nt,st,lt){var ut,mt,vt,yt=this,Gt=nt.indexOf(" ");return Gt>-1&&(ut=qo(nt.slice(Gt)),nt=nt.slice(0,Gt)),ct(st)?(lt=st,st=void 0):st&&typeof st=="object"&&(mt="POST"),yt.length>0&&at.ajax({url:nt,type:mt||"GET",dataType:"html",data:st}).done(function($t){vt=arguments,yt.html(ut?at("<div>").append(at.parseHTML($t)).find(ut):$t)}).always(lt&&function($t,Qt){yt.each(function(){lt.apply(this,vt||[$t.responseText,Qt,$t])})}),this},at.expr.pseudos.animated=function(nt){return at.grep(at.timers,function(st){return nt===st.elem}).length},at.offset={setOffset:function(nt,st,lt){var ut,mt,vt,yt,Gt,$t,Qt,_r=at.css(nt,"position"),jr=at(nt),fr={};_r==="static"&&(nt.style.position="relative"),Gt=jr.offset(),vt=at.css(nt,"top"),$t=at.css(nt,"left"),Qt=(_r==="absolute"||_r==="fixed")&&(vt+$t).indexOf("auto")>-1,Qt?(ut=jr.position(),yt=ut.top,mt=ut.left):(yt=parseFloat(vt)||0,mt=parseFloat($t)||0),ct(st)&&(st=st.call(nt,lt,at.extend({},Gt))),st.top!=null&&(fr.top=st.top-Gt.top+yt),st.left!=null&&(fr.left=st.left-Gt.left+mt),"using"in st?st.using.call(nt,fr):jr.css(fr)}},at.fn.extend({offset:function(nt){if(arguments.length)return nt===void 0?this:this.each(function(mt){at.offset.setOffset(this,nt,mt)});var st,lt,ut=this[0];if(ut)return ut.getClientRects().length?(st=ut.getBoundingClientRect(),lt=ut.ownerDocument.defaultView,{top:st.top+lt.pageYOffset,left:st.left+lt.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var nt,st,lt,ut=this[0],mt={top:0,left:0};if(at.css(ut,"position")==="fixed")st=ut.getBoundingClientRect();else{for(st=this.offset(),lt=ut.ownerDocument,nt=ut.offsetParent||lt.documentElement;nt&&(nt===lt.body||nt===lt.documentElement)&&at.css(nt,"position")==="static";)nt=nt.parentNode;nt&&nt!==ut&&nt.nodeType===1&&(mt=at(nt).offset(),mt.top+=at.css(nt,"borderTopWidth",!0),mt.left+=at.css(nt,"borderLeftWidth",!0))}return{top:st.top-mt.top-at.css(ut,"marginTop",!0),left:st.left-mt.left-at.css(ut,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var nt=this.offsetParent;nt&&at.css(nt,"position")==="static";)nt=nt.offsetParent;return nt||xs})}}),at.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(nt,st){var lt=st==="pageYOffset";at.fn[nt]=function(ut){return xr(this,function(mt,vt,yt){var Gt;if(ft(mt)?Gt=mt:mt.nodeType===9&&(Gt=mt.defaultView),yt===void 0)return Gt?Gt[st]:mt[vt];Gt?Gt.scrollTo(lt?Gt.pageXOffset:yt,lt?yt:Gt.pageYOffset):mt[vt]=yt},nt,ut,arguments.length)}}),at.each(["top","left"],function(nt,st){at.cssHooks[st]=Ho(ot.pixelPosition,function(lt,ut){if(ut)return ut=Eo(lt,st),ks.test(ut)?at(lt).position()[st]+"px":ut})}),at.each({Height:"height",Width:"width"},function(nt,st){at.each({padding:"inner"+nt,content:st,"":"outer"+nt},function(lt,ut){at.fn[ut]=function(mt,vt){var yt=arguments.length&&(lt||typeof mt!="boolean"),Gt=lt||(mt===!0||vt===!0?"margin":"border");return xr(this,function($t,Qt,_r){var jr;return ft($t)?ut.indexOf("outer")===0?$t["inner"+nt]:$t.document.documentElement["client"+nt]:$t.nodeType===9?(jr=$t.documentElement,Math.max($t.body["scroll"+nt],jr["scroll"+nt],$t.body["offset"+nt],jr["offset"+nt],jr["client"+nt])):_r===void 0?at.css($t,Qt,Gt):at.style($t,Qt,_r,Gt)},st,yt?mt:void 0,yt)}})}),at.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(nt,st){at.fn[st]=function(lt){return this.on(st,lt)}}),at.fn.extend({bind:function(nt,st,lt){return this.on(nt,null,st,lt)},unbind:function(nt,st){return this.off(nt,null,st)},delegate:function(nt,st,lt,ut){return this.on(st,nt,lt,ut)},undelegate:function(nt,st,lt){return arguments.length===1?this.off(nt,"**"):this.off(st,nt||"**",lt)},hover:function(nt,st){return this.mouseenter(nt).mouseleave(st||nt)}}),at.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(nt,st){at.fn[st]=function(lt,ut){return arguments.length>0?this.on(st,null,lt,ut):this.trigger(st)}});var bp=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;at.proxy=function(nt,st){var lt,ut,mt;if(typeof st=="string"&&(lt=nt[st],st=nt,nt=lt),!!ct(nt))return ut=d.call(arguments,2),mt=function(){return nt.apply(st||this,ut.concat(d.call(arguments)))},mt.guid=nt.guid=nt.guid||at.guid++,mt},at.holdReady=function(nt){nt?at.readyWait++:at.ready(!0)},at.isArray=Array.isArray,at.parseJSON=JSON.parse,at.nodeName=Er,at.isFunction=ct,at.isWindow=ft,at.camelCase=pr,at.type=Ct,at.now=Date.now,at.isNumeric=function(nt){var st=at.type(nt);return(st==="number"||st==="string")&&!isNaN(nt-parseFloat(nt))},at.trim=function(nt){return nt==null?"":(nt+"").replace(bp,"$1")};var xp=e.jQuery,Kp=e.$;return at.noConflict=function(nt){return e.$===at&&(e.$=Kp),nt&&e.jQuery===at&&(e.jQuery=xp),at},typeof s>"u"&&(e.jQuery=e.$=at),at})})(jquery);const $=jqueryExports;/**
 * @license
 * (c) 2009-2016 Michael Leibman
 * michael{dot}leibman{at}gmail{dot}com
 * http://github.com/mleibman/slickgrid
 *
 * Distributed under MIT license.
 * All rights reserved.
 *
 * SlickGrid v2.4
 *
 * NOTES:
 *     Cell/row DOM manipulations are done directly bypassing jQuery's DOM manipulation methods.
 *     This increases the speed dramatically, but can only be done safely because there are no event handlers
 *     or data associated with any cell/row DOM nodes.  Cell editors must make sure they implement .destroy()
 *     and do proper cleanup.
 */const jQuery=$;(function(i){i.fn.drag=function(d,g,_){var j=typeof d=="string"?d:"",_e=i.isFunction(d)?d:i.isFunction(g)?g:null;return j.indexOf("drag")!==0&&(j="drag"+j),_=(d==_e?g:_)||{},_e?this.on(j,_,_e):this.trigger(j)};var e=i.event,s=e.special,o=s.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(d){var g=i.data(this,o.datakey),_=d.data||{};g.related+=1,i.each(o.defaults,function(j,_e){_[j]!==void 0&&(g[j]=_[j])})},remove:function(){i.data(this,o.datakey).related-=1},setup:function(){if(!i.data(this,o.datakey)){var d=i.extend({related:0},o.defaults);i.data(this,o.datakey,d),e.add(this,"touchstart mousedown",o.init,d),this.attachEvent&&this.attachEvent("ondragstart",o.dontstart)}},teardown:function(){var d=i.data(this,o.datakey)||{};d.related||(i.removeData(this,o.datakey),e.remove(this,"touchstart mousedown",o.init),o.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",o.dontstart))},init:function(d,g){if(o.touched)return;var _=d.data,j;if(d.which!=0&&_.which>0&&d.which!=_.which||i(d.target).is(_.not)||_.handle&&!i(d.target).closest(_.handle,d.currentTarget).length||(o.touched=d.type=="touchstart"?this:null,_.propagates=1,_.mousedown=this,_.interactions=[o.interaction(this,_)],_.target=d.target,_.pageX=d.pageX,_.pageY=d.pageY,_.dragging=null,j=o.hijack(d,"draginit",_),!_.propagates))return;j=o.flatten(j),j&&j.length&&(_.interactions=[],i.each(j,function(){_.interactions.push(o.interaction(this,_))})),_.propagates=_.interactions.length,_.drop!==!1&&s.drop&&s.drop.handler(d,_),o.textselect(!1);let _e=i(d.currentTarget).data("__doc__")||document;if(o.touched?e.add(o.touched,"touchmove touchend",o.handler,_):e.add(_e,"mousemove mouseup",o.handler,_),!o.touched||_.live)return!1},interaction:function(d,g){var _=d&&d.ownerDocument?i(d)[g.relative?"position":"offset"]()||{top:0,left:0}:{top:0,left:0};return{drag:d,callback:new o.callback,droppable:[],offset:_}},handler:function(d){var g=d.data;switch(d.type){case(!g.dragging&&"touchmove"):d.preventDefault();case(!g.dragging&&"mousemove"):if(Math.pow(d.pageX-g.pageX,2)+Math.pow(d.pageY-g.pageY,2)<Math.pow(g.distance,2))break;d.target=g.target,o.hijack(d,"dragstart",g),g.propagates&&(g.dragging=!0);case"touchmove":d.preventDefault();case"mousemove":if(g.dragging){if(o.hijack(d,"drag",g),g.propagates){g.drop!==!1&&s.drop&&s.drop.handler(d,g);break}d.type="mouseup"}case"touchend":case"mouseup":default:let _=i(g.target).data("__doc__")||d.currentTarget||document;o.touched?e.remove(o.touched,"touchmove touchend",o.handler):e.remove(_,"mousemove mouseup",o.handler),g.dragging&&(g.drop!==!1&&s.drop&&s.drop.handler(d,g),o.hijack(d,"dragend",g)),o.textselect(!0),g.click===!1&&g.dragging&&i.data(g.mousedown,"suppress.click",new Date().getTime()+5),g.dragging=o.touched=!1;break}},hijack:function(d,g,_,j,_e){if(_){var et={event:d.originalEvent,type:d.type},tt=g.indexOf("drop")?"drag":"drop",rt,it=j||0,ot,ct,ft=isNaN(j)?_.interactions.length:j;d.type=g;var dt=function(){};d.originalEvent=new jQuery.Event(et.event,{preventDefault:dt,stopPropagation:dt,stopImmediatePropagation:dt}),_.results=[];do if(ot=_.interactions[it]){if(g!=="dragend"&&ot.cancelled)continue;ct=o.properties(d,_,ot),ot.results=[],i(_e||ot[tt]||_.droppable).each(function(pt,gt){if(ct.target=gt,d.isPropagationStopped=function(){return!1},rt=gt?e.dispatch.call(gt,d,ct):null,rt===!1?(tt=="drag"&&(ot.cancelled=!0,_.propagates-=1),g=="drop"&&(ot[tt][pt]=null)):g=="dropinit"&&ot.droppable.push(o.element(rt)||gt),g=="dragstart"&&(ot.proxy=i(o.element(rt)||ot.drag)[0]),ot.results.push(rt),delete d.result,g!=="dropinit")return rt}),_.results[it]=o.flatten(ot.results),g=="dropinit"&&(ot.droppable=o.flatten(ot.droppable)),g=="dragstart"&&!ot.cancelled&&ct.update()}while(++it<ft);return d.type=et.type,d.originalEvent=et.event,o.flatten(_.results)}},properties:function(d,g,_){var j=_.callback;return j.drag=_.drag,j.proxy=_.proxy||_.drag,j.startX=g.pageX,j.startY=g.pageY,j.deltaX=d.pageX-g.pageX,j.deltaY=d.pageY-g.pageY,j.originalX=_.offset.left,j.originalY=_.offset.top,j.offsetX=j.originalX+j.deltaX,j.offsetY=j.originalY+j.deltaY,j.drop=o.flatten((_.drop||[]).slice()),j.available=o.flatten((_.droppable||[]).slice()),j},element:function(d){if(d&&(d.jquery||d.nodeType==1))return d},flatten:function(d){return i.map(d,function(g){return g&&g.jquery?i.makeArray(g):g&&g.length?o.flatten(g):g})},textselect:function(d){i(document)[d?"off":"on"]("selectstart",o.dontstart).css("MozUserSelect",d?"":"none"),document.unselectable=d?"off":"on"},dontstart:function(){return!1},callback:function(){}};o.callback.prototype={update:function(){s.drop&&this.available.length&&i.each(this.available,function(d){s.drop.locate(this,d)})}};var a=e.dispatch;e.dispatch=function(d){if(i.data(this,"suppress."+d.type)-new Date().getTime()>0){i.removeData(this,"suppress."+d.type);return}return a.apply(this,arguments)},s.draginit=s.dragstart=s.dragend=o})($);var scrollbarDimensions,maxSupportedCssHeight;function SlickGrid(container,data,columns,options){var defaults={alwaysShowVerticalScroll:!1,alwaysAllowHorizontalScroll:!1,explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,suppressActiveCellChangeOnEdit:!1,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,enableAsyncPostRenderCleanup:!1,asyncPostRenderCleanupDelay:40,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showColumnHeader:!0,showHeaderRow:!1,headerRowHeight:25,createFooterRow:!1,showFooterRow:!1,footerRowHeight:25,createPreHeaderPanel:!1,showPreHeaderPanel:!1,preHeaderPanelHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,frozenBottom:!1,frozenColumn:-1,frozenRow:-1,frozenRightViewportMinWidth:100,fullWidthRows:!1,multiColumnSort:!1,numberedMultiColumnSort:!1,tristateMultiColumnSort:!1,sortColNumberInSeparateSpan:!1,defaultFormatter,forceSyncScrolling:!1,addNewRowCssClass:"new-row",preserveCopiedSelectionOnPaste:!1,showCellSelection:!0,viewportClass:null,minRowBuffer:3,emulatePagingWhenScrolling:!0,editorCellNavOnLRKeys:!1,enableMouseWheelScrollHandler:!0,doPaging:!0,autosizeColsMode:Slick.GridAutosizeColsMode.LegacyOff,autosizeColPaddingPx:4,autosizeTextAvgToMWidthRatio:.75,viewportSwitchToScrollModeWidthPercent:void 0,viewportMinWidthPx:void 0,viewportMaxWidthPx:void 0,suppressCssChangesOnHiddenInit:!1},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,maxWidth:void 0,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},columnAutosizeDefaults={ignoreHeaderText:!1,colValueArray:void 0,allowAddlPercent:void 0,formatterOverride:void 0,autosizeMode:Slick.ColAutosizeMode.ContentIntelligent,rowSelectionModeOnInit:void 0,rowSelectionMode:Slick.RowSelectionMode.FirstNRows,rowSelectionCount:100,valueFilterMode:Slick.ValueFilterMode.None,widthEvalMode:Slick.WidthEvalMode.CanvasTextSize,sizeToRemaining:void 0,widthPx:void 0,colDataTypeOf:void 0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2;$();var $headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacerL,$headerRowSpacerR,$footerRow,$footerRowScroller,$footerRowSpacerL,$footerRowSpacerR,$preHeaderPanel,$preHeaderPanelScroller,$preHeaderPanelSpacer,$preHeaderPanelR,$preHeaderPanelScrollerR,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,treeColumns,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,canvasWidthL,canvasWidthR,headersWidth,headersWidthL,headersWidthR,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,jQueryNewWidthBehaviour=!1,absoluteColumnMinWidth,hasFrozenRows=!1,frozenRowsHeight=0,actualFrozenRow=-1,paneTopH=0,paneBottomH=0,viewportTopH=0,topPanelH=0,headerRowH=0,footerRowH=0,tabbingDirection=1,$activeCanvasNode,$activeViewportNode,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows=0,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],pagingActive=!1,pagingIsLastPage=!1,scrollThrottle=ActionThrottle(render,50),h_editorLoader=null,h_postrender=null,h_postrenderCleanup=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,postProcessedCleanupQueue=[],counter_rows_rendered=0,counter_rows_removed=0,rowNodeFromLastMouseWheelEvent,zombieRowNodeFromLastMouseWheelEvent,$paneHeaderL,$paneHeaderR,$paneTopL,$paneTopR,$paneBottomL,$paneBottomR,$headerScrollerL,$headerScrollerR,$headerL,$headerR,$groupHeadersL,$groupHeadersR,$headerRowScrollerL,$headerRowScrollerR,$footerRowScrollerL,$footerRowScrollerR,$headerRowL,$headerRowR,$footerRowL,$footerRowR,$topPanelScrollerL,$topPanelScrollerR,$topPanelL,$topPanelR,$viewportTopL,$viewportTopR,$viewportBottomL,$viewportBottomR,$canvasTopL,$canvasTopR,$canvasBottomL,$canvasBottomR,$viewportScrollContainerX,$viewportScrollContainerY,$headerScrollContainer,$headerRowScrollContainer,$footerRowScrollContainer,cssShow={position:"absolute",visibility:"hidden",display:"block"},$hiddenParents,oldProps=[],columnResizeDragging=!1,__doc__=document;function init(){if(container instanceof $?$container=container:$container=$(container),$container.length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");if(options.suppressCssChangesOnHiddenInit||cacheCssForHiddenInit(),maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,treeColumns=new Slick.TreeColumns(columns),columns=treeColumns.extractColumns(),updateColumnProps(),options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");if(editController={commitCurrentEdit,cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$paneHeaderL=$("<div class='slick-pane slick-pane-header slick-pane-left' tabIndex='0' />").appendTo($container),$paneHeaderR=$("<div class='slick-pane slick-pane-header slick-pane-right' tabIndex='0' />").appendTo($container),$paneTopL=$("<div class='slick-pane slick-pane-top slick-pane-left' tabIndex='0' />").appendTo($container),$paneTopR=$("<div class='slick-pane slick-pane-top slick-pane-right' tabIndex='0' />").appendTo($container),$paneBottomL=$("<div class='slick-pane slick-pane-bottom slick-pane-left' tabIndex='0' />").appendTo($container),$paneBottomR=$("<div class='slick-pane slick-pane-bottom slick-pane-right' tabIndex='0' />").appendTo($container),options.createPreHeaderPanel&&($preHeaderPanelScroller=$("<div class='slick-preheader-panel ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($paneHeaderL),$preHeaderPanel=$("<div />").appendTo($preHeaderPanelScroller),$preHeaderPanelSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($preHeaderPanelScroller),$preHeaderPanelScrollerR=$("<div class='slick-preheader-panel ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($paneHeaderR),$preHeaderPanelR=$("<div />").appendTo($preHeaderPanelScrollerR),$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($preHeaderPanelScrollerR),options.showPreHeaderPanel||($preHeaderPanelScroller.hide(),$preHeaderPanelScrollerR.hide())),$headerScrollerL=$("<div class='slick-header ui-state-default slick-header-left' />").appendTo($paneHeaderL),$headerScrollerR=$("<div class='slick-header ui-state-default slick-header-right' />").appendTo($paneHeaderR),$headerScroller=$().add($headerScrollerL).add($headerScrollerR),treeColumns.hasDepth()){$groupHeadersL=[],$groupHeadersR=[];for(var i=0;i<treeColumns.getDepth()-1;i++)$groupHeadersL[i]=$("<div class='slick-group-header-columns slick-group-header-columns-left' style='left:-1000px' />").appendTo($headerScrollerL),$groupHeadersR[i]=$("<div class='slick-group-header-columns slick-group-header-columns-right' style='left:-1000px' />").appendTo($headerScrollerR);$().add($groupHeadersL).add($groupHeadersR)}$headerL=$("<div class='slick-header-columns slick-header-columns-left' style='left:-1000px' />").data("__doc__",__doc__).appendTo($headerScrollerL),$headerR=$("<div class='slick-header-columns slick-header-columns-right' style='left:-1000px' />").appendTo($headerScrollerR),$headers=$().add($headerL).add($headerR),$headerRowScrollerL=$("<div class='slick-headerrow ui-state-default' />").appendTo($paneTopL),$headerRowScrollerR=$("<div class='slick-headerrow ui-state-default' />").appendTo($paneTopR),$headerRowScroller=$().add($headerRowScrollerL).add($headerRowScrollerR),$headerRowSpacerL=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($headerRowScrollerL),$headerRowSpacerR=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($headerRowScrollerR),$headerRowL=$("<div class='slick-headerrow-columns slick-headerrow-columns-left' />").appendTo($headerRowScrollerL),$headerRowR=$("<div class='slick-headerrow-columns slick-headerrow-columns-right' />").appendTo($headerRowScrollerR),$headerRow=$().add($headerRowL).add($headerRowR),$topPanelScrollerL=$("<div class='slick-top-panel-scroller ui-state-default' />").appendTo($paneTopL),$topPanelScrollerR=$("<div class='slick-top-panel-scroller ui-state-default' />").appendTo($paneTopR),$topPanelScroller=$().add($topPanelScrollerL).add($topPanelScrollerR),$topPanelL=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScrollerL),$topPanelR=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScrollerR),$topPanel=$().add($topPanelL).add($topPanelR),options.showColumnHeader||$headerScroller.hide(),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),$viewportTopL=$("<div class='slick-viewport slick-viewport-top slick-viewport-left' tabIndex='0' hideFocus />").appendTo($paneTopL),$viewportTopR=$("<div class='slick-viewport slick-viewport-top slick-viewport-right' tabIndex='0' hideFocus />").appendTo($paneTopR),$viewportBottomL=$("<div class='slick-viewport slick-viewport-bottom slick-viewport-left' tabIndex='0' hideFocus />").appendTo($paneBottomL),$viewportBottomR=$("<div class='slick-viewport slick-viewport-bottom slick-viewport-right' tabIndex='0' hideFocus />").appendTo($paneBottomR),$viewport=$().add($viewportTopL).add($viewportTopR).add($viewportBottomL).add($viewportBottomR),$activeViewportNode=$viewportTopL,$canvasTopL=$("<div class='grid-canvas grid-canvas-top grid-canvas-left' tabIndex='0' hideFocus />").appendTo($viewportTopL),$canvasTopR=$("<div class='grid-canvas grid-canvas-top grid-canvas-right' tabIndex='0' hideFocus />").appendTo($viewportTopR),$canvasBottomL=$("<div class='grid-canvas grid-canvas-bottom grid-canvas-left' tabIndex='0' hideFocus />").appendTo($viewportBottomL),$canvasBottomR=$("<div class='grid-canvas grid-canvas-bottom grid-canvas-right' tabIndex='0' hideFocus />").appendTo($viewportBottomR),options.viewportClass&&$viewport.toggleClass(options.viewportClass,!0),$canvas=$().add($canvasTopL).add($canvasTopR).add($canvasBottomL).add($canvasBottomR),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),$activeCanvasNode=$canvasTopL,$preHeaderPanelSpacer&&$preHeaderPanelSpacer.css("width",getCanvasWidth()+scrollbarDimensions.width+"px"),$headers.width(getHeadersWidth()),$headerRowSpacerL.css("width",getCanvasWidth()+scrollbarDimensions.width+"px"),$headerRowSpacerR.css("width",getCanvasWidth()+scrollbarDimensions.width+"px"),options.createFooterRow&&($footerRowScrollerR=$("<div class='slick-footerrow ui-state-default' />").appendTo($paneTopR),$footerRowScrollerL=$("<div class='slick-footerrow ui-state-default' />").appendTo($paneTopL),$footerRowScroller=$().add($footerRowScrollerL).add($footerRowScrollerR),$footerRowSpacerL=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($footerRowScrollerL),$footerRowSpacerR=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($footerRowScrollerR),$footerRowL=$("<div class='slick-footerrow-columns slick-footerrow-columns-left' />").appendTo($footerRowScrollerL),$footerRowR=$("<div class='slick-footerrow-columns slick-footerrow-columns-right' />").appendTo($footerRowScrollerR),$footerRow=$().add($footerRowL).add($footerRowR),options.showFooterRow||$footerRowScroller.hide()),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,getViewportWidth(),getViewportHeight(),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.on("selectstart.ui",function(i){return $(i.target).is("input,textarea")}),setFrozenOptions(),setPaneVisibility(),setScroller(),setOverflow(),updateColumnCaches(),createColumnHeaders(),createColumnGroupHeaders(),createColumnFooter(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.on("resize.slickgrid",resizeCanvas),$viewport.on("scroll",handleScroll),jQuery.fn.mousewheel&&options.enableMouseWheelScrollHandler&&$viewport.on("mousewheel",handleMouseWheel),$headerScroller.on("contextmenu",handleHeaderContextMenu).on("click",handleHeaderClick).on("mouseenter",".slick-header-column",handleHeaderMouseEnter).on("mouseleave",".slick-header-column",handleHeaderMouseLeave),$headerRowScroller.on("scroll",handleHeaderRowScroll),options.createFooterRow&&($footerRow.on("contextmenu",handleFooterContextMenu).on("click",handleFooterClick),$footerRowScroller.on("scroll",handleFooterRowScroll)),options.createPreHeaderPanel&&$preHeaderPanelScroller.on("scroll",handlePreHeaderPanelScroll),$focusSink.add($focusSink2).on("keydown",handleKeyDown),$canvas.on("keydown",handleKeyDown).on("click",handleClick).on("dblclick",handleDblClick).on("contextmenu",handleContextMenu).on("draginit",handleDragInit).on("dragstart",{distance:3},handleDragStart).on("drag",handleDrag).on("dragend",handleDragEnd).on("mouseenter",".slick-cell",handleMouseEnter).on("mouseleave",".slick-cell",handleMouseLeave),options.suppressCssChangesOnHiddenInit||restoreCssFromHiddenInit())}function cacheCssForHiddenInit(){$hiddenParents=$container.parents().addBack().not(":visible"),$hiddenParents.each(function(){var i={};for(var e in cssShow)i[e]=this.style[e],this.style[e]=cssShow[e];oldProps.push(i)})}function restoreCssFromHiddenInit(){$hiddenParents.each(function(i){var e=oldProps[i];for(var s in cssShow)this.style[s]=e[s]})}function hasFrozenColumns(){return options.frozenColumn>-1}function registerPlugin(i){plugins.unshift(i),i.init(self)}function unregisterPlugin(i){for(var e=plugins.length;e>=0;e--)if(plugins[e]===i){plugins[e].destroy&&plugins[e].destroy(),plugins.splice(e,1);break}}function getPluginByName(i){for(var e=plugins.length-1;e>=0;e--)if(plugins[e].pluginName===i)return plugins[e]}function setSelectionModel(i){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),selectionModel=i,selectionModel&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(i,e){return _getContainerElement(getCanvases(),i,e)}function getActiveCanvasNode(i){return setActiveCanvasNode(i),$activeCanvasNode[0]}function getCanvases(){return $canvas}function setActiveCanvasNode(i){i&&($activeCanvasNode=$(i.target).closest(".grid-canvas"))}function getViewportNode(i,e){return _getContainerElement(getViewports(),i,e)}function getViewports(){return $viewport}function getActiveViewportNode(i){return setActiveViewportNode(i),$activeViewportNode[0]}function setActiveViewportNode(i){i&&($activeViewportNode=$(i.target).closest(".slick-viewport"))}function _getContainerElement(i,e,s){if(i){e||(e=0),s||(s=0);var o=typeof e=="number"?e:getColumnIndex(e),a=hasFrozenRows&&s>=actualFrozenRow+(options.frozenBottom?0:1),d=hasFrozenColumns()&&o>options.frozenColumn;return i[(a?2:0)+(d?1:0)]}}function measureScrollbar(){var i=$('<div class="'+$viewport.className+'" style="position:absolute; top:-10000px; left:-10000px; overflow:auto; width:100px; height:100px;"></div>').appendTo("body"),e=$('<div style="width:200px; height:200px; overflow:auto;"></div>').appendTo(i),s={width:i[0].offsetWidth-i[0].clientWidth,height:i[0].offsetHeight-i[0].clientHeight};return e.remove(),i.remove(),s}function getHeadersWidth(){headersWidth=headersWidthL=headersWidthR=0;for(var i=!options.autoHeight,e=0,s=columns.length;e<s;e++){var o=columns[e].width;options.frozenColumn>-1&&e>options.frozenColumn?headersWidthR+=o:headersWidthL+=o}return i&&(options.frozenColumn>-1&&e>options.frozenColumn?headersWidthR+=scrollbarDimensions.width:headersWidthL+=scrollbarDimensions.width),hasFrozenColumns()?(headersWidthL=headersWidthL+1e3,headersWidthR=Math.max(headersWidthR,viewportW)+headersWidthL,headersWidthR+=scrollbarDimensions.width):(headersWidthL+=scrollbarDimensions.width,headersWidthL=Math.max(headersWidthL,viewportW)+1e3),headersWidth=headersWidthL+headersWidthR,Math.max(headersWidth,viewportW)+1e3}function getHeadersWidthL(){return headersWidthL=0,columns.forEach(function(i,e){options.frozenColumn>-1&&e>options.frozenColumn||(headersWidthL+=i.width)}),hasFrozenColumns()?headersWidthL+=1e3:(headersWidthL+=scrollbarDimensions.width,headersWidthL=Math.max(headersWidthL,viewportW)+1e3),headersWidthL}function getHeadersWidthR(){return headersWidthR=0,columns.forEach(function(i,e){options.frozenColumn>-1&&e>options.frozenColumn&&(headersWidthR+=i.width)}),hasFrozenColumns()&&(headersWidthR=Math.max(headersWidthR,viewportW)+getHeadersWidthL(),headersWidthR+=scrollbarDimensions.width),headersWidthR}function getCanvasWidth(){var i=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,e=columns.length;for(canvasWidthL=canvasWidthR=0;e--;)hasFrozenColumns()&&e>options.frozenColumn?canvasWidthR+=columns[e].width:canvasWidthL+=columns[e].width;var s=canvasWidthL+canvasWidthR;return options.fullWidthRows?Math.max(s,i):s}function updateCanvasWidth(i){var e=canvasWidth,s=canvasWidthL,o=canvasWidthR,a;canvasWidth=getCanvasWidth(),a=canvasWidth!==e||canvasWidthL!==s||canvasWidthR!==o,(a||hasFrozenColumns()||hasFrozenRows)&&($canvasTopL.width(canvasWidthL),getHeadersWidth(),$headerL.width(headersWidthL),$headerR.width(headersWidthR),hasFrozenColumns()?($canvasTopR.width(canvasWidthR),$paneHeaderL.width(canvasWidthL),$paneHeaderR.css("left",canvasWidthL),$paneHeaderR.css("width",viewportW-canvasWidthL),$paneTopL.width(canvasWidthL),$paneTopR.css("left",canvasWidthL),$paneTopR.css("width",viewportW-canvasWidthL),$headerRowScrollerL.width(canvasWidthL),$headerRowScrollerR.width(viewportW-canvasWidthL),$headerRowL.width(canvasWidthL),$headerRowR.width(canvasWidthR),options.createFooterRow&&($footerRowScrollerL.width(canvasWidthL),$footerRowScrollerR.width(viewportW-canvasWidthL),$footerRowL.width(canvasWidthL),$footerRowR.width(canvasWidthR)),options.createPreHeaderPanel&&$preHeaderPanel.width(canvasWidth),$viewportTopL.width(canvasWidthL),$viewportTopR.width(viewportW-canvasWidthL),hasFrozenRows&&($paneBottomL.width(canvasWidthL),$paneBottomR.css("left",canvasWidthL),$viewportBottomL.width(canvasWidthL),$viewportBottomR.width(viewportW-canvasWidthL),$canvasBottomL.width(canvasWidthL),$canvasBottomR.width(canvasWidthR))):($paneHeaderL.width("100%"),$paneTopL.width("100%"),$headerRowScrollerL.width("100%"),$headerRowL.width(canvasWidth),options.createFooterRow&&($footerRowScrollerL.width("100%"),$footerRowL.width(canvasWidth)),options.createPreHeaderPanel&&($preHeaderPanel.width("100%"),$preHeaderPanel.width(canvasWidth)),$viewportTopL.width("100%"),hasFrozenRows&&($viewportBottomL.width("100%"),$canvasBottomL.width(canvasWidthL))),viewportHasHScroll=canvasWidth>=viewportW-scrollbarDimensions.width),$headerRowSpacerL.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),$headerRowSpacerR.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),options.createFooterRow&&($footerRowSpacerL.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),$footerRowSpacerR.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0))),(a||i)&&applyColumnWidths()}function disableSelection(i){i&&i.jquery&&i.attr("unselectable","on").css("MozUserSelect","none").on("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var i=1e6,e=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,s=$("<div style='display:none' />").appendTo(__doc__.body);;){var o=i*2;if(s.css("height",o),o>e||s.height()!==o)break;i=o}return s.remove(),i}function getUID(){return uid}function getHeaderColumnWidthDiff(){return headerColumnWidthDiff}function getScrollbarDimensions(){return scrollbarDimensions}function bindAncestorScrollEvents(){for(var i=hasFrozenRows&&!options.frozenBottom?$canvasBottomL[0]:$canvasTopL[0];(i=i.parentNode)!=__doc__.body&&i!=null;)if(i==$viewportTopL[0]||i.scrollWidth!=i.clientWidth||i.scrollHeight!=i.clientHeight){var e=$(i);$boundAncestors?$boundAncestors=$boundAncestors.add(e):$boundAncestors=e,e.on("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.off("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(i,e,s){if(initialized){var o=getColumnIndex(i);if(o!=null){var a=columns[o],d=$headers.children().eq(o);d&&(e!==void 0&&(columns[o].name=e),s!==void 0&&(columns[o].toolTip=s),trigger(self.onBeforeHeaderCellDestroy,{node:d[0],column:a,grid:self}),d.attr("title",s||"").children().eq(0).html(e),trigger(self.onHeaderCellRendered,{node:d[0],column:a,grid:self}))}}}function getHeader(i){if(!i)return hasFrozenColumns()?$headers:$headerL;var e=getColumnIndex(i.id);return hasFrozenColumns()?e<=options.frozenColumn?$headerL:$headerR:$headerL}function getHeaderColumn(i){var e=typeof i=="number"?i:getColumnIndex(i),s=hasFrozenColumns()?e<=options.frozenColumn?$headerL:$headerR:$headerL,o=hasFrozenColumns()?e<=options.frozenColumn?e:e-options.frozenColumn-1:e,a=s.children().eq(o);return a&&a[0]}function getHeaderRow(){return hasFrozenColumns()?$headerRow:$headerRow[0]}function getFooterRow(){return hasFrozenColumns()?$footerRow:$footerRow[0]}function getPreHeaderPanel(){return $preHeaderPanel[0]}function getPreHeaderPanelRight(){return $preHeaderPanelR[0]}function getHeaderRowColumn(i){var e=typeof i=="number"?i:getColumnIndex(i),s;hasFrozenColumns()?e<=options.frozenColumn?s=$headerRowL:(s=$headerRowR,e-=options.frozenColumn+1):s=$headerRowL;var o=s.children().eq(e);return o&&o[0]}function getFooterRowColumn(i){var e=typeof i=="number"?i:getColumnIndex(i),s;hasFrozenColumns()?e<=options.frozenColumn?s=$footerRowL:(s=$footerRowR,e-=options.frozenColumn+1):s=$footerRowL;var o=s&&s.children().eq(e);return o&&o[0]}function createColumnFooter(){if(options.createFooterRow){$footerRow.find(".slick-footerrow-column").each(function(){var o=$(this).data("column");o&&trigger(self.onBeforeFooterRowCellDestroy,{node:this,column:o,grid:self})}),$footerRowL.empty(),$footerRowR.empty();for(var i=0;i<columns.length;i++){var e=columns[i],s=$("<div class='ui-state-default slick-footerrow-column l"+i+" r"+i+"'></div>").data("column",e).addClass(hasFrozenColumns()&&i<=options.frozenColumn?"frozen":"").appendTo(hasFrozenColumns()&&i>options.frozenColumn?$footerRowR:$footerRowL);trigger(self.onFooterRowCellRendered,{node:s[0],column:e,grid:self})}}}function createColumnGroupHeaders(){var i=0,e=!1;if(treeColumns.hasDepth()){for(var s=0;s<$groupHeadersL.length;s++){$groupHeadersL[s].empty(),$groupHeadersR[s].empty();var o=treeColumns.getColumnsInDepth(s);for(var a in o){var d=o[a];i+=d.extractColumns().length,hasFrozenColumns()&&s===0&&i-1===options.frozenColumn&&(e=!0),$("<div class='ui-state-default slick-group-header-column' />").html("<span class='slick-column-name'>"+d.name+"</span>").attr("id",""+uid+d.id).attr("title",d.toolTip||"").data("column",d).addClass(d.headerCssClass||"").addClass(hasFrozenColumns()&&i-1>options.frozenColumn?"frozen":"").appendTo(hasFrozenColumns()&&i-1>options.frozenColumn?$groupHeadersR[s]:$groupHeadersL[s])}if(hasFrozenColumns()&&s===0&&!e){$groupHeadersL[s].empty(),$groupHeadersR[s].empty(),alert("All columns of group should to be grouped!");break}}applyColumnGroupHeaderWidths()}}function createColumnHeaders(){function i(){$(this).addClass("ui-state-hover")}function e(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var et=$(this).data("column");et&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:et,grid:self})}),$headerL.empty(),$headerR.empty(),getHeadersWidth(),$headerL.width(headersWidthL),$headerR.width(headersWidthR),$headerRow.find(".slick-headerrow-column").each(function(){var et=$(this).data("column");et&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:et,grid:self})}),$headerRowL.empty(),$headerRowR.empty(),options.createFooterRow&&($footerRowL.find(".slick-footerrow-column").each(function(){var et=$(this).data("column");et&&trigger(self.onBeforeFooterRowCellDestroy,{node:this,column:et,grid:self})}),$footerRowL.empty(),hasFrozenColumns()&&($footerRowR.find(".slick-footerrow-column").each(function(){var et=$(this).data("column");et&&trigger(self.onBeforeFooterRowCellDestroy,{node:this,column:et,grid:self})}),$footerRowR.empty()));for(var s=0;s<columns.length;s++){var o=columns[s],a=hasFrozenColumns()?s<=options.frozenColumn?$headerL:$headerR:$headerL,d=hasFrozenColumns()?s<=options.frozenColumn?$headerRowL:$headerRowR:$headerRowL,g=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+o.name+"</span>").width(o.width-headerColumnWidthDiff).attr("id",""+uid+o.id).attr("title",o.toolTip||"").data("column",o).data("__doc__",__doc__).addClass(o.headerCssClass||"").addClass(hasFrozenColumns()&&s<=options.frozenColumn?"frozen":"").appendTo(a);if((options.enableColumnReorder||o.sortable)&&g.on("mouseenter",i).on("mouseleave",e),g.on("dragstart",(et,tt)=>{tt.target.style.zIndex=1,tt.target.style.opacity=.6}).on("drag",(et,tt)=>{tt.target.style.left=1e3+(tt.offsetX-tt.originalX)+"px"}).on("dragend",(et,tt)=>{if(Math.abs(tt.deltaX)<5){tt.target.style.opacity=1,tt.target.style.zIndex="";return}const rt=$(tt.target).data("column");let it=0;const ot=[];let ct=0;for(let pt of columns)ot.push(ct),pt===rt&&(it=ct),ct+=pt.width;ot.push(ct+1e3);const ft=[];let dt=it+tt.deltaX;dt<0&&ft.push(rt);for(let pt=0;pt<columns.length;pt++)columns[pt]!==rt&&ft.push(columns[pt]),dt>ot[pt]&&dt<ot[pt+1]&&(ft.push(rt),dt=-1e3);columns=ft,setColumns(columns)}),o.hasOwnProperty("headerCellAttrs")&&o.headerCellAttrs instanceof Object)for(var _ in o.headerCellAttrs)o.headerCellAttrs.hasOwnProperty(_)&&g.attr(_,o.headerCellAttrs[_]);if(o.sortable&&(g.addClass("slick-header-sortable"),g.append("<span class='slick-sort-indicator"+(options.numberedMultiColumnSort&&!options.sortColNumberInSeparateSpan?" slick-sort-indicator-numbered":"")+"' />"),options.numberedMultiColumnSort&&options.sortColNumberInSeparateSpan&&g.append("<span class='slick-sort-indicator-numbered' />")),trigger(self.onHeaderCellRendered,{node:g[0],column:o,grid:self}),options.showHeaderRow){var j=$("<div class='ui-state-default slick-headerrow-column l"+s+" r"+s+"'></div>").data("column",o).addClass(hasFrozenColumns()&&s<=options.frozenColumn?"frozen":"").appendTo(d);trigger(self.onHeaderRowCellRendered,{node:j[0],column:o,grid:self})}if(options.createFooterRow&&options.showFooterRow){var _e=$("<div class='ui-state-default slick-footerrow-column l"+s+" r"+s+"'></div>").data("column",o).appendTo($footerRow);trigger(self.onFooterRowCellRendered,{node:_e[0],column:o,grid:self})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&(typeof options.enableColumnReorder=="function"?options.enableColumnReorder(self,$headers,headerColumnWidthDiff,setColumns,setupColumnResize,columns,getColumnIndex,uid,trigger):setupColumnReorder())}function setupColumnSort(){$headers.click(function(i){if(!columnResizeDragging&&(i.metaKey=i.metaKey||i.ctrlKey,!$(i.target).hasClass("slick-resizable-handle"))){var e=$(i.target).closest(".slick-header-column");if(e.length){var s=e.data("column");if(s.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var o=null,a=0;a<sortColumns.length;a++)if(sortColumns[a].columnId==s.id){o=sortColumns[a],o.sortAsc=!o.sortAsc;break}var d=!!o;options.tristateMultiColumnSort?(o||(o={columnId:s.id,sortAsc:s.defaultSortAsc}),d&&o.sortAsc&&(sortColumns.splice(a,1),o=null),options.multiColumnSort||(sortColumns=[]),o&&(!d||!options.multiColumnSort)&&sortColumns.push(o)):i.metaKey&&options.multiColumnSort?o&&sortColumns.splice(a,1):((!i.shiftKey&&!i.metaKey||!options.multiColumnSort)&&(sortColumns=[]),o?sortColumns.length===0&&sortColumns.push(o):(o={columnId:s.id,sortAsc:s.defaultSortAsc},sortColumns.push(o))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(g){return{columnId:columns[getColumnIndex(g.columnId)].id,sortCol:columns[getColumnIndex(g.columnId)],sortAsc:g.sortAsc}})},i):trigger(self.onSort,{multiColumnSort:!1,columnId:sortColumns.length>0?s.id:null,sortCol:sortColumns.length>0?s:null,sortAsc:sortColumns.length>0?sortColumns[0].sortAsc:!0},i)}}}})}function currentPositionInHeader(i){var e=0;return $headers.find(".slick-header-column").each(function(s){if(this.id==i)return e=s,!1}),e}function limitPositionInGroup(i){var e,s=0,o=0;return treeColumns.getColumnsInDepth($groupHeadersL.length-1).some(function(a){return s=o,o+=a.columns.length,a.columns.some(function(d){return d.id===i&&(e=a),e}),e}),o--,{start:s,end:o,group:e}}function columnPositionValidInGroup(i){var e=currentPositionInHeader(i[0].id),s=limitPositionInGroup(i.data("column").id),o=s.start<=e&&e<=s.end;return{limit:s,valid:o,message:o?"":'Column "'.concat(i.text(),'" can be reordered only within the "',s.group.name,'" group!')}}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy");var i=null;function e(){$viewportScrollContainerX[0].scrollLeft=$viewportScrollContainerX[0].scrollLeft+10}function s(){$viewportScrollContainerX[0].scrollLeft=$viewportScrollContainerX[0].scrollLeft-10}var o;$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",start:function(a,d){d.placeholder.width(d.helper.outerWidth()-headerColumnWidthDiff),o=!hasFrozenColumns()||d.placeholder.offset().left+d.placeholder.width()>$viewportScrollContainerX.offset().left,$(d.helper).addClass("slick-header-column-active")},beforeStop:function(a,d){$(d.helper).removeClass("slick-header-column-active")},sort:function(a,d){o&&a.originalEvent.pageX>$container[0].clientWidth?i||(i=setInterval(e,100)):o&&a.originalEvent.pageX<$viewportScrollContainerX.offset().left?i||(i=setInterval(s,100)):(clearInterval(i),i=null)},stop:function(a,d){var g=!1;clearInterval(i),i=null;var _=null;if(treeColumns.hasDepth()){var j=columnPositionValidInGroup(d.item);_=j.limit,g=!j.valid,g&&alert(j.message)}if(g||!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var _e=$headerL.sortable("toArray");_e=_e.concat($headerR.sortable("toArray"));for(var et=[],tt=0;tt<_e.length;tt++)et.push(columns[getColumnIndex(_e[tt].replace(uid,""))]);setColumns(et),trigger(self.onColumnsReordered,{impactedColumns:getImpactedColumns(_)}),a.stopPropagation(),setupColumnResize()}})}function getImpactedColumns(i){var e=[];if(i)for(var s=i.start;s<=i.end;s++)e.push(columns[s]);else e=columns;return e}function setupColumnResize(){var i,e,s,o,a,d,g,_,j,_e=0;a=$headers.children(),a.find(".slick-resizable-handle").remove(),a.each(function(et,tt){et>=columns.length||columns[et].resizable&&(_===void 0&&(_=et),j=et)}),_!==void 0&&a.each(function(et,tt){et>=columns.length||et<_||options.forceFitColumns&&et>=j||($(tt),$("<div class='slick-resizable-handle' />").data("__doc__",__doc__).appendTo(tt).on("dragstart",function(rt,it){if(!getEditorLock().commitCurrentEdit())return!1;o=rt.pageX,_e=0,$(this).parent().addClass("slick-header-column-active");var ot=null,ct=null;if(a.each(function(pt,gt){pt>=columns.length||(columns[pt].previousWidth=$(gt).outerWidth())}),options.forceFitColumns)for(ot=0,ct=0,i=et+1;i<columns.length;i++)s=columns[i],s.resizable&&(ct!==null&&(s.maxWidth?ct+=s.maxWidth-s.previousWidth:ct=null),ot+=s.previousWidth-Math.max(s.minWidth||0,absoluteColumnMinWidth));var ft=0,dt=0;for(i=0;i<=et;i++)s=columns[i],s.resizable&&(dt!==null&&(s.maxWidth?dt+=s.maxWidth-s.previousWidth:dt=null),ft+=s.previousWidth-Math.max(s.minWidth||0,absoluteColumnMinWidth));ot===null&&(ot=1e5),ft===null&&(ft=1e5),ct===null&&(ct=1e5),dt===null&&(dt=1e5),g=o+Math.min(ot,dt),d=o-Math.min(ft,ct)}).on("drag",function(rt,it){columnResizeDragging=!0;var ot,ct=Math.min(g,Math.max(d,rt.pageX))-o,ft,dt=0,pt=0,gt=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;if(ct<0){for(ft=ct,i=et;i>=0;i--)s=columns[i],s.resizable&&(ot=Math.max(s.minWidth||0,absoluteColumnMinWidth),ft&&s.previousWidth+ft<ot?(ft+=s.previousWidth-ot,s.width=ot):(s.width=s.previousWidth+ft,ft=0));for(e=0;e<=et;e++)s=columns[e],hasFrozenColumns()&&e>options.frozenColumn?pt+=s.width:dt+=s.width;if(options.forceFitColumns)for(ft=-ct,i=et+1;i<columns.length;i++)s=columns[i],s.resizable&&(ft&&s.maxWidth&&s.maxWidth-s.previousWidth<ft?(ft-=s.maxWidth-s.previousWidth,s.width=s.maxWidth):(s.width=s.previousWidth+ft,ft=0),hasFrozenColumns()&&i>options.frozenColumn?pt+=s.width:dt+=s.width);else for(i=et+1;i<columns.length;i++)s=columns[i],hasFrozenColumns()&&i>options.frozenColumn?pt+=s.width:dt+=s.width;if(options.forceFitColumns)for(ft=-ct,i=et+1;i<columns.length;i++)s=columns[i],s.resizable&&(ft&&s.maxWidth&&s.maxWidth-s.previousWidth<ft?(ft-=s.maxWidth-s.previousWidth,s.width=s.maxWidth):(s.width=s.previousWidth+ft,ft=0))}else{for(ft=ct,dt=0,pt=0,i=et;i>=0;i--)if(s=columns[i],s.resizable)if(ft&&s.maxWidth&&s.maxWidth-s.previousWidth<ft)ft-=s.maxWidth-s.previousWidth,s.width=s.maxWidth;else{var Ct=s.previousWidth+ft,xt=canvasWidthL+ft;hasFrozenColumns()&&i<=options.frozenColumn?(Ct>_e&&xt<gt-options.frozenRightViewportMinWidth&&(_e=Ct),s.width=xt+options.frozenRightViewportMinWidth>gt?_e:Ct):s.width=Ct,ft=0}for(e=0;e<=et;e++)s=columns[e],hasFrozenColumns()&&e>options.frozenColumn?pt+=s.width:dt+=s.width;if(options.forceFitColumns)for(ft=-ct,i=et+1;i<columns.length;i++)s=columns[i],s.resizable&&(ot=Math.max(s.minWidth||0,absoluteColumnMinWidth),ft&&s.previousWidth+ft<ot?(ft+=s.previousWidth-ot,s.width=ot):(s.width=s.previousWidth+ft,ft=0),hasFrozenColumns()&&i>options.frozenColumn?pt+=s.width:dt+=s.width);else for(i=et+1;i<columns.length;i++)s=columns[i],hasFrozenColumns()&&i>options.frozenColumn?pt+=s.width:dt+=s.width}hasFrozenColumns()&&dt!=canvasWidthL&&($headerL.width(dt+1e3),$paneHeaderR.css("left",dt)),applyColumnHeaderWidths(),applyColumnGroupHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths(),trigger(self.onColumnsDrag,{triggeredByColumn:$(this).parent().attr("id").replace(uid,""),resizeHandle:$(this)})}).on("dragend",function(rt,it){$(this).parent().removeClass("slick-header-column-active");var ot=$(this).parent().attr("id").replace(uid,"");trigger(self.onBeforeColumnsResize,{triggeredByColumn:ot})===!0&&(applyColumnHeaderWidths(),applyColumnGroupHeaderWidths());var ct;for(i=0;i<columns.length;i++)s=columns[i],ct=$(a[i]).outerWidth(),s.previousWidth!==ct&&s.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{triggeredByColumn:ot}),setTimeout(function(){columnResizeDragging=!1},300)}).on("dblclick",function(){var rt=$(this).parent().attr("id").replace(uid,"");trigger(self.onColumnsResizeDblClick,{triggeredByColumn:rt})}))})}function getVBoxDelta(i){var e=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],s=0;return i&&typeof i.css=="function"&&$.each(e,function(o,a){s+=parseFloat(i.css(a))||0}),s}function setFrozenOptions(){options.frozenColumn=options.frozenColumn>=0&&options.frozenColumn<columns.length?parseInt(options.frozenColumn):-1,options.frozenRow>-1?(hasFrozenRows=!0,frozenRowsHeight=options.frozenRow*options.rowHeight,getDataLength(),actualFrozenRow=options.frozenBottom?dataLength-options.frozenRow:options.frozenRow):hasFrozenRows=!1}function setPaneVisibility(){hasFrozenColumns()?($paneHeaderR.show(),$paneTopR.show(),hasFrozenRows?($paneBottomL.show(),$paneBottomR.show()):($paneBottomR.hide(),$paneBottomL.hide())):($paneHeaderR.hide(),$paneTopR.hide(),$paneBottomR.hide(),hasFrozenRows?$paneBottomL.show():($paneBottomR.hide(),$paneBottomL.hide()))}function setOverflow(){$viewportTopL.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"scroll":hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"auto","overflow-y":!hasFrozenColumns()&&options.alwaysShowVerticalScroll?"scroll":hasFrozenColumns()?"hidden":hasFrozenRows?"scroll":"auto"}),$viewportTopR.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"scroll":hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"auto","overflow-y":options.alwaysShowVerticalScroll?"scroll":(hasFrozenColumns(),hasFrozenRows?"scroll":"auto")}),$viewportBottomL.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"scroll":"auto":(hasFrozenRows&&!options.alwaysAllowHorizontalScroll,"auto"),"overflow-y":!hasFrozenColumns()&&options.alwaysShowVerticalScroll?"scroll":hasFrozenColumns()?"hidden":hasFrozenRows?"scroll":"auto"}),$viewportBottomR.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"scroll":"auto":(hasFrozenRows&&!options.alwaysAllowHorizontalScroll,"auto"),"overflow-y":options.alwaysShowVerticalScroll?"scroll":(hasFrozenColumns(),"auto")}),options.viewportClass&&($viewportTopL.toggleClass(options.viewportClass,!0),$viewportTopR.toggleClass(options.viewportClass,!0),$viewportBottomL.toggleClass(options.viewportClass,!0),$viewportBottomR.toggleClass(options.viewportClass,!0))}function setScroller(){hasFrozenColumns()?($headerScrollContainer=$headerScrollerR,$headerRowScrollContainer=$headerRowScrollerR,$footerRowScrollContainer=$footerRowScrollerR,hasFrozenRows?options.frozenBottom?($viewportScrollContainerX=$viewportBottomR,$viewportScrollContainerY=$viewportTopR):$viewportScrollContainerX=$viewportScrollContainerY=$viewportBottomR:$viewportScrollContainerX=$viewportScrollContainerY=$viewportTopR):($headerScrollContainer=$headerScrollerL,$headerRowScrollContainer=$headerRowScrollerL,$footerRowScrollContainer=$footerRowScrollerL,hasFrozenRows?options.frozenBottom?($viewportScrollContainerX=$viewportBottomL,$viewportScrollContainerY=$viewportTopL):$viewportScrollContainerX=$viewportScrollContainerY=$viewportBottomL:$viewportScrollContainerX=$viewportScrollContainerY=$viewportTopL)}function measureCellPaddingAndBorder(){var i,e=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],s=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],o=$.fn.jquery.split(".");jQueryNewWidthBehaviour=o[0]==1&&o[1]>=8||o[0]>=2,i=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,i.css("box-sizing")!="border-box"&&i.css("-moz-box-sizing")!="border-box"&&i.css("-webkit-box-sizing")!="border-box"&&($.each(e,function(d,g){headerColumnWidthDiff+=parseFloat(i.css(g))||0}),$.each(s,function(d,g){headerColumnHeightDiff+=parseFloat(i.css(g))||0})),i.remove();var a=$("<div class='slick-row' />").appendTo($canvas);i=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(a),cellWidthDiff=cellHeightDiff=0,i.css("box-sizing")!="border-box"&&i.css("-moz-box-sizing")!="border-box"&&i.css("-webkit-box-sizing")!="border-box"&&($.each(e,function(d,g){cellWidthDiff+=parseFloat(i.css(g))||0}),$.each(s,function(d,g){cellHeightDiff+=parseFloat(i.css(g))||0})),a.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet'/>").appendTo(__doc__.head);for(var i=options.rowHeight-cellHeightDiff,e=["."+uid+" .slick-group-header-column { left: 1000px; }","."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-preheader-panel { height:"+options.preHeaderPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-footerrow-columns { height:"+options.footerRowHeight+"px; }","."+uid+" .slick-cell { height:"+i+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],s=0;s<columns.length;s++)e.push("."+uid+" .l"+s+" { }"),e.push("."+uid+" .r"+s+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=e.join(" "):$style[0].appendChild(__doc__.createTextNode(e.join(" ")))}function getColumnCssRules(i){var e;if(!stylesheet){var s=__doc__.styleSheets;for(let _=0;_<s.length;_++){if((s[_].ownerNode||s[_].owningElement)==$style[0]){stylesheet=s[_];break}if(s[_].rules[0].selectorText&&s[_].rules[0].selectorText.includes(uid)){stylesheet=s[_];break}}if(!stylesheet)throw new Error("SlickGrid Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];var o=stylesheet.cssRules||stylesheet.rules,a,d;for(e=0;e<o.length;e++){var g=o[e].selectorText;(a=/\.l\d+/.exec(g))?(d=parseInt(a[0].substr(2,a[0].length-2),10),columnCssRulesL[d]=o[e]):(a=/\.r\d+/.exec(g))&&(d=parseInt(a[0].substr(2,a[0].length-2),10),columnCssRulesR[d]=o[e])}}return{left:columnCssRulesL[i],right:columnCssRulesR[i]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(i){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{});for(var e=plugins.length;e--;)unregisterPlugin(plugins[e]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.off(".slickgrid"),removeCssRules(),$canvas.off(),$viewport.off(),$headerScroller.off(),$headerRowScroller.off(),$footerRow&&$footerRow.off(),$footerRowScroller&&$footerRowScroller.off(),$preHeaderPanelScroller&&$preHeaderPanelScroller.off(),$focusSink.off(),$(".slick-resizable-handle").off(),$(".slick-header-column").off(),$container.empty().removeClass(uid),i&&destroyAllElements()}function destroyAllElements(){$activeCanvasNode=null,$activeViewportNode=null,$boundAncestors=null,$canvas=null,$canvasTopL=null,$canvasTopR=null,$canvasBottomL=null,$canvasBottomR=null,$container=null,$focusSink=null,$focusSink2=null,$groupHeadersL=null,$groupHeadersR=null,$headerL=null,$headerR=null,$headers=null,$headerRow=null,$headerRowL=null,$headerRowR=null,$headerRowSpacerL=null,$headerRowSpacerR=null,$headerRowScrollContainer=null,$headerRowScroller=null,$headerRowScrollerL=null,$headerRowScrollerR=null,$headerScrollContainer=null,$headerScroller=null,$headerScrollerL=null,$headerScrollerR=null,$hiddenParents=null,$footerRow=null,$footerRowL=null,$footerRowR=null,$footerRowSpacerL=null,$footerRowSpacerR=null,$footerRowScroller=null,$footerRowScrollerL=null,$footerRowScrollerR=null,$footerRowScrollContainer=null,$preHeaderPanel=null,$preHeaderPanelR=null,$preHeaderPanelScroller=null,$preHeaderPanelScrollerR=null,$preHeaderPanelSpacer=null,$topPanel=null,$topPanelScroller=null,$style=null,$topPanelScrollerL=null,$topPanelScrollerR=null,$topPanelL=null,$topPanelR=null,$paneHeaderL=null,$paneHeaderR=null,$paneTopL=null,$paneTopR=null,$paneBottomL=null,$paneBottomR=null,$viewport=null,$viewportTopL=null,$viewportTopR=null,$viewportBottomL=null,$viewportBottomR=null,$viewportScrollContainerX=null,$viewportScrollContainerY=null}var canvas=null,canvas_context=null;function autosizeColumn(i,e){var s=i;if(typeof i=="number")s=columns[i];else if(typeof i=="string")for(var o=0;o<columns.length;o++)columns[o].Id===i&&(s=columns[o]);var a=$(getCanvasNode(0,0));getColAutosizeWidth(s,a,e)}function autosizeColumns(i,e){if(i=i||options.autosizeColsMode,i===Slick.GridAutosizeColsMode.LegacyForceFit||i===Slick.GridAutosizeColsMode.LegacyOff){legacyAutosizeColumns();return}if(i!==Slick.GridAutosizeColsMode.None){canvas=__doc__.createElement("canvas"),canvas&&canvas.getContext&&(canvas_context=canvas.getContext("2d"));var s=$(getCanvasNode(0,0)),o=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,a,d,g,_,j=0,_e=0,et=0,tt=0,rt=0;for(a=0;a<columns.length;a++)d=columns[a],getColAutosizeWidth(d,s,e),rt+=d.autoSize.autosizeMode===Slick.ColAutosizeMode.Locked?d.width:0,tt+=d.autoSize.autosizeMode===Slick.ColAutosizeMode.Locked?d.width:d.minWidth,j+=d.autoSize.widthPx,_e+=d.autoSize.sizeToRemaining?0:d.autoSize.widthPx,et+=d.autoSize.sizeToRemaining&&d.minWidth||0;var it=j-_e;if(i===Slick.GridAutosizeColsMode.FitViewportToCols){var ot=j+scrollbarDimensions.width;i=Slick.GridAutosizeColsMode.IgnoreViewport,options.viewportMaxWidthPx&&ot>options.viewportMaxWidthPx?(ot=options.viewportMaxWidthPx,i=Slick.GridAutosizeColsMode.FitColsToViewport):options.viewportMinWidthPx&&ot<options.viewportMinWidthPx&&(ot=options.viewportMinWidthPx,i=Slick.GridAutosizeColsMode.FitColsToViewport),$container.width(ot)}if(i===Slick.GridAutosizeColsMode.FitColsToViewport)if(it>0&&_e<o-et)for(a=0;a<columns.length;a++){d=columns[a];var ct=o-_e;d.autoSize.sizeToRemaining?g=ct*d.autoSize.widthPx/it:g=d.autoSize.widthPx,d.rerenderOnResize&&d.width!=g&&(_=!0),d.width=g}else if(options.viewportSwitchToScrollModeWidthPercent&&_e+et>o*options.viewportSwitchToScrollModeWidthPercent/100||tt>o)i=Slick.GridAutosizeColsMode.IgnoreViewport;else{var ft=_e-rt,dt=o-rt-et;for(a=0;a<columns.length;a++)d=columns[a],g=d.width,d.autoSize.autosizeMode!==Slick.ColAutosizeMode.Locked&&(d.autoSize.sizeToRemaining?g=d.minWidth:(g=dt/ft*d.autoSize.widthPx,g<d.minWidth&&(g=d.minWidth),ft-=d.autoSize.widthPx,dt-=g)),d.rerenderOnResize&&d.width!=g&&(_=!0),d.width=g}if(i===Slick.GridAutosizeColsMode.IgnoreViewport)for(a=0;a<columns.length;a++)g=columns[a].autoSize.widthPx,columns[a].rerenderOnResize&&columns[a].width!=g&&(_=!0),columns[a].width=g;reRenderColumns(_)}}function getColAutosizeWidth(i,e,s){var o=i.autoSize;if(o.widthPx=i.width,!(o.autosizeMode===Slick.ColAutosizeMode.Locked||o.autosizeMode===Slick.ColAutosizeMode.Guide)){var a=getDataLength();if(o.autosizeMode===Slick.ColAutosizeMode.ContentIntelligent){var d=o.colDataTypeOf,g;if(a>0){var _=getDataItem(0);_&&(g=_[i.field],d=typeof g,d==="object"&&(g instanceof Date&&(d="date"),typeof moment<"u"&&g instanceof moment&&(d="moment")))}d==="boolean"&&(o.colValueArray=[!0,!1]),d==="number"&&(o.valueFilterMode=Slick.ValueFilterMode.GetGreatestAndSub,o.rowSelectionMode=Slick.RowSelectionMode.AllRows),d==="string"&&(o.valueFilterMode=Slick.ValueFilterMode.GetLongestText,o.rowSelectionMode=Slick.RowSelectionMode.AllRows,o.allowAddlPercent=5),d==="date"&&(o.colValueArray=[new Date(2009,8,30,12,20,20)]),d==="moment"&&typeof moment<"u"&&(o.colValueArray=[moment([2009,8,30,12,20,20])])}var j=getColContentSize(i,e,s),_e=o.allowAddlPercent?1+o.allowAddlPercent/100:1;j=j*_e+options.autosizeColPaddingPx,i.minWidth&&j<i.minWidth&&(j=i.minWidth),i.maxWidth&&j>i.maxWidth&&(j=i.maxWidth),o.widthPx=j}}function getColContentSize(i,e,s){var o=i.autoSize,a=1,d,g,_=0,j=0;if(o.ignoreHeaderText||(j=getColHeaderWidth(i)),o.colValueArray)return _=getColWidth(i,e,o.colValueArray),Math.max(j,_);var _e=getData();_e.getItems&&(_e=_e.getItems());var et=(s?o.rowSelectionModeOnInit:void 0)||o.rowSelectionMode;if(et===Slick.RowSelectionMode.FirstRow&&(_e=_e.slice(0,1)),et===Slick.RowSelectionMode.LastRow&&(_e=_e.slice(_e.length-1,_e.length)),et===Slick.RowSelectionMode.FirstNRows&&(_e=_e.slice(0,o.rowSelectionCount)),o.valueFilterMode===Slick.ValueFilterMode.DeDuplicate){var tt={};for(d=0,g=_e.length;d<g;d++)tt[_e[d][i.field]]=!0;if(Object.keys)_e=Object.keys(tt);else{_e=[];for(var d in tt)_e.push(d)}}if(o.valueFilterMode===Slick.ValueFilterMode.GetGreatestAndSub){var rt,it,ot=0;for(d=0,g=_e.length;d<g;d++)rt=_e[d][i.field],Math.abs(rt)>ot&&(it=rt,ot=Math.abs(rt));it=""+it,it=Array(it.length+1).join("9"),it=+it,_e=[it]}if(o.valueFilterMode===Slick.ValueFilterMode.GetLongestTextAndSub){var rt,ct=0;for(d=0,g=_e.length;d<g;d++)rt=_e[d][i.field],(rt||"").length>ct&&(ct=rt.length);rt=Array(ct+1).join("m"),a=options.autosizeTextAvgToMWidthRatio,_e=[rt]}if(o.valueFilterMode===Slick.ValueFilterMode.GetLongestText){var rt,ct=0,ft=0;for(d=0,g=_e.length;d<g;d++)rt=_e[d][i.field],(rt||"").length>ct&&(ct=rt.length,ft=d);rt=_e[ft][i.field],_e=[rt]}return _=getColWidth(i,e,_e)*a,Math.max(j,_)}function getColWidth(i,e,s){var o=getColumnIndex(i.id),a=$('<div class="slick-row ui-widget-content"></div>'),d=$('<div class="slick-cell"></div>');d.css({position:"absolute",visibility:"hidden","text-overflow":"initial","white-space":"nowrap"}),a.append(d),e.append(a);var g,_=0,j,_e,et,tt;return canvas_context&&i.autoSize.widthEvalMode===Slick.WidthEvalMode.CanvasTextSize?(canvas_context.font=d.css("font-size")+" "+d.css("font-family"),$(s).each(function(rt,it){tt=Array.isArray(it)?it[i.field]:it,j=""+tt,g=j?canvas_context.measureText(j).width:0,g>_&&(_=g,_e=j)}),d.html(_e),g=d.outerWidth(),a.remove(),d=null,g):($(s).each(function(rt,it){tt=Array.isArray(it)?it[i.field]:it,i.formatterOverride?et=i.formatterOverride(rt,o,tt,i,it,self):i.formatter?et=i.formatter(rt,o,tt,i,it,self):et=""+tt,applyFormatResultToCellNode(et,d[0]),g=d.outerWidth(),g>_&&(_=g)}),a.remove(),d=null,_)}function getColHeaderWidth(i){var e=0,s=getUID()+i.id,o=__doc__.getElementById(s),a=s+"_";if(o){var d=o.cloneNode(!0);d.id=a,d.style.cssText="position: absolute; visibility: hidden;right: auto;text-overflow: initial;white-space: nowrap;",o.parentNode.insertBefore(d,o),e=d.offsetWidth,d.parentNode.removeChild(d)}else{var g=getHeader(i);o=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+i.name+"</span>").attr("id",a).css({position:"absolute",visibility:"hidden",right:"auto","text-overflow:":"initial","white-space":"nowrap"}).addClass(i.headerCssClass||"").appendTo(g),e=o[0].offsetWidth,g[0].removeChild(o[0])}return e}function legacyAutosizeColumns(){var i,e,s=[],o=0,a=0,d,g=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++)e=columns[i],s.push(e.width),a+=e.width,e.resizable&&(o+=e.width-Math.max(e.minWidth,absoluteColumnMinWidth));for(d=a;a>g&&o;){var _=(a-g)/o;for(i=0;i<columns.length&&a>g;i++){e=columns[i];var j=s[i];if(!(!e.resizable||j<=e.minWidth||j<=absoluteColumnMinWidth)){var _e=Math.max(e.minWidth,absoluteColumnMinWidth),et=Math.floor(_*(j-_e))||1;et=Math.min(et,j-_e),a-=et,o-=et,s[i]-=et}}if(d<=a)break;d=a}for(d=a;a<g;){var tt=g/a;for(i=0;i<columns.length&&a<g;i++){e=columns[i];var rt=s[i],it;!e.resizable||e.maxWidth<=rt?it=0:it=Math.min(Math.floor(tt*rt)-rt,e.maxWidth-rt||1e6)||1,a+=it,s[i]+=a<=g?it:0}if(d>=a)break;d=a}var ot=!1;for(i=0;i<columns.length;i++)columns[i].rerenderOnResize&&columns[i].width!=s[i]&&(ot=!0),columns[i].width=s[i];reRenderColumns(ot)}function reRenderColumns(i){applyColumnHeaderWidths(),applyColumnGroupHeaderWidths(),updateCanvasWidth(!0),trigger(self.onAutosizeColumns,{columns}),i&&(invalidateAllRows(),render())}function trigger(i,e,s){return s=s||new Slick.EventData,e=e||{},e.grid=self,i.notify(e,s,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(i){return columnsById[i]}function applyColumnGroupHeaderWidths(){if(treeColumns.hasDepth())for(var i=$groupHeadersL.length-1;i>=0;i--)treeColumns.getColumnsInDepth(i),$().add($groupHeadersL[i]).add($groupHeadersR[i]).each(function(e){var s=$(this),o=0;s.width(e===0?getHeadersWidthL():getHeadersWidthR()),s.children().each(function(){var a=$(this),d=$(this).data("column");d.width=0,d.columns.forEach(function(){var g=s.next().children(":eq("+o+++")");d.width+=g.outerWidth()}),a.width(d.width-headerColumnWidthDiff)})})}function applyColumnHeaderWidths(){if(initialized){for(var i,e=0,s=$headers.children(),o=columns.length;e<o;e++)i=$(s[e]),jQueryNewWidthBehaviour?i.outerWidth()!==columns[e].width&&i.outerWidth(columns[e].width):i.width()!==columns[e].width-headerColumnWidthDiff&&i.width(columns[e].width-headerColumnWidthDiff);updateColumnCaches()}}function applyColumnWidths(){for(var i=0,e,s,o=0;o<columns.length;o++)e=columns[o].width,s=getColumnCssRules(o),s.left.style.left=i+"px",s.right.style.right=(options.frozenColumn!=-1&&o>options.frozenColumn?canvasWidthR:canvasWidthL)-i-e+"px",options.frozenColumn==o?i=0:i+=columns[o].width}function setSortColumn(i,e){setSortColumns([{columnId:i,sortAsc:e}])}function setSortColumns(i){sortColumns=i;var e=options.numberedMultiColumnSort&&sortColumns.length>1,s=$headers.children();s.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),s.find(".slick-sort-indicator-numbered").text(""),$.each(sortColumns,function(o,a){a.sortAsc==null&&(a.sortAsc=!0);var d=getColumnIndex(a.columnId);d!=null&&(s.eq(d).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(a.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc"),e&&s.eq(d).find(".slick-sort-indicator-numbered").text(o+1))})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(i,e){var s=selectedRows.slice(0);selectedRows=[];for(var o={},a=0;a<e.length;a++)for(var d=e[a].fromRow;d<=e[a].toRow;d++){o[d]||(selectedRows.push(d),o[d]={});for(var g=e[a].fromCell;g<=e[a].toCell;g++)canCellBeSelected(d,g)&&(o[d][columns[g].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,o),simpleArrayEquals(s,selectedRows)&&trigger(self.onSelectedRowsChanged,{rows:getSelectedRows(),previousSelectedRows:s},i)}function simpleArrayEquals(i,e){return Array.isArray(i)&&Array.isArray(e)&&e.sort().toString()!==i.sort().toString()}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var i=0,e=0,s=columns.length;e<s;e++)columnPosLeft[e]=i,columnPosRight[e]=i+columns[e].width,options.frozenColumn==e?i=0:i+=columns[e].width}function updateColumnProps(){columnsById={};for(var i=0;i<columns.length;i++){columns[i].width&&(columns[i].widthRequest=columns[i].width);var e=columns[i]=$.extend({},columnDefaults,columns[i]);e.autoSize=$.extend({},columnAutosizeDefaults,e.autoSize),columnsById[e.id]=i,e.minWidth&&e.width<e.minWidth&&(e.width=e.minWidth),e.maxWidth&&e.width>e.maxWidth&&(e.width=e.maxWidth),e.resizable}}function setColumns(i){var e=new Slick.TreeColumns(i);e.hasDepth()?(treeColumns=e,columns=treeColumns.extractColumns()):columns=i,updateColumnProps(),updateColumnCaches(),initialized&&(setPaneVisibility(),setOverflow(),invalidateAllRows(),createColumnHeaders(),createColumnGroupHeaders(),createColumnFooter(),removeCssRules(),createCssRules(),resizeCanvas(),updateCanvasWidth(),applyColumnHeaderWidths(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(i,e,s,o){if(getEditorLock().commitCurrentEdit()){makeActiveCellNormal(),i.showColumnHeader!==void 0&&setColumnHeaderVisibility(i.showColumnHeader),options.enableAddRow!==i.enableAddRow&&invalidateRow(getDataLength());var a=$.extend(!0,{},options);if(options=$.extend(options,i),trigger(self.onSetOptions,{optionsBefore:a,optionsAfter:options}),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),e||render(),setFrozenOptions(),setScroller(),o||setOverflow(),zombieRowNodeFromLastMouseWheelEvent=null,s||setColumns(treeColumns.extractColumns()),options.enableMouseWheelScrollHandler&&$viewport&&jQuery.fn.mousewheel){var d=$._data($viewport[0],"events");(!d||!d.mousewheel)&&$viewport.on("mousewheel",handleMouseWheel)}else options.enableMouseWheelScrollHandler===!1&&$viewport.off("mousewheel")}}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1),options.forceFitColumns&&(options.autosizeColsMode=Slick.GridAutosizeColsMode.LegacyForceFit,console.log("forceFitColumns option is deprecated - use autosizeColsMode"))}function setData(i,e){data=i,invalidateAllRows(),updateRowCount(),e&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data&&data.length||0}function getDataLengthIncludingAddNew(){return getDataLength()+(options.enableAddRow&&(!pagingActive||pagingIsLastPage)?1:0)}function getDataItem(i){return data.getItem?data.getItem(i):data[i]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(i,e){var s=e!==!1;options.showTopPanel!=i&&(options.showTopPanel=i,i?s?$topPanelScroller.slideDown("fast",resizeCanvas):($topPanelScroller.show(),resizeCanvas()):s?$topPanelScroller.slideUp("fast",resizeCanvas):($topPanelScroller.hide(),resizeCanvas()))}function setHeaderRowVisibility(i,e){var s=e!==!1;options.showHeaderRow!=i&&(options.showHeaderRow=i,i?s?$headerRowScroller.slideDown("fast",resizeCanvas):($headerRowScroller.show(),resizeCanvas()):s?$headerRowScroller.slideUp("fast",resizeCanvas):($headerRowScroller.hide(),resizeCanvas()))}function setColumnHeaderVisibility(i,e){options.showColumnHeader!=i&&(options.showColumnHeader=i,i?e?$headerScroller.slideDown("fast",resizeCanvas):($headerScroller.show(),resizeCanvas()):e?$headerScroller.slideUp("fast",resizeCanvas):($headerScroller.hide(),resizeCanvas()))}function setFooterRowVisibility(i,e){var s=e!==!1;options.showFooterRow!=i&&(options.showFooterRow=i,i?s?$footerRowScroller.slideDown("fast",resizeCanvas):($footerRowScroller.show(),resizeCanvas()):s?$footerRowScroller.slideUp("fast",resizeCanvas):($footerRowScroller.hide(),resizeCanvas()))}function setPreHeaderPanelVisibility(i,e){var s=e!==!1;options.showPreHeaderPanel!=i&&(options.showPreHeaderPanel=i,i?s?($preHeaderPanelScroller.slideDown("fast",resizeCanvas),$preHeaderPanelScrollerR.slideDown("fast",resizeCanvas)):($preHeaderPanelScroller.show(),$preHeaderPanelScrollerR.show(),resizeCanvas()):s?($preHeaderPanelScroller.slideUp("fast",resizeCanvas),$preHeaderPanelScrollerR.slideUp("fast",resizeCanvas)):($preHeaderPanelScroller.hide(),$preHeaderPanelScrollerR.hide(),resizeCanvas()))}function getContainerNode(){return $container.get(0)}function getRowTop(i){return options.rowHeight*i-offset}function getRowFromPosition(i){return Math.floor((i+offset)/options.rowHeight)}function scrollTo(i){i=Math.max(i,0),i=Math.min(i,th-$viewportScrollContainerY.height()+(viewportHasHScroll||hasFrozenColumns()?scrollbarDimensions.height:0));var e=offset;page=Math.min(n-1,Math.floor(i/ph)),offset=Math.round(page*cj);var s=i-offset;if(offset!=e){var o=getVisibleRange(s);cleanupRows(o),updateRowPositions()}prevScrollTop!=s&&(vScrollDir=prevScrollTop+e<s+offset?1:-1,lastRenderedScrollTop=scrollTop=prevScrollTop=s,hasFrozenColumns()&&($viewportTopL[0].scrollTop=s),hasFrozenRows&&($viewportBottomL[0].scrollTop=$viewportBottomR[0].scrollTop=s),$viewportScrollContainerY[0].scrollTop=s,trigger(self.onViewportChanged,{}))}function defaultFormatter(i,e,s,o,a,d){return s==null?"":(s+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(i,e){var s=data.getItemMetadata&&data.getItemMetadata(i),o=s&&s.columns&&(s.columns[e.id]||s.columns[getColumnIndex(e.id)]);return o&&o.formatter||s&&s.formatter||e.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(e)||options.defaultFormatter}function getEditor(i,e){var s=columns[e],o=data.getItemMetadata&&data.getItemMetadata(i),a=o&&o.columns;return a&&a[s.id]&&a[s.id].editor!==void 0?a[s.id].editor:a&&a[e]&&a[e].editor!==void 0?a[e].editor:s.editor||options.editorFactory&&options.editorFactory.getEditor(s)}function getDataItemValueForColumn(i,e){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(i,e):i[e.field]}function appendRowHtml(i,e,s,o,a){var d=getDataItem(s),g=s<a&&!d,_="slick-row"+(hasFrozenRows&&s<=options.frozenRow?" frozen":"")+(g?" loading":"")+(s===activeRow&&options.showCellSelection?" active":"")+(s%2==1?" odd":" even");d||(_+=" "+options.addNewRowCssClass);var j=data.getItemMetadata&&data.getItemMetadata(s);j&&j.cssClasses&&(_+=" "+j.cssClasses);var _e=getFrozenRowOffset(s),et="<div class='ui-widget-content "+_+"' style='top:"+(getRowTop(s)-_e)+"px'>";i.push(et),hasFrozenColumns()&&e.push(et);for(var tt,rt,it=0,ot=columns.length;it<ot;it++){if(rt=columns[it],tt=1,j&&j.columns){var ct=j.columns[rt.id]||j.columns[it];tt=ct&&ct.colspan||1,tt==="*"&&(tt=ot-it)}if(columnPosRight[Math.min(ot-1,it+tt-1)]>o.leftPx){if(!rt.alwaysRenderColumn&&columnPosLeft[it]>o.rightPx)break;hasFrozenColumns()&&it>options.frozenColumn?appendCellHtml(e,s,it,tt,d):appendCellHtml(i,s,it,tt,d)}else(rt.alwaysRenderColumn||hasFrozenColumns()&&it<=options.frozenColumn)&&appendCellHtml(i,s,it,tt,d);tt>1&&(it+=tt-1)}i.push("</div>"),hasFrozenColumns()&&e.push("</div>")}function appendCellHtml(i,e,s,o,a){var d=columns[s],g="slick-cell l"+s+" r"+Math.min(columns.length-1,s+o-1)+(d.cssClass?" "+d.cssClass:"");hasFrozenColumns()&&s<=options.frozenColumn&&(g+=" frozen"),e===activeRow&&s===activeCell&&options.showCellSelection&&(g+=" active");for(var _ in cellCssClasses)cellCssClasses[_][e]&&cellCssClasses[_][e][d.id]&&(g+=" "+cellCssClasses[_][e][d.id]);var j=null,_e="";a&&(j=getDataItemValueForColumn(a,d),_e=getFormatter(e,d)(e,s,j,d,a,self),_e==null&&(_e=""));var et=trigger(self.onBeforeAppendCell,{row:e,cell:s,value:j,dataContext:a})||"";et+=_e&&_e.addClasses?(et?" ":"")+_e.addClasses:"";var tt=_e&&_e.toolTip?"title='"+_e.toolTip+"'":"",rt="";if(d.hasOwnProperty("cellAttrs")&&d.cellAttrs instanceof Object)for(var _ in d.cellAttrs)d.cellAttrs.hasOwnProperty(_)&&(rt+=" "+_+'="'+d.cellAttrs[_]+'" ');i.push("<div class='"+g+(et?" "+et:"")+"' "+tt+rt+">"),a&&i.push(Object.prototype.toString.call(_e)!=="[object Object]"?_e:_e.text),i.push("</div>"),rowsCache[e].cellRenderQueue.push(s),rowsCache[e].cellColSpans[s]=o}function cleanupRows(i){for(var e in rowsCache){var s=!0;hasFrozenRows&&(options.frozenBottom&&e>=actualFrozenRow||!options.frozenBottom&&e<=actualFrozenRow)&&(s=!1),(e=parseInt(e,10))!==activeRow&&(e<i.top||e>i.bottom)&&s&&removeRowFromCache(e)}options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){currentEditor&&makeActiveCellNormal();for(var i in rowsCache)removeRowFromCache(i);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}function removeRowFromCache(i){var e=rowsCache[i];e&&(rowNodeFromLastMouseWheelEvent==e.rowNode[0]||hasFrozenColumns()&&rowNodeFromLastMouseWheelEvent==e.rowNode[1]?(e.rowNode.hide(),zombieRowNodeFromLastMouseWheelEvent=e.rowNode):e.rowNode.each(function(){this.parentElement.removeChild(this)}),delete rowsCache[i],delete postProcessedRows[i],renderedRows--,counter_rows_removed++)}function invalidateRows(i){var e,s;if(!(!i||!i.length)){for(vScrollDir=0,s=i.length,e=0;e<s;e++)currentEditor&&activeRow===i[e]&&makeActiveCellNormal(),rowsCache[i[e]]&&removeRowFromCache(i[e]);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}}function invalidateRow(i){!i&&i!==0||invalidateRows([i])}function applyFormatResultToCellNode(i,e,s){if(i==null&&(i=""),Object.prototype.toString.call(i)!=="[object Object]"){e.innerHTML=i;return}e.innerHTML=i.text,i.removeClasses&&!s&&$(e).removeClass(i.removeClasses),i.addClasses&&$(e).addClass(i.addClasses),i.toolTip&&$(e).attr("title",i.toolTip)}function updateCell(i,e){var s=getCellNode(i,e);if(s){var o=columns[e],a=getDataItem(i);if(currentEditor&&activeRow===i&&activeCell===e)currentEditor.loadValue(a);else{var d=a?getFormatter(i,o)(i,e,getDataItemValueForColumn(a,o),o,a,self):"";applyFormatResultToCellNode(d,s),invalidatePostProcessingResults(i)}}}function updateRow(i){var e=rowsCache[i];if(e){ensureCellNodesInRowsCache(i);var s,o=getDataItem(i);for(var a in e.cellNodesByColumnIdx)if(e.cellNodesByColumnIdx.hasOwnProperty(a)){a=a|0;var d=columns[a],g=e.cellNodesByColumnIdx[a][0];i===activeRow&&a===activeCell&&currentEditor?currentEditor.loadValue(o):o?(s=getFormatter(i,d)(i,a,getDataItemValueForColumn(o,d),d,o,self),applyFormatResultToCellNode(s,g)):g.innerHTML=""}invalidatePostProcessingResults(i)}}function getViewportHeight(){if((!options.autoHeight||options.frozenColumn!=-1)&&(topPanelH=options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0,headerRowH=options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0,footerRowH=options.showFooterRow?options.footerRowHeight+getVBoxDelta($footerRowScroller):0),options.autoHeight){var i=$paneHeaderL.outerHeight();i+=options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0,i+=options.showFooterRow?options.footerRowHeight+getVBoxDelta($footerRowScroller):0,i+=getCanvasWidth()>viewportW?scrollbarDimensions.height:0,viewportH=options.rowHeight*getDataLengthIncludingAddNew()+(options.frozenColumn==-1?i:0)}else{var e=options.showColumnHeader?parseFloat($.css($headerScroller[0],"height"))+getVBoxDelta($headerScroller):0,s=options.createPreHeaderPanel&&options.showPreHeaderPanel?options.preHeaderPanelHeight+getVBoxDelta($preHeaderPanelScroller):0;viewportH=parseFloat($.css($container[0],"height",!0))-parseFloat($.css($container[0],"paddingTop",!0))-parseFloat($.css($container[0],"paddingBottom",!0))-e-topPanelH-headerRowH-footerRowH-s}return numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportH}function getViewportWidth(){viewportW=parseFloat($container.width())}function resizeCanvas(){if(initialized){paneTopH=0,paneBottomH=0,viewportTopH=0,getViewportWidth(),getViewportHeight(),hasFrozenRows?options.frozenBottom?(paneTopH=viewportH-frozenRowsHeight-scrollbarDimensions.height,paneBottomH=frozenRowsHeight+scrollbarDimensions.height):(paneTopH=frozenRowsHeight,paneBottomH=viewportH-frozenRowsHeight):paneTopH=viewportH,paneTopH+=topPanelH+headerRowH+footerRowH,hasFrozenColumns()&&options.autoHeight&&(paneTopH+=scrollbarDimensions.height),viewportTopH=paneTopH-topPanelH-headerRowH-footerRowH,options.autoHeight&&(hasFrozenColumns()&&$container.height(paneTopH+parseFloat($.css($headerScrollerL[0],"height"))),$paneTopL.css("position","relative")),$paneTopL.css({top:$paneHeaderL.height()||(options.showHeaderRow?options.headerRowHeight:0)+(options.showPreHeaderPanel?options.preHeaderPanelHeight:0),height:paneTopH});var i=$paneTopL.position().top+paneTopH;options.autoHeight||$viewportTopL.height(viewportTopH),hasFrozenColumns()?($paneTopR.css({top:$paneHeaderL.height(),height:paneTopH}),$viewportTopR.height(viewportTopH),hasFrozenRows&&($paneBottomL.css({top:i,height:paneBottomH}),$paneBottomR.css({top:i,height:paneBottomH}),$viewportBottomR.height(paneBottomH))):hasFrozenRows&&($paneBottomL.css({width:"100%",height:paneBottomH}),$paneBottomL.css("top",i)),hasFrozenRows?($viewportBottomL.height(paneBottomH),options.frozenBottom?($canvasBottomL.height(frozenRowsHeight),hasFrozenColumns()&&$canvasBottomR.height(frozenRowsHeight)):($canvasTopL.height(frozenRowsHeight),hasFrozenColumns()&&$canvasTopR.height(frozenRowsHeight))):$viewportTopR.height(viewportTopH),(!scrollbarDimensions||!scrollbarDimensions.width)&&(scrollbarDimensions=measureScrollbar()),options.autosizeColsMode===Slick.GridAutosizeColsMode.LegacyForceFit&&autosizeColumns(),updateRowCount(),handleScroll(),lastRenderedScrollLeft=-1,render()}}function updatePagingStatusFromView(i){pagingActive=i.pageSize!==0,pagingIsLastPage=i.pageNum==i.totalPages-1}function updateRowCount(){if(initialized){var i=getDataLength(),e=getDataLengthIncludingAddNew(),s=0,_=hasFrozenRows&&!options.frozenBottom?$canvasBottomL.height():$canvasTopL.height();if(hasFrozenRows)var s=getDataLength()-options.frozenRow;else var s=e+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var o=$viewportScrollContainerY.height(),a=viewportHasVScroll;viewportHasVScroll=options.alwaysShowVerticalScroll||!options.autoHeight&&s*options.rowHeight>o,makeActiveCellNormal();var d=i-1;for(var g in rowsCache)g>d&&removeRowFromCache(g);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup(),activeCellNode&&activeRow>d&&resetActiveCell();var _=h;options.autoHeight?h=options.rowHeight*s:(th=Math.max(options.rowHeight*s,o-scrollbarDimensions.height),th<maxSupportedCssHeight?(h=ph=th,n=1,cj=0):(h=maxSupportedCssHeight,ph=h/100,n=Math.floor(th/ph),cj=(th-h)/(n-1))),h!==_&&(hasFrozenRows&&!options.frozenBottom?($canvasBottomL.css("height",h),hasFrozenColumns()&&$canvasBottomR.css("height",h)):($canvasTopL.css("height",h),$canvasTopR.css("height",h)),scrollTop=$viewportScrollContainerY[0].scrollTop);var j=scrollTop+offset<=th-o;th==0||scrollTop==0?page=offset=0:scrollTo(j?scrollTop+offset:th-o),h!=_&&options.autoHeight&&resizeCanvas(),options.autosizeColsMode===Slick.GridAutosizeColsMode.LegacyForceFit&&a!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(i,e){return i==null&&(i=scrollTop),e==null&&(e=scrollLeft),{top:getRowFromPosition(i),bottom:getRowFromPosition(i+viewportH)+1,leftPx:e,rightPx:e+viewportW}}function getRenderedRange(i,e){var s=getVisibleRange(i,e),o=Math.round(viewportH/options.rowHeight),a=options.minRowBuffer;return vScrollDir==-1?(s.top-=o,s.bottom+=a):vScrollDir==1?(s.top-=a,s.bottom+=o):(s.top-=a,s.bottom+=a),s.top=Math.max(0,s.top),s.bottom=Math.min(getDataLengthIncludingAddNew()-1,s.bottom),s.leftPx-=viewportW,s.rightPx+=viewportW,s.leftPx=Math.max(0,s.leftPx),s.rightPx=Math.min(canvasWidth,s.rightPx),s}function ensureCellNodesInRowsCache(i){var e=rowsCache[i];if(e&&e.cellRenderQueue.length)for(var s=e.rowNode.children().last();e.cellRenderQueue.length;){var o=e.cellRenderQueue.pop();e.cellNodesByColumnIdx[o]=s,s=s.prev(),s.length===0&&(s=$(e.rowNode[0]).children().last())}}function cleanUpCells(i,e){if(!(hasFrozenRows&&(options.frozenBottom&&e>actualFrozenRow||e<=actualFrozenRow))){var s=rowsCache[e],o=[];for(var a in s.cellNodesByColumnIdx)if(s.cellNodesByColumnIdx.hasOwnProperty(a)&&(a=a|0,!(a<=options.frozenColumn)&&!(Array.isArray(columns)&&columns[a]&&columns[a].alwaysRenderColumn))){var d=s.cellColSpans[a];(columnPosLeft[a]>i.rightPx||columnPosRight[Math.min(columns.length-1,a+d-1)]<i.leftPx)&&(e==activeRow&&a==activeCell||o.push(a))}for(var g;(g=o.pop())!=null;)s.cellNodesByColumnIdx[g][0].parentElement.removeChild(s.cellNodesByColumnIdx[g][0]),delete s.cellColSpans[g],delete s.cellNodesByColumnIdx[g],postProcessedRows[e]&&delete postProcessedRows[e][g]}}function cleanUpAndRenderCells(i){for(var e,s=[],o=[],a,d,g=i.top,_=i.bottom;g<=_;g++)if(e=rowsCache[g],!!e){ensureCellNodesInRowsCache(g),cleanUpCells(i,g),a=0;var j=data.getItemMetadata&&data.getItemMetadata(g);j=j&&j.columns;for(var _e=getDataItem(g),et=0,tt=columns.length;et<tt&&!(columnPosLeft[et]>i.rightPx);et++){if((d=e.cellColSpans[et])!=null){et+=d>1?d-1:0;continue}if(d=1,j){var rt=j[columns[et].id]||j[et];d=rt&&rt.colspan||1,d==="*"&&(d=tt-et)}columnPosRight[Math.min(tt-1,et+d-1)]>i.leftPx&&(appendCellHtml(s,g,et,d,_e),a++),et+=d>1?d-1:0}a&&o.push(g)}if(s.length){var it=__doc__.createElement("div");it.innerHTML=s.join("");for(var ot,ct;(ot=o.pop())!=null;){e=rowsCache[ot];for(var ft;(ft=e.cellRenderQueue.pop())!=null;)ct=it.lastChild,hasFrozenColumns()&&ft>options.frozenColumn?e.rowNode[1].appendChild(ct):e.rowNode[0].appendChild(ct),e.cellNodesByColumnIdx[ft]=$(ct)}}}function renderRows(i){for(var e=[],s=[],o=[],a=!1,d=getDataLength(),g=i.top,_=i.bottom;g<=_;g++)rowsCache[g]||hasFrozenRows&&options.frozenBottom&&g==getDataLength()||(renderedRows++,o.push(g),rowsCache[g]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(e,s,g,i,d),activeCellNode&&activeRow===g&&(a=!0),counter_rows_rendered++);if(o.length){var j=__doc__.createElement("div"),_e=__doc__.createElement("div");j.innerHTML=e.join(""),_e.innerHTML=s.join("");for(var g=0,_=o.length;g<_;g++)hasFrozenRows&&o[g]>=actualFrozenRow?hasFrozenColumns()?rowsCache[o[g]].rowNode=$().add($(j.firstChild).appendTo($canvasBottomL)).add($(_e.firstChild).appendTo($canvasBottomR)):rowsCache[o[g]].rowNode=$().add($(j.firstChild).appendTo($canvasBottomL)):hasFrozenColumns()?rowsCache[o[g]].rowNode=$().add($(j.firstChild).appendTo($canvasTopL)).add($(_e.firstChild).appendTo($canvasTopR)):rowsCache[o[g]].rowNode=$().add($(j.firstChild).appendTo($canvasTopL));a&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function startPostProcessingCleanup(){options.enableAsyncPostRenderCleanup&&(clearTimeout(h_postrenderCleanup),h_postrenderCleanup=setTimeout(asyncPostProcessCleanupRows,options.asyncPostRenderCleanupDelay))}function invalidatePostProcessingResults(i){for(var e in postProcessedRows[i])postProcessedRows[i].hasOwnProperty(e)&&(postProcessedRows[i][e]="C");postProcessFromRow=Math.min(postProcessFromRow,i),postProcessToRow=Math.max(postProcessToRow,i),startPostProcessing()}function updateRowPositions(){for(var i in rowsCache){var e=i?parseInt(i):0;rowsCache[e].rowNode[0].style.top=getRowTop(e)+"px"}}function render(){if(initialized){scrollThrottle.dequeue();var i=getVisibleRange(),e=getRenderedRange();if(cleanupRows(e),lastRenderedScrollLeft!=scrollLeft){if(hasFrozenRows){var s=jQuery.extend(!0,{},e);options.frozenBottom?(s.top=actualFrozenRow,s.bottom=getDataLength()):(s.top=0,s.bottom=options.frozenRow),cleanUpAndRenderCells(s)}cleanUpAndRenderCells(e)}renderRows(e),hasFrozenRows&&(options.frozenBottom?renderRows({top:actualFrozenRow,bottom:getDataLength()-1,leftPx:e.leftPx,rightPx:e.rightPx}):renderRows({top:0,bottom:options.frozenRow-1,leftPx:e.leftPx,rightPx:e.rightPx})),postProcessFromRow=i.top,postProcessToRow=Math.min(getDataLengthIncludingAddNew()-1,i.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,trigger(self.onRendered,{startRow:i.top,endRow:i.bottom,grid:self})}}function handleHeaderRowScroll(){var i=$headerRowScrollContainer[0].scrollLeft;i!=$viewportScrollContainerX[0].scrollLeft&&($viewportScrollContainerX[0].scrollLeft=i)}function handleFooterRowScroll(){var i=$footerRowScrollContainer[0].scrollLeft;i!=$viewportScrollContainerX[0].scrollLeft&&($viewportScrollContainerX[0].scrollLeft=i)}function handlePreHeaderPanelScroll(){handleElementScroll($preHeaderPanelScroller[0])}function handleElementScroll(i){var e=i.scrollLeft;e!=$viewportScrollContainerX[0].scrollLeft&&($viewportScrollContainerX[0].scrollLeft=e)}function handleScroll(){return scrollTop=$viewportScrollContainerY[0].scrollTop,scrollLeft=$viewportScrollContainerX[0].scrollLeft,_handleScroll(!1)}function _handleScroll(i){var e=$viewportScrollContainerY[0].scrollHeight-$viewportScrollContainerY[0].clientHeight,s=$viewportScrollContainerY[0].scrollWidth-$viewportScrollContainerY[0].clientWidth;e=Math.max(0,e),s=Math.max(0,s),scrollTop>e&&(scrollTop=e),scrollLeft>s&&(scrollLeft=s);var o=Math.abs(scrollTop-prevScrollTop),a=Math.abs(scrollLeft-prevScrollLeft);if(a&&(prevScrollLeft=scrollLeft,$viewportScrollContainerX[0].scrollLeft=scrollLeft,$headerScrollContainer[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScrollContainer[0].scrollLeft=scrollLeft,options.createFooterRow&&($footerRowScrollContainer[0].scrollLeft=scrollLeft),options.createPreHeaderPanel&&(hasFrozenColumns()?$preHeaderPanelScrollerR[0].scrollLeft=scrollLeft:$preHeaderPanelScroller[0].scrollLeft=scrollLeft),hasFrozenColumns()?hasFrozenRows&&($viewportTopR[0].scrollLeft=scrollLeft):hasFrozenRows&&($viewportTopL[0].scrollLeft=scrollLeft)),o)if(vScrollDir=prevScrollTop<scrollTop?1:-1,prevScrollTop=scrollTop,i&&($viewportScrollContainerY[0].scrollTop=scrollTop),hasFrozenColumns()&&(hasFrozenRows&&!options.frozenBottom?$viewportBottomL[0].scrollTop=scrollTop:$viewportTopL[0].scrollTop=scrollTop),o<viewportH)scrollTo(scrollTop+offset);else{var d=offset;h==viewportH?page=0:page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),offset=Math.round(page*cj),d!=offset&&invalidateAllRows()}if(a||o){var g=Math.abs(lastRenderedScrollLeft-scrollLeft),_=Math.abs(lastRenderedScrollTop-scrollTop);(g>20||_>20)&&(options.forceSyncScrolling||_<viewportH&&g<viewportW?render():scrollThrottle.enqueue(),trigger(self.onViewportChanged,{}))}return trigger(self.onScroll,{scrollLeft,scrollTop}),!!(a||o)}function ActionThrottle(i,e){var s=!1,o=!1;function a(){s?o=!0:g()}function d(){o=!1}function g(){s=!0,setTimeout(_,e),i()}function _(){o?(d(),g()):s=!1}return{enqueue:a,dequeue:d}}function asyncPostProcessRows(){for(var i=getDataLength();postProcessFromRow<=postProcessToRow;){var e=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,s=rowsCache[e];if(!(!s||e>=i)){postProcessedRows[e]||(postProcessedRows[e]={}),ensureCellNodesInRowsCache(e);for(var o in s.cellNodesByColumnIdx)if(s.cellNodesByColumnIdx.hasOwnProperty(o)){o=o|0;var a=columns[o],d=postProcessedRows[e][o];if(a.asyncPostRender&&d!=="R"){var g=s.cellNodesByColumnIdx[o];g&&a.asyncPostRender(g,e,getDataItem(e),a,d==="C"),postProcessedRows[e][o]="R"}}h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}}function asyncPostProcessCleanupRows(){if(postProcessedCleanupQueue.length>0){for(var i=postProcessedCleanupQueue[0].groupId;postProcessedCleanupQueue.length>0&&postProcessedCleanupQueue[0].groupId==i;){var e=postProcessedCleanupQueue.shift();if(e.actionType=="R"&&$(e.node).remove(),e.actionType=="C"){var s=columns[e.columnIdx];s.asyncPostRenderCleanup&&e.node&&s.asyncPostRenderCleanup(e.node,e.rowIdx,s)}}h_postrenderCleanup=setTimeout(asyncPostProcessCleanupRows,options.asyncPostRenderCleanupDelay)}}function updateCellCssStylesOnRenderedRows(i,e){var s,o,a,d;for(var g in rowsCache){if(d=e&&e[g],a=i&&i[g],d)for(o in d)(!a||d[o]!=a[o])&&(s=getCellNode(g,getColumnIndex(o)),s&&$(s).removeClass(d[o]));if(a)for(o in a)(!d||d[o]!=a[o])&&(s=getCellNode(g,getColumnIndex(o)),s&&$(s).addClass(a[o]))}}function addCellCssStyles(i,e){if(cellCssClasses[i])throw new Error("SlickGrid addCellCssStyles: cell CSS hash with key '"+i+"' already exists.");cellCssClasses[i]=e,updateCellCssStylesOnRenderedRows(e,null),trigger(self.onCellCssStylesChanged,{key:i,hash:e,grid:self})}function removeCellCssStyles(i){cellCssClasses[i]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[i]),delete cellCssClasses[i],trigger(self.onCellCssStylesChanged,{key:i,hash:null,grid:self}))}function setCellCssStyles(i,e){var s=cellCssClasses[i];cellCssClasses[i]=e,updateCellCssStylesOnRenderedRows(e,s),trigger(self.onCellCssStylesChanged,{key:i,hash:e,grid:self})}function getCellCssStyles(i){return cellCssClasses[i]}function flashCell(i,e,s){s=s||100;function o(d,g){g&&setTimeout(function(){d.queue(function(){d.toggleClass(options.cellFlashingCssClass).dequeue(),o(d,g-1)})},s)}if(rowsCache[i]){var a=$(getCellNode(i,e));o(a,4)}}function handleMouseWheel(i,e,s,o){var a=$(i.target).closest(".slick-row"),d=a[0];if(d!=rowNodeFromLastMouseWheelEvent){var g=a.parents(".grid-canvas"),_=g.hasClass("grid-canvas-left");if(zombieRowNodeFromLastMouseWheelEvent&&zombieRowNodeFromLastMouseWheelEvent[_?0:1]!=d){var j=zombieRowNodeFromLastMouseWheelEvent[_||zombieRowNodeFromLastMouseWheelEvent.length==1?0:1];j.parentElement.removeChild(j),zombieRowNodeFromLastMouseWheelEvent=null}rowNodeFromLastMouseWheelEvent=d}scrollTop=Math.max(0,$viewportScrollContainerY[0].scrollTop-o*options.rowHeight),scrollLeft=$viewportScrollContainerX[0].scrollLeft+s*10;var _e=_handleScroll(!0);_e&&i.preventDefault()}function handleDragInit(i,e){var s=getCellFromEvent(i);if(!s||!cellExists(s.row,s.cell))return!1;var o=trigger(self.onDragInit,e,i);return i.isImmediatePropagationStopped()?o:!1}function handleDragStart(i,e){var s=getCellFromEvent(i);if(!s||!cellExists(s.row,s.cell))return!1;var o=trigger(self.onDragStart,e,i);return i.isImmediatePropagationStopped()?o:!1}function handleDrag(i,e){return trigger(self.onDrag,e,i)}function handleDragEnd(i,e){trigger(self.onDragEnd,e,i)}function handleKeyDown(i){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},i);var e=i.isImmediatePropagationStopped(),s=Slick.keyCode;if(!e&&!i.shiftKey&&!i.altKey){if(options.editable&&currentEditor&&currentEditor.keyCaptureList&&currentEditor.keyCaptureList.indexOf(i.which)>-1)return;i.which==s.HOME?e=i.ctrlKey?navigateTop():navigateRowStart():i.which==s.END&&(e=i.ctrlKey?navigateBottom():navigateRowEnd())}if(!e)if(!i.shiftKey&&!i.altKey&&!i.ctrlKey){if(options.editable&&currentEditor&&currentEditor.keyCaptureList&&currentEditor.keyCaptureList.indexOf(i.which)>-1)return;if(i.which==s.ESCAPE){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else i.which==s.PAGE_DOWN?(navigatePageDown(),e=!0):i.which==s.PAGE_UP?(navigatePageUp(),e=!0):i.which==s.LEFT?e=navigateLeft():i.which==s.RIGHT?e=navigateRight():i.which==s.UP?e=navigateUp():i.which==s.DOWN?e=navigateDown():i.which==s.TAB?e=navigateNext():i.which==s.ENTER&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable(void 0,void 0,i)),e=!0)}else i.which==s.TAB&&i.shiftKey&&!i.ctrlKey&&!i.altKey&&(e=navigatePrev());if(e){i.stopPropagation(),i.preventDefault();try{i.originalEvent.keyCode=0}catch{}}}function handleClick(i){currentEditor||(i.target!=__doc__.activeElement||$(i.target).hasClass("slick-cell"))&&setFocus();var e=getCellFromEvent(i);if(!(!e||currentEditor!==null&&activeRow==e.row&&activeCell==e.cell)&&(trigger(self.onClick,{row:e.row,cell:e.cell},i),!i.isImmediatePropagationStopped()&&canCellBeActive(e.row,e.cell)&&(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()))){scrollRowIntoView(e.row,!1);var s=i.target&&i.target.className===Slick.preClickClassName,o=columns[e.cell],a=!!(options.editable&&o&&o.editor&&options.suppressActiveCellChangeOnEdit);setActiveCellInternal(getCellNode(e.row,e.cell),null,s,a,i)}}function handleContextMenu(i){var e=$(i.target).closest(".slick-cell",$canvas);e.length!==0&&(activeCellNode===e[0]&&currentEditor!==null||trigger(self.onContextMenu,{},i))}function handleDblClick(i){var e=getCellFromEvent(i);!e||currentEditor!==null&&activeRow==e.row&&activeCell==e.cell||(trigger(self.onDblClick,{row:e.row,cell:e.cell},i),!i.isImmediatePropagationStopped()&&options.editable&&gotoCell(e.row,e.cell,!0,i))}function handleHeaderMouseEnter(i){trigger(self.onHeaderMouseEnter,{column:$(this).data("column"),grid:self},i)}function handleHeaderMouseLeave(i){trigger(self.onHeaderMouseLeave,{column:$(this).data("column"),grid:self},i)}function handleHeaderContextMenu(i){var e=$(i.target).closest(".slick-header-column",".slick-header-columns"),s=e&&e.data("column");trigger(self.onHeaderContextMenu,{column:s},i)}function handleHeaderClick(i){if(!columnResizeDragging){var e=$(i.target).closest(".slick-header-column",".slick-header-columns"),s=e&&e.data("column");s&&trigger(self.onHeaderClick,{column:s},i)}}function handleFooterContextMenu(i){var e=$(i.target).closest(".slick-footerrow-column",".slick-footerrow-columns"),s=e&&e.data("column");trigger(self.onFooterContextMenu,{column:s},i)}function handleFooterClick(i){var e=$(i.target).closest(".slick-footerrow-column",".slick-footerrow-columns"),s=e&&e.data("column");trigger(self.onFooterClick,{column:s},i)}function handleMouseEnter(i){trigger(self.onMouseEnter,{},i)}function handleMouseLeave(i){trigger(self.onMouseLeave,{},i)}function cellExists(i,e){return!(i<0||i>=getDataLength()||e<0||e>=columns.length)}function getCellFromPoint(i,e){for(var s=getRowFromPosition(e),o=0,a=0,d=0;d<columns.length&&a<i;d++)a+=columns[d].width,o++;return o<0&&(o=0),{row:s,cell:o-1}}function getCellFromNode(i){var e=/l\d+/.exec(i.className);if(!e)throw new Error("SlickGrid getCellFromNode: cannot get cell - "+i.className);return parseInt(e[0].substr(1,e[0].length-1),10)}function getRowFromNode(i){for(var e in rowsCache)for(var s in rowsCache[e].rowNode)if(rowsCache[e].rowNode[s]===i)return e?parseInt(e):0;return null}function getFrozenRowOffset(i){var e=hasFrozenRows?options.frozenBottom?i>=actualFrozenRow?h<viewportTopH?actualFrozenRow*options.rowHeight:h:0:i>=actualFrozenRow?frozenRowsHeight:0:0;return e}function getCellFromEvent(i){var e,s,o=$(i.target).closest(".slick-cell",$canvas);if(!o.length)return null;if(e=getRowFromNode(o[0].parentNode),hasFrozenRows){var a=o.parents(".grid-canvas").offset(),d=0,g=o.parents(".grid-canvas-bottom").length;g&&(d=options.frozenBottom?$canvasTopL.height():frozenRowsHeight),e=getCellFromPoint(i.clientX-a.left,i.clientY-a.top+d+$(__doc__).scrollTop()).row}return s=getCellFromNode(o[0]),e==null||s==null?null:{row:e,cell:s}}function getCellNodeBox(i,e){if(!cellExists(i,e))return null;for(var s=getFrozenRowOffset(i),o=getRowTop(i)-s,a=o+options.rowHeight-1,d=0,g=0;g<e;g++)d+=columns[g].width,options.frozenColumn==g&&(d=0);var _=d+columns[e].width;return{top:o,left:d,bottom:a,right:_}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){tabbingDirection==-1?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(i,e,s){if(scrollRowIntoView(i,s),!(e<=options.frozenColumn)){var o=getColspan(i,e);internalScrollColumnIntoView(columnPosLeft[e],columnPosRight[e+(o>1?o-1:0)])}}function internalScrollColumnIntoView(i,e){var s=scrollLeft+$viewportScrollContainerX.width();i<scrollLeft?($viewportScrollContainerX.scrollLeft(i),handleScroll(),render()):e>s&&($viewportScrollContainerX.scrollLeft(Math.min(i,e-$viewportScrollContainerX[0].clientWidth)),handleScroll(),render())}function scrollColumnIntoView(i){internalScrollColumnIntoView(columnPosLeft[i],columnPosRight[i])}function setActiveCellInternal(i,e,s,o,a){if(activeCellNode!==null&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active")),activeCellNode=i,activeCellNode!=null){var d=$(activeCellNode),g=d.offset(),_=Math.floor(d.parents(".grid-canvas").offset().top),j=d.parents(".grid-canvas-bottom").length;hasFrozenRows&&j&&(_-=options.frozenBottom?$canvasTopL.height():frozenRowsHeight);var _e=getCellFromPoint(g.left,Math.ceil(g.top)-_);activeRow=_e.row,activeCell=activePosX=activeCell=activePosX=getCellFromNode(activeCellNode),e==null&&(e=activeRow==getDataLength()||options.autoEdit),options.showCellSelection&&(d.addClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).addClass("active")),options.editable&&e&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable(void 0,s,a)},options.asyncEditorLoadDelay):makeActiveCellEditable(void 0,s,a))}else activeRow=activeCell=null;o||trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(__doc__.selection&&__doc__.selection.empty)try{__doc__.selection.empty()}catch{}else if(window.getSelection){var i=window.getSelection();i&&i.removeAllRanges&&i.removeAllRanges()}}function isCellPotentiallyEditable(i,e){var s=getDataLength();return!(i<s&&!getDataItem(i)||columns[e].cannotTriggerInsert&&i>=s||!getEditor(i,e))}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor}),currentEditor.destroy(),currentEditor=null,activeCellNode){var i=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),i){var e=columns[activeCell],s=getFormatter(activeRow,e),o=s(activeRow,activeCell,getDataItemValueForColumn(i,e),e,i,self);applyFormatResultToCellNode(o,activeCellNode),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(i,e,s){if(activeCellNode){if(!options.editable)throw new Error("SlickGrid makeActiveCellEditable : should never get called when options.editable is false");if(clearTimeout(h_editorLoader),!!isCellPotentiallyEditable(activeRow,activeCell)){var o=columns[activeCell],a=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:a,column:o,target:"grid"})===!1){setFocus();return}getEditorLock().activate(editController),$(activeCellNode).addClass("editable");var d=i||getEditor(activeRow,activeCell);!i&&!d.suppressClearOnEdit&&(activeCellNode.innerHTML="");var g=data.getItemMetadata&&data.getItemMetadata(activeRow);g=g&&g.columns;var _=g&&(g[o.id]||g[activeCell]);currentEditor=new d({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:o,columnMetaData:_,item:a||{},event:s,commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),a&&(currentEditor.loadValue(a),e&&currentEditor.preClick&&currentEditor.preClick()),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(i){var e={top:i.offsetTop,left:i.offsetLeft,bottom:0,right:0,width:$(i).outerWidth(),height:$(i).outerHeight(),visible:!0};e.bottom=e.top+e.height,e.right=e.left+e.width;for(var s=i.offsetParent;(i=i.parentNode)!=__doc__.body&&i!=null;)e.visible&&i.scrollHeight!=i.offsetHeight&&$(i).css("overflowY")!="visible"&&(e.visible=e.bottom>i.scrollTop&&e.top<i.scrollTop+i.clientHeight),e.visible&&i.scrollWidth!=i.offsetWidth&&$(i).css("overflowX")!="visible"&&(e.visible=e.right>i.scrollLeft&&e.left<i.scrollLeft+i.clientWidth),e.left-=i.scrollLeft,e.top-=i.scrollTop,i===s&&(e.left+=i.offsetLeft,e.top+=i.offsetTop,s=i.offsetParent),e.bottom=e.top+e.height,e.right=e.left+e.width;return e}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{}),currentEditor)){var i=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(i.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(i)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(i,e){if(!hasFrozenRows||!options.frozenBottom&&i>actualFrozenRow-1||options.frozenBottom&&i<actualFrozenRow-1){var s=$viewportScrollContainerY.height(),o=hasFrozenRows&&!options.frozenBottom?i-options.frozenRow:i,a=o*options.rowHeight,d=(o+1)*options.rowHeight-s+(viewportHasHScroll?scrollbarDimensions.height:0);(o+1)*options.rowHeight>scrollTop+s+offset?(scrollTo(e?a:d),render()):o*options.rowHeight<scrollTop+offset&&(scrollTo(e?d:a),render())}}function scrollRowToTop(i){scrollTo(i*options.rowHeight),render()}function scrollPage(i){var e=i*numVisibleRows,s=scrollTop+options.rowHeight-1;if(scrollTo((getRowFromPosition(s)+e)*options.rowHeight),render(),options.enableCellNavigation&&activeRow!=null){var o=activeRow+e,a=getDataLengthIncludingAddNew();o>=a&&(o=a-1),o<0&&(o=0);for(var d=0,g=null,_=activePosX;d<=activePosX;)canCellBeActive(o,d)&&(g=d),d+=getColspan(o,d);g!==null?(setActiveCellInternal(getCellNode(o,g)),activePosX=_):resetActiveCell()}}function navigatePageDown(){scrollPage(1)}function navigatePageUp(){scrollPage(-1)}function navigateTop(){navigateToRow(0)}function navigateBottom(){navigateToRow(getDataLength()-1)}function navigateToRow(i){var e=getDataLength();if(!e)return!0;if(i<0?i=0:i>=e&&(i=e-1),scrollCellIntoView(i,0,!0),options.enableCellNavigation&&activeRow!=null){for(var s=0,o=null,a=activePosX;s<=activePosX;)canCellBeActive(i,s)&&(o=s),s+=getColspan(i,s);o!==null?(setActiveCellInternal(getCellNode(i,o)),activePosX=a):resetActiveCell()}return!0}function getColspan(i,e){var s=data.getItemMetadata&&data.getItemMetadata(i);if(!s||!s.columns)return 1;var o=s.columns[columns[e].id]||s.columns[e],a=o&&o.colspan;return a==="*"?a=columns.length-e:a=a||1,a}function findFirstFocusableCell(i){for(var e=0;e<columns.length;){if(canCellBeActive(i,e))return e;e+=getColspan(i,e)}return null}function findLastFocusableCell(i){for(var e=0,s=null;e<columns.length;)canCellBeActive(i,e)&&(s=e),e+=getColspan(i,e);return s}function gotoRight(i,e,s){if(e>=columns.length)return null;do e+=getColspan(i,e);while(e<columns.length&&!canCellBeActive(i,e));return e<columns.length?{row:i,cell:e,posX:e}:null}function gotoLeft(i,e,s){if(e<=0)return null;var o=findFirstFocusableCell(i);if(o===null||o>=e)return null;for(var a={row:i,cell:o,posX:o},d;;){if(d=gotoRight(a.row,a.cell,a.posX),!d)return null;if(d.cell>=e)return a;a=d}}function gotoDown(i,e,s){for(var o,a=getDataLengthIncludingAddNew();;){if(++i>=a)return null;for(o=e=0;e<=s;)o=e,e+=getColspan(i,e);if(canCellBeActive(i,o))return{row:i,cell:o,posX:s}}}function gotoUp(i,e,s){for(var o;;){if(--i<0)return null;for(o=e=0;e<=s;)o=e,e+=getColspan(i,e);if(canCellBeActive(i,o))return{row:i,cell:o,posX:s}}}function gotoNext(i,e,s){if(i==null&&e==null&&(i=e=0,canCellBeActive(i,e)))return{row:i,cell:e,posX:e};var o=gotoRight(i,e);if(o)return o;var a=null,d=getDataLengthIncludingAddNew();for(i===d-1&&i--;++i<d;)if(a=findFirstFocusableCell(i),a!==null)return{row:i,cell:a,posX:a};return null}function gotoPrev(i,e,s){if(i==null&&e==null&&(i=getDataLengthIncludingAddNew()-1,e=columns.length-1,canCellBeActive(i,e)))return{row:i,cell:e,posX:e};for(var o,a;!o&&(o=gotoLeft(i,e),!o);){if(--i<0)return null;e=0,a=findLastFocusableCell(i),a!==null&&(o={row:i,cell:a,posX:a})}return o}function gotoRowStart(i,e,s){var o=findFirstFocusableCell(i);return o===null?null:{row:i,cell:o,posX:o}}function gotoRowEnd(i,e,s){var o=findLastFocusableCell(i);return o===null?null:{row:i,cell:o,posX:o}}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigateRowStart(){return navigate("home")}function navigateRowEnd(){return navigate("end")}function navigate(i){if(!options.enableCellNavigation||!activeCellNode&&i!="prev"&&i!="next")return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();var e={up:-1,down:1,left:-1,right:1,prev:-1,next:1,home:-1,end:1};tabbingDirection=e[i];var s={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext,home:gotoRowStart,end:gotoRowEnd},o=s[i],a=o(activeRow,activeCell,activePosX);if(a){if(hasFrozenRows&&options.frozenBottom&a.row==getDataLength())return;var d=a.row==getDataLength();return(!options.frozenBottom&&a.row>=actualFrozenRow||options.frozenBottom&&a.row<actualFrozenRow)&&scrollCellIntoView(a.row,a.cell,!d&&options.emulatePagingWhenScrolling),setActiveCellInternal(getCellNode(a.row,a.cell)),activePosX=a.posX,!0}else return setActiveCellInternal(getCellNode(activeRow,activeCell)),!1}function getCellNode(i,e){if(rowsCache[i]){ensureCellNodesInRowsCache(i);try{return rowsCache[i].cellNodesByColumnIdx.length>e?rowsCache[i].cellNodesByColumnIdx[e][0]:null}catch{return rowsCache[i].cellNodesByColumnIdx[e]}}return null}function setActiveCell(i,e,s,o,a){initialized&&(i>getDataLength()||i<0||e>=columns.length||e<0||options.enableCellNavigation&&(scrollCellIntoView(i,e,!1),setActiveCellInternal(getCellNode(i,e),s,o,a)))}function setActiveRow(i,e,s){initialized&&(i>getDataLength()||i<0||e>=columns.length||e<0||(activeRow=i,s||scrollCellIntoView(i,e||0,!1)))}function canCellBeActive(i,e){if(!options.enableCellNavigation||i>=getDataLengthIncludingAddNew()||i<0||e>=columns.length||e<0)return!1;var s=data.getItemMetadata&&data.getItemMetadata(i);if(s&&typeof s.focusable<"u")return!!s.focusable;var o=s&&s.columns;return o&&o[columns[e].id]&&typeof o[columns[e].id].focusable<"u"?!!o[columns[e].id].focusable:o&&o[e]&&typeof o[e].focusable<"u"?!!o[e].focusable:!!columns[e].focusable}function canCellBeSelected(i,e){if(i>=getDataLength()||i<0||e>=columns.length||e<0)return!1;var s=data.getItemMetadata&&data.getItemMetadata(i);if(s&&typeof s.selectable<"u")return!!s.selectable;var o=s&&s.columns&&(s.columns[columns[e].id]||s.columns[e]);return o&&typeof o.selectable<"u"?!!o.selectable:!!columns[e].selectable}function gotoCell(i,e,s,o){if(initialized&&canCellBeActive(i,e)&&getEditorLock().commitCurrentEdit()){scrollCellIntoView(i,e,!1);var a=getCellNode(i,e),d=columns[e],g=!!(options.editable&&d&&d.editor&&options.suppressActiveCellChangeOnEdit);setActiveCellInternal(a,s||i===getDataLength()||options.autoEdit,null,g,o),currentEditor||setFocus()}}function commitCurrentEdit(){var i=getDataItem(activeRow),e=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var s=currentEditor.validate();if(s.valid){if(activeRow<getDataLength()){var o={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(i,this.serializedValue),updateRow(this.row),trigger(self.onCellChange,{row:this.row,cell:this.cell,item:i,column:e})},undo:function(){this.editor.applyValue(i,this.prevSerializedValue),updateRow(this.row),trigger(self.onCellChange,{row:this.row,cell:this.cell,item:i,column:e})}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(i,e,o)):(o.execute(),makeActiveCellNormal())}else{var a={};currentEditor.applyValue(a,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:a,column:e})}return!getEditorLock().isActive()}else return $(activeCellNode).removeClass("invalid"),$(activeCellNode).width(),$(activeCellNode).addClass("invalid"),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:s,row:activeRow,cell:activeCell,column:e}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(i){for(var e=[],s=columns.length-1,o=0;o<i.length;o++)e.push(new Slick.Range(i[o],0,i[o],s));return e}function getSelectedRows(){if(!selectionModel)throw new Error("SlickGrid Selection model is not set");return selectedRows.slice(0)}function setSelectedRows(i){if(!selectionModel)throw new Error("SlickGrid Selection model is not set");self&&self.getEditorLock&&!self.getEditorLock().isActive()&&selectionModel.setSelectedRanges(rowsToRanges(i))}function getBaseDocument(){return __doc__}function setBaseDocument(i){__doc__=i,stylesheet=null;var e=__doc__.styleSheets;for(let s=0;s<e.length;s++)if(e[s].rules[0].selectorText&&e[s].rules[0].selectorText.includes(uid)){stylesheet=e[s];break}$style=$(stylesheet.ownerNode),removeCssRules(),createCssRules(),setColumns(columns)}this.debug=function(){var i="";i+=`
counter_rows_rendered:  `+counter_rows_rendered,i+=`
counter_rows_removed:  `+counter_rows_removed,i+=`
renderedRows:  `+renderedRows,i+=`
numVisibleRows:  `+numVisibleRows,i+=`
maxSupportedCssHeight:  `+maxSupportedCssHeight,i+=`
n(umber of pages):  `+n,i+=`
(current) page:  `+page,i+=`
page height (ph):  `+ph,i+=`
vScrollDir:  `+vScrollDir,alert(i)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.4.38",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onFooterRowCellRendered:new Slick.Event,onFooterContextMenu:new Slick.Event,onFooterClick:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onBeforeFooterRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onBeforeAppendCell:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsDrag:new Slick.Event,onColumnsResized:new Slick.Event,onColumnsResizeDblClick:new Slick.Event,onBeforeColumnsResize:new Slick.Event,onCellChange:new Slick.Event,onCompositeEditorChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,onAutosizeColumns:new Slick.Event,onRendered:new Slick.Event,onSetOptions:new Slick.Event,registerPlugin,unregisterPlugin,getPluginByName,getColumns,setColumns,getColumnIndex,updateColumnHeader,setSortColumn,setSortColumns,getSortColumns,autosizeColumns,autosizeColumn,getOptions,setOptions,getData,getDataLength,getDataItem,setData,getSelectionModel,setSelectionModel,getSelectedRows,setSelectedRows,getContainerNode,updatePagingStatusFromView,applyFormatResultToCellNode,render,reRenderColumns,invalidate,invalidateRow,invalidateRows,invalidateAllRows,updateCell,updateRow,getViewport:getVisibleRange,getRenderedRange,resizeCanvas,updateRowCount,scrollRowIntoView,scrollRowToTop,scrollCellIntoView,scrollColumnIntoView,getCanvasNode,getUID,getHeaderColumnWidthDiff,getScrollbarDimensions,getHeadersWidth,getCanvasWidth,getCanvases,getActiveCanvasNode,setActiveCanvasNode,getViewportNode,getViewports,getActiveViewportNode,setActiveViewportNode,focus:setFocus,scrollTo,cacheCssForHiddenInit,restoreCssFromHiddenInit,getCellFromPoint,getCellFromEvent,getActiveCell,setActiveCell,setActiveRow,getActiveCellNode,getActiveCellPosition,resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor,getCellNode,getCellNodeBox,canCellBeSelected,canCellBeActive,navigatePrev,navigateNext,navigateUp,navigateDown,navigateLeft,navigateRight,navigatePageUp,navigatePageDown,navigateTop,navigateBottom,navigateRowStart,navigateRowEnd,gotoCell,getTopPanel,setTopPanelVisibility,getPreHeaderPanel,getPreHeaderPanelLeft:getPreHeaderPanel,getPreHeaderPanelRight,setPreHeaderPanelVisibility,getHeader,getHeaderColumn,setHeaderRowVisibility,getHeaderRow,getHeaderRowColumn,setFooterRowVisibility,getFooterRow,getFooterRowColumn,getGridPosition,flashCell,addCellCssStyles,setCellCssStyles,removeCellCssStyles,getCellCssStyles,getFrozenRowOffset,setColumnHeaderVisibility,init:finishInitialization,destroy,getEditorLock,getEditController,applyColumnWidths,setBaseDocument,getBaseDocument}),init()}function TextEditor(i){var e,s;this.init=function(){e=$("<INPUT type=text class='editor-text' />").appendTo(i.container).on("keyup",o=>{const a=o.which;if(a===37||a===39||a===8){o.stopImmediatePropagation();return}this.autoCorrect(e.val())})},this.autoCorrect=function(o){const d=i.grid.getData().getValueSuggestion(o,i.column.field);d&&e.val(d)},this.destroy=function(){e.remove()},this.focus=function(){e.focus()},this.getValue=function(){return e.val()},this.setValue=function(o){e.val(o)},this.loadValue=function(o){s=o[i.column.field]||"",e.val(s),e[0].defaultValue=s,e.select()},this.serializeValue=function(){return e.val()},this.applyValue=function(o,a,d=!0){i.grid.getData().updateValue(a,o.__index__,i.column.field,d)},this.isValueChanged=function(){return!(e.val()==""&&s==null)&&e.val()!=s},this.validate=function(){if(i.column.validator){var o=i.column.validator(e.val());if(!o.valid)return o}return{valid:!0,msg:null}},this.init()}function Overlays(i){var e,s,o,a,d=this,g=new Slick.EventHandler,_,j={buttonCssClass:null,buttonImage:"../images/down.gif",decoratorWidth:2};function _e(xt){i=$.extend(!0,{},j,i),a=xt,_=new Ct(a),e=tt(),g.subscribe(a.onActiveCellChanged,rt).subscribe(a.onColumnsResized,it).subscribe(a.onScroll,ot)}function et(){g.unsubscribeAll(),e.$handle.unbind("dragstart",ft).unbind("drag",dt).unbind("dragend",pt),e.remove()}function tt(){var xt=a.getCanvasNode(),at=new gt(xt);return at.$handle.bind("dragstart",ft).bind("drag",dt).bind("dragend",pt),at}function rt(xt,at){_.hide(),ct()}function it(xt,at){ct()}function ot(xt,at){ct()}function ct(xt,at){var Bt=a.getActiveCell();if(!Bt){e.toggle(!1);return}var Ht=a.getColumns()[Bt.cell];e.toggle(!0),e.$handle.toggle(typeof Ht.editor<"u");var sr=a.getCellNodeBox(Bt.row,Bt.cell);sr.height=sr.bottom-sr.top,sr.width=sr.right-sr.left,e.$left.css({left:sr.left-2,top:sr.top,width:2,height:sr.height}),e.$right.css({left:sr.left+sr.width-1,top:sr.top,width:2,height:sr.height}),e.$top.css({left:sr.left-2,top:sr.top-2,width:sr.width+3,height:2}),e.$bottom.css({left:sr.left-2,top:sr.top+sr.height-1,width:sr.width+3,height:2}),e.$handle.css({left:sr.left+sr.width-4,top:sr.top+sr.height-4,width:1,height:1})}function ft(xt,at){var Bt=a.getActiveCell();if(a.canCellBeSelected(Bt.row,Bt.cell)&&(o=!0,xt.stopImmediatePropagation()),!o)return null;const Ht=a.getCellEditor();return Ht&&Ht.applyValue(a.getDataItem(Bt.row),Ht.getValue(),!1),a.focus(),s=Bt.row,at.range={start:Bt,end:{}},$(this).css({"background-color":"transparent","border-color":"transparent"}),_.show(new Slick.Range(Bt.row,Bt.cell))}function dt(xt,at){if(!o)return;var Bt=a.getCanvasNode();xt.stopImmediatePropagation();var Ht=a.getCellFromPoint(xt.pageX-$(Bt).offset().left,xt.pageY-$(Bt).offset().top);if(!a.canCellBeSelected(Ht.row,Ht.cell))return;at.range.end=Ht,_.show(new Slick.Range(at.range.start.row,at.range.start.cell,Ht.row,at.range.start.cell));const sr=a.getViewport();sr.bottom===Ht.row&&a.scrollRowIntoView(Ht.row+7),sr.top===Ht.row&&a.scrollRowIntoView(sr.top-7)}function pt(xt,at){if(!o)return;o=!1,$(this).css({"background-color":"","border-color":""}),_.hideHandle();const Bt=_.getSelectedRange(),Ht=s<Bt.toRow?"+":"-";d.onFillUpDown.notify({dir:Ht,grid:a,range:Bt},xt,d),_.hide(),xt.preventDefault(),xt.stopPropagation()}function gt(xt,at){var Bt=(at||"")+"cell-overlay";this.$left=$("<div>").addClass(Bt).addClass("left").appendTo(xt),this.$right=$("<div>").addClass(Bt).addClass("right").appendTo(xt),this.$top=$("<div>").addClass(Bt).addClass("top").appendTo(xt),this.$bottom=$("<div>").addClass(Bt).addClass("bottom").appendTo(xt),this.$handle=$("<div>").addClass("handle-overlay").data("__doc__",a.getBaseDocument()).appendTo(xt),this.toggle=function(Ht){this.$left.toggle(Ht),this.$right.toggle(Ht),this.$top.toggle(Ht),this.$bottom.toggle(Ht),this.$handle.toggle(Ht)},this.remove=function(){this.$left.remove(),this.$right.remove(),this.$top.remove(),this.$bottom.remove(),this.$handle.remove()}}function Ct(xt){var at,Bt;function Ht(Er){Bt=Er,at||(at=new gt(a.getCanvasNode(),"selection-"));var Lr=xt.getCellNodeBox(Er.fromRow,Er.fromCell),sn=xt.getCellNodeBox(Er.toRow,Er.toCell);return at.$left.css({top:Lr.top-2,left:Lr.left-2,height:sn.bottom-Lr.top+2,width:i.decoratorWidth}),at.$right.css({top:Lr.top-2,left:sn.right-1,height:sn.bottom-Lr.top+2,width:i.decoratorWidth}),at.$top.css({top:Lr.top-2,left:sn.left-1,height:i.decoratorWidth,width:sn.right-Lr.left+2}),at.$bottom.css({top:sn.bottom-1,left:Lr.left-2,height:i.decoratorWidth,width:sn.right-Lr.left+3}),at.$handle.css({top:sn.bottom-3,left:Lr.right-4,height:1,width:1}),at}function sr(){return Bt}function mr(){at&&(at.toggle(!1),at=null)}function hr(){at.$handle.hide()}return{hide:mr,hideHandle:hr,show:Ht,getSelectedRange:sr}}$.extend(this,{init:_e,destroy:et,onFillUpDown:new Slick.Event})}function RowSelectionModel(i){var e,s=[],o=this,a=new Slick.EventHandler,d,g,_={selectActiveRow:!0};function j(xt){g=Object.assign(_,i),e=xt,a.subscribe(e.onActiveCellChanged,et(pt)),a.subscribe(e.onKeyDown,et(gt)),a.subscribe(e.onClick,et(Ct))}function _e(){a.unsubscribeAll()}function et(xt){return function(){d||(d=!0,xt.apply(this,arguments),d=!1)}}function tt(xt){for(var at=[],Bt=0;Bt<xt.length;Bt++)for(var Ht=xt[Bt].fromRow;Ht<=xt[Bt].toRow;Ht++)at.push(Ht);return at}function rt(xt){for(var at=[],Bt=e.getColumns().length-1,Ht=0;Ht<xt.length;Ht++)at.push(new Slick.Range(xt[Ht],0,xt[Ht],Bt));return at}function it(xt,at){var Bt,Ht=[];for(Bt=xt;Bt<=at;Bt++)Ht.push(Bt);for(Bt=at;Bt<xt;Bt++)Ht.push(Bt);return Ht}function ot(){return tt(s)}function ct(xt){ft(rt(xt))}function ft(xt){(!s||s.length===0)&&(!xt||xt.length===0)||(s=xt,o.onSelectedRangesChanged.notify(s))}function dt(){return s}function pt(xt,at){g.selectActiveRow&&at.row!=null&&ft([new Slick.Range(at.row,0,at.row,e.getColumns().length-1)])}function gt(xt){var at=e.getActiveCell();if(e.getOptions().multiSelect&&at&&xt.shiftKey&&!xt.ctrlKey&&!xt.altKey&&!xt.metaKey&&(xt.which==Slick.keyCode.UP||xt.which==Slick.keyCode.DOWN)){var Bt=ot();Bt.sort(function(Er,Lr){return Er-Lr}),Bt.length||(Bt=[at.row]);var Ht=Bt[0],sr=Bt[Bt.length-1],mr;if(xt.which==Slick.keyCode.DOWN?mr=at.row<sr||Ht==sr?++sr:++Ht:mr=at.row<sr?--sr:--Ht,mr>=0&&mr<e.getDataLength()){e.scrollRowIntoView(mr);var hr=rt(it(Ht,sr));ft(hr)}xt.preventDefault(),xt.stopPropagation()}}function Ct(xt){var at=e.getCellFromEvent(xt);if(!at||!e.canCellBeActive(at.row,at.cell)||!e.getOptions().multiSelect||!xt.ctrlKey&&!xt.shiftKey&&!xt.metaKey)return!1;var Bt=tt(s),Ht=Bt.indexOf(at.row);if(Ht===-1&&(xt.ctrlKey||xt.metaKey))Bt.push(at.row),e.setActiveCell(at.row,at.cell);else if(Ht!==-1&&(xt.ctrlKey||xt.metaKey))Bt=Bt.filter(function(sn,vr){return sn!==at.row}),e.setActiveCell(at.row,at.cell);else if(Bt.length&&xt.shiftKey){var sr=Bt.pop(),mr=Math.min(at.row,sr),hr=Math.max(at.row,sr);Bt=[];for(var Er=mr;Er<=hr;Er++)Er!==sr&&Bt.push(Er);Bt.push(sr),e.setActiveCell(at.row,at.cell)}var Lr=rt(Bt);return ft(Lr),xt.stopImmediatePropagation(),!0}Object.assign(this,{getSelectedRows:ot,setSelectedRows:ct,getSelectedRanges:dt,setSelectedRanges:ft,init:j,destroy:_e,pluginName:"RowSelectionModel",onSelectedRangesChanged:new Slick.Event})}class DataModel{constructor(e,s={}){this.dataStore=e,this.data=new Int32Array(0);let o=0;for(let a=0;a<o;a++)this.data[a]=a;this.size=o,(s.autoupdate==null||s.autoupdate===!0)&&e.addListener("sss",a=>{a==="filtered"&&this.updateModel()}),this.listeners={}}getLength(){return this.size}addListener(e,s){this.listeners[e]=s}setColumns(e){this.columns=e}sort(e,s){const o=this.dataStore.getRawColumn(e),a=this.dataStore.columnIndex[e];if(a.datatype==="unique"){const d={},g=new TextDecoder,_=a.stringLength,j=s==="desc"?1:-1;for(let _e=0;_e<this.data.length;_e++){const et=this.data[_e];d[et]=g.decode(o.slice(et*_,et*_+_))}this.data.sort((_e,et)=>d[_e].localeCompare(d[et])*j)}else s==="desc"?this.data.sort((d,g)=>{let _=o[d],j=o[g];return _=isNaN(_)?Number.MAX_VALUE:_,j=isNaN(j)?Number.MAX_VALUE:j,_-j}):this.data.sort((d,g)=>{let _=o[d],j=o[g];return _=isNaN(_)?Number.MIN_VALUE:_,j=isNaN(j)?Number.MIN_VALUE:j,j-_})}createColumn(e,s){const o={name:e,field:e,datatype:"text",values:[""]},a=new SharedArrayBuffer(this.dataStore.size);if(s){const d=this.dataStore.getRawColumn(s);new Uint8Array(a).set(d),o.values=this.dataStore.getColumnValues(s).slice(0)}this.dataStore.addColumn(o,a,!0)}removeColumn(e){this.dataStore.removeColumn(e,!0,!0)}getDataAsBlob(e="	",s=`
`){return this.dataStore.getDataAsBlob(this.columns,this.data,e,s)}getValueSuggestion(e,s){const o=this.dataStore.getColumnValues(s);for(let a of o)if(a===e||a.startsWith(e))return a;return null}_getValueIndex(e,s){let o=s.values.indexOf(e);if(o===-1){if(s.values.push(e),s.values.length>256)throw new Error(`text column '${s.name}' exceeded 256 values when adding '${e}'`);o=s.values.length-1}return o}updateValue(e,s,o,a=!0){const d=this.dataStore.columnIndex[o];let g=this._getValueIndex(e,d);d.data[s]=g,a&&this.dataStore.dataChanged([o])}updateRange(e,s,o,a){const d=this.dataStore.getRawColumn(e),g=a==="+"?d[this.data[s]]:d[this.data[o]];let _=a==="+"?s:o,j=a==="+"?1:-1,_e=a==="+"?o+1:s-1;for(;_!==_e;_+=j)d[this.data[_]]=g;this.dataStore.dataChanged([e])}replaceValues(e,s,o,a=!0){const d=this.dataStore.columnIndex[o];let g=this._getValueIndex(e,d);if(s==="_all_")for(let _=0;_<this.data.length;_++)d.data[this.data[_]]=g;else if(s==="_blank_"){let _=d.values.indexOf(e);if(_===-1)return;for(let j=0;j<this.data.length;j++){const _e=this.data[j];d.data[_e]===_&&(d.data[this.data[j]]=g)}}else if(s=="_delete_"){this.dataStore.cleanColumnData(o);return}else{let _=this._getValueIndex(s,d);for(let j=0;j<this.data.length;j++){const _e=this.data[j];d.data[_e]===g&&(d.data[this.data[j]]=_)}}a&&this.dataStore.dataChanged([o])}updateModel(){const e=this.dataStore.filterArray;this.data=new Int32Array(this.dataStore.filterSize);const s=this.data,o=this.dataStore.size;let a=0;for(let d=0;d<o;d++)e[d]===0&&(s[a++]=d);this.size=this.dataStore.filterSize;for(let d in this.listeners)this.listeners[d]()}getId(e){return this.data[e]}getItemField(e,s){return this.dataStore.getRowAsObject(this.data[e],[s])[s]}getItem(e){return this.dataStore.getRowAsObject(this.data[e],this.columns)}}class TableChart extends BaseChart{constructor(e,s,o){super(e,s,o),this.config.type="table_chart";let a=[];a=[{field:"__index__",id:"__index__",name:"index",datatype:"integer",sortable:!0,width:100}];const d=o.column_widths||{};for(let g of this.config.param){const _=e.columnIndex[g],j={id:_.field,field:_.field,name:_.name,datatype:_.datatype,sortable:!0,width:d[g]?d[g]:100};_.editable&&(j.editor=TextEditor),_.is_url&&(j.formatter=(_e,et,tt,rt,it)=>`<a href="${tt}" target="_blank">${tt}</a>`),a.push(j)}this.options={enableCellNavigation:!0,enableColumnReorder:!1,editable:!1,autoEdit:!0,enableAsyncPostRender:!0,frozenColumn:null},this.dataModel=new DataModel(e,{autoupdate:!1}),this.dataModel.setColumns(this.config.param),this.grid=new SlickGrid(this.contentDiv,this.dataModel,a,this.options),this.grid.onHeaderCellRendered.subscribe((g,_)=>{const j=_.column;if(j.editor&&this.mode==="edit"){const _e=createEl("i",{classes:["far","fa-edit"],style:{cursor:"pointer"}});_.node.prepend(_e),_e.addEventListener("click",et=>{et.stopImmediatePropagation(),new EditColumnDialog(this,j.field,j.name,this.__doc__)})}}),this.dataModel.addListener(this.config.id,()=>{this.grid.invalidate()}),this.grid.setColumns(this.grid.getColumns()),this.mode="select",this.grid.setSelectionModel(new RowSelectionModel),this.grid.init(),this.grid.onSort.subscribe((g,_)=>{this.dataModel.sort(_.columnId,_.sortAsc?"asc":"desc"),this.grid.invalidateAllRows(),this.grid.render()}),this.grid.onSelectedRowsChanged.subscribe((g,_)=>{this.mode==="select"&&this._rowsSelected(_)}),this.editIcon=this.addMenuIcon("fas fa-edit","Change To Edit Mode",{func:()=>{this.editIcon.firstElementChild.remove(),this.mode=this.mode==="select"?"edit":"select";const g=this.mode==="select"?["fas","fa-edit"]:["fas","fa-table"];createEl("i",{classes:g},this.editIcon),this.editIcon.setAttribute("aria-label",this.mode==="edit"?"Change To Selection Mode":"Change To Edit Mode"),this._changeMode()}}),this.addMenuIcon("fas fa-download","Download data",{func:()=>{this.downloadData()}}),this.filter=[],this.themeChanged(),this.onDataFiltered()}onDataHighlighted(e){if(e.source===this)return;const s=this.dataModel.data.indexOf(e.indexes[0]);s!==-1&&(this.grid.scrollRowIntoView(s),this.tempMode=this.mode,this.mode="",this.grid.setSelectedRows([s]),this.mode=this.tempMode)}onColumnRemoved(e){if(this.config.param.indexOf(e)===-1)return!1;const s=this.grid.getCellEditor();s&&s.destroy(),this.grid.setActiveCell(null);let o=this.grid.getColumns();return o=o.filter(a=>a.field!==e),this.config.param=this.config.param.filter(a=>a!==e),this.dataModel.setColumns(this.config.param),this.grid.setColumns(o),!1}getConfig(){const e=super.getConfig(),s=this.grid.getColumns();e.param=s.filter(o=>o.field!=="__index__").map(o=>o.field),e.column_widths={};for(let o of s)o.width!==100&&(e.column_widths[o.field]=o.width);return e}downloadData(){const e=this.dataModel.getDataAsBlob(),s=createEl("a",{download:"data",target:"_blank",href:window.URL.createObjectURL(e)},this.__doc__.body);s.click(),s.remove()}_changeMode(){this.mode==="select"?(this.addColumnIcon&&(this.addColumnIcon.remove(),this.addColumnIcon=null),this.selectionModel=new RowSelectionModel,this.grid.setSelectionModel(this.selectionModel),this.overlay&&(this.grid.unregisterPlugin(this.overlay),this.overlay=null),this.grid.setOptions({editable:!1},!0,!0),this.grid.setColumns(this.grid.getColumns())):(this.grid.setSelectedRows([]),this.selectionModel&&(this.grid.setSelectionModel(null),this.selectionModel=null),this.grid.setOptions({editable:!0},!0,!0),this.grid.setColumns(this.grid.getColumns()),this.addColumnIcon=this.addMenuIcon("fas fa-plus","Add Column",{func:e=>{new AddColumnDialog(this)}}),this.overlay=new Overlays({}),this.overlay.onFillUpDown.subscribe((e,s)=>this._updateOverlay(s)),this.grid.registerPlugin(this.overlay))}onDataChanged(e){this.grid.invalidate()}getColumnInfo(){return this.grid.getColumns().filter(e=>e.datatype==="text").map(e=>({name:e.name,field:e.field})).sort((e,s)=>e.name.localeCompare(s.name))}createColumn(e,s=null,o=2){this.dataModel.createColumn(e,s);const a=this.grid.getColumns();o-=1,o<0||o>=a.length&&(o=a.length-1),a.splice(o,0,{name:e,field:e,id:e,datatype:"text",editor:TextEditor,sortable:!0}),this.config.param.push(e),this.grid.setColumns(a),this.grid.invalidate()}_removeColumn(e){this.dataModel.removeColumn(e,!0,!0)}_updateOverlay(e){var s=this.grid.getColumns()[e.range.fromCell];s.editor&&(this.dataModel.updateRange(s.field,e.range.fromRow,e.range.toRow,e.dir),this.grid.invalidate())}_rowsSelected(e){const s=[];for(let o of e.rows)s.push(this.dataModel.data[o]);this.dataStore.dataHighlighted(s,this)}themeChanged(){console.warn("themeChanged() deprecated")}changeBaseDocument(e){super.changeBaseDocument(e),this.grid.setBaseDocument(e),this.mode==="edit"&&(this.grid.unregisterPlugin(this.overlay),this.grid.registerPlugin(this.overlay))}setSize(e,s){super.setSize(e,s),this.grid.resizeCanvas(),this.grid.invalidate()}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}addColumns(){}remove(){this.grid.destroy(),super.remove()}onDataFiltered(){this.isPinned||this.dataModel.updateModel()}}class EditColumnDialog extends BaseDialog{constructor(e,s,o,a){const d={doc:a,columns:2,width:380,maxHeight:500,title:"Bulk Edit "+o};super(d,{table:e,column:s})}init(e){this.col=e.column,this.dataModel=e.table.dataModel,this.table=e.table;const s=createEl("div",{},this.columns[0]);createEl("label",{text:"Value:"},s),this.valInput=createEl("input",{},s),this.valInput.addEventListener("keyup",a=>{const d=a.which;if(d===37||d===39||d===8){a.stopImmediatePropagation();return}const g=this.dataModel.getValueSuggestion(this.valInput.value,this.col);g&&(this.valInput.value=g)});const o=createEl("div",{},this.columns[0]);createEl("label",{text:"Replace With:"},o),this.replaceInput=createEl("input",{},o),this._createButton("Fill All Cells","_all_"),this._createButton("Fill Empty Cells","_blank_"),this._createButton("Replace Value",null),this._createButton("Delete Unused Values","_delete_"),this._createButton("Remove Column","_delete_column_")}_createButton(e,s){const o=createEl("div",{style:{padding:"5px 10px"}},this.columns[1]);createEl("button",{classes:["ciview-button"],text:e},o).addEventListener("click",()=>{const a=s||this.replaceInput.value;a==="_delete_column_"?(this.table._removeColumn(this.col),this.close()):this.dataModel.replaceValues(this.valInput.value,a,this.col)})}}class AddColumnDialog extends BaseDialog{constructor(e,s){const o={doc:s,footer:!0,buttons:[{text:"Add",method:"addColumn"}],width:300,maxHeight:500,title:"Add Column"};super(o,e)}init(e){const s={padding:"5px"};this.table=e;const o=createEl("div",{style:s},this.dialog);createEl("label",{text:"Column Name"},o),this.name=createEl("input",{},o),this.name.addEventListener("keydown",j=>{j.key==="Enter"&&this.addColumn()});const a=createEl("div",{style:s},this.dialog),d=createEl("label",{style:{display:"flex"}},a);this.cloneCheck=createEl("input",{type:"checkbox"},d),createEl("div",{text:"Copy Existing Column"},d);const g=e.getColumnInfo();this.cloneCol=createEl("select",{},a);for(let j of g)createEl("option",{text:j.name,value:j.field},this.cloneCol);const _=createEl("div",{style:s},this.dialog);createEl("label",{text:"Position"},_),this.position=createEl("input",{style:{width:"100px"},value:2},_),setTimeout(()=>this.name.focus(),100)}addColumn(){if(!this.name.value){this.name.focus();return}let e=this.cloneCheck.checked?this.cloneCol.value:null,s=parseInt(this.position.value);s=isNaN(s)?null:s,this.table.createColumn(this.name.value,e,s),this.close()}}BaseChart.types.table_chart={class:TableChart,name:"Table",params:[{type:"_multi_column:all",name:"Columns To Display"}]};var reglExports={},regl={get exports(){return reglExports},set exports(i){reglExports=i}};(function(i,e){(function(s,o){i.exports=o()})(commonjsGlobal,function(){var s=function(ht){return ht instanceof Uint8Array||ht instanceof Uint16Array||ht instanceof Uint32Array||ht instanceof Int8Array||ht instanceof Int16Array||ht instanceof Int32Array||ht instanceof Float32Array||ht instanceof Float64Array||ht instanceof Uint8ClampedArray},o=function(ht,St){for(var It=Object.keys(St),ir=0;ir<It.length;++ir)ht[It[ir]]=St[It[ir]];return ht},a=`
`;function d(ht){return typeof atob<"u"?atob(ht):"base64:"+ht}function g(ht){var St=new Error("(regl) "+ht);throw console.error(St),St}function _(ht,St){ht||g(St)}function j(ht){return ht?": "+ht:""}function _e(ht,St,It){ht in St||g("unknown parameter ("+ht+")"+j(It)+". possible values: "+Object.keys(St).join())}function et(ht,St){s(ht)||g("invalid parameter type"+j(St)+". must be a typed array")}function tt(ht,St){switch(St){case"number":return typeof ht=="number";case"object":return typeof ht=="object";case"string":return typeof ht=="string";case"boolean":return typeof ht=="boolean";case"function":return typeof ht=="function";case"undefined":return typeof ht>"u";case"symbol":return typeof ht=="symbol"}}function rt(ht,St,It){tt(ht,St)||g("invalid parameter type"+j(It)+". expected "+St+", got "+typeof ht)}function it(ht,St){ht>=0&&(ht|0)===ht||g("invalid parameter type, ("+ht+")"+j(St)+". must be a nonnegative integer")}function ot(ht,St,It){St.indexOf(ht)<0&&g("invalid value"+j(It)+". must be one of: "+St)}var ct=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ft(ht){Object.keys(ht).forEach(function(St){ct.indexOf(St)<0&&g('invalid regl constructor argument "'+St+'". must be one of '+ct)})}function dt(ht,St){for(ht=ht+"";ht.length<St;)ht=" "+ht;return ht}function pt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function gt(ht,St){this.number=ht,this.line=St,this.errors=[]}function Ct(ht,St,It){this.file=ht,this.line=St,this.message=It}function xt(){var ht=new Error,St=(ht.stack||ht).toString(),It=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(St);if(It)return It[1];var ir=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(St);return ir?ir[1]:"unknown"}function at(){var ht=new Error,St=(ht.stack||ht).toString(),It=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(St);if(It)return It[1];var ir=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(St);return ir?ir[1]:"unknown"}function Bt(ht,St){var It=ht.split(`
`),ir=1,br=0,nr={unknown:new pt,0:new pt};nr.unknown.name=nr[0].name=St||xt(),nr.unknown.lines.push(new gt(0,""));for(var dr=0;dr<It.length;++dr){var Nr=It[dr],Or=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Nr);if(Or)switch(Or[1]){case"line":var Wr=/(\d+)(\s+\d+)?/.exec(Or[2]);Wr&&(ir=Wr[1]|0,Wr[2]&&(br=Wr[2]|0,br in nr||(nr[br]=new pt)));break;case"define":var qr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Or[2]);qr&&(nr[br].name=qr[1]?d(qr[2]):qr[2]);break}nr[br].lines.push(new gt(ir++,Nr))}return Object.keys(nr).forEach(function(Xr){var Jr=nr[Xr];Jr.lines.forEach(function($r){Jr.index[$r.number]=$r})}),nr}function Ht(ht){var St=[];return ht.split(`
`).forEach(function(It){if(!(It.length<5)){var ir=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(It);ir?St.push(new Ct(ir[1]|0,ir[2]|0,ir[3].trim())):It.length>0&&St.push(new Ct("unknown",0,It))}}),St}function sr(ht,St){St.forEach(function(It){var ir=ht[It.file];if(ir){var br=ir.index[It.line];if(br){br.errors.push(It),ir.hasErrors=!0;return}}ht.unknown.hasErrors=!0,ht.unknown.lines[0].errors.push(It)})}function mr(ht,St,It,ir,br){if(!ht.getShaderParameter(St,ht.COMPILE_STATUS)){var nr=ht.getShaderInfoLog(St),dr=ir===ht.FRAGMENT_SHADER?"fragment":"vertex";Hr(It,"string",dr+" shader source must be a string",br);var Nr=Bt(It,br),Or=Ht(nr);sr(Nr,Or),Object.keys(Nr).forEach(function(Wr){var qr=Nr[Wr];if(!qr.hasErrors)return;var Xr=[""],Jr=[""];function $r(Ur,qt){Xr.push(Ur),Jr.push(qt||"")}$r("file number "+Wr+": "+qr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),qr.lines.forEach(function(Ur){if(Ur.errors.length>0){$r(dt(Ur.number,4)+"|  ","background-color:yellow; font-weight:bold"),$r(Ur.line+a,"color:red; background-color:yellow; font-weight:bold");var qt=0;Ur.errors.forEach(function(ur){var zr=ur.message,gn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(zr);if(gn){var Rr=gn[1];switch(zr=gn[2],Rr){case"assign":Rr="=";break}qt=Math.max(Ur.line.indexOf(Rr,qt),0)}else qt=0;$r(dt("| ",6)),$r(dt("^^^",qt+3)+a,"font-weight:bold"),$r(dt("| ",6)),$r(zr+a,"font-weight:bold")}),$r(dt("| ",6)+a)}else $r(dt(Ur.number,4)+"|  "),$r(Ur.line+a,"color:red")}),typeof document<"u"&&!window.chrome?(Jr[0]=Xr.join("%c"),console.log.apply(console,Jr)):console.log(Xr.join(""))}),_.raise("Error compiling "+dr+" shader, "+Nr[0].name)}}function hr(ht,St,It,ir,br){if(!ht.getProgramParameter(St,ht.LINK_STATUS)){var nr=ht.getProgramInfoLog(St),dr=Bt(It,br),Nr=Bt(ir,br),Or='Error linking program with vertex shader, "'+Nr[0].name+'", and fragment shader "'+dr[0].name+'"';typeof document<"u"?console.log("%c"+Or+a+"%c"+nr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Or+a+nr),_.raise(Or)}}function Er(ht){ht._commandRef=xt()}function Lr(ht,St,It,ir){Er(ht);function br(Or){return Or?ir.id(Or):0}ht._fragId=br(ht.static.frag),ht._vertId=br(ht.static.vert);function nr(Or,Wr){Object.keys(Wr).forEach(function(qr){Or[ir.id(qr)]=!0})}var dr=ht._uniformSet={};nr(dr,St.static),nr(dr,St.dynamic);var Nr=ht._attributeSet={};nr(Nr,It.static),nr(Nr,It.dynamic),ht._hasCount="count"in ht.static||"count"in ht.dynamic||"elements"in ht.static||"elements"in ht.dynamic}function sn(ht,St){var It=at();g(ht+" in command "+(St||xt())+(It==="unknown"?"":" called from "+It))}function vr(ht,St,It){ht||sn(St,It||xt())}function Zr(ht,St,It,ir){ht in St||sn("unknown parameter ("+ht+")"+j(It)+". possible values: "+Object.keys(St).join(),ir||xt())}function Hr(ht,St,It,ir){tt(ht,St)||sn("invalid parameter type"+j(It)+". expected "+St+", got "+typeof ht,ir||xt())}function cr(ht){ht()}function lr(ht,St,It){ht.texture?ot(ht.texture._texture.internalformat,St,"unsupported texture format for attachment"):ot(ht.renderbuffer._renderbuffer.format,It,"unsupported renderbuffer format for attachment")}var Fr=33071,an=9728,kn=9984,ms=9985,Zn=9986,As=9987,Rs=5120,Gn=5121,dn=5122,xr=5123,Yr=5124,Rn=5125,Ln=5126,pr=32819,nn=32820,mn=33635,Vr=34042,Mr=36193,Cn={};Cn[Rs]=Cn[Gn]=1,Cn[dn]=Cn[xr]=Cn[Mr]=Cn[mn]=Cn[pr]=Cn[nn]=2,Cn[Yr]=Cn[Rn]=Cn[Ln]=Cn[Vr]=4;function is(ht,St){return ht===nn||ht===pr||ht===mn?2:ht===Vr?4:Cn[ht]*St}function ts(ht){return!(ht&ht-1)&&!!ht}function Qn(ht,St,It){var ir,br=St.width,nr=St.height,dr=St.channels;_(br>0&&br<=It.maxTextureSize&&nr>0&&nr<=It.maxTextureSize,"invalid texture shape"),(ht.wrapS!==Fr||ht.wrapT!==Fr)&&_(ts(br)&&ts(nr),"incompatible wrap mode for texture, both width and height must be power of 2"),St.mipmask===1?br!==1&&nr!==1&&_(ht.minFilter!==kn&&ht.minFilter!==Zn&&ht.minFilter!==ms&&ht.minFilter!==As,"min filter requires mipmap"):(_(ts(br)&&ts(nr),"texture must be a square power of 2 to support mipmapping"),_(St.mipmask===(br<<1)-1,"missing or incomplete mipmap data")),St.type===Ln&&(It.extensions.indexOf("oes_texture_float_linear")<0&&_(ht.minFilter===an&&ht.magFilter===an,"filter not supported, must enable oes_texture_float_linear"),_(!ht.genMipmaps,"mipmap generation not supported with float textures"));var Nr=St.images;for(ir=0;ir<16;++ir)if(Nr[ir]){var Or=br>>ir,Wr=nr>>ir;_(St.mipmask&1<<ir,"missing mipmap data");var qr=Nr[ir];if(_(qr.width===Or&&qr.height===Wr,"invalid shape for mip images"),_(qr.format===St.format&&qr.internalformat===St.internalformat&&qr.type===St.type,"incompatible type for mip image"),!qr.compressed)if(qr.data){var Xr=Math.ceil(is(qr.type,dr)*Or/qr.unpackAlignment)*qr.unpackAlignment;_(qr.data.byteLength===Xr*Wr,"invalid data for image, buffer size is inconsistent with image format")}else qr.element||qr.copy}else ht.genMipmaps||_((St.mipmask&1<<ir)===0,"extra mipmap data");St.compressed&&_(!ht.genMipmaps,"mipmap generation for compressed images not supported")}function Xs(ht,St,It,ir){var br=ht.width,nr=ht.height,dr=ht.channels;_(br>0&&br<=ir.maxTextureSize&&nr>0&&nr<=ir.maxTextureSize,"invalid texture shape"),_(br===nr,"cube map must be square"),_(St.wrapS===Fr&&St.wrapT===Fr,"wrap mode not supported by cube map");for(var Nr=0;Nr<It.length;++Nr){var Or=It[Nr];_(Or.width===br&&Or.height===nr,"inconsistent cube map face shape"),St.genMipmaps&&(_(!Or.compressed,"can not generate mipmap for compressed textures"),_(Or.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Wr=Or.images,qr=0;qr<16;++qr){var Xr=Wr[qr];if(Xr){var Jr=br>>qr,$r=nr>>qr;_(Or.mipmask&1<<qr,"missing mipmap data"),_(Xr.width===Jr&&Xr.height===$r,"invalid shape for mip images"),_(Xr.format===ht.format&&Xr.internalformat===ht.internalformat&&Xr.type===ht.type,"incompatible type for mip image"),Xr.compressed||(Xr.data?_(Xr.data.byteLength===Jr*$r*Math.max(is(Xr.type,dr),Xr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Xr.element||Xr.copy)}}}}var bt=o(_,{optional:cr,raise:g,commandRaise:sn,command:vr,parameter:_e,commandParameter:Zr,constructor:ft,type:rt,commandType:Hr,isTypedArray:et,nni:it,oneOf:ot,shaderError:mr,linkError:hr,callSite:at,saveCommandRef:Er,saveDrawInfo:Lr,framebufferFormat:lr,guessCommand:xt,texture2D:Qn,textureCube:Xs}),gs=0,xs=0,Ls=5,Ot=6;function _t(ht,St){this.id=gs++,this.type=ht,this.data=St}function Ir(ht){return ht.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function en(ht){if(ht.length===0)return[];var St=ht.charAt(0),It=ht.charAt(ht.length-1);if(ht.length>1&&St===It&&(St==='"'||St==="'"))return['"'+Ir(ht.substr(1,ht.length-2))+'"'];var ir=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(ht);if(ir)return en(ht.substr(0,ir.index)).concat(en(ir[1])).concat(en(ht.substr(ir.index+ir[0].length)));var br=ht.split(".");if(br.length===1)return['"'+Ir(ht)+'"'];for(var nr=[],dr=0;dr<br.length;++dr)nr=nr.concat(en(br[dr]));return nr}function ln(ht){return"["+en(ht).join("][")+"]"}function zn(ht,St){return new _t(ht,ln(St+""))}function jn(ht){return typeof ht=="function"&&!ht._reglType||ht instanceof _t}function ys(ht,St){if(typeof ht=="function")return new _t(xs,ht);if(typeof ht=="number"||typeof ht=="boolean")return new _t(Ls,ht);if(Array.isArray(ht))return new _t(Ot,ht.map(function(It,ir){return ys(It,St+"["+ir+"]")}));if(ht instanceof _t)return ht;bt(!1,"invalid option type in uniform "+St)}var Bn={DynamicVariable:_t,define:zn,isDynamic:jn,unbox:ys,accessor:ln},cs={next:typeof requestAnimationFrame=="function"?function(ht){return requestAnimationFrame(ht)}:function(ht){return setTimeout(ht,16)},cancel:typeof cancelAnimationFrame=="function"?function(ht){return cancelAnimationFrame(ht)}:clearTimeout},hs=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Ss(){var ht={"":0},St=[""];return{id:function(It){var ir=ht[It];return ir||(ir=ht[It]=St.length,St.push(It),ir)},str:function(It){return St[It]}}}function us(ht,St,It){var ir=document.createElement("canvas");o(ir.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),ht.appendChild(ir),ht===document.body&&(ir.style.position="absolute",o(ht.style,{margin:0,padding:0}));function br(){var Nr=window.innerWidth,Or=window.innerHeight;if(ht!==document.body){var Wr=ir.getBoundingClientRect();Nr=Wr.right-Wr.left,Or=Wr.bottom-Wr.top}ir.width=It*Nr,ir.height=It*Or}var nr;ht!==document.body&&typeof ResizeObserver=="function"?(nr=new ResizeObserver(function(){setTimeout(br)}),nr.observe(ht)):window.addEventListener("resize",br,!1);function dr(){nr?nr.disconnect():window.removeEventListener("resize",br),ht.removeChild(ir)}return br(),{canvas:ir,onDestroy:dr}}function Hs(ht,St){function It(ir){try{return ht.getContext(ir,St)}catch{return null}}return It("webgl")||It("experimental-webgl")||It("webgl-experimental")}function Ps(ht){return typeof ht.nodeName=="string"&&typeof ht.appendChild=="function"&&typeof ht.getBoundingClientRect=="function"}function Ns(ht){return typeof ht.drawArrays=="function"||typeof ht.drawElements=="function"}function wo(ht){return typeof ht=="string"?ht.split():(bt(Array.isArray(ht),"invalid extension array"),ht)}function Co(ht){return typeof ht=="string"?(bt(typeof document<"u","not supported outside of DOM"),document.querySelector(ht)):ht}function Jo(ht){var St=ht||{},It,ir,br,nr,dr={},Nr=[],Or=[],Wr=typeof window>"u"?1:window.devicePixelRatio,qr=!1,Xr=function(Ur){Ur&&bt.raise(Ur)},Jr=function(){};if(typeof St=="string"?(bt(typeof document<"u","selector queries only supported in DOM enviroments"),It=document.querySelector(St),bt(It,"invalid query string for element")):typeof St=="object"?Ps(St)?It=St:Ns(St)?(nr=St,br=nr.canvas):(bt.constructor(St),"gl"in St?nr=St.gl:"canvas"in St?br=Co(St.canvas):"container"in St&&(ir=Co(St.container)),"attributes"in St&&(dr=St.attributes,bt.type(dr,"object","invalid context attributes")),"extensions"in St&&(Nr=wo(St.extensions)),"optionalExtensions"in St&&(Or=wo(St.optionalExtensions)),"onDone"in St&&(bt.type(St.onDone,"function","invalid or missing onDone callback"),Xr=St.onDone),"profile"in St&&(qr=!!St.profile),"pixelRatio"in St&&(Wr=+St.pixelRatio,bt(Wr>0,"invalid pixel ratio"))):bt.raise("invalid arguments to regl"),It&&(It.nodeName.toLowerCase()==="canvas"?br=It:ir=It),!nr){if(!br){bt(typeof document<"u","must manually specify webgl context outside of DOM environments");var $r=us(ir||document.body,Xr,Wr);if(!$r)return null;br=$r.canvas,Jr=$r.onDestroy}dr.premultipliedAlpha===void 0&&(dr.premultipliedAlpha=!0),nr=Hs(br,dr)}return nr?{gl:nr,canvas:br,container:ir,extensions:Nr,optionalExtensions:Or,pixelRatio:Wr,profile:qr,onDone:Xr,onDestroy:Jr}:(Jr(),Xr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function na(ht,St){var It={};function ir(dr){bt.type(dr,"string","extension name must be string");var Nr=dr.toLowerCase(),Or;try{Or=It[Nr]=ht.getExtension(Nr)}catch{}return!!Or}for(var br=0;br<St.extensions.length;++br){var nr=St.extensions[br];if(!ir(nr))return St.onDestroy(),St.onDone('"'+nr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return St.optionalExtensions.forEach(ir),{extensions:It,restore:function(){Object.keys(It).forEach(function(dr){if(It[dr]&&!ir(dr))throw new Error("(regl): error restoring extension "+dr)})}}}function js(ht,St){for(var It=Array(ht),ir=0;ir<ht;++ir)It[ir]=St(ir);return It}var _u=5120,Po=5121,yu=5122,ga=5123,wu=5124,Eu=5125,Kl=5126;function Il(ht){for(var St=16;St<=1<<28;St*=16)if(ht<=St)return St;return 0}function ko(ht){var St,It;return St=(ht>65535)<<4,ht>>>=St,It=(ht>255)<<3,ht>>>=It,St|=It,It=(ht>15)<<2,ht>>>=It,St|=It,It=(ht>3)<<1,ht>>>=It,St|=It,St|ht>>1}function _a(){var ht=js(8,function(){return[]});function St(nr){var dr=Il(nr),Nr=ht[ko(dr)>>2];return Nr.length>0?Nr.pop():new ArrayBuffer(dr)}function It(nr){ht[ko(nr.byteLength)>>2].push(nr)}function ir(nr,dr){var Nr=null;switch(nr){case _u:Nr=new Int8Array(St(dr),0,dr);break;case Po:Nr=new Uint8Array(St(dr),0,dr);break;case yu:Nr=new Int16Array(St(2*dr),0,dr);break;case ga:Nr=new Uint16Array(St(2*dr),0,dr);break;case wu:Nr=new Int32Array(St(4*dr),0,dr);break;case Eu:Nr=new Uint32Array(St(4*dr),0,dr);break;case Kl:Nr=new Float32Array(St(4*dr),0,dr);break;default:return null}return Nr.length!==dr?Nr.subarray(0,dr):Nr}function br(nr){It(nr.buffer)}return{alloc:St,free:It,allocType:ir,freeType:br}}var ks=_a();ks.zero=_a();var Ol=3408,Cl=3410,Nl=3411,nu=3412,Fl=3413,Mo=3414,Eo=3415,Ho=33901,bo=33902,$l=3379,Zl=3386,bu=34921,ba=36347,go=36348,Fo=35661,xo=35660,Ao=34930,jo=36349,So=34076,Bs=34024,Do=7936,Al=7937,$o=7938,_s=35724,Io=34047,xa=36063,Wo=34852,Bo=3553,Bl=34067,$a=34069,Ms=33984,Xo=6408,Oo=5126,Yo=5121,zl=36160,qo=36053,zo=36064,Et=16384,Rt=function(ht,St){var It=1;St.ext_texture_filter_anisotropic&&(It=ht.getParameter(Io));var ir=1,br=1;St.webgl_draw_buffers&&(ir=ht.getParameter(Wo),br=ht.getParameter(xa));var nr=!!St.oes_texture_float;if(nr){var dr=ht.createTexture();ht.bindTexture(Bo,dr),ht.texImage2D(Bo,0,Xo,1,1,0,Xo,Oo,null);var Nr=ht.createFramebuffer();if(ht.bindFramebuffer(zl,Nr),ht.framebufferTexture2D(zl,zo,Bo,dr,0),ht.bindTexture(Bo,null),ht.checkFramebufferStatus(zl)!==qo)nr=!1;else{ht.viewport(0,0,1,1),ht.clearColor(1,0,0,1),ht.clear(Et);var Or=ks.allocType(Oo,4);ht.readPixels(0,0,1,1,Xo,Oo,Or),ht.getError()?nr=!1:(ht.deleteFramebuffer(Nr),ht.deleteTexture(dr),nr=Or[0]===1),ks.freeType(Or)}}var Wr=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),qr=!0;if(!Wr){var Xr=ht.createTexture(),Jr=ks.allocType(Yo,36);ht.activeTexture(Ms),ht.bindTexture(Bl,Xr),ht.texImage2D($a,0,Xo,3,3,0,Xo,Yo,Jr),ks.freeType(Jr),ht.bindTexture(Bl,null),ht.deleteTexture(Xr),qr=!ht.getError()}return{colorBits:[ht.getParameter(Cl),ht.getParameter(Nl),ht.getParameter(nu),ht.getParameter(Fl)],depthBits:ht.getParameter(Mo),stencilBits:ht.getParameter(Eo),subpixelBits:ht.getParameter(Ol),extensions:Object.keys(St).filter(function($r){return!!St[$r]}),maxAnisotropic:It,maxDrawbuffers:ir,maxColorAttachments:br,pointSizeDims:ht.getParameter(Ho),lineWidthDims:ht.getParameter(bo),maxViewportDims:ht.getParameter(Zl),maxCombinedTextureUnits:ht.getParameter(Fo),maxCubeMapSize:ht.getParameter(So),maxRenderbufferSize:ht.getParameter(Bs),maxTextureUnits:ht.getParameter(Ao),maxTextureSize:ht.getParameter($l),maxAttributes:ht.getParameter(bu),maxVertexUniforms:ht.getParameter(ba),maxVertexTextureUnits:ht.getParameter(xo),maxVaryingVectors:ht.getParameter(go),maxFragmentUniforms:ht.getParameter(jo),glsl:ht.getParameter(_s),renderer:ht.getParameter(Al),vendor:ht.getParameter(Do),version:ht.getParameter($o),readFloat:nr,npotTextureCube:qr}};function Ft(ht){return!!ht&&typeof ht=="object"&&Array.isArray(ht.shape)&&Array.isArray(ht.stride)&&typeof ht.offset=="number"&&ht.shape.length===ht.stride.length&&(Array.isArray(ht.data)||s(ht.data))}var or=function(ht){return Object.keys(ht).map(function(St){return ht[St]})},Gr={shape:fn,flatten:kr};function Sn(ht,St,It){for(var ir=0;ir<St;++ir)It[ir]=ht[ir]}function Dt(ht,St,It,ir){for(var br=0,nr=0;nr<St;++nr)for(var dr=ht[nr],Nr=0;Nr<It;++Nr)ir[br++]=dr[Nr]}function Wt(ht,St,It,ir,br,nr){for(var dr=nr,Nr=0;Nr<St;++Nr)for(var Or=ht[Nr],Wr=0;Wr<It;++Wr)for(var qr=Or[Wr],Xr=0;Xr<ir;++Xr)br[dr++]=qr[Xr]}function rr(ht,St,It,ir,br){for(var nr=1,dr=It+1;dr<St.length;++dr)nr*=St[dr];var Nr=St[It];if(St.length-It===4){var Or=St[It+1],Wr=St[It+2],qr=St[It+3];for(dr=0;dr<Nr;++dr)Wt(ht[dr],Or,Wr,qr,ir,br),br+=nr}else for(dr=0;dr<Nr;++dr)rr(ht[dr],St,It+1,ir,br),br+=nr}function kr(ht,St,It,ir){var br=1;if(St.length)for(var nr=0;nr<St.length;++nr)br*=St[nr];else br=0;var dr=ir||ks.allocType(It,br);switch(St.length){case 0:break;case 1:Sn(ht,St[0],dr);break;case 2:Dt(ht,St[0],St[1],dr);break;case 3:Wt(ht,St[0],St[1],St[2],dr,0);break;default:rr(ht,St,0,dr,0)}return dr}function fn(ht){for(var St=[],It=ht;It.length;It=It[0])St.push(It.length);return St}var _n={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Jn=5120,Mn=5122,$s=5124,Ds=5121,Us=5123,Gs=5125,Ts=5126,Ys=5126,zs={int8:Jn,int16:Mn,int32:$s,uint8:Ds,uint16:Us,uint32:Gs,float:Ts,float32:Ys},Zs=35048,Qs=35040,Rl={dynamic:Zs,stream:Qs,static:35044},Vl=Gr.flatten,Ul=Gr.shape,xu=35044,Su=35040,iu=5121,_l=5126,Ll=[];Ll[5120]=1,Ll[5122]=2,Ll[5124]=4,Ll[5121]=1,Ll[5123]=2,Ll[5125]=4,Ll[5126]=4;function su(ht){return _n[Object.prototype.toString.call(ht)]|0}function bp(ht,St){for(var It=0;It<St.length;++It)ht[It]=St[It]}function xp(ht,St,It,ir,br,nr,dr){for(var Nr=0,Or=0;Or<It;++Or)for(var Wr=0;Wr<ir;++Wr)ht[Nr++]=St[br*Or+nr*Wr+dr]}function Kp(ht,St,It,ir){var br=0,nr={};function dr(qt){this.id=br++,this.buffer=ht.createBuffer(),this.type=qt,this.usage=xu,this.byteLength=0,this.dimension=1,this.dtype=iu,this.persistentData=null,It.profile&&(this.stats={size:0})}dr.prototype.bind=function(){ht.bindBuffer(this.type,this.buffer)},dr.prototype.destroy=function(){Jr(this)};var Nr=[];function Or(qt,ur){var zr=Nr.pop();return zr||(zr=new dr(qt)),zr.bind(),Xr(zr,ur,Su,0,1,!1),zr}function Wr(qt){Nr.push(qt)}function qr(qt,ur,zr){qt.byteLength=ur.byteLength,ht.bufferData(qt.type,ur,zr)}function Xr(qt,ur,zr,gn,Rr,hn){var cn;if(qt.usage=zr,Array.isArray(ur)){if(qt.dtype=gn||_l,ur.length>0){var Pn;if(Array.isArray(ur[0])){cn=Ul(ur);for(var Sr=1,wr=1;wr<cn.length;++wr)Sr*=cn[wr];qt.dimension=Sr,Pn=Vl(ur,cn,qt.dtype),qr(qt,Pn,zr),hn?qt.persistentData=Pn:ks.freeType(Pn)}else if(typeof ur[0]=="number"){qt.dimension=Rr;var bn=ks.allocType(qt.dtype,ur.length);bp(bn,ur),qr(qt,bn,zr),hn?qt.persistentData=bn:ks.freeType(bn)}else s(ur[0])?(qt.dimension=ur[0].length,qt.dtype=gn||su(ur[0])||_l,Pn=Vl(ur,[ur.length,ur[0].length],qt.dtype),qr(qt,Pn,zr),hn?qt.persistentData=Pn:ks.freeType(Pn)):bt.raise("invalid buffer data")}}else if(s(ur))qt.dtype=gn||su(ur),qt.dimension=Rr,qr(qt,ur,zr),hn&&(qt.persistentData=new Uint8Array(new Uint8Array(ur.buffer)));else if(Ft(ur)){cn=ur.shape;var tn=ur.stride,Br=ur.offset,rn=0,on=0,Wn=0,Un=0;cn.length===1?(rn=cn[0],on=1,Wn=tn[0],Un=0):cn.length===2?(rn=cn[0],on=cn[1],Wn=tn[0],Un=tn[1]):bt.raise("invalid shape"),qt.dtype=gn||su(ur.data)||_l,qt.dimension=on;var un=ks.allocType(qt.dtype,rn*on);xp(un,ur.data,rn,on,Wn,Un,Br),qr(qt,un,zr),hn?qt.persistentData=un:ks.freeType(un)}else ur instanceof ArrayBuffer?(qt.dtype=iu,qt.dimension=Rr,qr(qt,ur,zr),hn&&(qt.persistentData=new Uint8Array(new Uint8Array(ur)))):bt.raise("invalid buffer data")}function Jr(qt){St.bufferCount--,ir(qt);var ur=qt.buffer;bt(ur,"buffer must not be deleted already"),ht.deleteBuffer(ur),qt.buffer=null,delete nr[qt.id]}function $r(qt,ur,zr,gn){St.bufferCount++;var Rr=new dr(ur);nr[Rr.id]=Rr;function hn(Sr){var wr=xu,bn=null,tn=0,Br=0,rn=1;return Array.isArray(Sr)||s(Sr)||Ft(Sr)||Sr instanceof ArrayBuffer?bn=Sr:typeof Sr=="number"?tn=Sr|0:Sr&&(bt.type(Sr,"object","buffer arguments must be an object, a number or an array"),"data"in Sr&&(bt(bn===null||Array.isArray(bn)||s(bn)||Ft(bn),"invalid data for buffer"),bn=Sr.data),"usage"in Sr&&(bt.parameter(Sr.usage,Rl,"invalid buffer usage"),wr=Rl[Sr.usage]),"type"in Sr&&(bt.parameter(Sr.type,zs,"invalid buffer type"),Br=zs[Sr.type]),"dimension"in Sr&&(bt.type(Sr.dimension,"number","invalid dimension"),rn=Sr.dimension|0),"length"in Sr&&(bt.nni(tn,"buffer length must be a nonnegative integer"),tn=Sr.length|0)),Rr.bind(),bn?Xr(Rr,bn,wr,Br,rn,gn):(tn&&ht.bufferData(Rr.type,tn,wr),Rr.dtype=Br||iu,Rr.usage=wr,Rr.dimension=rn,Rr.byteLength=tn),It.profile&&(Rr.stats.size=Rr.byteLength*Ll[Rr.dtype]),hn}function cn(Sr,wr){bt(wr+Sr.byteLength<=Rr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Sr.byteLength+" starting from offset "+wr+" to a buffer of size "+Rr.byteLength),ht.bufferSubData(Rr.type,wr,Sr)}function Pn(Sr,wr){var bn=(wr||0)|0,tn;if(Rr.bind(),s(Sr)||Sr instanceof ArrayBuffer)cn(Sr,bn);else if(Array.isArray(Sr)){if(Sr.length>0)if(typeof Sr[0]=="number"){var Br=ks.allocType(Rr.dtype,Sr.length);bp(Br,Sr),cn(Br,bn),ks.freeType(Br)}else if(Array.isArray(Sr[0])||s(Sr[0])){tn=Ul(Sr);var rn=Vl(Sr,tn,Rr.dtype);cn(rn,bn),ks.freeType(rn)}else bt.raise("invalid buffer data")}else if(Ft(Sr)){tn=Sr.shape;var on=Sr.stride,Wn=0,Un=0,un=0,pn=0;tn.length===1?(Wn=tn[0],Un=1,un=on[0],pn=0):tn.length===2?(Wn=tn[0],Un=tn[1],un=on[0],pn=on[1]):bt.raise("invalid shape");var On=Array.isArray(Sr.data)?Rr.dtype:su(Sr.data),Xn=ks.allocType(On,Wn*Un);xp(Xn,Sr.data,Wn,Un,un,pn,Sr.offset),cn(Xn,bn),ks.freeType(Xn)}else bt.raise("invalid data for buffer subdata");return hn}return zr||hn(qt),hn._reglType="buffer",hn._buffer=Rr,hn.subdata=Pn,It.profile&&(hn.stats=Rr.stats),hn.destroy=function(){Jr(Rr)},hn}function Ur(){or(nr).forEach(function(qt){qt.buffer=ht.createBuffer(),ht.bindBuffer(qt.type,qt.buffer),ht.bufferData(qt.type,qt.persistentData||qt.byteLength,qt.usage)})}return It.profile&&(St.getTotalBufferSize=function(){var qt=0;return Object.keys(nr).forEach(function(ur){qt+=nr[ur].stats.size}),qt}),{create:$r,createStream:Or,destroyStream:Wr,clear:function(){or(nr).forEach(Jr),Nr.forEach(Jr)},getBuffer:function(qt){return qt&&qt._buffer instanceof dr?qt._buffer:null},restore:Ur,_initBuffer:Xr}}var nt=0,st=0,lt=1,ut=1,mt=4,vt=4,yt={points:nt,point:st,lines:lt,line:ut,triangles:mt,triangle:vt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Gt=0,$t=1,Qt=4,_r=5120,jr=5121,fr=5122,Cr=5123,Fn=5124,Kn=5125,In=34963,oo=35040,to=35044;function No(ht,St,It,ir){var br={},nr=0,dr={uint8:jr,uint16:Cr};St.oes_element_index_uint&&(dr.uint32=Kn);function Nr(Ur){this.id=nr++,br[this.id]=this,this.buffer=Ur,this.primType=Qt,this.vertCount=0,this.type=0}Nr.prototype.bind=function(){this.buffer.bind()};var Or=[];function Wr(Ur){var qt=Or.pop();return qt||(qt=new Nr(It.create(null,In,!0,!1)._buffer)),Xr(qt,Ur,oo,-1,-1,0,0),qt}function qr(Ur){Or.push(Ur)}function Xr(Ur,qt,ur,zr,gn,Rr,hn){Ur.buffer.bind();var cn;if(qt){var Pn=hn;!hn&&(!s(qt)||Ft(qt)&&!s(qt.data))&&(Pn=St.oes_element_index_uint?Kn:Cr),It._initBuffer(Ur.buffer,qt,ur,Pn,3)}else ht.bufferData(In,Rr,ur),Ur.buffer.dtype=cn||jr,Ur.buffer.usage=ur,Ur.buffer.dimension=3,Ur.buffer.byteLength=Rr;if(cn=hn,!hn){switch(Ur.buffer.dtype){case jr:case _r:cn=jr;break;case Cr:case fr:cn=Cr;break;case Kn:case Fn:cn=Kn;break;default:bt.raise("unsupported type for element array")}Ur.buffer.dtype=cn}Ur.type=cn,bt(cn!==Kn||!!St.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Sr=gn;Sr<0&&(Sr=Ur.buffer.byteLength,cn===Cr?Sr>>=1:cn===Kn&&(Sr>>=2)),Ur.vertCount=Sr;var wr=zr;if(zr<0){wr=Qt;var bn=Ur.buffer.dimension;bn===1&&(wr=Gt),bn===2&&(wr=$t),bn===3&&(wr=Qt)}Ur.primType=wr}function Jr(Ur){ir.elementsCount--,bt(Ur.buffer!==null,"must not double destroy elements"),delete br[Ur.id],Ur.buffer.destroy(),Ur.buffer=null}function $r(Ur,qt){var ur=It.create(null,In,!0),zr=new Nr(ur._buffer);ir.elementsCount++;function gn(Rr){if(!Rr)ur(),zr.primType=Qt,zr.vertCount=0,zr.type=jr;else if(typeof Rr=="number")ur(Rr),zr.primType=Qt,zr.vertCount=Rr|0,zr.type=jr;else{var hn=null,cn=to,Pn=-1,Sr=-1,wr=0,bn=0;Array.isArray(Rr)||s(Rr)||Ft(Rr)?hn=Rr:(bt.type(Rr,"object","invalid arguments for elements"),"data"in Rr&&(hn=Rr.data,bt(Array.isArray(hn)||s(hn)||Ft(hn),"invalid data for element buffer")),"usage"in Rr&&(bt.parameter(Rr.usage,Rl,"invalid element buffer usage"),cn=Rl[Rr.usage]),"primitive"in Rr&&(bt.parameter(Rr.primitive,yt,"invalid element buffer primitive"),Pn=yt[Rr.primitive]),"count"in Rr&&(bt(typeof Rr.count=="number"&&Rr.count>=0,"invalid vertex count for elements"),Sr=Rr.count|0),"type"in Rr&&(bt.parameter(Rr.type,dr,"invalid buffer type"),bn=dr[Rr.type]),"length"in Rr?wr=Rr.length|0:(wr=Sr,bn===Cr||bn===fr?wr*=2:(bn===Kn||bn===Fn)&&(wr*=4))),Xr(zr,hn,cn,Pn,Sr,wr,bn)}return gn}return gn(Ur),gn._reglType="elements",gn._elements=zr,gn.subdata=function(Rr,hn){return ur.subdata(Rr,hn),gn},gn.destroy=function(){Jr(zr)},gn}return{create:$r,createStream:Wr,destroyStream:qr,getElements:function(Ur){return typeof Ur=="function"&&Ur._elements instanceof Nr?Ur._elements:null},clear:function(){or(br).forEach(Jr)}}}var Is=new Float32Array(1),rs=new Uint32Array(Is.buffer),Ro=5123;function ws(ht){for(var St=ks.allocType(Ro,ht.length),It=0;It<ht.length;++It)if(isNaN(ht[It]))St[It]=65535;else if(ht[It]===1/0)St[It]=31744;else if(ht[It]===-1/0)St[It]=64512;else{Is[0]=ht[It];var ir=rs[0],br=ir>>>31<<15,nr=(ir<<1>>>24)-127,dr=ir>>13&(1<<10)-1;if(nr<-24)St[It]=br;else if(nr<-14){var Nr=-14-nr;St[It]=br+(dr+(1<<10)>>Nr)}else nr>15?St[It]=br+31744:St[It]=br+(nr+15<<10)+dr}return St}function _i(ht){return Array.isArray(ht)||s(ht)}var ou=function(ht){return!(ht&ht-1)&&!!ht},zu=34467,Ks=3553,Pl=34067,yl=34069,ro=6408,El=6406,To=6407,Vo=6409,Tu=6410,Gl=32854,Cu=32855,Cs=36194,Ql=32819,Sp=32820,_d=33635,Zp=34042,au=6402,Vu=34041,Uu=35904,_h=35906,lu=36193,ep=33776,cu=33777,tp=33778,rp=33779,Tp=35986,uu=35987,Cp=34798,Gu=35840,xl=35841,Sl=35842,np=35843,ip=36196,Jl=5121,sp=5123,Os=5125,Hl=5126,Ko=10242,Zo=10243,op=10497,Hu=33071,Qp=33648,Jp=10240,Ap=10241,Ml=9728,ap=9729,ju=9984,Au=9985,Ru=9986,Lu=9987,_g=33170,_c=4352,lp=4353,cp=4354,em=34046,Tt=3317,zt=37440,Xt=37441,Pr=37443,er=37444,Dr=33984,Kr=[ju,Ru,Au,Lu],yn=[0,Vo,Tu,To,ro],vn={};vn[Vo]=vn[El]=vn[au]=1,vn[Vu]=vn[Tu]=2,vn[To]=vn[Uu]=3,vn[ro]=vn[_h]=4;function Vn(ht){return"[object "+ht+"]"}var Hn=Vn("HTMLCanvasElement"),qn=Vn("OffscreenCanvas"),ds=Vn("CanvasRenderingContext2D"),Fs=Vn("ImageBitmap"),Yn=Vn("HTMLImageElement"),no=Vn("HTMLVideoElement"),mo=Object.keys(_n).concat([Hn,qn,ds,Fs,Yn,no]),fo=[];fo[Jl]=1,fo[Hl]=4,fo[lu]=2,fo[sp]=2,fo[Os]=4;var ls=[];ls[Gl]=2,ls[Cu]=2,ls[Cs]=2,ls[Vu]=4,ls[ep]=.5,ls[cu]=.5,ls[tp]=1,ls[rp]=1,ls[Tp]=.5,ls[uu]=1,ls[Cp]=1,ls[Gu]=.5,ls[xl]=.25,ls[Sl]=.5,ls[np]=.25,ls[ip]=.5;function fu(ht){return Array.isArray(ht)&&(ht.length===0||typeof ht[0]=="number")}function du(ht){if(!Array.isArray(ht))return!1;var St=ht.length;return!(St===0||!_i(ht[0]))}function ao(ht){return Object.prototype.toString.call(ht)}function Rm(ht){return ao(ht)===Hn}function Lm(ht){return ao(ht)===qn}function $v(ht){return ao(ht)===ds}function Bv(ht){return ao(ht)===Fs}function zv(ht){return ao(ht)===Yn}function Vv(ht){return ao(ht)===no}function tm(ht){if(!ht)return!1;var St=ao(ht);return mo.indexOf(St)>=0?!0:fu(ht)||du(ht)||Ft(ht)}function Pm(ht){return _n[Object.prototype.toString.call(ht)]|0}function Uv(ht,St){var It=St.length;switch(ht.type){case Jl:case sp:case Os:case Hl:var ir=ks.allocType(ht.type,It);ir.set(St),ht.data=ir;break;case lu:ht.data=ws(St);break;default:bt.raise("unsupported texture type, must specify a typed array")}}function km(ht,St){return ks.allocType(ht.type===lu?Hl:ht.type,St)}function Mm(ht,St){ht.type===lu?(ht.data=ws(St),ks.freeType(St)):ht.data=St}function Gv(ht,St,It,ir,br,nr){for(var dr=ht.width,Nr=ht.height,Or=ht.channels,Wr=dr*Nr*Or,qr=km(ht,Wr),Xr=0,Jr=0;Jr<Nr;++Jr)for(var $r=0;$r<dr;++$r)for(var Ur=0;Ur<Or;++Ur)qr[Xr++]=St[It*$r+ir*Jr+br*Ur+nr];Mm(ht,qr)}function Rp(ht,St,It,ir,br,nr){var dr;if(typeof ls[ht]<"u"?dr=ls[ht]:dr=vn[ht]*fo[St],nr&&(dr*=6),br){for(var Nr=0,Or=It;Or>=1;)Nr+=dr*Or*Or,Or/=2;return Nr}else return dr*It*ir}function Hv(ht,St,It,ir,br,nr,dr){var Nr={"don't care":_c,"dont care":_c,nice:cp,fast:lp},Or={repeat:op,clamp:Hu,mirror:Qp},Wr={nearest:Ml,linear:ap},qr=o({mipmap:Lu,"nearest mipmap nearest":ju,"linear mipmap nearest":Au,"nearest mipmap linear":Ru,"linear mipmap linear":Lu},Wr),Xr={none:0,browser:er},Jr={uint8:Jl,rgba4:Ql,rgb565:_d,"rgb5 a1":Sp},$r={alpha:El,luminance:Vo,"luminance alpha":Tu,rgb:To,rgba:ro,rgba4:Gl,"rgb5 a1":Cu,rgb565:Cs},Ur={};St.ext_srgb&&($r.srgb=Uu,$r.srgba=_h),St.oes_texture_float&&(Jr.float32=Jr.float=Hl),St.oes_texture_half_float&&(Jr.float16=Jr["half float"]=lu),St.webgl_depth_texture&&(o($r,{depth:au,"depth stencil":Vu}),o(Jr,{uint16:sp,uint32:Os,"depth stencil":Zp})),St.webgl_compressed_texture_s3tc&&o(Ur,{"rgb s3tc dxt1":ep,"rgba s3tc dxt1":cu,"rgba s3tc dxt3":tp,"rgba s3tc dxt5":rp}),St.webgl_compressed_texture_atc&&o(Ur,{"rgb atc":Tp,"rgba atc explicit alpha":uu,"rgba atc interpolated alpha":Cp}),St.webgl_compressed_texture_pvrtc&&o(Ur,{"rgb pvrtc 4bppv1":Gu,"rgb pvrtc 2bppv1":xl,"rgba pvrtc 4bppv1":Sl,"rgba pvrtc 2bppv1":np}),St.webgl_compressed_texture_etc1&&(Ur["rgb etc1"]=ip);var qt=Array.prototype.slice.call(ht.getParameter(zu));Object.keys(Ur).forEach(function(kt){var ar=Ur[kt];qt.indexOf(ar)>=0&&($r[kt]=ar)});var ur=Object.keys($r);It.textureFormats=ur;var zr=[];Object.keys($r).forEach(function(kt){var ar=$r[kt];zr[ar]=kt});var gn=[];Object.keys(Jr).forEach(function(kt){var ar=Jr[kt];gn[ar]=kt});var Rr=[];Object.keys(Wr).forEach(function(kt){var ar=Wr[kt];Rr[ar]=kt});var hn=[];Object.keys(qr).forEach(function(kt){var ar=qr[kt];hn[ar]=kt});var cn=[];Object.keys(Or).forEach(function(kt){var ar=Or[kt];cn[ar]=kt});var Pn=ur.reduce(function(kt,ar){var tr=$r[ar];return tr===Vo||tr===El||tr===Vo||tr===Tu||tr===au||tr===Vu||St.ext_srgb&&(tr===Uu||tr===_h)?kt[tr]=tr:tr===Cu||ar.indexOf("rgba")>=0?kt[tr]=ro:kt[tr]=To,kt},{});function Sr(){this.internalformat=ro,this.format=ro,this.type=Jl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=er,this.width=0,this.height=0,this.channels=0}function wr(kt,ar){kt.internalformat=ar.internalformat,kt.format=ar.format,kt.type=ar.type,kt.compressed=ar.compressed,kt.premultiplyAlpha=ar.premultiplyAlpha,kt.flipY=ar.flipY,kt.unpackAlignment=ar.unpackAlignment,kt.colorSpace=ar.colorSpace,kt.width=ar.width,kt.height=ar.height,kt.channels=ar.channels}function bn(kt,ar){if(!(typeof ar!="object"||!ar)){if("premultiplyAlpha"in ar&&(bt.type(ar.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),kt.premultiplyAlpha=ar.premultiplyAlpha),"flipY"in ar&&(bt.type(ar.flipY,"boolean","invalid texture flip"),kt.flipY=ar.flipY),"alignment"in ar&&(bt.oneOf(ar.alignment,[1,2,4,8],"invalid texture unpack alignment"),kt.unpackAlignment=ar.alignment),"colorSpace"in ar&&(bt.parameter(ar.colorSpace,Xr,"invalid colorSpace"),kt.colorSpace=Xr[ar.colorSpace]),"type"in ar){var tr=ar.type;bt(St.oes_texture_float||!(tr==="float"||tr==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),bt(St.oes_texture_half_float||!(tr==="half float"||tr==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),bt(St.webgl_depth_texture||!(tr==="uint16"||tr==="uint32"||tr==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),bt.parameter(tr,Jr,"invalid texture type"),kt.type=Jr[tr]}var En=kt.width,ns=kt.height,At=kt.channels,wt=!1;"shape"in ar?(bt(Array.isArray(ar.shape)&&ar.shape.length>=2,"shape must be an array"),En=ar.shape[0],ns=ar.shape[1],ar.shape.length===3&&(At=ar.shape[2],bt(At>0&&At<=4,"invalid number of channels"),wt=!0),bt(En>=0&&En<=It.maxTextureSize,"invalid width"),bt(ns>=0&&ns<=It.maxTextureSize,"invalid height")):("radius"in ar&&(En=ns=ar.radius,bt(En>=0&&En<=It.maxTextureSize,"invalid radius")),"width"in ar&&(En=ar.width,bt(En>=0&&En<=It.maxTextureSize,"invalid width")),"height"in ar&&(ns=ar.height,bt(ns>=0&&ns<=It.maxTextureSize,"invalid height")),"channels"in ar&&(At=ar.channels,bt(At>0&&At<=4,"invalid number of channels"),wt=!0)),kt.width=En|0,kt.height=ns|0,kt.channels=At|0;var Nt=!1;if("format"in ar){var Yt=ar.format;bt(St.webgl_depth_texture||!(Yt==="depth"||Yt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),bt.parameter(Yt,$r,"invalid texture format");var Kt=kt.internalformat=$r[Yt];kt.format=Pn[Kt],Yt in Jr&&("type"in ar||(kt.type=Jr[Yt])),Yt in Ur&&(kt.compressed=!0),Nt=!0}!wt&&Nt?kt.channels=vn[kt.format]:wt&&!Nt?kt.channels!==yn[kt.format]&&(kt.format=kt.internalformat=yn[kt.channels]):Nt&&wt&&bt(kt.channels===vn[kt.format],"number of channels inconsistent with specified format")}}function tn(kt){ht.pixelStorei(zt,kt.flipY),ht.pixelStorei(Xt,kt.premultiplyAlpha),ht.pixelStorei(Pr,kt.colorSpace),ht.pixelStorei(Tt,kt.unpackAlignment)}function Br(){Sr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function rn(kt,ar){var tr=null;if(tm(ar)?tr=ar:ar&&(bt.type(ar,"object","invalid pixel data type"),bn(kt,ar),"x"in ar&&(kt.xOffset=ar.x|0),"y"in ar&&(kt.yOffset=ar.y|0),tm(ar.data)&&(tr=ar.data)),bt(!kt.compressed||tr instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ar.copy){bt(!tr,"can not specify copy and data field for the same texture");var En=br.viewportWidth,ns=br.viewportHeight;kt.width=kt.width||En-kt.xOffset,kt.height=kt.height||ns-kt.yOffset,kt.needsCopy=!0,bt(kt.xOffset>=0&&kt.xOffset<En&&kt.yOffset>=0&&kt.yOffset<ns&&kt.width>0&&kt.width<=En&&kt.height>0&&kt.height<=ns,"copy texture read out of bounds")}else if(!tr)kt.width=kt.width||1,kt.height=kt.height||1,kt.channels=kt.channels||4;else if(s(tr))kt.channels=kt.channels||4,kt.data=tr,!("type"in ar)&&kt.type===Jl&&(kt.type=Pm(tr));else if(fu(tr))kt.channels=kt.channels||4,Uv(kt,tr),kt.alignment=1,kt.needsFree=!0;else if(Ft(tr)){var At=tr.data;!Array.isArray(At)&&kt.type===Jl&&(kt.type=Pm(At));var wt=tr.shape,Nt=tr.stride,Yt,Kt,Ut,Vt,jt,Lt;wt.length===3?(Ut=wt[2],Lt=Nt[2]):(bt(wt.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ut=1,Lt=1),Yt=wt[0],Kt=wt[1],Vt=Nt[0],jt=Nt[1],kt.alignment=1,kt.width=Yt,kt.height=Kt,kt.channels=Ut,kt.format=kt.internalformat=yn[Ut],kt.needsFree=!0,Gv(kt,At,Vt,jt,Lt,tr.offset)}else if(Rm(tr)||Lm(tr)||$v(tr))Rm(tr)||Lm(tr)?kt.element=tr:kt.element=tr.canvas,kt.width=kt.element.width,kt.height=kt.element.height,kt.channels=4;else if(Bv(tr))kt.element=tr,kt.width=tr.width,kt.height=tr.height,kt.channels=4;else if(zv(tr))kt.element=tr,kt.width=tr.naturalWidth,kt.height=tr.naturalHeight,kt.channels=4;else if(Vv(tr))kt.element=tr,kt.width=tr.videoWidth,kt.height=tr.videoHeight,kt.channels=4;else if(du(tr)){var Mt=kt.width||tr[0].length,Pt=kt.height||tr.length,Jt=kt.channels;_i(tr[0][0])?Jt=Jt||tr[0][0].length:Jt=Jt||1;for(var Zt=Gr.shape(tr),yr=1,Tr=0;Tr<Zt.length;++Tr)yr*=Zt[Tr];var Qr=km(kt,yr);Gr.flatten(tr,Zt,"",Qr),Mm(kt,Qr),kt.alignment=1,kt.width=Mt,kt.height=Pt,kt.channels=Jt,kt.format=kt.internalformat=yn[Jt],kt.needsFree=!0}kt.type===Hl?bt(It.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):kt.type===lu&&bt(It.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function on(kt,ar,tr){var En=kt.element,ns=kt.data,At=kt.internalformat,wt=kt.format,Nt=kt.type,Yt=kt.width,Kt=kt.height;tn(kt),En?ht.texImage2D(ar,tr,wt,wt,Nt,En):kt.compressed?ht.compressedTexImage2D(ar,tr,At,Yt,Kt,0,ns):kt.needsCopy?(ir(),ht.copyTexImage2D(ar,tr,wt,kt.xOffset,kt.yOffset,Yt,Kt,0)):ht.texImage2D(ar,tr,wt,Yt,Kt,0,wt,Nt,ns||null)}function Wn(kt,ar,tr,En,ns){var At=kt.element,wt=kt.data,Nt=kt.internalformat,Yt=kt.format,Kt=kt.type,Ut=kt.width,Vt=kt.height;tn(kt),At?ht.texSubImage2D(ar,ns,tr,En,Yt,Kt,At):kt.compressed?ht.compressedTexSubImage2D(ar,ns,tr,En,Nt,Ut,Vt,wt):kt.needsCopy?(ir(),ht.copyTexSubImage2D(ar,ns,tr,En,kt.xOffset,kt.yOffset,Ut,Vt)):ht.texSubImage2D(ar,ns,tr,En,Ut,Vt,Yt,Kt,wt)}var Un=[];function un(){return Un.pop()||new Br}function pn(kt){kt.needsFree&&ks.freeType(kt.data),Br.call(kt),Un.push(kt)}function On(){Sr.call(this),this.genMipmaps=!1,this.mipmapHint=_c,this.mipmask=0,this.images=Array(16)}function Xn(kt,ar,tr){var En=kt.images[0]=un();kt.mipmask=1,En.width=kt.width=ar,En.height=kt.height=tr,En.channels=kt.channels=4}function ss(kt,ar){var tr=null;if(tm(ar))tr=kt.images[0]=un(),wr(tr,kt),rn(tr,ar),kt.mipmask=1;else if(bn(kt,ar),Array.isArray(ar.mipmap))for(var En=ar.mipmap,ns=0;ns<En.length;++ns)tr=kt.images[ns]=un(),wr(tr,kt),tr.width>>=ns,tr.height>>=ns,rn(tr,En[ns]),kt.mipmask|=1<<ns;else tr=kt.images[0]=un(),wr(tr,kt),rn(tr,ar),kt.mipmask=1;wr(kt,kt.images[0]),kt.compressed&&(kt.internalformat===ep||kt.internalformat===cu||kt.internalformat===tp||kt.internalformat===rp)&&bt(kt.width%4===0&&kt.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ws(kt,ar){for(var tr=kt.images,En=0;En<tr.length;++En){if(!tr[En])return;on(tr[En],ar,En)}}var qs=[];function as(){var kt=qs.pop()||new On;Sr.call(kt),kt.mipmask=0;for(var ar=0;ar<16;++ar)kt.images[ar]=null;return kt}function lo(kt){for(var ar=kt.images,tr=0;tr<ar.length;++tr)ar[tr]&&pn(ar[tr]),ar[tr]=null;qs.push(kt)}function Vs(){this.minFilter=Ml,this.magFilter=Ml,this.wrapS=Hu,this.wrapT=Hu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=_c}function so(kt,ar){if("min"in ar){var tr=ar.min;bt.parameter(tr,qr),kt.minFilter=qr[tr],Kr.indexOf(kt.minFilter)>=0&&!("faces"in ar)&&(kt.genMipmaps=!0)}if("mag"in ar){var En=ar.mag;bt.parameter(En,Wr),kt.magFilter=Wr[En]}var ns=kt.wrapS,At=kt.wrapT;if("wrap"in ar){var wt=ar.wrap;typeof wt=="string"?(bt.parameter(wt,Or),ns=At=Or[wt]):Array.isArray(wt)&&(bt.parameter(wt[0],Or),bt.parameter(wt[1],Or),ns=Or[wt[0]],At=Or[wt[1]])}else{if("wrapS"in ar){var Nt=ar.wrapS;bt.parameter(Nt,Or),ns=Or[Nt]}if("wrapT"in ar){var Yt=ar.wrapT;bt.parameter(Yt,Or),At=Or[Yt]}}if(kt.wrapS=ns,kt.wrapT=At,"anisotropic"in ar){var Kt=ar.anisotropic;bt(typeof Kt=="number"&&Kt>=1&&Kt<=It.maxAnisotropic,"aniso samples must be between 1 and "),kt.anisotropic=ar.anisotropic}if("mipmap"in ar){var Ut=!1;switch(typeof ar.mipmap){case"string":bt.parameter(ar.mipmap,Nr,"invalid mipmap hint"),kt.mipmapHint=Nr[ar.mipmap],kt.genMipmaps=!0,Ut=!0;break;case"boolean":Ut=kt.genMipmaps=ar.mipmap;break;case"object":bt(Array.isArray(ar.mipmap),"invalid mipmap type"),kt.genMipmaps=!1,Ut=!0;break;default:bt.raise("invalid mipmap type")}Ut&&!("min"in ar)&&(kt.minFilter=ju)}}function co(kt,ar){ht.texParameteri(ar,Ap,kt.minFilter),ht.texParameteri(ar,Jp,kt.magFilter),ht.texParameteri(ar,Ko,kt.wrapS),ht.texParameteri(ar,Zo,kt.wrapT),St.ext_texture_filter_anisotropic&&ht.texParameteri(ar,em,kt.anisotropic),kt.genMipmaps&&(ht.hint(_g,kt.mipmapHint),ht.generateMipmap(ar))}var uo=0,po={},vo=It.maxTextureUnits,Js=Array(vo).map(function(){return null});function es(kt){Sr.call(this),this.mipmask=0,this.internalformat=ro,this.id=uo++,this.refCount=1,this.target=kt,this.texture=ht.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Vs,dr.profile&&(this.stats={size:0})}function _o(kt){ht.activeTexture(Dr),ht.bindTexture(kt.target,kt.texture)}function Es(){var kt=Js[0];kt?ht.bindTexture(kt.target,kt.texture):ht.bindTexture(Ks,null)}function Dn(kt){var ar=kt.texture;bt(ar,"must not double destroy texture");var tr=kt.unit,En=kt.target;tr>=0&&(ht.activeTexture(Dr+tr),ht.bindTexture(En,null),Js[tr]=null),ht.deleteTexture(ar),kt.texture=null,kt.params=null,kt.pixels=null,kt.refCount=0,delete po[kt.id],nr.textureCount--}o(es.prototype,{bind:function(){var kt=this;kt.bindCount+=1;var ar=kt.unit;if(ar<0){for(var tr=0;tr<vo;++tr){var En=Js[tr];if(En){if(En.bindCount>0)continue;En.unit=-1}Js[tr]=kt,ar=tr;break}ar>=vo&&bt.raise("insufficient number of texture units"),dr.profile&&nr.maxTextureUnits<ar+1&&(nr.maxTextureUnits=ar+1),kt.unit=ar,ht.activeTexture(Dr+ar),ht.bindTexture(kt.target,kt.texture)}return ar},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Dn(this)}});function os(kt,ar){var tr=new es(Ks);po[tr.id]=tr,nr.textureCount++;function En(wt,Nt){var Yt=tr.texInfo;Vs.call(Yt);var Kt=as();return typeof wt=="number"?typeof Nt=="number"?Xn(Kt,wt|0,Nt|0):Xn(Kt,wt|0,wt|0):wt?(bt.type(wt,"object","invalid arguments to regl.texture"),so(Yt,wt),ss(Kt,wt)):Xn(Kt,1,1),Yt.genMipmaps&&(Kt.mipmask=(Kt.width<<1)-1),tr.mipmask=Kt.mipmask,wr(tr,Kt),bt.texture2D(Yt,Kt,It),tr.internalformat=Kt.internalformat,En.width=Kt.width,En.height=Kt.height,_o(tr),Ws(Kt,Ks),co(Yt,Ks),Es(),lo(Kt),dr.profile&&(tr.stats.size=Rp(tr.internalformat,tr.type,Kt.width,Kt.height,Yt.genMipmaps,!1)),En.format=zr[tr.internalformat],En.type=gn[tr.type],En.mag=Rr[Yt.magFilter],En.min=hn[Yt.minFilter],En.wrapS=cn[Yt.wrapS],En.wrapT=cn[Yt.wrapT],En}function ns(wt,Nt,Yt,Kt){bt(!!wt,"must specify image data");var Ut=Nt|0,Vt=Yt|0,jt=Kt|0,Lt=un();return wr(Lt,tr),Lt.width=0,Lt.height=0,rn(Lt,wt),Lt.width=Lt.width||(tr.width>>jt)-Ut,Lt.height=Lt.height||(tr.height>>jt)-Vt,bt(tr.type===Lt.type&&tr.format===Lt.format&&tr.internalformat===Lt.internalformat,"incompatible format for texture.subimage"),bt(Ut>=0&&Vt>=0&&Ut+Lt.width<=tr.width&&Vt+Lt.height<=tr.height,"texture.subimage write out of bounds"),bt(tr.mipmask&1<<jt,"missing mipmap data"),bt(Lt.data||Lt.element||Lt.needsCopy,"missing image data"),_o(tr),Wn(Lt,Ks,Ut,Vt,jt),Es(),pn(Lt),En}function At(wt,Nt){var Yt=wt|0,Kt=Nt|0||Yt;if(Yt===tr.width&&Kt===tr.height)return En;En.width=tr.width=Yt,En.height=tr.height=Kt,_o(tr);for(var Ut=0;tr.mipmask>>Ut;++Ut){var Vt=Yt>>Ut,jt=Kt>>Ut;if(!Vt||!jt)break;ht.texImage2D(Ks,Ut,tr.format,Vt,jt,0,tr.format,tr.type,null)}return Es(),dr.profile&&(tr.stats.size=Rp(tr.internalformat,tr.type,Yt,Kt,!1,!1)),En}return En(kt,ar),En.subimage=ns,En.resize=At,En._reglType="texture2d",En._texture=tr,dr.profile&&(En.stats=tr.stats),En.destroy=function(){tr.decRef()},En}function ps(kt,ar,tr,En,ns,At){var wt=new es(Pl);po[wt.id]=wt,nr.cubeCount++;var Nt=new Array(6);function Yt(Vt,jt,Lt,Mt,Pt,Jt){var Zt,yr=wt.texInfo;for(Vs.call(yr),Zt=0;Zt<6;++Zt)Nt[Zt]=as();if(typeof Vt=="number"||!Vt){var Tr=Vt|0||1;for(Zt=0;Zt<6;++Zt)Xn(Nt[Zt],Tr,Tr)}else if(typeof Vt=="object")if(jt)ss(Nt[0],Vt),ss(Nt[1],jt),ss(Nt[2],Lt),ss(Nt[3],Mt),ss(Nt[4],Pt),ss(Nt[5],Jt);else if(so(yr,Vt),bn(wt,Vt),"faces"in Vt){var Qr=Vt.faces;for(bt(Array.isArray(Qr)&&Qr.length===6,"cube faces must be a length 6 array"),Zt=0;Zt<6;++Zt)bt(typeof Qr[Zt]=="object"&&!!Qr[Zt],"invalid input for cube map face"),wr(Nt[Zt],wt),ss(Nt[Zt],Qr[Zt])}else for(Zt=0;Zt<6;++Zt)ss(Nt[Zt],Vt);else bt.raise("invalid arguments to cube map");for(wr(wt,Nt[0]),bt.optional(function(){It.npotTextureCube||bt(ou(wt.width)&&ou(wt.height),"your browser does not support non power or two texture dimensions")}),yr.genMipmaps?wt.mipmask=(Nt[0].width<<1)-1:wt.mipmask=Nt[0].mipmask,bt.textureCube(wt,yr,Nt,It),wt.internalformat=Nt[0].internalformat,Yt.width=Nt[0].width,Yt.height=Nt[0].height,_o(wt),Zt=0;Zt<6;++Zt)Ws(Nt[Zt],yl+Zt);for(co(yr,Pl),Es(),dr.profile&&(wt.stats.size=Rp(wt.internalformat,wt.type,Yt.width,Yt.height,yr.genMipmaps,!0)),Yt.format=zr[wt.internalformat],Yt.type=gn[wt.type],Yt.mag=Rr[yr.magFilter],Yt.min=hn[yr.minFilter],Yt.wrapS=cn[yr.wrapS],Yt.wrapT=cn[yr.wrapT],Zt=0;Zt<6;++Zt)lo(Nt[Zt]);return Yt}function Kt(Vt,jt,Lt,Mt,Pt){bt(!!jt,"must specify image data"),bt(typeof Vt=="number"&&Vt===(Vt|0)&&Vt>=0&&Vt<6,"invalid face");var Jt=Lt|0,Zt=Mt|0,yr=Pt|0,Tr=un();return wr(Tr,wt),Tr.width=0,Tr.height=0,rn(Tr,jt),Tr.width=Tr.width||(wt.width>>yr)-Jt,Tr.height=Tr.height||(wt.height>>yr)-Zt,bt(wt.type===Tr.type&&wt.format===Tr.format&&wt.internalformat===Tr.internalformat,"incompatible format for texture.subimage"),bt(Jt>=0&&Zt>=0&&Jt+Tr.width<=wt.width&&Zt+Tr.height<=wt.height,"texture.subimage write out of bounds"),bt(wt.mipmask&1<<yr,"missing mipmap data"),bt(Tr.data||Tr.element||Tr.needsCopy,"missing image data"),_o(wt),Wn(Tr,yl+Vt,Jt,Zt,yr),Es(),pn(Tr),Yt}function Ut(Vt){var jt=Vt|0;if(jt!==wt.width){Yt.width=wt.width=jt,Yt.height=wt.height=jt,_o(wt);for(var Lt=0;Lt<6;++Lt)for(var Mt=0;wt.mipmask>>Mt;++Mt)ht.texImage2D(yl+Lt,Mt,wt.format,jt>>Mt,jt>>Mt,0,wt.format,wt.type,null);return Es(),dr.profile&&(wt.stats.size=Rp(wt.internalformat,wt.type,Yt.width,Yt.height,!1,!0)),Yt}}return Yt(kt,ar,tr,En,ns,At),Yt.subimage=Kt,Yt.resize=Ut,Yt._reglType="textureCube",Yt._texture=wt,dr.profile&&(Yt.stats=wt.stats),Yt.destroy=function(){wt.decRef()},Yt}function eo(){for(var kt=0;kt<vo;++kt)ht.activeTexture(Dr+kt),ht.bindTexture(Ks,null),Js[kt]=null;or(po).forEach(Dn),nr.cubeCount=0,nr.textureCount=0}dr.profile&&(nr.getTotalTextureSize=function(){var kt=0;return Object.keys(po).forEach(function(ar){kt+=po[ar].stats.size}),kt});function Xl(){for(var kt=0;kt<vo;++kt){var ar=Js[kt];ar&&(ar.bindCount=0,ar.unit=-1,Js[kt]=null)}or(po).forEach(function(tr){tr.texture=ht.createTexture(),ht.bindTexture(tr.target,tr.texture);for(var En=0;En<32;++En)if(tr.mipmask&1<<En)if(tr.target===Ks)ht.texImage2D(Ks,En,tr.internalformat,tr.width>>En,tr.height>>En,0,tr.internalformat,tr.type,null);else for(var ns=0;ns<6;++ns)ht.texImage2D(yl+ns,En,tr.internalformat,tr.width>>En,tr.height>>En,0,tr.internalformat,tr.type,null);co(tr.texInfo,tr.target)})}function Nu(){for(var kt=0;kt<vo;++kt){var ar=Js[kt];ar&&(ar.bindCount=0,ar.unit=-1,Js[kt]=null),ht.activeTexture(Dr+kt),ht.bindTexture(Ks,null),ht.bindTexture(Pl,null)}}return{create2D:os,createCube:ps,clear:eo,getTexture:function(kt){return null},restore:Xl,refresh:Nu}}var hu=36161,Lp=32854,Dm=32855,Im=36194,Om=33189,Nm=36168,Fm=34041,$m=35907,Bm=34836,zm=34842,Vm=34843,Dl=[];Dl[Lp]=2,Dl[Dm]=2,Dl[Im]=2,Dl[Om]=2,Dl[Nm]=1,Dl[Fm]=4,Dl[$m]=4,Dl[Bm]=16,Dl[zm]=8,Dl[Vm]=6;function Um(ht,St,It){return Dl[ht]*St*It}var jv=function(ht,St,It,ir,br){var nr={rgba4:Lp,rgb565:Im,"rgb5 a1":Dm,depth:Om,stencil:Nm,"depth stencil":Fm};St.ext_srgb&&(nr.srgba=$m),St.ext_color_buffer_half_float&&(nr.rgba16f=zm,nr.rgb16f=Vm),St.webgl_color_buffer_float&&(nr.rgba32f=Bm);var dr=[];Object.keys(nr).forEach(function($r){var Ur=nr[$r];dr[Ur]=$r});var Nr=0,Or={};function Wr($r){this.id=Nr++,this.refCount=1,this.renderbuffer=$r,this.format=Lp,this.width=0,this.height=0,br.profile&&(this.stats={size:0})}Wr.prototype.decRef=function(){--this.refCount<=0&&qr(this)};function qr($r){var Ur=$r.renderbuffer;bt(Ur,"must not double destroy renderbuffer"),ht.bindRenderbuffer(hu,null),ht.deleteRenderbuffer(Ur),$r.renderbuffer=null,$r.refCount=0,delete Or[$r.id],ir.renderbufferCount--}function Xr($r,Ur){var qt=new Wr(ht.createRenderbuffer());Or[qt.id]=qt,ir.renderbufferCount++;function ur(gn,Rr){var hn=0,cn=0,Pn=Lp;if(typeof gn=="object"&&gn){var Sr=gn;if("shape"in Sr){var wr=Sr.shape;bt(Array.isArray(wr)&&wr.length>=2,"invalid renderbuffer shape"),hn=wr[0]|0,cn=wr[1]|0}else"radius"in Sr&&(hn=cn=Sr.radius|0),"width"in Sr&&(hn=Sr.width|0),"height"in Sr&&(cn=Sr.height|0);"format"in Sr&&(bt.parameter(Sr.format,nr,"invalid renderbuffer format"),Pn=nr[Sr.format])}else typeof gn=="number"?(hn=gn|0,typeof Rr=="number"?cn=Rr|0:cn=hn):gn?bt.raise("invalid arguments to renderbuffer constructor"):hn=cn=1;if(bt(hn>0&&cn>0&&hn<=It.maxRenderbufferSize&&cn<=It.maxRenderbufferSize,"invalid renderbuffer size"),!(hn===qt.width&&cn===qt.height&&Pn===qt.format))return ur.width=qt.width=hn,ur.height=qt.height=cn,qt.format=Pn,ht.bindRenderbuffer(hu,qt.renderbuffer),ht.renderbufferStorage(hu,Pn,hn,cn),bt(ht.getError()===0,"invalid render buffer format"),br.profile&&(qt.stats.size=Um(qt.format,qt.width,qt.height)),ur.format=dr[qt.format],ur}function zr(gn,Rr){var hn=gn|0,cn=Rr|0||hn;return hn===qt.width&&cn===qt.height||(bt(hn>0&&cn>0&&hn<=It.maxRenderbufferSize&&cn<=It.maxRenderbufferSize,"invalid renderbuffer size"),ur.width=qt.width=hn,ur.height=qt.height=cn,ht.bindRenderbuffer(hu,qt.renderbuffer),ht.renderbufferStorage(hu,qt.format,hn,cn),bt(ht.getError()===0,"invalid render buffer format"),br.profile&&(qt.stats.size=Um(qt.format,qt.width,qt.height))),ur}return ur($r,Ur),ur.resize=zr,ur._reglType="renderbuffer",ur._renderbuffer=qt,br.profile&&(ur.stats=qt.stats),ur.destroy=function(){qt.decRef()},ur}br.profile&&(ir.getTotalRenderbufferSize=function(){var $r=0;return Object.keys(Or).forEach(function(Ur){$r+=Or[Ur].stats.size}),$r});function Jr(){or(Or).forEach(function($r){$r.renderbuffer=ht.createRenderbuffer(),ht.bindRenderbuffer(hu,$r.renderbuffer),ht.renderbufferStorage(hu,$r.format,$r.width,$r.height)}),ht.bindRenderbuffer(hu,null)}return{create:Xr,clear:function(){or(Or).forEach(qr)},restore:Jr}},eu=36160,rm=36161,Pu=3553,Pp=34069,Gm=36064,Hm=36096,jm=36128,Wm=33306,Xm=36053,Wv=36054,Xv=36055,Yv=36057,qv=36061,Kv=36193,Zv=5121,Qv=5126,Ym=6407,qm=6408,Jv=6402,e_=[Ym,qm],nm=[];nm[qm]=4,nm[Ym]=3;var kp=[];kp[Zv]=1,kp[Qv]=4,kp[Kv]=2;var t_=32854,r_=32855,n_=36194,i_=33189,s_=36168,Km=34041,o_=35907,a_=34836,l_=34842,c_=34843,u_=[t_,r_,n_,o_,l_,c_,a_],Wu={};Wu[Xm]="complete",Wu[Wv]="incomplete attachment",Wu[Yv]="incomplete dimensions",Wu[Xv]="incomplete, missing attachment",Wu[qv]="unsupported";function f_(ht,St,It,ir,br,nr){var dr={cur:null,next:null,dirty:!1,setFBO:null},Nr=["rgba"],Or=["rgba4","rgb565","rgb5 a1"];St.ext_srgb&&Or.push("srgba"),St.ext_color_buffer_half_float&&Or.push("rgba16f","rgb16f"),St.webgl_color_buffer_float&&Or.push("rgba32f");var Wr=["uint8"];St.oes_texture_half_float&&Wr.push("half float","float16"),St.oes_texture_float&&Wr.push("float","float32");function qr(Br,rn,on){this.target=Br,this.texture=rn,this.renderbuffer=on;var Wn=0,Un=0;rn?(Wn=rn.width,Un=rn.height):on&&(Wn=on.width,Un=on.height),this.width=Wn,this.height=Un}function Xr(Br){Br&&(Br.texture&&Br.texture._texture.decRef(),Br.renderbuffer&&Br.renderbuffer._renderbuffer.decRef())}function Jr(Br,rn,on){if(Br)if(Br.texture){var Wn=Br.texture._texture,Un=Math.max(1,Wn.width),un=Math.max(1,Wn.height);bt(Un===rn&&un===on,"inconsistent width/height for supplied texture"),Wn.refCount+=1}else{var pn=Br.renderbuffer._renderbuffer;bt(pn.width===rn&&pn.height===on,"inconsistent width/height for renderbuffer"),pn.refCount+=1}}function $r(Br,rn){rn&&(rn.texture?ht.framebufferTexture2D(eu,Br,rn.target,rn.texture._texture.texture,0):ht.framebufferRenderbuffer(eu,Br,rm,rn.renderbuffer._renderbuffer.renderbuffer))}function Ur(Br){var rn=Pu,on=null,Wn=null,Un=Br;typeof Br=="object"&&(Un=Br.data,"target"in Br&&(rn=Br.target|0)),bt.type(Un,"function","invalid attachment data");var un=Un._reglType;return un==="texture2d"?(on=Un,bt(rn===Pu)):un==="textureCube"?(on=Un,bt(rn>=Pp&&rn<Pp+6,"invalid cube map target")):un==="renderbuffer"?(Wn=Un,rn=rm):bt.raise("invalid regl object for attachment"),new qr(rn,on,Wn)}function qt(Br,rn,on,Wn,Un){if(on){var un=ir.create2D({width:Br,height:rn,format:Wn,type:Un});return un._texture.refCount=0,new qr(Pu,un,null)}else{var pn=br.create({width:Br,height:rn,format:Wn});return pn._renderbuffer.refCount=0,new qr(rm,null,pn)}}function ur(Br){return Br&&(Br.texture||Br.renderbuffer)}function zr(Br,rn,on){Br&&(Br.texture?Br.texture.resize(rn,on):Br.renderbuffer&&Br.renderbuffer.resize(rn,on),Br.width=rn,Br.height=on)}var gn=0,Rr={};function hn(){this.id=gn++,Rr[this.id]=this,this.framebuffer=ht.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function cn(Br){Br.colorAttachments.forEach(Xr),Xr(Br.depthAttachment),Xr(Br.stencilAttachment),Xr(Br.depthStencilAttachment)}function Pn(Br){var rn=Br.framebuffer;bt(rn,"must not double destroy framebuffer"),ht.deleteFramebuffer(rn),Br.framebuffer=null,nr.framebufferCount--,delete Rr[Br.id]}function Sr(Br){var rn;ht.bindFramebuffer(eu,Br.framebuffer);var on=Br.colorAttachments;for(rn=0;rn<on.length;++rn)$r(Gm+rn,on[rn]);for(rn=on.length;rn<It.maxColorAttachments;++rn)ht.framebufferTexture2D(eu,Gm+rn,Pu,null,0);ht.framebufferTexture2D(eu,Wm,Pu,null,0),ht.framebufferTexture2D(eu,Hm,Pu,null,0),ht.framebufferTexture2D(eu,jm,Pu,null,0),$r(Hm,Br.depthAttachment),$r(jm,Br.stencilAttachment),$r(Wm,Br.depthStencilAttachment);var Wn=ht.checkFramebufferStatus(eu);!ht.isContextLost()&&Wn!==Xm&&bt.raise("framebuffer configuration not supported, status = "+Wu[Wn]),ht.bindFramebuffer(eu,dr.next?dr.next.framebuffer:null),dr.cur=dr.next,ht.getError()}function wr(Br,rn){var on=new hn;nr.framebufferCount++;function Wn(un,pn){var On;bt(dr.next!==on,"can not update framebuffer which is currently in use");var Xn=0,ss=0,Ws=!0,qs=!0,as=null,lo=!0,Vs="rgba",so="uint8",co=1,uo=null,po=null,vo=null,Js=!1;if(typeof un=="number")Xn=un|0,ss=pn|0||Xn;else if(!un)Xn=ss=1;else{bt.type(un,"object","invalid arguments for framebuffer");var es=un;if("shape"in es){var _o=es.shape;bt(Array.isArray(_o)&&_o.length>=2,"invalid shape for framebuffer"),Xn=_o[0],ss=_o[1]}else"radius"in es&&(Xn=ss=es.radius),"width"in es&&(Xn=es.width),"height"in es&&(ss=es.height);("color"in es||"colors"in es)&&(as=es.color||es.colors,Array.isArray(as)&&bt(as.length===1||St.webgl_draw_buffers,"multiple render targets not supported")),as||("colorCount"in es&&(co=es.colorCount|0,bt(co>0,"invalid color buffer count")),"colorTexture"in es&&(lo=!!es.colorTexture,Vs="rgba4"),"colorType"in es&&(so=es.colorType,lo?(bt(St.oes_texture_float||!(so==="float"||so==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),bt(St.oes_texture_half_float||!(so==="half float"||so==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):so==="half float"||so==="float16"?(bt(St.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Vs="rgba16f"):(so==="float"||so==="float32")&&(bt(St.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Vs="rgba32f"),bt.oneOf(so,Wr,"invalid color type")),"colorFormat"in es&&(Vs=es.colorFormat,Nr.indexOf(Vs)>=0?lo=!0:Or.indexOf(Vs)>=0?lo=!1:bt.optional(function(){lo?bt.oneOf(es.colorFormat,Nr,"invalid color format for texture"):bt.oneOf(es.colorFormat,Or,"invalid color format for renderbuffer")}))),("depthTexture"in es||"depthStencilTexture"in es)&&(Js=!!(es.depthTexture||es.depthStencilTexture),bt(!Js||St.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in es&&(typeof es.depth=="boolean"?Ws=es.depth:(uo=es.depth,qs=!1)),"stencil"in es&&(typeof es.stencil=="boolean"?qs=es.stencil:(po=es.stencil,Ws=!1)),"depthStencil"in es&&(typeof es.depthStencil=="boolean"?Ws=qs=es.depthStencil:(vo=es.depthStencil,Ws=!1,qs=!1))}var Es=null,Dn=null,os=null,ps=null;if(Array.isArray(as))Es=as.map(Ur);else if(as)Es=[Ur(as)];else for(Es=new Array(co),On=0;On<co;++On)Es[On]=qt(Xn,ss,lo,Vs,so);bt(St.webgl_draw_buffers||Es.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),bt(Es.length<=It.maxColorAttachments,"too many color attachments, not supported"),Xn=Xn||Es[0].width,ss=ss||Es[0].height,uo?Dn=Ur(uo):Ws&&!qs&&(Dn=qt(Xn,ss,Js,"depth","uint32")),po?os=Ur(po):qs&&!Ws&&(os=qt(Xn,ss,!1,"stencil","uint8")),vo?ps=Ur(vo):!uo&&!po&&qs&&Ws&&(ps=qt(Xn,ss,Js,"depth stencil","depth stencil")),bt(!!uo+!!po+!!vo<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var eo=null;for(On=0;On<Es.length;++On)if(Jr(Es[On],Xn,ss),bt(!Es[On]||Es[On].texture&&e_.indexOf(Es[On].texture._texture.format)>=0||Es[On].renderbuffer&&u_.indexOf(Es[On].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+On+" is invalid"),Es[On]&&Es[On].texture){var Xl=nm[Es[On].texture._texture.format]*kp[Es[On].texture._texture.type];eo===null?eo=Xl:bt(eo===Xl,"all color attachments much have the same number of bits per pixel.")}return Jr(Dn,Xn,ss),bt(!Dn||Dn.texture&&Dn.texture._texture.format===Jv||Dn.renderbuffer&&Dn.renderbuffer._renderbuffer.format===i_,"invalid depth attachment for framebuffer object"),Jr(os,Xn,ss),bt(!os||os.renderbuffer&&os.renderbuffer._renderbuffer.format===s_,"invalid stencil attachment for framebuffer object"),Jr(ps,Xn,ss),bt(!ps||ps.texture&&ps.texture._texture.format===Km||ps.renderbuffer&&ps.renderbuffer._renderbuffer.format===Km,"invalid depth-stencil attachment for framebuffer object"),cn(on),on.width=Xn,on.height=ss,on.colorAttachments=Es,on.depthAttachment=Dn,on.stencilAttachment=os,on.depthStencilAttachment=ps,Wn.color=Es.map(ur),Wn.depth=ur(Dn),Wn.stencil=ur(os),Wn.depthStencil=ur(ps),Wn.width=on.width,Wn.height=on.height,Sr(on),Wn}function Un(un,pn){bt(dr.next!==on,"can not resize a framebuffer which is currently in use");var On=Math.max(un|0,1),Xn=Math.max(pn|0||On,1);if(On===on.width&&Xn===on.height)return Wn;for(var ss=on.colorAttachments,Ws=0;Ws<ss.length;++Ws)zr(ss[Ws],On,Xn);return zr(on.depthAttachment,On,Xn),zr(on.stencilAttachment,On,Xn),zr(on.depthStencilAttachment,On,Xn),on.width=Wn.width=On,on.height=Wn.height=Xn,Sr(on),Wn}return Wn(Br,rn),o(Wn,{resize:Un,_reglType:"framebuffer",_framebuffer:on,destroy:function(){Pn(on),cn(on)},use:function(un){dr.setFBO({framebuffer:Wn},un)}})}function bn(Br){var rn=Array(6);function on(Un){var un;bt(rn.indexOf(dr.next)<0,"can not update framebuffer which is currently in use");var pn={color:null},On=0,Xn=null,ss="rgba",Ws="uint8",qs=1;if(typeof Un=="number")On=Un|0;else if(!Un)On=1;else{bt.type(Un,"object","invalid arguments for framebuffer");var as=Un;if("shape"in as){var lo=as.shape;bt(Array.isArray(lo)&&lo.length>=2,"invalid shape for framebuffer"),bt(lo[0]===lo[1],"cube framebuffer must be square"),On=lo[0]}else"radius"in as&&(On=as.radius|0),"width"in as?(On=as.width|0,"height"in as&&bt(as.height===On,"must be square")):"height"in as&&(On=as.height|0);("color"in as||"colors"in as)&&(Xn=as.color||as.colors,Array.isArray(Xn)&&bt(Xn.length===1||St.webgl_draw_buffers,"multiple render targets not supported")),Xn||("colorCount"in as&&(qs=as.colorCount|0,bt(qs>0,"invalid color buffer count")),"colorType"in as&&(bt.oneOf(as.colorType,Wr,"invalid color type"),Ws=as.colorType),"colorFormat"in as&&(ss=as.colorFormat,bt.oneOf(as.colorFormat,Nr,"invalid color format for texture"))),"depth"in as&&(pn.depth=as.depth),"stencil"in as&&(pn.stencil=as.stencil),"depthStencil"in as&&(pn.depthStencil=as.depthStencil)}var Vs;if(Xn)if(Array.isArray(Xn))for(Vs=[],un=0;un<Xn.length;++un)Vs[un]=Xn[un];else Vs=[Xn];else{Vs=Array(qs);var so={radius:On,format:ss,type:Ws};for(un=0;un<qs;++un)Vs[un]=ir.createCube(so)}for(pn.color=Array(Vs.length),un=0;un<Vs.length;++un){var co=Vs[un];bt(typeof co=="function"&&co._reglType==="textureCube","invalid cube map"),On=On||co.width,bt(co.width===On&&co.height===On,"invalid cube map shape"),pn.color[un]={target:Pp,data:Vs[un]}}for(un=0;un<6;++un){for(var uo=0;uo<Vs.length;++uo)pn.color[uo].target=Pp+un;un>0&&(pn.depth=rn[0].depth,pn.stencil=rn[0].stencil,pn.depthStencil=rn[0].depthStencil),rn[un]?rn[un](pn):rn[un]=wr(pn)}return o(on,{width:On,height:On,color:Vs})}function Wn(Un){var un,pn=Un|0;if(bt(pn>0&&pn<=It.maxCubeMapSize,"invalid radius for cube fbo"),pn===on.width)return on;var On=on.color;for(un=0;un<On.length;++un)On[un].resize(pn);for(un=0;un<6;++un)rn[un].resize(pn);return on.width=on.height=pn,on}return on(Br),o(on,{faces:rn,resize:Wn,_reglType:"framebufferCube",destroy:function(){rn.forEach(function(Un){Un.destroy()})}})}function tn(){dr.cur=null,dr.next=null,dr.dirty=!0,or(Rr).forEach(function(Br){Br.framebuffer=ht.createFramebuffer(),Sr(Br)})}return o(dr,{getFramebuffer:function(Br){if(typeof Br=="function"&&Br._reglType==="framebuffer"){var rn=Br._framebuffer;if(rn instanceof hn)return rn}return null},create:wr,createCube:bn,clear:function(){or(Rr).forEach(Pn)},restore:tn})}var d_=5126,Zm=34962,Mp=34963,Qm=["attributes","elements","offset","count","primitive","instances"];function im(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=d_,this.offset=0,this.stride=0,this.divisor=0}function h_(ht,St,It,ir,br,nr,dr){for(var Nr=It.maxAttributes,Or=new Array(Nr),Wr=0;Wr<Nr;++Wr)Or[Wr]=new im;var qr=0,Xr={},Jr={Record:im,scope:{},state:Or,currentVAO:null,targetVAO:null,restore:Ur()?cn:function(){},createVAO:Pn,getVAO:ur,destroyBuffer:$r,setVAO:Ur()?zr:gn,clear:Ur()?Rr:function(){}};function $r(Sr){for(var wr=0;wr<Or.length;++wr){var bn=Or[wr];bn.buffer===Sr&&(ht.disableVertexAttribArray(wr),bn.buffer=null)}}function Ur(){return St.oes_vertex_array_object}function qt(){return St.angle_instanced_arrays}function ur(Sr){return typeof Sr=="function"&&Sr._vao?Sr._vao:null}function zr(Sr){if(Sr!==Jr.currentVAO){var wr=Ur();Sr?wr.bindVertexArrayOES(Sr.vao):wr.bindVertexArrayOES(null),Jr.currentVAO=Sr}}function gn(Sr){if(Sr!==Jr.currentVAO){if(Sr)Sr.bindAttrs();else{for(var wr=qt(),bn=0;bn<Or.length;++bn){var tn=Or[bn];tn.buffer?(ht.enableVertexAttribArray(bn),tn.buffer.bind(),ht.vertexAttribPointer(bn,tn.size,tn.type,tn.normalized,tn.stride,tn.offfset),wr&&tn.divisor&&wr.vertexAttribDivisorANGLE(bn,tn.divisor)):(ht.disableVertexAttribArray(bn),ht.vertexAttrib4f(bn,tn.x,tn.y,tn.z,tn.w))}dr.elements?ht.bindBuffer(Mp,dr.elements.buffer.buffer):ht.bindBuffer(Mp,null)}Jr.currentVAO=Sr}}function Rr(){or(Xr).forEach(function(Sr){Sr.destroy()})}function hn(){this.id=++qr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Sr=Ur();Sr?this.vao=Sr.createVertexArrayOES():this.vao=null,Xr[this.id]=this,this.buffers=[]}hn.prototype.bindAttrs=function(){for(var Sr=qt(),wr=this.attributes,bn=0;bn<wr.length;++bn){var tn=wr[bn];tn.buffer?(ht.enableVertexAttribArray(bn),ht.bindBuffer(Zm,tn.buffer.buffer),ht.vertexAttribPointer(bn,tn.size,tn.type,tn.normalized,tn.stride,tn.offset),Sr&&tn.divisor&&Sr.vertexAttribDivisorANGLE(bn,tn.divisor)):(ht.disableVertexAttribArray(bn),ht.vertexAttrib4f(bn,tn.x,tn.y,tn.z,tn.w))}for(var Br=wr.length;Br<Nr;++Br)ht.disableVertexAttribArray(Br);var rn=nr.getElements(this.elements);rn?ht.bindBuffer(Mp,rn.buffer.buffer):ht.bindBuffer(Mp,null)},hn.prototype.refresh=function(){var Sr=Ur();Sr&&(Sr.bindVertexArrayOES(this.vao),this.bindAttrs(),Jr.currentVAO=null,Sr.bindVertexArrayOES(null))},hn.prototype.destroy=function(){if(this.vao){var Sr=Ur();this===Jr.currentVAO&&(Jr.currentVAO=null,Sr.bindVertexArrayOES(null)),Sr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Xr[this.id]&&(delete Xr[this.id],ir.vaoCount-=1)};function cn(){var Sr=Ur();Sr&&or(Xr).forEach(function(wr){wr.refresh()})}function Pn(Sr){var wr=new hn;ir.vaoCount+=1;function bn(tn){var Br;if(Array.isArray(tn))Br=tn,wr.elements&&wr.ownsElements&&wr.elements.destroy(),wr.elements=null,wr.ownsElements=!1,wr.offset=0,wr.count=0,wr.instances=-1,wr.primitive=4;else{if(bt(typeof tn=="object","invalid arguments for create vao"),bt("attributes"in tn,"must specify attributes for vao"),tn.elements){var rn=tn.elements;wr.ownsElements?typeof rn=="function"&&rn._reglType==="elements"?(wr.elements.destroy(),wr.ownsElements=!1):(wr.elements(rn),wr.ownsElements=!1):nr.getElements(tn.elements)?(wr.elements=tn.elements,wr.ownsElements=!1):(wr.elements=nr.create(tn.elements),wr.ownsElements=!0)}else wr.elements=null,wr.ownsElements=!1;Br=tn.attributes,wr.offset=0,wr.count=-1,wr.instances=-1,wr.primitive=4,wr.elements&&(wr.count=wr.elements._elements.vertCount,wr.primitive=wr.elements._elements.primType),"offset"in tn&&(wr.offset=tn.offset|0),"count"in tn&&(wr.count=tn.count|0),"instances"in tn&&(wr.instances=tn.instances|0),"primitive"in tn&&(bt(tn.primitive in yt,"bad primitive type: "+tn.primitive),wr.primitive=yt[tn.primitive]),bt.optional(()=>{for(var Ws=Object.keys(tn),qs=0;qs<Ws.length;++qs)bt(Qm.indexOf(Ws[qs])>=0,'invalid option for vao: "'+Ws[qs]+'" valid options are '+Qm)}),bt(Array.isArray(Br),"attributes must be an array")}bt(Br.length<Nr,"too many attributes"),bt(Br.length>0,"must specify at least one attribute");var on={},Wn=wr.attributes;Wn.length=Br.length;for(var Un=0;Un<Br.length;++Un){var un=Br[Un],pn=Wn[Un]=new im,On=un.data||un;if(Array.isArray(On)||s(On)||Ft(On)){var Xn;wr.buffers[Un]&&(Xn=wr.buffers[Un],s(On)&&Xn._buffer.byteLength>=On.byteLength?Xn.subdata(On):(Xn.destroy(),wr.buffers[Un]=null)),wr.buffers[Un]||(Xn=wr.buffers[Un]=br.create(un,Zm,!1,!0)),pn.buffer=br.getBuffer(Xn),pn.size=pn.buffer.dimension|0,pn.normalized=!1,pn.type=pn.buffer.dtype,pn.offset=0,pn.stride=0,pn.divisor=0,pn.state=1,on[Un]=1}else br.getBuffer(un)?(pn.buffer=br.getBuffer(un),pn.size=pn.buffer.dimension|0,pn.normalized=!1,pn.type=pn.buffer.dtype,pn.offset=0,pn.stride=0,pn.divisor=0,pn.state=1):br.getBuffer(un.buffer)?(pn.buffer=br.getBuffer(un.buffer),pn.size=(+un.size||pn.buffer.dimension)|0,pn.normalized=!!un.normalized||!1,"type"in un?(bt.parameter(un.type,zs,"invalid buffer type"),pn.type=zs[un.type]):pn.type=pn.buffer.dtype,pn.offset=(un.offset||0)|0,pn.stride=(un.stride||0)|0,pn.divisor=(un.divisor||0)|0,pn.state=1,bt(pn.size>=1&&pn.size<=4,"size must be between 1 and 4"),bt(pn.offset>=0,"invalid offset"),bt(pn.stride>=0&&pn.stride<=255,"stride must be between 0 and 255"),bt(pn.divisor>=0,"divisor must be positive"),bt(!pn.divisor||!!St.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in un?(bt(Un>0,"first attribute must not be a constant"),pn.x=+un.x||0,pn.y=+un.y||0,pn.z=+un.z||0,pn.w=+un.w||0,pn.state=2):bt(!1,"invalid attribute spec for location "+Un)}for(var ss=0;ss<wr.buffers.length;++ss)!on[ss]&&wr.buffers[ss]&&(wr.buffers[ss].destroy(),wr.buffers[ss]=null);return wr.refresh(),bn}return bn.destroy=function(){for(var tn=0;tn<wr.buffers.length;++tn)wr.buffers[tn]&&wr.buffers[tn].destroy();wr.buffers.length=0,wr.ownsElements&&(wr.elements.destroy(),wr.elements=null,wr.ownsElements=!1),wr.destroy()},bn._vao=wr,bn._reglType="vao",bn(Sr)}return Jr}var Jm=35632,p_=35633,g_=35718,m_=35721;function v_(ht,St,It,ir){var br={},nr={};function dr(qt,ur,zr,gn){this.name=qt,this.id=ur,this.location=zr,this.info=gn}function Nr(qt,ur){for(var zr=0;zr<qt.length;++zr)if(qt[zr].id===ur.id){qt[zr].location=ur.location;return}qt.push(ur)}function Or(qt,ur,zr){var gn=qt===Jm?br:nr,Rr=gn[ur];if(!Rr){var hn=St.str(ur);Rr=ht.createShader(qt),ht.shaderSource(Rr,hn),ht.compileShader(Rr),bt.shaderError(ht,Rr,hn,qt,zr),gn[ur]=Rr}return Rr}var Wr={},qr=[],Xr=0;function Jr(qt,ur){this.id=Xr++,this.fragId=qt,this.vertId=ur,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ir.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function $r(qt,ur,zr){var gn,Rr,hn=Or(Jm,qt.fragId),cn=Or(p_,qt.vertId),Pn=qt.program=ht.createProgram();if(ht.attachShader(Pn,hn),ht.attachShader(Pn,cn),zr)for(gn=0;gn<zr.length;++gn){var Sr=zr[gn];ht.bindAttribLocation(Pn,Sr[0],Sr[1])}ht.linkProgram(Pn),bt.linkError(ht,Pn,St.str(qt.fragId),St.str(qt.vertId),ur);var wr=ht.getProgramParameter(Pn,g_);ir.profile&&(qt.stats.uniformsCount=wr);var bn=qt.uniforms;for(gn=0;gn<wr;++gn)if(Rr=ht.getActiveUniform(Pn,gn),Rr){if(Rr.size>1)for(var tn=0;tn<Rr.size;++tn){var Br=Rr.name.replace("[0]","["+tn+"]");Nr(bn,new dr(Br,St.id(Br),ht.getUniformLocation(Pn,Br),Rr))}var rn=Rr.name;Rr.size>1&&(rn=rn.replace("[0]","")),Nr(bn,new dr(rn,St.id(rn),ht.getUniformLocation(Pn,rn),Rr))}var on=ht.getProgramParameter(Pn,m_);ir.profile&&(qt.stats.attributesCount=on);var Wn=qt.attributes;for(gn=0;gn<on;++gn)Rr=ht.getActiveAttrib(Pn,gn),Rr&&Nr(Wn,new dr(Rr.name,St.id(Rr.name),ht.getAttribLocation(Pn,Rr.name),Rr))}ir.profile&&(It.getMaxUniformsCount=function(){var qt=0;return qr.forEach(function(ur){ur.stats.uniformsCount>qt&&(qt=ur.stats.uniformsCount)}),qt},It.getMaxAttributesCount=function(){var qt=0;return qr.forEach(function(ur){ur.stats.attributesCount>qt&&(qt=ur.stats.attributesCount)}),qt});function Ur(){br={},nr={};for(var qt=0;qt<qr.length;++qt)$r(qr[qt],null,qr[qt].attributes.map(function(ur){return[ur.location,ur.name]}))}return{clear:function(){var qt=ht.deleteShader.bind(ht);or(br).forEach(qt),br={},or(nr).forEach(qt),nr={},qr.forEach(function(ur){ht.deleteProgram(ur.program)}),qr.length=0,Wr={},It.shaderCount=0},program:function(qt,ur,zr,gn){bt.command(qt>=0,"missing vertex shader",zr),bt.command(ur>=0,"missing fragment shader",zr);var Rr=Wr[ur];Rr||(Rr=Wr[ur]={});var hn=Rr[qt];if(hn&&(hn.refCount++,!gn))return hn;var cn=new Jr(ur,qt);return It.shaderCount++,$r(cn,zr,gn),hn||(Rr[qt]=cn),qr.push(cn),o(cn,{destroy:function(){if(cn.refCount--,cn.refCount<=0){ht.deleteProgram(cn.program);var Pn=qr.indexOf(cn);qr.splice(Pn,1),It.shaderCount--}Rr[cn.vertId].refCount<=0&&(ht.deleteShader(nr[cn.vertId]),delete nr[cn.vertId],delete Wr[cn.fragId][cn.vertId]),Object.keys(Wr[cn.fragId]).length||(ht.deleteShader(br[cn.fragId]),delete br[cn.fragId],delete Wr[cn.fragId])}})},restore:Ur,shader:Or,frag:-1,vert:-1}}var __=6408,up=5121,y_=3333,Dp=5126;function w_(ht,St,It,ir,br,nr,dr){function Nr(qr){var Xr;St.next===null?(bt(br.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Xr=up):(bt(St.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Xr=St.next.colorAttachments[0].texture._texture.type,bt.optional(function(){nr.oes_texture_float?(bt(Xr===up||Xr===Dp,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Xr===Dp&&bt(dr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):bt(Xr===up,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Jr=0,$r=0,Ur=ir.framebufferWidth,qt=ir.framebufferHeight,ur=null;s(qr)?ur=qr:qr&&(bt.type(qr,"object","invalid arguments to regl.read()"),Jr=qr.x|0,$r=qr.y|0,bt(Jr>=0&&Jr<ir.framebufferWidth,"invalid x offset for regl.read"),bt($r>=0&&$r<ir.framebufferHeight,"invalid y offset for regl.read"),Ur=(qr.width||ir.framebufferWidth-Jr)|0,qt=(qr.height||ir.framebufferHeight-$r)|0,ur=qr.data||null),ur&&(Xr===up?bt(ur instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Xr===Dp&&bt(ur instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),bt(Ur>0&&Ur+Jr<=ir.framebufferWidth,"invalid width for read pixels"),bt(qt>0&&qt+$r<=ir.framebufferHeight,"invalid height for read pixels"),It();var zr=Ur*qt*4;return ur||(Xr===up?ur=new Uint8Array(zr):Xr===Dp&&(ur=ur||new Float32Array(zr))),bt.isTypedArray(ur,"data buffer for regl.read() must be a typedarray"),bt(ur.byteLength>=zr,"data buffer for regl.read() too small"),ht.pixelStorei(y_,4),ht.readPixels(Jr,$r,Ur,qt,__,Xr,ur),ur}function Or(qr){var Xr;return St.setFBO({framebuffer:qr.framebuffer},function(){Xr=Nr(qr)}),Xr}function Wr(qr){return!qr||!("framebuffer"in qr)?Nr(qr):Or(qr)}return Wr}function Xu(ht){return Array.prototype.slice.call(ht)}function Yu(ht){return Xu(ht).join("")}function E_(){var ht=0,St=[],It=[];function ir(Xr){for(var Jr=0;Jr<It.length;++Jr)if(It[Jr]===Xr)return St[Jr];var $r="g"+ht++;return St.push($r),It.push(Xr),$r}function br(){var Xr=[];function Jr(){Xr.push.apply(Xr,Xu(arguments))}var $r=[];function Ur(){var qt="v"+ht++;return $r.push(qt),arguments.length>0&&(Xr.push(qt,"="),Xr.push.apply(Xr,Xu(arguments)),Xr.push(";")),qt}return o(Jr,{def:Ur,toString:function(){return Yu([$r.length>0?"var "+$r.join(",")+";":"",Yu(Xr)])}})}function nr(){var Xr=br(),Jr=br(),$r=Xr.toString,Ur=Jr.toString;function qt(ur,zr){Jr(ur,zr,"=",Xr.def(ur,zr),";")}return o(function(){Xr.apply(Xr,Xu(arguments))},{def:Xr.def,entry:Xr,exit:Jr,save:qt,set:function(ur,zr,gn){qt(ur,zr),Xr(ur,zr,"=",gn,";")},toString:function(){return $r()+Ur()}})}function dr(){var Xr=Yu(arguments),Jr=nr(),$r=nr(),Ur=Jr.toString,qt=$r.toString;return o(Jr,{then:function(){return Jr.apply(Jr,Xu(arguments)),this},else:function(){return $r.apply($r,Xu(arguments)),this},toString:function(){var ur=qt();return ur&&(ur="else{"+ur+"}"),Yu(["if(",Xr,"){",Ur(),"}",ur])}})}var Nr=br(),Or={};function Wr(Xr,Jr){var $r=[];function Ur(){var Rr="a"+$r.length;return $r.push(Rr),Rr}Jr=Jr||0;for(var qt=0;qt<Jr;++qt)Ur();var ur=nr(),zr=ur.toString,gn=Or[Xr]=o(ur,{arg:Ur,toString:function(){return Yu(["function(",$r.join(),"){",zr(),"}"])}});return gn}function qr(){var Xr=['"use strict";',Nr,"return {"];Object.keys(Or).forEach(function(Ur){Xr.push('"',Ur,'":',Or[Ur].toString(),",")}),Xr.push("}");var Jr=Yu(Xr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),$r=Function.apply(null,St.concat(Jr));return $r.apply(null,It)}return{global:Nr,link:ir,block:br,proc:Wr,scope:nr,cond:dr,compile:qr}}var qu="xyzw".split(""),ev=5121,Ku=1,sm=2,om=0,am=1,lm=2,cm=3,Ip=4,tv=5,rv=6,nv="dither",iv="blend.enable",sv="blend.color",um="blend.equation",fm="blend.func",ov="depth.enable",av="depth.func",lv="depth.range",cv="depth.mask",dm="colorMask",uv="cull.enable",fv="cull.face",hm="frontFace",pm="lineWidth",dv="polygonOffset.enable",gm="polygonOffset.offset",hv="sample.alpha",pv="sample.enable",mm="sample.coverage",gv="stencil.enable",mv="stencil.mask",vm="stencil.func",_m="stencil.opFront",fp="stencil.opBack",vv="scissor.enable",Op="scissor.box",tu="viewport",dp="profile",ku="framebuffer",hp="vert",pp="frag",Mu="elements",Du="primitive",Iu="count",Np="offset",Fp="instances",gp="vao",ym="Width",wm="Height",Zu=ku+ym,Qu=ku+wm,b_=tu+ym,x_=tu+wm,_v="drawingBuffer",yv=_v+ym,wv=_v+wm,S_=[fm,um,vm,_m,fp,mm,tu,Op,gm],Ju=34962,Em=34963,T_=35632,C_=35633,Ev=3553,A_=34067,R_=2884,L_=3042,P_=3024,k_=2960,M_=2929,D_=3089,I_=32823,O_=32926,N_=32928,bm=5126,$p=35664,Bp=35665,zp=35666,xm=5124,Vp=35667,Up=35668,Gp=35669,Sm=35670,Hp=35671,jp=35672,Wp=35673,mp=35674,vp=35675,_p=35676,yp=35678,wp=35680,Tm=4,Ep=1028,Ou=1029,bv=2304,Cm=2305,F_=32775,$_=32776,B_=519,pu=7680,xv=0,Sv=1,Tv=32774,z_=513,Cv=36160,V_=36064,Wl={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Av=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],_f={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},gu={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Rv={frag:T_,vert:C_},Am={cw:bv,ccw:Cm};function Xp(ht){return Array.isArray(ht)||s(ht)||Ft(ht)}function Lv(ht){return ht.sort(function(St,It){return St===tu?-1:It===tu?1:St<It?-1:1})}function ho(ht,St,It,ir){this.thisDep=ht,this.contextDep=St,this.propDep=It,this.append=ir}function mu(ht){return ht&&!(ht.thisDep||ht.contextDep||ht.propDep)}function io(ht){return new ho(!1,!1,!1,ht)}function Uo(ht,St){var It=ht.type;if(It===om){var ir=ht.data.length;return new ho(!0,ir>=1,ir>=2,St)}else if(It===Ip){var br=ht.data;return new ho(br.thisDep,br.contextDep,br.propDep,St)}else{if(It===tv)return new ho(!1,!1,!1,St);if(It===rv){for(var nr=!1,dr=!1,Nr=!1,Or=0;Or<ht.data.length;++Or){var Wr=ht.data[Or];if(Wr.type===am)Nr=!0;else if(Wr.type===lm)dr=!0;else if(Wr.type===cm)nr=!0;else if(Wr.type===om){nr=!0;var qr=Wr.data;qr>=1&&(dr=!0),qr>=2&&(Nr=!0)}else Wr.type===Ip&&(nr=nr||Wr.data.thisDep,dr=dr||Wr.data.contextDep,Nr=Nr||Wr.data.propDep)}return new ho(nr,dr,Nr,St)}else return new ho(It===cm,It===lm,It===am,St)}}var Pv=new ho(!1,!1,!1,function(){});function U_(ht,St,It,ir,br,nr,dr,Nr,Or,Wr,qr,Xr,Jr,$r,Ur){var qt=Wr.Record,ur={add:32774,subtract:32778,"reverse subtract":32779};It.ext_blend_minmax&&(ur.min=F_,ur.max=$_);var zr=It.angle_instanced_arrays,gn=It.webgl_draw_buffers,Rr=It.oes_vertex_array_object,hn={dirty:!0,profile:Ur.profile},cn={},Pn=[],Sr={},wr={};function bn(At){return At.replace(".","_")}function tn(At,wt,Nt){var Yt=bn(At);Pn.push(At),cn[Yt]=hn[Yt]=!!Nt,Sr[Yt]=wt}function Br(At,wt,Nt){var Yt=bn(At);Pn.push(At),Array.isArray(Nt)?(hn[Yt]=Nt.slice(),cn[Yt]=Nt.slice()):hn[Yt]=cn[Yt]=Nt,wr[Yt]=wt}tn(nv,P_),tn(iv,L_),Br(sv,"blendColor",[0,0,0,0]),Br(um,"blendEquationSeparate",[Tv,Tv]),Br(fm,"blendFuncSeparate",[Sv,xv,Sv,xv]),tn(ov,M_,!0),Br(av,"depthFunc",z_),Br(lv,"depthRange",[0,1]),Br(cv,"depthMask",!0),Br(dm,dm,[!0,!0,!0,!0]),tn(uv,R_),Br(fv,"cullFace",Ou),Br(hm,hm,Cm),Br(pm,pm,1),tn(dv,I_),Br(gm,"polygonOffset",[0,0]),tn(hv,O_),tn(pv,N_),Br(mm,"sampleCoverage",[1,!1]),tn(gv,k_),Br(mv,"stencilMask",-1),Br(vm,"stencilFunc",[B_,0,-1]),Br(_m,"stencilOpSeparate",[Ep,pu,pu,pu]),Br(fp,"stencilOpSeparate",[Ou,pu,pu,pu]),tn(vv,D_),Br(Op,"scissor",[0,0,ht.drawingBufferWidth,ht.drawingBufferHeight]),Br(tu,tu,[0,0,ht.drawingBufferWidth,ht.drawingBufferHeight]);var rn={gl:ht,context:Jr,strings:St,next:cn,current:hn,draw:Xr,elements:nr,buffer:br,shader:qr,attributes:Wr.state,vao:Wr,uniforms:Or,framebuffer:Nr,extensions:It,timer:$r,isBufferArgs:Xp},on={primTypes:yt,compareFuncs:_f,blendFuncs:Wl,blendEquations:ur,stencilOps:gu,glTypes:zs,orientationType:Am};bt.optional(function(){rn.isArrayLike=_i}),gn&&(on.backBuffer=[Ou],on.drawBuffer=js(ir.maxDrawbuffers,function(At){return At===0?[0]:js(At,function(wt){return V_+wt})}));var Wn=0;function Un(){var At=E_(),wt=At.link,Nt=At.global;At.id=Wn++,At.batchId="0";var Yt=wt(rn),Kt=At.shared={props:"a0"};Object.keys(rn).forEach(function(Mt){Kt[Mt]=Nt.def(Yt,".",Mt)}),bt.optional(function(){At.CHECK=wt(bt),At.commandStr=bt.guessCommand(),At.command=wt(At.commandStr),At.assert=function(Mt,Pt,Jt){Mt("if(!(",Pt,"))",this.CHECK,".commandRaise(",wt(Jt),",",this.command,");")},on.invalidBlendCombinations=Av});var Ut=At.next={},Vt=At.current={};Object.keys(wr).forEach(function(Mt){Array.isArray(hn[Mt])&&(Ut[Mt]=Nt.def(Kt.next,".",Mt),Vt[Mt]=Nt.def(Kt.current,".",Mt))});var jt=At.constants={};Object.keys(on).forEach(function(Mt){jt[Mt]=Nt.def(JSON.stringify(on[Mt]))}),At.invoke=function(Mt,Pt){switch(Pt.type){case om:var Jt=["this",Kt.context,Kt.props,At.batchId];return Mt.def(wt(Pt.data),".call(",Jt.slice(0,Math.max(Pt.data.length+1,4)),")");case am:return Mt.def(Kt.props,Pt.data);case lm:return Mt.def(Kt.context,Pt.data);case cm:return Mt.def("this",Pt.data);case Ip:return Pt.data.append(At,Mt),Pt.data.ref;case tv:return Pt.data.toString();case rv:return Pt.data.map(function(Zt){return At.invoke(Mt,Zt)})}},At.attribCache={};var Lt={};return At.scopeAttrib=function(Mt){var Pt=St.id(Mt);if(Pt in Lt)return Lt[Pt];var Jt=Wr.scope[Pt];Jt||(Jt=Wr.scope[Pt]=new qt);var Zt=Lt[Pt]=wt(Jt);return Zt},At}function un(At){var wt=At.static,Nt=At.dynamic,Yt;if(dp in wt){var Kt=!!wt[dp];Yt=io(function(Vt,jt){return Kt}),Yt.enable=Kt}else if(dp in Nt){var Ut=Nt[dp];Yt=Uo(Ut,function(Vt,jt){return Vt.invoke(jt,Ut)})}return Yt}function pn(At,wt){var Nt=At.static,Yt=At.dynamic;if(ku in Nt){var Kt=Nt[ku];return Kt?(Kt=Nr.getFramebuffer(Kt),bt.command(Kt,"invalid framebuffer object"),io(function(Vt,jt){var Lt=Vt.link(Kt),Mt=Vt.shared;jt.set(Mt.framebuffer,".next",Lt);var Pt=Mt.context;return jt.set(Pt,"."+Zu,Lt+".width"),jt.set(Pt,"."+Qu,Lt+".height"),Lt})):io(function(Vt,jt){var Lt=Vt.shared;jt.set(Lt.framebuffer,".next","null");var Mt=Lt.context;return jt.set(Mt,"."+Zu,Mt+"."+yv),jt.set(Mt,"."+Qu,Mt+"."+wv),"null"})}else if(ku in Yt){var Ut=Yt[ku];return Uo(Ut,function(Vt,jt){var Lt=Vt.invoke(jt,Ut),Mt=Vt.shared,Pt=Mt.framebuffer,Jt=jt.def(Pt,".getFramebuffer(",Lt,")");bt.optional(function(){Vt.assert(jt,"!"+Lt+"||"+Jt,"invalid framebuffer object")}),jt.set(Pt,".next",Jt);var Zt=Mt.context;return jt.set(Zt,"."+Zu,Jt+"?"+Jt+".width:"+Zt+"."+yv),jt.set(Zt,"."+Qu,Jt+"?"+Jt+".height:"+Zt+"."+wv),Jt})}else return null}function On(At,wt,Nt){var Yt=At.static,Kt=At.dynamic;function Ut(Lt){if(Lt in Yt){var Mt=Yt[Lt];bt.commandType(Mt,"object","invalid "+Lt,Nt.commandStr);var Pt=!0,Jt=Mt.x|0,Zt=Mt.y|0,yr,Tr;return"width"in Mt?(yr=Mt.width|0,bt.command(yr>=0,"invalid "+Lt,Nt.commandStr)):Pt=!1,"height"in Mt?(Tr=Mt.height|0,bt.command(Tr>=0,"invalid "+Lt,Nt.commandStr)):Pt=!1,new ho(!Pt&&wt&&wt.thisDep,!Pt&&wt&&wt.contextDep,!Pt&&wt&&wt.propDep,function(An,wn){var Ar=An.shared.context,gr=yr;"width"in Mt||(gr=wn.def(Ar,".",Zu,"-",Jt));var Tn=Tr;return"height"in Mt||(Tn=wn.def(Ar,".",Qu,"-",Zt)),[Jt,Zt,gr,Tn]})}else if(Lt in Kt){var Qr=Kt[Lt],$n=Uo(Qr,function(An,wn){var Ar=An.invoke(wn,Qr);bt.optional(function(){An.assert(wn,Ar+"&&typeof "+Ar+'==="object"',"invalid "+Lt)});var gr=An.shared.context,Tn=wn.def(Ar,".x|0"),xn=wn.def(Ar,".y|0"),Nn=wn.def('"width" in ',Ar,"?",Ar,".width|0:","(",gr,".",Zu,"-",Tn,")"),bs=wn.def('"height" in ',Ar,"?",Ar,".height|0:","(",gr,".",Qu,"-",xn,")");return bt.optional(function(){An.assert(wn,Nn+">=0&&"+bs+">=0","invalid "+Lt)}),[Tn,xn,Nn,bs]});return wt&&($n.thisDep=$n.thisDep||wt.thisDep,$n.contextDep=$n.contextDep||wt.contextDep,$n.propDep=$n.propDep||wt.propDep),$n}else return wt?new ho(wt.thisDep,wt.contextDep,wt.propDep,function(An,wn){var Ar=An.shared.context;return[0,0,wn.def(Ar,".",Zu),wn.def(Ar,".",Qu)]}):null}var Vt=Ut(tu);if(Vt){var jt=Vt;Vt=new ho(Vt.thisDep,Vt.contextDep,Vt.propDep,function(Lt,Mt){var Pt=jt.append(Lt,Mt),Jt=Lt.shared.context;return Mt.set(Jt,"."+b_,Pt[2]),Mt.set(Jt,"."+x_,Pt[3]),Pt})}return{viewport:Vt,scissor_box:Ut(Op)}}function Xn(At,wt){var Nt=At.static,Yt=typeof Nt[pp]=="string"&&typeof Nt[hp]=="string";if(Yt){if(Object.keys(wt.dynamic).length>0)return null;var Kt=wt.static,Ut=Object.keys(Kt);if(Ut.length>0&&typeof Kt[Ut[0]]=="number"){for(var Vt=[],jt=0;jt<Ut.length;++jt)bt(typeof Kt[Ut[jt]]=="number","must specify all vertex attribute locations when using vaos"),Vt.push([Kt[Ut[jt]]|0,Ut[jt]]);return Vt}}return null}function ss(At,wt,Nt){var Yt=At.static,Kt=At.dynamic;function Ut(Pt){if(Pt in Yt){var Jt=St.id(Yt[Pt]);bt.optional(function(){qr.shader(Rv[Pt],Jt,bt.guessCommand())});var Zt=io(function(){return Jt});return Zt.id=Jt,Zt}else if(Pt in Kt){var yr=Kt[Pt];return Uo(yr,function(Tr,Qr){var $n=Tr.invoke(Qr,yr),An=Qr.def(Tr.shared.strings,".id(",$n,")");return bt.optional(function(){Qr(Tr.shared.shader,".shader(",Rv[Pt],",",An,",",Tr.command,");")}),An})}return null}var Vt=Ut(pp),jt=Ut(hp),Lt=null,Mt;return mu(Vt)&&mu(jt)?(Lt=qr.program(jt.id,Vt.id,null,Nt),Mt=io(function(Pt,Jt){return Pt.link(Lt)})):Mt=new ho(Vt&&Vt.thisDep||jt&&jt.thisDep,Vt&&Vt.contextDep||jt&&jt.contextDep,Vt&&Vt.propDep||jt&&jt.propDep,function(Pt,Jt){var Zt=Pt.shared.shader,yr;Vt?yr=Vt.append(Pt,Jt):yr=Jt.def(Zt,".",pp);var Tr;jt?Tr=jt.append(Pt,Jt):Tr=Jt.def(Zt,".",hp);var Qr=Zt+".program("+Tr+","+yr;return bt.optional(function(){Qr+=","+Pt.command}),Jt.def(Qr+")")}),{frag:Vt,vert:jt,progVar:Mt,program:Lt}}function Ws(At,wt){var Nt=At.static,Yt=At.dynamic,Kt={},Ut=!1;function Vt(){if(gp in Nt){var wn=Nt[gp];return wn!==null&&Wr.getVAO(wn)===null&&(wn=Wr.createVAO(wn)),Ut=!0,Kt.vao=wn,io(function(gr){var Tn=Wr.getVAO(wn);return Tn?gr.link(Tn):"null"})}else if(gp in Yt){Ut=!0;var Ar=Yt[gp];return Uo(Ar,function(gr,Tn){var xn=gr.invoke(Tn,Ar);return Tn.def(gr.shared.vao+".getVAO("+xn+")")})}return null}var jt=Vt(),Lt=!1;function Mt(){if(Mu in Nt){var wn=Nt[Mu];if(Kt.elements=wn,Xp(wn)){var Ar=Kt.elements=nr.create(wn,!0);wn=nr.getElements(Ar),Lt=!0}else wn&&(wn=nr.getElements(wn),Lt=!0,bt.command(wn,"invalid elements",wt.commandStr));var gr=io(function(xn,Nn){if(wn){var bs=xn.link(wn);return xn.ELEMENTS=bs,bs}return xn.ELEMENTS=null,null});return gr.value=wn,gr}else if(Mu in Yt){Lt=!0;var Tn=Yt[Mu];return Uo(Tn,function(xn,Nn){var bs=xn.shared,yo=bs.isBufferArgs,Fu=bs.elements,ru=xn.invoke(Nn,Tn),Yl=Nn.def("null"),vu=Nn.def(yo,"(",ru,")"),$u=xn.cond(vu).then(Yl,"=",Fu,".createStream(",ru,");").else(Yl,"=",Fu,".getElements(",ru,");");return bt.optional(function(){xn.assert($u.else,"!"+ru+"||"+Yl,"invalid elements")}),Nn.entry($u),Nn.exit(xn.cond(vu).then(Fu,".destroyStream(",Yl,");")),xn.ELEMENTS=Yl,Yl})}else if(Ut)return new ho(jt.thisDep,jt.contextDep,jt.propDep,function(xn,Nn){return Nn.def(xn.shared.vao+".currentVAO?"+xn.shared.elements+".getElements("+xn.shared.vao+".currentVAO.elements):null")});return null}var Pt=Mt();function Jt(){if(Du in Nt){var wn=Nt[Du];return Kt.primitive=wn,bt.commandParameter(wn,yt,"invalid primitve",wt.commandStr),io(function(gr,Tn){return yt[wn]})}else if(Du in Yt){var Ar=Yt[Du];return Uo(Ar,function(gr,Tn){var xn=gr.constants.primTypes,Nn=gr.invoke(Tn,Ar);return bt.optional(function(){gr.assert(Tn,Nn+" in "+xn,"invalid primitive, must be one of "+Object.keys(yt))}),Tn.def(xn,"[",Nn,"]")})}else{if(Lt)return mu(Pt)?Pt.value?io(function(gr,Tn){return Tn.def(gr.ELEMENTS,".primType")}):io(function(){return Tm}):new ho(Pt.thisDep,Pt.contextDep,Pt.propDep,function(gr,Tn){var xn=gr.ELEMENTS;return Tn.def(xn,"?",xn,".primType:",Tm)});if(Ut)return new ho(jt.thisDep,jt.contextDep,jt.propDep,function(gr,Tn){return Tn.def(gr.shared.vao+".currentVAO?"+gr.shared.vao+".currentVAO.primitive:"+Tm)})}return null}function Zt(wn,Ar){if(wn in Nt){var gr=Nt[wn]|0;return Ar?Kt.offset=gr:Kt.instances=gr,bt.command(!Ar||gr>=0,"invalid "+wn,wt.commandStr),io(function(xn,Nn){return Ar&&(xn.OFFSET=gr),gr})}else if(wn in Yt){var Tn=Yt[wn];return Uo(Tn,function(xn,Nn){var bs=xn.invoke(Nn,Tn);return Ar&&(xn.OFFSET=bs,bt.optional(function(){xn.assert(Nn,bs+">=0","invalid "+wn)})),bs})}else if(Ar){if(Lt)return io(function(xn,Nn){return xn.OFFSET=0,0});if(Ut)return new ho(jt.thisDep,jt.contextDep,jt.propDep,function(xn,Nn){return Nn.def(xn.shared.vao+".currentVAO?"+xn.shared.vao+".currentVAO.offset:0")})}else if(Ut)return new ho(jt.thisDep,jt.contextDep,jt.propDep,function(xn,Nn){return Nn.def(xn.shared.vao+".currentVAO?"+xn.shared.vao+".currentVAO.instances:-1")});return null}var yr=Zt(Np,!0);function Tr(){if(Iu in Nt){var wn=Nt[Iu]|0;return Kt.count=wn,bt.command(typeof wn=="number"&&wn>=0,"invalid vertex count",wt.commandStr),io(function(){return wn})}else if(Iu in Yt){var Ar=Yt[Iu];return Uo(Ar,function(Nn,bs){var yo=Nn.invoke(bs,Ar);return bt.optional(function(){Nn.assert(bs,"typeof "+yo+'==="number"&&'+yo+">=0&&"+yo+"===("+yo+"|0)","invalid vertex count")}),yo})}else if(Lt)if(mu(Pt)){if(Pt)return yr?new ho(yr.thisDep,yr.contextDep,yr.propDep,function(Nn,bs){var yo=bs.def(Nn.ELEMENTS,".vertCount-",Nn.OFFSET);return bt.optional(function(){Nn.assert(bs,yo+">=0","invalid vertex offset/element buffer too small")}),yo}):io(function(Nn,bs){return bs.def(Nn.ELEMENTS,".vertCount")});var gr=io(function(){return-1});return bt.optional(function(){gr.MISSING=!0}),gr}else{var Tn=new ho(Pt.thisDep||yr.thisDep,Pt.contextDep||yr.contextDep,Pt.propDep||yr.propDep,function(Nn,bs){var yo=Nn.ELEMENTS;return Nn.OFFSET?bs.def(yo,"?",yo,".vertCount-",Nn.OFFSET,":-1"):bs.def(yo,"?",yo,".vertCount:-1")});return bt.optional(function(){Tn.DYNAMIC=!0}),Tn}else if(Ut){var xn=new ho(jt.thisDep,jt.contextDep,jt.propDep,function(Nn,bs){return bs.def(Nn.shared.vao,".currentVAO?",Nn.shared.vao,".currentVAO.count:-1")});return xn}return null}var Qr=Jt(),$n=Tr(),An=Zt(Fp,!1);return{elements:Pt,primitive:Qr,count:$n,instances:An,offset:yr,vao:jt,vaoActive:Ut,elementsActive:Lt,static:Kt}}function qs(At,wt){var Nt=At.static,Yt=At.dynamic,Kt={};return Pn.forEach(function(Ut){var Vt=bn(Ut);function jt(Lt,Mt){if(Ut in Nt){var Pt=Lt(Nt[Ut]);Kt[Vt]=io(function(){return Pt})}else if(Ut in Yt){var Jt=Yt[Ut];Kt[Vt]=Uo(Jt,function(Zt,yr){return Mt(Zt,yr,Zt.invoke(yr,Jt))})}}switch(Ut){case uv:case iv:case nv:case gv:case ov:case vv:case dv:case hv:case pv:case cv:return jt(function(Lt){return bt.commandType(Lt,"boolean",Ut,wt.commandStr),Lt},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,"typeof "+Pt+'==="boolean"',"invalid flag "+Ut,Lt.commandStr)}),Pt});case av:return jt(function(Lt){return bt.commandParameter(Lt,_f,"invalid "+Ut,wt.commandStr),_f[Lt]},function(Lt,Mt,Pt){var Jt=Lt.constants.compareFuncs;return bt.optional(function(){Lt.assert(Mt,Pt+" in "+Jt,"invalid "+Ut+", must be one of "+Object.keys(_f))}),Mt.def(Jt,"[",Pt,"]")});case lv:return jt(function(Lt){return bt.command(_i(Lt)&&Lt.length===2&&typeof Lt[0]=="number"&&typeof Lt[1]=="number"&&Lt[0]<=Lt[1],"depth range is 2d array",wt.commandStr),Lt},function(Lt,Mt,Pt){bt.optional(function(){Lt.assert(Mt,Lt.shared.isArrayLike+"("+Pt+")&&"+Pt+".length===2&&typeof "+Pt+'[0]==="number"&&typeof '+Pt+'[1]==="number"&&'+Pt+"[0]<="+Pt+"[1]","depth range must be a 2d array")});var Jt=Mt.def("+",Pt,"[0]"),Zt=Mt.def("+",Pt,"[1]");return[Jt,Zt]});case fm:return jt(function(Lt){bt.commandType(Lt,"object","blend.func",wt.commandStr);var Mt="srcRGB"in Lt?Lt.srcRGB:Lt.src,Pt="srcAlpha"in Lt?Lt.srcAlpha:Lt.src,Jt="dstRGB"in Lt?Lt.dstRGB:Lt.dst,Zt="dstAlpha"in Lt?Lt.dstAlpha:Lt.dst;return bt.commandParameter(Mt,Wl,Vt+".srcRGB",wt.commandStr),bt.commandParameter(Pt,Wl,Vt+".srcAlpha",wt.commandStr),bt.commandParameter(Jt,Wl,Vt+".dstRGB",wt.commandStr),bt.commandParameter(Zt,Wl,Vt+".dstAlpha",wt.commandStr),bt.command(Av.indexOf(Mt+", "+Jt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Mt+", "+Jt+")",wt.commandStr),[Wl[Mt],Wl[Jt],Wl[Pt],Wl[Zt]]},function(Lt,Mt,Pt){var Jt=Lt.constants.blendFuncs;bt.optional(function(){Lt.assert(Mt,Pt+"&&typeof "+Pt+'==="object"',"invalid blend func, must be an object")});function Zt(Ar,gr){var Tn=Mt.def('"',Ar,gr,'" in ',Pt,"?",Pt,".",Ar,gr,":",Pt,".",Ar);return bt.optional(function(){Lt.assert(Mt,Tn+" in "+Jt,"invalid "+Ut+"."+Ar+gr+", must be one of "+Object.keys(Wl))}),Tn}var yr=Zt("src","RGB"),Tr=Zt("dst","RGB");bt.optional(function(){var Ar=Lt.constants.invalidBlendCombinations;Lt.assert(Mt,Ar+".indexOf("+yr+'+", "+'+Tr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Qr=Mt.def(Jt,"[",yr,"]"),$n=Mt.def(Jt,"[",Zt("src","Alpha"),"]"),An=Mt.def(Jt,"[",Tr,"]"),wn=Mt.def(Jt,"[",Zt("dst","Alpha"),"]");return[Qr,An,$n,wn]});case um:return jt(function(Lt){if(typeof Lt=="string")return bt.commandParameter(Lt,ur,"invalid "+Ut,wt.commandStr),[ur[Lt],ur[Lt]];if(typeof Lt=="object")return bt.commandParameter(Lt.rgb,ur,Ut+".rgb",wt.commandStr),bt.commandParameter(Lt.alpha,ur,Ut+".alpha",wt.commandStr),[ur[Lt.rgb],ur[Lt.alpha]];bt.commandRaise("invalid blend.equation",wt.commandStr)},function(Lt,Mt,Pt){var Jt=Lt.constants.blendEquations,Zt=Mt.def(),yr=Mt.def(),Tr=Lt.cond("typeof ",Pt,'==="string"');return bt.optional(function(){function Qr($n,An,wn){Lt.assert($n,wn+" in "+Jt,"invalid "+An+", must be one of "+Object.keys(ur))}Qr(Tr.then,Ut,Pt),Lt.assert(Tr.else,Pt+"&&typeof "+Pt+'==="object"',"invalid "+Ut),Qr(Tr.else,Ut+".rgb",Pt+".rgb"),Qr(Tr.else,Ut+".alpha",Pt+".alpha")}),Tr.then(Zt,"=",yr,"=",Jt,"[",Pt,"];"),Tr.else(Zt,"=",Jt,"[",Pt,".rgb];",yr,"=",Jt,"[",Pt,".alpha];"),Mt(Tr),[Zt,yr]});case sv:return jt(function(Lt){return bt.command(_i(Lt)&&Lt.length===4,"blend.color must be a 4d array",wt.commandStr),js(4,function(Mt){return+Lt[Mt]})},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,Lt.shared.isArrayLike+"("+Pt+")&&"+Pt+".length===4","blend.color must be a 4d array")}),js(4,function(Jt){return Mt.def("+",Pt,"[",Jt,"]")})});case mv:return jt(function(Lt){return bt.commandType(Lt,"number",Vt,wt.commandStr),Lt|0},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,"typeof "+Pt+'==="number"',"invalid stencil.mask")}),Mt.def(Pt,"|0")});case vm:return jt(function(Lt){bt.commandType(Lt,"object",Vt,wt.commandStr);var Mt=Lt.cmp||"keep",Pt=Lt.ref||0,Jt="mask"in Lt?Lt.mask:-1;return bt.commandParameter(Mt,_f,Ut+".cmp",wt.commandStr),bt.commandType(Pt,"number",Ut+".ref",wt.commandStr),bt.commandType(Jt,"number",Ut+".mask",wt.commandStr),[_f[Mt],Pt,Jt]},function(Lt,Mt,Pt){var Jt=Lt.constants.compareFuncs;bt.optional(function(){function Qr(){Lt.assert(Mt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Qr(Pt+"&&typeof ",Pt,'==="object"'),Qr('!("cmp" in ',Pt,")||(",Pt,".cmp in ",Jt,")")});var Zt=Mt.def('"cmp" in ',Pt,"?",Jt,"[",Pt,".cmp]",":",pu),yr=Mt.def(Pt,".ref|0"),Tr=Mt.def('"mask" in ',Pt,"?",Pt,".mask|0:-1");return[Zt,yr,Tr]});case _m:case fp:return jt(function(Lt){bt.commandType(Lt,"object",Vt,wt.commandStr);var Mt=Lt.fail||"keep",Pt=Lt.zfail||"keep",Jt=Lt.zpass||"keep";return bt.commandParameter(Mt,gu,Ut+".fail",wt.commandStr),bt.commandParameter(Pt,gu,Ut+".zfail",wt.commandStr),bt.commandParameter(Jt,gu,Ut+".zpass",wt.commandStr),[Ut===fp?Ou:Ep,gu[Mt],gu[Pt],gu[Jt]]},function(Lt,Mt,Pt){var Jt=Lt.constants.stencilOps;bt.optional(function(){Lt.assert(Mt,Pt+"&&typeof "+Pt+'==="object"',"invalid "+Ut)});function Zt(yr){return bt.optional(function(){Lt.assert(Mt,'!("'+yr+'" in '+Pt+")||("+Pt+"."+yr+" in "+Jt+")","invalid "+Ut+"."+yr+", must be one of "+Object.keys(gu))}),Mt.def('"',yr,'" in ',Pt,"?",Jt,"[",Pt,".",yr,"]:",pu)}return[Ut===fp?Ou:Ep,Zt("fail"),Zt("zfail"),Zt("zpass")]});case gm:return jt(function(Lt){bt.commandType(Lt,"object",Vt,wt.commandStr);var Mt=Lt.factor|0,Pt=Lt.units|0;return bt.commandType(Mt,"number",Vt+".factor",wt.commandStr),bt.commandType(Pt,"number",Vt+".units",wt.commandStr),[Mt,Pt]},function(Lt,Mt,Pt){bt.optional(function(){Lt.assert(Mt,Pt+"&&typeof "+Pt+'==="object"',"invalid "+Ut)});var Jt=Mt.def(Pt,".factor|0"),Zt=Mt.def(Pt,".units|0");return[Jt,Zt]});case fv:return jt(function(Lt){var Mt=0;return Lt==="front"?Mt=Ep:Lt==="back"&&(Mt=Ou),bt.command(!!Mt,Vt,wt.commandStr),Mt},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,Pt+'==="front"||'+Pt+'==="back"',"invalid cull.face")}),Mt.def(Pt,'==="front"?',Ep,":",Ou)});case pm:return jt(function(Lt){return bt.command(typeof Lt=="number"&&Lt>=ir.lineWidthDims[0]&&Lt<=ir.lineWidthDims[1],"invalid line width, must be a positive number between "+ir.lineWidthDims[0]+" and "+ir.lineWidthDims[1],wt.commandStr),Lt},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,"typeof "+Pt+'==="number"&&'+Pt+">="+ir.lineWidthDims[0]+"&&"+Pt+"<="+ir.lineWidthDims[1],"invalid line width")}),Pt});case hm:return jt(function(Lt){return bt.commandParameter(Lt,Am,Vt,wt.commandStr),Am[Lt]},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,Pt+'==="cw"||'+Pt+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Mt.def(Pt+'==="cw"?'+bv+":"+Cm)});case dm:return jt(function(Lt){return bt.command(_i(Lt)&&Lt.length===4,"color.mask must be length 4 array",wt.commandStr),Lt.map(function(Mt){return!!Mt})},function(Lt,Mt,Pt){return bt.optional(function(){Lt.assert(Mt,Lt.shared.isArrayLike+"("+Pt+")&&"+Pt+".length===4","invalid color.mask")}),js(4,function(Jt){return"!!"+Pt+"["+Jt+"]"})});case mm:return jt(function(Lt){bt.command(typeof Lt=="object"&&Lt,Vt,wt.commandStr);var Mt="value"in Lt?Lt.value:1,Pt=!!Lt.invert;return bt.command(typeof Mt=="number"&&Mt>=0&&Mt<=1,"sample.coverage.value must be a number between 0 and 1",wt.commandStr),[Mt,Pt]},function(Lt,Mt,Pt){bt.optional(function(){Lt.assert(Mt,Pt+"&&typeof "+Pt+'==="object"',"invalid sample.coverage")});var Jt=Mt.def('"value" in ',Pt,"?+",Pt,".value:1"),Zt=Mt.def("!!",Pt,".invert");return[Jt,Zt]})}}),Kt}function as(At,wt){var Nt=At.static,Yt=At.dynamic,Kt={};return Object.keys(Nt).forEach(function(Ut){var Vt=Nt[Ut],jt;if(typeof Vt=="number"||typeof Vt=="boolean")jt=io(function(){return Vt});else if(typeof Vt=="function"){var Lt=Vt._reglType;Lt==="texture2d"||Lt==="textureCube"?jt=io(function(Mt){return Mt.link(Vt)}):Lt==="framebuffer"||Lt==="framebufferCube"?(bt.command(Vt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ut+'"',wt.commandStr),jt=io(function(Mt){return Mt.link(Vt.color[0])})):bt.commandRaise('invalid data for uniform "'+Ut+'"',wt.commandStr)}else _i(Vt)?jt=io(function(Mt){var Pt=Mt.global.def("[",js(Vt.length,function(Jt){return bt.command(typeof Vt[Jt]=="number"||typeof Vt[Jt]=="boolean","invalid uniform "+Ut,Mt.commandStr),Vt[Jt]}),"]");return Pt}):bt.commandRaise('invalid or missing data for uniform "'+Ut+'"',wt.commandStr);jt.value=Vt,Kt[Ut]=jt}),Object.keys(Yt).forEach(function(Ut){var Vt=Yt[Ut];Kt[Ut]=Uo(Vt,function(jt,Lt){return jt.invoke(Lt,Vt)})}),Kt}function lo(At,wt){var Nt=At.static,Yt=At.dynamic,Kt={};return Object.keys(Nt).forEach(function(Ut){var Vt=Nt[Ut],jt=St.id(Ut),Lt=new qt;if(Xp(Vt))Lt.state=Ku,Lt.buffer=br.getBuffer(br.create(Vt,Ju,!1,!0)),Lt.type=0;else{var Mt=br.getBuffer(Vt);if(Mt)Lt.state=Ku,Lt.buffer=Mt,Lt.type=0;else if(bt.command(typeof Vt=="object"&&Vt,"invalid data for attribute "+Ut,wt.commandStr),"constant"in Vt){var Pt=Vt.constant;Lt.buffer="null",Lt.state=sm,typeof Pt=="number"?Lt.x=Pt:(bt.command(_i(Pt)&&Pt.length>0&&Pt.length<=4,"invalid constant for attribute "+Ut,wt.commandStr),qu.forEach(function(An,wn){wn<Pt.length&&(Lt[An]=Pt[wn])}))}else{Xp(Vt.buffer)?Mt=br.getBuffer(br.create(Vt.buffer,Ju,!1,!0)):Mt=br.getBuffer(Vt.buffer),bt.command(!!Mt,'missing buffer for attribute "'+Ut+'"',wt.commandStr);var Jt=Vt.offset|0;bt.command(Jt>=0,'invalid offset for attribute "'+Ut+'"',wt.commandStr);var Zt=Vt.stride|0;bt.command(Zt>=0&&Zt<256,'invalid stride for attribute "'+Ut+'", must be integer betweeen [0, 255]',wt.commandStr);var yr=Vt.size|0;bt.command(!("size"in Vt)||yr>0&&yr<=4,'invalid size for attribute "'+Ut+'", must be 1,2,3,4',wt.commandStr);var Tr=!!Vt.normalized,Qr=0;"type"in Vt&&(bt.commandParameter(Vt.type,zs,"invalid type for attribute "+Ut,wt.commandStr),Qr=zs[Vt.type]);var $n=Vt.divisor|0;bt.optional(function(){"divisor"in Vt&&(bt.command($n===0||zr,'cannot specify divisor for attribute "'+Ut+'", instancing not supported',wt.commandStr),bt.command($n>=0,'invalid divisor for attribute "'+Ut+'"',wt.commandStr));var An=wt.commandStr,wn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Vt).forEach(function(Ar){bt.command(wn.indexOf(Ar)>=0,'unknown parameter "'+Ar+'" for attribute pointer "'+Ut+'" (valid parameters are '+wn+")",An)})}),Lt.buffer=Mt,Lt.state=Ku,Lt.size=yr,Lt.normalized=Tr,Lt.type=Qr||Mt.dtype,Lt.offset=Jt,Lt.stride=Zt,Lt.divisor=$n}}Kt[Ut]=io(function(An,wn){var Ar=An.attribCache;if(jt in Ar)return Ar[jt];var gr={isStream:!1};return Object.keys(Lt).forEach(function(Tn){gr[Tn]=Lt[Tn]}),Lt.buffer&&(gr.buffer=An.link(Lt.buffer),gr.type=gr.type||gr.buffer+".dtype"),Ar[jt]=gr,gr})}),Object.keys(Yt).forEach(function(Ut){var Vt=Yt[Ut];function jt(Lt,Mt){var Pt=Lt.invoke(Mt,Vt),Jt=Lt.shared,Zt=Lt.constants,yr=Jt.isBufferArgs,Tr=Jt.buffer;bt.optional(function(){Lt.assert(Mt,Pt+"&&(typeof "+Pt+'==="object"||typeof '+Pt+'==="function")&&('+yr+"("+Pt+")||"+Tr+".getBuffer("+Pt+")||"+Tr+".getBuffer("+Pt+".buffer)||"+yr+"("+Pt+'.buffer)||("constant" in '+Pt+"&&(typeof "+Pt+'.constant==="number"||'+Jt.isArrayLike+"("+Pt+".constant))))",'invalid dynamic attribute "'+Ut+'"')});var Qr={isStream:Mt.def(!1)},$n=new qt;$n.state=Ku,Object.keys($n).forEach(function(gr){Qr[gr]=Mt.def(""+$n[gr])});var An=Qr.buffer,wn=Qr.type;Mt("if(",yr,"(",Pt,")){",Qr.isStream,"=true;",An,"=",Tr,".createStream(",Ju,",",Pt,");",wn,"=",An,".dtype;","}else{",An,"=",Tr,".getBuffer(",Pt,");","if(",An,"){",wn,"=",An,".dtype;",'}else if("constant" in ',Pt,"){",Qr.state,"=",sm,";","if(typeof "+Pt+'.constant === "number"){',Qr[qu[0]],"=",Pt,".constant;",qu.slice(1).map(function(gr){return Qr[gr]}).join("="),"=0;","}else{",qu.map(function(gr,Tn){return Qr[gr]+"="+Pt+".constant.length>"+Tn+"?"+Pt+".constant["+Tn+"]:0;"}).join(""),"}}else{","if(",yr,"(",Pt,".buffer)){",An,"=",Tr,".createStream(",Ju,",",Pt,".buffer);","}else{",An,"=",Tr,".getBuffer(",Pt,".buffer);","}",wn,'="type" in ',Pt,"?",Zt.glTypes,"[",Pt,".type]:",An,".dtype;",Qr.normalized,"=!!",Pt,".normalized;");function Ar(gr){Mt(Qr[gr],"=",Pt,".",gr,"|0;")}return Ar("size"),Ar("offset"),Ar("stride"),Ar("divisor"),Mt("}}"),Mt.exit("if(",Qr.isStream,"){",Tr,".destroyStream(",An,");","}"),Qr}Kt[Ut]=Uo(Vt,jt)}),Kt}function Vs(At){var wt=At.static,Nt=At.dynamic,Yt={};return Object.keys(wt).forEach(function(Kt){var Ut=wt[Kt];Yt[Kt]=io(function(Vt,jt){return typeof Ut=="number"||typeof Ut=="boolean"?""+Ut:Vt.link(Ut)})}),Object.keys(Nt).forEach(function(Kt){var Ut=Nt[Kt];Yt[Kt]=Uo(Ut,function(Vt,jt){return Vt.invoke(jt,Ut)})}),Yt}function so(At,wt,Nt,Yt,Kt){var Ut=At.static,Vt=At.dynamic;bt.optional(function(){var Ar=[ku,hp,pp,Mu,Du,Np,Iu,Fp,dp,gp].concat(Pn);function gr(Tn){Object.keys(Tn).forEach(function(xn){bt.command(Ar.indexOf(xn)>=0,'unknown parameter "'+xn+'"',Kt.commandStr)})}gr(Ut),gr(Vt)});var jt=Xn(At,wt),Lt=pn(At),Mt=On(At,Lt,Kt),Pt=Ws(At,Kt),Jt=qs(At,Kt),Zt=ss(At,Kt,jt);function yr(Ar){var gr=Mt[Ar];gr&&(Jt[Ar]=gr)}yr(tu),yr(bn(Op));var Tr=Object.keys(Jt).length>0,Qr={framebuffer:Lt,draw:Pt,shader:Zt,state:Jt,dirty:Tr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Qr.profile=un(At),Qr.uniforms=as(Nt,Kt),Qr.drawVAO=Qr.scopeVAO=Pt.vao,!Qr.drawVAO&&Zt.program&&!jt&&It.angle_instanced_arrays&&Pt.static.elements){var $n=!0,An=Zt.program.attributes.map(function(Ar){var gr=wt.static[Ar];return $n=$n&&!!gr,gr});if($n&&An.length>0){var wn=Wr.getVAO(Wr.createVAO({attributes:An,elements:Pt.static.elements}));Qr.drawVAO=new ho(null,null,null,function(Ar,gr){return Ar.link(wn)}),Qr.useVAO=!0}}return jt?Qr.useVAO=!0:Qr.attributes=lo(wt,Kt),Qr.context=Vs(Yt),Qr}function co(At,wt,Nt){var Yt=At.shared,Kt=Yt.context,Ut=At.scope();Object.keys(Nt).forEach(function(Vt){wt.save(Kt,"."+Vt);var jt=Nt[Vt],Lt=jt.append(At,wt);Array.isArray(Lt)?Ut(Kt,".",Vt,"=[",Lt.join(),"];"):Ut(Kt,".",Vt,"=",Lt,";")}),wt(Ut)}function uo(At,wt,Nt,Yt){var Kt=At.shared,Ut=Kt.gl,Vt=Kt.framebuffer,jt;gn&&(jt=wt.def(Kt.extensions,".webgl_draw_buffers"));var Lt=At.constants,Mt=Lt.drawBuffer,Pt=Lt.backBuffer,Jt;Nt?Jt=Nt.append(At,wt):Jt=wt.def(Vt,".next"),Yt||wt("if(",Jt,"!==",Vt,".cur){"),wt("if(",Jt,"){",Ut,".bindFramebuffer(",Cv,",",Jt,".framebuffer);"),gn&&wt(jt,".drawBuffersWEBGL(",Mt,"[",Jt,".colorAttachments.length]);"),wt("}else{",Ut,".bindFramebuffer(",Cv,",null);"),gn&&wt(jt,".drawBuffersWEBGL(",Pt,");"),wt("}",Vt,".cur=",Jt,";"),Yt||wt("}")}function po(At,wt,Nt){var Yt=At.shared,Kt=Yt.gl,Ut=At.current,Vt=At.next,jt=Yt.current,Lt=Yt.next,Mt=At.cond(jt,".dirty");Pn.forEach(function(Pt){var Jt=bn(Pt);if(!(Jt in Nt.state)){var Zt,yr;if(Jt in Vt){Zt=Vt[Jt],yr=Ut[Jt];var Tr=js(hn[Jt].length,function($n){return Mt.def(Zt,"[",$n,"]")});Mt(At.cond(Tr.map(function($n,An){return $n+"!=="+yr+"["+An+"]"}).join("||")).then(Kt,".",wr[Jt],"(",Tr,");",Tr.map(function($n,An){return yr+"["+An+"]="+$n}).join(";"),";"))}else{Zt=Mt.def(Lt,".",Jt);var Qr=At.cond(Zt,"!==",jt,".",Jt);Mt(Qr),Jt in Sr?Qr(At.cond(Zt).then(Kt,".enable(",Sr[Jt],");").else(Kt,".disable(",Sr[Jt],");"),jt,".",Jt,"=",Zt,";"):Qr(Kt,".",wr[Jt],"(",Zt,");",jt,".",Jt,"=",Zt,";")}}}),Object.keys(Nt.state).length===0&&Mt(jt,".dirty=false;"),wt(Mt)}function vo(At,wt,Nt,Yt){var Kt=At.shared,Ut=At.current,Vt=Kt.current,jt=Kt.gl;Lv(Object.keys(Nt)).forEach(function(Lt){var Mt=Nt[Lt];if(!(Yt&&!Yt(Mt))){var Pt=Mt.append(At,wt);if(Sr[Lt]){var Jt=Sr[Lt];mu(Mt)?Pt?wt(jt,".enable(",Jt,");"):wt(jt,".disable(",Jt,");"):wt(At.cond(Pt).then(jt,".enable(",Jt,");").else(jt,".disable(",Jt,");")),wt(Vt,".",Lt,"=",Pt,";")}else if(_i(Pt)){var Zt=Ut[Lt];wt(jt,".",wr[Lt],"(",Pt,");",Pt.map(function(yr,Tr){return Zt+"["+Tr+"]="+yr}).join(";"),";")}else wt(jt,".",wr[Lt],"(",Pt,");",Vt,".",Lt,"=",Pt,";")}})}function Js(At,wt){zr&&(At.instancing=wt.def(At.shared.extensions,".angle_instanced_arrays"))}function es(At,wt,Nt,Yt,Kt){var Ut=At.shared,Vt=At.stats,jt=Ut.current,Lt=Ut.timer,Mt=Nt.profile;function Pt(){return typeof performance>"u"?"Date.now()":"performance.now()"}var Jt,Zt;function yr(Ar){Jt=wt.def(),Ar(Jt,"=",Pt(),";"),typeof Kt=="string"?Ar(Vt,".count+=",Kt,";"):Ar(Vt,".count++;"),$r&&(Yt?(Zt=wt.def(),Ar(Zt,"=",Lt,".getNumPendingQueries();")):Ar(Lt,".beginQuery(",Vt,");"))}function Tr(Ar){Ar(Vt,".cpuTime+=",Pt(),"-",Jt,";"),$r&&(Yt?Ar(Lt,".pushScopeStats(",Zt,",",Lt,".getNumPendingQueries(),",Vt,");"):Ar(Lt,".endQuery();"))}function Qr(Ar){var gr=wt.def(jt,".profile");wt(jt,".profile=",Ar,";"),wt.exit(jt,".profile=",gr,";")}var $n;if(Mt){if(mu(Mt)){Mt.enable?(yr(wt),Tr(wt.exit),Qr("true")):Qr("false");return}$n=Mt.append(At,wt),Qr($n)}else $n=wt.def(jt,".profile");var An=At.block();yr(An),wt("if(",$n,"){",An,"}");var wn=At.block();Tr(wn),wt.exit("if(",$n,"){",wn,"}")}function _o(At,wt,Nt,Yt,Kt){var Ut=At.shared;function Vt(Lt){switch(Lt){case $p:case Vp:case Hp:return 2;case Bp:case Up:case jp:return 3;case zp:case Gp:case Wp:return 4;default:return 1}}function jt(Lt,Mt,Pt){var Jt=Ut.gl,Zt=wt.def(Lt,".location"),yr=wt.def(Ut.attributes,"[",Zt,"]"),Tr=Pt.state,Qr=Pt.buffer,$n=[Pt.x,Pt.y,Pt.z,Pt.w],An=["buffer","normalized","offset","stride"];function wn(){wt("if(!",yr,".buffer){",Jt,".enableVertexAttribArray(",Zt,");}");var gr=Pt.type,Tn;if(Pt.size?Tn=wt.def(Pt.size,"||",Mt):Tn=Mt,wt("if(",yr,".type!==",gr,"||",yr,".size!==",Tn,"||",An.map(function(Nn){return yr+"."+Nn+"!=="+Pt[Nn]}).join("||"),"){",Jt,".bindBuffer(",Ju,",",Qr,".buffer);",Jt,".vertexAttribPointer(",[Zt,Tn,gr,Pt.normalized,Pt.stride,Pt.offset],");",yr,".type=",gr,";",yr,".size=",Tn,";",An.map(function(Nn){return yr+"."+Nn+"="+Pt[Nn]+";"}).join(""),"}"),zr){var xn=Pt.divisor;wt("if(",yr,".divisor!==",xn,"){",At.instancing,".vertexAttribDivisorANGLE(",[Zt,xn],");",yr,".divisor=",xn,";}")}}function Ar(){wt("if(",yr,".buffer){",Jt,".disableVertexAttribArray(",Zt,");",yr,".buffer=null;","}if(",qu.map(function(gr,Tn){return yr+"."+gr+"!=="+$n[Tn]}).join("||"),"){",Jt,".vertexAttrib4f(",Zt,",",$n,");",qu.map(function(gr,Tn){return yr+"."+gr+"="+$n[Tn]+";"}).join(""),"}")}Tr===Ku?wn():Tr===sm?Ar():(wt("if(",Tr,"===",Ku,"){"),wn(),wt("}else{"),Ar(),wt("}"))}Yt.forEach(function(Lt){var Mt=Lt.name,Pt=Nt.attributes[Mt],Jt;if(Pt){if(!Kt(Pt))return;Jt=Pt.append(At,wt)}else{if(!Kt(Pv))return;var Zt=At.scopeAttrib(Mt);bt.optional(function(){At.assert(wt,Zt+".state","missing attribute "+Mt)}),Jt={},Object.keys(new qt).forEach(function(yr){Jt[yr]=wt.def(Zt,".",yr)})}jt(At.link(Lt),Vt(Lt.info.type),Jt)})}function Es(At,wt,Nt,Yt,Kt,Ut){for(var Vt=At.shared,jt=Vt.gl,Lt={},Mt,Pt=0;Pt<Yt.length;++Pt){var Jt=Yt[Pt],Zt=Jt.name,yr=Jt.info.type,Tr=Jt.info.size,Qr=Nt.uniforms[Zt];if(Tr>1){if(!Qr)continue;var $n=Zt.replace("[0]","");if(Lt[$n])continue;Lt[$n]=1}var An=At.link(Jt),wn=An+".location",Ar;if(Qr){if(!Kt(Qr))continue;if(mu(Qr)){var gr=Qr.value;if(bt.command(gr!==null&&typeof gr<"u",'missing uniform "'+Zt+'"',At.commandStr),yr===yp||yr===wp){bt.command(typeof gr=="function"&&(yr===yp&&(gr._reglType==="texture2d"||gr._reglType==="framebuffer")||yr===wp&&(gr._reglType==="textureCube"||gr._reglType==="framebufferCube")),"invalid texture for uniform "+Zt,At.commandStr);var Tn=At.link(gr._texture||gr.color[0]._texture);wt(jt,".uniform1i(",wn,",",Tn+".bind());"),wt.exit(Tn,".unbind();")}else if(yr===mp||yr===vp||yr===_p){bt.optional(function(){bt.command(_i(gr),"invalid matrix for uniform "+Zt,At.commandStr),bt.command(yr===mp&&gr.length===4||yr===vp&&gr.length===9||yr===_p&&gr.length===16,"invalid length for matrix uniform "+Zt,At.commandStr)});var xn=At.global.def("new Float32Array(["+Array.prototype.slice.call(gr)+"])"),Nn=2;yr===vp?Nn=3:yr===_p&&(Nn=4),wt(jt,".uniformMatrix",Nn,"fv(",wn,",false,",xn,");")}else{switch(yr){case bm:Tr===1?bt.commandType(gr,"number","uniform "+Zt,At.commandStr):bt.command(_i(gr)&&gr.length===Tr,"uniform "+Zt,At.commandStr),Mt="1f";break;case $p:bt.command(_i(gr)&&gr.length&&gr.length%2===0&&gr.length<=Tr*2,"uniform "+Zt,At.commandStr),Mt="2f";break;case Bp:bt.command(_i(gr)&&gr.length&&gr.length%3===0&&gr.length<=Tr*3,"uniform "+Zt,At.commandStr),Mt="3f";break;case zp:bt.command(_i(gr)&&gr.length&&gr.length%4===0&&gr.length<=Tr*4,"uniform "+Zt,At.commandStr),Mt="4f";break;case Sm:Tr===1?bt.commandType(gr,"boolean","uniform "+Zt,At.commandStr):bt.command(_i(gr)&&gr.length===Tr,"uniform "+Zt,At.commandStr),Mt="1i";break;case xm:Tr===1?bt.commandType(gr,"number","uniform "+Zt,At.commandStr):bt.command(_i(gr)&&gr.length===Tr,"uniform "+Zt,At.commandStr),Mt="1i";break;case Hp:bt.command(_i(gr)&&gr.length&&gr.length%2===0&&gr.length<=Tr*2,"uniform "+Zt,At.commandStr),Mt="2i";break;case Vp:bt.command(_i(gr)&&gr.length&&gr.length%2===0&&gr.length<=Tr*2,"uniform "+Zt,At.commandStr),Mt="2i";break;case jp:bt.command(_i(gr)&&gr.length&&gr.length%3===0&&gr.length<=Tr*3,"uniform "+Zt,At.commandStr),Mt="3i";break;case Up:bt.command(_i(gr)&&gr.length&&gr.length%3===0&&gr.length<=Tr*3,"uniform "+Zt,At.commandStr),Mt="3i";break;case Wp:bt.command(_i(gr)&&gr.length&&gr.length%4===0&&gr.length<=Tr*4,"uniform "+Zt,At.commandStr),Mt="4i";break;case Gp:bt.command(_i(gr)&&gr.length&&gr.length%4===0&&gr.length<=Tr*4,"uniform "+Zt,At.commandStr),Mt="4i";break}Tr>1?(Mt+="v",gr=At.global.def("["+Array.prototype.slice.call(gr)+"]")):gr=_i(gr)?Array.prototype.slice.call(gr):gr,wt(jt,".uniform",Mt,"(",wn,",",gr,");")}continue}else Ar=Qr.append(At,wt)}else{if(!Kt(Pv))continue;Ar=wt.def(Vt.uniforms,"[",St.id(Zt),"]")}yr===yp?(bt(!Array.isArray(Ar),"must specify a scalar prop for textures"),wt("if(",Ar,"&&",Ar,'._reglType==="framebuffer"){',Ar,"=",Ar,".color[0];","}")):yr===wp&&(bt(!Array.isArray(Ar),"must specify a scalar prop for cube maps"),wt("if(",Ar,"&&",Ar,'._reglType==="framebufferCube"){',Ar,"=",Ar,".color[0];","}")),bt.optional(function(){function Qo(Go,Yp){At.assert(wt,Go,'bad data or missing for uniform "'+Zt+'".  '+Yp)}function Bu(Go,Yp){Yp===1&&bt(!Array.isArray(Ar),"must not specify an array type for uniform"),Qo("Array.isArray("+Ar+") && typeof "+Ar+'[0]===" '+Go+'" || typeof '+Ar+'==="'+Go+'"',"invalid type, expected "+Go)}function Tl(Go,Yp,qp){Array.isArray(Ar)?bt(Ar.length&&Ar.length%Go===0&&Ar.length<=Go*qp,"must have length of "+(qp===1?"":"n * ")+Go):Qo(Vt.isArrayLike+"("+Ar+")&&"+Ar+".length && "+Ar+".length % "+Go+" === 0 && "+Ar+".length<="+Go*qp,"invalid vector, should have length of "+(qp===1?"":"n * ")+Go,At.commandStr)}function Fv(Go){bt(!Array.isArray(Ar),"must not specify a value type"),Qo("typeof "+Ar+'==="function"&&'+Ar+'._reglType==="texture'+(Go===Ev?"2d":"Cube")+'"',"invalid texture type",At.commandStr)}switch(yr){case xm:Bu("number",Tr);break;case Vp:Tl(2,"number",Tr);break;case Up:Tl(3,"number",Tr);break;case Gp:Tl(4,"number",Tr);break;case bm:Bu("number",Tr);break;case $p:Tl(2,"number",Tr);break;case Bp:Tl(3,"number",Tr);break;case zp:Tl(4,"number",Tr);break;case Sm:Bu("boolean",Tr);break;case Hp:Tl(2,"boolean",Tr);break;case jp:Tl(3,"boolean",Tr);break;case Wp:Tl(4,"boolean",Tr);break;case mp:Tl(4,"number",Tr);break;case vp:Tl(9,"number",Tr);break;case _p:Tl(16,"number",Tr);break;case yp:Fv(Ev);break;case wp:Fv(A_);break}});var bs=1;switch(yr){case yp:case wp:var yo=wt.def(Ar,"._texture");wt(jt,".uniform1i(",wn,",",yo,".bind());"),wt.exit(yo,".unbind();");continue;case xm:case Sm:Mt="1i";break;case Vp:case Hp:Mt="2i",bs=2;break;case Up:case jp:Mt="3i",bs=3;break;case Gp:case Wp:Mt="4i",bs=4;break;case bm:Mt="1f";break;case $p:Mt="2f",bs=2;break;case Bp:Mt="3f",bs=3;break;case zp:Mt="4f",bs=4;break;case mp:Mt="Matrix2fv";break;case vp:Mt="Matrix3fv";break;case _p:Mt="Matrix4fv";break}if(Mt.indexOf("Matrix")===-1&&Tr>1&&(Mt+="v",bs=1),Mt.charAt(0)==="M"){wt(jt,".uniform",Mt,"(",wn,",");var Fu=Math.pow(yr-mp+2,2),ru=At.global.def("new Float32Array(",Fu,")");Array.isArray(Ar)?wt("false,(",js(Fu,function(Qo){return ru+"["+Qo+"]="+Ar[Qo]}),",",ru,")"):wt("false,(Array.isArray(",Ar,")||",Ar," instanceof Float32Array)?",Ar,":(",js(Fu,function(Qo){return ru+"["+Qo+"]="+Ar+"["+Qo+"]"}),",",ru,")"),wt(");")}else if(bs>1){for(var Yl=[],vu=[],$u=0;$u<bs;++$u)Array.isArray(Ar)?vu.push(Ar[$u]):vu.push(wt.def(Ar+"["+$u+"]")),Ut&&Yl.push(wt.def());Ut&&wt("if(!",At.batchId,"||",Yl.map(function(Qo,Bu){return Qo+"!=="+vu[Bu]}).join("||"),"){",Yl.map(function(Qo,Bu){return Qo+"="+vu[Bu]+";"}).join("")),wt(jt,".uniform",Mt,"(",wn,",",vu.join(","),");"),Ut&&wt("}")}else{if(bt(!Array.isArray(Ar),"uniform value must not be an array"),Ut){var Nv=wt.def();wt("if(!",At.batchId,"||",Nv,"!==",Ar,"){",Nv,"=",Ar,";")}wt(jt,".uniform",Mt,"(",wn,",",Ar,");"),Ut&&wt("}")}}}function Dn(At,wt,Nt,Yt){var Kt=At.shared,Ut=Kt.gl,Vt=Kt.draw,jt=Yt.draw;function Lt(){var Tn=jt.elements,xn,Nn=wt;return Tn?((Tn.contextDep&&Yt.contextDynamic||Tn.propDep)&&(Nn=Nt),xn=Tn.append(At,Nn),jt.elementsActive&&Nn("if("+xn+")"+Ut+".bindBuffer("+Em+","+xn+".buffer.buffer);")):(xn=Nn.def(),Nn(xn,"=",Vt,".",Mu,";","if(",xn,"){",Ut,".bindBuffer(",Em,",",xn,".buffer.buffer);}","else if(",Kt.vao,".currentVAO){",xn,"=",At.shared.elements+".getElements("+Kt.vao,".currentVAO.elements);",Rr?"":"if("+xn+")"+Ut+".bindBuffer("+Em+","+xn+".buffer.buffer);","}")),xn}function Mt(){var Tn=jt.count,xn,Nn=wt;return Tn?((Tn.contextDep&&Yt.contextDynamic||Tn.propDep)&&(Nn=Nt),xn=Tn.append(At,Nn),bt.optional(function(){Tn.MISSING&&At.assert(wt,"false","missing vertex count"),Tn.DYNAMIC&&At.assert(Nn,xn+">=0","missing vertex count")})):(xn=Nn.def(Vt,".",Iu),bt.optional(function(){At.assert(Nn,xn+">=0","missing vertex count")})),xn}var Pt=Lt();function Jt(Tn){var xn=jt[Tn];return xn?xn.contextDep&&Yt.contextDynamic||xn.propDep?xn.append(At,Nt):xn.append(At,wt):wt.def(Vt,".",Tn)}var Zt=Jt(Du),yr=Jt(Np),Tr=Mt();if(typeof Tr=="number"){if(Tr===0)return}else Nt("if(",Tr,"){"),Nt.exit("}");var Qr,$n;zr&&(Qr=Jt(Fp),$n=At.instancing);var An=Pt+".type",wn=jt.elements&&mu(jt.elements)&&!jt.vaoActive;function Ar(){function Tn(){Nt($n,".drawElementsInstancedANGLE(",[Zt,Tr,An,yr+"<<(("+An+"-"+ev+")>>1)",Qr],");")}function xn(){Nt($n,".drawArraysInstancedANGLE(",[Zt,yr,Tr,Qr],");")}Pt&&Pt!=="null"?wn?Tn():(Nt("if(",Pt,"){"),Tn(),Nt("}else{"),xn(),Nt("}")):xn()}function gr(){function Tn(){Nt(Ut+".drawElements("+[Zt,Tr,An,yr+"<<(("+An+"-"+ev+")>>1)"]+");")}function xn(){Nt(Ut+".drawArrays("+[Zt,yr,Tr]+");")}Pt&&Pt!=="null"?wn?Tn():(Nt("if(",Pt,"){"),Tn(),Nt("}else{"),xn(),Nt("}")):xn()}zr&&(typeof Qr!="number"||Qr>=0)?typeof Qr=="string"?(Nt("if(",Qr,">0){"),Ar(),Nt("}else if(",Qr,"<0){"),gr(),Nt("}")):Ar():gr()}function os(At,wt,Nt,Yt,Kt){var Ut=Un(),Vt=Ut.proc("body",Kt);return bt.optional(function(){Ut.commandStr=wt.commandStr,Ut.command=Ut.link(wt.commandStr)}),zr&&(Ut.instancing=Vt.def(Ut.shared.extensions,".angle_instanced_arrays")),At(Ut,Vt,Nt,Yt),Ut.compile().body}function ps(At,wt,Nt,Yt){Js(At,wt),Nt.useVAO?Nt.drawVAO?wt(At.shared.vao,".setVAO(",Nt.drawVAO.append(At,wt),");"):wt(At.shared.vao,".setVAO(",At.shared.vao,".targetVAO);"):(wt(At.shared.vao,".setVAO(null);"),_o(At,wt,Nt,Yt.attributes,function(){return!0})),Es(At,wt,Nt,Yt.uniforms,function(){return!0},!1),Dn(At,wt,wt,Nt)}function eo(At,wt){var Nt=At.proc("draw",1);Js(At,Nt),co(At,Nt,wt.context),uo(At,Nt,wt.framebuffer),po(At,Nt,wt),vo(At,Nt,wt.state),es(At,Nt,wt,!1,!0);var Yt=wt.shader.progVar.append(At,Nt);if(Nt(At.shared.gl,".useProgram(",Yt,".program);"),wt.shader.program)ps(At,Nt,wt,wt.shader.program);else{Nt(At.shared.vao,".setVAO(null);");var Kt=At.global.def("{}"),Ut=Nt.def(Yt,".id"),Vt=Nt.def(Kt,"[",Ut,"]");Nt(At.cond(Vt).then(Vt,".call(this,a0);").else(Vt,"=",Kt,"[",Ut,"]=",At.link(function(jt){return os(ps,At,wt,jt,1)}),"(",Yt,");",Vt,".call(this,a0);"))}Object.keys(wt.state).length>0&&Nt(At.shared.current,".dirty=true;"),At.shared.vao&&Nt(At.shared.vao,".setVAO(null);")}function Xl(At,wt,Nt,Yt){At.batchId="a1",Js(At,wt);function Kt(){return!0}_o(At,wt,Nt,Yt.attributes,Kt),Es(At,wt,Nt,Yt.uniforms,Kt,!1),Dn(At,wt,wt,Nt)}function Nu(At,wt,Nt,Yt){Js(At,wt);var Kt=Nt.contextDep,Ut=wt.def(),Vt="a0",jt="a1",Lt=wt.def();At.shared.props=Lt,At.batchId=Ut;var Mt=At.scope(),Pt=At.scope();wt(Mt.entry,"for(",Ut,"=0;",Ut,"<",jt,";++",Ut,"){",Lt,"=",Vt,"[",Ut,"];",Pt,"}",Mt.exit);function Jt(An){return An.contextDep&&Kt||An.propDep}function Zt(An){return!Jt(An)}if(Nt.needsContext&&co(At,Pt,Nt.context),Nt.needsFramebuffer&&uo(At,Pt,Nt.framebuffer),vo(At,Pt,Nt.state,Jt),Nt.profile&&Jt(Nt.profile)&&es(At,Pt,Nt,!1,!0),Yt)Nt.useVAO?Nt.drawVAO?Jt(Nt.drawVAO)?Pt(At.shared.vao,".setVAO(",Nt.drawVAO.append(At,Pt),");"):Mt(At.shared.vao,".setVAO(",Nt.drawVAO.append(At,Mt),");"):Mt(At.shared.vao,".setVAO(",At.shared.vao,".targetVAO);"):(Mt(At.shared.vao,".setVAO(null);"),_o(At,Mt,Nt,Yt.attributes,Zt),_o(At,Pt,Nt,Yt.attributes,Jt)),Es(At,Mt,Nt,Yt.uniforms,Zt,!1),Es(At,Pt,Nt,Yt.uniforms,Jt,!0),Dn(At,Mt,Pt,Nt);else{var yr=At.global.def("{}"),Tr=Nt.shader.progVar.append(At,Pt),Qr=Pt.def(Tr,".id"),$n=Pt.def(yr,"[",Qr,"]");Pt(At.shared.gl,".useProgram(",Tr,".program);","if(!",$n,"){",$n,"=",yr,"[",Qr,"]=",At.link(function(An){return os(Xl,At,Nt,An,2)}),"(",Tr,");}",$n,".call(this,a0[",Ut,"],",Ut,");")}}function kt(At,wt){var Nt=At.proc("batch",2);At.batchId="0",Js(At,Nt);var Yt=!1,Kt=!0;Object.keys(wt.context).forEach(function(yr){Yt=Yt||wt.context[yr].propDep}),Yt||(co(At,Nt,wt.context),Kt=!1);var Ut=wt.framebuffer,Vt=!1;Ut?(Ut.propDep?Yt=Vt=!0:Ut.contextDep&&Yt&&(Vt=!0),Vt||uo(At,Nt,Ut)):uo(At,Nt,null),wt.state.viewport&&wt.state.viewport.propDep&&(Yt=!0);function jt(yr){return yr.contextDep&&Yt||yr.propDep}po(At,Nt,wt),vo(At,Nt,wt.state,function(yr){return!jt(yr)}),(!wt.profile||!jt(wt.profile))&&es(At,Nt,wt,!1,"a1"),wt.contextDep=Yt,wt.needsContext=Kt,wt.needsFramebuffer=Vt;var Lt=wt.shader.progVar;if(Lt.contextDep&&Yt||Lt.propDep)Nu(At,Nt,wt,null);else{var Mt=Lt.append(At,Nt);if(Nt(At.shared.gl,".useProgram(",Mt,".program);"),wt.shader.program)Nu(At,Nt,wt,wt.shader.program);else{Nt(At.shared.vao,".setVAO(null);");var Pt=At.global.def("{}"),Jt=Nt.def(Mt,".id"),Zt=Nt.def(Pt,"[",Jt,"]");Nt(At.cond(Zt).then(Zt,".call(this,a0,a1);").else(Zt,"=",Pt,"[",Jt,"]=",At.link(function(yr){return os(Nu,At,wt,yr,2)}),"(",Mt,");",Zt,".call(this,a0,a1);"))}}Object.keys(wt.state).length>0&&Nt(At.shared.current,".dirty=true;"),At.shared.vao&&Nt(At.shared.vao,".setVAO(null);")}function ar(At,wt){var Nt=At.proc("scope",3);At.batchId="a2";var Yt=At.shared,Kt=Yt.current;co(At,Nt,wt.context),wt.framebuffer&&wt.framebuffer.append(At,Nt),Lv(Object.keys(wt.state)).forEach(function(Vt){var jt=wt.state[Vt],Lt=jt.append(At,Nt);_i(Lt)?Lt.forEach(function(Mt,Pt){Nt.set(At.next[Vt],"["+Pt+"]",Mt)}):Nt.set(Yt.next,"."+Vt,Lt)}),es(At,Nt,wt,!0,!0),[Mu,Np,Iu,Fp,Du].forEach(function(Vt){var jt=wt.draw[Vt];jt&&Nt.set(Yt.draw,"."+Vt,""+jt.append(At,Nt))}),Object.keys(wt.uniforms).forEach(function(Vt){var jt=wt.uniforms[Vt].append(At,Nt);Array.isArray(jt)&&(jt="["+jt.join()+"]"),Nt.set(Yt.uniforms,"["+St.id(Vt)+"]",jt)}),Object.keys(wt.attributes).forEach(function(Vt){var jt=wt.attributes[Vt].append(At,Nt),Lt=At.scopeAttrib(Vt);Object.keys(new qt).forEach(function(Mt){Nt.set(Lt,"."+Mt,jt[Mt])})}),wt.scopeVAO&&Nt.set(Yt.vao,".targetVAO",wt.scopeVAO.append(At,Nt));function Ut(Vt){var jt=wt.shader[Vt];jt&&Nt.set(Yt.shader,"."+Vt,jt.append(At,Nt))}Ut(hp),Ut(pp),Object.keys(wt.state).length>0&&(Nt(Kt,".dirty=true;"),Nt.exit(Kt,".dirty=true;")),Nt("a1(",At.shared.context,",a0,",At.batchId,");")}function tr(At){if(!(typeof At!="object"||_i(At))){for(var wt=Object.keys(At),Nt=0;Nt<wt.length;++Nt)if(Bn.isDynamic(At[wt[Nt]]))return!0;return!1}}function En(At,wt,Nt){var Yt=wt.static[Nt];if(!Yt||!tr(Yt))return;var Kt=At.global,Ut=Object.keys(Yt),Vt=!1,jt=!1,Lt=!1,Mt=At.global.def("{}");Ut.forEach(function(Jt){var Zt=Yt[Jt];if(Bn.isDynamic(Zt)){typeof Zt=="function"&&(Zt=Yt[Jt]=Bn.unbox(Zt));var yr=Uo(Zt,null);Vt=Vt||yr.thisDep,Lt=Lt||yr.propDep,jt=jt||yr.contextDep}else{switch(Kt(Mt,".",Jt,"="),typeof Zt){case"number":Kt(Zt);break;case"string":Kt('"',Zt,'"');break;case"object":Array.isArray(Zt)&&Kt("[",Zt.join(),"]");break;default:Kt(At.link(Zt));break}Kt(";")}});function Pt(Jt,Zt){Ut.forEach(function(yr){var Tr=Yt[yr];if(Bn.isDynamic(Tr)){var Qr=Jt.invoke(Zt,Tr);Zt(Mt,".",yr,"=",Qr,";")}})}wt.dynamic[Nt]=new Bn.DynamicVariable(Ip,{thisDep:Vt,contextDep:jt,propDep:Lt,ref:Mt,append:Pt}),delete wt.static[Nt]}function ns(At,wt,Nt,Yt,Kt){var Ut=Un();Ut.stats=Ut.link(Kt),Object.keys(wt.static).forEach(function(jt){En(Ut,wt,jt)}),S_.forEach(function(jt){En(Ut,At,jt)});var Vt=so(At,wt,Nt,Yt,Ut);return eo(Ut,Vt),ar(Ut,Vt),kt(Ut,Vt),o(Ut.compile(),{destroy:function(){Vt.shader.program.destroy()}})}return{next:cn,current:hn,procs:function(){var At=Un(),wt=At.proc("poll"),Nt=At.proc("refresh"),Yt=At.block();wt(Yt),Nt(Yt);var Kt=At.shared,Ut=Kt.gl,Vt=Kt.next,jt=Kt.current;Yt(jt,".dirty=false;"),uo(At,wt),uo(At,Nt,null,!0);var Lt;zr&&(Lt=At.link(zr)),It.oes_vertex_array_object&&Nt(At.link(It.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Mt=0;Mt<ir.maxAttributes;++Mt){var Pt=Nt.def(Kt.attributes,"[",Mt,"]"),Jt=At.cond(Pt,".buffer");Jt.then(Ut,".enableVertexAttribArray(",Mt,");",Ut,".bindBuffer(",Ju,",",Pt,".buffer.buffer);",Ut,".vertexAttribPointer(",Mt,",",Pt,".size,",Pt,".type,",Pt,".normalized,",Pt,".stride,",Pt,".offset);").else(Ut,".disableVertexAttribArray(",Mt,");",Ut,".vertexAttrib4f(",Mt,",",Pt,".x,",Pt,".y,",Pt,".z,",Pt,".w);",Pt,".buffer=null;"),Nt(Jt),zr&&Nt(Lt,".vertexAttribDivisorANGLE(",Mt,",",Pt,".divisor);")}return Nt(At.shared.vao,".currentVAO=null;",At.shared.vao,".setVAO(",At.shared.vao,".targetVAO);"),Object.keys(Sr).forEach(function(Zt){var yr=Sr[Zt],Tr=Yt.def(Vt,".",Zt),Qr=At.block();Qr("if(",Tr,"){",Ut,".enable(",yr,")}else{",Ut,".disable(",yr,")}",jt,".",Zt,"=",Tr,";"),Nt(Qr),wt("if(",Tr,"!==",jt,".",Zt,"){",Qr,"}")}),Object.keys(wr).forEach(function(Zt){var yr=wr[Zt],Tr=hn[Zt],Qr,$n,An=At.block();if(An(Ut,".",yr,"("),_i(Tr)){var wn=Tr.length;Qr=At.global.def(Vt,".",Zt),$n=At.global.def(jt,".",Zt),An(js(wn,function(Ar){return Qr+"["+Ar+"]"}),");",js(wn,function(Ar){return $n+"["+Ar+"]="+Qr+"["+Ar+"];"}).join("")),wt("if(",js(wn,function(Ar){return Qr+"["+Ar+"]!=="+$n+"["+Ar+"]"}).join("||"),"){",An,"}")}else Qr=Yt.def(Vt,".",Zt),$n=Yt.def(jt,".",Zt),An(Qr,");",jt,".",Zt,"=",Qr,";"),wt("if(",Qr,"!==",$n,"){",An,"}");Nt(An)}),At.compile()}(),compile:ns}}function G_(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var H_=34918,j_=34919,kv=35007,W_=function(ht,St){if(!St.ext_disjoint_timer_query)return null;var It=[];function ir(){return It.pop()||St.ext_disjoint_timer_query.createQueryEXT()}function br(zr){It.push(zr)}var nr=[];function dr(zr){var gn=ir();St.ext_disjoint_timer_query.beginQueryEXT(kv,gn),nr.push(gn),$r(nr.length-1,nr.length,zr)}function Nr(){St.ext_disjoint_timer_query.endQueryEXT(kv)}function Or(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Wr=[];function qr(){return Wr.pop()||new Or}function Xr(zr){Wr.push(zr)}var Jr=[];function $r(zr,gn,Rr){var hn=qr();hn.startQueryIndex=zr,hn.endQueryIndex=gn,hn.sum=0,hn.stats=Rr,Jr.push(hn)}var Ur=[],qt=[];function ur(){var zr,gn,Rr=nr.length;if(Rr!==0){qt.length=Math.max(qt.length,Rr+1),Ur.length=Math.max(Ur.length,Rr+1),Ur[0]=0,qt[0]=0;var hn=0;for(zr=0,gn=0;gn<nr.length;++gn){var cn=nr[gn];St.ext_disjoint_timer_query.getQueryObjectEXT(cn,j_)?(hn+=St.ext_disjoint_timer_query.getQueryObjectEXT(cn,H_),br(cn)):nr[zr++]=cn,Ur[gn+1]=hn,qt[gn+1]=zr}for(nr.length=zr,zr=0,gn=0;gn<Jr.length;++gn){var Pn=Jr[gn],Sr=Pn.startQueryIndex,wr=Pn.endQueryIndex;Pn.sum+=Ur[wr]-Ur[Sr];var bn=qt[Sr],tn=qt[wr];tn===bn?(Pn.stats.gpuTime+=Pn.sum/1e6,Xr(Pn)):(Pn.startQueryIndex=bn,Pn.endQueryIndex=tn,Jr[zr++]=Pn)}Jr.length=zr}}return{beginQuery:dr,endQuery:Nr,pushScopeStats:$r,update:ur,getNumPendingQueries:function(){return nr.length},clear:function(){It.push.apply(It,nr);for(var zr=0;zr<It.length;zr++)St.ext_disjoint_timer_query.deleteQueryEXT(It[zr]);nr.length=0,It.length=0},restore:function(){nr.length=0,It.length=0}}},X_=16384,Y_=256,q_=1024,K_=34962,Mv="webglcontextlost",Dv="webglcontextrestored",Iv=1,Z_=2,Q_=3;function Ov(ht,St){for(var It=0;It<ht.length;++It)if(ht[It]===St)return It;return-1}function J_(ht){var St=Jo(ht);if(!St)return null;var It=St.gl,ir=It.getContextAttributes(),br=It.isContextLost(),nr=na(It,St);if(!nr)return null;var dr=Ss(),Nr=G_(),Or=nr.extensions,Wr=W_(It,Or),qr=hs(),Xr=It.drawingBufferWidth,Jr=It.drawingBufferHeight,$r={tick:0,time:0,viewportWidth:Xr,viewportHeight:Jr,framebufferWidth:Xr,framebufferHeight:Jr,drawingBufferWidth:Xr,drawingBufferHeight:Jr,pixelRatio:St.pixelRatio},Ur={},qt={elements:null,primitive:4,count:-1,offset:0,instances:-1},ur=Rt(It,Or),zr=Kp(It,Nr,St,hn),gn=No(It,Or,zr,Nr),Rr=h_(It,Or,ur,Nr,zr,gn,qt);function hn(Dn){return Rr.destroyBuffer(Dn)}var cn=v_(It,dr,Nr,St),Pn=Hv(It,Or,ur,function(){bn.procs.poll()},$r,Nr,St),Sr=jv(It,Or,ur,Nr,St),wr=f_(It,Or,ur,Pn,Sr,Nr),bn=U_(It,dr,Or,ur,zr,gn,Pn,wr,Ur,Rr,cn,qt,$r,Wr,St),tn=w_(It,wr,bn.procs.poll,$r,ir,Or,ur),Br=bn.next,rn=It.canvas,on=[],Wn=[],Un=[],un=[St.onDestroy],pn=null;function On(){if(on.length===0){Wr&&Wr.update(),pn=null;return}pn=cs.next(On),vo();for(var Dn=on.length-1;Dn>=0;--Dn){var os=on[Dn];os&&os($r,null,0)}It.flush(),Wr&&Wr.update()}function Xn(){!pn&&on.length>0&&(pn=cs.next(On))}function ss(){pn&&(cs.cancel(On),pn=null)}function Ws(Dn){Dn.preventDefault(),br=!0,ss(),Wn.forEach(function(os){os()})}function qs(Dn){It.getError(),br=!1,nr.restore(),cn.restore(),zr.restore(),Pn.restore(),Sr.restore(),wr.restore(),Rr.restore(),Wr&&Wr.restore(),bn.procs.refresh(),Xn(),Un.forEach(function(os){os()})}rn&&(rn.addEventListener(Mv,Ws,!1),rn.addEventListener(Dv,qs,!1));function as(){on.length=0,ss(),rn&&(rn.removeEventListener(Mv,Ws),rn.removeEventListener(Dv,qs)),cn.clear(),wr.clear(),Sr.clear(),Rr.clear(),Pn.clear(),gn.clear(),zr.clear(),Wr&&Wr.clear(),un.forEach(function(Dn){Dn()})}function lo(Dn){bt(!!Dn,"invalid args to regl({...})"),bt.type(Dn,"object","invalid args to regl({...})");function os(Kt){var Ut=o({},Kt);delete Ut.uniforms,delete Ut.attributes,delete Ut.context,delete Ut.vao,"stencil"in Ut&&Ut.stencil.op&&(Ut.stencil.opBack=Ut.stencil.opFront=Ut.stencil.op,delete Ut.stencil.op);function Vt(jt){if(jt in Ut){var Lt=Ut[jt];delete Ut[jt],Object.keys(Lt).forEach(function(Mt){Ut[jt+"."+Mt]=Lt[Mt]})}}return Vt("blend"),Vt("depth"),Vt("cull"),Vt("stencil"),Vt("polygonOffset"),Vt("scissor"),Vt("sample"),"vao"in Kt&&(Ut.vao=Kt.vao),Ut}function ps(Kt,Ut){var Vt={},jt={};return Object.keys(Kt).forEach(function(Lt){var Mt=Kt[Lt];if(Bn.isDynamic(Mt)){jt[Lt]=Bn.unbox(Mt,Lt);return}else if(Ut&&Array.isArray(Mt)){for(var Pt=0;Pt<Mt.length;++Pt)if(Bn.isDynamic(Mt[Pt])){jt[Lt]=Bn.unbox(Mt,Lt);return}}Vt[Lt]=Mt}),{dynamic:jt,static:Vt}}var eo=ps(Dn.context||{},!0),Xl=ps(Dn.uniforms||{},!0),Nu=ps(Dn.attributes||{},!1),kt=ps(os(Dn),!1),ar={gpuTime:0,cpuTime:0,count:0},tr=bn.compile(kt,Nu,Xl,eo,ar),En=tr.draw,ns=tr.batch,At=tr.scope,wt=[];function Nt(Kt){for(;wt.length<Kt;)wt.push(null);return wt}function Yt(Kt,Ut){var Vt;if(br&&bt.raise("context lost"),typeof Kt=="function")return At.call(this,null,Kt,0);if(typeof Ut=="function")if(typeof Kt=="number")for(Vt=0;Vt<Kt;++Vt)At.call(this,null,Ut,Vt);else if(Array.isArray(Kt))for(Vt=0;Vt<Kt.length;++Vt)At.call(this,Kt[Vt],Ut,Vt);else return At.call(this,Kt,Ut,0);else if(typeof Kt=="number"){if(Kt>0)return ns.call(this,Nt(Kt|0),Kt|0)}else if(Array.isArray(Kt)){if(Kt.length)return ns.call(this,Kt,Kt.length)}else return En.call(this,Kt)}return o(Yt,{stats:ar,destroy:function(){tr.destroy()}})}var Vs=wr.setFBO=lo({framebuffer:Bn.define.call(null,Iv,"framebuffer")});function so(Dn,os){var ps=0;bn.procs.poll();var eo=os.color;eo&&(It.clearColor(+eo[0]||0,+eo[1]||0,+eo[2]||0,+eo[3]||0),ps|=X_),"depth"in os&&(It.clearDepth(+os.depth),ps|=Y_),"stencil"in os&&(It.clearStencil(os.stencil|0),ps|=q_),bt(!!ps,"called regl.clear with no buffer specified"),It.clear(ps)}function co(Dn){if(bt(typeof Dn=="object"&&Dn,"regl.clear() takes an object as input"),"framebuffer"in Dn)if(Dn.framebuffer&&Dn.framebuffer_reglType==="framebufferCube")for(var os=0;os<6;++os)Vs(o({framebuffer:Dn.framebuffer.faces[os]},Dn),so);else Vs(Dn,so);else so(null,Dn)}function uo(Dn){bt.type(Dn,"function","regl.frame() callback must be a function"),on.push(Dn);function os(){var ps=Ov(on,Dn);bt(ps>=0,"cannot cancel a frame twice");function eo(){var Xl=Ov(on,eo);on[Xl]=on[on.length-1],on.length-=1,on.length<=0&&ss()}on[ps]=eo}return Xn(),{cancel:os}}function po(){var Dn=Br.viewport,os=Br.scissor_box;Dn[0]=Dn[1]=os[0]=os[1]=0,$r.viewportWidth=$r.framebufferWidth=$r.drawingBufferWidth=Dn[2]=os[2]=It.drawingBufferWidth,$r.viewportHeight=$r.framebufferHeight=$r.drawingBufferHeight=Dn[3]=os[3]=It.drawingBufferHeight}function vo(){$r.tick+=1,$r.time=es(),po(),bn.procs.poll()}function Js(){Pn.refresh(),po(),bn.procs.refresh(),Wr&&Wr.update()}function es(){return(hs()-qr)/1e3}Js();function _o(Dn,os){bt.type(os,"function","listener callback must be a function");var ps;switch(Dn){case"frame":return uo(os);case"lost":ps=Wn;break;case"restore":ps=Un;break;case"destroy":ps=un;break;default:bt.raise("invalid event, must be one of frame,lost,restore,destroy")}return ps.push(os),{cancel:function(){for(var eo=0;eo<ps.length;++eo)if(ps[eo]===os){ps[eo]=ps[ps.length-1],ps.pop();return}}}}var Es=o(lo,{clear:co,prop:Bn.define.bind(null,Iv),context:Bn.define.bind(null,Z_),this:Bn.define.bind(null,Q_),draw:lo({}),buffer:function(Dn){return zr.create(Dn,K_,!1,!1)},elements:function(Dn){return gn.create(Dn,!1)},texture:Pn.create2D,cube:Pn.createCube,renderbuffer:Sr.create,framebuffer:wr.create,framebufferCube:wr.createCube,vao:Rr.createVAO,attributes:ir,frame:uo,on:_o,limits:ur,hasExtension:function(Dn){return ur.extensions.indexOf(Dn.toLowerCase())>=0},read:tn,destroy:as,_gl:It,_refresh:Js,poll:function(){vo(),Wr&&Wr.update()},now:es,stats:Nr});return St.onDone(null,Es),Es}return J_})})(regl);var EPSILON$1=1e-6,ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function identity$2(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function transpose(i,e){if(i===e){var s=e[1],o=e[2],a=e[3],d=e[6],g=e[7],_=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=s,i[6]=e[9],i[7]=e[13],i[8]=o,i[9]=d,i[11]=e[14],i[12]=a,i[13]=g,i[14]=_}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function invert(i,e){var s=e[0],o=e[1],a=e[2],d=e[3],g=e[4],_=e[5],j=e[6],_e=e[7],et=e[8],tt=e[9],rt=e[10],it=e[11],ot=e[12],ct=e[13],ft=e[14],dt=e[15],pt=s*_-o*g,gt=s*j-a*g,Ct=s*_e-d*g,xt=o*j-a*_,at=o*_e-d*_,Bt=a*_e-d*j,Ht=et*ct-tt*ot,sr=et*ft-rt*ot,mr=et*dt-it*ot,hr=tt*ft-rt*ct,Er=tt*dt-it*ct,Lr=rt*dt-it*ft,sn=pt*Lr-gt*Er+Ct*hr+xt*mr-at*sr+Bt*Ht;return sn?(sn=1/sn,i[0]=(_*Lr-j*Er+_e*hr)*sn,i[1]=(a*Er-o*Lr-d*hr)*sn,i[2]=(ct*Bt-ft*at+dt*xt)*sn,i[3]=(rt*at-tt*Bt-it*xt)*sn,i[4]=(j*mr-g*Lr-_e*sr)*sn,i[5]=(s*Lr-a*mr+d*sr)*sn,i[6]=(ft*Ct-ot*Bt-dt*gt)*sn,i[7]=(et*Bt-rt*Ct+it*gt)*sn,i[8]=(g*Er-_*mr+_e*Ht)*sn,i[9]=(o*mr-s*Er-d*Ht)*sn,i[10]=(ot*at-ct*Ct+dt*pt)*sn,i[11]=(tt*Ct-et*at-it*pt)*sn,i[12]=(_*sr-g*hr-j*Ht)*sn,i[13]=(s*hr-o*sr+a*Ht)*sn,i[14]=(ct*gt-ot*xt-ft*pt)*sn,i[15]=(et*xt-tt*gt+rt*pt)*sn,i):null}function determinant(i){var e=i[0],s=i[1],o=i[2],a=i[3],d=i[4],g=i[5],_=i[6],j=i[7],_e=i[8],et=i[9],tt=i[10],rt=i[11],it=i[12],ot=i[13],ct=i[14],ft=i[15],dt=e*g-s*d,pt=e*_-o*d,gt=e*j-a*d,Ct=s*_-o*g,xt=s*j-a*g,at=o*j-a*_,Bt=_e*ot-et*it,Ht=_e*ct-tt*it,sr=_e*ft-rt*it,mr=et*ct-tt*ot,hr=et*ft-rt*ot,Er=tt*ft-rt*ct;return dt*Er-pt*hr+gt*mr+Ct*sr-xt*Ht+at*Bt}function multiply(i,e,s){var o=e[0],a=e[1],d=e[2],g=e[3],_=e[4],j=e[5],_e=e[6],et=e[7],tt=e[8],rt=e[9],it=e[10],ot=e[11],ct=e[12],ft=e[13],dt=e[14],pt=e[15],gt=s[0],Ct=s[1],xt=s[2],at=s[3];return i[0]=gt*o+Ct*_+xt*tt+at*ct,i[1]=gt*a+Ct*j+xt*rt+at*ft,i[2]=gt*d+Ct*_e+xt*it+at*dt,i[3]=gt*g+Ct*et+xt*ot+at*pt,gt=s[4],Ct=s[5],xt=s[6],at=s[7],i[4]=gt*o+Ct*_+xt*tt+at*ct,i[5]=gt*a+Ct*j+xt*rt+at*ft,i[6]=gt*d+Ct*_e+xt*it+at*dt,i[7]=gt*g+Ct*et+xt*ot+at*pt,gt=s[8],Ct=s[9],xt=s[10],at=s[11],i[8]=gt*o+Ct*_+xt*tt+at*ct,i[9]=gt*a+Ct*j+xt*rt+at*ft,i[10]=gt*d+Ct*_e+xt*it+at*dt,i[11]=gt*g+Ct*et+xt*ot+at*pt,gt=s[12],Ct=s[13],xt=s[14],at=s[15],i[12]=gt*o+Ct*_+xt*tt+at*ct,i[13]=gt*a+Ct*j+xt*rt+at*ft,i[14]=gt*d+Ct*_e+xt*it+at*dt,i[15]=gt*g+Ct*et+xt*ot+at*pt,i}function translate(i,e,s){var o=s[0],a=s[1],d=s[2],g,_,j,_e,et,tt,rt,it,ot,ct,ft,dt;return e===i?(i[12]=e[0]*o+e[4]*a+e[8]*d+e[12],i[13]=e[1]*o+e[5]*a+e[9]*d+e[13],i[14]=e[2]*o+e[6]*a+e[10]*d+e[14],i[15]=e[3]*o+e[7]*a+e[11]*d+e[15]):(g=e[0],_=e[1],j=e[2],_e=e[3],et=e[4],tt=e[5],rt=e[6],it=e[7],ot=e[8],ct=e[9],ft=e[10],dt=e[11],i[0]=g,i[1]=_,i[2]=j,i[3]=_e,i[4]=et,i[5]=tt,i[6]=rt,i[7]=it,i[8]=ot,i[9]=ct,i[10]=ft,i[11]=dt,i[12]=g*o+et*a+ot*d+e[12],i[13]=_*o+tt*a+ct*d+e[13],i[14]=j*o+rt*a+ft*d+e[14],i[15]=_e*o+it*a+dt*d+e[15]),i}function scale$1(i,e,s){var o=s[0],a=s[1],d=s[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function rotate(i,e,s,o){var a=o[0],d=o[1],g=o[2],_=Math.hypot(a,d,g),j,_e,et,tt,rt,it,ot,ct,ft,dt,pt,gt,Ct,xt,at,Bt,Ht,sr,mr,hr,Er,Lr,sn,vr;return _<EPSILON$1?null:(_=1/_,a*=_,d*=_,g*=_,j=Math.sin(s),_e=Math.cos(s),et=1-_e,tt=e[0],rt=e[1],it=e[2],ot=e[3],ct=e[4],ft=e[5],dt=e[6],pt=e[7],gt=e[8],Ct=e[9],xt=e[10],at=e[11],Bt=a*a*et+_e,Ht=d*a*et+g*j,sr=g*a*et-d*j,mr=a*d*et-g*j,hr=d*d*et+_e,Er=g*d*et+a*j,Lr=a*g*et+d*j,sn=d*g*et-a*j,vr=g*g*et+_e,i[0]=tt*Bt+ct*Ht+gt*sr,i[1]=rt*Bt+ft*Ht+Ct*sr,i[2]=it*Bt+dt*Ht+xt*sr,i[3]=ot*Bt+pt*Ht+at*sr,i[4]=tt*mr+ct*hr+gt*Er,i[5]=rt*mr+ft*hr+Ct*Er,i[6]=it*mr+dt*hr+xt*Er,i[7]=ot*mr+pt*hr+at*Er,i[8]=tt*Lr+ct*sn+gt*vr,i[9]=rt*Lr+ft*sn+Ct*vr,i[10]=it*Lr+dt*sn+xt*vr,i[11]=ot*Lr+pt*sn+at*vr,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function rotateX$1(i,e,s){var o=Math.sin(s),a=Math.cos(s),d=e[4],g=e[5],_=e[6],j=e[7],_e=e[8],et=e[9],tt=e[10],rt=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*a+_e*o,i[5]=g*a+et*o,i[6]=_*a+tt*o,i[7]=j*a+rt*o,i[8]=_e*a-d*o,i[9]=et*a-g*o,i[10]=tt*a-_*o,i[11]=rt*a-j*o,i}function rotateY$1(i,e,s){var o=Math.sin(s),a=Math.cos(s),d=e[0],g=e[1],_=e[2],j=e[3],_e=e[8],et=e[9],tt=e[10],rt=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*a-_e*o,i[1]=g*a-et*o,i[2]=_*a-tt*o,i[3]=j*a-rt*o,i[8]=d*o+_e*a,i[9]=g*o+et*a,i[10]=_*o+tt*a,i[11]=j*o+rt*a,i}function rotateZ$1(i,e,s){var o=Math.sin(s),a=Math.cos(s),d=e[0],g=e[1],_=e[2],j=e[3],_e=e[4],et=e[5],tt=e[6],rt=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*a+_e*o,i[1]=g*a+et*o,i[2]=_*a+tt*o,i[3]=j*a+rt*o,i[4]=_e*a-d*o,i[5]=et*a-g*o,i[6]=tt*a-_*o,i[7]=rt*a-j*o,i}function getScaling(i,e){var s=e[0],o=e[1],a=e[2],d=e[4],g=e[5],_=e[6],j=e[8],_e=e[9],et=e[10];return i[0]=Math.hypot(s,o,a),i[1]=Math.hypot(d,g,_),i[2]=Math.hypot(j,_e,et),i}function fromQuat(i,e){var s=e[0],o=e[1],a=e[2],d=e[3],g=s+s,_=o+o,j=a+a,_e=s*g,et=o*g,tt=o*_,rt=a*g,it=a*_,ot=a*j,ct=d*g,ft=d*_,dt=d*j;return i[0]=1-tt-ot,i[1]=et+dt,i[2]=rt-ft,i[3]=0,i[4]=et-dt,i[5]=1-_e-ot,i[6]=it+ct,i[7]=0,i[8]=rt+ft,i[9]=it-ct,i[10]=1-_e-tt,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function frustum(i,e,s,o,a,d,g){var _=1/(s-e),j=1/(a-o),_e=1/(d-g);return i[0]=d*2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d*2*j,i[6]=0,i[7]=0,i[8]=(s+e)*_,i[9]=(a+o)*j,i[10]=(g+d)*_e,i[11]=-1,i[12]=0,i[13]=0,i[14]=g*d*2*_e,i[15]=0,i}function perspectiveNO(i,e,s,o,a){var d=1/Math.tan(e/2),g;return i[0]=d/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(g=1/(o-a),i[10]=(a+o)*g,i[14]=2*a*o*g):(i[10]=-1,i[14]=-2*o),i}var perspective=perspectiveNO;function orthoNO(i,e,s,o,a,d,g){var _=1/(e-s),j=1/(o-a),_e=1/(d-g);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*j,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*_e,i[11]=0,i[12]=(e+s)*_,i[13]=(a+o)*j,i[14]=(g+d)*_e,i[15]=1,i}var ortho=orthoNO;function lookAt(i,e,s,o){var a,d,g,_,j,_e,et,tt,rt,it,ot=e[0],ct=e[1],ft=e[2],dt=o[0],pt=o[1],gt=o[2],Ct=s[0],xt=s[1],at=s[2];return Math.abs(ot-Ct)<EPSILON$1&&Math.abs(ct-xt)<EPSILON$1&&Math.abs(ft-at)<EPSILON$1?identity$2(i):(et=ot-Ct,tt=ct-xt,rt=ft-at,it=1/Math.hypot(et,tt,rt),et*=it,tt*=it,rt*=it,a=pt*rt-gt*tt,d=gt*et-dt*rt,g=dt*tt-pt*et,it=Math.hypot(a,d,g),it?(it=1/it,a*=it,d*=it,g*=it):(a=0,d=0,g=0),_=tt*g-rt*d,j=rt*a-et*g,_e=et*d-tt*a,it=Math.hypot(_,j,_e),it?(it=1/it,_*=it,j*=it,_e*=it):(_=0,j=0,_e=0),i[0]=a,i[1]=_,i[2]=et,i[3]=0,i[4]=d,i[5]=j,i[6]=tt,i[7]=0,i[8]=g,i[9]=_e,i[10]=rt,i[11]=0,i[12]=-(a*ot+d*ct+g*ft),i[13]=-(_*ot+j*ct+_e*ft),i[14]=-(et*ot+tt*ct+rt*ft),i[15]=1,i)}function create$2(){var i=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function length$1(i){var e=i[0],s=i[1],o=i[2];return Math.hypot(e,s,o)}function fromValues(i,e,s){var o=new ARRAY_TYPE(3);return o[0]=i,o[1]=e,o[2]=s,o}function subtract(i,e,s){return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],i}function squaredLength$1(i){var e=i[0],s=i[1],o=i[2];return e*e+s*s+o*o}function negate$1(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function normalize$1(i,e){var s=e[0],o=e[1],a=e[2],d=s*s+o*o+a*a;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i}function dot$1(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function cross(i,e,s){var o=e[0],a=e[1],d=e[2],g=s[0],_=s[1],j=s[2];return i[0]=a*j-d*_,i[1]=d*g-o*j,i[2]=o*_-a*g,i}function lerp$3(i,e,s,o){var a=e[0],d=e[1],g=e[2];return i[0]=a+o*(s[0]-a),i[1]=d+o*(s[1]-d),i[2]=g+o*(s[2]-g),i}function transformMat4$2(i,e,s){var o=e[0],a=e[1],d=e[2],g=s[3]*o+s[7]*a+s[11]*d+s[15];return g=g||1,i[0]=(s[0]*o+s[4]*a+s[8]*d+s[12])/g,i[1]=(s[1]*o+s[5]*a+s[9]*d+s[13])/g,i[2]=(s[2]*o+s[6]*a+s[10]*d+s[14])/g,i}function transformMat3$1(i,e,s){var o=e[0],a=e[1],d=e[2];return i[0]=o*s[0]+a*s[3]+d*s[6],i[1]=o*s[1]+a*s[4]+d*s[7],i[2]=o*s[2]+a*s[5]+d*s[8],i}function transformQuat$1(i,e,s){var o=s[0],a=s[1],d=s[2],g=s[3],_=e[0],j=e[1],_e=e[2],et=a*_e-d*j,tt=d*_-o*_e,rt=o*j-a*_,it=a*rt-d*tt,ot=d*et-o*rt,ct=o*tt-a*et,ft=g*2;return et*=ft,tt*=ft,rt*=ft,it*=2,ot*=2,ct*=2,i[0]=_+et+it,i[1]=j+tt+ot,i[2]=_e+rt+ct,i}function rotateX(i,e,s,o){var a=[],d=[];return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a[2]=e[2]-s[2],d[0]=a[0],d[1]=a[1]*Math.cos(o)-a[2]*Math.sin(o),d[2]=a[1]*Math.sin(o)+a[2]*Math.cos(o),i[0]=d[0]+s[0],i[1]=d[1]+s[1],i[2]=d[2]+s[2],i}function rotateY(i,e,s,o){var a=[],d=[];return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a[2]=e[2]-s[2],d[0]=a[2]*Math.sin(o)+a[0]*Math.cos(o),d[1]=a[1],d[2]=a[2]*Math.cos(o)-a[0]*Math.sin(o),i[0]=d[0]+s[0],i[1]=d[1]+s[1],i[2]=d[2]+s[2],i}function rotateZ(i,e,s,o){var a=[],d=[];return a[0]=e[0]-s[0],a[1]=e[1]-s[1],a[2]=e[2]-s[2],d[0]=a[0]*Math.cos(o)-a[1]*Math.sin(o),d[1]=a[0]*Math.sin(o)+a[1]*Math.cos(o),d[2]=a[2],i[0]=d[0]+s[0],i[1]=d[1]+s[1],i[2]=d[2]+s[2],i}function angle(i,e){var s=i[0],o=i[1],a=i[2],d=e[0],g=e[1],_=e[2],j=Math.sqrt(s*s+o*o+a*a),_e=Math.sqrt(d*d+g*g+_*_),et=j*_e,tt=et&&dot$1(i,e)/et;return Math.acos(Math.min(Math.max(tt,-1),1))}var sub=subtract,len=length$1,sqrLen=squaredLength$1;(function(){var i=create$2();return function(e,s,o,a,d,g){var _,j;for(s||(s=3),o||(o=0),a?j=Math.min(a*s+o,e.length):j=e.length,_=o;_<j;_+=s)i[0]=e[_],i[1]=e[_+1],i[2]=e[_+2],d(i,i,g),e[_]=i[0],e[_+1]=i[1],e[_+2]=i[2];return e}})();function create$1(){var i=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function add$2(i,e,s){return i[0]=e[0]+s[0],i[1]=e[1]+s[1],i[2]=e[2]+s[2],i[3]=e[3]+s[3],i}function scale(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i}function length(i){var e=i[0],s=i[1],o=i[2],a=i[3];return Math.hypot(e,s,o,a)}function squaredLength(i){var e=i[0],s=i[1],o=i[2],a=i[3];return e*e+s*s+o*o+a*a}function normalize(i,e){var s=e[0],o=e[1],a=e[2],d=e[3],g=s*s+o*o+a*a+d*d;return g>0&&(g=1/Math.sqrt(g)),i[0]=s*g,i[1]=o*g,i[2]=a*g,i[3]=d*g,i}function dot(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function lerp$2(i,e,s,o){var a=e[0],d=e[1],g=e[2],_=e[3];return i[0]=a+o*(s[0]-a),i[1]=d+o*(s[1]-d),i[2]=g+o*(s[2]-g),i[3]=_+o*(s[3]-_),i}function transformMat4$1(i,e,s){var o=e[0],a=e[1],d=e[2],g=e[3];return i[0]=s[0]*o+s[4]*a+s[8]*d+s[12]*g,i[1]=s[1]*o+s[5]*a+s[9]*d+s[13]*g,i[2]=s[2]*o+s[6]*a+s[10]*d+s[14]*g,i[3]=s[3]*o+s[7]*a+s[11]*d+s[15]*g,i}function transformQuat(i,e,s){var o=e[0],a=e[1],d=e[2],g=s[0],_=s[1],j=s[2],_e=s[3],et=_e*o+_*d-j*a,tt=_e*a+j*o-g*d,rt=_e*d+g*a-_*o,it=-g*o-_*a-j*d;return i[0]=et*_e+it*-g+tt*-j-rt*-_,i[1]=tt*_e+it*-_+rt*-g-et*-j,i[2]=rt*_e+it*-j+et*-_-tt*-g,i[3]=e[3],i}(function(){var i=create$1();return function(e,s,o,a,d,g){var _,j;for(s||(s=4),o||(o=0),a?j=Math.min(a*s+o,e.length):j=e.length,_=o;_<j;_+=s)i[0]=e[_],i[1]=e[_+1],i[2]=e[_+2],i[3]=e[_+3],d(i,i,g),e[_]=i[0],e[_+1]=i[1],e[_+2]=i[2],e[_+3]=i[3];return e}})();function create(){var i=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function add$1(i,e,s){return i[0]=e[0]+s[0],i[1]=e[1]+s[1],i}function negate(i,e){return i[0]=-e[0],i[1]=-e[1],i}function lerp$1(i,e,s,o){var a=e[0],d=e[1];return i[0]=a+o*(s[0]-a),i[1]=d+o*(s[1]-d),i}function transformMat3(i,e,s){var o=e[0],a=e[1];return i[0]=s[0]*o+s[3]*a+s[6],i[1]=s[1]*o+s[4]*a+s[7],i}function transformMat4(i,e,s){var o=e[0],a=e[1];return i[0]=s[0]*o+s[4]*a+s[12],i[1]=s[1]*o+s[5]*a+s[13],i}(function(){var i=create();return function(e,s,o,a,d,g){var _,j;for(s||(s=2),o||(o=0),a?j=Math.min(a*s+o,e.length):j=e.length,_=o;_<j;_+=s)i[0]=e[_],i[1]=e[_+1],d(i,i,g),e[_]=i[0],e[_+1]=i[1];return e}})();function damp(i){var e=i*.9;return Math.abs(e)<.1?0:e}function clamp$2(i,e,s){return Math.min(Math.max(i,e),s)}class Camera{constructor(e={}){this.cameraState={view:identity$2(new Float32Array(16)),projection:identity$2(new Float32Array(16)),center:e.center||[0,0,0],theta:e.theta||0,phi:e.phi||0,distance:Math.log(e.distance||1e3),eye:new Float32Array(3),up:new Float32Array(e.up||[0,1,0])},this.right=new Float32Array([1,0,0]),this.front=new Float32Array([0,0,1]),this.minDistance=Math.log("minDistance"in e?e.minDistance:.5),this.maxDistance=Math.log("maxDistance"in e?e.maxDistance:1e14),this.dtheta=0,this.dphi=0,this.ddistance=0,this.updateCamera()}mouseChange(e,s){var o=Math.max(this.cameraState.distance,.5);this.dtheta+=o*e,this.dphi+=o*s,this.updateCamera()}getProjection(){return{projection:this.cameraState.projection,view:this.cameraState.view,distance:this.cameraState.distance,eye:this.cameraState.eye}}mouseWheel(e,s){this.ddistance+=s/window.innerHeight,this.updateCamera()}updateCamera(){var e=this.cameraState.center,s=this.cameraState.eye,o=this.cameraState.up;this.cameraState.theta+=this.dtheta,this.cameraState.phi=clamp$2(this.cameraState.phi+this.dphi,-Math.PI/2,Math.PI/2),this.cameraState.distance=clamp$2(this.cameraState.distance+this.ddistance,this.minDistance,this.maxDistance),this.dtheta=damp(this.dtheta),this.dphi=damp(this.dphi),this.ddistance=damp(this.ddistance);for(var a=this.cameraState.theta,d=this.cameraState.phi,g=Math.exp(this.cameraState.distance),_=g*Math.sin(a)*Math.cos(d),j=g*Math.cos(a)*Math.cos(d),_e=g*Math.sin(d),et=0;et<3;++et)s[et]=e[et]+_*this.front[et]+j*this.right[et]+_e*o[et];lookAt(this.cameraState.view,s,e,o)}}class WGL2DI{constructor(e,s){var o=this;s||(s={}),this.config=s,s.offset||(s.offset=[0,0,0,0]),this.mode=s.mode||"2d",this.movingImage=0,this.__doc__=document,this.config.brush=this.config.brush||"default",this.draw_options=s.draw_options?s.draw_options:{depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"src alpha",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}},this.regl=null,this.pick_buffer=null,this.hideOnFilter=!0,this.pointOpacity=.8,this.pointRadius=10,this.isFiltered=!1,this.x_scale=1,this.y_scale=1,this.offset=[0,0],typeof e=="string"?this.div_container=document.getElementById(e):this.div_container=e,this._setUpDocument(s.width,s.height),this.handlers={object_clicked:{},object_over:{},object_out:{},brush_stopped:{},zoom_stopped:{},panning_stopped:{},pan_or_zoom:{}},this.draw_labels=!1,this.object_types=[],this.pointScale=0,this.circle_properties={x_pos:1,y_pos:1,color:1,pick_color:1,localFilter:1,globalFilter:1},this.circles={};for(var a in this.circle_properties)this.circles[a]=[];this.circles.count=0,this.object_types.push({data:this.circles,properties:this.circle_properties,vertices:1,primitive:"points"}),this.line_properties={position:2,color:2,opacity:2},this.lines={};for(var a in this.line_properties)this.lines[a]=[];this.lines.count=0,this.object_types.push({data:this.lines,properties:this.line_properties,vertices:2,primitive:"lines"}),this.image_properties={position:2,color:2,opacity:2},this.images={};for(var a in this.image_properties)this.images[a]=[];this.images.count=0,this.images.props={x_y:[],w_h:[],text:[]},this.object_types.push({data:this.images,properties:this.image_properties,vertices:6,primitive:"triangles"}),this.mode==="3d"&&(this.circle_properties.z_pos=1,this.camera=new Camera({center:s.cameraCenter,distance:s.cameraDistance||500,theta:.75,phi:.5}),this.axisScales=[1,1,1]),this.square_properties={x_pos:1,y_pos:1,color:1,pick_color:1,localFilter:1,globalFilter:1},this.squares={};for(var a in this.square_properties)this.squares[a]=[];this.squares.count=0,this.object_types.push({data:this.squares,properties:this.square_properties,vertices:1,primitive:"points"}),this.mouse_position=null,this.object_clicked=null,this.dragging=!1,this.object_mouse_over=null,this.zoom_amount=0,this.draw_order=this.mode==="3d"?[2,0,1,3]:[2,0,1,3],reglExports({onDone:function(d,g){o.regl=g,g._refresh(),o.pickbuffer=g.framebuffer({colorFormat:"rgba",height:o.height,width:o.width}),o._initDrawMethods(),o.mode==="3d"&&(o.object_types[0].method=o.__draw3DCircles,o.object_types[1].method=o.__draw3DLines),o._addHandlers()},canvas:o.canvas,attributes:{antialias:!1}})}setBackGroundColor(e){e=e||"",this.div_container.style.background=e}_setUpDocument(e,s){if(this.config.brush&&(this.div_container.style.cursor="crosshair"),s)this.height=s,this.width=e,this.div_container.style.height=s+"px",this.div_container.style.width=e+"px";else{const a=this.div_container.getBoundingClientRect();this.height=s=Math.round(a.height),this.width=e=Math.round(a.width)}const o={height:s,width:e,styles:{position:"absolute",left:"0px",top:"0px"}};this.canvas=createEl("canvas",o),this.label_canvas=createEl("canvas",o),this.label_context=this.label_canvas.getContext("2d"),this.div_container.append(this.canvas),this.div_container.append(this.label_canvas)}colorPoints(e){const s=this.circles.count,o=this.circles.color;for(let a=0;a<s;a++){const d=e(a),g=a*3;o[g]=d[0],o[g+1]=d[1],o[g+2]=d[2]}if(this.highlightPoints){const a=this.highlightPoints;for(let d=0;d<a.length;d++){const g=a.indexes[d]*3,_=d*3;a.color[_]=this.circles.color[g],a.color[_+1]=this.circles.color[g+1],a.color[_+2]=this.circles.color[g+2]}}}remove(){this.pickbuffer.destroy(),this.regl.destroy(),this.canvas.remove(),this.label_canvas.remove()}setSize(e,s,o=null){if(this.height===s&&this.width===e)return;let a=this;if(e=Math.round(e),s=Math.round(s),o){const g=o(e,s);this.x_scale=g[0],this.y_scale=g[1]}else{let g=e/this.width,_=s/this.height;this.x_scale=this.x_scale*g,this.y_scale=this.y_scale*_}this.height=s,this.width=e,this.div_container.style.height=s+"px",this.div_container.style.width=e+"px",this.canvas.setAttribute("height",s),this.canvas.setAttribute("width",e),this.label_canvas.setAttribute("height",s),this.label_canvas.setAttribute("width",e),this.pickbuffer.destroy(),this.pickbuffer=this.regl.framebuffer({colorFormat:"rgba",height:s,width:e});let d=this.regl.frame(function(){});setTimeout(()=>{a.refresh(),d.cancel()},200)}_getMousePosition(e){var s=this.canvas.getBoundingClientRect();return[e.clientX-s.left,e.clientY-s.top]}_getActualPosition(e){var s=e[0]/this.x_scale-this.offset[0],o=e[1]/this.y_scale-this.offset[1];return[s,o]}_getCanvasCoords(e){let s=(e[0]+this.offset[0])*this.x_scale,o=(e[1]+this.offset[1])*this.y_scale;return[s,o]}getRange(){let e=this._getActualPosition([0,0]),s=this._getActualPosition([this.width,this.height]);return{x_range:[e[0],s[0]],y_range:[e[1],s[1]],offset:[this.offset[0],this.offset[1]],scale:[this.x_scale,this.y_scale]}}setHighlightPoints(e){if(e==null){this.highlightPoints=null;return}const s={x_pos:[],y_pos:[],color:[],length:e.length,indexes:e};this.mode==="3d"&&(s.z_pos=[]);for(let o of e){s.x_pos.push(this.circles.x_pos[o]),s.y_pos.push(this.circles.y_pos[o]),this.mode==="3d"&&s.z_pos.push(this.circles.z_pos[o]);const a=o*3;s.color.push(this.circles.color[a]),s.color.push(this.circles.color[a+1]),s.color.push(this.circles.color[a+2])}this.highlightPoints=s}setPointRadius(e){(!e||isNaN(e))&&(e=0),this.pointRadius=e}setFilter(e){this.isFiltered=e}setHideOnFilter(e){this.hideOnFilter=e}setPointOpacity(e){e=e>1?1:e,e=e<0?0:e,this.pointOpacity=e}getPointOpacity(){return this.pointOpacity}getPointRadius(){return this.pointRadius}addLine(e,s,o=[0,0,0],a=1){return this.lines.position=this.lines.position.concat(e,s),this.lines.color=this.lines.color.concat(o,o),this.lines.opacity=this.lines.opacity.concat([a,a]),this.lines.count++,this.lines.count-1}changeImage(e,s,o){this.images.props.text[o]=this.regl.texture({data:e,min:"linear"}),this.resizeImage([s.width,s.height],o),this.setImagePosition(s.position[0],s.position[1],o)}changeImageOpacity(e,s){const o=e*6,a=o+6;for(let d=o;d<a;d++)this.images.opacity[d]=s}moveImage(e,s){const o=this.movingImage*6,a=o+6;for(let g=o;g<a;g++){const _=this.images.position[g];_[0]+=e,_[1]+=s}const d=this.images.props.x_y[this.movingImage];d[0]+=e,d[1]+=s}setImagePosition(e,s,o){const a=this.images.position,d=o*6,g=this.images.props.w_h[o][0],_=this.images.props.w_h[o][1];s=-s-_,this.images.props.x_y[o]=[e,s],a[d]=[e,s],a[d+1]=[e,s+_],a[d+2]=[e+g,s+_],a[d+3]=[e+g,s+_],a[d+4]=[e+g,s],a[d+5]=[e,s]}getImageDetails(e){const s=this.images.props.w_h[e],o=this.images.props.x_y[e];return{width:s[0],height:s[1],position:[o[0],o[1]],index:e}}resizeImage(e,s){const o=this.images.props.w_h[s],a=this.images.props.x_y[s];let d,g=null;Array.isArray(e)?(d=e[0],g=e[1],o[0]=d,o[1]=g):(d=o[0]*=e,g=o[1]*=e);const _=a[0],j=a[1];this.images.position[1]=[_,j+g],this.images.position[2]=[_+d,j+g],this.images.position[3]=[_+d,j+g],this.images.position[4]=[_+d,j]}addImage(e,s){const o=s;let a=this,d=o.position[0],g=-o.position[1];const _=o.height,j=o.width;g=g-_,this.images.position.length,this.images.position.push([d,g]),this.images.position.push([d,g+_]),this.images.position.push([d+j,g+_]),this.images.position.push([d+j,g+_]),this.images.position.push([d+j,g]),this.images.position.push([d,g]),this.image_position=[[-1,1],[-1,0],[0,0],[0,0],[0,1],[-1]];const _e=o.opacity==null?1:o.opacity;for(var et=0;et<6;et++)this.images.color.push([1,1,1]),this.images.opacity.push(_e);return this.images.count++,this.images.props.x_y.push([d,g]),this.images.props.w_h.push([j,_]),this.images.props.text.push(a.regl.texture({data:e,min:"linear"})),this.images.count-1}removeImages(){this.images.position=[],this.images.color=[],this.images.opacity=[],this.images.props.x_y=[],this.images.props.w_h=[],this.images.props.text=[],this.images.count=0}addSquares(e){this.squares.x_pos=e.x,this.squares.y_pos=e.y;const s=e.x.length;this.squares.localFilter=e.localFilter,this.squares.globalFilter=e.globalFilter,this.squares.pick_color=new Uint8Array(s*3),this.squares.color=new Uint8Array(s*3);for(let o=0;o<s;o++){let a=o*3;const d=e.colorFunc(o);this.squares.color[a]=d[0],this.squares.color[a+1]=d[1],this.squares.color[a+2]=d[2];let g=this._getRGBFromIndex(o+1);this.squares.pick_color[a]=g[0],this.squares.pick_color[a+1]=g[1],this.squares.pick_color[a+2]=g[2]}this.squares.count=s}addCircles(e){this.circles.x_pos=e.x,this.circles.y_pos=e.y,this.mode==="3d"&&(this.circles.z_pos=e.z);const s=e.x.length;this.circles.localFilter=e.localFilter,this.circles.globalFilter=e.globalFilter,this.circles.pick_color=new Uint8Array(s*3),this.circles.color=new Uint8Array(s*3);for(let o=0;o<s;o++){let a=o*3;const d=e.colorFunc(o);this.circles.color[a]=d[0],this.circles.color[a+1]=d[1],this.circles.color[a+2]=d[2];let g=this._getRGBFromIndex(o+1);this.circles.pick_color[a]=g[0],this.circles.pick_color[a+1]=g[1],this.circles.pick_color[a+2]=g[2]}this.circles.count=s}updateSize(e,s){this.circles.x_pos=s.x,this.circles.y_pos=s.y,this.mode==="3d"&&(this.circles.z_pos=s.z),this.circles.localFilter=s.localFilter,this.circles.globalFilter=s.globalFilter;let o=new Uint8Array(e*3),a=new Uint8Array(e*3);a.set(this.circles.color),o.set(this.circles.pick_color),this.circles.color=a,this.circles.pick_color=o;for(let d=this.circles.count;d<e;d++){let g=d*3;const _=s.colorFunc(d);this.circles.color[g]=_[0],this.circles.color[g+1]=_[1],this.circles.color[g+2]=_[2];let j=this._getRGBFromIndex(d+1);this.circles.pick_color[g]=j[0],this.circles.pick_color[g+1]=j[1],this.circles.pick_color[g+2]=j[2]}this.circles.count=e}_getRGBFromIndex(e){var s=Math.floor(e/65536),o=e%65536,a=Math.floor(o/256),d=o%256;return[d,a,s]}_getIndexFromRGB(e){return e[2]*65536+e[1]*256+e[0]}_drawPickBuffer(){this.regl.clear({color:[0,0,0,0],depth:1,framebuffer:this.pickbuffer}),this._drawObjects(!0)}refresh(){this.regl.clear({color:[0,0,0,0],depth:1}),this._drawObjects(!1),this._drawPickBuffer(),this.label_context.font="30px Arial"}setCamera(e,s,o){if(this.mode!=="3d")return;const a=this.camera.cameraState;a.distance=Math.log(e),a.theta=s,a.phi=o,this.camera.updateCamera()}getCameraSettings(){if(this.mode!=="3d")return;const e=this.camera.cameraState;return{distance:Math.pow(Math.E,e.distance),theta:e.theta,phi:e.phi}}zoom(e){this.x_scale*=e,this.y_scale*=e,this._drawObjects(!1)}setFilterAction(e){e==="grey"?this.hideOnFilter=!1:this.hideOnFilter=!0}_drawObjects(e){let s=null;if(this.mode==="3d"){const d=this.camera.getProjection();s={cameraProjection:d.projection,cameraView:d.view,cameraDistance:d.distance,axisScales:this.axisScales,cameraEye:d.eye}}else s={x_scale:this.x_scale,y_scale:this.y_scale,offset:this.offset};s.point_scale=this.pointScale?(this.x_scale+this.y_scale)/2/this.pointScale:1,s.point_radius=this.pointRadius,s.is_filtered=this.isFiltered?1:0,s.point_opacity=this.pointOpacity,s.hide_on_filter=this.hideOnFilter?1:0;for(let d of this.draw_order){var o=this.object_types[d];if(o.data.count){if(e){if(!o.properties.pick_color)continue;e=this.pickbuffer}else e=null;if(s.buffer=e,s.count=o.data.count*o.vertices,s.primitive=o.primitive,s.is_buffer=e?1:0,d===2){for(let g=0;g<o.data.count;g++){for(let _ in o.properties)s[_]=o.data[_].slice(g*6,g*6+6);for(let _ in this.images.props)s[_]=this.images.props[_][g];o.method(s)}continue}if(d===3){if(e)continue;this.x_scale>=this.y_scale?(s.side_length=20*this.x_scale,s.bottom_clip=this.y_scale/this.x_scale,s.right_clip=1):(s.side_length=20*this.y_scale,s.right_clip=this.x_scale/this.y_scale,s.bottom_clip=1)}for(var a in o.properties)if(e){if(a==="pick_color"){s.color=o.data[a];continue}if(a==="color")continue;s[a]=o.data[a]}else{if(a==="pick_color")continue;s[a]=o.data[a]}o.method(s)}}this.highlightPoints&&!e&&(s.x_pos=this.highlightPoints.x_pos,s.y_pos=this.highlightPoints.y_pos,s.color=this.highlightPoints.color,s.primitive="points",s.count=this.highlightPoints.length,this.mode==="3d"?(s.z_pos=this.highlightPoints.z_pos,this.__draw3DHighlights(s)):this.__drawHighlights(s))}getObjectsInRange(e,s,o,a){console.log(`${e},${s},${o},${a}`);const d=o*a*4;var g=this.regl.read({x:e,y:this.height-s-a,width:o,height:a,framebuffer:this.pickbuffer});const _=new Set;for(let j=0;j<d;j+=4){const _e=this._getIndexFromRGB([g[j],g[j+1],g[j+2]]);_e!==null&&_.add(_e-1)}return _}_getObjectAtPosition(e){if(!(e[1]<=0||e[0]<=0)){try{var s=this.regl.read({x:e[0],y:this.height-e[1],width:1,height:1,framebuffer:this.pickbuffer})}catch{console.log(e)}if(s[0]===0&&s[1]===0&&s[2]===0)return null;var o=this._getIndexFromRGB(s);return o>0?o-1:null}}addHandler(e,s,o){var a=this.handlers[e];if(!a)throw"Handler Not Supported";return o||(o=Object.keys(a).length),a[o]=s,o}removeHandler(e,s){var o=this.handlers[e];if(!o)throw"Handler Not Supported";delete o.name}_setUpBrush(e){let s=createEl("div",{classes:["wgl2di-brush"],styles:{top:e[1]+"px",left:e[0]+"px"}},this.div_container);makeDraggable(s,{contain:!0,ondragstart:()=>this.brush_moving=!0,ondragend:()=>this._brushingStopped(),doc:this.__doc__}),this.brush={origin:e,div:s,resizing:!0}}_setUpPolyBrush(e){this.poly_brush={points:[e],active:!0};let s=this.label_context;s.strokeStyle=getComputedStyle(this.canvas).getPropertyValue("color"),s.beginPath(),s.moveTo(e[0],e[1])}_extendPolyBrush(e,s=15){var a;const o=this.label_context;if(this.poly_brush.points.length){const d=this.poly_brush.points[this.poly_brush.points.length-1],g=d[0]-e[0],_=d[1]-e[1];if(Math.sqrt(g**2+_**2)<s)return}o.lineTo(e[0],e[1]),o.stroke(),(a=this.poly_brush)==null||a.points.push(e)}_finishPolyBrush(){if(this.poly_brush.points.length<3){this.clearBrush();return}let e=this.label_context;const s=this.poly_brush.points[0];e.lineTo(s[0],s[1]),e.stroke(),e.closePath(),e.fillStyle="lightgray",e.globalAlpha=.2,e.fill(),e.globalAlpha=1;let o=[];this.poly_brush.active=!1;for(let d of this.poly_brush.points)o.push(this._getActualPosition(d));for(var a in this.handlers.brush_stopped)setTimeout(()=>this.handlers.brush_stopped[a](o,!0),0)}clearBrush(){this.brush&&(this.brush.div.remove(),this.brush=null),this.poly_brush&&(this.label_context.clearRect(0,0,this.width,this.height),this.poly_brush=null)}_brushingStopped(){if(!this.brush)return;this.brush.resizing=!1;const e=this.brush.div,s=e.offsetTop,o=e.offsetLeft,a=e.offsetWidth,d=e.offsetHeight;if(a<2){this.clearBrush();return}if(this.mode==="3d"){const _=this.getObjectsInRange(o,s,a,d);for(var g in this.handlers.brush_stopped)this.handlers.brush_stopped[g](_)}else{let _=this._getActualPosition([o,s]),j=this._getActualPosition([o+a,s+d]),_e={x_min:_[0],x_max:j[0],y_max:-_[1],y_min:-j[1]};for(var g in this.handlers.brush_stopped)this.handlers.brush_stopped[g](_e)}}setGlobalFilter(e){this.circles.globalFilter=e}_addHandlers(){var e=this;this.div_container.addEventListener("mousemove",function(s){if(e.brush){if(e.brush.resizing){let j=e.brush.origin,_e=e._getMousePosition(s),et=Math.round(j[0]<_e[0]?j[0]:_e[0])+"px",tt=Math.round(j[1]<_e[1]?j[1]:_e[1])+"px",rt=Math.abs(j[0]-_e[0])+"px",it=Math.abs(j[1]-_e[1])+"px";e.brush.div.style.top=tt,e.brush.div.style.left=et,e.brush.div.style.width=rt,e.brush.div.style.height=it;return}else if(e.brush.moving){e.dragging=!1;return}}if(e.poly_brush&&e.poly_brush.active){let j=e._getMousePosition(s);e._extendPolyBrush(j)}if(e.mouse_position&&!e.dragging){var o=s.pageX-e.mouse_position[0],a=s.pageY-e.mouse_position[1];(Math.abs(o)>3||Math.abs(a)>3)&&(e.dragging=!0)}if(e.dragging){const j=s.pageX-e.mouse_position[0],_e=s.pageY-e.mouse_position[1];if(e.mode==="3d")e.camera.mouseChange(j/e.width,_e/e.height);else{const et=j/e.x_scale,tt=_e/e.y_scale;if(e.movingImage!=null&&s.ctrlKey&&e.images.count>0)e.moveImage(et,tt),e.imageMoved=e.getImageDetails(e.movingImage);else if(e.offsets&&s.which==3)e.alterOffsets(et,tt);else{e.config.lock_x_axis||(e.offset[0]+=et),e.offset[1]+=tt;for(var d in e.handlers.pan_or_zoom)e.handlers.pan_or_zoom[d](e.offset,e.x_scale,e.y_scale)}}e.loop||(e.loop=e.regl.frame(()=>{e.regl.clear({color:[0,0,0,0],depth:1}),e._drawObjects(!1)})),e.mouse_position[1]=s.pageY,e.mouse_position[0]=s.pageX}else{var g=e._getMousePosition(s),_=e._getObjectAtPosition(g);if(_!=null&&e.object_mouse_over==null){for(var d in e.handlers.object_over)e.handlers.object_over[d](s,_);e.object_mouse_over=_}else if(_==null&&e.object_mouse_over){for(var d in e.handlers.object_out)e.handlers.object_out[d](s,e.object_mouse_over);e.object_mouse_over=null}else if(_!=null&&_!==e.object_mouse_over){for(var d in e.handlers.object_over)e.handlers.object_over[d](s,_);e.object_mouse_over=_}}}),this.div_container.addEventListener("mouseleave",function(s){if(e.object_mouse_over){for(var o in e.handlers.object_out)e.handlers.object_out[o](e.object_mouse_over[2]);e.object_mouse_over=null}e.brush&&e.brush.resizing&&e._brushingStopped()}),this.div_container.addEventListener("mouseup",function(s){if(e.config.brush&&(e.div_container.style.cursor="crosshair"),e.brush&&e.brush.resizing&&e._brushingStopped(),e.poly_brush&&e.poly_brush.active&&e._finishPolyBrush(),!e.dragging&&!(e.brush||e.poly_brush)){var o=e._getMousePosition(s),a=e._getObjectAtPosition(o);if(a)for(var d in e.handlers.object_clicked)e.handlers.object_clicked[d](a)}else{if(e.object_clicked)e.object_clicked=null,e.refresh(!0);else{let g=e.getRange();e.loop&&(e.loop.cancel(),e.loop=null),e.refresh(),g.imageMoved=e.imageMoved,e.imageMoved=null;for(var d in e.handlers.panning_stopped)e.handlers.panning_stopped[d](g)}e.dragging=!1}e.object_clicked=null,e.mouse_position=null}),this.div_container.addEventListener("wheel",function(s){s.preventDefault();var o=e._getActualPosition(e._getMousePosition(s));let a=0;if(s.wheelDelta>0||s.detail<0?(e.zoom_amount+=.01,a=-30):(e.zoom_amount-=.01,a=30),e.mode==="3d")e.camera.mouseWheel(0,a);else if(e.movingImage!=null&&s.ctrlKey){e.resizeImage(1+e.zoom_amount,e.movingImage);const g=e._getActualPosition(e._getMousePosition(s));e.moveImage(g[0]-o[0],g[1]-o[1]),e.imageMoved=e.getImageDetails(e.movingImage)}else{e.config.lock_x_axis||(e.x_scale*=1+e.zoom_amount),e.config.lock_y_axis||(e.y_scale*=1+e.zoom_amount);const g=e._getActualPosition(e._getMousePosition(s));e.offset[0]+=g[0]-o[0],e.offset[1]+=g[1]-o[1];for(var d in e.handlers.pan_or_zoom)e.handlers.pan_or_zoom[d](e.offset,e.x_scale,e.y_scale)}e.loop||(e.label_context.clearRect(0,0,e.width,e.height),e.loop=e.regl.frame(function(){e.regl.clear({color:[0,0,0,0],depth:1}),e._drawObjects(!1)})),clearTimeout(e._timer),e._timer=setTimeout(function(){e.zoom_amount=0,e.loop.cancel(),e.loop=null,e._drawPickBuffer(!1),e.brush;let g=e.getRange();g.imageMoved=e.imageMoved,e.imageMoved=null;for(let _ in e.handlers.zoom_stopped)e.handlers.zoom_stopped[_](g);e.refresh()},350)}),this.div_container.addEventListener("mousedown",function(s){s.which;let o=s.shiftKey||s.ctrlKey||s.which==2||s.which==3;if(e.config.brush&&!o||!e.config.brush&&o){let a=e._getMousePosition(s);if(e.config.brush=="default"){if(s.target.classList.contains("wgl2di-brush"))return;e.brush&&e.clearBrush();let g=e._getMousePosition(s);e._setUpBrush(g);return}else if(e.config.brush==="poly"){e.poly_brush&&e.clearBrush(),e._setUpPolyBrush(a);return}}s.otherKey&&(e.div_container.style.cursor="move"),e._getMousePosition(s),e.mouse_position=[s.pageX,s.pageY],e.clearBrush(),s.preventDefault()})}_initDrawMethods(){var e=this;this.__drawCircles=this.regl({depth:e.draw_options.depth,blend:e.draw_options.blend,frag:`precision mediump float;
			varying vec3 fragColor;
			varying float op;
			varying float has_border;
			varying float grey_out;
			uniform float is_buffer;
			
			void main(){
			
				vec2 cxy = 2.0 * gl_PointCoord - 1.0;
                
				float r = dot(cxy, cxy);
				if (r > 1.0) {
					discard;
				}
				else{					
					if(r>0.60 && has_border==-1.0 && is_buffer==0.0 && grey_out==0.0){
					    gl_FragColor=vec4(0.1,0.1,0.1,1.0);
					}
					else{
						if (grey_out==1.0 && is_buffer==0.0){
							gl_FragColor = vec4(0.2,0.2,0.2,0.4);
						}
						else{
							gl_FragColor = vec4(fragColor,is_buffer==1.0?1.0:op);
						}
						
					}
				}
				
			}`,vert:`attribute float x_pos;
            attribute float y_pos;
			attribute vec3 color;
			attribute float lFilter;
			attribute float gFilter;
			varying vec3 fragColor;
			varying float op;
			varying float has_border;
			varying float grey_out;
			uniform float x_scale;
			uniform float y_scale;
			uniform vec2 offset;
			uniform float stage_height;
			uniform float stage_width;
			uniform float point_radius;
			uniform float is_filtered;
			uniform float point_opacity;
			uniform float hide_on_filter;
			uniform float point_scale;
			
			vec2 normalizeCoords(float posX, float posY){
				float x = (posX+offset[0])*x_scale;
				float y = (posY+offset[1])*y_scale;
				return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
			}
	
			void main() {
				float dd = 0.0;
				grey_out=0.0;
				if (lFilter==2.0){
					return;
				}
			    if (gFilter>0.0 && gFilter != lFilter) {
					if(hide_on_filter==1.0){
						return;
					}
					else{
						grey_out=1.0;
					}
				}
				
			
				float r=point_radius;
			
				gl_PointSize = r*point_scale;
				vec3 c = vec3(255.0,255.0,255.0);
				if (color==c){
					op=0.1;
					fragColor=vec3(0.1,0.1,0.1);
				}
				else{
					op=point_opacity;
					fragColor = color/255.0;
				}
			
				
				
				has_border=lFilter-is_filtered;
			
				
				vec2 real_position = normalizeCoords(x_pos,-y_pos);
				gl_Position = vec4(real_position, 0.0, 1.0);
			}
			`,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),color:e.regl.prop("color"),lFilter:e.regl.prop("localFilter"),gFilter:e.regl.prop("globalFilter")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_width:e.regl.context("viewportWidth"),stage_height:e.regl.context("viewportHeight"),offset:e.regl.prop("offset"),point_radius:e.regl.prop("point_radius"),point_opacity:e.regl.prop("point_opacity"),is_filtered:e.regl.prop("is_filtered"),is_buffer:e.regl.prop("is_buffer"),hide_on_filter:e.regl.prop("hide_on_filter"),point_scale:e.regl.prop("point_scale")},count:e.regl.prop("count"),primitive:e.regl.prop("primitive"),framebuffer:e.regl.prop("buffer")}),this.__drawHighlights=this.regl({depth:e.draw_options.depth,blend:e.draw_options.blend,depth:e.draw_options.depth,blend:e.draw_options.blend,frag:`precision highp float;
			varying vec3 fragColor;
			
			void main(){

				vec2 cxy = 2.0 * gl_PointCoord - 1.0;
                
				float r = dot(cxy, cxy);
				if (r > 1.0) {
					discard;
				}
				else{					
					if(r>0.50) {
					    gl_FragColor=vec4(0.1,0.1,0.1,1.0);
					}
					else{
						gl_FragColor = vec4(fragColor,1);
					}
				}	
			}`,vert:`attribute float x_pos;
            attribute float y_pos;
			attribute vec3 color;
			uniform float point_radius;
			
			varying vec3 fragColor;
		
			uniform float x_scale;
			uniform float y_scale;
			uniform vec2 offset;
			uniform float stage_height;
			uniform float stage_width;
			uniform float point_scale;
			
			vec2 normalizeCoords(float posX, float posY){
				float x = (posX+offset[0])*x_scale;
				float y = (posY+offset[1])*y_scale;
				return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
			}
	
			void main() {
			
				float pr = point_radius*point_scale;
				pr = pr<10.0?10.0:pr;
				gl_PointSize = pr;
				fragColor = color/255.0;
					
				vec2 real_position = normalizeCoords(x_pos,-y_pos);
				gl_Position = vec4(real_position, 0.0, 1.0);
			}
			`,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),color:e.regl.prop("color")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_width:e.regl.context("viewportWidth"),stage_height:e.regl.context("viewportHeight"),offset:e.regl.prop("offset"),point_radius:e.regl.prop("point_radius"),point_scale:e.regl.prop("point_scale")},count:e.regl.prop("count"),primitive:e.regl.prop("primitive")}),this.object_types[0].method=this.__drawCircles,this.__drawLines=this.regl({frag:`precision highp float;
						varying vec3 fragColor;
						void main () {
							 gl_FragColor = vec4(fragColor,1);
						}`,vert:`
						attribute vec2 position;
						attribute vec3 color;
						attribute float opacity;
						uniform float x_scale;
						uniform float y_scale;
						uniform vec2 offset;
						uniform float stage_height;
						uniform float stage_width;
						varying vec3 fragColor;
						//varying float op;
						vec2 normalizeCoords(vec2 position){	    
							float x = (position[0]+offset[0])*x_scale;
							float y = (position[1]+offset[1])*y_scale;
				            return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
						}
						void main () {
							if (opacity==0.0){
								return;
							}
							fragColor=color/255.0;
							vec2 norm_pos =normalizeCoords(position*vec2(1,-1));
							gl_Position = vec4(norm_pos, 0.0, 1.0);
						}`,attributes:{position:e.regl.prop("position"),color:e.regl.prop("color"),opacity:e.regl.prop("opacity")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_height:e.regl.context("viewportHeight"),stage_width:e.regl.context("viewportWidth"),offset:e.regl.prop("offset")},primitive:e.regl.prop("primitive"),count:e.regl.prop("count")}),this.object_types[1].method=this.__drawLines,this.__drawImages=this.regl({frag:`
				precision mediump float;
				uniform sampler2D text;
				varying vec2 uv;
				varying vec3 fragColor;
				varying float op;
				void main () {
					gl_FragColor = vec4(fragColor,op)*texture2D(text, uv);							
				}`,vert:`
				precision mediump float;

				attribute vec2 position;
				attribute vec3 color;
				attribute float opacity;

				uniform vec2 x_y;
				uniform vec2 w_h;
				uniform float stage_height;
				uniform float stage_width;
				uniform float x_scale;
				uniform float y_scale;
				uniform vec2 offset;

				varying vec2 uv;
				varying vec3 fragColor;
				varying float op;
		
				
				vec2 normalizeCoords(vec2 pos){
					float x = (pos[0]+offset[0])*x_scale;
					float y = (pos[1]+offset[1])*y_scale;
					return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
				}

				void main () {
					if (opacity==0.0){
						return;
					}
					op=opacity;
					
					vec2 new_pos=normalizeCoords(position);
					fragColor = color;
				
					float x_factor = 1.0/(((w_h[0]*x_scale)/stage_width)*2.0);
					float y_factor = 1.0/(((w_h[1]*y_scale)/stage_height)*2.0);
					

					float x_offset=(((x_y[0]+offset[0])*x_scale)/stage_width)*2.0*x_factor;
					float y_offset=(((x_y[1]+offset[1])*y_scale)/stage_height)*2.0*y_factor;
					uv = vec2((new_pos[0]*x_factor)+x_factor-x_offset,-(new_pos[1]*y_factor)+y_factor-y_offset);
					gl_Position = vec4(new_pos, 0.0, 1.0);

				}`,attributes:{position:e.regl.prop("position"),color:e.regl.prop("color"),opacity:e.regl.prop("opacity")},uniforms:{stage_height:e.regl.context("viewportHeight"),stage_width:e.regl.context("viewportWidth"),w_h:e.regl.prop("w_h"),x_y:e.regl.prop("x_y"),text:e.regl.prop("text"),x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),offset:e.regl.prop("offset")},count:e.regl.prop("count"),depth:e.draw_options.depth,blend:e.draw_options.blend}),this.object_types[2].method=this.__drawImages,this.__drawSquares=this.regl({frag:`
				precision highp float;
				varying vec3 fragColor;
				varying float r_clip;
				varying float b_clip;
				uniform int is_buffer;
				void main(){
					if (gl_PointCoord[1]<1.0-b_clip){
						discard;
					}
					if (gl_PointCoord[0]> r_clip){
						discard;
					}				
					gl_FragColor = vec4(fragColor,1);					
				}
				`,vert:` 
				attribute float x_pos;
				attribute float y_pos;			
				attribute vec3 color;
			
				varying float r_clip;
				varying float b_clip;
				varying vec3 fragColor;

				uniform float x_scale;
				uniform float y_scale;
				uniform vec2 offset;
				uniform float stage_height;
				uniform float stage_width;
				uniform float right_clip;
				uniform float bottom_clip;
				uniform float side_length;
				
				vec2 normalizeCoords(float posX,float posY){
					float x = (posX+offset[0])*x_scale;
					float y = (posY+offset[1])*y_scale;
					return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
				}
				void main() {
					gl_PointSize = side_length;
					fragColor = color/255.0;
					r_clip=right_clip;
					b_clip= bottom_clip;
					float y = y_pos;
					float x = x_pos;
					if (bottom_clip!=1.0){
						y-=10.0*(1.0/b_clip)-10.0;
					}
					if (r_clip!=1.0){
						x+=10.0*(1.0/r_clip)-10.0;
					}

					vec2 real_position = normalizeCoords(x,y);
				
					gl_Position = vec4(real_position, 0.0, 1.0);
				}
			`,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),color:e.regl.prop("color")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_height:e.regl.context("viewportHeight"),stage_width:e.regl.context("viewportWidth"),offset:e.regl.prop("offset"),is_buffer:e.regl.prop("is_buffer"),right_clip:e.regl.prop("right_clip"),bottom_clip:e.regl.prop("bottom_clip"),side_length:e.regl.prop("side_length")},count:e.regl.prop("count"),primitive:e.regl.prop("primitive"),framebuffer:e.regl.prop("buffer")}),this.object_types[3].method=this.__drawSquares,this.__draw3DCircles=this.regl({frag:`
            precision highp float;
            varying vec3 fragColor;
			varying float op;
			varying float has_border;
			uniform float is_buffer;
			varying float grey_out;
            void main () {
			  float r = length(gl_PointCoord.xy - 0.4) ;
              if (r> 0.4) {
                discard;
              }
			  else{
				if(r>0.3 && has_border==-1.0 && is_buffer==0.0 && grey_out==0.0){
					gl_FragColor=vec4(0.1,0.1,0.1,1.0);
				}
				else{
					if (grey_out==1.0 && is_buffer==0.0){
						gl_FragColor = vec4(0.2,0.2,0.2,0.4);
					}
					else{
						gl_FragColor = vec4(fragColor,is_buffer==1.0?1.0:op);
					}
					
				}

			  }
             
            }
            `,vert:`
            precision highp float;

            attribute float x_pos;
            attribute float y_pos;
            attribute float z_pos;
            attribute vec3 color;
            attribute float lFilter;
            attribute float gFilter;
			
			uniform float time;
            uniform float cdistance;
            uniform mat4 view, projection;
			uniform vec3 eye;
			uniform float point_radius;
			uniform float point_opacity;
			uniform float is_buffer;
			uniform float is_filtered;
			uniform float hide_on_filter;
			uniform vec3 axis_scales;


            varying vec3 fragColor;
			varying float op;
			varying float has_border;
			varying float grey_out;

            void main () {
				grey_out=0.0; 
			    if (gFilter>0.0 && gFilter != lFilter) {
					if(hide_on_filter==1.0){
						return;
					}
					else{
						grey_out=1.0;
					}
				}
                vec3 position = vec3(-x_pos *axis_scales.x,y_pos*axis_scales.y,-z_pos*axis_scales.z);
                fragColor=color/255.0;
				op = is_buffer==1.0?1.0:point_opacity;
				has_border=lFilter-is_filtered;
               
				gl_PointSize = point_radius; //(distance(eye, position.xyz) /30.0);
                gl_Position = projection * view * vec4(2.0 * position, 1.0);
            }
            `,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),z_pos:e.regl.prop("z_pos"),color:e.regl.prop("color"),lFilter:e.regl.prop("localFilter"),gFilter:e.regl.prop("globalFilter")},uniforms:{point_radius:e.regl.prop("point_radius"),point_opacity:e.regl.prop("point_opacity"),is_buffer:e.regl.prop("is_buffer"),view:e.regl.prop("cameraView"),cdistance:e.regl.prop("cameraDistance"),eye:e.regl.prop("cameraEye"),is_filtered:e.regl.prop("is_filtered"),hide_on_filter:e.regl.prop("hide_on_filter"),axis_scales:e.regl.prop("axisScales"),projection:(s,o)=>perspective(o.cameraProjection,Math.PI/4,s.viewportWidth/s.viewportHeight,1,1e5)},count:e.regl.prop("count"),framebuffer:e.regl.prop("buffer"),blend:e.draw_options.blend,primitive:"points"}),this.__draw3DHighlights=this.regl({frag:`
            precision mediump float;
            varying vec3 fragColor;
		
            void main () {
			  float r = length(gl_PointCoord.xy - 0.4) ;
              if (r> 0.4) {
                discard;
              }
			  else{
				if(r>0.3){
					gl_FragColor=vec4(0.1,0.1,0.1,1.0);
				}
				else{
					
						gl_FragColor = vec4(fragColor,1.0);
				}
					
			  }
             
            }
            `,vert:`
            precision mediump float;

            attribute float x_pos;
            attribute float y_pos;
            attribute float z_pos;
            attribute vec3 color;
			
			uniform float time;
    
            uniform mat4 view, projection;
			uniform vec3 eye;
			uniform float point_radius;
			uniform vec3 axis_scales;
		


            varying vec3 fragColor;
		

            void main () {
			
                vec3 position = vec3(-x_pos*axis_scales.x,y_pos*axis_scales.y,-z_pos*axis_scales.z);
                fragColor=color/255.0;
               
				gl_PointSize = point_radius*2.0; //(distance(eye, position.xyz) /30.0);
                gl_Position = projection * view * vec4(2.0 * position, 1.0);
            }
            `,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),z_pos:e.regl.prop("z_pos"),color:e.regl.prop("color")},uniforms:{point_radius:e.regl.prop("point_radius"),view:e.regl.prop("cameraView"),cdistance:e.regl.prop("cameraDistance"),eye:e.regl.prop("cameraEye"),axis_scales:e.regl.prop("axisScales"),projection:(s,o)=>perspective(o.cameraProjection,Math.PI/4,s.viewportWidth/s.viewportHeight,1,1e5)},count:e.regl.prop("count"),blend:e.draw_options.blend,primitive:"points"}),this.__draw3DLines=this.regl({frag:` precision highp float;
                    varying vec3 fragColor;
                    void main () {
                         gl_FragColor = vec4(fragColor,1);
                    }
`,vert:`
                    attribute vec3 position;
                    attribute vec3 color;
                    uniform mat4 view, projection;
					uniform vec3 axis_scales;
    
                    varying vec3 fragColor;
                  
                    
                    void main () {
                     
                        fragColor=color;
                        gl_Position = projection * view * vec4(2.0 * position*axis_scales*vec3(-1.0,1.0,-1.0), 1.0);
                       
                       
                    }`,attributes:{position:e.regl.prop("position"),color:e.regl.prop("color")},uniforms:{view:e.regl.prop("cameraView"),axis_scales:e.regl.prop("axisScales"),projection:(s,o)=>perspective(o.cameraProjection,Math.PI/4,s.viewportWidth/s.viewportHeight,.01,1e5)},primitive:e.regl.prop("primitive"),framebuffer:e.regl.prop("buffer"),count:e.regl.prop("count"),depth:{enable:!1}})}}class WGLChart extends SVGChart{constructor(e,s,o,a){super(e,s,o,a);const d=this.config;d.tooltip||(d.tooltip={show:!1}),d.default_color=d.default_color||"#377eb8";const g=this._getContentDimensions();this.graphDiv=createEl("div",{styles:{position:"absolute",left:g.left+"px",top:g.top+"px",width:g.width+"px",height:g.height+"px"}},this.contentDiv),this.tooltip=createEl("div",{styles:{position:"absolute",zIndex:100,display:"none","background-color":"lightgray"}},this.graphDiv)}onDataHighlighted(e){this.app.setHighlightPoints(e.indexes),this.app.refresh()}afterAppCreation(){const e=this,s=this.config;this.app.addHandler("object_over",function(d,g){s.tooltip.show&&e.showTooltip(d,g)}),this.app.addHandler("object_out",function(d,g){e.tooltip.style.display="none"}),s.default_color=s.default_color||"#377eb8",s.on_filter=s.on_filter==null?"hide":s.on_filter,this.app.setFilterAction(s.on_filter);const o=hexToRGB(s.default_color);let a=()=>o;if(s.color_by){const d={asArray:!0,overideValues:{colorLogScale:this.config.log_color_scale}};this._addTrimmedColor(s.color_by,d),a=this.dataStore.getColorFunction(s.color_by,d),s.color_legend||(s.color_legend={display:!0}),this.setColorLegend()}return this.app.addHandler("object_clicked",d=>{this.dataStore.dataHighlighted([d],this)}),a}setToolTipColumn(e){this.config.tooltip.column=e}showTooltip(e,s){var o=this.graphDiv.getBoundingClientRect();const a=this.dataStore.getRowAsObject(s),d=e.clientX-o.left,g=e.clientY-o.top;this.tooltip.style.display="block",this.tooltip.style.left=d+"px",this.tooltip.style.top=g+"px",this.tooltip.textContent=a[this.config.tooltip.column]}getSetupConfig(){const e=this.config,s=hexToRGB(e.default_color);let o=()=>s;return e.color_by&&(o=this.dataStore.getColorFunction(e.color_by,{asArray:!0})),{localFilter:this.dim.getLocalFilter(),globalFilter:this.dataStore.getFilter(),colorFunc:o}}setSize(e,s){super.setSize(e,s);const o=this._getContentDimensions();this.app.setSize(o.width,o.height),this.graphDiv.style.left=o.left+"px",this.graphDiv.style.top=o.top+"px",this.updateAxis()}onDataFiltered(e){e==="all_removed"&&(this.app.clearBrush(),this.app.setFilter(!1),this.resetButton.style.display="none"),this.app.setHighlightPoints(null),this.app.refresh()}remove(e=!0){this.dim.destroy(e),this.app.remove(),super.remove()}removeFilter(){this.filter!==null&&(this.dim.removeFilter(),this.app.clearBrush(),this.app.setFilter(!1),this.app.refresh())}colorByColumn(e){this.config.color_by=e;const s=this.getColorFunction(e,!0),o=performance.now();this.app.colorPoints(s),console.log("color time:"+(performance.now()-o)),setTimeout(()=>{this.app.refresh()},50)}colorByDefault(){this.legend&&this.legend.remove();const e=hexToRGB(this.config.default_color);this.app.colorPoints(()=>e),setTimeout(()=>{this.app.refresh()},50)}changeBaseDocument(e){this.app.clearBrush(),this.app.__doc__=e,super.changeBaseDocument(e)}getColorOptions(){return{colorby:"all",has_default_color:!0}}pinChart(){this.isPinned=!0,this.pinnedFilter=this.dataStore.getFilter().slice(0),this.app.setGlobalFilter(this.pinnedFilter)}unpinChart(){this.isPinned=!1,this.pinnedFilter=null,this.app.setGlobalFilter(this.dataStore.getFilter()),this.app.refresh()}addToImage(){this.app.refresh();let e=this.app.canvas.toDataURL("image/png");e=e.replace(/^data:image\/png/,"data:application/octet-stream");const s=this._getContentDimensions();this.svg.append("image").attr("xlink:href",e).attr("width",s.width).attr("height",s.height).attr("x",s.left).attr("y",s.top)}removeFromImage(){this.svg.select("image").remove()}getSettings(e){const s=super.getSettings(),o=this.config,a=this.dataStore.getColumnList();return s.splice(2,0,{type:"slider",max:1,min:0,doc:this.__doc__,current_value:o.opacity,label:"Point Opacity",func:d=>{o.opacity=d,this.app.setPointOpacity(d),this.app.refresh()}},{type:"slider",max:10,min:0,doc:this.__doc__,current_value:o.radius,label:"Point Size",func:d=>{o.radius=d,this.app.setPointRadius(d),this.app.refresh(),console.log(d)}}),s.concat([{type:"check",label:"Show Tooltip",current_value:o.tooltip.show,func:d=>{o.tooltip.show=d;let g=o.tooltip.column||a[0].field;this.setToolTipColumn(g)}},{type:"dropdown",label:"Tooltip value",current_value:o.tooltip.column||a[0].field,values:[a,"name","field"],func:d=>{this.setToolTipColumn(d)}},{type:"button",label:"Centre Plot",func:d=>{this.centerGraph(),this.app.refresh()}},{type:"radiobuttons",label:"Action on Filter",choices:[["Hide Points","hide"],["Gray Out Points","grey"]],current_value:o.on_filter,func:d=>{o.on_filter=d,this.app.setFilterAction(d),this.app.refresh()}}])}}class WGL3DScatterPlot extends WGLChart{constructor(e,s,o){o.title||(o.title=e.getColumnName(o.param[0])+" x "+e.getColumnName(o.param[1])+" x "+e.getColumnName(o.param[2])),super(e,s,o,{});const a=this.config,d=a.param;this.dim=this.dataStore.getDimension("range_dimension",d);const g=d.map(rt=>this.dataStore.getColumnRange(rt)),_=Math.max(...g);this.defaultCDistance=_*4,a.brush=a.brush||"default",a.center=a.center||[0,0,0],this.app=new WGL2DI(this.graphDiv,{mode:"3d",brush:a.brush,cameraDistance:this.defaultCDistance,cameraCenter:[-a.center[0]*2,a.center[1]*2,-a.center[2]*2]}),this.app.addHandler("brush_stopped",(rt,it)=>{this.resetButton.style.display="inline",this.app.setFilter(!0),it?this._createPolyFilter(range):this._createFilter(rt)});const j=this.afterAppCreation();let _e=this.dataStore.columnIndex[d[0]],et=this.dataStore.columnIndex[d[1]],tt=this.dataStore.columnIndex[d[2]];this.app.addCircles({x:_e.datatype==="int32"?new Float32Array(_e.data):_e.data,y:et.datatype==="int32"?new Float32Array(et.data):et.data,z:tt.datatype==="int32"?new Float32Array(tt.data):tt.data,localFilter:this.dim.getLocalFilter(),globalFilter:e.getFilter(),colorFunc:j}),a.radius=a.radius||5,a.opacity=a.opacity||.8,this.app.setPointRadius(a.radius),this.app.setPointOpacity(a.opacity),a.axis_scales=a.axis_scales||[1,1,1],this.app.axisScales=a.axis_scales,this.addAxis(),this.centerGraph(a.camera),this.app.refresh()}setAxisScales(e,s){this.config.axis_scales[e]=s,this.app.refresh()}getSettings(){let e=super.getSettings({pointMax:30,pointMin:1});const s=this.config;return e=e.concat([{type:"slider",max:3,min:.5,doc:this.__doc__,current_value:s.axis_scales[0],label:"X Axis Scale",func:o=>{this.setAxisScales(0,o)}},{type:"slider",max:3,min:.5,doc:this.__doc__,current_value:s.axis_scales[1],label:"Y Axis Scale",func:o=>{this.setAxisScales(1,o)}},{type:"slider",max:3,min:.5,doc:this.__doc__,current_value:s.axis_scales[2],label:"Z Axis Scale",func:o=>{this.setAxisScales(2,o)}}]),e}centerGraph(e){e?this.app.setCamera(e.distance,e.theta,e.phi):this.app.setCamera(this.defaultCDistance,-1.038,.261)}getConfig(){const e=super.getConfig();return e.camera=this.app.getCameraSettings(),e}_createFilter(e){this.dim.filter("filterOnIndex",[],e)}onDataAdded(e){const s=this.config.param,o=this.getSetupConfig();o.x=this.dataStore.getRawColumn(s[0]),o.y=this.dataStore.getRawColumn(s[1]),o.z=this.dataStore.getRawColumn(s[2]),this.app.updateSize(e,o),super.onDataAdded(e)}addAxis(){for(let e=0;e<3;e++){let s=this.dataStore.getMinMaxForColumn(this.config.param[e]);const o=this.config.center.map((g,_)=>g);o[e]=s[0];const a=this.config.center.map((g,_)=>g);a[e]=s[1];const d=[0,0,0];d[e]=255,this.app.addLine(o,a,d)}}}BaseChart.types.wgl_3d_scatter_plot={name:"3D Scatter Plot",class:WGL3DScatterPlot,params:[{type:"number",name:"X axis"},{type:"number",name:"Y axis"},{type:"number",name:"Z axis"}]};class OffsetDialog extends BaseDialog{constructor(e){super({title:"Alter Position",width:300,doc:e.__doc__},e)}init(e){this.plot=e,this.ds=this.plot.dataStore,createEl("div",{text:"Offset"},this.dialog),this.bdiv=createEl("div",{styles:{display:"flex",justifyContent:"center",alignItems:"center",position:"relative",height:"60px"}},this.dialog);for(let g of[["top","up"],["bottom","down"],["right","right"],["left","left"]])this._addPButton(g);createEl("div",{text:"Rotation"},this.dialog),this.rDiv=createEl("div",{styles:{height:"30px",position:"relative"}},this.dialog);for(let g of["left","right"])this._addRButton(g);const s=createEl("div",{},this.dialog),o=this.ds.columnIndex[this.ds.offsets.groups].name;createEl("div",{text:o},s),this.groupSelect=createEl("select",{},s),createEl("button",{classes:["ciview-button-sm"],text:"Reset"},s).addEventListener("click",g=>{this.ds.resetColumnOffsets(this.filter,this.groupSelect.value,!0),this._showOffsets(this.groupSelect.value)});const d=this.ds.columnIndex[this.ds.offsets.groups].values;for(let g of d)createEl("option",{text:g,value:g},this.groupSelect);this.filter=this.plot.config.background_filter?this.plot.config.background_filter.category:null,this.groupSelect.addEventListener("change",()=>{this._showOffsets(this.groupSelect.value)}),this._addOffsetLabels(),this._showOffsets(d[0])}_alterOffset(e){const s=this.plot.dataStore;let o=0,a=0;const d=parseFloat(this.offsetAm.value);if(isNaN(d))return;o+=e==="right"?d:0,o-=e==="left"?d:0,a+=e==="up"?d:0,a-=e==="down"?d:0;const g=this.groupSelect.value;s.setColumnOffset({group:g,offsets:[o,a],filter:this.filter},!0),this._showOffsets(g)}_addOffsetLabels(){const e=createEl("div",{styles:{position:"absolute",top:"20px",left:"20px",display:"flex",justifyContent:"center",gap:"5px"}},this.bdiv);this.xoffset=createEl("span",{},e),this.yoffset=createEl("span",{},e),createEl("span",{text:"step:"},e),this.offsetAm=createEl("input",{styles:{width:"30px"},value:1},e);const s=createEl("div",{styles:{position:"absolute",top:"0px",justifyContent:"center",left:"25px",display:"flex",gap:"5px"}},this.rDiv);this.angle=createEl("span",{},s),createEl("span",{text:"step:"},s),this.offsetAn=createEl("input",{styles:{width:"30px"},value:1},s)}_showOffsets(e){let s=[0,0],o=0;const a=this.ds.offsets.values[this.filter||"all"];a&&a[e]&&(s=a[e].offsets,o=a[e].rotation),this.xoffset.textContent="x:"+s[0].toFixed(1),this.yoffset.textContent="y:"+s[1].toFixed(1),this.angle.textContent="angle:"+o.toFixed(1)}_addPButton(e){const s={position:"absolute",textAlign:"center",cursor:"pointer"};s[e[0]]="0px",createEl("i",{classes:["fas",`fa-arrow-${e[1]}`],styles:s},this.bdiv).addEventListener("click",()=>{this._alterOffset(e[1])})}_addRButton(e){const s={position:"absolute",textAlign:"center"};s[e]="5px",createEl("i",{classes:["fas",`fa-angle-double-${e}`],styles:s,cursor:"pointer"},this.rDiv).addEventListener("click",a=>{const d=parseFloat(this.offsetAn.value);if(isNaN(d))return;const g=e==="left"?-d:d;this.plot.dataStore.setColumnOffset({group:this.groupSelect.value,rotation:g,filter:this.filter},!0),this._showOffsets(this.groupSelect.value)})}}class WGLScatterPlot extends WGLChart{constructor(e,s,o){const a=e.getColumnName(o.param[0]),d=e.getColumnName(o.param[1]);o.axis||(o.axis={x:{size:30,label:a,textsize:13},y:{size:45,label:d,textsize:13}}),o.title||(o.title=a+" x "+d),super(e,s,o,{x:{},y:{}}),this.x=this.config.param[0],this.y=this.config.param[1],this.dim=this.getDimension();const g=o.background_filter;g&&this.dim.setBackgroundFilter(g.column,g.category),this.minMaxX=this.dataStore.getMinMaxForColumn(this.x),this.minMaxY=this.dataStore.getMinMaxForColumn(this.y),this.type="wgl_scatter_plot";let _=this;const j=this.config;j.brush=j.brush||"poly";let _e={brush:j.brush};this.app=new WGL2DI(this.graphDiv,_e),this.app.addHandler("zoom_stopped",it=>this.handlePanZoom(it)),this.app.addHandler("panning_stopped",it=>this.handlePanZoom(it)),this.centerGraph();const et=this.afterAppCreation();this.app.setBackGroundColor(j.background_color),this.app.addHandler("brush_stopped",function(it,ot){_.resetButton.style.display="inline",_.app.setFilter(!0),ot?_._createPolyFilter(it):_._createFilter(it)}),j.background_image&&(j.image_opacity=j.image_opacity==null?1:j.image_opacity,this.addBackgroundImage(j.background_image));let tt=this.dataStore.columnIndex[this.x],rt=this.dataStore.columnIndex[this.y];this.app.addCircles({x:tt.datatype==="int32"?new Float32Array(tt.data):tt.data,y:rt.datatype==="int32"?new Float32Array(rt.data):rt.data,localFilter:this.dim.getLocalFilter(),globalFilter:this.dataStore.getFilter(),colorFunc:et}),this.defaultRadius=this._calculateRadius(),j.radius=j.radius||2,j.opacity=j.opacity==null?.8:j.opacity,this.app.setPointRadius(this.config.radius),this.app.setPointOpacity(this.config.opacity),this.onDataFiltered()}getDimension(){return this.dataStore.getDimension("range_dimension")}handlePanZoom(e){if(e.imageMoved){const s=e.imageMoved,o=this.config,a=o.background_image.name,d=o.image_choices.find(g=>g[0]===a);s.position[1]=-(s.position[1]+s.height),o.background_image.height=s.height,o.background_image.width=s.width,o.background_image.position=s.position,d[2]=s.width,d[3]=s.height,d[4]=s.position[0],d[5]=s.position[1]}else this._updateScale(e),this.updateAxis()}onDataAdded(e){const s=this.getSetupConfig();s.x=this.dataStore.getRawColumn(this.x),s.y=this.dataStore.getRawColumn(this.y),this.app.updateSize(e,s),super.onDataAdded(e)}addBackgroundImage(e,s=!1){const o=new Image,a=this.config;a.image_opacity=a.image_opacity||1,o.src=e.url,o.onload=()=>{s?this.app.changeImage(o,e,0):(this.app.addImage(o,e),this.app.changeImageOpacity(0,a.image_opacity)),this.app.refresh()}}linkToOtherChart(e){this.app.addHandler("pan_or_zoom",(s,o,a)=>{e.app.offset=[s[0],s[1]],e.app.x_scale=o,e.app.y_scale=a,e.app.refresh(),e._updateScale(this.app.getRange()),e.updateAxis()},this.config.id)}highlightDataItem(e){this.app.highlightPoint(e)}getFilter(){if(!this.range||this.range===!0)return null;const e={};return e[this.config.param[0]]=[this.range.x_min,this.range.x_max],e[this.config.param[1]]=[this.range.y_min,this.range.y_max],e}_updateScale(e){this.x_scale.domain([e.x_range[0],e.x_range[1]]),this.y_scale.domain([-e.y_range[0],-e.y_range[1]])}_calculateRadius(){this.width&&this.width;let e=this.config.max_x||this.config.max_x==0?this.config.max_x:this.minMaxX[1],s=this.config.min_x||this.config.min_x==0?this.config.min_x:this.minMaxX[0];this.config.axis.x_log_scale&&(e=this._getLogValue(e),s=this._getLogValue(s));let o=e-s;return Math.pow(o,1.5)/(Math.pow(this.dataStore.size,.8)+o)*5}_createFilter(e){if(this.range=e,e==null)this.dim.removeFilter();else{let s=e.y_max,o=e.y_min,a=e.x_max,d=e.x_min;this.config.axis.y_log_scale&&(s=this._getInverseLogValue(s),o=this._getInverseLogValue(o)),this.config.axis.x_log_scale&&(a=this._getInverseLogValue(a),d=this._getInverseLogValue(d)),this.filter=[[d,a],[o,s]],this.dim.filter("filterSquare",this.config.param,{range1:this.filter[0],range2:this.filter[1]})}}_createPolyFilter(e){this.range=!0;for(let s of e)s[1]=-s[1],this.config.axis.x_log_scale&&(s[0]=this._getInverseLogValue(s[0])),this.config.axis.y_log_scale&&(s[1]=this._getInverseLogValue(s[1]));this.filter=e,this.dim.filter("filterPoly",this.config.param,e)}centerGraph(){const e=this.config,s=e.roi||{};let o=s.max_x||this.minMaxX[1],a=s.max_y||this.minMaxY[1],d=s.min_x||this.minMaxX[0],g=s.min_y||this.minMaxY[0];if(e.center_using_quantiles){const rt=this.dataStore.columnIndex[e.param[0]].quantiles,it=this.dataStore.columnIndex[e.param[1]].quantiles;rt[e.center_using_quantiles],it[e.center_using_quantiles]}this.config.axis.y_log_scale&&(a=this._getLogValue(a),g=this._getLogValue(g)),this.config.axis.x_log_scale&&(o=this._getLogValue(o),d=this._getLogValue(d));let _=(o-d)/20,j=(a-g)/20,_e=o-d+2*_,et=a-g+2*j;const tt=this._getContentDimensions();this.app.x_scale=tt.width/_e,this.app.y_scale=tt.height/et,this.app.pointScale=(this.app.x_scale+this.app.y_scale)/2,this.app.offset[0]=-(d-_),this.app.offset[1]=a+j,this._updateScale(this.app.getRange()),this.updateAxis()}getContextMenu(){var a;const e=super.getContextMenu(),s=this.config,o=this.dataStore;if(o.offsets){const d=o.offsets,g=o.getColumnName(d.groups);d.param[0]===s.param[0]&&d.param[1]===s.param[1]&&(!d.background_filter||d.background_filter===((a=s==null?void 0:s.background_filter)==null?void 0:a.column))&&e.push({text:`Adjust ${g} position`,icon:"fas fa-arrows-alt",func:()=>{new OffsetDialog(this)}})}return e}_addSliderToSettings(e,s,o){e.splice(1,0,{type:"slider",current_value:s.opacity,min:0,max:1,func:a=>{s.opacity=a,this.app.changeImageOpacity(o,a),this.app.refresh()}})}getConfig(){const e=super.getConfig();return e.offsets&&(e.offsets.offsets=this.app.offsets.values.offsets),e}getSettings(){const e=super.getSettings({pointMax:30,pointMin:0}),s=this.config;if(s.image_choices){const o=s.image_choices.slice(0);o.unshift(["None","__none__"]);let a="__none__";s.background_image&&(a=s.background_image.url),e.splice(1,0,{type:"dropdown",current_value:a,values:[o,0,1],label:"Change Image",func:d=>{if(d==="__none__"){delete s.background_image,this.app.removeImages(),this.app.refresh();return}let g=!0;s.background_image||(s.background_image={},g=!1),s.background_image.url=d;let _=s.title.split("-")[0];const j=s.image_choices.find(_e=>_e[1]===d);s.background_image.name=j[0],j[2]&&(s.background_image.width=j[2],s.background_image.height=j[3],s.background_image.position=[j[4],j[5]]),this.setTitle(_+"-"+j[0]),this.addBackgroundImage(s.background_image,g)}})}return s.background_image&&e.splice(2,0,{label:"Image Opacity",type:"slider",current_value:s.image_opacity,max:1,min:0,func:o=>{s.image_opacity=o,this.app.changeImageOpacity(0,o),this.app.refresh()}}),e.push({type:"radiobuttons",label:"Background Color",choices:[["none","none"],["white","white"],["light gray","lightgray"],["gray","gray"],["black","black"]],current_value:s.background_color||"none",func:o=>{o==="none"?delete s.background_color:s.background_color=o,this.app.setBackGroundColor(s.background_color)}}),e.concat([{type:"radiobuttons",label:"Brush Type",choices:[["Free Draw","poly"],["Rectangle","default"]],current_value:s.brush,func:o=>{this.app.clearBrush(),this.app.config.brush=o,s.brush=o}}])}}BaseChart.types.wgl_scatter_plot={name:"2D Scatter Plot",class:WGLScatterPlot,params:[{type:"number",name:"X axis"},{type:"number",name:"Y axis"}]};const pi$4=Math.PI,tau$3=2*pi$4,epsilon$2=1e-6,tauEpsilon$1=tau$3-epsilon$2;function Path$1(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path$1(){return new Path$1}Path$1.prototype=path$1.prototype={constructor:Path$1,moveTo:function(i,e){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(i,e){this._+="L"+(this._x1=+i)+","+(this._y1=+e)},quadraticCurveTo:function(i,e,s,o){this._+="Q"+ +i+","+ +e+","+(this._x1=+s)+","+(this._y1=+o)},bezierCurveTo:function(i,e,s,o,a,d){this._+="C"+ +i+","+ +e+","+ +s+","+ +o+","+(this._x1=+a)+","+(this._y1=+d)},arcTo:function(i,e,s,o,a){i=+i,e=+e,s=+s,o=+o,a=+a;var d=this._x1,g=this._y1,_=s-i,j=o-e,_e=d-i,et=g-e,tt=_e*_e+et*et;if(a<0)throw new Error("negative radius: "+a);if(this._x1===null)this._+="M"+(this._x1=i)+","+(this._y1=e);else if(tt>epsilon$2)if(!(Math.abs(et*_-j*_e)>epsilon$2)||!a)this._+="L"+(this._x1=i)+","+(this._y1=e);else{var rt=s-d,it=o-g,ot=_*_+j*j,ct=rt*rt+it*it,ft=Math.sqrt(ot),dt=Math.sqrt(tt),pt=a*Math.tan((pi$4-Math.acos((ot+tt-ct)/(2*ft*dt)))/2),gt=pt/dt,Ct=pt/ft;Math.abs(gt-1)>epsilon$2&&(this._+="L"+(i+gt*_e)+","+(e+gt*et)),this._+="A"+a+","+a+",0,0,"+ +(et*rt>_e*it)+","+(this._x1=i+Ct*_)+","+(this._y1=e+Ct*j)}},arc:function(i,e,s,o,a,d){i=+i,e=+e,s=+s,d=!!d;var g=s*Math.cos(o),_=s*Math.sin(o),j=i+g,_e=e+_,et=1^d,tt=d?o-a:a-o;if(s<0)throw new Error("negative radius: "+s);this._x1===null?this._+="M"+j+","+_e:(Math.abs(this._x1-j)>epsilon$2||Math.abs(this._y1-_e)>epsilon$2)&&(this._+="L"+j+","+_e),s&&(tt<0&&(tt=tt%tau$3+tau$3),tt>tauEpsilon$1?this._+="A"+s+","+s+",0,1,"+et+","+(i-g)+","+(e-_)+"A"+s+","+s+",0,1,"+et+","+(this._x1=j)+","+(this._y1=_e):tt>epsilon$2&&(this._+="A"+s+","+s+",0,"+ +(tt>=pi$4)+","+et+","+(this._x1=i+s*Math.cos(a))+","+(this._y1=e+s*Math.sin(a))))},rect:function(i,e,s,o){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)+"h"+ +s+"v"+ +o+"h"+-s+"Z"},toString:function(){return this._}};function constant$2(i){return function(){return i}}const abs$1=Math.abs,atan2=Math.atan2,cos=Math.cos,max=Math.max,min=Math.min,sin=Math.sin,sqrt$1=Math.sqrt,epsilon$1=1e-12,pi$3=Math.PI,halfPi=pi$3/2,tau$2=2*pi$3;function acos(i){return i>1?0:i<-1?pi$3:Math.acos(i)}function asin(i){return i>=1?halfPi:i<=-1?-halfPi:Math.asin(i)}function arcInnerRadius(i){return i.innerRadius}function arcOuterRadius(i){return i.outerRadius}function arcStartAngle(i){return i.startAngle}function arcEndAngle(i){return i.endAngle}function arcPadAngle(i){return i&&i.padAngle}function intersect(i,e,s,o,a,d,g,_){var j=s-i,_e=o-e,et=g-a,tt=_-d,rt=tt*j-et*_e;if(!(rt*rt<epsilon$1))return rt=(et*(e-d)-tt*(i-a))/rt,[i+rt*j,e+rt*_e]}function cornerTangents(i,e,s,o,a,d,g){var _=i-s,j=e-o,_e=(g?d:-d)/sqrt$1(_*_+j*j),et=_e*j,tt=-_e*_,rt=i+et,it=e+tt,ot=s+et,ct=o+tt,ft=(rt+ot)/2,dt=(it+ct)/2,pt=ot-rt,gt=ct-it,Ct=pt*pt+gt*gt,xt=a-d,at=rt*ct-ot*it,Bt=(gt<0?-1:1)*sqrt$1(max(0,xt*xt*Ct-at*at)),Ht=(at*gt-pt*Bt)/Ct,sr=(-at*pt-gt*Bt)/Ct,mr=(at*gt+pt*Bt)/Ct,hr=(-at*pt+gt*Bt)/Ct,Er=Ht-ft,Lr=sr-dt,sn=mr-ft,vr=hr-dt;return Er*Er+Lr*Lr>sn*sn+vr*vr&&(Ht=mr,sr=hr),{cx:Ht,cy:sr,x01:-et,y01:-tt,x11:Ht*(a/xt-1),y11:sr*(a/xt-1)}}function arc(){var i=arcInnerRadius,e=arcOuterRadius,s=constant$2(0),o=null,a=arcStartAngle,d=arcEndAngle,g=arcPadAngle,_=null;function j(){var _e,et,tt=+i.apply(this,arguments),rt=+e.apply(this,arguments),it=a.apply(this,arguments)-halfPi,ot=d.apply(this,arguments)-halfPi,ct=abs$1(ot-it),ft=ot>it;if(_||(_=_e=path$1()),rt<tt&&(et=rt,rt=tt,tt=et),!(rt>epsilon$1))_.moveTo(0,0);else if(ct>tau$2-epsilon$1)_.moveTo(rt*cos(it),rt*sin(it)),_.arc(0,0,rt,it,ot,!ft),tt>epsilon$1&&(_.moveTo(tt*cos(ot),tt*sin(ot)),_.arc(0,0,tt,ot,it,ft));else{var dt=it,pt=ot,gt=it,Ct=ot,xt=ct,at=ct,Bt=g.apply(this,arguments)/2,Ht=Bt>epsilon$1&&(o?+o.apply(this,arguments):sqrt$1(tt*tt+rt*rt)),sr=min(abs$1(rt-tt)/2,+s.apply(this,arguments)),mr=sr,hr=sr,Er,Lr;if(Ht>epsilon$1){var sn=asin(Ht/tt*sin(Bt)),vr=asin(Ht/rt*sin(Bt));(xt-=sn*2)>epsilon$1?(sn*=ft?1:-1,gt+=sn,Ct-=sn):(xt=0,gt=Ct=(it+ot)/2),(at-=vr*2)>epsilon$1?(vr*=ft?1:-1,dt+=vr,pt-=vr):(at=0,dt=pt=(it+ot)/2)}var Zr=rt*cos(dt),Hr=rt*sin(dt),cr=tt*cos(Ct),lr=tt*sin(Ct);if(sr>epsilon$1){var Fr=rt*cos(pt),an=rt*sin(pt),kn=tt*cos(gt),ms=tt*sin(gt),Zn;if(ct<pi$3&&(Zn=intersect(Zr,Hr,kn,ms,Fr,an,cr,lr))){var As=Zr-Zn[0],Rs=Hr-Zn[1],Gn=Fr-Zn[0],dn=an-Zn[1],xr=1/sin(acos((As*Gn+Rs*dn)/(sqrt$1(As*As+Rs*Rs)*sqrt$1(Gn*Gn+dn*dn)))/2),Yr=sqrt$1(Zn[0]*Zn[0]+Zn[1]*Zn[1]);mr=min(sr,(tt-Yr)/(xr-1)),hr=min(sr,(rt-Yr)/(xr+1))}}at>epsilon$1?hr>epsilon$1?(Er=cornerTangents(kn,ms,Zr,Hr,rt,hr,ft),Lr=cornerTangents(Fr,an,cr,lr,rt,hr,ft),_.moveTo(Er.cx+Er.x01,Er.cy+Er.y01),hr<sr?_.arc(Er.cx,Er.cy,hr,atan2(Er.y01,Er.x01),atan2(Lr.y01,Lr.x01),!ft):(_.arc(Er.cx,Er.cy,hr,atan2(Er.y01,Er.x01),atan2(Er.y11,Er.x11),!ft),_.arc(0,0,rt,atan2(Er.cy+Er.y11,Er.cx+Er.x11),atan2(Lr.cy+Lr.y11,Lr.cx+Lr.x11),!ft),_.arc(Lr.cx,Lr.cy,hr,atan2(Lr.y11,Lr.x11),atan2(Lr.y01,Lr.x01),!ft))):(_.moveTo(Zr,Hr),_.arc(0,0,rt,dt,pt,!ft)):_.moveTo(Zr,Hr),!(tt>epsilon$1)||!(xt>epsilon$1)?_.lineTo(cr,lr):mr>epsilon$1?(Er=cornerTangents(cr,lr,Fr,an,tt,-mr,ft),Lr=cornerTangents(Zr,Hr,kn,ms,tt,-mr,ft),_.lineTo(Er.cx+Er.x01,Er.cy+Er.y01),mr<sr?_.arc(Er.cx,Er.cy,mr,atan2(Er.y01,Er.x01),atan2(Lr.y01,Lr.x01),!ft):(_.arc(Er.cx,Er.cy,mr,atan2(Er.y01,Er.x01),atan2(Er.y11,Er.x11),!ft),_.arc(0,0,tt,atan2(Er.cy+Er.y11,Er.cx+Er.x11),atan2(Lr.cy+Lr.y11,Lr.cx+Lr.x11),ft),_.arc(Lr.cx,Lr.cy,mr,atan2(Lr.y11,Lr.x11),atan2(Lr.y01,Lr.x01),!ft))):_.arc(0,0,tt,Ct,gt,ft)}if(_.closePath(),_e)return _=null,_e+""||null}return j.centroid=function(){var _e=(+i.apply(this,arguments)+ +e.apply(this,arguments))/2,et=(+a.apply(this,arguments)+ +d.apply(this,arguments))/2-pi$3/2;return[cos(et)*_e,sin(et)*_e]},j.innerRadius=function(_e){return arguments.length?(i=typeof _e=="function"?_e:constant$2(+_e),j):i},j.outerRadius=function(_e){return arguments.length?(e=typeof _e=="function"?_e:constant$2(+_e),j):e},j.cornerRadius=function(_e){return arguments.length?(s=typeof _e=="function"?_e:constant$2(+_e),j):s},j.padRadius=function(_e){return arguments.length?(o=_e==null?null:typeof _e=="function"?_e:constant$2(+_e),j):o},j.startAngle=function(_e){return arguments.length?(a=typeof _e=="function"?_e:constant$2(+_e),j):a},j.endAngle=function(_e){return arguments.length?(d=typeof _e=="function"?_e:constant$2(+_e),j):d},j.padAngle=function(_e){return arguments.length?(g=typeof _e=="function"?_e:constant$2(+_e),j):g},j.context=function(_e){return arguments.length?(_=_e??null,j):_},j}function array(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Linear(i){this._context=i}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,e){switch(i=+i,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,e):this._context.moveTo(i,e);break;case 1:this._point=2;default:this._context.lineTo(i,e);break}}};function curveLinear(i){return new Linear(i)}function x$2(i){return i[0]}function y$2(i){return i[1]}function line(i,e){var s=constant$2(!0),o=null,a=curveLinear,d=null;i=typeof i=="function"?i:i===void 0?x$2:constant$2(i),e=typeof e=="function"?e:e===void 0?y$2:constant$2(e);function g(_){var j,_e=(_=array(_)).length,et,tt=!1,rt;for(o==null&&(d=a(rt=path$1())),j=0;j<=_e;++j)!(j<_e&&s(et=_[j],j,_))===tt&&((tt=!tt)?d.lineStart():d.lineEnd()),tt&&d.point(+i(et,j,_),+e(et,j,_));if(rt)return d=null,rt+""||null}return g.x=function(_){return arguments.length?(i=typeof _=="function"?_:constant$2(+_),g):i},g.y=function(_){return arguments.length?(e=typeof _=="function"?_:constant$2(+_),g):e},g.defined=function(_){return arguments.length?(s=typeof _=="function"?_:constant$2(!!_),g):s},g.curve=function(_){return arguments.length?(a=_,o!=null&&(d=a(o)),g):a},g.context=function(_){return arguments.length?(_==null?o=d=null:d=a(o=_),g):o},g}function area(i,e,s){var o=null,a=constant$2(!0),d=null,g=curveLinear,_=null;i=typeof i=="function"?i:i===void 0?x$2:constant$2(+i),e=typeof e=="function"?e:constant$2(e===void 0?0:+e),s=typeof s=="function"?s:s===void 0?y$2:constant$2(+s);function j(et){var tt,rt,it,ot=(et=array(et)).length,ct,ft=!1,dt,pt=new Array(ot),gt=new Array(ot);for(d==null&&(_=g(dt=path$1())),tt=0;tt<=ot;++tt){if(!(tt<ot&&a(ct=et[tt],tt,et))===ft)if(ft=!ft)rt=tt,_.areaStart(),_.lineStart();else{for(_.lineEnd(),_.lineStart(),it=tt-1;it>=rt;--it)_.point(pt[it],gt[it]);_.lineEnd(),_.areaEnd()}ft&&(pt[tt]=+i(ct,tt,et),gt[tt]=+e(ct,tt,et),_.point(o?+o(ct,tt,et):pt[tt],s?+s(ct,tt,et):gt[tt]))}if(dt)return _=null,dt+""||null}function _e(){return line().defined(a).curve(g).context(d)}return j.x=function(et){return arguments.length?(i=typeof et=="function"?et:constant$2(+et),o=null,j):i},j.x0=function(et){return arguments.length?(i=typeof et=="function"?et:constant$2(+et),j):i},j.x1=function(et){return arguments.length?(o=et==null?null:typeof et=="function"?et:constant$2(+et),j):o},j.y=function(et){return arguments.length?(e=typeof et=="function"?et:constant$2(+et),s=null,j):e},j.y0=function(et){return arguments.length?(e=typeof et=="function"?et:constant$2(+et),j):e},j.y1=function(et){return arguments.length?(s=et==null?null:typeof et=="function"?et:constant$2(+et),j):s},j.lineX0=j.lineY0=function(){return _e().x(i).y(e)},j.lineY1=function(){return _e().x(i).y(s)},j.lineX1=function(){return _e().x(o).y(e)},j.defined=function(et){return arguments.length?(a=typeof et=="function"?et:constant$2(!!et),j):a},j.curve=function(et){return arguments.length?(g=et,d!=null&&(_=g(d)),j):g},j.context=function(et){return arguments.length?(et==null?d=_=null:_=g(d=et),j):d},j}function descending(i,e){return e<i?-1:e>i?1:e>=i?0:NaN}function identity$1(i){return i}function pie(){var i=identity$1,e=descending,s=null,o=constant$2(0),a=constant$2(tau$2),d=constant$2(0);function g(_){var j,_e=(_=array(_)).length,et,tt,rt=0,it=new Array(_e),ot=new Array(_e),ct=+o.apply(this,arguments),ft=Math.min(tau$2,Math.max(-tau$2,a.apply(this,arguments)-ct)),dt,pt=Math.min(Math.abs(ft)/_e,d.apply(this,arguments)),gt=pt*(ft<0?-1:1),Ct;for(j=0;j<_e;++j)(Ct=ot[it[j]=j]=+i(_[j],j,_))>0&&(rt+=Ct);for(e!=null?it.sort(function(xt,at){return e(ot[xt],ot[at])}):s!=null&&it.sort(function(xt,at){return s(_[xt],_[at])}),j=0,tt=rt?(ft-_e*gt)/rt:0;j<_e;++j,ct=dt)et=it[j],Ct=ot[et],dt=ct+(Ct>0?Ct*tt:0)+gt,ot[et]={data:_[et],index:j,value:Ct,startAngle:ct,endAngle:dt,padAngle:pt};return ot}return g.value=function(_){return arguments.length?(i=typeof _=="function"?_:constant$2(+_),g):i},g.sortValues=function(_){return arguments.length?(e=_,s=null,g):e},g.sort=function(_){return arguments.length?(s=_,e=null,g):s},g.startAngle=function(_){return arguments.length?(o=typeof _=="function"?_:constant$2(+_),g):o},g.endAngle=function(_){return arguments.length?(a=typeof _=="function"?_:constant$2(+_),g):a},g.padAngle=function(_){return arguments.length?(d=typeof _=="function"?_:constant$2(+_),g):d},g}function point(i,e,s){i._context.bezierCurveTo((2*i._x0+i._x1)/3,(2*i._y0+i._y1)/3,(i._x0+2*i._x1)/3,(i._y0+2*i._y1)/3,(i._x0+4*i._x1+e)/6,(i._y0+4*i._y1+s)/6)}function Basis(i){this._context=i}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,e){switch(i=+i,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,e):this._context.moveTo(i,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point(this,i,e);break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=e}};function curveBasis(i){return new Basis(i)}class RingChart extends CategoryChart{constructor(e,s,o){super(e,s,o,{x:{}}),this.config.type="ring_chart",this.pie=pie().sort(null).value(a=>a[0]),this.arc=arc(),this.onDataFiltered(null)}drawChart(e=1e3){select(this.contentDiv).transition().duration(e).ease(linear);const s=this._getContentDimensions(),o=Math.min(s.width,s.height)/2,a=s.left+s.width/2,d=s.top+s.height/2;this.graph_area.attr("transform",`translate(${a},${d})`),this.arc.innerRadius(o*.5).outerRadius(o*.9);const g=Math.floor(o/8),_=this.dataStore.getColumnValues(this.config.param),j=this.dataStore.getColumnColors(this.config.param),_e=this.pie(this.rowData.filter(tt=>tt[0]!==0)),et=this;this.graph_area.selectAll(".pie-arc").data(_e,(tt,rt)=>{tt.data[1]}).join("path").on("click",(tt,rt)=>{et.filterCategories(_[rt.data[1]],tt.shiftKey)}).style("fill",(tt,rt)=>et.filter.length>0&&et.filter.indexOf(_[tt.data[1]])===-1?"lightgray":j[tt.data[1]]).attr("class","pie-arc").attr("stroke","white").attr("d",this.arc).style("stroke-width","2px"),this.graph_area.selectAll(".pie-text").data(_e,(tt,rt)=>{tt.data[1]}).join("text").on("click",(tt,rt)=>{et.filterCategories(_[rt.data[1]],tt.shiftKey)}).attr("class","pie-text").text((tt,rt)=>tt.endAngle-tt.startAngle>.4?_[tt.data[1]]:"").attr("x",tt=>et.arc.centroid(tt)[0]).attr("font-size",g+"px").attr("y",tt=>et.arc.centroid(tt)[1]).attr("text-anchor","middle").attr("dominant-baseline","central")}}BaseChart.types.ring_chart={class:RingChart,name:"Pie Chart",params:[{type:"text",name:"Category"}]};const scriptRel="modulepreload",assetsURL=function(i,e){return new URL(i,e).href},seen={},__vitePreload=function i(e,s,o){if(!s||s.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(s.map(d=>{if(d=assetsURL(d,o),d in seen)return;seen[d]=!0;const g=d.endsWith(".css"),_=g?'[rel="stylesheet"]':"";if(!!o)for(let et=a.length-1;et>=0;et--){const tt=a[et];if(tt.href===d&&(!g||tt.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${_}`))return;const _e=document.createElement("link");if(_e.rel=g?"stylesheet":scriptRel,g||(_e.as="script",_e.crossOrigin=""),_e.href=d,document.head.appendChild(_e),g)return new Promise((et,tt)=>{_e.addEventListener("load",et),_e.addEventListener("error",()=>tt(new Error(`Unable to preload CSS for ${d}`)))})})).then(()=>e())};class TextBoxChart extends BaseChart{constructor(e,s,o){super(e,s,o);const a=this.config;a.text=a.text||"",this.para=createEl("div",{styles:{padding:"5px"}},this.contentDiv),__vitePreload(()=>import("./MarkdownText-d15485df.js"),[],import.meta.url).then(({default:d})=>{this.render=d,this.para.innerHTML=this.render(a.text)})}getSettings(){const e=super.getSettings(),s=this.config;return e.push({label:"Text",type:"textbox",current_value:s.text,func:o=>{s.text=o,this.para.innerHTML=this.render(o)}}),e}}BaseChart.types.text_box_chart={class:TextBoxChart,name:"Text Box",params:[],extra_controls:()=>[{type:"textbox",name:"text"}],init:(i,e,s)=>{i.text=s.text}};const distances={euclidean:function(i,e){for(var s=0,o=0;o<i.length;o++)s+=Math.pow(isNaN(e[o])?0:e[o]-i[o],2);return Math.sqrt(s)},manhattan:function(i,e){for(var s=0,o=0;o<i.length;o++)s+=Math.abs(e[o]-i[o]);return s},max:function(i,e){for(var s=0,o=0;o<i.length;o++)s=Math.max(s,Math.abs(e[o]-i[o]));return s}};class HierarchicalClustering{constructor(e,s,o){this.distance=distances[e],this.distance||(this.distance=distances.euclidean),this.linkage=s||"average",this.threshold=o??1/0}cluster(e,s,o){this.clusters=[],this.dists=[],this.mins=[],this.index=[];for(var j=0;j<e.length;j++){var a={value:e[j],key:j,index:j,size:1};this.clusters[j]=a,this.index[j]=a,this.dists[j]=[],this.mins[j]=0}for(var j=0;j<this.clusters.length;j++)for(var d=0;d<=j;d++){var g=j==d?1/0:this.distance(this.clusters[j].value,this.clusters[d].value);this.dists[j][d]=g,this.dists[d][j]=g,g<this.dists[j][this.mins[j]]&&(this.mins[j]=d)}for(var _=this.mergeClosest(),j=0;_;)o&&j++%s==0&&o(this.clusters),_=this.mergeClosest();return this.clusters.forEach(function(_e){delete _e.key,delete _e.index}),this.node_order=[],this.order=0,this.orderClusters(this.clusters[0]),this.clusters}mergeClosest(){for(var e=0,s=1/0,o=0;o<this.clusters.length;o++){var a=this.clusters[o].key,d=this.dists[a][this.mins[a]];d<s&&(e=a,s=d)}if(s>=this.threshold)return!1;var g=this.index[e],_=this.index[this.mins[e]],j={children:[g,_],key:g.key,size:g.size+_.size};this.clusters[g.index]=j,this.clusters.splice(_.index,1),this.index[g.key]=j;for(var o=0;o<this.clusters.length;o++){var _e=this.clusters[o],d;g.key==_e.key?d=1/0:this.linkage=="single"?(d=this.dists[g.key][_e.key],this.dists[g.key][_e.key]>this.dists[_.key][_e.key]&&(d=this.dists[_.key][_e.key])):this.linkage=="complete"?(d=this.dists[g.key][_e.key],this.dists[g.key][_e.key]<this.dists[_.key][_e.key]&&(d=this.dists[_.key][_e.key])):this.linkage=="average"?d=(this.dists[g.key][_e.key]*g.size+this.dists[_.key][_e.key]*_.size)/(g.size+_.size):d=this.distance(_e.value,g.value),this.dists[g.key][_e.key]=this.dists[_e.key][g.key]=d}for(var o=0;o<this.clusters.length;o++){var et=this.clusters[o].key;if(this.mins[et]==g.key||this.mins[et]==_.key){for(var s=et,tt=0;tt<this.clusters.length;tt++){var rt=this.clusters[tt].key;this.dists[et][rt]<this.dists[et][s]&&(s=rt)}this.mins[et]=s}this.clusters[o].index=o}return delete g.key,delete _.key,delete g.index,delete _.index,!0}orderClusters(e){for(let s in e)s==="children"&&(this.orderClusters(e[s][0]),this.orderClusters(e[s][1])),s==="value"&&(e[s]._order=this.order++,this.node_order.push(e[s]._id))}}function getHierarchicalNodes(i,e={}){const s=new HierarchicalClustering(e.distance,e.linkage,e.threshold);s.cluster(i);const o=hierarchy(s.clusters[0]);for(let a of o.descendants()){let d=a.data;delete d.size,d.value&&(d.id=d.value._id,d.order=d.value._order,delete d.value)}return{nodes:o,order:s.node_order}}var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(i){return new Function("d","return {"+i.map(function(e,s){return JSON.stringify(e)+": d["+s+'] || ""'}).join(",")+"}")}function customConverter(i,e){var s=objectConverter(i);return function(o,a){return e(s(o),a,i)}}function inferColumns(i){var e=Object.create(null),s=[];return i.forEach(function(o){for(var a in o)a in e||s.push(e[a]=a)}),s}function pad(i,e){var s=i+"",o=s.length;return o<e?new Array(e-o+1).join(0)+s:s}function formatYear(i){return i<0?"-"+pad(-i,6):i>9999?"+"+pad(i,6):pad(i,4)}function formatDate(i){var e=i.getUTCHours(),s=i.getUTCMinutes(),o=i.getUTCSeconds(),a=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":formatYear(i.getUTCFullYear())+"-"+pad(i.getUTCMonth()+1,2)+"-"+pad(i.getUTCDate(),2)+(a?"T"+pad(e,2)+":"+pad(s,2)+":"+pad(o,2)+"."+pad(a,3)+"Z":o?"T"+pad(e,2)+":"+pad(s,2)+":"+pad(o,2)+"Z":s||e?"T"+pad(e,2)+":"+pad(s,2)+"Z":"")}function dsvFormat(i){var e=new RegExp('["'+i+`
\r]`),s=i.charCodeAt(0);function o(tt,rt){var it,ot,ct=a(tt,function(ft,dt){if(it)return it(ft,dt-1);ot=ft,it=rt?customConverter(ft,rt):objectConverter(ft)});return ct.columns=ot||[],ct}function a(tt,rt){var it=[],ot=tt.length,ct=0,ft=0,dt,pt=ot<=0,gt=!1;tt.charCodeAt(ot-1)===NEWLINE&&--ot,tt.charCodeAt(ot-1)===RETURN&&--ot;function Ct(){if(pt)return EOF;if(gt)return gt=!1,EOL;var at,Bt=ct,Ht;if(tt.charCodeAt(Bt)===QUOTE){for(;ct++<ot&&tt.charCodeAt(ct)!==QUOTE||tt.charCodeAt(++ct)===QUOTE;);return(at=ct)>=ot?pt=!0:(Ht=tt.charCodeAt(ct++))===NEWLINE?gt=!0:Ht===RETURN&&(gt=!0,tt.charCodeAt(ct)===NEWLINE&&++ct),tt.slice(Bt+1,at-1).replace(/""/g,'"')}for(;ct<ot;){if((Ht=tt.charCodeAt(at=ct++))===NEWLINE)gt=!0;else if(Ht===RETURN)gt=!0,tt.charCodeAt(ct)===NEWLINE&&++ct;else if(Ht!==s)continue;return tt.slice(Bt,at)}return pt=!0,tt.slice(Bt,ot)}for(;(dt=Ct())!==EOF;){for(var xt=[];dt!==EOL&&dt!==EOF;)xt.push(dt),dt=Ct();rt&&(xt=rt(xt,ft++))==null||it.push(xt)}return it}function d(tt,rt){return tt.map(function(it){return rt.map(function(ot){return et(it[ot])}).join(i)})}function g(tt,rt){return rt==null&&(rt=inferColumns(tt)),[rt.map(et).join(i)].concat(d(tt,rt)).join(`
`)}function _(tt,rt){return rt==null&&(rt=inferColumns(tt)),d(tt,rt).join(`
`)}function j(tt){return tt.map(_e).join(`
`)}function _e(tt){return tt.map(et).join(i)}function et(tt){return tt==null?"":tt instanceof Date?formatDate(tt):e.test(tt+="")?'"'+tt.replace(/"/g,'""')+'"':tt}return{parse:o,parseRows:a,format:g,formatBody:_,formatRows:j,formatRow:_e,formatValue:et}}var csv$1=dsvFormat(","),csvParse=csv$1.parse,tsv$1=dsvFormat("	"),tsvParse=tsv$1.parse;function responseText(i){if(!i.ok)throw new Error(i.status+" "+i.statusText);return i.text()}function text(i,e){return fetch(i,e).then(responseText)}function dsvParse(i){return function(e,s,o){return arguments.length===2&&typeof s=="function"&&(o=s,s=void 0),text(e,s).then(function(a){return i(a,o)})}}var csv=dsvParse(csvParse),tsv=dsvParse(tsvParse);function responseJson(i){if(!i.ok)throw new Error(i.status+" "+i.statusText);if(!(i.status===204||i.status===205))return i.json()}function json(i,e){return fetch(i,e).then(responseJson)}var pi$2=Math.PI,tau$1=pi$2*2,abs=Math.abs,sqrt=Math.sqrt;function noop$3(){}function streamGeometry(i,e){i&&streamGeometryType.hasOwnProperty(i.type)&&streamGeometryType[i.type](i,e)}var streamObjectType={Feature:function(i,e){streamGeometry(i.geometry,e)},FeatureCollection:function(i,e){for(var s=i.features,o=-1,a=s.length;++o<a;)streamGeometry(s[o].geometry,e)}},streamGeometryType={Sphere:function(i,e){e.sphere()},Point:function(i,e){i=i.coordinates,e.point(i[0],i[1],i[2])},MultiPoint:function(i,e){for(var s=i.coordinates,o=-1,a=s.length;++o<a;)i=s[o],e.point(i[0],i[1],i[2])},LineString:function(i,e){streamLine(i.coordinates,e,0)},MultiLineString:function(i,e){for(var s=i.coordinates,o=-1,a=s.length;++o<a;)streamLine(s[o],e,0)},Polygon:function(i,e){streamPolygon(i.coordinates,e)},MultiPolygon:function(i,e){for(var s=i.coordinates,o=-1,a=s.length;++o<a;)streamPolygon(s[o],e)},GeometryCollection:function(i,e){for(var s=i.geometries,o=-1,a=s.length;++o<a;)streamGeometry(s[o],e)}};function streamLine(i,e,s){var o=-1,a=i.length-s,d;for(e.lineStart();++o<a;)d=i[o],e.point(d[0],d[1],d[2]);e.lineEnd()}function streamPolygon(i,e){var s=-1,o=i.length;for(e.polygonStart();++s<o;)streamLine(i[s],e,1);e.polygonEnd()}function geoStream(i,e){i&&streamObjectType.hasOwnProperty(i.type)?streamObjectType[i.type](i,e):streamGeometry(i,e)}const identity=i=>i;var areaSum=new Adder,areaRingSum=new Adder,x00$2,y00$2,x0$3,y0$3,areaStream={point:noop$3,lineStart:noop$3,lineEnd:noop$3,polygonStart:function(){areaStream.lineStart=areaRingStart,areaStream.lineEnd=areaRingEnd},polygonEnd:function(){areaStream.lineStart=areaStream.lineEnd=areaStream.point=noop$3,areaSum.add(abs(areaRingSum)),areaRingSum=new Adder},result:function(){var i=areaSum/2;return areaSum=new Adder,i}};function areaRingStart(){areaStream.point=areaPointFirst}function areaPointFirst(i,e){areaStream.point=areaPoint,x00$2=x0$3=i,y00$2=y0$3=e}function areaPoint(i,e){areaRingSum.add(y0$3*i-x0$3*e),x0$3=i,y0$3=e}function areaRingEnd(){areaPoint(x00$2,y00$2)}const pathArea=areaStream;var x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream={point:boundsPoint,lineStart:noop$3,lineEnd:noop$3,polygonStart:noop$3,polygonEnd:noop$3,result:function(){var i=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),i}};function boundsPoint(i,e){i<x0$2&&(x0$2=i),i>x1&&(x1=i),e<y0$2&&(y0$2=e),e>y1&&(y1=e)}const boundsStream$1=boundsStream;var X0=0,Y0=0,Z0=0,X1=0,Y1=0,Z1=0,X2=0,Y2=0,Z2=0,x00$1,y00$1,x0$1,y0$1,centroidStream={point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart,centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.point=centroidPoint,centroidStream.lineStart=centroidLineStart,centroidStream.lineEnd=centroidLineEnd},result:function(){var i=Z2?[X2/Z2,Y2/Z2]:Z1?[X1/Z1,Y1/Z1]:Z0?[X0/Z0,Y0/Z0]:[NaN,NaN];return X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0,i}};function centroidPoint(i,e){X0+=i,Y0+=e,++Z0}function centroidLineStart(){centroidStream.point=centroidPointFirstLine}function centroidPointFirstLine(i,e){centroidStream.point=centroidPointLine,centroidPoint(x0$1=i,y0$1=e)}function centroidPointLine(i,e){var s=i-x0$1,o=e-y0$1,a=sqrt(s*s+o*o);X1+=a*(x0$1+i)/2,Y1+=a*(y0$1+e)/2,Z1+=a,centroidPoint(x0$1=i,y0$1=e)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidPointFirstRing}function centroidRingEnd(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(i,e){centroidStream.point=centroidPointRing,centroidPoint(x00$1=x0$1=i,y00$1=y0$1=e)}function centroidPointRing(i,e){var s=i-x0$1,o=e-y0$1,a=sqrt(s*s+o*o);X1+=a*(x0$1+i)/2,Y1+=a*(y0$1+e)/2,Z1+=a,a=y0$1*i-x0$1*e,X2+=a*(x0$1+i),Y2+=a*(y0$1+e),Z2+=a*3,centroidPoint(x0$1=i,y0$1=e)}const pathCentroid=centroidStream;function PathContext(i){this._context=i}PathContext.prototype={_radius:4.5,pointRadius:function(i){return this._radius=i,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(i,e){switch(this._point){case 0:{this._context.moveTo(i,e),this._point=1;break}case 1:{this._context.lineTo(i,e);break}default:{this._context.moveTo(i+this._radius,e),this._context.arc(i,e,this._radius,0,tau$1);break}}},result:noop$3};var lengthSum=new Adder,lengthRing,x00,y00,x0,y0,lengthStream={point:noop$3,lineStart:function(){lengthStream.point=lengthPointFirst},lineEnd:function(){lengthRing&&lengthPoint(x00,y00),lengthStream.point=noop$3},polygonStart:function(){lengthRing=!0},polygonEnd:function(){lengthRing=null},result:function(){var i=+lengthSum;return lengthSum=new Adder,i}};function lengthPointFirst(i,e){lengthStream.point=lengthPoint,x00=x0=i,y00=y0=e}function lengthPoint(i,e){x0-=i,y0-=e,lengthSum.add(sqrt(x0*x0+y0*y0)),x0=i,y0=e}const pathMeasure=lengthStream;function PathString(){this._string=[]}PathString.prototype={_radius:4.5,_circle:circle(4.5),pointRadius:function(i){return(i=+i)!==this._radius&&(this._radius=i,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(i,e){switch(this._point){case 0:{this._string.push("M",i,",",e),this._point=1;break}case 1:{this._string.push("L",i,",",e);break}default:{this._circle==null&&(this._circle=circle(this._radius)),this._string.push("M",i,",",e,this._circle);break}}},result:function(){if(this._string.length){var i=this._string.join("");return this._string=[],i}else return null}};function circle(i){return"m0,"+i+"a"+i+","+i+" 0 1,1 0,"+-2*i+"a"+i+","+i+" 0 1,1 0,"+2*i+"z"}function geoPath(i,e){var s=4.5,o,a;function d(g){return g&&(typeof s=="function"&&a.pointRadius(+s.apply(this,arguments)),geoStream(g,o(a))),a.result()}return d.area=function(g){return geoStream(g,o(pathArea)),pathArea.result()},d.measure=function(g){return geoStream(g,o(pathMeasure)),pathMeasure.result()},d.bounds=function(g){return geoStream(g,o(boundsStream$1)),boundsStream$1.result()},d.centroid=function(g){return geoStream(g,o(pathCentroid)),pathCentroid.result()},d.projection=function(g){return arguments.length?(o=g==null?(i=null,identity):(i=g).stream,d):i},d.context=function(g){return arguments.length?(a=g==null?(e=null,new PathString):new PathContext(e=g),typeof s!="function"&&a.pointRadius(s),d):e},d.pointRadius=function(g){return arguments.length?(s=typeof g=="function"?g:(a.pointRadius(+g),+g),d):s},d.projection(i).context(e)}function Transform$1(i,e,s){this.k=i,this.x=e,this.y=s}Transform$1.prototype={constructor:Transform$1,scale:function(i){return i===1?this:new Transform$1(this.k*i,this.x,this.y)},translate:function(i,e){return i===0&e===0?this:new Transform$1(this.k,this.x+this.k*i,this.y+this.k*e)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Transform$1.prototype;class HeatMap extends SVGChart{constructor(e,s,o){o.title=o.title||e.getColumnName(o.param[0]),super(e,s,o,{x:{type:"band"},y:{type:"band"},tx:{custom:!0,size:45}});const a=this.config.param,d=this.dataStore.getColumnValues(a[0]);this.x_scale.domain(d.slice(0));const g=[],_=this.config;_.method=_.method||"mean",_.color_scale=_.color_scale||{log:!1},_.color_legend||(_.color_legend={display:!0}),this.setColorFunction();for(let j=1;j<a.length;j++)g.push(this.dataStore.getColumnName(a[j]));this.cat_scale=linear$1().range([0,40]),this.cat_axis_svg=this.svg.append("g"),this.cat_axis_call=axisLeft(this.cat_scale).ticks(3),this.y_scale.domain(g),this.dim=this.dataStore.getDimension("catcol_dimension"),_.cluster_rows&&(this.margins.right=70),this.addToolTip(),this.onDataFiltered()}remove(e=!0){this.dim.destroy(e),super.remove()}setColorFunction(){const e=this.config.param,s={useValue:!0,overideValues:{colorLogScale:this.config.color_scale.log,colors:["#313695","#4575B4","#74ADD1","#ABD9E9","#E0F3F8","#E0F3F8","#FFFFBF","#FEE090","#FDAE61","#F46D43","#D73027","#A50026"],max:1,min:0}};this.colorFunction=this.dataStore.getColorFunction(e[1],s),this.setColorLegend()}getColorLegend(){const s={overideValues:{max:1,min:0,colorLogScale:this.config.color_scale.log,colors:["#313695","#4575B4","#74ADD1","#ABD9E9","#E0F3F8","#E0F3F8","#FFFFBF","#FEE090","#FDAE61","#F46D43","#D73027","#A50026"]},name:"Scale"};return this.dataStore.getColorLegend(this.config.param[1],s)}onDataFiltered(e){if(this.dim===e||this.isPinned)return;e==="all_removed"&&(this.filter=[],this.resetButton.style.display="none");const s={method:this.config.method,scaleVals:[]},o=this.config.param;let a=this.config.color_scale.trim=="none"?null:this.config.color_scale.trim;for(let d=1;d<o.length;d++){const g=this.dataStore.columnIndex[o[d]];s.scaleVals.push([a?g.quantiles[a][0]:g.minMax[0],a?g.quantiles[a][1]:g.minMax[1]])}this.dim.getAverages(d=>{this.data=d,this.clusterRows(),this.clusterColumns(),this.drawChart()},this.config.param,s)}clusterRows(){this.config.cluster_rows?(this.rowClusterNodes=getHierarchicalNodes(this.data.averages),this.data.averages.sort((e,s)=>e._order-s._order),this.margins.right=70,this.y_scale.domain(this.rowClusterNodes.order.map(e=>this.dataStore.getColumnName(this.config.param[e+1])))):(delete this.rowClusterNodes,this.y_scale.domain(this.config.param.slice(1).map(e=>this.dataStore.getColumnName(e))),this.margins.right=10,this.data.averages.sort((e,s)=>e._id-s._id),this.ry_axis_svg.selectAll("*").remove())}clusterColumns(){const e=this.dataStore.getColumnValues(this.config.param[0]);this.config.cluster_columns?(this.columnClusterNodes=getHierarchicalNodes(this.data.transpose),this.data.transpose.sort((s,o)=>s._order-o._order),this.x_scale.domain(this.columnClusterNodes.order.map(s=>e[s])),this.setAxisSize("tx",85)):(delete this.columnClusterNodes,this.x_scale.domain(this.data.transpose.map(s=>e[s._id])),this.setAxisSize("tx",45),this.data.transpose.sort((s,o)=>s._id-o._id),this.x_scale.domain(this.data.transpose.map(s=>e[s._id])),this.tx_axis_svg.selectAll("path").remove())}drawChart(e=400){const s=select(this.contentDiv).transition().duration(e).ease(linear),o=this.dataStore.getColumnValues(this.config.param[0]),a=this.dataStore.getColumnColors(this.config.param[0]),d=this._getContentDimensions(),g=d.width/this.data.transpose.length,_=g/2,j=Math.max(...this.data.catTotals),_e=40;this.cat_scale.domain([j,0]);const et=j===0?0:40/j,tt=this.data.transpose.map(ct=>[this.data.catTotals[ct._id],ct._id]),rt=this,it=d.height/(this.config.param.length-1);this.graph_area.selectAll(".heatmap-row").data(this.data.averages).join("g").attr("transform",(ct,ft)=>`translate(0,${ft*it})`).attr("class","heatmap-row").selectAll(".heatmap-rect").data(ct=>ct.map((ft,dt)=>{const pt=ct._id,gt=rt.data.transpose[dt]._id;return{av:rt.data.transpose[dt][pt],row_id:pt,col_id:gt,miss:!1}})).join("rect").attr("class","heatmap-rect").attr("x",(ct,ft)=>ft*g).attr("height",it).attr("width",g).on("click",(ct,ft)=>{const dt=rt.config.param[ft.row_id+1];this._callListeners("cell_clicked",{row:dt,col:o[ft.col_id],val:ft.av})}).on("mouseover mousemove",(ct,ft)=>{const dt=rt.dataStore.columnIndex[rt.config.param[ft.row_id+1]].name;rt.showToolTip(ct,`${o[ft.col_id]}<br>${dt}<br>${ft.av.toPrecision(2)}`)}).on("mouseleave",()=>{rt.hideToolTip()}).transition(s).attr("fill",(ct,ft)=>ct.miss?"#DCDCDC":rt.colorFunction(ct.av));const ot=select(this.contentDiv).transition().duration(e).ease(linear);this.tx_axis_svg.selectAll(".heatmap-catsize").data(tt,(ct,ft)=>ct[1]).join(ct=>ct.append("rect").attr("class","heatmap-catsize").attr("height",0).attr("y",45).attr("x",(ft,dt)=>_/2+dt*g).attr("width",_),ct=>ct,ct=>ct.call(ft=>ft.transition(ot).attr("height",0).attr("y",45).remove())).transition(ot).attr("y",ct=>_e-ct[0]*et+5).attr("height",ct=>ct[0]*et).attr("fill",(ct,ft)=>a[ct[1]]).attr("width",_).attr("x",(ct,ft)=>_/2+ft*g),this.cat_axis_svg.attr("transform",`translate(${d.left},5)`),this.cat_axis_svg.transition().call(this.cat_axis_call),this.updateAxis(),this.rowClusterNodes&&this.drawYTree(this.rowClusterNodes.nodes,this.config.param.length-1),this.columnClusterNodes&&this.drawXTree(this.columnClusterNodes.nodes,this.data.transpose.length,40,45)}setSize(e,s){super.setSize(e,s),this.drawChart()}getSettings(){const e=this.config;return super.getSettings().concat([{type:"check",label:"Cluster Rows",current_value:e.cluster_rows,func:o=>{e.cluster_rows=o,this.clusterRows(),this.drawChart()}},{type:"check",label:"Cluster Columns",current_value:e.cluster_columns,func:o=>{e.cluster_columns=o,this.clusterColumns(),this.drawChart()}},{type:"radiobuttons",label:"Averaging Method",current_value:e.method,choices:[["Mean","mean"],["Median","median"]],func:o=>{e.method=o,this.onDataFiltered()}},{type:"radiobuttons",label:"Trim to Percentile",current_value:e.color_scale.trim||"none",choices:[["No Trim","none"],["0.001","0.001"],["0.01","0.01"],["0.05","0.05"]],func:o=>{e.color_scale.trim=o,this.onDataFiltered()}},{label:"Show Color Legend",type:"check",current_value:e.color_legend?e.color_legend.display:!0,func:o=>{e.color_legend.display=o,this.setColorLegend()}},{type:"check",label:"Log Color Scale",current_value:e.color_scale.log,func:o=>{e.color_scale.log=o,this.setColorFunction(),this.drawChart()}}])}}BaseChart.types.heat_map={name:"Heat Map",class:HeatMap,params:[{type:"text",name:"Categories on x-axis"},{type:"_multi_column:number",name:"Fields on y axis"}]};class ViolinPlot extends WGLChart{constructor(e,s,o){const a=e.getColumnName(o.param[0]),d=e.getColumnName(o.param[1]);o.axis||(o.axis={x:{size:30,label:a,textsize:13},y:{size:45,label:d,textsize:13}}),o.title||(o.title=a+" x "+d),super(e,s,o,{x:{type:"band"},y:{}}),this.config.type="violin_plot";const g=this.config;g.brush=g.brush||"poly";let _={brush:g.brush};this.app=new WGL2DI(this.graphDiv,_);const j=this.afterAppCreation(),_e=this.dataStore.size;this.xPosBuff=new SharedArrayBuffer(_e*4),this.xPos=new Float32Array(this.xPosBuff),this.values=this.dataStore.getColumnValues(g.param[0]);const et=this.dataStore.getRawColumn(g.param[0]);for(let it=0;it<_e;it++)this.xPos[it]=et[it]*50+4+Math.random()*42;const tt=this.dataStore.getMinMaxForColumn(g.param[1]);this.defaultBandWidth=(tt[1]-tt[0])/100,g.band_width=g.band_width||this.defaultBandWidth,g.intervals=g.intervals||20,this.dim=this.dataStore.getDimension("catrange_dimension"),this.x_scale.domain(this.values);const rt=this.dataStore.columnIndex[g.param[1]];this.app.addCircles({x:this.xPos,y:rt.datatype==="int32"?new Float32Array(rt.data):rt.data,localFilter:this.dim.getLocalFilter(),globalFilter:this.dataStore.getFilter(),colorFunc:j}),this.app.addHandler("brush_stopped",(it,ot)=>{this.resetButton.style.display="inline",this.app.setFilter(!0),ot?this._createPolyFilter(it):this._createFilter(it)}),g.radius=g.radius||5,g.opacity=g.opacity||.8,this.app.setPointRadius(this.config.radius),this.app.setPointOpacity(this.config.opacity),this.data=[],this.centerGraph(),this.onDataFiltered()}_createFilter(e){if(this.range=e,e==null)this.dim.removeFilter();else{let s=e.y_max,o=e.y_min,a=e.x_max,d=e.x_min;this.filter=[[d,a],[o,s]],this.dim("filterSquare",[this.xPos,this.config.param[1]],{range1:this.filter[0],range2:this.filter[1]},[this.xPos,1]),this.app.refresh()}}onDataFiltered(e){if(!this.isPinned&&e!==this.dim){e==="all_removed"&&(this.app.clearBrush(),this.app.setFilter(!1),this.resetButton.style.display="none");const s=this.config;this.ticks=this.y_scale.ticks(s.intervals),this.dim.getKernalDensity(o=>{this.data=o,this.drawChart()},s.param,{ticks:this.ticks,bandwidth:s.band_width,intervals:s.intervals,xPos:this.xPosBuff})}}drawChart(){const e=select(this.contentDiv).transition().duration(400).ease(linear),s=[],o=this.data.length,a=this._getContentDimensions(),d=a.width/o,g=[];for(let tt=0;tt<this.data.length;tt++)s.push(d/(2*this.data[tt].max)*.9),g.push(this.values[this.data[tt].id]);this.x_scale.domain(g),this.centerGraph();const _=this.ticks.map(tt=>this.y_scale(tt)),j=[];for(let tt=0;tt<this.data.length;tt++){const rt=tt*d+.5*d,it=[];let ot=!0;for(let ct=0;ct<this.data[tt].length;ct++){const ft=this.data[tt][ct];if(ft===0||isNaN(ft)){if(!ot){if(it[it.length-1][2]==0)continue;it.push([_[ct],rt,0])}continue}if(it.length===0){if(ct===0){it.push([0,rt,0]);continue}else it.push([_[ct-1],rt,0]);ot=!1}it.push([_[ct],rt,s[tt]*ft])}it.length===0?(it.push([0,rt,0]),it.push([0,rt,0])):it[it.length-1][2]!==0&&it.push([a.height,rt,0]),j.push(it),it.id=this.data[tt].id}const _e=this.dataStore.getColumnColors(this.config.param[0]);this.graph_area.selectAll(".violin-curve").data(j,tt=>"A"+tt.id).join("path").attr("class","violin-curve").transition(e).attr("fill","none").attr("stroke",(tt,rt)=>_e[tt.id]).attr("stroke-width",2).attr("stroke-linejoin","round").attr("d",line().curve(curveBasis).x(function(tt,rt){return tt[1]+tt[2]}).y(function(tt,rt){return tt[0]})),this.graph_area.selectAll(".violin-curve1").data(j,tt=>"B"+tt.id).join("path").attr("class","violin-curve1").transition(e).attr("fill","none").attr("stroke",(tt,rt)=>_e[tt.id]).attr("stroke-width",2).attr("stroke-linejoin","round").attr("d",line().curve(curveBasis).x(function(tt,rt){return tt[1]-tt[2]}).y(function(tt,rt){return tt[0]})),this.app.refresh()}unpinChart(){super.unpinChart(),this.onDataFiltered()}onDataAdded(e){const s=this.config.param,o=this.getSetupConfig();let a=new Float32Array(e);a.set(this.xPos),this.values=this.dataStore.getColumnValues(s[0]);const d=this.dataStore.getRawColumn(s[0]);for(let g=this.xPos.length;g<e;g++)a[g]=d[g]*50+4+Math.random()*42;this.xPos=a,o.x=a,o.y=this.dataStore.getRawColumn(s[1]),this.dim.filterColumns&&(this.dimFilterColumns[0]=a),this.app.updateSize(e,o),super.onDataAdded(e)}setSize(e,s){super.setSize(e,s),this.drawChart()}centerGraph(){const e=this.dataStore.getMinMaxForColumn(this.config.param[1]);let s=this.data.length*50,o=e[1],a=0,d=e[0],g=(o-d)/20,_=s-a,j=o-d+2*g;const _e=this._getContentDimensions();this.app.x_scale=_e.width/_,this.app.y_scale=_e.height/j,this.app.offset[0]=-a,this.app.offset[1]=o+g,this._updateScale(this.app.getRange()),this.updateAxis()}_updateScale(e){this.y_scale.domain([-e.y_range[0],-e.y_range[1]])}getSettings(){const e=super.getSettings(),s=this.config,o=this.dataStore.getMinMaxForColumn(s.param[1]);return e.splice(1,0,{type:"slider",max:o[1]/10,min:o[0]<0?0:o[0],doc:this.__doc__,current_value:s.band_width,label:"Band Width",func:a=>{s.band_width=a,this.onDataFiltered()}},{type:"slider",max:100,min:10,step:1,doc:this.__doc__,current_value:s.intervals,label:"Intervals",func:a=>{s.intervals=a,this.onDataFiltered()}}),e}_createPolyFilter(e){this.range=!0;for(let s of e)s[1]=-s[1],this.config.axis.x_log_scale&&(s[0]=this._getInverseLogValue(s[0])),this.config.axis.y_log_scale&&(s[1]=this._getInverseLogValue(s[1]));this.filter=e,this.dim.filter("filterPoly",[this.xPos,this.config.param[1]],e),this.app.refresh()}}BaseChart.types.violin_plot={class:ViolinPlot,name:"Violin Plot",params:[{type:"text",name:"Category (X axis)"},{type:"number",name:"Value (Y axis)"}]};class BoxPlot extends ViolinPlot{constructor(e,s,o){super(e,s,o),this.config.type="box_plot"}onDataFiltered(e){this.isPinned||e!==this.dim&&(e==="all_removed"&&(this.app.clearBrush(),this.app.setFilter(!1),this.resetButton.style.display="none"),this.ticks=this.y_scale.ticks(20),this.dim.getBoxPlotData(s=>{this.data=s,this.drawChart()},this.config.param,{xPos:this.xPosBuff}))}drawChart(){const e=select(this.contentDiv).transition().duration(400).ease(linear),s=this.data.length,o=this.y_scale,a=[];for(let j of this.data)a.push(this.values[j.id]);this.x_scale.domain(a),this.centerGraph();const g=this._getContentDimensions().width/s,_=this.dataStore.getColumnColors(this.config.param[0]);this.graph_area.selectAll(".boxplot-rect").data(this.data,j=>j.id).join("rect").attr("class","boxplot-rect").transition(e).attr("x",(j,_e)=>_e*(g-3)+(_e+1)*3).attr("y",j=>o(j.Q3)).attr("width",g-6).attr("height",j=>{const _e=o(j.Q1)-o(j.Q3);return isNaN(_e)?0:_e}).attr("fill","none").attr("stroke",(j,_e)=>_[j.id]).attr("stroke-width",3),this.graph_area.selectAll(".boxplot-whisker").data(this.data,j=>j.id).join("path").attr("class","boxplot-whisker").transition(e).attr("stroke",(j,_e)=>_[j.id]).attr("fill","none").attr("stroke-width",3).attr("d",(j,_e)=>{if(isNaN(j.med))return"";const et=_e*(g-6)+(_e+1)*6,tt=_e*(g-3)+(_e+1)*3,rt=_e*g+.5*g,it=o(j.max),ot=o(j.min);return it==null||ot==null?"":`
             M${et} ${it} L${et+g-12} ${it}
             M${rt} ${it} L${rt} ${o(j.Q3)}
             M${tt} ${o(j.med)} L${tt+g-6} ${o(j.med)}
             M${rt} ${ot} L${rt} ${o(j.Q1)}
             M${et} ${ot} L${et+g-12} ${ot}`}),this.app.refresh()}}BaseChart.types.box_plot={class:BoxPlot,name:"Box Plot",params:[{type:"text",name:"Category (X axis)"},{type:"number",name:"Value (Y axis)"}]};function justify(i,e){return i.sourceLinks.length?i.depth:e-1}function constant$1(i){return function(){return i}}function ascendingSourceBreadth(i,e){return ascendingBreadth(i.source,e.source)||i.index-e.index}function ascendingTargetBreadth(i,e){return ascendingBreadth(i.target,e.target)||i.index-e.index}function ascendingBreadth(i,e){return i.y0-e.y0}function value(i){return i.value}function defaultId(i){return i.index}function defaultNodes(i){return i.nodes}function defaultLinks(i){return i.links}function find(i,e){const s=i.get(e);if(!s)throw new Error("missing: "+e);return s}function computeLinkBreadths({nodes:i}){for(const e of i){let s=e.y0,o=s;for(const a of e.sourceLinks)a.y0=s+a.width/2,s+=a.width;for(const a of e.targetLinks)a.y1=o+a.width/2,o+=a.width}}function Sankey(){let i=0,e=0,s=1,o=1,a=24,d=8,g,_=defaultId,j=justify,_e,et,tt=defaultNodes,rt=defaultLinks,it=6;function ot(){const vr={nodes:tt.apply(null,arguments),links:rt.apply(null,arguments)};return ct(vr),ft(vr),dt(vr),pt(vr),xt(vr),computeLinkBreadths(vr),vr}ot.update=function(vr){return computeLinkBreadths(vr),vr},ot.nodeId=function(vr){return arguments.length?(_=typeof vr=="function"?vr:constant$1(vr),ot):_},ot.nodeAlign=function(vr){return arguments.length?(j=typeof vr=="function"?vr:constant$1(vr),ot):j},ot.nodeSort=function(vr){return arguments.length?(_e=vr,ot):_e},ot.nodeWidth=function(vr){return arguments.length?(a=+vr,ot):a},ot.nodePadding=function(vr){return arguments.length?(d=g=+vr,ot):d},ot.nodes=function(vr){return arguments.length?(tt=typeof vr=="function"?vr:constant$1(vr),ot):tt},ot.links=function(vr){return arguments.length?(rt=typeof vr=="function"?vr:constant$1(vr),ot):rt},ot.linkSort=function(vr){return arguments.length?(et=vr,ot):et},ot.size=function(vr){return arguments.length?(i=e=0,s=+vr[0],o=+vr[1],ot):[s-i,o-e]},ot.extent=function(vr){return arguments.length?(i=+vr[0][0],s=+vr[1][0],e=+vr[0][1],o=+vr[1][1],ot):[[i,e],[s,o]]},ot.iterations=function(vr){return arguments.length?(it=+vr,ot):it};function ct({nodes:vr,links:Zr}){for(const[cr,lr]of vr.entries())lr.index=cr,lr.sourceLinks=[],lr.targetLinks=[];const Hr=new Map(vr.map((cr,lr)=>[_(cr,lr,vr),cr]));for(const[cr,lr]of Zr.entries()){lr.index=cr;let{source:Fr,target:an}=lr;typeof Fr!="object"&&(Fr=lr.source=find(Hr,Fr)),typeof an!="object"&&(an=lr.target=find(Hr,an)),Fr.sourceLinks.push(lr),an.targetLinks.push(lr)}if(et!=null)for(const{sourceLinks:cr,targetLinks:lr}of vr)cr.sort(et),lr.sort(et)}function ft({nodes:vr}){for(const Zr of vr)Zr.value=Zr.fixedValue===void 0?Math.max(sum(Zr.sourceLinks,value),sum(Zr.targetLinks,value)):Zr.fixedValue}function dt({nodes:vr}){const Zr=vr.length;let Hr=new Set(vr),cr=new Set,lr=0;for(;Hr.size;){for(const Fr of Hr){Fr.depth=lr;for(const{target:an}of Fr.sourceLinks)cr.add(an)}if(++lr>Zr)throw new Error("circular link");Hr=cr,cr=new Set}}function pt({nodes:vr}){const Zr=vr.length;let Hr=new Set(vr),cr=new Set,lr=0;for(;Hr.size;){for(const Fr of Hr){Fr.height=lr;for(const{source:an}of Fr.targetLinks)cr.add(an)}if(++lr>Zr)throw new Error("circular link");Hr=cr,cr=new Set}}function gt({nodes:vr}){const Zr=max$2(vr,lr=>lr.depth)+1,Hr=(s-i-a)/(Zr-1),cr=new Array(Zr);for(const lr of vr){const Fr=Math.max(0,Math.min(Zr-1,Math.floor(j.call(null,lr,Zr))));lr.layer=Fr,lr.x0=i+Fr*Hr,lr.x1=lr.x0+a,cr[Fr]?cr[Fr].push(lr):cr[Fr]=[lr]}if(_e)for(const lr of cr)lr.sort(_e);return cr}function Ct(vr){const Zr=min$2(vr,Hr=>(o-e-(Hr.length-1)*g)/sum(Hr,value));for(const Hr of vr){let cr=e;for(const lr of Hr){lr.y0=cr,lr.y1=cr+lr.value*Zr,cr=lr.y1+g;for(const Fr of lr.sourceLinks)Fr.width=Fr.value*Zr}cr=(o-cr+g)/(Hr.length+1);for(let lr=0;lr<Hr.length;++lr){const Fr=Hr[lr];Fr.y0+=cr*(lr+1),Fr.y1+=cr*(lr+1)}Er(Hr)}}function xt(vr){const Zr=gt(vr);g=Math.min(d,(o-e)/(max$2(Zr,Hr=>Hr.length)-1)),Ct(Zr);for(let Hr=0;Hr<it;++Hr){const cr=Math.pow(.99,Hr),lr=Math.max(1-cr,(Hr+1)/it);Bt(Zr,cr,lr),at(Zr,cr,lr)}}function at(vr,Zr,Hr){for(let cr=1,lr=vr.length;cr<lr;++cr){const Fr=vr[cr];for(const an of Fr){let kn=0,ms=0;for(const{source:As,value:Rs}of an.targetLinks){let Gn=Rs*(an.layer-As.layer);kn+=Lr(As,an)*Gn,ms+=Gn}if(!(ms>0))continue;let Zn=(kn/ms-an.y0)*Zr;an.y0+=Zn,an.y1+=Zn,hr(an)}_e===void 0&&Fr.sort(ascendingBreadth),Ht(Fr,Hr)}}function Bt(vr,Zr,Hr){for(let cr=vr.length,lr=cr-2;lr>=0;--lr){const Fr=vr[lr];for(const an of Fr){let kn=0,ms=0;for(const{target:As,value:Rs}of an.sourceLinks){let Gn=Rs*(As.layer-an.layer);kn+=sn(an,As)*Gn,ms+=Gn}if(!(ms>0))continue;let Zn=(kn/ms-an.y0)*Zr;an.y0+=Zn,an.y1+=Zn,hr(an)}_e===void 0&&Fr.sort(ascendingBreadth),Ht(Fr,Hr)}}function Ht(vr,Zr){const Hr=vr.length>>1,cr=vr[Hr];mr(vr,cr.y0-g,Hr-1,Zr),sr(vr,cr.y1+g,Hr+1,Zr),mr(vr,o,vr.length-1,Zr),sr(vr,e,0,Zr)}function sr(vr,Zr,Hr,cr){for(;Hr<vr.length;++Hr){const lr=vr[Hr],Fr=(Zr-lr.y0)*cr;Fr>1e-6&&(lr.y0+=Fr,lr.y1+=Fr),Zr=lr.y1+g}}function mr(vr,Zr,Hr,cr){for(;Hr>=0;--Hr){const lr=vr[Hr],Fr=(lr.y1-Zr)*cr;Fr>1e-6&&(lr.y0-=Fr,lr.y1-=Fr),Zr=lr.y0-g}}function hr({sourceLinks:vr,targetLinks:Zr}){if(et===void 0){for(const{source:{sourceLinks:Hr}}of Zr)Hr.sort(ascendingTargetBreadth);for(const{target:{targetLinks:Hr}}of vr)Hr.sort(ascendingSourceBreadth)}}function Er(vr){if(et===void 0)for(const{sourceLinks:Zr,targetLinks:Hr}of vr)Zr.sort(ascendingTargetBreadth),Hr.sort(ascendingSourceBreadth)}function Lr(vr,Zr){let Hr=vr.y0-(vr.sourceLinks.length-1)*g/2;for(const{target:cr,width:lr}of vr.sourceLinks){if(cr===Zr)break;Hr+=lr+g}for(const{source:cr,width:lr}of Zr.targetLinks){if(cr===vr)break;Hr-=lr}return Hr}function sn(vr,Zr){let Hr=Zr.y0-(Zr.targetLinks.length-1)*g/2;for(const{source:cr,width:lr}of Zr.targetLinks){if(cr===vr)break;Hr+=lr+g}for(const{target:cr,width:lr}of vr.sourceLinks){if(cr===Zr)break;Hr-=lr}return Hr}return ot}var pi$1=Math.PI,tau=2*pi$1,epsilon=1e-6,tauEpsilon=tau-epsilon;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function(i,e){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(i,e){this._+="L"+(this._x1=+i)+","+(this._y1=+e)},quadraticCurveTo:function(i,e,s,o){this._+="Q"+ +i+","+ +e+","+(this._x1=+s)+","+(this._y1=+o)},bezierCurveTo:function(i,e,s,o,a,d){this._+="C"+ +i+","+ +e+","+ +s+","+ +o+","+(this._x1=+a)+","+(this._y1=+d)},arcTo:function(i,e,s,o,a){i=+i,e=+e,s=+s,o=+o,a=+a;var d=this._x1,g=this._y1,_=s-i,j=o-e,_e=d-i,et=g-e,tt=_e*_e+et*et;if(a<0)throw new Error("negative radius: "+a);if(this._x1===null)this._+="M"+(this._x1=i)+","+(this._y1=e);else if(tt>epsilon)if(!(Math.abs(et*_-j*_e)>epsilon)||!a)this._+="L"+(this._x1=i)+","+(this._y1=e);else{var rt=s-d,it=o-g,ot=_*_+j*j,ct=rt*rt+it*it,ft=Math.sqrt(ot),dt=Math.sqrt(tt),pt=a*Math.tan((pi$1-Math.acos((ot+tt-ct)/(2*ft*dt)))/2),gt=pt/dt,Ct=pt/ft;Math.abs(gt-1)>epsilon&&(this._+="L"+(i+gt*_e)+","+(e+gt*et)),this._+="A"+a+","+a+",0,0,"+ +(et*rt>_e*it)+","+(this._x1=i+Ct*_)+","+(this._y1=e+Ct*j)}},arc:function(i,e,s,o,a,d){i=+i,e=+e,s=+s,d=!!d;var g=s*Math.cos(o),_=s*Math.sin(o),j=i+g,_e=e+_,et=1^d,tt=d?o-a:a-o;if(s<0)throw new Error("negative radius: "+s);this._x1===null?this._+="M"+j+","+_e:(Math.abs(this._x1-j)>epsilon||Math.abs(this._y1-_e)>epsilon)&&(this._+="L"+j+","+_e),s&&(tt<0&&(tt=tt%tau+tau),tt>tauEpsilon?this._+="A"+s+","+s+",0,1,"+et+","+(i-g)+","+(e-_)+"A"+s+","+s+",0,1,"+et+","+(this._x1=j)+","+(this._y1=_e):tt>epsilon&&(this._+="A"+s+","+s+",0,"+ +(tt>=pi$1)+","+et+","+(this._x1=i+s*Math.cos(a))+","+(this._y1=e+s*Math.sin(a))))},rect:function(i,e,s,o){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)+"h"+ +s+"v"+ +o+"h"+-s+"Z"},toString:function(){return this._}};function constant(i){return function(){return i}}function x$1(i){return i[0]}function y$1(i){return i[1]}var slice=Array.prototype.slice;function linkSource(i){return i.source}function linkTarget(i){return i.target}function link(i){var e=linkSource,s=linkTarget,o=x$1,a=y$1,d=null;function g(){var _,j=slice.call(arguments),_e=e.apply(this,j),et=s.apply(this,j);if(d||(d=_=path()),i(d,+o.apply(this,(j[0]=_e,j)),+a.apply(this,j),+o.apply(this,(j[0]=et,j)),+a.apply(this,j)),_)return d=null,_+""||null}return g.source=function(_){return arguments.length?(e=_,g):e},g.target=function(_){return arguments.length?(s=_,g):s},g.x=function(_){return arguments.length?(o=typeof _=="function"?_:constant(+_),g):o},g.y=function(_){return arguments.length?(a=typeof _=="function"?_:constant(+_),g):a},g.context=function(_){return arguments.length?(d=_??null,g):d},g}function curveHorizontal(i,e,s,o,a){i.moveTo(e,s),i.bezierCurveTo(e=(e+o)/2,s,e,a,o,a)}function linkHorizontal(){return link(curveHorizontal)}function horizontalSource(i){return[i.source.x1,i.y0]}function horizontalTarget(i){return[i.target.x0,i.y1]}function sankeyLinkHorizontal(){return linkHorizontal().source(horizontalSource).target(horizontalTarget)}class SankeyChart extends SVGChart{constructor(e,s,o){const a={y:{custom:!0},ry:{label:!0}},d=e.getColumnName(o.param[0]),g=e.getColumnName(o.param[1]);o.label||(o.label=`${d} vs. ${g}`),o.axis||(o.axis={}),o.axis.y||(o.axis.y={size:25,textSize:15,label:d}),o.axis.ry||(o.axis.ry={size:25,textSize:15,label:g}),super(e,s,o,a);const _=this.config;_.type="sankey_chart",this.dim=this.dataStore.getDimension("category_dimension"),this.filter=[],this.addToolTip(),this.onDataFiltered()}setSize(e,s){super.setSize(e,s),this.drawChart()}remove(e=!0){this.dim.destroy(e),super.remove()}removeFilter(){this.dim.removeFilter(),this.filter=[],this.nodeFilter=null,this.linkFilter=null,this.drawChart()}onDataFiltered(e){this.dim===e||this.isPinned||(e==="all_removed"&&(this.filter=[],this.nodeFilter=null,this.linkFilter=null,this.resetButton.style.display="none"),this.dim.getSankeyData(s=>{this.sankeyData=s,this.drawChart()},this.config.param))}drawChart(){this.updateAxis();const e=select(this.contentDiv).transition().duration(400).ease(linear),s=this._getContentDimensions(),o=this.config.param,a=[this.dataStore.getColumnColors(o[0]),this.dataStore.getColumnColors(o[1])],d=this;let g=20-this.sankeyData.minNodes;g=g<1?1:g>10?10:g;const j=Sankey().size([s.width,s.height]).nodeId(_e=>_e.id).nodeWidth(20).nodePadding(g).nodeAlign(justify)(this.sankeyData);this.graph_area.selectAll(".s-links").data(j.links).join("path").on("click",(_e,et)=>{d.filterMultipleCategories(et)}).on("mouseover mousemove",(_e,et)=>{const tt=et.source,rt=d.dataStore.getColumnValues(d.config.param[tt.param])[tt.ind],it=et.target,ot=d.dataStore.getColumnValues(d.config.param[it.param])[it.ind];d.showToolTip(_e,`${rt}<br>${ot}<br>${et.trueValue}`)}).on("mouseleave",()=>{d.hideToolTip()}).transition(e).attr("class","s-links").attr("d",sankeyLinkHorizontal()).attr("fill","none").attr("stroke","currentColor").attr("stroke-width",_e=>_e.width).attr("stoke-opacity",.5).attr("opacity",_e=>d.linkFilter?_e.source.id===d.linkFilter[0]&&_e.target.id===d.linkFilter[1]?.8:.2:d.nodeFilter?_e.source.id===d.nodeFilter||_e.target.id===d.nodeFilter?.8:.2:.5),this.graph_area.selectAll(".s-nodes").data(j.nodes).join("rect").on("click",(_e,et)=>{const tt=o[et.param];d.nodeFilter=(et.param===0?"A":"B")+et.ind,d.linkFilter=null;const rt=d.dataStore.getColumnValues(tt);d.filterCategories(tt,rt[et.ind])}).on("mouseover mousemove",(_e,et)=>{const tt=d.dataStore.getColumnValues(d.config.param[et.param])[et.ind];d.showToolTip(_e,tt)}).on("mouseleave",()=>{d.hideToolTip()}).attr("class","s-nodes").attr("x",_e=>_e.x0).attr("y",_e=>_e.y0).attr("width",_e=>_e.x1-_e.x0).attr("height",_e=>_e.y1-_e.y0).attr("fill",_e=>a[_e.param][_e.ind])}getFilter(){const e=this.config.param;if(this.linkFilter){const s={};let o=parseInt(this.linkFilter[0].substring(1));return s[e[0]]=[this.dataStore.getColumnValues(e[0])[o]],o=parseInt(this.linkFilter[1].substring(1)),s[e[1]]=[this.dataStore.getColumnValues(e[1])[o]],s}if(this.nodeFilter){const s={},o=this.nodeFilter.startsWith("A")?0:1;let a=parseInt(this.nodeFilter.substring(1));return s[e[o]]=[this.dataStore.getColumnValues(e[o])[a]],s}return null}filterMultipleCategories(e){const s=this.config.param,o=s[e.source.param],a=this.dataStore.getColumnValues(o)[e.source.ind],d=s[e.target.param],g=this.dataStore.getColumnValues(d)[e.target.ind];this.linkFilter=["A"+e.source.ind,"B"+e.target.ind],this.resetButton.style.display="inline",this.drawChart(),this.dim.filter("filterMultipleCategories",[o,d],[a,g])}filterCategories(e,s,o){o?this.filter.push(s):this.filter=[s],this.resetButton.style.display="inline",this.drawChart(),this.dim.filter("filterCategories",[e],this.filter)}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}getSettings(){const e=super.getSettings();return this.config,e}}BaseChart.types.sankey_chart={name:"Sankey Diagram",class:SankeyChart,params:[{type:"text",name:"First Group"},{type:"text",name:"Second Group"}]};function _defineProperty(i,e,s){return e in i?Object.defineProperty(i,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[e]=s,i}function isElectron(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,s=i||e;return!!(s&&s.indexOf("Electron")>=0)}function isBrowser$3(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||isElectron()}const globals={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},window_$1=globals.window||globals.self||globals.global,process_=globals.process||{},VERSION$3=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";isBrowser$3();const window$1=globalThis;function getBrowser(i){if(!i&&!isBrowser$3())return"Node";if(isElectron(i))return"Electron";const s=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(s.indexOf("Edge")>-1)return"Edge";const o=s.indexOf("MSIE ")!==-1,a=s.indexOf("Trident/")!==-1;return o||a?"IE":window$1.chrome?"Chrome":window$1.safari?"Safari":window$1.mozInnerScreenX?"Firefox":"Unknown"}function getStorage(i){try{const e=window[i],s="__storage_test__";return e.setItem(s,s),e.removeItem(s),e}catch{return null}}class LocalStorage{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";_defineProperty(this,"storage",void 0),_defineProperty(this,"id",void 0),_defineProperty(this,"config",{}),this.storage=getStorage(o),this.id=e,this.config={},Object.assign(this.config,s),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const s=JSON.stringify(this.config);this.storage.setItem(this.id,s)}return this}_loadConfiguration(){let e={};if(this.storage){const s=this.storage.getItem(this.id);e=s?JSON.parse(s):{}}return Object.assign(this.config,e),this}}function formatTime(i){let e;return i<10?e="".concat(i.toFixed(2),"ms"):i<100?e="".concat(i.toFixed(1),"ms"):i<1e3?e="".concat(i.toFixed(0),"ms"):e="".concat((i/1e3).toFixed(2),"s"),e}function leftPad(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const s=Math.max(e-i.length,0);return"".concat(" ".repeat(s)).concat(i)}function formatImage(i,e,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const a=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>o&&(s=Math.min(s,o/i.width));const d=i.width*s,g=i.height*s,_=["font-size:1px;","padding:".concat(Math.floor(g/2),"px ").concat(Math.floor(d/2),"px;"),"line-height:".concat(g,"px;"),"background:url(".concat(a,");"),"background-size:".concat(d,"px ").concat(g,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),_]}let COLOR;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(COLOR||(COLOR={}));function getColor(i){return typeof i=="string"?COLOR[i.toUpperCase()]||COLOR.WHITE:i}function addColor(i,e,s){return!isBrowser$3&&typeof i=="string"&&(e&&(e=getColor(e),i="\x1B[".concat(e,"m").concat(i,"\x1B[39m")),s&&(e=getColor(s),i="\x1B[".concat(s+10,"m").concat(i,"\x1B[49m"))),i}function autobind(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const s=Object.getPrototypeOf(i),o=Object.getOwnPropertyNames(s);for(const a of o)typeof i[a]=="function"&&(e.find(d=>a===d)||(i[a]=i[a].bind(i)))}function assert$8(i,e){if(!i)throw new Error(e||"Assertion failed")}function getHiResTimestamp$1(){let i;if(isBrowser$3&&"performance"in window_$1){var e,s;i=window_$1==null||(e=window_$1.performance)===null||e===void 0||(s=e.now)===null||s===void 0?void 0:s.call(e)}else if("hrtime"in process_){var o;const a=process_==null||(o=process_.hrtime)===null||o===void 0?void 0:o.call(process_);i=a[0]*1e3+a[1]/1e6}else i=Date.now();return i}const originalConsole={debug:isBrowser$3&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_SETTINGS={enabled:!0,level:0};function noop$2(){}const cache={},ONCE={once:!0};class Log{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};_defineProperty(this,"id",void 0),_defineProperty(this,"VERSION",VERSION$3),_defineProperty(this,"_startTs",getHiResTimestamp$1()),_defineProperty(this,"_deltaTs",getHiResTimestamp$1()),_defineProperty(this,"_storage",void 0),_defineProperty(this,"userData",{}),_defineProperty(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new LocalStorage("__probe-".concat(this.id,"__"),DEFAULT_SETTINGS),this.userData={},this.timeStamp("".concat(this.id," started")),autobind(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp$1()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp$1()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,s){this._storage.updateConfiguration({[e]:s})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,s){assert$8(e,s)}warn(e){return this._getLogFunction(0,e,originalConsole.warn,arguments,ONCE)}error(e){return this._getLogFunction(0,e,originalConsole.error,arguments)}deprecated(e,s){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(s,"` instead"))}removed(e,s){return this.error("`".concat(e,"` has been removed. Use `").concat(s,"` instead"))}probe(e,s){return this._getLogFunction(e,s,originalConsole.log,arguments,{time:!0,once:!0})}log(e,s){return this._getLogFunction(e,s,originalConsole.debug,arguments)}info(e,s){return this._getLogFunction(e,s,console.info,arguments)}once(e,s){for(var o=arguments.length,a=new Array(o>2?o-2:0),d=2;d<o;d++)a[d-2]=arguments[d];return this._getLogFunction(e,s,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(e,s,o){return s?this._getLogFunction(e,s,console.table||noop$2,o&&[o],{tag:getTableHeader(s)}):noop$2}image(e){let{logLevel:s,priority:o,image:a,message:d="",scale:g=1}=e;return this._shouldLog(s||o)?isBrowser$3?logImageInBrowser({image:a,message:d,scale:g}):logImageInNode({image:a,message:d,scale:g}):noop$2}time(e,s){return this._getLogFunction(e,s,console.time?console.time:console.info)}timeEnd(e,s){return this._getLogFunction(e,s,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,s){return this._getLogFunction(e,s,console.timeStamp||noop$2)}group(e,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const a=normalizeArguments({logLevel:e,message:s,opts:o}),{collapsed:d}=o;return a.method=(d?console.groupCollapsed:console.group)||console.info,this._getLogFunction(a)}groupCollapsed(e,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,s,Object.assign({},o,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||noop$2)}withGroup(e,s,o){this.group(e,s)();try{o()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(e)}_getLogFunction(e,s,o,a,d){if(this._shouldLog(e)){d=normalizeArguments({logLevel:e,message:s,args:a,opts:d}),o=o||d.method,assert$8(o),d.total=this.getTotal(),d.delta=this.getDelta(),this._deltaTs=getHiResTimestamp$1();const g=d.tag||d.message;if(d.once)if(!cache[g])cache[g]=getHiResTimestamp$1();else return noop$2;return s=decorateMessage(this.id,d.message,d),o.bind(console,s,...d.args)}return noop$2}}_defineProperty(Log,"VERSION",VERSION$3);function normalizeLogLevel(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return assert$8(Number.isFinite(e)&&e>=0),e}function normalizeArguments(i){const{logLevel:e,message:s}=i;i.logLevel=normalizeLogLevel(e);const o=i.args?Array.from(i.args):[];for(;o.length&&o.shift()!==s;);switch(typeof e){case"string":case"function":s!==void 0&&o.unshift(s),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const a=typeof i.message;return assert$8(a==="string"||a==="object"),Object.assign(i,{args:o},i.opts)}function decorateMessage(i,e,s){if(typeof e=="string"){const o=s.time?leftPad(formatTime(s.total)):"";e=s.time?"".concat(i,": ").concat(o,"  ").concat(e):"".concat(i,": ").concat(e),e=addColor(e,s.color,s.background)}return e}function logImageInNode(i){let{image:e,message:s="",scale:o=1}=i;return(void 0)({image:e,message:s,scale:o}),noop$2}function logImageInBrowser(i){let{image:e,message:s="",scale:o=1}=i;if(typeof e=="string"){const d=new Image;return d.onload=()=>{const g=formatImage(d,s,o);console.log(...g)},d.src=e,noop$2}const a=e.nodeName||"";if(a.toLowerCase()==="img")return console.log(...formatImage(e,s,o)),noop$2;if(a.toLowerCase()==="canvas"){const d=new Image;return d.onload=()=>console.log(...formatImage(d,s,o)),d.src=e.toDataURL(),noop$2}return noop$2}function getTableHeader(i){for(const e in i)for(const s in i[e])return s||"untitled";return"empty"}const log$3=new Log({id:"luma.gl"});function assert$7(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}const ERR_CONTEXT="Invalid WebGLRenderingContext",ERR_WEBGL2="Requires WebGL2";function isWebGL(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function isWebGL2$1(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function getWebGL2Context(i){return isWebGL2$1(i)?i:null}function assertWebGLContext(i){return assert$7(isWebGL(i),ERR_CONTEXT),i}function assertWebGL2Context(i){return assert$7(isWebGL2$1(i),ERR_WEBGL2),i}const glErrorShadow={};function error(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function log$2(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function synthesizeGLError(i,e){glErrorShadow[i]=!0,e!==void 0&&error(e)}function wrapGLError(i){const e=i.getError;i.getError=function(){let o;do o=e.apply(i),o!==0&&(glErrorShadow[o]=!0);while(o!==0);for(o in glErrorShadow)if(glErrorShadow[o])return delete glErrorShadow[o],parseInt(o,10);return 0}}const WebGLVertexArrayObjectOES=function i(e){const s=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let o=0;o<this.attribs.length;o++){const a=new i.VertexAttrib(s);this.attribs[o]=a}this.maxAttrib=0};WebGLVertexArrayObjectOES.VertexAttrib=function i(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};WebGLVertexArrayObjectOES.VertexAttrib.prototype.recache=function i(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const OESVertexArrayObject=function i(e){const s=this;this.gl=e,wrapGLError(e);const o=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(d){return d===s.VERTEX_ARRAY_BINDING_OES?s.currentVertexArrayObject===s.defaultVertexArrayObject?null:s.currentVertexArrayObject:o.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(d){const g=s.currentVertexArrayObject;g.maxAttrib=Math.max(g.maxAttrib,d);const _=g.attribs[d];return _.enabled=!0,o.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(d){const g=s.currentVertexArrayObject;g.maxAttrib=Math.max(g.maxAttrib,d);const _=g.attribs[d];return _.enabled=!1,o.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(d,g){switch(d){case 34962:s.currentArrayBuffer=g;break;case 34963:s.currentVertexArrayObject.elementArrayBuffer=g;break}return o.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(d,g){const j=s.currentVertexArrayObject.attribs[d];switch(g){case 34975:return j.buffer;case 34338:return j.enabled;case 34339:return j.size;case 34340:return j.stride;case 34341:return j.type;case 34922:return j.normalized;default:return o.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(d,g,_,j,_e,et){const tt=s.currentVertexArrayObject;tt.maxAttrib=Math.max(tt.maxAttrib,d);const rt=tt.attribs[d];return rt.buffer=s.currentArrayBuffer,rt.size=g,rt.type=_,rt.normalized=j,rt.stride=_e,rt.offset=et,rt.recache(),o.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{log$2("OESVertexArrayObject emulation library context restored"),s.reset_()},!0),this.reset_()};OESVertexArrayObject.prototype.VERTEX_ARRAY_BINDING_OES=34229;OESVertexArrayObject.prototype.reset_=function i(){if(this.vertexArrayObjects!==void 0)for(let o=0;o<this.vertexArrayObjects.length;++o)this.vertexArrayObjects.isAlive=!1;const s=this.gl;this.maxVertexAttribs=s.getParameter(34921),this.defaultVertexArrayObject=new WebGLVertexArrayObjectOES(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};OESVertexArrayObject.prototype.createVertexArrayOES=function i(){const e=new WebGLVertexArrayObjectOES(this);return this.vertexArrayObjects.push(e),e};OESVertexArrayObject.prototype.deleteVertexArrayOES=function i(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};OESVertexArrayObject.prototype.isVertexArrayOES=function i(e){return!!(e&&e instanceof WebGLVertexArrayObjectOES&&e.hasBeenBound&&e.ext===this)};OESVertexArrayObject.prototype.bindVertexArrayOES=function i(e){const s=this.gl;if(e&&!e.isAlive){synthesizeGLError(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const o=this.original,a=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const d=this.currentVertexArrayObject;if(a===d)return;(!a||d.elementArrayBuffer!==a.elementArrayBuffer)&&o.bindBuffer.call(s,34963,d.elementArrayBuffer);let g=this.currentArrayBuffer;const _=Math.max(a?a.maxAttrib:0,d.maxAttrib);for(let j=0;j<=_;j++){const _e=d.attribs[j],et=a?a.attribs[j]:null;if((!a||_e.enabled!==et.enabled)&&(_e.enabled?o.enableVertexAttribArray.call(s,j):o.disableVertexAttribArray.call(s,j)),_e.enabled){let tt=!1;(!a||_e.buffer!==et.buffer)&&(g!==_e.buffer&&(o.bindBuffer.call(s,34962,_e.buffer),g=_e.buffer),tt=!0),(tt||_e.cached!==et.cached)&&o.vertexAttribPointer.call(s,j,_e.size,_e.type,_e.normalized,_e.stride,_e.offset)}}this.currentArrayBuffer!==g&&o.bindBuffer.call(s,34962,this.currentArrayBuffer)};function polyfillVertexArrayObject(i){if(typeof i.createVertexArray=="function")return;const e=i.getSupportedExtensions;i.getSupportedExtensions=function(){const a=e.call(this)||[];return a.indexOf("OES_vertex_array_object")<0&&a.push("OES_vertex_array_object"),a};const s=i.getExtension;i.getExtension=function(a){const d=s.call(this,a);return d||(a!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new OESVertexArrayObject(this)),this.__OESVertexArrayObject))}}const OES_element_index="OES_element_index",WEBGL_draw_buffers$1="WEBGL_draw_buffers",EXT_disjoint_timer_query$1="EXT_disjoint_timer_query",EXT_disjoint_timer_query_webgl2="EXT_disjoint_timer_query_webgl2",EXT_texture_filter_anisotropic$1="EXT_texture_filter_anisotropic",WEBGL_debug_renderer_info="WEBGL_debug_renderer_info",GL_FRAGMENT_SHADER_DERIVATIVE_HINT=35723,GL_DONT_CARE=4352,GL_GPU_DISJOINT_EXT$1=36795,GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,GL_UNMASKED_VENDOR_WEBGL=37445,GL_UNMASKED_RENDERER_WEBGL=37446,getWebGL2ValueOrZero=i=>isWebGL2$1(i)?void 0:0,WEBGL_PARAMETERS={[3074]:i=>isWebGL2$1(i)?void 0:36064,[GL_FRAGMENT_SHADER_DERIVATIVE_HINT]:i=>isWebGL2$1(i)?void 0:GL_DONT_CARE,[35977]:getWebGL2ValueOrZero,[32937]:getWebGL2ValueOrZero,[GL_GPU_DISJOINT_EXT$1]:(i,e)=>{const s=isWebGL2$1(i)?i.getExtension(EXT_disjoint_timer_query_webgl2):i.getExtension(EXT_disjoint_timer_query$1);return s&&s.GPU_DISJOINT_EXT?e(s.GPU_DISJOINT_EXT):0},[GL_UNMASKED_VENDOR_WEBGL]:(i,e)=>{const s=i.getExtension(WEBGL_debug_renderer_info);return e(s&&s.UNMASKED_VENDOR_WEBGL||7936)},[GL_UNMASKED_RENDERER_WEBGL]:(i,e)=>{const s=i.getExtension(WEBGL_debug_renderer_info);return e(s&&s.UNMASKED_RENDERER_WEBGL||7937)},[GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT]:(i,e)=>{const s=i.luma.extensions[EXT_texture_filter_anisotropic$1];return s?e(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:getWebGL2ValueOrZero,[35071]:getWebGL2ValueOrZero,[37447]:getWebGL2ValueOrZero,[36063]:(i,e)=>{if(!isWebGL2$1(i)){const s=i.getExtension(WEBGL_draw_buffers$1);return s?e(s.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:getWebGL2ValueOrZero,[35374]:getWebGL2ValueOrZero,[35377]:getWebGL2ValueOrZero,[34852]:i=>{if(!isWebGL2$1(i)){const e=i.getExtension(WEBGL_draw_buffers$1);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:i=>i.getExtension(OES_element_index)?2147483647:65535,[33001]:i=>i.getExtension(OES_element_index)?16777216:65535,[33e3]:i=>16777216,[37157]:getWebGL2ValueOrZero,[35373]:getWebGL2ValueOrZero,[35657]:getWebGL2ValueOrZero,[36183]:getWebGL2ValueOrZero,[37137]:getWebGL2ValueOrZero,[34045]:getWebGL2ValueOrZero,[35978]:getWebGL2ValueOrZero,[35979]:getWebGL2ValueOrZero,[35968]:getWebGL2ValueOrZero,[35376]:getWebGL2ValueOrZero,[35375]:getWebGL2ValueOrZero,[35659]:getWebGL2ValueOrZero,[37154]:getWebGL2ValueOrZero,[35371]:getWebGL2ValueOrZero,[35658]:getWebGL2ValueOrZero,[35076]:getWebGL2ValueOrZero,[35077]:getWebGL2ValueOrZero,[35380]:getWebGL2ValueOrZero};function getParameterPolyfill(i,e,s){const o=WEBGL_PARAMETERS[s],a=typeof o=="function"?o(i,e,s):o;return a!==void 0?a:e(s)}const OES_vertex_array_object="OES_vertex_array_object",ANGLE_instanced_arrays="ANGLE_instanced_arrays",WEBGL_draw_buffers="WEBGL_draw_buffers",EXT_disjoint_timer_query="EXT_disjoint_timer_query",EXT_texture_filter_anisotropic="EXT_texture_filter_anisotropic",ERR_VAO_NOT_SUPPORTED="VertexArray requires WebGL2 or OES_vertex_array_object extension";function getExtensionData(i,e){return{webgl2:isWebGL2$1(i),ext:i.getExtension(e)}}const WEBGL2_CONTEXT_POLYFILLS={[OES_vertex_array_object]:{meta:{suffix:"OES"},createVertexArray:()=>{assert$7(!1,ERR_VAO_NOT_SUPPORTED)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[ANGLE_instanced_arrays]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,e){assert$7(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[WEBGL_draw_buffers]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{assert$7(!1)}},[EXT_disjoint_timer_query]:{meta:{suffix:"EXT"},createQuery:()=>{assert$7(!1)},deleteQuery:()=>{assert$7(!1)},beginQuery:()=>{assert$7(!1)},endQuery:()=>{},getQuery(i,e){return this.getQueryObject(i,e)},getQueryParameter(i,e){return this.getQueryObject(i,e)},getQueryObject:()=>{}}},WEBGL2_CONTEXT_OVERRIDES={readBuffer:(i,e,s)=>{isWebGL2$1(i)&&e(s)},getVertexAttrib:(i,e,s,o)=>{const{webgl2:a,ext:d}=getExtensionData(i,ANGLE_instanced_arrays);let g;switch(o){case 35069:g=a?void 0:!1;break;case 35070:g=!a&&!d?0:void 0;break}return g!==void 0?g:e(s,o)},getProgramParameter:(i,e,s,o)=>{if(!isWebGL2$1(i))switch(o){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(s,o)},getInternalformatParameter:(i,e,s,o,a)=>{if(!isWebGL2$1(i))switch(a){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(s,o,a)},getTexParameter(i,e,s,o){switch(o){case 34046:const{extensions:a}=i.luma,d=a[EXT_texture_filter_anisotropic];o=d&&d.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(s,o)},getParameter:getParameterPolyfill,hint(i,e,s,o){return e(s,o)}};function polyfillContext(i){i.luma=i.luma||{};const{luma:e}=i;return e.polyfilled||(polyfillVertexArrayObject(i),initializeExtensions(i),installPolyfills(i,WEBGL2_CONTEXT_POLYFILLS),installOverrides(i,{target:e,target2:i}),e.polyfilled=!0),i}globalThis.polyfillContext=polyfillContext;function initializeExtensions(i){i.luma.extensions={};const e=i.getSupportedExtensions()||[];for(const s of e)i.luma[s]=i.getExtension(s)}function installOverrides(i,e){let{target:s,target2:o}=e;Object.keys(WEBGL2_CONTEXT_OVERRIDES).forEach(a=>{if(typeof WEBGL2_CONTEXT_OVERRIDES[a]=="function"){const d=i[a]?i[a].bind(i):()=>{},g=WEBGL2_CONTEXT_OVERRIDES[a].bind(null,i,d);s[a]=g,o[a]=g}})}function installPolyfills(i,e){for(const s of Object.getOwnPropertyNames(e))s!=="overrides"&&polyfillExtension(i,{extension:s,target:i.luma,target2:i})}function polyfillExtension(i,e){let{extension:s,target:o,target2:a}=e;const d=WEBGL2_CONTEXT_POLYFILLS[s];assert$7(d);const{meta:g={}}=d,{suffix:_=""}=g,j=i.getExtension(s);for(const _e of Object.keys(d)){const et="".concat(_e).concat(_);let tt=null;_e==="meta"||typeof i[_e]=="function"||(j&&typeof j[et]=="function"?tt=function(){return j[et](...arguments)}:typeof d[_e]=="function"&&(tt=d[_e].bind(o))),tt&&(o[_e]=tt,a[_e]=tt)}}const GL_PARAMETER_DEFAULTS={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},enable=(i,e,s)=>e?i.enable(s):i.disable(s),hint=(i,e,s)=>i.hint(s,e),pixelStorei=(i,e,s)=>i.pixelStorei(s,e),drawFramebuffer=(i,e)=>{const s=isWebGL2$1(i)?36009:36160;return i.bindFramebuffer(s,e)},readFramebuffer=(i,e)=>i.bindFramebuffer(36008,e);function isArray$2(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const GL_PARAMETER_SETTERS={[3042]:enable,[32773]:(i,e)=>i.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(i,e)=>i.clearColor(...e),[3107]:(i,e)=>i.colorMask(...e),[2884]:enable,[2885]:(i,e)=>i.cullFace(e),[2929]:enable,[2931]:(i,e)=>i.clearDepth(e),[2932]:(i,e)=>i.depthFunc(e),[2928]:(i,e)=>i.depthRange(...e),[2930]:(i,e)=>i.depthMask(e),[3024]:enable,[35723]:hint,[36006]:drawFramebuffer,[2886]:(i,e)=>i.frontFace(e),[33170]:hint,[2849]:(i,e)=>i.lineWidth(e),[32823]:enable,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:enable,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:enable,[3088]:(i,e)=>i.scissor(...e),[2960]:enable,[2961]:(i,e)=>i.clearStencil(e),[2968]:(i,e)=>i.stencilMaskSeparate(1028,e),[36005]:(i,e)=>i.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(i,e)=>i.viewport(...e),[3333]:pixelStorei,[3317]:pixelStorei,[37440]:pixelStorei,[37441]:pixelStorei,[37443]:pixelStorei,[3330]:pixelStorei,[3332]:pixelStorei,[3331]:pixelStorei,[36010]:readFramebuffer,[3314]:pixelStorei,[32878]:pixelStorei,[3316]:pixelStorei,[3315]:pixelStorei,[32877]:pixelStorei,framebuffer:(i,e)=>{const s=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,s)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{e=isArray$2(e)?e:[e,e],i.blendEquationSeparate(...e)},blendFunc:(i,e)=>{e=isArray$2(e)&&e.length===2?[...e,...e]:e,i.blendFuncSeparate(...e)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(...e),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=isArray$2(e)?e:[e,e];const[s,o]=e;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,o)},stencilFunc:(i,e)=>{e=isArray$2(e)&&e.length===3?[...e,...e]:e;const[s,o,a,d,g,_]=e;i.stencilFuncSeparate(1028,s,o,a),i.stencilFuncSeparate(1029,d,g,_)},stencilOp:(i,e)=>{e=isArray$2(e)&&e.length===3?[...e,...e]:e;const[s,o,a,d,g,_]=e;i.stencilOpSeparate(1028,s,o,a),i.stencilOpSeparate(1029,d,g,_)},viewport:(i,e)=>i.viewport(...e)};function getValue(i,e,s){return e[i]!==void 0?e[i]:s[i]}const GL_COMPOSITE_PARAMETER_SETTERS={blendEquation:(i,e,s)=>i.blendEquationSeparate(getValue(32777,e,s),getValue(34877,e,s)),blendFunc:(i,e,s)=>i.blendFuncSeparate(getValue(32969,e,s),getValue(32968,e,s),getValue(32971,e,s),getValue(32970,e,s)),polygonOffset:(i,e,s)=>i.polygonOffset(getValue(32824,e,s),getValue(10752,e,s)),sampleCoverage:(i,e,s)=>i.sampleCoverage(getValue(32938,e,s),getValue(32939,e,s)),stencilFuncFront:(i,e,s)=>i.stencilFuncSeparate(1028,getValue(2962,e,s),getValue(2967,e,s),getValue(2963,e,s)),stencilFuncBack:(i,e,s)=>i.stencilFuncSeparate(1029,getValue(34816,e,s),getValue(36003,e,s),getValue(36004,e,s)),stencilOpFront:(i,e,s)=>i.stencilOpSeparate(1028,getValue(2964,e,s),getValue(2965,e,s),getValue(2966,e,s)),stencilOpBack:(i,e,s)=>i.stencilOpSeparate(1029,getValue(34817,e,s),getValue(34818,e,s),getValue(34819,e,s))},GL_HOOKED_SETTERS={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,s)=>i({[e]:s}),hint:(i,e,s)=>i({[e]:s}),bindFramebuffer:(i,e,s)=>{switch(e){case 36160:return i({[36006]:s,[36010]:s});case 36009:return i({[36006]:s});case 36008:return i({[36010]:s});default:return null}},blendColor:(i,e,s,o,a)=>i({[32773]:new Float32Array([e,s,o,a])}),blendEquation:(i,e)=>i({[32777]:e,[34877]:e}),blendEquationSeparate:(i,e,s)=>i({[32777]:e,[34877]:s}),blendFunc:(i,e,s)=>i({[32969]:e,[32968]:s,[32971]:e,[32970]:s}),blendFuncSeparate:(i,e,s,o,a)=>i({[32969]:e,[32968]:s,[32971]:o,[32970]:a}),clearColor:(i,e,s,o,a)=>i({[3106]:new Float32Array([e,s,o,a])}),clearDepth:(i,e)=>i({[2931]:e}),clearStencil:(i,e)=>i({[2961]:e}),colorMask:(i,e,s,o,a)=>i({[3107]:[e,s,o,a]}),cullFace:(i,e)=>i({[2885]:e}),depthFunc:(i,e)=>i({[2932]:e}),depthRange:(i,e,s)=>i({[2928]:new Float32Array([e,s])}),depthMask:(i,e)=>i({[2930]:e}),frontFace:(i,e)=>i({[2886]:e}),lineWidth:(i,e)=>i({[2849]:e}),polygonOffset:(i,e,s)=>i({[32824]:e,[10752]:s}),sampleCoverage:(i,e,s)=>i({[32938]:e,[32939]:s}),scissor:(i,e,s,o,a)=>i({[3088]:new Int32Array([e,s,o,a])}),stencilMask:(i,e)=>i({[2968]:e,[36005]:e}),stencilMaskSeparate:(i,e,s)=>i({[e===1028?2968:36005]:s}),stencilFunc:(i,e,s,o)=>i({[2962]:e,[2967]:s,[2963]:o,[34816]:e,[36003]:s,[36004]:o}),stencilFuncSeparate:(i,e,s,o,a)=>i({[e===1028?2962:34816]:s,[e===1028?2967:36003]:o,[e===1028?2963:36004]:a}),stencilOp:(i,e,s,o)=>i({[2964]:e,[2965]:s,[2966]:o,[34817]:e,[34818]:s,[34819]:o}),stencilOpSeparate:(i,e,s,o,a)=>i({[e===1028?2964:34817]:s,[e===1028?2965:34818]:o,[e===1028?2966:34819]:a}),viewport:(i,e,s,o,a)=>i({[2978]:[e,s,o,a]})},isEnabled=(i,e)=>i.isEnabled(e),GL_PARAMETER_GETTERS={[3042]:isEnabled,[2884]:isEnabled,[2929]:isEnabled,[3024]:isEnabled,[32823]:isEnabled,[32926]:isEnabled,[32928]:isEnabled,[3089]:isEnabled,[2960]:isEnabled,[35977]:isEnabled};function isObjectEmpty$1(i){for(const e in i)return!1;return!0}function deepArrayEqual(i,e){if(i===e)return!0;const s=Array.isArray(i)||ArrayBuffer.isView(i),o=Array.isArray(e)||ArrayBuffer.isView(e);if(s&&o&&i.length===e.length){for(let a=0;a<i.length;++a)if(i[a]!==e[a])return!1;return!0}return!1}function installGetterOverride(i,e){const s=i[e].bind(i);i[e]=function(){const a=arguments.length<=0?void 0:arguments[0];return a in i.state.cache?i.state.enable?i.state.cache[a]:s(...arguments):s(...arguments)},Object.defineProperty(i[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function installSetterSpy(i,e,s){const o=i[e].bind(i);i[e]=function(){for(var d=arguments.length,g=new Array(d),_=0;_<d;_++)g[_]=arguments[_];const{valueChanged:j,oldValue:_e}=s(i.state._updateCache,...g);return j&&o(...g),_e},Object.defineProperty(i[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function installProgramSpy(i){const e=i.useProgram.bind(i);i.useProgram=function(o){i.state.program!==o&&(e(o),i.state.program=o)}}class GLState{constructor(e){let{copyState:s=!1,log:o=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=s?getParameters(e):Object.assign({},GL_PARAMETER_DEFAULTS),this.log=o,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){assert$7(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];setParameters(this.gl,e),this.stateStack.pop()}_updateCache(e){let s=!1,o;const a=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const d in e){assert$7(d!==void 0);const g=e[d],_=this.cache[d];deepArrayEqual(g,_)||(s=!0,o=_,a&&!(d in a)&&(a[d]=_),this.cache[d]=g)}return{valueChanged:s,oldValue:o}}}function trackContextState(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:s=!0,copyState:o}=e;if(assert$7(o!==void 0),!i.state){const{polyfillContext:a}=globalThis;a&&a(i),i.state=new GLState(i,{copyState:o}),installProgramSpy(i);for(const d in GL_HOOKED_SETTERS){const g=GL_HOOKED_SETTERS[d];installSetterSpy(i,d,g)}installGetterOverride(i,"getParameter"),installGetterOverride(i,"isEnabled")}return i.state.enable=s,i}function pushContextState(i){i.state||trackContextState(i,{copyState:!1}),i.state.push()}function popContextState(i){assert$7(i.state),i.state.pop()}function setParameters(i,e){if(assert$7(isWebGL(i),"setParameters requires a WebGL context"),isObjectEmpty$1(e))return;const s={};for(const a in e){const d=Number(a),g=GL_PARAMETER_SETTERS[a];g&&(typeof g=="string"?s[g]=!0:g(i,e[a],d))}const o=i.state&&i.state.cache;if(o)for(const a in s){const d=GL_COMPOSITE_PARAMETER_SETTERS[a];d(i,e,o)}}function getParameters(i,e){if(e=e||GL_PARAMETER_DEFAULTS,typeof e=="number"){const a=e,d=GL_PARAMETER_GETTERS[a];return d?d(i,a):i.getParameter(a)}const s=Array.isArray(e)?e:Object.keys(e),o={};for(const a of s){const d=GL_PARAMETER_GETTERS[a];o[a]=d?d(i,Number(a)):i.getParameter(Number(a))}return o}function resetParameters(i){setParameters(i,GL_PARAMETER_DEFAULTS)}function withParameters(i,e,s){if(isObjectEmpty$1(e))return s(i);const{nocatch:o=!0}=e;pushContextState(i),setParameters(i,e);let a;if(o)a=s(i),popContextState(i);else try{a=s(i)}finally{popContextState(i)}return a}function cssToDeviceRatio(i){const{luma:e}=i;if(i.canvas&&e){const{clientWidth:s}=e.canvasSizeInfo;return s?i.drawingBufferWidth/s:1}return 1}function cssToDevicePixels(i,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const o=cssToDeviceRatio(i),a=i.drawingBufferWidth,d=i.drawingBufferHeight;return scalePixels$1(e,o,a,d,s)}function getDevicePixelRatio(i){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?e:1}function scalePixels$1(i,e,s,o,a){const d=scaleX(i[0],e,s);let g=scaleY(i[1],e,o,a),_=scaleX(i[0]+1,e,s);const j=_===s-1?_:_-1;_=scaleY(i[1]+1,e,o,a);let _e;return a?(_=_===0?_:_+1,_e=g,g=_):_e=_===o-1?_:_-1,{x:d,y:g,width:Math.max(j-d+1,1),height:Math.max(_e-g+1,1)}}function scaleX(i,e,s){return Math.min(Math.round(i*e),s-1)}function scaleY(i,e,s,o){return o?Math.max(0,s-1-Math.round(i*e)):Math.min(Math.round(i*e),s-1)}const isBrowser$2=isBrowser$3(),isPage$1=isBrowser$2&&typeof document<"u",CONTEXT_DEFAULTS={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function createGLContext(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};assert$7(isBrowser$2,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},CONTEXT_DEFAULTS,i);const{width:e,height:s}=i;function o(_){if(i.throwOnError)throw new Error(_);return console.error(_),null}i.onError=o;let a;const{canvas:d}=i,g=getCanvas({canvas:d,width:e,height:s,onError:o});return a=createBrowserContext(g,i),a?(a=instrumentGLContext(a,i),logInfo(a),a):null}function instrumentGLContext(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||getVersion(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},e=Object.assign({},CONTEXT_DEFAULTS,e);const{manageState:s,debug:o}=e;return s&&trackContextState(i,{copyState:!1,log:function(){for(var a=arguments.length,d=new Array(a),g=0;g<a;g++)d[g]=arguments[g];return log$3.log(1,...d)()}}),isBrowser$2&&o&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,e),log$3.level=Math.max(log$3.level,1)):log$3.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function getContextDebugInfo(i){const e=i.getParameter(7936),s=i.getParameter(7937),o=i.getExtension("WEBGL_debug_renderer_info"),a=o&&i.getParameter(o.UNMASKED_VENDOR_WEBGL||7936),d=o&&i.getParameter(o.UNMASKED_RENDERER_WEBGL||7937);return{vendor:a||e,renderer:d||s,vendorMasked:e,rendererMasked:s,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function resizeGLContext(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const o=getDevicePixelRatio(e.useDevicePixels);setDevicePixelRatio(i,o,e);return}const s=i.getExtension("STACKGL_resize_drawingbuffer");s&&"width"in e&&"height"in e&&s.resize(e.width,e.height)}function createBrowserContext(i,e){const{onError:s}=e;let o=null;const a=j=>o=j.statusMessage||o;i.addEventListener("webglcontextcreationerror",a,!1);const{webgl1:d=!0,webgl2:g=!0}=e;let _=null;return g&&(_=_||i.getContext("webgl2",e),_=_||i.getContext("experimental-webgl2",e)),d&&(_=_||i.getContext("webgl",e),_=_||i.getContext("experimental-webgl",e)),i.removeEventListener("webglcontextcreationerror",a,!1),_?(e.onContextLost&&i.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&i.addEventListener("webglcontextrestored",e.onContextRestored,!1),_):s("Failed to create ".concat(g&&!d?"WebGL2":"WebGL"," context: ").concat(o||"Unknown error"))}function getCanvas(i){let{canvas:e,width:s=800,height:o=600,onError:a}=i,d;return typeof e=="string"?(isPage$1&&document.readyState==="complete"||a("createGLContext called on canvas '".concat(e,"' before page was loaded")),d=document.getElementById(e)):e?d=e:(d=document.createElement("canvas"),d.id="lumagl-canvas",d.style.width=Number.isFinite(s)?"".concat(s,"px"):"100%",d.style.height=Number.isFinite(o)?"".concat(o,"px"):"100%",document.body.insertBefore(d,document.body.firstChild)),d}function logInfo(i){const e=isWebGL2$1(i)?"WebGL2":"WebGL1",s=getContextDebugInfo(i),o=s?"(".concat(s.vendor,",").concat(s.renderer,")"):"",a=i.debug?" debug":"";log$3.info(1,"".concat(e).concat(a," context ").concat(o))()}function getVersion(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function setDevicePixelRatio(i,e,s){let o="width"in s?s.width:i.canvas.clientWidth,a="height"in s?s.height:i.canvas.clientHeight;(!o||!a)&&(log$3.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,o=i.canvas.width||1,a=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const d=i.luma.canvasSizeInfo;if(d.clientWidth!==o||d.clientHeight!==a||d.devicePixelRatio!==e){let g=e;const _=Math.floor(o*g),j=Math.floor(a*g);i.canvas.width=_,i.canvas.height=j,(i.drawingBufferWidth!==_||i.drawingBufferHeight!==j)&&(log$3.warn("Device pixel ratio clamped")(),g=Math.min(i.drawingBufferWidth/o,i.drawingBufferHeight/a),i.canvas.width=Math.floor(o*g),i.canvas.height=Math.floor(a*g)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:o,clientHeight:a,devicePixelRatio:e})}}function getHiResTimestamp(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class Stat{constructor(e,s){_defineProperty(this,"name",void 0),_defineProperty(this,"type",void 0),_defineProperty(this,"sampleSize",1),_defineProperty(this,"time",void 0),_defineProperty(this,"count",void 0),_defineProperty(this,"samples",void 0),_defineProperty(this,"lastTiming",void 0),_defineProperty(this,"lastSampleTime",void 0),_defineProperty(this,"lastSampleCount",void 0),_defineProperty(this,"_count",0),_defineProperty(this,"_time",0),_defineProperty(this,"_samples",0),_defineProperty(this,"_startTime",0),_defineProperty(this,"_timerPending",!1),this.name=e,this.type=s,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=getHiResTimestamp(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(getHiResTimestamp()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Stats{constructor(e){_defineProperty(this,"id",void 0),_defineProperty(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:s})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const s in this.stats)e(this.stats[s])}getTable(){const e={};return this.forEach(s=>{e[s.name]={time:s.time||0,count:s.count||0,average:s.getAverageTime()||0,hz:s.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(s=>this._getOrCreate(s))}_getOrCreate(e){if(!e||!e.name)return null;const{name:s,type:o}=e;return this.stats[s]||(e instanceof Stat?this.stats[s]=e:this.stats[s]=new Stat(s,o)),this.stats[s]}}const VERSION$2="8.5.16",STARTUP_MESSAGE="set luma.log.level=1 (or higher) to trace rendering";class StatsManager{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Stats({id:e})),this.stats.get(e)}}const lumaStats=new StatsManager;if(globalThis.luma&&globalThis.luma.VERSION!==VERSION$2)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(VERSION$2));globalThis.luma||(isBrowser$3()&&log$3.log(1,"luma.gl ".concat(VERSION$2," - ").concat(STARTUP_MESSAGE))(),globalThis.luma=globalThis.luma||{VERSION:VERSION$2,version:VERSION$2,log:log$3,stats:lumaStats,globals:{modules:{},nodeIO:{}}});function requestAnimationFrame$1(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function cancelAnimationFrame$1(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function assert$6(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}function getKeyValue(i,e){if(typeof e!="string")return e;const s=Number(e);if(!isNaN(s))return s;e=e.replace(/^.*\./,"");const o=i[e];return assert$6(o!==void 0,"Accessing undefined constant GL.".concat(e)),o}function getKey(i,e){e=Number(e);for(const s in i)if(i[s]===e)return"GL.".concat(s);return String(e)}const uidCounters={};function uid(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";uidCounters[i]=uidCounters[i]||1;const e=uidCounters[i]++;return"".concat(i,"-").concat(e)}function isPowerOfTwo(i){return assert$6(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function isObjectEmpty(i){let e=!0;for(const s in i){e=!1;break}return e}function stubRemovedMethods(i,e,s,o){const a="See luma.gl ".concat(s," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),d=Object.getPrototypeOf(i);o.forEach(g=>{d.methodName||(d[g]=()=>{throw log$3.removed("Calling removed method ".concat(e,".").concat(g,": "),a)(),new Error(g)})})}const ERR_RESOURCE_METHOD_UNDEFINED="Resource subclass must define virtual methods";let Resource$1=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};assertWebGLContext(e);const{id:o,userData:a={}}=s;this.gl=e,this.gl2=e,this.id=o||uid(this[Symbol.toStringTag]),this.userData=a,this._bound=!1,this._handle=s.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._initStats(),this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,s&&e&&s.filter(Boolean).forEach(o=>o.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let s;return this._bound?s=e():(this._bindHandle(this.handle),this._bound=!0,s=e(),this._bound=!1,this._bindHandle(null)),s}unbind(){this.bind(null)}getParameter(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=getKeyValue(this.gl,e),assert$6(e);const a=(this.constructor.PARAMETERS||{})[e];if(a){const d=isWebGL2$1(this.gl);if(!((!("webgl2"in a)||d)&&(!("extension"in a)||this.gl.getExtension(a.extension)))){const _=a.webgl1,j="webgl2"in a?a.webgl2:a.webgl1;return d?j:_}}return this._getParameter(e,s)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:s,keys:o}=e,a=this.constructor.PARAMETERS||{},d=isWebGL2$1(this.gl),g={},_=s||Object.keys(a);for(const j of _){const _e=a[j];if(_e&&(!("webgl2"in _e)||d)&&(!("extension"in _e)||this.gl.getExtension(_e.extension))){const tt=o?getKey(this.gl,j):j;g[tt]=this.getParameter(j,e),o&&_e.type==="GLenum"&&(g[tt]=getKey(this.gl,g[tt]))}}return g}setParameter(e,s){e=getKeyValue(this.gl,e),assert$6(e);const a=(this.constructor.PARAMETERS||{})[e];if(a){const d=isWebGL2$1(this.gl);if(!((!("webgl2"in a)||d)&&(!("extension"in a)||this.gl.getExtension(a.extension))))throw new Error("Parameter not available on this platform");a.type==="GLenum"&&(s=getKeyValue(s))}return this._setParameter(e,s),this}setParameters(e){for(const s in e)this.setParameter(s,e[s]);return this}stubRemovedMethods(e,s,o){return stubRemovedMethods(this,e,s,o)}initialize(e){}_createHandle(){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_deleteHandle(){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_bindHandle(e){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_getOptsFromHandle(){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_getParameter(e,s){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_setParameter(e,s){throw new Error(ERR_RESOURCE_METHOD_UNDEFINED)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_initStats(){this.gl.stats=this.gl.stats||new StatsManager}_addStats(){const e=this[Symbol.toStringTag],s=lumaStats.get("Resource Counts");s.get("Resources Created").incrementCount(),s.get("".concat(e,"s Created")).incrementCount(),s.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];lumaStats.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._doTrackAllocatedMemory(e,s),this._doTrackAllocatedMemory(e,s,this.gl.stats.get("Memory Usage"))}_doTrackAllocatedMemory(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:lumaStats.get("Memory Usage");o.get("GPU Memory").addCount(e),o.get("".concat(s," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._doTrackDeallocatedMemory(e),this._doTrackDeallocatedMemory(e,this.gl.stats.get("Memory Usage"))}_doTrackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:lumaStats.get("Memory Usage");s.get("GPU Memory").subtractCount(this.byteLength),s.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}};const ERR_TYPE_DEDUCTION="Failed to deduce GL constant from typed array";function getGLTypeFromTypedArray(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ERR_TYPE_DEDUCTION)}}function getTypedArrayFromGLType(i){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function flipRows(i){let{data:e,width:s,height:o,bytesPerPixel:a=4,temp:d}=i;const g=s*a;d=d||new Uint8Array(g);for(let _=0;_<o/2;++_){const j=_*g,_e=(o-_-1)*g;d.set(e.subarray(j,j+g)),e.copyWithin(j,_e,_e+g),e.set(d,_e)}}function scalePixels(i){let{data:e,width:s,height:o}=i;const a=Math.round(s/2),d=Math.round(o/2),g=new Uint8Array(a*d*4);for(let _=0;_<d;_++)for(let j=0;j<a;j++)for(let _e=0;_e<4;_e++)g[(_*a+j)*4+_e]=e[(_*2*s+j*2)*4+_e];return{data:g,width:a,height:d}}function checkProps(i,e,s){const{removedProps:o={},deprecatedProps:a={},replacedProps:d={}}=s;for(const _ in o)if(_ in e){const _e=o[_]?"".concat(i,".").concat(o[_]):"N/A";log$3.removed("".concat(i,".").concat(_),_e)()}for(const _ in a)if(_ in e){const j=a[_];log$3.deprecated("".concat(i,".").concat(_),"".concat(i,".").concat(j))()}let g=null;for(const _ in d)if(_ in e){const j=d[_];log$3.deprecated("".concat(i,".").concat(_),"".concat(i,".").concat(j))(),g=g||Object.assign({},e),g[j]=e[_],delete g[_]}return g||e}const DEFAULT_ACCESSOR_VALUES={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},PROP_CHECKS={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Accessor{static getBytesPerElement(e){return getTypedArrayFromGLType(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return assert$6(e.size),getTypedArrayFromGLType(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];return new Accessor(DEFAULT_ACCESSOR_VALUES,...s)}constructor(){for(var e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];s.forEach(a=>this._assign(a)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Accessor.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Accessor.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=checkProps("Accessor",e,PROP_CHECKS),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const DEBUG_DATA_LENGTH=10,DEPRECATED_PROPS={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},PROP_CHECKS_INITIALIZE={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:DEPRECATED_PROPS},PROP_CHECKS_SET_PROPS={removedProps:DEPRECATED_PROPS};class Buffer extends Resource$1{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,s),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=s.target||(this.gl.webgl2?36662:34962),this.initialize(s),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Accessor.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Accessor.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=checkProps("Buffer",e,PROP_CHECKS_INITIALIZE),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=checkProps("Buffer",e,PROP_CHECKS_SET_PROPS),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Accessor(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:s,offset:o=0,srcOffset:a=0}=e,d=e.byteLength||e.length;assert$6(s);const g=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(g,this.handle),a!==0||d!==void 0?(assertWebGL2Context(this.gl),this.gl.bufferSubData(this.target,o,s,a,d)):this.gl.bufferSubData(g,o,s),this.gl.bindBuffer(g,null),this.debugData=null,this._inferType(s),this}copyData(e){let{sourceBuffer:s,readOffset:o=0,writeOffset:a=0,size:d}=e;const{gl:g}=this;return assertWebGL2Context(g),g.bindBuffer(36662,s.handle),g.bindBuffer(36663,this.handle),g.copyBufferSubData(36662,36663,o,a,d),g.bindBuffer(36662,null),g.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:s=0,dstOffset:o=0,length:a=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};assertWebGL2Context(this.gl);const d=getTypedArrayFromGLType(this.accessor.type||5126,{clamped:!1}),g=this._getAvailableElementCount(s),_=o;let j,_e;e?(_e=e.length,j=_e-_):(j=Math.min(g,a||g),_e=_+j);const et=Math.min(g,j);return a=a||et,assert$6(a<=et),e=e||new d(_e),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,s,e,o,a),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:s=this.accessor&&this.accessor.index,offset:o=0,size:a}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?a!==void 0?this.gl.bindBufferRange(e,s,this.handle,o,a):(assert$6(o===0),this.gl.bindBufferBase(e,s,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:s=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,s,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(DEBUG_DATA_LENGTH,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+s;assert$6(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const a=this._getTarget();this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,o,this.usage),this.gl.bufferSubData(a,s,e),this.gl.bindBuffer(a,null),this.debugData=e.slice(0,DEBUG_DATA_LENGTH),this.bytesUsed=o,this._trackAllocatedMemory(o);const d=getGLTypeFromTypedArray(e);return assert$6(d),this.setAccessor(new Accessor(this.accessor,{type:d})),this}_setByteLength(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;assert$6(e>=0),this._trackDeallocatedMemory();let o=e;e===0&&(o=new Float32Array(0));const a=this._getTarget();return this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,o,s),this.gl.bindBuffer(a,null),this.usage=s,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const s=getTypedArrayFromGLType(this.accessor.type||5126,{clamped:!1}),o=e/s.BYTES_PER_ELEMENT;return this.getElementCount()-o}_inferType(e){this.accessor.type||this.setAccessor(new Accessor(this.accessor,{type:getGLTypeFromTypedArray(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const s=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),s}get type(){return log$3.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return log$3.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return log$3.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return log$3.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Accessor(this.accessor,e),this}}const TEXTURE_FORMATS={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},DATA_FORMAT_CHANNELS={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},TYPE_SIZES={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function isFormatSupported$1(i,e){const s=TEXTURE_FORMATS[e];if(!s)return!1;if(s.gl1===void 0&&s.gl2===void 0)return!0;const o=isWebGL2$1(i)&&s.gl2||s.gl1;return typeof o=="string"?i.getExtension(o):o}function isLinearFilteringSupported(i,e){const s=TEXTURE_FORMATS[e];switch(s&&s.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const NPOT_MIN_FILTERS=[9729,9728],WebGLBuffer=globalThis.WebGLBuffer||function i(){};class Texture extends Resource$1{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:o,linearFiltering:a}=s;let d=!0;return o&&(d=d&&isFormatSupported$1(e,o),d=d&&(!a||isLinearFilteringSupported(e,o))),d}constructor(e,s){const{id:o=uid("texture"),handle:a,target:d}=s;super(e,{id:o,handle:a}),this.target=d,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=e.data;if(s instanceof Promise)return s.then(pt=>this.initialize(Object.assign({},e,{pixels:pt,data:pt}))),this;const o=typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement;if(o&&s.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,s.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:a=null,format:d=6408,border:g=0,recreate:_=!1,parameters:j={},pixelStore:_e={},textureUnit:et=void 0}=e;s||(s=a);let{width:tt,height:rt,dataFormat:it,type:ot,compressed:ct=!1,mipmaps:ft=!0}=e;const{depth:dt=0}=e;return{width:tt,height:rt,compressed:ct,dataFormat:it,type:ot}=this._deduceParameters({format:d,type:ot,dataFormat:it,compressed:ct,data:s,width:tt,height:rt}),this.width=tt,this.height=rt,this.depth=dt,this.format=d,this.type=ot,this.dataFormat=it,this.border=g,this.textureUnit=et,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ft&&this._isNPOT()&&(log$3.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ft=!1,this._updateForNPOT(j)),this.mipmaps=ft,this.setImageData({data:s,width:tt,height:rt,depth:dt,format:d,type:ot,dataFormat:it,border:g,mipmaps:ft,parameters:_e,compressed:ct}),ft&&this.generateMipmap(),this.setParameters(j),_&&(this.data=s),o&&(this._video={video:s,parameters:j,lastTime:s.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?s.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:s,lastTime:o}=this._video;if(o===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:s}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:s,width:o,mipmaps:a=!1}=e;return o!==this.width||s!==this.height?this.initialize({width:o,height:s,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:a}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(log$3.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),withParameters(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:s=this.target,pixels:o=null,level:a=0,format:d=this.format,border:g=this.border,offset:_=0,parameters:j={}}=e;let{data:_e=null,type:et=this.type,width:tt=this.width,height:rt=this.height,dataFormat:it=this.dataFormat,compressed:ot=!1}=e;_e||(_e=o),{type:et,dataFormat:it,compressed:ot,width:tt,height:rt}=this._deduceParameters({format:d,type:et,dataFormat:it,compressed:ot,data:_e,width:tt,height:rt});const{gl:ct}=this;ct.bindTexture(this.target,this.handle);let ft=null;({data:_e,dataType:ft}=this._getDataType({data:_e,compressed:ot}));let dt,pt=0;if(withParameters(this.gl,j,()=>{switch(ft){case"null":ct.texImage2D(s,a,d,tt,rt,g,it,et,_e);break;case"typed-array":ct.texImage2D(s,a,d,tt,rt,g,it,et,_e,_);break;case"buffer":dt=assertWebGL2Context(ct),dt.bindBuffer(35052,_e.handle||_e),dt.texImage2D(s,a,d,tt,rt,g,it,et,_),dt.bindBuffer(35052,null);break;case"browser-object":isWebGL2$1(ct)?ct.texImage2D(s,a,d,tt,rt,g,it,et,_e):ct.texImage2D(s,a,d,it,et,_e);break;case"compressed":for(const[gt,Ct]of _e.entries())ct.compressedTexImage2D(s,gt,Ct.format,Ct.width,Ct.height,g,Ct.data),pt+=Ct.levelSize;break;default:assert$6(!1,"Unknown image data type")}}),ft==="compressed")this._trackAllocatedMemory(pt,"Texture");else if(_e&&_e.byteLength)this._trackAllocatedMemory(_e.byteLength,"Texture");else{const gt=DATA_FORMAT_CHANNELS[this.dataFormat]||4,Ct=TYPE_SIZES[this.type]||1;this._trackAllocatedMemory(this.width*this.height*gt*Ct,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:s=this.target,pixels:o=null,data:a=null,x:d=0,y:g=0,width:_=this.width,height:j=this.height,level:_e=0,format:et=this.format,type:tt=this.type,dataFormat:rt=this.dataFormat,compressed:it=!1,offset:ot=0,border:ct=this.border,parameters:ft={}}=e;if({type:tt,dataFormat:rt,compressed:it,width:_,height:j}=this._deduceParameters({format:et,type:tt,dataFormat:rt,compressed:it,data:a,width:_,height:j}),assert$6(this.depth===0,"texSubImage not supported for 3D textures"),a||(a=o),a&&a.data){const dt=a;a=dt.data,_=dt.shape[0],j=dt.shape[1]}a instanceof Buffer&&(a=a.handle),this.gl.bindTexture(this.target,this.handle),withParameters(this.gl,ft,()=>{if(it)this.gl.compressedTexSubImage2D(s,_e,d,g,_,j,et,a);else if(a===null)this.gl.texSubImage2D(s,_e,d,g,_,j,rt,tt,null);else if(ArrayBuffer.isView(a))this.gl.texSubImage2D(s,_e,d,g,_,j,rt,tt,a,ot);else if(a instanceof WebGLBuffer){const dt=assertWebGL2Context(this.gl);dt.bindBuffer(35052,a),dt.texSubImage2D(s,_e,d,g,_,j,rt,tt,ot),dt.bindBuffer(35052,null)}else isWebGL2$1(this.gl)?assertWebGL2Context(this.gl).texSubImage2D(s,_e,d,g,_,j,rt,tt,a):this.gl.texSubImage2D(s,_e,d,g,rt,tt,a)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return log$3.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:s}=this;return e!==void 0&&(this.textureUnit=e,s.activeTexture(33984+e)),s.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:s}=this;return e!==void 0&&(this.textureUnit=e,s.activeTexture(33984+e)),s.bindTexture(this.target,null),e}_getDataType(e){let{data:s,compressed:o=!1}=e;return o?{data:s,dataType:"compressed"}:s===null?{data:s,dataType:"null"}:ArrayBuffer.isView(s)?{data:s,dataType:"typed-array"}:s instanceof Buffer?{data:s.handle,dataType:"buffer"}:s instanceof WebGLBuffer?{data:s,dataType:"buffer"}:{data:s,dataType:"browser-object"}}_deduceParameters(e){const{format:s,data:o}=e;let{width:a,height:d,dataFormat:g,type:_,compressed:j}=e;const _e=TEXTURE_FORMATS[s];return g=g||_e&&_e.dataFormat,_=_||_e&&_e.types[0],j=j||_e&&_e.compressed,{width:a,height:d}=this._deduceImageSize(o,a,d),{dataFormat:g,type:_,compressed:j,width:a,height:d,format:s,data:o}}_deduceImageSize(e,s,o){let a;return typeof ImageData<"u"&&e instanceof ImageData?a={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?a={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?a={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?a={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?a={width:e.videoWidth,height:e.videoHeight}:e?a={width:s,height:o}:a={width:s>=0?s:1,height:o>=0?o:1},assert$6(a,"Could not deduced texture size"),assert$6(s===void 0||a.width===s,"Deduced texture width does not match supplied width"),assert$6(o===void 0||a.height===o,"Deduced texture height does not match supplied height"),a}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const s=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),s}}_setParameter(e,s){switch(this.gl.bindTexture(this.target,this.handle),s=this._getNPOTParam(e,s),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,s);break;case 4096:case 4097:assert$6(!1);break;default:this.gl.texParameteri(this.target,e,s);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return isWebGL2$1(this.gl)||!this.width||!this.height?!1:!isPowerOfTwo(this.width)||!isPowerOfTwo(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,s){if(this._isNPOT())switch(e){case 10241:NPOT_MIN_FILTERS.indexOf(s)===-1&&(s=9729);break;case 10242:case 10243:s!==33071&&(s=33071);break}return s}}let pathPrefix$1="";function loadImage(i,e){return assert$6(typeof i=="string"),i=pathPrefix$1+i,new Promise((s,o)=>{try{const a=new Image;a.onload=()=>s(a),a.onerror=()=>o(new Error("Could not load image ".concat(i,"."))),a.crossOrigin=e&&e.crossOrigin||"anonymous",a.src=i}catch(a){o(a)}})}class Texture2D extends Texture{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,s){return Texture.isSupported(e,s)}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};assertWebGLContext(e),(s instanceof Promise||typeof s=="string")&&(s={data:s}),typeof s.data=="string"&&(s=Object.assign({},s,{data:loadImage(s.data)})),super(e,Object.assign({},s,{target:3553})),this.initialize(s),Object.seal(this)}}const FACES=[34069,34070,34071,34072,34073,34074];class TextureCube extends Texture{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};assertWebGLContext(e),super(e,Object.assign({},s,{target:34067})),this.initialize(s),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:s=!0,parameters:o={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,s&&this.generateMipmap(e),this.setParameters(o)}),this}subImage(e){let{face:s,data:o,x:a=0,y:d=0,mipmapLevel:g=0}=e;return this._subImage({target:s,data:o,x:a,y:d,mipmapLevel:g})}async setCubeMapImageData(e){let{width:s,height:o,pixels:a,data:d,border:g=0,format:_=6408,type:j=5121}=e;const{gl:_e}=this,et=a||d,tt=await Promise.all(FACES.map(rt=>{const it=et[rt];return Promise.all(Array.isArray(it)?it:[it])}));this.bind(),FACES.forEach((rt,it)=>{tt[it].length>1&&this.opts.mipmaps!==!1&&log$3.warn("".concat(this.id," has mipmap and multiple LODs."))(),tt[it].forEach((ot,ct)=>{s&&o?_e.texImage2D(rt,ct,_,s,o,g,_,j,ot):_e.texImage2D(rt,ct,_,_,j,ot)})}),this.unbind()}setImageDataForFace(e){const{face:s,width:o,height:a,pixels:d,data:g,border:_=0,format:j=6408,type:_e=5121}=e,{gl:et}=this,tt=d||g;return this.bind(),tt instanceof Promise?tt.then(rt=>this.setImageDataForFace(Object.assign({},e,{face:s,data:rt,pixels:rt}))):this.width||this.height?et.texImage2D(s,0,j,o,a,_,j,_e,tt):et.texImage2D(s,0,j,j,_e,tt),this}}TextureCube.FACES=FACES;class Texture3D extends Texture{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return isWebGL2$1(e)}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};assertWebGL2Context(e),s=Object.assign({depth:1},s,{target:32879,unpackFlipY:!1}),super(e,s),this.initialize(s),Object.seal(this)}setImageData(e){let{level:s=0,dataFormat:o=6408,width:a,height:d,depth:g=1,border:_=0,format:j,type:_e=5121,offset:et=0,data:tt,parameters:rt={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),withParameters(this.gl,rt,()=>{ArrayBuffer.isView(tt)&&this.gl.texImage3D(this.target,s,o,a,d,g,_,j,_e,tt),tt instanceof Buffer&&(this.gl.bindBuffer(35052,tt.handle),this.gl.texImage3D(this.target,s,o,a,d,g,_,j,_e,et))}),tt&&tt.byteLength)this._trackAllocatedMemory(tt.byteLength,"Texture");else{const it=DATA_FORMAT_CHANNELS[this.dataFormat]||4,ot=TYPE_SIZES[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*it*ot,"Texture")}return this.loaded=!0,this}}const EXT_FLOAT_WEBGL2="EXT_color_buffer_float",RENDERBUFFER_FORMATS={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:EXT_FLOAT_WEBGL2,bpp:2},[33327]:{gl2:EXT_FLOAT_WEBGL2,bpp:4},[34842]:{gl2:EXT_FLOAT_WEBGL2,bpp:8},[33326]:{gl2:EXT_FLOAT_WEBGL2,bpp:4},[33328]:{gl2:EXT_FLOAT_WEBGL2,bpp:8},[34836]:{gl2:EXT_FLOAT_WEBGL2,bpp:16},[35898]:{gl2:EXT_FLOAT_WEBGL2,bpp:4}};function isFormatSupported(i,e,s){const o=s[e];if(!o)return!1;const a=isWebGL2$1(i)&&o.gl2||o.gl1;return typeof a=="string"?i.getExtension(a):a}class Renderbuffer extends Resource$1{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!s||isFormatSupported(e,s,RENDERBUFFER_FORMATS)}static getSamplesForFormat(e,s){let{format:o}=s;return e.getInternalformatParameter(36161,o,32937)}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,s),this.initialize(s),Object.seal(this)}initialize(e){let{format:s,width:o=1,height:a=1,samples:d=0}=e;return assert$6(s,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),d!==0&&isWebGL2$1(this.gl)?this.gl.renderbufferStorageMultisample(36161,d,s,o,a):this.gl.renderbufferStorage(36161,s,o,a),this.format=s,this.width=o,this.height=a,this.samples=d,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*RENDERBUFFER_FORMATS[this.format].bpp),this}resize(e){let{width:s,height:o}=e;return s!==this.width||o!==this.height?this.initialize({width:s,height:o,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const GL_DEPTH_BUFFER_BIT=256,GL_STENCIL_BUFFER_BIT=1024,GL_COLOR_BUFFER_BIT=16384,GL_COLOR=6144,GL_DEPTH=6145,GL_STENCIL=6146,GL_DEPTH_STENCIL=34041,ERR_ARGUMENTS="clear: bad arguments";function clear(i){let{framebuffer:e=null,color:s=null,depth:o=null,stencil:a=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const d={};e&&(d.framebuffer=e);let g=0;s&&(g|=GL_COLOR_BUFFER_BIT,s!==!0&&(d.clearColor=s)),o&&(g|=GL_DEPTH_BUFFER_BIT,o!==!0&&(d.clearDepth=o)),a&&(g|=GL_STENCIL_BUFFER_BIT,o!==!0&&(d.clearStencil=o)),assert$6(g!==0,ERR_ARGUMENTS),withParameters(i,d,()=>{i.clear(g)})}function clearBuffer(i){let{framebuffer:e=null,buffer:s=GL_COLOR,drawBuffer:o=0,value:a=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};assertWebGL2Context(i),withParameters(i,{framebuffer:e},()=>{switch(s){case GL_COLOR:switch(a.constructor){case Int32Array:i.clearBufferiv(s,o,a);break;case Uint32Array:i.clearBufferuiv(s,o,a);break;case Float32Array:default:i.clearBufferfv(s,o,a)}break;case GL_DEPTH:i.clearBufferfv(GL_DEPTH,0,[a]);break;case GL_STENCIL:i.clearBufferiv(GL_STENCIL,0,[a]);break;case GL_DEPTH_STENCIL:const[d,g]=a;i.clearBufferfi(GL_DEPTH_STENCIL,0,d,g);break;default:assert$6(!1,ERR_ARGUMENTS)}})}function glFormatToComponents(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return assert$6(!1),0}}function readPixelsToArray(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:s=0,sourceY:o=0,sourceFormat:a=6408}=e;let{sourceAttachment:d=36064,target:g=null,sourceWidth:_,sourceHeight:j,sourceType:_e}=e;const{framebuffer:et,deleteFramebuffer:tt}=getFramebuffer$1(i);assert$6(et);const{gl:rt,handle:it,attachments:ot}=et;_=_||et.width,j=j||et.height,d===36064&&it===null&&(d=1028),assert$6(ot[d]),_e=_e||ot[d].type,g=getPixelArray(g,_e,a,_,j),_e=_e||getGLTypeFromTypedArray(g);const ct=rt.bindFramebuffer(36160,it);return rt.readPixels(s,o,_,j,a,_e,g),rt.bindFramebuffer(36160,ct||null),tt&&et.delete(),g}function copyToDataUrl(i){let{sourceAttachment:e=36064,targetMaxHeight:s=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=readPixelsToArray(i,{sourceAttachment:e}),{width:a,height:d}=i;for(;d>s;)({data:o,width:a,height:d}=scalePixels({data:o,width:a,height:d}));flipRows({data:o,width:a,height:d});const g=document.createElement("canvas");g.width=a,g.height=d;const _=g.getContext("2d"),j=_.createImageData(a,d);return j.data.set(o),_.putImageData(j,0,0),g.toDataURL()}function copyToTexture(i,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:o=0,sourceY:a=0,targetMipmaplevel:d=0,targetInternalFormat:g=6408}=s;let{targetX:_,targetY:j,targetZ:_e,width:et,height:tt}=s;const{framebuffer:rt,deleteFramebuffer:it}=getFramebuffer$1(i);assert$6(rt);const{gl:ot,handle:ct}=rt,ft=typeof _<"u"||typeof j<"u"||typeof _e<"u";_=_||0,j=j||0,_e=_e||0;const dt=ot.bindFramebuffer(36160,ct);assert$6(e);let pt=null;if(e instanceof Texture&&(pt=e,et=Number.isFinite(et)?et:pt.width,tt=Number.isFinite(tt)?tt:pt.height,pt.bind(0),e=pt.target),!ft)ot.copyTexImage2D(e,d,g,o,a,et,tt,0);else switch(e){case 3553:case 34067:ot.copyTexSubImage2D(e,d,_,j,o,a,et,tt);break;case 35866:case 32879:assertWebGL2Context(ot).copyTexSubImage3D(e,d,_,j,_e,o,a,et,tt);break}return pt&&pt.unbind(),ot.bindFramebuffer(36160,dt||null),it&&rt.delete(),pt}function getFramebuffer$1(i){return i instanceof Framebuffer?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:toFramebuffer(i),deleteFramebuffer:!0}}function getPixelArray(i,e,s,o,a){if(i)return i;e=e||5121;const d=getTypedArrayFromGLType(e,{clamped:!1}),g=glFormatToComponents(s);return new d(o*a*g)}const FEATURES$1={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function checkFloat32ColorAttachment(i){const e=new Texture2D(i,{format:6408,type:5126,dataFormat:6408}),s=new Framebuffer(i,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),o=s.getStatus();return e.delete(),s.delete(),o===36053}const WEBGL_FEATURES$1={[FEATURES$1.WEBGL2]:[!1,!0],[FEATURES$1.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[FEATURES$1.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[FEATURES$1.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[FEATURES$1.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[FEATURES$1.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[FEATURES$1.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[FEATURES$1.FLOAT_BLEND]:["EXT_float_blend"],[FEATURES$1.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[FEATURES$1.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[FEATURES$1.TEXTURE_FLOAT]:["OES_texture_float",!0],[FEATURES$1.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[FEATURES$1.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[FEATURES$1.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[FEATURES$1.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[FEATURES$1.COLOR_ATTACHMENT_RGBA32F]:[checkFloat32ColorAttachment,"EXT_color_buffer_float"],[FEATURES$1.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[FEATURES$1.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[FEATURES$1.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[FEATURES$1.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[FEATURES$1.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[FEATURES$1.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},LOG_UNSUPPORTED_FEATURE=2;function hasFeature(i,e){return hasFeatures$1(i,e)}function hasFeatures$1(i,e){return e=Array.isArray(e)?e:[e],e.every(s=>isFeatureSupported(i,s))}function getFeatures(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const e in WEBGL_FEATURES$1)i.luma.caps[e]===void 0&&(i.luma.caps[e]=isFeatureSupported(i,e));return i.luma.caps}function isFeatureSupported(i,e){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[e]===void 0&&(i.luma.caps[e]=queryFeature(i,e)),i.luma.caps[e]||log$3.log(LOG_UNSUPPORTED_FEATURE,"Feature: ".concat(e," not supported"))(),i.luma.caps[e]}function queryFeature(i,e){const s=WEBGL_FEATURES$1[e];assert$6(s,e);let o;const a=isWebGL2$1(i)&&s[1]||s[0];if(typeof a=="function")o=a(i);else if(Array.isArray(a)){o=!0;for(const d of a)o=o&&!!i.getExtension(d)}else typeof a=="string"?o=!!i.getExtension(a):typeof a=="boolean"?o=a:assert$6(!1);return o}const ERR_MULTIPLE_RENDERTARGETS="Multiple render targets not supported";class Framebuffer extends Resource$1{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:o,colorBufferHalfFloat:a}=s;let d=!0;return o&&(d=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),a&&(d=d&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),d}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Framebuffer(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=assertWebGL2Context(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=assertWebGL2Context(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,s),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(s),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:s=1,height:o=1,attachments:a=null,color:d=!0,depth:g=!0,stencil:_=!1,check:j=!0,readBuffer:_e=void 0,drawBuffers:et=void 0}=e;if(assert$6(s>=0&&o>=0,"Width and height need to be integers"),this.width=s,this.height=o,a)for(const tt in a){const rt=a[tt];(Array.isArray(rt)?rt[0]:rt).resize({width:s,height:o})}else a=this._createDefaultAttachments(d,g,_,s,o);this.update({clearAttachments:!0,attachments:a,readBuffer:_e,drawBuffers:et}),a&&j&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:s={},readBuffer:o,drawBuffers:a,clearAttachments:d=!1,resizeAttachments:g=!0}=e;this.attach(s,{clearAttachments:d,resizeAttachments:g});const{gl:_}=this,j=_.bindFramebuffer(36160,this.handle);return o&&this._setReadBuffer(o),a&&this._setDrawBuffers(a),_.bindFramebuffer(36160,j||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:s,height:o}=e;if(this.handle===null)return assert$6(s===void 0&&o===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;s===void 0&&(s=this.gl.drawingBufferWidth),o===void 0&&(o=this.gl.drawingBufferHeight),s!==this.width&&o!==this.height&&log$3.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(s,"x").concat(o))();for(const a in this.attachments)this.attachments[a].resize({width:s,height:o});return this.width=s,this.height=o,this}attach(e){let{clearAttachments:s=!1,resizeAttachments:o=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a={};s&&Object.keys(this.attachments).forEach(g=>{a[g]=null}),Object.assign(a,e);const d=this.gl.bindFramebuffer(36160,this.handle);for(const g in a){assert$6(g!==void 0,"Misspelled framebuffer binding point?");const _=Number(g),j=a[_];let _e=j;if(!_e)this._unattach(_);else if(_e instanceof Renderbuffer)this._attachRenderbuffer({attachment:_,renderbuffer:_e});else if(Array.isArray(j)){const[et,tt=0,rt=0]=j;_e=et,this._attachTexture({attachment:_,texture:et,layer:tt,level:rt})}else this._attachTexture({attachment:_,texture:_e,layer:0,level:0});o&&_e&&_e.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,d||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(g=>!this.attachments[g]).forEach(g=>{delete this.attachments[g]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(_getFrameBufferStatus(e));return this}getStatus(){const{gl:e}=this,s=e.bindFramebuffer(36160,this.handle),o=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,s||null),o}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:s,depth:o,stencil:a,drawBuffers:d=[]}=e,g=this.gl.bindFramebuffer(36160,this.handle);return(s||o||a)&&clear(this.gl,{color:s,depth:o,stencil:a}),d.forEach((_,j)=>{clearBuffer(this.gl,{drawBuffer:j,value:_})}),this.gl.bindFramebuffer(36160,g||null),this}readPixels(){return log$3.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return log$3.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return log$3.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return log$3.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return log$3.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return log$3.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:s=[],x:o=0,y:a=0,width:d,height:g}=e;const _=assertWebGL2Context(this.gl),j=_.bindFramebuffer(36008,this.handle);return o===0&&a===0&&d===void 0&&g===void 0?_.invalidateFramebuffer(36008,s):_.invalidateFramebuffer(36008,s,o,a,d,g),_.bindFramebuffer(36008,j),this}getAttachmentParameter(e,s,o){let a=this._getAttachmentParameterFallback(s);return a===null&&(this.gl.bindFramebuffer(36160,this.handle),a=this.gl.getFramebufferAttachmentParameter(36160,e,s),this.gl.bindFramebuffer(36160,null)),o&&a>1e3&&(a=getKey(this.gl,a)),a}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const a={};for(const d of o){const g=s?getKey(this.gl,d):d;a[g]=this.getAttachmentParameter(e,d,s)}return a}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const s=Object.keys(this.attachments),o={};for(const a of s){const d=Number(a),g=e?getKey(this.gl,d):d;o[g]=this.getAttachmentParameters(d,e)}return o}show(){return typeof window<"u"&&window.open(copyToDataUrl(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>log$3.level||typeof window>"u")return this;s=s||"Framebuffer ".concat(this.id);const o=copyToDataUrl(this,{targetMaxHeight:100});return log$3.image({logLevel:e,message:s,image:o},s)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,s,o,a,d){let g=null;return e&&(g=g||{},g[36064]=new Texture2D(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:a,height:d,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(g[36064])),s&&o?(g=g||{},g[33306]=new Renderbuffer(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:a,height:111}),this.ownResources.push(g[33306])):s?(g=g||{},g[36096]=new Renderbuffer(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:a,height:d}),this.ownResources.push(g[36096])):o&&assert$6(!1),g}_unattach(e){const s=this.attachments[e];s&&(s instanceof Renderbuffer?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:s=36064,renderbuffer:o}=e;const{gl:a}=this;a.framebufferRenderbuffer(36160,s,36161,o.handle),this.attachments[s]=o}_attachTexture(e){let{attachment:s=36064,texture:o,layer:a,level:d}=e;const{gl:g}=this;switch(g.bindTexture(o.target,o.handle),o.target){case 35866:case 32879:assertWebGL2Context(g).framebufferTextureLayer(36160,s,o.target,d,a);break;case 34067:const j=mapIndexToCubeMapFace(a);g.framebufferTexture2D(36160,s,j,o.handle,d);break;case 3553:g.framebufferTexture2D(36160,s,3553,o.handle,d);break;default:assert$6(!1,"Illegal texture type")}g.bindTexture(o.target,null),this.attachments[s]=o}_setReadBuffer(e){const s=getWebGL2Context(this.gl);s?s.readBuffer(e):assert$6(e===36064||e===1029,ERR_MULTIPLE_RENDERTARGETS),this.readBuffer=e}_setDrawBuffers(e){const{gl:s}=this,o=assertWebGL2Context(s);if(o)o.drawBuffers(e);else{const a=s.getExtension("WEBGL_draw_buffers");a?a.drawBuffersWEBGL(e):assert$6(e.length===1&&(e[0]===36064||e[0]===1029),ERR_MULTIPLE_RENDERTARGETS)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const s=getFeatures(this.gl);switch(e){case 36052:return s.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return s.WEBGL2?null:8;case 33297:return s.WEBGL2?null:5125;case 33296:return!s.WEBGL2&&!s.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function mapIndexToCubeMapFace(i){return i<34069?i+34069:i}function _getFrameBufferStatus(i){return(Framebuffer.STATUS||{})[i]||"Framebuffer error ".concat(i)}const FRAMEBUFFER_ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Framebuffer.ATTACHMENT_PARAMETERS=FRAMEBUFFER_ATTACHMENT_PARAMETERS;function cloneTextureFrom(i,e){assert$6(i instanceof Texture2D||i instanceof TextureCube||i instanceof Texture3D);const s=i.constructor,{gl:o,width:a,height:d,format:g,type:_,dataFormat:j,border:_e,mipmaps:et}=i,tt=Object.assign({width:a,height:d,format:g,type:_,dataFormat:j,border:_e,mipmaps:et},e);return new s(o,tt)}function toFramebuffer(i,e){const{gl:s,width:o,height:a,id:d}=i;return new Framebuffer(s,Object.assign({},e,{id:"framebuffer-for-".concat(d),width:o,height:a,attachments:{[36064]:i}}))}function getShaderName$1(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const s=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,o=i.match(s);return o?o[1]:e}const GL_FRAGMENT_SHADER=35632,GL_VERTEX_SHADER=35633;function getShaderTypeName(i){switch(i){case GL_FRAGMENT_SHADER:return"fragment";case GL_VERTEX_SHADER:return"vertex";default:return"unknown type"}}function parseGLSLCompilerError(i,e,s,o){const a=i.split(/\r?\n/),d={},g={},_=o||getShaderName$1(e)||"(unnamed)",j="".concat(getShaderTypeName(s)," shader ").concat(_);for(let et=0;et<a.length;et++){const tt=a[et];if(tt.length<=1)continue;const rt=tt.split(":"),it=rt[0],ot=parseInt(rt[2],10);if(isNaN(ot))throw new Error("GLSL compilation error in ".concat(j,": ").concat(i));it!=="WARNING"?d[ot]=tt:g[ot]=tt}const _e=addLineNumbers(e);return{shaderName:j,errors:formatErrors(d,_e),warnings:formatErrors(g,_e)}}function formatErrors(i,e){let s="";for(let o=0;o<e.length;o++){const a=e[o];if(!(!i[o+3]&&!i[o+2]&&!i[o+1])&&(s+="".concat(a,`
`),i[o+1])){const d=i[o+1],g=d.split(":",3),_=g[0],j=parseInt(g[1],10)||0,_e=d.substring(g.join(":").length+1).trim();s+=padLeft("^^^ ".concat(_,": ").concat(_e,`

`),j)}}return s}function addLineNumbers(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const o=i.split(/\r?\n/),a=String(o.length+e-1).length;return o.map((d,g)=>{const _=String(g+e),j=_.length;return padLeft(_,a-j)+s+d})}function padLeft(i,e){let s="";for(let o=0;o<e;++o)s+=" ";return"".concat(s).concat(i)}function getShaderVersion(i){let e=100;const s=i.match(/[^\s]+/g);if(s.length>=2&&s[0]==="#version"){const o=parseInt(s[1],10);Number.isFinite(o)&&(e=o)}return e}const ERR_SOURCE="Shader: GLSL source code must be a JavaScript string";class Shader extends Resource$1{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return assert$6(!1),"unknown"}}constructor(e,s){assertWebGLContext(e),assert$6(typeof s.source=="string",ERR_SOURCE);const o=getShaderName$1(s.source,null)||s.id||uid("unnamed ".concat(Shader.getTypeName(s.shaderType)));super(e,{id:o}),this.shaderType=s.shaderType,this.source=s.source,this.initialize(s)}initialize(e){let{source:s}=e;const o=getShaderName$1(s,null);o&&(this.id=uid(o)),this._compile(s)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Shader.getTypeName(this.shaderType),":").concat(this.id)}getName(){return getShaderName$1(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const o=this.gl.getShaderInfoLog(this.handle),{shaderName:a,errors:d,warnings:g}=parseGLSLCompilerError(o,this.source,this.shaderType,this.id);throw log$3.error("GLSL compilation errors in ".concat(a,`
`).concat(d))(),log$3.warn("GLSL compilation warnings in ".concat(a,`
`).concat(g))(),new Error("GLSL compilation errors in ".concat(a))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class VertexShader extends Shader{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,s){typeof s=="string"&&(s={source:s}),super(e,Object.assign({},s,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class FragmentShader extends Shader{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,s){typeof s=="string"&&(s={source:s}),super(e,Object.assign({},s,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const UNIFORM_SETTERS={[5126]:getArraySetter.bind(null,"uniform1fv",toFloatArray,1,setVectorUniform),[35664]:getArraySetter.bind(null,"uniform2fv",toFloatArray,2,setVectorUniform),[35665]:getArraySetter.bind(null,"uniform3fv",toFloatArray,3,setVectorUniform),[35666]:getArraySetter.bind(null,"uniform4fv",toFloatArray,4,setVectorUniform),[5124]:getArraySetter.bind(null,"uniform1iv",toIntArray,1,setVectorUniform),[35667]:getArraySetter.bind(null,"uniform2iv",toIntArray,2,setVectorUniform),[35668]:getArraySetter.bind(null,"uniform3iv",toIntArray,3,setVectorUniform),[35669]:getArraySetter.bind(null,"uniform4iv",toIntArray,4,setVectorUniform),[35670]:getArraySetter.bind(null,"uniform1iv",toIntArray,1,setVectorUniform),[35671]:getArraySetter.bind(null,"uniform2iv",toIntArray,2,setVectorUniform),[35672]:getArraySetter.bind(null,"uniform3iv",toIntArray,3,setVectorUniform),[35673]:getArraySetter.bind(null,"uniform4iv",toIntArray,4,setVectorUniform),[35674]:getArraySetter.bind(null,"uniformMatrix2fv",toFloatArray,4,setMatrixUniform),[35675]:getArraySetter.bind(null,"uniformMatrix3fv",toFloatArray,9,setMatrixUniform),[35676]:getArraySetter.bind(null,"uniformMatrix4fv",toFloatArray,16,setMatrixUniform),[35678]:getSamplerSetter,[35680]:getSamplerSetter,[5125]:getArraySetter.bind(null,"uniform1uiv",toUIntArray,1,setVectorUniform),[36294]:getArraySetter.bind(null,"uniform2uiv",toUIntArray,2,setVectorUniform),[36295]:getArraySetter.bind(null,"uniform3uiv",toUIntArray,3,setVectorUniform),[36296]:getArraySetter.bind(null,"uniform4uiv",toUIntArray,4,setVectorUniform),[35685]:getArraySetter.bind(null,"uniformMatrix2x3fv",toFloatArray,6,setMatrixUniform),[35686]:getArraySetter.bind(null,"uniformMatrix2x4fv",toFloatArray,8,setMatrixUniform),[35687]:getArraySetter.bind(null,"uniformMatrix3x2fv",toFloatArray,6,setMatrixUniform),[35688]:getArraySetter.bind(null,"uniformMatrix3x4fv",toFloatArray,12,setMatrixUniform),[35689]:getArraySetter.bind(null,"uniformMatrix4x2fv",toFloatArray,8,setMatrixUniform),[35690]:getArraySetter.bind(null,"uniformMatrix4x3fv",toFloatArray,12,setMatrixUniform),[35678]:getSamplerSetter,[35680]:getSamplerSetter,[35679]:getSamplerSetter,[35682]:getSamplerSetter,[36289]:getSamplerSetter,[36292]:getSamplerSetter,[36293]:getSamplerSetter,[36298]:getSamplerSetter,[36299]:getSamplerSetter,[36300]:getSamplerSetter,[36303]:getSamplerSetter,[36306]:getSamplerSetter,[36307]:getSamplerSetter,[36308]:getSamplerSetter,[36311]:getSamplerSetter},FLOAT_ARRAY={},INT_ARRAY={},UINT_ARRAY={},array1=[0];function toTypedArray(i,e,s,o){e===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(array1[0]=i,i=array1);const a=i.length;if(a%e&&log$3.warn("Uniform size should be multiples of ".concat(e),i)(),i instanceof s)return i;let d=o[a];d||(d=new s(a),o[a]=d);for(let g=0;g<a;g++)d[g]=i[g];return d}function toFloatArray(i,e){return toTypedArray(i,e,Float32Array,FLOAT_ARRAY)}function toIntArray(i,e){return toTypedArray(i,e,Int32Array,INT_ARRAY)}function toUIntArray(i,e){return toTypedArray(i,e,Uint32Array,UINT_ARRAY)}function getUniformSetter(i,e,s){const o=UNIFORM_SETTERS[s.type];if(!o)throw new Error("Unknown GLSL uniform type ".concat(s.type));return o().bind(null,i,e)}function parseUniformName(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,s=i.match(e);if(!s||s.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:s[1],length:s[2]||1,isArray:!!s[2]}}function checkUniformValues(i,e,s){for(const o in i){const a=i[o];if((!s||!!s[o])&&!checkUniformValue(a))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(o),a),new Error("".concat(e," Bad uniform ").concat(o))}return!0}function checkUniformValue(i){return Array.isArray(i)||ArrayBuffer.isView(i)?checkUniformArray(i):isFinite(i)||i===!0||i===!1||i instanceof Texture||i instanceof Renderbuffer?!0:i instanceof Framebuffer?!!i.texture:!1}function copyUniform(i,e,s){if(Array.isArray(s)||ArrayBuffer.isView(s))if(i[e]){const o=i[e];for(let a=0,d=s.length;a<d;++a)o[a]=s[a]}else i[e]=s.slice();else i[e]=s}function checkUniformArray(i){if(i.length===0)return!1;const e=Math.min(i.length,16);for(let s=0;s<e;++s)if(!Number.isFinite(i[s]))return!1;return!0}function getSamplerSetter(){let i=null;return(e,s,o)=>{const a=i!==o;return a&&(e.uniform1i(s,o),i=o),a}}function getArraySetter(i,e,s,o){let a=null,d=null;return(g,_,j)=>{const _e=e(j,s),et=_e.length;let tt=!1;if(a===null)a=new Float32Array(et),d=et,tt=!0;else{assert$6(d===et,"Uniform length cannot change.");for(let rt=0;rt<et;++rt)if(_e[rt]!==a[rt]){tt=!0;break}}return tt&&(o(g,i,_,_e),a.set(_e)),tt}}function setVectorUniform(i,e,s,o){i[e](s,o)}function setMatrixUniform(i,e,s,o){i[e](s,!1,o)}const GL_BYTE=5120,GL_UNSIGNED_BYTE=5121,GL_SHORT=5122,GL_UNSIGNED_SHORT=5123,GL_POINTS=0,GL_LINES=1,GL_LINE_LOOP=2,GL_LINE_STRIP=3,GL_TRIANGLES=4,GL_TRIANGLE_STRIP=5,GL_TRIANGLE_FAN=6,GL_FLOAT=5126,GL_FLOAT_VEC2=35664,GL_FLOAT_VEC3=35665,GL_FLOAT_VEC4=35666,GL_INT=5124,GL_INT_VEC2=35667,GL_INT_VEC3=35668,GL_INT_VEC4=35669,GL_UNSIGNED_INT=5125,GL_UNSIGNED_INT_VEC2=36294,GL_UNSIGNED_INT_VEC3=36295,GL_UNSIGNED_INT_VEC4=36296,GL_BOOL=35670,GL_BOOL_VEC2=35671,GL_BOOL_VEC3=35672,GL_BOOL_VEC4=35673,GL_FLOAT_MAT2=35674,GL_FLOAT_MAT3=35675,GL_FLOAT_MAT4=35676,GL_FLOAT_MAT2x3=35685,GL_FLOAT_MAT2x4=35686,GL_FLOAT_MAT3x2=35687,GL_FLOAT_MAT3x4=35688,GL_FLOAT_MAT4x2=35689,GL_FLOAT_MAT4x3=35690,COMPOSITE_GL_TYPES={[GL_FLOAT]:[GL_FLOAT,1,"float"],[GL_FLOAT_VEC2]:[GL_FLOAT,2,"vec2"],[GL_FLOAT_VEC3]:[GL_FLOAT,3,"vec3"],[GL_FLOAT_VEC4]:[GL_FLOAT,4,"vec4"],[GL_INT]:[GL_INT,1,"int"],[GL_INT_VEC2]:[GL_INT,2,"ivec2"],[GL_INT_VEC3]:[GL_INT,3,"ivec3"],[GL_INT_VEC4]:[GL_INT,4,"ivec4"],[GL_UNSIGNED_INT]:[GL_UNSIGNED_INT,1,"uint"],[GL_UNSIGNED_INT_VEC2]:[GL_UNSIGNED_INT,2,"uvec2"],[GL_UNSIGNED_INT_VEC3]:[GL_UNSIGNED_INT,3,"uvec3"],[GL_UNSIGNED_INT_VEC4]:[GL_UNSIGNED_INT,4,"uvec4"],[GL_BOOL]:[GL_FLOAT,1,"bool"],[GL_BOOL_VEC2]:[GL_FLOAT,2,"bvec2"],[GL_BOOL_VEC3]:[GL_FLOAT,3,"bvec3"],[GL_BOOL_VEC4]:[GL_FLOAT,4,"bvec4"],[GL_FLOAT_MAT2]:[GL_FLOAT,8,"mat2"],[GL_FLOAT_MAT2x3]:[GL_FLOAT,8,"mat2x3"],[GL_FLOAT_MAT2x4]:[GL_FLOAT,8,"mat2x4"],[GL_FLOAT_MAT3]:[GL_FLOAT,12,"mat3"],[GL_FLOAT_MAT3x2]:[GL_FLOAT,12,"mat3x2"],[GL_FLOAT_MAT3x4]:[GL_FLOAT,12,"mat3x4"],[GL_FLOAT_MAT4]:[GL_FLOAT,16,"mat4"],[GL_FLOAT_MAT4x2]:[GL_FLOAT,16,"mat4x2"],[GL_FLOAT_MAT4x3]:[GL_FLOAT,16,"mat4x3"]};function getPrimitiveDrawMode(i){switch(i){case GL_POINTS:return GL_POINTS;case GL_LINES:return GL_LINES;case GL_LINE_STRIP:return GL_LINES;case GL_LINE_LOOP:return GL_LINES;case GL_TRIANGLES:return GL_TRIANGLES;case GL_TRIANGLE_STRIP:return GL_TRIANGLES;case GL_TRIANGLE_FAN:return GL_TRIANGLES;default:return assert$6(!1),0}}function decomposeCompositeGLType(i){const e=COMPOSITE_GL_TYPES[i];if(!e)return null;const[s,o]=e;return{type:s,components:o}}function getCompositeGLType(i,e){switch(i){case GL_BYTE:case GL_UNSIGNED_BYTE:case GL_SHORT:case GL_UNSIGNED_SHORT:i=GL_FLOAT;break}for(const s in COMPOSITE_GL_TYPES){const[o,a,d]=COMPOSITE_GL_TYPES[s];if(o===i&&a===e)return{glType:s,name:d}}return null}class ProgramConfiguration{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const s=Number(e);return Number.isFinite(s)?this.attributeInfosByLocation[s]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const s=this.getAttributeInfo(e);return s?s.location:-1}getAttributeAccessor(e){const s=this.getAttributeInfo(e);return s?s.accessor:null}getVaryingInfo(e){const s=Number(e);return Number.isFinite(s)?this.varyingInfos[s]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const s=this.getVaryingInfo();return s?s.location:-1}getVaryingAccessor(e){const s=this.getVaryingInfo();return s?s.accessor:null}_readAttributesFromProgram(e){const{gl:s}=e,o=s.getProgramParameter(e.handle,35721);for(let a=0;a<o;a++){const{name:d,type:g,size:_}=s.getActiveAttrib(e.handle,a),j=s.getAttribLocation(e.handle,d);j>=0&&this._addAttribute(j,d,g,_)}this.attributeInfos.sort((a,d)=>a.location-d.location)}_readVaryingsFromProgram(e){const{gl:s}=e;if(!isWebGL2$1(s))return;const o=s.getProgramParameter(e.handle,35971);for(let a=0;a<o;a++){const{name:d,type:g,size:_}=s.getTransformFeedbackVarying(e.handle,a);this._addVarying(a,d,g,_)}this.varyingInfos.sort((a,d)=>a.location-d.location)}_addAttribute(e,s,o,a){const{type:d,components:g}=decomposeCompositeGLType(o),_={type:d,size:a*g};this._inferProperties(e,s,_);const j={location:e,name:s,accessor:new Accessor(_)};this.attributeInfos.push(j),this.attributeInfosByLocation[e]=j,this.attributeInfosByName[j.name]=j}_inferProperties(e,s,o){/instance/i.test(s)&&(o.divisor=1)}_addVarying(e,s,o,a){const{type:d,components:g}=decomposeCompositeGLType(o),_=new Accessor({type:d,size:a*g}),j={location:e,name:s,accessor:_};this.varyingInfos.push(j),this.varyingInfosByName[j.name]=j}}const LOG_PROGRAM_PERF_PRIORITY=4,GL_SEPARATE_ATTRIBS=35981,V6_DEPRECATED_METHODS=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Program extends Resource$1{get[Symbol.toStringTag](){return"Program"}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,s),this.stubRemovedMethods("Program","v6.0",V6_DEPRECATED_METHODS),this._isCached=!1,this.initialize(s),Object.seal(this),this._setId(s.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:s,vs:o,fs:a,varyings:d,bufferMode:g=GL_SEPARATE_ATTRIBS}=e;return this.hash=s||"",this.vs=typeof o=="string"?new VertexShader(this.gl,{id:"".concat(e.id,"-vs"),source:o}):o,this.fs=typeof a=="string"?new FragmentShader(this.gl,{id:"".concat(e.id,"-fs"),source:a}):a,assert$6(this.vs instanceof VertexShader),assert$6(this.fs instanceof FragmentShader),this.uniforms={},this._textureUniforms={},d&&d.length>0&&(assertWebGL2Context(this.gl),this.varyings=d,this.gl2.transformFeedbackVaryings(this.handle,d,g)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new ProgramConfiguration(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:s,drawMode:o=4,vertexCount:a,offset:d=0,start:g,end:_,isIndexed:j=!1,indexType:_e=5123,instanceCount:et=0,isInstanced:tt=et>0,vertexArray:rt=null,transformFeedback:it,framebuffer:ot,parameters:ct={},uniforms:ft,samplers:dt}=e;if((ft||dt)&&(log$3.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ft||{})),log$3.priority>=s){const pt=ot?ot.id:"default",gt="mode=".concat(getKey(this.gl,o)," verts=").concat(a," ")+"instances=".concat(et," indexType=").concat(getKey(this.gl,_e)," ")+"isInstanced=".concat(tt," isIndexed=").concat(j," ")+"Framebuffer=".concat(pt);log$3.log(s,gt)()}return assert$6(rt),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||a===0||tt&&et===0?!1:(rt.bindForDraw(a,et,()=>{if(ot!==void 0&&(ct=Object.assign({},ct,{framebuffer:ot})),it){const pt=getPrimitiveDrawMode(o);it.begin(pt)}this._bindTextures(),withParameters(this.gl,ct,()=>{j&&tt?this.gl2.drawElementsInstanced(o,a,_e,d,et):j&&isWebGL2$1(this.gl)&&!isNaN(g)&&!isNaN(_)?this.gl2.drawRangeElements(o,g,_,a,_e,d):j?this.gl.drawElements(o,a,_e,d):tt?this.gl2.drawArraysInstanced(o,d,a,et):this.gl.drawArrays(o,d,a)}),it&&it.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};log$3.priority>=2&&checkUniformValues(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const s in e){const o=e[s],a=this._uniformSetters[s];if(a){let d=o,g=!1;if(d instanceof Framebuffer&&(d=d.texture),d instanceof Texture)if(g=this.uniforms[s]!==o,g){a.textureIndex===void 0&&(a.textureIndex=this._textureIndexCounter++);const _=d,{textureIndex:j}=a;_.bind(j),d=j,this._textureUniforms[s]=_}else d=a.textureIndex;else this._textureUniforms[s]&&delete this._textureUniforms[s];(a(d)||g)&&copyUniform(this.uniforms,s,o)}}return this}_areTexturesRenderable(){let e=!0;for(const s in this._textureUniforms){const o=this._textureUniforms[s];o.update(),e=e&&o.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const s=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(s)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const s=this.gl.getAttachedShaders(e),o={};for(const a of s)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:o.vs=new VertexShader({handle:a});break;case 35632:o.fs=new FragmentShader({handle:a});break}return o}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const s=this._getName();this.id=uid(s)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),log$3.time(LOG_PROGRAM_PERF_PRIORITY,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),log$3.timeEnd(LOG_PROGRAM_PERF_PRIORITY,"linkProgram for ".concat(this._getName()))(),e.debug||log$3.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let s=0;s<this._uniformCount;s++){const o=this.gl.getActiveUniform(this.handle,s),{name:a}=parseUniformName(o.name);let d=e.getUniformLocation(this.handle,a);if(this._uniformSetters[a]=getUniformSetter(e,d,o),o.size>1)for(let g=0;g<o.size;g++)d=e.getUniformLocation(this.handle,"".concat(a,"[").concat(g,"]")),this._uniformSetters["".concat(a,"[").concat(g,"]")]=getUniformSetter(e,d,o)}this._textureIndexCounter=0}getActiveUniforms(e,s){return this.gl2.getActiveUniforms(this.handle,e,s)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,s){return this.gl2.getActiveUniformBlockParameter(this.handle,e,s)}uniformBlockBinding(e,s){this.gl2.uniformBlockBinding(this.handle,e,s)}}const GL_QUERY_RESULT=34918,GL_QUERY_RESULT_AVAILABLE=34919,GL_TIME_ELAPSED_EXT=35007,GL_GPU_DISJOINT_EXT=36795,GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976,GL_ANY_SAMPLES_PASSED=35887,GL_ANY_SAMPLES_PASSED_CONSERVATIVE=36202;class Query extends Resource$1{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const o=isWebGL2$1(e),a=hasFeatures$1(e,FEATURES$1.TIMER_QUERY);let d=o||a;for(const g of s)switch(g){case"queries":d=d&&o;break;case"timers":d=d&&a;break;default:assert$6(!1)}return d}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,s),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(GL_TIME_ELAPSED_EXT)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?GL_ANY_SAMPLES_PASSED_CONSERVATIVE:GL_ANY_SAMPLES_PASSED)}beginTransformFeedbackQuery(){return this.begin(GL_TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,GL_QUERY_RESULT_AVAILABLE);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(GL_GPU_DISJOINT_EXT)}getResult(){return this.gl2.getQueryParameter(this.handle,GL_QUERY_RESULT)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let s=0;return this._pollingPromise=new Promise((o,a)=>{const d=()=>{this.isResultAvailable()?(o(this.getResult()),this._pollingPromise=null):s++>e?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(d)};requestAnimationFrame(d)}),this._pollingPromise}_createHandle(){return Query.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class TransformFeedback extends Resource$1{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return isWebGL2$1(e)}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};assertWebGL2Context(e),super(e,s),this.initialize(s),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,isObjectEmpty(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const s in e)this.setBuffer(s,e[s])}),this}setBuffer(e,s){const o=this._getVaryingIndex(e),{buffer:a,byteSize:d,byteOffset:g}=this._getBufferParams(s);return o<0?(this.unused[e]=a,log$3.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[o]=s,this.bindOnUse||this._bindBuffer(o,a,g,d),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let s,o,a;return e instanceof Buffer?a=e:(a=e.buffer,o=e.byteSize,s=e.byteOffset),(s!==void 0||o!==void 0)&&(s=s||0,o=o||a.byteLength-s),{buffer:a,byteOffset:s,byteSize:o}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const s=Number(e);return Number.isFinite(s)?s:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:s,byteSize:o,byteOffset:a}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,s,a,o)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0;const d=s&&s.handle;return!d||a===void 0?this.gl.bindBufferBase(35982,e,d):this.gl.bindBufferRange(35982,e,d,o,a),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let arrayBuffer=null;function getScratchArrayBuffer(i){return(!arrayBuffer||arrayBuffer.byteLength<i)&&(arrayBuffer=new ArrayBuffer(i)),arrayBuffer}function getScratchArray(i,e){const s=getScratchArrayBuffer(i.BYTES_PER_ELEMENT*e);return new i(s,0,e)}function fillArray$1(i){let{target:e,source:s,start:o=0,count:a=1}=i;const d=s.length,g=a*d;let _=0;for(let j=o;_<d;_++)e[j++]=s[_];for(;_<g;)_<g-_?(e.copyWithin(o+_,o,o+_),_*=2):(e.copyWithin(o+_,o,o+g-_),_=g);return e}const ERR_ELEMENTS="elements must be GL.ELEMENT_ARRAY_BUFFER";class VertexArrayObject extends Resource$1{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?isWebGL2$1(e)||getBrowser()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new VertexArrayObject(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return VertexArrayObject.MAX_ATTRIBUTES=VertexArrayObject.MAX_ATTRIBUTES||e.getParameter(34921),VertexArrayObject.MAX_ATTRIBUTES}static setConstant(e,s,o){switch(o.constructor){case Float32Array:VertexArrayObject._setConstantFloatArray(e,s,o);break;case Int32Array:VertexArrayObject._setConstantIntArray(e,s,o);break;case Uint32Array:VertexArrayObject._setConstantUintArray(e,s,o);break;default:assert$6(!1)}}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=s.id||s.program&&s.program.id;super(e,Object.assign({},s,{id:o})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=s.isDefaultArray||!1,this.gl2=e,this.initialize(s),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return VertexArrayObject.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return assert$6(!e||e.target===34963,ERR_ELEMENTS),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,s,o){if(s.target===34963)return this.setElementBuffer(s,o);const{size:a,type:d,stride:g,offset:_,normalized:j,integer:_e,divisor:et}=o,{gl:tt,gl2:rt}=this;return e=Number(e),this.bind(()=>{tt.bindBuffer(34962,s.handle),_e?(assert$6(isWebGL2$1(tt)),rt.vertexAttribIPointer(e,a,d,g,_)):tt.vertexAttribPointer(e,a,d,j,g,_),tt.enableVertexAttribArray(e),rt.vertexAttribDivisor(e,et||0)}),this}enable(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!s&&e===0&&!VertexArrayObject.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>s?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,s){const o=this._normalizeConstantArrayValue(s),a=o.byteLength*e,d=o.length*e;let g=!this.buffer;if(this.buffer=this.buffer||new Buffer(this.gl,a),g=g||this.buffer.reallocate(a),g=g||!this._compareConstantArrayValues(o,this.bufferValue),g){const _=getScratchArray(s.constructor,d);fillArray$1({target:_,source:o,start:0,count:d}),this.buffer.subData(_),this.bufferValue=s}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,s){if(!e||!s||e.length!==s.length||e.constructor!==s.constructor)return!1;for(let o=0;o<e.length;++o)if(e[o]!==s[o])return!1;return!0}static _setConstantFloatArray(e,s,o){switch(o.length){case 1:e.vertexAttrib1fv(s,o);break;case 2:e.vertexAttrib2fv(s,o);break;case 3:e.vertexAttrib3fv(s,o);break;case 4:e.vertexAttrib4fv(s,o);break;default:assert$6(!1)}}static _setConstantIntArray(e,s,o){switch(assert$6(isWebGL2$1(e)),o.length){case 1:e.vertexAttribI1iv(s,o);break;case 2:e.vertexAttribI2iv(s,o);break;case 3:e.vertexAttribI3iv(s,o);break;case 4:e.vertexAttribI4iv(s,o);break;default:assert$6(!1)}}static _setConstantUintArray(e,s,o){switch(assert$6(isWebGL2$1(e)),o.length){case 1:e.vertexAttribI1uiv(s,o);break;case 2:e.vertexAttribI2uiv(s,o);break;case 3:e.vertexAttribI3uiv(s,o);break;case 4:e.vertexAttribI4uiv(s,o);break;default:assert$6(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,s){let{location:o}=s;return assert$6(Number.isFinite(o)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(o,e);default:return this.gl.getVertexAttrib(o,e)}})}}const ERR_ATTRIBUTE_TYPE="VertexArray: attributes must be Buffers or constants (i.e. typed array)",MULTI_LOCATION_ATTRIBUTE_REGEXP=/^(.+)__LOCATION_([0-9]+)$/,DEPRECATIONS_V6=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class VertexArray{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=s.id||s.program&&s.program.id;this.id=o,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new VertexArrayObject(e),stubRemovedMethods(this,"VertexArray","v6.0",DEPRECATIONS_V6),this.initialize(s),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const s in e){const o=e[s];this._setAttribute(s,o)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=s,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,s),this}setBuffer(e,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(s.target===34963)return this.setElementBuffer(s,o);const{location:a,accessor:d}=this._resolveLocationAndAccessor(e,s,s.accessor,o);return a>=0&&(this.values[a]=s,this.accessors[a]=d,this.clearDrawParams(),this.vertexArrayObject.setBuffer(a,s,d)),this}setConstant(e,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:a,accessor:d}=this._resolveLocationAndAccessor(e,s,Object.assign({size:s.length},o));return a>=0&&(s=this.vertexArrayObject._normalizeConstantArrayValue(s),this.values[a]=s,this.accessors[a]=d,this.clearDrawParams(),this.vertexArrayObject.enable(a,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Buffer(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Buffer&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const s=this.values[e];s instanceof Buffer&&this.setBuffer(e,s)}}),this}bindForDraw(e,s,o){let a;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,s),a=o()}),a}_resolveLocationAndAccessor(e,s,o,a){const d={location:-1,accessor:null},{location:g,name:_}=this._getAttributeIndex(e);if(!Number.isFinite(g)||g<0)return this.unused[e]=s,log$3.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),d;const j=this._getAttributeInfo(_||g);if(!j)return d;const _e=this.accessors[g]||{},et=Accessor.resolve(j.accessor,_e,o,a),{size:tt,type:rt}=et;return assert$6(Number.isFinite(tt)&&Number.isFinite(rt)),{location:g,accessor:et}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const s=Number(e);if(Number.isFinite(s))return{location:s};const o=MULTI_LOCATION_ATTRIBUTE_REGEXP.exec(e),a=o?o[1]:e,d=o?Number(o[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(a)+d,name:a}:{location:-1}}_setAttribute(e,s){if(s instanceof Buffer)this.setBuffer(e,s);else if(Array.isArray(s)&&s.length&&s[0]instanceof Buffer){const o=s[0],a=s[1];this.setBuffer(e,o,a)}else if(ArrayBuffer.isView(s)||Array.isArray(s)){const o=s;this.setConstant(e,o)}else if(s.buffer instanceof Buffer){const o=s;this.setBuffer(e,o.buffer,o)}else throw new Error(ERR_ATTRIBUTE_TYPE)}_setConstantAttributes(e,s){const o=Math.max(e|0,s|0);let a=this.values[0];ArrayBuffer.isView(a)&&this._setConstantAttributeZero(a,o);for(let d=1;d<this.vertexArrayObject.MAX_ATTRIBUTES;d++)a=this.values[d],ArrayBuffer.isView(a)&&this._setConstantAttribute(d,a)}_setConstantAttributeZero(e,s){if(VertexArrayObject.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const o=this.vertexArrayObject.getConstantBuffer(s,e);this.vertexArrayObject.setBuffer(0,o,this.accessors[0])}_setConstantAttribute(e,s){VertexArrayObject.setConstant(this.gl,e,s)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let s=0;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)this._updateDrawParamsForLocation(e,s);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,s){const o=this.values[s],a=this.accessors[s];if(!o)return;const{divisor:d}=a,g=d>0;if(e.isInstanced=e.isInstanced||g,o instanceof Buffer){const _=o;if(g){const j=_.getVertexCount(a);e.instanceCount=Math.min(e.instanceCount,j)}else{const j=_.getVertexCount(a);e.vertexCount=Math.min(e.vertexCount,j)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return log$3.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,s)}}function formatArrayValue(i,e){const{maxElts:s=16,size:o=1}=e;let a="[";for(let g=0;g<i.length&&g<s;++g)g>0&&(a+=",".concat(g%o===0?" ":"")),a+=formatValue$1(i[g],e);const d=i.length>s?"...":"]";return"".concat(a).concat(d)}function formatValue$1(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=1e-16,{isInteger:o=!1}=e;if(Array.isArray(i)||ArrayBuffer.isView(i))return formatArrayValue(i,e);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<s)return o?"0":"0.";if(o||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const a=i.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a}function getDebugTableForUniforms(i){let{header:e="Uniforms",program:s,uniforms:o,undefinedOnly:a=!1}=i;assert$6(s);const d=".*_.*",g=".*Matrix",_=s._uniformSetters,j={},_e=Object.keys(_).sort();let et=0;for(const it of _e)!it.match(d)&&!it.match(g)&&addUniformToTable({table:j,header:e,uniforms:o,uniformName:it,undefinedOnly:a})&&et++;for(const it of _e)it.match(g)&&addUniformToTable({table:j,header:e,uniforms:o,uniformName:it,undefinedOnly:a})&&et++;for(const it of _e)j[it]||addUniformToTable({table:j,header:e,uniforms:o,uniformName:it,undefinedOnly:a})&&et++;let tt=0;const rt={};if(!a)for(const it in o){const ot=o[it];j[it]||(tt++,rt[it]={Type:"NOT USED: ".concat(ot),[e]:formatValue$1(ot)})}return{table:j,count:et,unusedTable:rt,unusedCount:tt}}function addUniformToTable(i){let{table:e,header:s,uniforms:o,uniformName:a,undefinedOnly:d}=i;const g=o[a],_=isUniformDefined(g);return!d||!_?(e[a]={[s]:_?formatValue$1(g):"N/A","Uniform Type":_?g:"NOT PROVIDED"},!0):!1}function isUniformDefined(i){return i!=null}function getDebugTableForVertexArray(i){let{vertexArray:e,header:s="Attributes"}=i;if(!e.configuration)return{};const o={};e.elements&&(o.ELEMENT_ARRAY_BUFFER=getDebugTableRow(e,e.elements,null,s));const a=e.values;for(const d in a){const g=e._getAttributeInfo(d);if(g){let _="".concat(d,": ").concat(g.name);const j=e.accessors[g.location];j&&(_="".concat(d,": ").concat(getGLSLDeclaration$1(g.name,j))),o[_]=getDebugTableRow(e,a[d],j,s)}}return o}function getDebugTableRow(i,e,s,o){const{gl:a}=i;if(!e)return{[o]:"null","Format ":"N/A"};let d="NOT PROVIDED",g=1,_=0,j=0,_e,et,tt;if(s&&(d=s.type,g=s.size,d=String(d).replace("Array",""),_e=d.indexOf("nt")!==-1),e instanceof Buffer){const rt=e,{data:it,changed:ot}=rt.getDebugData();et=ot?"*":"",tt=it,j=rt.byteLength,_=j/it.BYTES_PER_ELEMENT/g;let ct;if(s){const ft=s.divisor>0;ct="".concat(ft?"I ":"P "," ").concat(_," (x").concat(g,"=").concat(j," bytes ").concat(getKey(a,d),")")}else _e=!0,ct="".concat(j," bytes");return{[o]:"".concat(et).concat(formatValue$1(tt,{size:g,isInteger:_e})),"Format ":ct}}return tt=e,g=e.length,d=String(e.constructor.name).replace("Array",""),_e=d.indexOf("nt")!==-1,{[o]:"".concat(formatValue$1(tt,{size:g,isInteger:_e})," (constant)"),"Format ":"".concat(g,"x").concat(d," (constant)")}}function getGLSLDeclaration$1(i,e){const{type:s,size:o}=e,a=getCompositeGLType(s,o);return a?"".concat(i," (").concat(a.name,")"):i}function getDebugTableForProgramConfiguration(i){const e={},s="Accessors for ".concat(i.id);for(const o of i.attributeInfos)if(o){const a=getGLSLDeclaration(o);e["in ".concat(a)]={[s]:JSON.stringify(o.accessor)}}for(const o of i.varyingInfos)if(o){const a=getGLSLDeclaration(o);e["out ".concat(a)]={[s]:JSON.stringify(o.accessor)}}return e}function getGLSLDeclaration(i){const{type:e,size:s}=i.accessor,o=getCompositeGLType(e,s);return o?"".concat(o.name," ").concat(i.name):i.name}const isPage=isBrowser$3()&&typeof document<"u";let statIdCounter=0;class AnimationLoop{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:s=ft=>createGLContext(ft),onAddHTML:o=null,onInitialize:a=()=>{},onRender:d=()=>{},onFinalize:g=()=>{},onError:_,gl:j=null,glOptions:_e={},debug:et=!1,createFramebuffer:tt=!1,autoResizeViewport:rt=!0,autoResizeDrawingBuffer:it=!0,stats:ot=lumaStats.get("animation-loop-".concat(statIdCounter++))}=e;let{useDevicePixels:ct=!0}=e;"useDevicePixelRatio"in e&&(log$3.deprecated("useDevicePixelRatio","useDevicePixels")(),ct=e.useDevicePixelRatio),this.props={onCreateContext:s,onAddHTML:o,onInitialize:a,onRender:d,onFinalize:g,onError:_,gl:j,glOptions:_e,debug:et,createFramebuffer:tt},this.gl=j,this.needsRedraw=null,this.timeline=null,this.stats=ot,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:rt,autoResizeDrawingBuffer:it,useDevicePixels:ct}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return assert$6(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const s=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Query.isSupported(this.gl,["timers"])?new Query(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(o=>{this._running&&(this._addCallbackData(o||{}),o!==!1&&this._startLoop())});return this.props.onError&&s.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.getElementById(e);return o?Number(o.value):s}setViewParameters(){return log$3.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=isPage?new Promise((e,s)=>{if(isPage&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):cancelAnimationFrame$1(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):requestAnimationFrame$1(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:s,aspect:o}=this._getSizeAndAspect();(e!==this.animationProps.width||s!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),o!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=s,this.animationProps.aspect=o,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?instrumentGLContext(this.props.gl,e):this.onCreateContext(e),!isWebGL(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");resetParameters(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const s=document.createElement("div");s.style.position="absolute",s.style.left="10px",s.style.bottom="10px",s.style.width="300px",s.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(s);const o=this.props.onAddHTML(s);o&&(s.innerHTML=o)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,s=this.gl.drawingBufferHeight;let o=1;const{canvas:a}=this.gl;return a&&a.clientHeight?o=a.clientWidth/a.clientHeight:e>0&&s>0&&(o=e/s),{width:e,height:s,aspect:o}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&resizeGLContext(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Framebuffer(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const VERTEX_SHADER$1="vs",FRAGMENT_SHADER$1="fs";function assert$5(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const TYPE_DEFINITIONS$1={number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},array:{validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function parsePropTypes$1(i){const e={};for(const s in i){const o=i[s],a=parsePropType$1(o);e[s]=a}return e}function parsePropType$1(i){let e=getTypeOf$1(i);return e==="object"?i?"type"in i?Object.assign({},i,TYPE_DEFINITIONS$1[i.type]):"value"in i?(e=getTypeOf$1(i.value),Object.assign({type:e},i,TYPE_DEFINITIONS$1[e])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:e,value:i},TYPE_DEFINITIONS$1[e])}function getTypeOf$1(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const VERTEX_SHADER="vs",FRAGMENT_SHADER="fs";class ShaderModule{constructor(e){let{name:s,vs:o,fs:a,dependencies:d=[],uniforms:g,getUniforms:_,deprecations:j=[],defines:_e={},inject:et={},vertexShader:tt,fragmentShader:rt}=e;assert$5(typeof s=="string"),this.name=s,this.vs=o||tt,this.fs=a||rt,this.getModuleUniforms=_,this.dependencies=d,this.deprecations=this._parseDeprecationDefinitions(j),this.defines=_e,this.injections=normalizeInjections(et),g&&(this.uniforms=parsePropTypes$1(g))}getModuleSource(e){let s;switch(e){case VERTEX_SHADER:s=this.vs||"";break;case FRAGMENT_SHADER:s=this.fs||"";break;default:assert$5(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(s,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,s){return this.getModuleUniforms?this.getModuleUniforms(e,s):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,s){this.deprecations.forEach(o=>{o.regex.test(e)&&(o.deprecated?s.deprecated(o.old,o.new)():s.removed(o.old,o.new)())})}_parseDeprecationDefinitions(e){return e.forEach(s=>{switch(s.type){case"function":s.regex=new RegExp("\\b".concat(s.old,"\\("));break;default:s.regex=new RegExp("".concat(s.type," ").concat(s.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s={},o=this.uniforms;for(const a in o){const d=o[a];a in e&&!d.private?(d.validate&&assert$5(d.validate(e[a],d),"".concat(this.name,": invalid ").concat(a)),s[a]=e[a]):s[a]=d.value}return s}}function normalizeInjections(i){const e={vs:{},fs:{}};for(const s in i){let o=i[s];const a=s.slice(0,2);typeof o=="string"&&(o={order:0,injection:o}),e[a][s]=o}return e}function resolveModules(i){return getShaderDependencies(instantiateModules(i))}function getShaderDependencies(i){const e={},s={};return getDependencyGraph({modules:i,level:0,moduleMap:e,moduleDepth:s}),Object.keys(s).sort((o,a)=>s[a]-s[o]).map(o=>e[o])}function getDependencyGraph(i){let{modules:e,level:s,moduleMap:o,moduleDepth:a}=i;if(s>=5)throw new Error("Possible loop in shader dependency graph");for(const d of e)o[d.name]=d,(a[d.name]===void 0||a[d.name]<s)&&(a[d.name]=s);for(const d of e)d.dependencies&&getDependencyGraph({modules:d.dependencies,level:s+1,moduleMap:o,moduleDepth:a})}function instantiateModules(i,e){return i.map(s=>(s instanceof ShaderModule||(assert$5(typeof s!="string","Shader module use by name is deprecated. Import shader module '".concat(s,"' and use it directly.")),assert$5(s.name,"shader module has no name"),s=new ShaderModule(s),s.dependencies=instantiateModules(s.dependencies)),s))}function isOldIE(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},s=i.userAgent||e.userAgent||"",o=s.indexOf("MSIE ")!==-1,a=s.indexOf("Trident/")!==-1;return o||a}const GL_VENDOR=7936,GL_RENDERER=7937,GL_VERSION=7938,GL_SHADING_LANGUAGE_VERSION=35724,WEBGL_FEATURES={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},FEATURES={};Object.keys(WEBGL_FEATURES).forEach(i=>{FEATURES[i]=i});function isWebGL2(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function getContextInfo(i){const e=i.getExtension("WEBGL_debug_renderer_info"),s=i.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||GL_VENDOR),o=i.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||GL_RENDERER);return{gpuVendor:identifyGPUVendor(s,o),vendor:s,renderer:o,version:i.getParameter(GL_VERSION),shadingLanguageVersion:i.getParameter(GL_SHADING_LANGUAGE_VERSION)}}function identifyGPUVendor(i,e){return i.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||e.match(/AMD/i)||i.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const compiledGlslExtensions={};function canCompileGLGSExtension(i,e){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const o=WEBGL_FEATURES[e];if(assert$5(o,e),!isOldIE(s))return!0;if(e in compiledGlslExtensions)return compiledGlslExtensions[e];const a=o[0],d=s.behavior||"enable",g="#extension GL_".concat(a," : ").concat(d,`
void main(void) {}`),_=i.createShader(35633);i.shaderSource(_,g),i.compileShader(_);const j=i.getShaderParameter(_,35713);return i.deleteShader(_),compiledGlslExtensions[e]=j,j}function getFeature(i,e){const s=WEBGL_FEATURES[e];assert$5(s,e);const o=isWebGL2(i)&&s[1]||s[0],a=typeof o=="string"?!!i.getExtension(o):o;return assert$5(a===!1||a===!0),a}function hasFeatures(i,e){return e=Array.isArray(e)?e:[e],e.every(s=>getFeature(i,s))}function getPlatformShaderDefines(i){switch(getContextInfo(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function getVersionDefines(i,e,s){let o=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return hasFeatures(i,FEATURES.GLSL_FRAG_DEPTH)&&(o+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),hasFeatures(i,FEATURES.GLSL_DERIVATIVES)&&canCompileGLGSExtension(i,FEATURES.GLSL_DERIVATIVES)&&(o+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),hasFeatures(i,FEATURES.GLSL_FRAG_DATA)&&canCompileGLGSExtension(i,FEATURES.GLSL_FRAG_DATA,{behavior:"require"})&&(o+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),hasFeatures(i,FEATURES.GLSL_TEXTURE_LOD)&&(o+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),o}const MODULE_INJECTORS_VS=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,MODULE_INJECTORS_FS=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,MODULE_INJECTORS={[VERTEX_SHADER$1]:MODULE_INJECTORS_VS,[FRAGMENT_SHADER$1]:MODULE_INJECTORS_FS},DECLARATION_INJECT_MARKER="__LUMA_INJECT_DECLARATIONS__",REGEX_START_OF_MAIN$1=/void\s+main\s*\([^)]*\)\s*\{\n?/,REGEX_END_OF_MAIN=/}\n?[^{}]*$/,fragments=[];function injectShader(i,e,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=e===VERTEX_SHADER$1;for(const d in s){const g=s[d];g.sort((j,_e)=>j.order-_e.order),fragments.length=g.length;for(let j=0,_e=g.length;j<_e;++j)fragments[j]=g[j].injection;const _="".concat(fragments.join(`
`),`
`);switch(d){case"vs:#decl":a&&(i=i.replace(DECLARATION_INJECT_MARKER,_));break;case"vs:#main-start":a&&(i=i.replace(REGEX_START_OF_MAIN$1,j=>j+_));break;case"vs:#main-end":a&&(i=i.replace(REGEX_END_OF_MAIN,j=>_+j));break;case"fs:#decl":a||(i=i.replace(DECLARATION_INJECT_MARKER,_));break;case"fs:#main-start":a||(i=i.replace(REGEX_START_OF_MAIN$1,j=>j+_));break;case"fs:#main-end":a||(i=i.replace(REGEX_END_OF_MAIN,j=>_+j));break;default:i=i.replace(d,j=>j+_)}}return i=i.replace(DECLARATION_INJECT_MARKER,""),o&&(i=i.replace(/\}\s*$/,d=>d+MODULE_INJECTORS[e])),i}function combineInjects(i){const e={};return assert$5(Array.isArray(i)&&i.length>1),i.forEach(s=>{for(const o in s)e[o]=e[o]?"".concat(e[o],`
`).concat(s[o]):s[o]}),e}function testVariable(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const ES300_REPLACEMENTS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ES300_VERTEX_REPLACEMENTS=[...ES300_REPLACEMENTS,[testVariable("attribute"),"in $1"],[testVariable("varying"),"out $1"]],ES300_FRAGMENT_REPLACEMENTS=[...ES300_REPLACEMENTS,[testVariable("varying"),"in $1"]],ES100_REPLACEMENTS=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],ES100_VERTEX_REPLACEMENTS=[...ES100_REPLACEMENTS,[testVariable("in"),"attribute $1"],[testVariable("out"),"varying $1"]],ES100_FRAGMENT_REPLACEMENTS=[...ES100_REPLACEMENTS,[testVariable("in"),"varying $1"]],ES100_FRAGMENT_OUTPUT_NAME="gl_FragColor",ES300_FRAGMENT_OUTPUT_REGEX=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,REGEX_START_OF_MAIN=/void\s+main\s*\([^)]*\)\s*\{\n?/;function transpileShader(i,e,s){switch(e){case 300:return s?convertShader(i,ES300_VERTEX_REPLACEMENTS):convertFragmentShaderTo300(i);case 100:return s?convertShader(i,ES100_VERTEX_REPLACEMENTS):convertFragmentShaderTo100(i);default:throw new Error("unknown GLSL version ".concat(e))}}function convertShader(i,e){for(const[s,o]of e)i=i.replace(s,o);return i}function convertFragmentShaderTo300(i){i=convertShader(i,ES300_FRAGMENT_REPLACEMENTS);const e=i.match(ES300_FRAGMENT_OUTPUT_REGEX);if(e){const s=e[1];i=i.replace(new RegExp("\\b".concat(ES100_FRAGMENT_OUTPUT_NAME,"\\b"),"g"),s)}else{const s="fragmentColor";i=i.replace(REGEX_START_OF_MAIN,o=>"out vec4 ".concat(s,`;
`).concat(o)).replace(new RegExp("\\b".concat(ES100_FRAGMENT_OUTPUT_NAME,"\\b"),"g"),s)}return i}function convertFragmentShaderTo100(i){i=convertShader(i,ES100_FRAGMENT_REPLACEMENTS);const e=i.match(ES300_FRAGMENT_OUTPUT_REGEX);if(e){const s=e[1];i=i.replace(ES300_FRAGMENT_OUTPUT_REGEX,"").replace(new RegExp("\\b".concat(s,"\\b"),"g"),ES100_FRAGMENT_OUTPUT_NAME)}return i}const INJECT_SHADER_DECLARATIONS=`

`.concat(DECLARATION_INJECT_MARKER,`

`),SHADER_TYPE={[VERTEX_SHADER$1]:"vertex",[FRAGMENT_SHADER$1]:"fragment"},FRAGMENT_SHADER_PROLOGUE=`precision highp float;

`;function assembleShaders(i,e){const{vs:s,fs:o}=e,a=resolveModules(e.modules||[]);return{gl:i,vs:assembleShader(i,Object.assign({},e,{source:s,type:VERTEX_SHADER$1,modules:a})),fs:assembleShader(i,Object.assign({},e,{source:o,type:FRAGMENT_SHADER$1,modules:a})),getUniforms:assembleGetUniforms(a)}}function assembleShader(i,e){let{id:s,source:o,type:a,modules:d,defines:g={},hookFunctions:_=[],inject:j={},transpileToGLSL100:_e=!1,prologue:et=!0,log:tt}=e;assert$5(typeof o=="string","shader source must be a string");const rt=a===VERTEX_SHADER$1,it=o.split(`
`);let ot=100,ct="",ft=o;it[0].indexOf("#version ")===0?(ot=300,ct=it[0],ft=it.slice(1).join(`
`)):ct="#version ".concat(ot);const dt={};d.forEach(Bt=>{Object.assign(dt,Bt.getDefines())}),Object.assign(dt,g);let pt=et?"".concat(ct,`
`).concat(getShaderName({id:s,source:o,type:a}),`
`).concat(getShaderType({type:a}),`
`).concat(getPlatformShaderDefines(i),`
`).concat(getVersionDefines(i),`
`).concat(getApplicationDefines(dt),`
`).concat(rt?"":FRAGMENT_SHADER_PROLOGUE,`
`):"".concat(ct,`
`);const gt=normalizeHookFunctions(_),Ct={},xt={},at={};for(const Bt in j){const Ht=typeof j[Bt]=="string"?{injection:j[Bt],order:0}:j[Bt],sr=Bt.match(/^(v|f)s:(#)?([\w-]+)$/);if(sr){const mr=sr[2],hr=sr[3];mr?hr==="decl"?xt[Bt]=[Ht]:at[Bt]=[Ht]:Ct[Bt]=[Ht]}else at[Bt]=[Ht]}for(const Bt of d){tt&&Bt.checkDeprecations(ft,tt);const Ht=Bt.getModuleSource(a,ot);pt+=Ht;const sr=Bt.injections[a];for(const mr in sr){const hr=mr.match(/^(v|f)s:#([\w-]+)$/);if(hr){const Lr=hr[2]==="decl"?xt:at;Lr[mr]=Lr[mr]||[],Lr[mr].push(sr[mr])}else Ct[mr]=Ct[mr]||[],Ct[mr].push(sr[mr])}}return pt+=INJECT_SHADER_DECLARATIONS,pt=injectShader(pt,a,xt),pt+=getHookFunctions(gt[a],Ct),pt+=ft,pt=injectShader(pt,a,at),pt=transpileShader(pt,_e?100:ot,rt),pt}function assembleGetUniforms(i){return function(s){const o={};for(const a of i){const d=a.getUniforms(s,o);Object.assign(o,d)}return o}}function getShaderType(i){let{type:e}=i;return`
#define SHADER_TYPE_`.concat(SHADER_TYPE[e].toUpperCase(),`
`)}function getShaderName(i){let{id:e,source:s,type:o}=i;return e&&typeof e=="string"&&s.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(SHADER_TYPE[o],`

`):""}function getApplicationDefines(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,s="";for(const o in i){e===0&&(s+=`
// APPLICATION DEFINES
`),e++;const a=i[o];(a||Number.isFinite(a))&&(s+="#define ".concat(o.toUpperCase()," ").concat(i[o],`
`))}return e===0&&(s+=`
`),s}function getHookFunctions(i,e){let s="";for(const o in i){const a=i[o];if(s+="void ".concat(a.signature,` {
`),a.header&&(s+="  ".concat(a.header)),e[o]){const d=e[o];d.sort((g,_)=>g.order-_.order);for(const g of d)s+="  ".concat(g.injection,`
`)}a.footer&&(s+="  ".concat(a.footer)),s+=`}
`}return s}function normalizeHookFunctions(i){const e={vs:{},fs:{}};return i.forEach(s=>{let o;typeof s!="string"?(o=s,s=o.hook):o={},s=s.trim();const[a,d]=s.split(":"),g=s.replace(/\(.+/,"");e[a][g]=Object.assign(o,{signature:d})}),e}const FS100="void main() {gl_FragColor = vec4(0);}",FS_GLES=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,FS300=`#version 300 es
`.concat(FS_GLES);function getQualifierDetails(i,e){e=Array.isArray(e)?e:[e];const s=i.replace(/^\s+/,"").split(/\s+/),[o,a,d]=s;if(!e.includes(o)||!a||!d)return null;const g=d.split(";")[0];return{qualifier:o,type:a,name:g}}function getPassthroughFS(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:s,inputType:o,output:a}=i;if(!s)return e===300?FS300:e>300?"#version ".concat(e,`
`).concat(FS_GLES):FS100;const d=convertToVec4(s,o);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(o," ").concat(s,`;
out vec4 `).concat(a,`;
void main() {
  `).concat(a," = ").concat(d,`;
}`):"varying ".concat(o," ").concat(s,`;
void main() {
  gl_FragColor = `).concat(d,`;
}`)}function typeToChannelSuffix(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return assert$5(!1),null}}function typeToChannelCount(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return assert$5(!1),null}}function convertToVec4(i,e){switch(e){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return assert$5(!1),null}}const fp32shader=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fp32={name:"fp32",vs:fp32shader,fs:null};function assert$4(i,e){if(!i)throw new Error("math.gl assertion ".concat(e))}const config={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function formatValue(i,{precision:e=config.precision}={}){return i=round(i),"".concat(parseFloat(i.toPrecision(e)))}function isArray$1(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function clamp$1(i,e,s){return map(i,o=>Math.max(e,Math.min(s,o)))}function lerp(i,e,s){return isArray$1(i)?i.map((o,a)=>lerp(o,e[a],s)):s*e+(1-s)*i}function equals(i,e,s){const o=config.EPSILON;s&&(config.EPSILON=s);try{if(i===e)return!0;if(isArray$1(i)&&isArray$1(e)){if(i.length!==e.length)return!1;for(let a=0;a<i.length;++a)if(!equals(i[a],e[a]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=config.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{config.EPSILON=o}}function round(i){return Math.round(i/config.EPSILON)*config.EPSILON}function duplicateArray(i){return i.clone?i.clone():new Array(i.length)}function map(i,e,s){if(isArray$1(i)){const o=i;s=s||duplicateArray(o);for(let a=0;a<s.length&&a<o.length;++a)s[a]=e(i[a],a,s);return s}return e(i)}function _extendableBuiltin(i){function e(){var s=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(s,Object.getPrototypeOf(this)),s}return e.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e}class MathArray extends _extendableBuiltin(Array){clone(){return new this.constructor().copy(this)}fromArray(e,s=0){for(let o=0;o<this.ELEMENTS;++o)this[o]=e[o+s];return this.check()}toArray(e=[],s=0){for(let o=0;o<this.ELEMENTS;++o)e[s+o]=this[o];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:isArray$1(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(e){let s="";for(let o=0;o<this.ELEMENTS;++o)s+=(o>0?", ":"")+formatValue(this[o],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(s,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let s=0;s<this.ELEMENTS;++s)if(!equals(this[s],e[s]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let s=0;s<this.ELEMENTS;++s)if(this[s]!==e[s])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,s,o){if(o===void 0)return this.lerp(this,e,s);for(let a=0;a<this.ELEMENTS;++a){const d=e[a];this[a]=d+o*(s[a]-d)}return this.check()}min(e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(e[s],this[s]);return this.check()}max(e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.max(e[s],this[s]);return this.check()}clamp(e,s){for(let o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],e[o]),s[o]);return this.check()}add(...e){for(const s of e)for(let o=0;o<this.ELEMENTS;++o)this[o]+=s[o];return this.check()}subtract(...e){for(const s of e)for(let o=0;o<this.ELEMENTS;++o)this[o]-=s[o];return this.check()}scale(e){if(typeof e=="number")for(let s=0;s<this.ELEMENTS;++s)this[s]*=e;else for(let s=0;s<this.ELEMENTS&&s<e.length;++s)this[s]*=e[s];return this.check()}multiplyByScalar(e){for(let s=0;s<this.ELEMENTS;++s)this[s]*=e;return this.check()}check(){if(config.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let s=0;s<this.ELEMENTS;++s)e=e&&Number.isFinite(this[s]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let s=0;s<this.ELEMENTS;++s)this[s]=e;return this.check()}addScalar(e){for(let s=0;s<this.ELEMENTS;++s)this[s]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let s=0;s<this.ELEMENTS;++s)this[s]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,s){for(let o=0;o<this.ELEMENTS;++o)this[o]=Math.min(Math.max(this[o],e),s);return this.check()}get elements(){return this}}function validateVector(i,e){if(i.length!==e)return!1;for(let s=0;s<i.length;++s)if(!Number.isFinite(i[s]))return!1;return!0}function checkNumber(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function checkVector(i,e,s=""){if(config.debug&&!validateVector(i,e))throw new Error("math.gl: ".concat(s," some fields set to invalid numbers'"));return i}class Vector extends MathArray{get x(){return this[0]}set x(e){this[0]=checkNumber(e)}get y(){return this[1]}set y(e){this[1]=checkNumber(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let s=0;s<this.ELEMENTS;++s)e+=this[s]*this[s];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let s=0;for(let o=0;o<this.ELEMENTS;++o){const a=this[o]-e[o];s+=a*a}return checkNumber(s)}dot(e){let s=0;for(let o=0;o<this.ELEMENTS;++o)s+=this[o]*e[o];return checkNumber(s)}normalize(){const e=this.magnitude();if(e!==0)for(let s=0;s<this.ELEMENTS;++s)this[s]/=e;return this.check()}multiply(...e){for(const s of e)for(let o=0;o<this.ELEMENTS;++o)this[o]*=s[o];return this.check()}divide(...e){for(const s of e)for(let o=0;o<this.ELEMENTS;++o)this[o]/=s[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return assert$4(e>=0&&e<this.ELEMENTS,"index is out of range"),checkNumber(this[e])}setComponent(e,s){return assert$4(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=s,this.check()}addVectors(e,s){return this.copy(e).add(s)}subVectors(e,s){return this.copy(e).subtract(s)}multiplyVectors(e,s){return this.copy(e).multiply(s)}addScaledVector(e,s){return this.add(new this.constructor(e).multiplyScalar(s))}}function vec2_transformMat4AsVector(i,e,s){const o=e[0],a=e[1],d=s[3]*o+s[7]*a||1;return i[0]=(s[0]*o+s[4]*a)/d,i[1]=(s[1]*o+s[5]*a)/d,i}function vec3_transformMat4AsVector(i,e,s){const o=e[0],a=e[1],d=e[2],g=s[3]*o+s[7]*a+s[11]*d||1;return i[0]=(s[0]*o+s[4]*a+s[8]*d)/g,i[1]=(s[1]*o+s[5]*a+s[9]*d)/g,i[2]=(s[2]*o+s[6]*a+s[10]*d)/g,i}function vec3_transformMat2(i,e,s){const o=e[0],a=e[1];return i[0]=s[0]*o+s[2]*a,i[1]=s[1]*o+s[3]*a,i[2]=e[2],i}function vec4_transformMat2(i,e,s){const o=e[0],a=e[1];return i[0]=s[0]*o+s[2]*a,i[1]=s[1]*o+s[3]*a,i[2]=e[2],i[3]=e[3],i}function vec4_transformMat3(i,e,s){const o=e[0],a=e[1],d=e[2];return i[0]=s[0]*o+s[3]*a+s[6]*d,i[1]=s[1]*o+s[4]*a+s[7]*d,i[2]=s[2]*o+s[5]*a+s[8]*d,i[3]=e[3],i}const ORIGIN=[0,0,0];let ZERO$1;class Vector3 extends Vector{static get ZERO(){return ZERO$1||(ZERO$1=new Vector3(0,0,0),Object.freeze(ZERO$1)),ZERO$1}constructor(e=0,s=0,o=0){super(-0,-0,-0),arguments.length===1&&isArray$1(e)?this.copy(e):(config.debug&&(checkNumber(e),checkNumber(s),checkNumber(o)),this[0]=e,this[1]=s,this[2]=o)}set(e,s,o){return this[0]=e,this[1]=s,this[2]=o,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return config.debug&&(checkNumber(e.x),checkNumber(e.y),checkNumber(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=checkNumber(e)}angle(e){return angle(this,e)}cross(e){return cross(this,this,e),this.check()}rotateX({radians:e,origin:s=ORIGIN}){return rotateX(this,this,s,e),this.check()}rotateY({radians:e,origin:s=ORIGIN}){return rotateY(this,this,s,e),this.check()}rotateZ({radians:e,origin:s=ORIGIN}){return rotateZ(this,this,s,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return transformMat4$2(this,this,e),this.check()}transformAsVector(e){return vec3_transformMat4AsVector(this,this,e),this.check()}transformByMatrix3(e){return transformMat3$1(this,this,e),this.check()}transformByMatrix2(e){return vec3_transformMat2(this,this,e),this.check()}transformByQuaternion(e){return transformQuat$1(this,this,e),this.check()}}class Matrix extends MathArray{toString(){let e="[";if(config.printRowMajor){e+="row-major:";for(let s=0;s<this.RANK;++s)for(let o=0;o<this.RANK;++o)e+=" ".concat(this[o*this.RANK+s])}else{e+="column-major:";for(let s=0;s<this.ELEMENTS;++s)e+=" ".concat(this[s])}return e+="]",e}getElementIndex(e,s){return s*this.RANK+e}getElement(e,s){return this[s*this.RANK+e]}setElement(e,s,o){return this[s*this.RANK+e]=checkNumber(o),this}getColumn(e,s=new Array(this.RANK).fill(-0)){const o=e*this.RANK;for(let a=0;a<this.RANK;++a)s[a]=this[o+a];return s}setColumn(e,s){const o=e*this.RANK;for(let a=0;a<this.RANK;++a)this[o+a]=s[a];return this}}var INDICES;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(INDICES||(INDICES={}));const DEFAULT_FOVY=45*Math.PI/180,DEFAULT_ASPECT=1,DEFAULT_NEAR=.1,DEFAULT_FAR=500,IDENTITY_MATRIX$1=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Matrix4 extends Matrix{static get IDENTITY(){return getIdentityMatrix()}static get ZERO(){return getZeroMatrix()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return INDICES}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,s,o,a,d,g,_,j,_e,et,tt,rt,it,ot,ct,ft){return this[0]=e,this[1]=s,this[2]=o,this[3]=a,this[4]=d,this[5]=g,this[6]=_,this[7]=j,this[8]=_e,this[9]=et,this[10]=tt,this[11]=rt,this[12]=it,this[13]=ot,this[14]=ct,this[15]=ft,this.check()}setRowMajor(e,s,o,a,d,g,_,j,_e,et,tt,rt,it,ot,ct,ft){return this[0]=e,this[1]=d,this[2]=_e,this[3]=it,this[4]=s,this[5]=g,this[6]=et,this[7]=ot,this[8]=o,this[9]=_,this[10]=tt,this[11]=ct,this[12]=a,this[13]=j,this[14]=rt,this[15]=ft,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(IDENTITY_MATRIX$1)}fromObject(e){return this.check()}fromQuaternion(e){return fromQuat(this,e),this.check()}frustum(e){const{left:s,right:o,bottom:a,top:d,near:g=DEFAULT_NEAR,far:_=DEFAULT_FAR}=e;return _===1/0?computeInfinitePerspectiveOffCenter(this,s,o,a,d,g):frustum(this,s,o,a,d,g,_),this.check()}lookAt(e){const{eye:s,center:o=[0,0,0],up:a=[0,1,0]}=e;return lookAt(this,s,o,a),this.check()}ortho(e){const{left:s,right:o,bottom:a,top:d,near:g=DEFAULT_NEAR,far:_=DEFAULT_FAR}=e;return ortho(this,s,o,a,d,g,_),this.check()}orthographic(e){const{fovy:s=DEFAULT_FOVY,aspect:o=DEFAULT_ASPECT,focalDistance:a=1,near:d=DEFAULT_NEAR,far:g=DEFAULT_FAR}=e;checkRadians(s);const _=s/2,j=a*Math.tan(_),_e=j*o;return this.ortho({left:-_e,right:_e,bottom:-j,top:j,near:d,far:g})}perspective(e){const{fovy:s=45*Math.PI/180,aspect:o=1,near:a=.1,far:d=500}=e;return checkRadians(s),perspective(this,s,o,a,d),this.check()}determinant(){return determinant(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,s){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],s=s||[-0,-0,-0];const o=this.getScale(s),a=1/o[0],d=1/o[1],g=1/o[2];return e[0]=this[0]*a,e[1]=this[1]*d,e[2]=this[2]*g,e[3]=0,e[4]=this[4]*a,e[5]=this[5]*d,e[6]=this[6]*g,e[7]=0,e[8]=this[8]*a,e[9]=this[9]*d,e[10]=this[10]*g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,s){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],s=s||[-0,-0,-0];const o=this.getScale(s),a=1/o[0],d=1/o[1],g=1/o[2];return e[0]=this[0]*a,e[1]=this[1]*d,e[2]=this[2]*g,e[3]=this[4]*a,e[4]=this[5]*d,e[5]=this[6]*g,e[6]=this[8]*a,e[7]=this[9]*d,e[8]=this[10]*g,e}transpose(){return transpose(this,this),this.check()}invert(){return invert(this,this),this.check()}multiplyLeft(e){return multiply(this,e,this),this.check()}multiplyRight(e){return multiply(this,this,e),this.check()}rotateX(e){return rotateX$1(this,this,e),this.check()}rotateY(e){return rotateY$1(this,this,e),this.check()}rotateZ(e){return rotateZ$1(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,s){return rotate(this,this,e,s),this.check()}scale(e){return scale$1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return translate(this,this,e),this.check()}transform(e,s){return e.length===4?(s=transformMat4$1(s||[-0,-0,-0,-0],e,this),checkVector(s,4),s):this.transformAsPoint(e,s)}transformAsPoint(e,s){const{length:o}=e;let a;switch(o){case 2:a=transformMat4(s||[-0,-0],e,this);break;case 3:a=transformMat4$2(s||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(a,e.length),a}transformAsVector(e,s){let o;switch(e.length){case 2:o=vec2_transformMat4AsVector(s||[-0,-0],e,this);break;case 3:o=vec3_transformMat4AsVector(s||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(o,e.length),o}transformPoint(e,s){return this.transformAsPoint(e,s)}transformVector(e,s){return this.transformAsPoint(e,s)}transformDirection(e,s){return this.transformAsVector(e,s)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,s,o){return this.identity().translate([e,s,o])}}let ZERO,IDENTITY$1;function getZeroMatrix(){return ZERO||(ZERO=new Matrix4([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ZERO)),ZERO}function getIdentityMatrix(){return IDENTITY$1||(IDENTITY$1=new Matrix4,Object.freeze(IDENTITY$1)),IDENTITY$1}function checkRadians(i){if(i>Math.PI*2)throw Error("expected radians")}function computeInfinitePerspectiveOffCenter(i,e,s,o,a,d){const g=2*d/(s-e),_=2*d/(a-o),j=(s+e)/(s-e),_e=(a+o)/(a-o),et=-1,tt=-1,rt=-2*d;return i[0]=g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=j,i[9]=_e,i[10]=et,i[11]=tt,i[12]=0,i[13]=0,i[14]=rt,i[15]=0,i}const DEFAULT_HIGHLIGHT_COLOR=new Uint8Array([0,255,255,255]),DEFAULT_MODULE_OPTIONS={pickingSelectedColor:null,pickingHighlightColor:DEFAULT_HIGHLIGHT_COLOR,pickingActive:!1,pickingAttribute:!1};function getUniforms$1(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:DEFAULT_MODULE_OPTIONS;const e={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const s=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=s}if(i.pickingHighlightColor){const s=Array.from(i.pickingHighlightColor,o=>o/255);Number.isFinite(s[3])||(s[3]=1),e.picking_uHighlightColor=s}return i.pickingActive!==void 0&&(e.picking_uActive=!!i.pickingActive,e.picking_uAttribute=!!i.pickingAttribute),e}const vs$6=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs$3=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,picking$1={name:"picking",vs:vs$6,fs:fs$3,getUniforms:getUniforms$1},vs$5=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,transform={name:"transform",vs:vs$5,fs:null};class ProgramManager{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new ProgramManager(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(s=>s.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const s=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(o=>o.name!==s),this.stateHash++}addShaderHook(e,s){s&&(e=Object.assign(s,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:s="",fs:o="",defines:a={},inject:d={},varyings:g=[],bufferMode:_=35981,transpileToGLSL100:j=!1}=e,_e=this._getModuleList(e.modules),et=this._getHash(s),tt=this._getHash(o),rt=_e.map(gt=>this._getHash(gt.name)).sort(),it=g.map(gt=>this._getHash(gt)),ot=Object.keys(a).sort(),ct=Object.keys(d).sort(),ft=[],dt=[];for(const gt of ot)ft.push(this._getHash(gt)),ft.push(this._getHash(a[gt]));for(const gt of ct)dt.push(this._getHash(gt)),dt.push(this._getHash(d[gt]));const pt="".concat(et,"/").concat(tt,"D").concat(ft.join("/"),"M").concat(rt.join("/"),"I").concat(dt.join("/"),"V").concat(it.join("/"),"H").concat(this.stateHash,"B").concat(_).concat(j?"T":"");if(!this._programCache[pt]){const gt=assembleShaders(this.gl,{vs:s,fs:o,modules:_e,inject:d,defines:a,hookFunctions:this._hookFunctions,transpileToGLSL100:j});this._programCache[pt]=new Program(this.gl,{hash:pt,vs:gt.vs,fs:gt.fs,varyings:g,bufferMode:_}),this._getUniforms[pt]=gt.getUniforms||(Ct=>{}),this._useCounts[pt]=0}return this._useCounts[pt]++,this._programCache[pt]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const s=e.hash;this._useCounts[s]--,this._useCounts[s]===0&&(this._programCache[s].delete(),delete this._programCache[s],delete this._getUniforms[s],delete this._useCounts[s])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const s=new Array(this._defaultModules.length+e.length),o={};let a=0;for(let d=0,g=this._defaultModules.length;d<g;++d){const _=this._defaultModules[d],j=_.name;s[a++]=_,o[j]=!0}for(let d=0,g=e.length;d<g;++d){const _=e[d],j=_.name;o[j]||(s[a++]=_,o[j]=!0)}return s.length=a,s}}const GLTF_TO_LUMA_ATTRIBUTE_MAP={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function getBuffersFromGeometry(i,e,s){const o={};let a=e.indices;for(const d in e.attributes){const g=e.attributes[d],_=mapAttributeName(d,s);if(d==="indices")a=g;else if(g.constant)o[_]=g.value;else{const j=g.value,_e={...g};delete _e.value,o[_]=[new Buffer(i,j),_e],inferAttributeAccessor(d,_e)}}if(a){const d=a.value||a;assert$6(d instanceof Uint16Array||d instanceof Uint32Array,'attribute array for "indices" must be of integer type');const g={size:1,isIndexed:a.isIndexed===void 0?!0:a.isIndexed};o.indices=[new Buffer(i,{data:d,target:34963}),g]}return o}function mapAttributeName(i,e){const{attributeMap:s=GLTF_TO_LUMA_ATTRIBUTE_MAP}=e||{};return s&&s[i]||i}function inferAttributeAccessor(i,e){let s;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":s="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":s="vectors";break}switch(s){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}assert$6(Number.isFinite(e.size),"attribute ".concat(i," needs size"))}const LOG_DRAW_PRIORITY=2,LOG_DRAW_TIMEOUT=1e4,ERR_MODEL_PARAMS="Model needs drawMode and vertexCount",NOOP$1=()=>{},DRAW_PARAMS={};class Model{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:o=uid("model")}=s;assert$6(isWebGL(e)),this.id=o,this.gl=e,this.id=s.id||uid("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(s)}initialize(e){this.props={},this.programManager=e.programManager||ProgramManager.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:s=null,vs:o,fs:a,modules:d,defines:g,inject:_,varyings:j,bufferMode:_e,transpileToGLSL100:et}=e;this.programProps={program:s,vs:o,fs:a,modules:d,defines:g,inject:_,varyings:j,bufferMode:_e,transpileToGLSL100:et},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},assert$6(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),ERR_MODEL_PARAMS)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:s,vs:o,fs:a,modules:d,defines:g,inject:_,varyings:j,bufferMode:_e,transpileToGLSL100:et}=e;this.programProps={program:s,vs:o,fs:a,modules:d,defines:g,inject:_,varyings:j,bufferMode:_e,transpileToGLSL100:et},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return assert$6(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return assert$6(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=getBuffersFromGeometry(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(isObjectEmpty(e))return this;const s={};for(const o in e){const a=e[o];s[o]=a.getValue?a.getValue():a}return this.vertexArray.setAttributes(s),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const s=this.programManager.getUniforms(this.program);return s?s(e):{}}updateModuleSettings(e){const s=this.getModuleUniforms(e||{});return this.setUniforms(s)}clear(e){return clear(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:s=null,framebuffer:o,uniforms:a={},attributes:d={},transformFeedback:g=this.transformFeedback,parameters:_={},vertexArray:j=this.vertexArray}=e;this.setAttributes(d),this.updateModuleSettings(s),this.setUniforms(a);let _e;log$3.priority>=LOG_DRAW_PRIORITY&&(_e=this._logDrawCallStart(LOG_DRAW_PRIORITY));const et=this.vertexArray.getDrawParams(),{isIndexed:tt=et.isIndexed,indexType:rt=et.indexType,indexOffset:it=et.indexOffset,vertexArrayInstanced:ot=et.isInstanced}=this.props;ot&&!this.isInstanced&&log$3.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:ct,instanceCount:ft}=this,{onBeforeRender:dt=NOOP$1,onAfterRender:pt=NOOP$1}=this.props;dt(),this.program.setUniforms(this.uniforms);const gt=this.program.draw(Object.assign(DRAW_PARAMS,e,{logPriority:_e,uniforms:null,framebuffer:o,parameters:_,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:j,transformFeedback:g,isIndexed:tt,indexType:rt,isInstanced:ct,instanceCount:ft,offset:tt?it:0}));return pt(),log$3.priority>=LOG_DRAW_PRIORITY&&this._logDrawCallEnd(_e,j,o),gt}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:s=!0,feedbackBuffers:o,unbindModels:a=[]}=e;let{parameters:d}=e;o&&this._setFeedbackBuffers(o),s&&(d=Object.assign({},d,{[35977]:s})),a.forEach(g=>g.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:d}))}finally{a.forEach(g=>g.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return log$3.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:s}=this.programProps;if(s)this._managedProgram=!1;else{const{vs:o,fs:a,modules:d,inject:g,defines:_,varyings:j,bufferMode:_e,transpileToGLSL100:et}=this.programProps;s=this.programManager.get({vs:o,fs:a,modules:d,inject:g,defines:_,varyings:j,bufferMode:_e,transpileToGLSL100:et}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}assert$6(s instanceof Program,"Model needs a program"),this._programDirty=!1,s!==this.program&&(this.program=s,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new VertexArray(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const s=this.geometryBuffers[e][0]||this.geometryBuffers[e];s instanceof Buffer&&s.delete()}}_setAnimationProps(e){this.animated&&assert$6(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(isObjectEmpty(e))return this;const{gl:s}=this.program;return this.transformFeedback=this.transformFeedback||new TransformFeedback(s,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const s=e>3?0:LOG_DRAW_TIMEOUT;if(!(Date.now()-this.lastLogTime<s))return this.lastLogTime=Date.now(),log$3.group(LOG_DRAW_PRIORITY,">>> DRAWING MODEL ".concat(this.id),{collapsed:log$3.level<=2})(),e}_logDrawCallEnd(e,s,o,a){if(e===void 0)return;const d=getDebugTableForVertexArray({vertexArray:s,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:g,unusedTable:_,unusedCount:j}=getDebugTableForUniforms({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,o)}),{table:_e,count:et}=getDebugTableForUniforms({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,o),undefinedOnly:!0});et>0&&log$3.log("MISSING UNIFORMS",Object.keys(_e))(),j>0&&log$3.log("UNUSED UNIFORMS",Object.keys(_))();const tt=getDebugTableForProgramConfiguration(this.vertexArray.configuration);log$3.table(e,d)(),log$3.table(e,g)(),log$3.table(e+1,tt)(),a&&a.log({logLevel:LOG_DRAW_PRIORITY,message:"Rendered to ".concat(a.id)}),log$3.groupEnd(LOG_DRAW_PRIORITY)()}}class BufferTransform{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(s),Object.seal(this)}setupResources(e){for(const s of this.bindings)this._setupTransformFeedback(s,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:s}=this;return s.length>0&&(e=Object.assign({},e,{varyings:s})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this.bindings[this.currentIndex],{sourceBuffers:o,transformFeedback:a}=s;return{attributes:Object.assign({},o,e.attributes),transformFeedback:a}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:s}=this.bindings[this.currentIndex],o=e?s[e]:null;return o?o instanceof Buffer?o:o.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:s}=e,o=this.getBuffer(s);return o?o.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&assert$6(isWebGL2$1(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:s={}}=e,o={};if(this.bindings[this.currentIndex]&&Object.assign(o,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const a in this.feedbackMap){const d=this.feedbackMap[a];a in s&&(o[d]=a)}Object.assign(o,e.feedbackBuffers);for(const a in o){const d=o[a];if(typeof d=="string"){const g=s[d],{byteLength:_,usage:j,accessor:_e}=g;o[a]=this._createNewBuffer(a,{byteLength:_,usage:j,accessor:_e})}}return o}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:s=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const o=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:s,feedbackBuffers:o})}_setupTransformFeedback(e,s){let{model:o}=s;const{program:a}=o;e.transformFeedback=new TransformFeedback(this.gl,{program:a,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:s,feedbackBuffers:o}=this._swapBuffers(this.bindings[this.currentIndex]),a=this._getNextIndex();this.bindings[a]=this._updateBinding(this.bindings[a],{sourceBuffers:s,feedbackBuffers:o})}}_updateBinding(e,s){return e?(Object.assign(e.sourceBuffers,s.sourceBuffers),Object.assign(e.feedbackBuffers,s.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},s.sourceBuffers),feedbackBuffers:Object.assign({},s.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const s=Object.assign({},e.sourceBuffers),o=Object.assign({},e.feedbackBuffers);for(const a in this.feedbackMap){const d=this.feedbackMap[a];s[a]=e.feedbackBuffers[d],o[d]=e.sourceBuffers[a],assert$6(o[d]instanceof Buffer)}return{sourceBuffers:s,feedbackBuffers:o}}_createNewBuffer(e,s){const o=new Buffer(this.gl,s);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=o,o}_getNextIndex(){return(this.currentIndex+1)%2}}const SAMPLER_UNIFORM_PREFIX="transform_uSampler_",SIZE_UNIFORM_PREFIX="transform_uSize_",VS_POS_VARIABLE="transform_position";function updateForTextures(i){let{vs:e,sourceTextureMap:s,targetTextureVarying:o,targetTexture:a}=i,g=Object.keys(s).length,_=null;const j={};let _e=e,et={};if(g>0||o){const tt=_e.split(`
`),rt=tt.slice();if(tt.forEach((it,ot,ct)=>{if(g>0){const ft=processAttributeDefinition(it,s);if(ft){const{updatedLine:dt,inject:pt}=ft;rt[ot]=dt,et=combineInjects([et,pt]),Object.assign(j,ft.samplerTextureMap),g--}}o&&!_&&(_=getVaryingType(it,o))}),o){assert$6(a);const it="".concat(SIZE_UNIFORM_PREFIX).concat(o),ot="uniform vec2 ".concat(it,`;
`),ct="     vec2 ".concat(VS_POS_VARIABLE," = transform_getPos(").concat(it,`);
     gl_Position = vec4(`).concat(VS_POS_VARIABLE,`, 0, 1.);
`);et=combineInjects([et,{"vs:#decl":ot,"vs:#main-start":ct}])}_e=rt.join(`
`)}return{vs:_e,targetTextureType:_,inject:et,samplerTextureMap:j}}function getSizeUniforms(i){let{sourceTextureMap:e,targetTextureVarying:s,targetTexture:o}=i;const a={};let d,g;s&&({width:d,height:g}=o,a["".concat(SIZE_UNIFORM_PREFIX).concat(s)]=[d,g]);for(const _ in e)({width:d,height:g}=e[_]),a["".concat(SIZE_UNIFORM_PREFIX).concat(_)]=[d,g];return a}function getAttributeDefinition(i){return getQualifierDetails(i,["attribute","in"])}function getSamplerDeclerations(i){const e="".concat(SAMPLER_UNIFORM_PREFIX).concat(i),s="".concat(SIZE_UNIFORM_PREFIX).concat(i),o="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(s,";");return{samplerName:e,sizeName:s,uniformDeclerations:o}}function getVaryingType(i,e){const s=getQualifierDetails(i,["varying","out"]);return s&&s.name===e?s.type:null}function processAttributeDefinition(i,e){const s={},o=getAttributeDefinition(i);if(!o)return null;const{type:a,name:d}=o;if(d&&e[d]){const g="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:_,sizeName:j,uniformDeclerations:_e}=getSamplerDeclerations(d),et=typeToChannelSuffix(a),tt="  ".concat(a," ").concat(d," = transform_getInput(").concat(_,", ").concat(j,").").concat(et,`;
`);return s[_]=d,{updatedLine:g,inject:{"vs:#decl":_e,"vs:#main-start":tt},samplerTextureMap:s}}return null}const SRC_TEX_PARAMETER_OVERRIDES={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},FS_OUTPUT_VARIABLE="transform_output";class TextureTransform{constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(s),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=this._processVertexShader(e);return Object.assign({},e,s)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:s,sourceTextures:o,framebuffer:a,targetTexture:d}=this.bindings[this.currentIndex],g=Object.assign({},s,e.attributes),_=Object.assign({},e.uniforms),j=Object.assign({},e.parameters);let _e=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){g.transform_elementID=this.elementIDBuffer;for(const tt in this.samplerTextureMap){const rt=this.samplerTextureMap[tt];_[tt]=o[rt]}this._setSourceTextureParameters();const et=getSizeUniforms({sourceTextureMap:o,targetTextureVarying:this.targetTextureVarying,targetTexture:d});Object.assign(_,et)}return this.hasTargetTexture&&(_e=!1,j.viewport=[0,0,a.width,a.height]),{attributes:g,framebuffer:a,uniforms:_,discard:_e,parameters:j}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:s}=this.bindings[this.currentIndex],o=readPixelsToArray(s);if(!e)return o;const a=o.constructor,d=typeToChannelCount(this.targetTextureType),g=new a(o.length*d/4);let _=0;for(let j=0;j<o.length;j+=4)for(let _e=0;_e<d;_e++)g[_++]=o[j+_e];return g}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:s,_swapTexture:o}=e;this._swapTexture=o,this.targetTextureVarying=s,this.hasTargetTexture=s,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:s,textureOrReference:o}=e;if(o instanceof Texture2D)return o;const a=s[o];return a?(this._targetRefTexName=o,this._createNewTexture(a)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:s,_sourceTextures:o={},_targetTexture:a}=e,d=this._createTargetTexture({sourceTextures:o,textureOrReference:a});this.hasSourceTextures=this.hasSourceTextures||o&&Object.keys(o).length>0,this._updateBindings({sourceBuffers:s,sourceTextures:o,targetTexture:d}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const s=new Float32Array(e);s.forEach((o,a,d)=>{d[a]=a}),this.elementIDBuffer?this.elementIDBuffer.setData({data:s}):this.elementIDBuffer=new Buffer(this.gl,{data:s,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:s,targetTexture:o}=this._swapTextures(this.bindings[this.currentIndex]),a=this._getNextIndex();this.bindings[a]=this._updateBinding(this.bindings[a],{sourceTextures:s,targetTexture:o})}}_updateBinding(e,s){const{sourceBuffers:o,sourceTextures:a,targetTexture:d}=s;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,a),Object.assign(e.sourceBuffers,o),d){e.targetTexture=d;const{width:g,height:_}=d,{framebuffer:j}=e;j?(j.update({attachments:{[36064]:d},resizeAttachments:!1}),j.resize({width:g,height:_})):e.framebuffer=new Framebuffer(this.gl,{id:"transform-framebuffer",width:g,height:_,attachments:{[36064]:d}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:s}=this.bindings[e];for(const o in s)s[o].setParameters(SRC_TEX_PARAMETER_OVERRIDES)}_swapTextures(e){if(!this._swapTexture)return null;const s=Object.assign({},e.sourceTextures);s[this._swapTexture]=e.targetTexture;const o=e.sourceTextures[this._swapTexture];return{sourceTextures:s,targetTexture:o}}_createNewTexture(e){const s=cloneTextureFrom(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=s,s}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:s,targetTexture:o}=this.bindings[this.currentIndex],{vs:a,uniforms:d,targetTextureType:g,inject:_,samplerTextureMap:j}=updateForTextures({vs:e.vs,sourceTextureMap:s,targetTextureVarying:this.targetTextureVarying,targetTexture:o}),_e=combineInjects([e.inject||{},_]);this.targetTextureType=g,this.samplerTextureMap=j;const et=e._fs||getPassthroughFS({version:getShaderVersion(a),input:this.targetTextureVarying,inputType:g,output:FS_OUTPUT_VARIABLE}),tt=this.hasSourceTextures||this.targetTextureVarying?[transform].concat(e.modules||[]):e.modules;return{vs:a,fs:et,modules:tt,uniforms:d,inject:_e}}}class Transform{static isSupported(e){return isWebGL2$1(e)}constructor(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(s),Object.seal(this)}delete(){const{model:e,bufferTransform:s,textureTransform:o}=this;e&&e.delete(),s&&s.delete(),o&&o.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:s=!0}=e,o=this._updateDrawOptions(e);s&&o.framebuffer&&o.framebuffer.clear({color:!0}),this.model.transform(o)}swap(){let e=!1;const s=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of s)e=e||o.swap();assert$6(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of s){const a=o.getData(e);if(a)return a}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const s=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of s)o.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:s}=this;this._buildResourceTransforms(s,e),e=this._updateModelProps(e),this.model=new Model(s,Object.assign({},e,{fs:e.fs||getPassthroughFS({version:getShaderVersion(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let s=Object.assign({},e);const o=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const a of o)s=a.updateModelProps(s);return s}_buildResourceTransforms(e,s){canCreateBufferTransform(s)&&(this.bufferTransform=new BufferTransform(e,s)),canCreateTextureTransform(s)&&(this.textureTransform=new TextureTransform(e,s)),assert$6(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let s=Object.assign({},e);const o=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const a of o)s=Object.assign(s,a.getDrawOptions(s));return s}}function canCreateBufferTransform(i){return!!(!isObjectEmpty(i.feedbackBuffers)||!isObjectEmpty(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function canCreateTextureTransform(i){return!!(!isObjectEmpty(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const DRAW_MODE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Geometry{static get DRAW_MODE(){return DRAW_MODE}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:s=uid("geometry"),drawMode:o=DRAW_MODE.TRIANGLES,attributes:a={},indices:d=null,vertexCount:g=null}=e;this.id=s,this.drawMode=o|0,this.attributes={},this.userData={},this._setAttributes(a,d),this.vertexCount=g||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,s){s&&(this.indices=ArrayBuffer.isView(s)?{value:s,size:1}:s);for(const o in e){let a=e[o];a=ArrayBuffer.isView(a)?{value:a}:a,assert$6(ArrayBuffer.isView(a.value),"".concat(this._print(o),": must be typed array or object with value as typed array")),(o==="POSITION"||o==="positions")&&!a.size&&(a.size=3),o==="indices"?(assert$6(!this.indices),this.indices=a):this.attributes[o]=a}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,s){if(s)return s.value.length;let o=1/0;for(const a in e){const d=e[a],{value:g,size:_,constant:j}=d;!j&&g&&_>=1&&(o=Math.min(o,g.length/_))}return assert$6(Number.isFinite(o)),o}}let channelHandles=1,animationHandles=1;class Timeline{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:s=0,duration:o=Number.POSITIVE_INFINITY,rate:a=1,repeat:d=1}=e,g=channelHandles++,_={time:0,delay:s,duration:o,rate:a,repeat:d};return this._setChannelTime(_,this.time),this.channels.set(g,_),g}removeChannel(e){this.channels.delete(e);for(const[s,o]of this.animations)o.channel===e&&this.detachAnimation(s)}isFinished(e){const s=this.channels.get(e);return s===void 0?!1:this.time>=s.delay+s.duration*s.repeat}getTime(e){if(e===void 0)return this.time;const s=this.channels.get(e);return s===void 0?-1:s.time}setTime(e){this.time=Math.max(0,e);const s=this.channels.values();for(const a of s)this._setChannelTime(a,this.time);const o=this.animations.values();for(const a of o){const{animation:d,channel:g}=a;d.setTime(this.getTime(g))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,s){const o=animationHandles++;return this.animations.set(o,{animation:e,channel:s}),e.setTime(this.getTime(s)),o}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,s){const o=s-e.delay,a=e.duration*e.repeat;o>=a?e.time=e.duration*e.rate:(e.time=Math.max(0,o)%e.duration,e.time*=e.rate)}}class MultiLineChart extends SVGChart{constructor(e,s,o){const a=e.getColumnName(o.param[0]);o.axis||(o.axis={x:{size:30,label:a,textsize:13},y:{size:45,label:"density",textsize:13}}),o.title||(o.title=a),o.scaletrim&&!o.band_width&&(o.band_width=.1),super(e,s,o,{x:{},y:{type:o.stacked?"band":"linear"}}),this.config.type="multi_line_chart";const d=this.config;d.color_legend||(d.color_legend={display:!d.stacked});let g=this.dataStore.getMinMaxForColumn(d.param[0]),_=g.slice(0);o.scaletrim&&(_=[0,1]),this.x_scale.domain(_),this.defaultBandWidth=(g[1]-g[0])/100,d.band_width=d.band_width||this.defaultBandWidth,d.intervals=d.intervals||40,this.dim=this.dataStore.getDimension("catrange_dimension"),this.data=[],this.addToolTip(),this.setColorLegend(),this.stackLines(d.stacked),this.scaleTrim(d.scaletrim),this.onDataFiltered()}stackLines(e){this.config.stacked=e,e?(this.y_scale=band(),this.y_axis_call=axisLeft(this.y_scale),this.config.color_legend.display=!1,this.setColorLegend(),this.y_scale.domain(this.dataStore.getColumnValues(this.config.param[1]))):(this.y_scale=linear$1(),this.y_axis_call=axisLeft(this.y_scale),this.y_scale.domain([1,0]))}changeCategories(e,s,o){this.config.param[1]=e,this.onDataFiltered()}scaleTrim(e){const s=this.config;if(!e||e==="none"){delete s.scaletrim;const o=this.dataStore.getMinMaxForColumn(s.param[0]);this.x_scale.domain(o)}else s.scaletrim=e+"",this.x_scale.domain([0,1]),s.band_width=.1}getColorLegend(){return this.dataStore.getColorLegend(this.config.param[1])}onDataFiltered(e){if(!this.isPinned&&e!==this.dim){e==="all_removed"&&(this.resetButton.style.display="none");const s=this.config;this.ticks=this.x_scale.ticks(s.intervals),this.dim.getKernalDensity(o=>{this.data=o,this.drawChart()},[s.param[1],s.param[0]],{ticks:this.ticks,bandwidth:s.band_width,intervals:s.intervals,scaletrim:s.scaletrim})}}remove(e=!0){this.dim.destroy(e),super.remove()}drawChart(){const e=this.config,s=this.dataStore.getColumnValues(e.param[1]),o=select(this.contentDiv).transition().duration(400).ease(linear),a=this._getContentDimensions(),d=[],g=a.height/this.data.length,_=[];for(let rt=0;rt<this.data.length;rt++){const it=e.stacked?g/this.data[rt].max:a.height/this.data[rt].max,ot=e.stacked?this.data[rt].map(ct=>g*rt+g-ct*it):this.data[rt].map(ct=>a.height-ct*it);ot.id=this.data[rt].id,_.push(s[ot.id]),d.push(ot)}this.y_scale.domain(_),this.updateAxis();const j=this.ticks.map(rt=>this.x_scale(rt)),_e=this,et=this.dataStore.getColumnColors(this.config.param[1]);this.graph_area.selectAll(".chart-line").data(d).join("path").attr("class","chart-line").on("mouseover mousemove",(rt,it)=>{const ot=s[it.id];_e.showToolTip(rt,ot)}).on("mouseout",()=>{_e.hideToolTip()}).transition(o).attr("fill","none").attr("stroke",(rt,it)=>et[rt.id]).attr("stroke-width",2).attr("stroke-linejoin","round").attr("d",line().x((rt,it)=>j[it]).y((rt,it)=>rt)),e.fill?(area().x(function(rt,it){return j[it]}).y0(function(rt,it){return rt}).y1((rt,it)=>{e.stacked?g*rt.id+g:a.height}),this.graph_area.selectAll(".chart-area").data(d).join("path").attr("class","chart-area").transition(o).attr("fill",rt=>et[rt.id]).style("opacity",.5).attr("d",function(rt,it){return area().x(function(ot,ct){return j[ct]}).y0(function(ot){return ot}).y1(ot=>e.stacked?g*it+g:a.height)(rt)})):this.graph_area.selectAll(".chart-area").remove()}unpinChart(){super.unpinChart(),this.onDataFiltered()}setSize(e,s){super.setSize(e,s),this.drawChart()}getSettings(){const e=super.getSettings(),s=this.config,o=this.dataStore.getMinMaxForColumn(s.param[0]),a=this.dataStore.getColumnList("text");return e.splice(1,0,{type:"dropdown",current_value:s.param[1],label:"Change Cetegories (y axis)",values:[a,"name","field"],func:d=>{this.changeCategories(d,"val1","val2")}},{type:"check",current_value:s.stacked,label:"Stack Lines",func:d=>{this.stackLines(d),this.drawChart()}},{type:"check",current_value:s.fill,label:"Fill Lines",func:d=>{s.fill=d,this.drawChart()}},{type:"radiobuttons",label:"Scale/Trim to Percentile",current_value:s.scaletrim||"none",choices:[["No Trim","none"],["0.001","0.001"],["0.01","0.01"],["0.05","0.05"]],func:d=>{this.scaleTrim(d),this.onDataFiltered()}},{type:"slider",max:o[1]/10,min:o[0]<0?0:o[0],doc:this.__doc__,current_value:s.band_width,label:"Band Width",func:d=>{s.band_width=d,this.onDataFiltered()}},{type:"slider",max:100,min:10,step:1,doc:this.__doc__,current_value:s.intervals,label:"Intervals",func:d=>{s.intervals=d,this.onDataFiltered()}},{label:"Show Color Legend",type:"check",current_value:s.color_legend?s.color_legend.display:!0,func:d=>{s.color_legend.display=d,this.setColorLegend()}}),e}}BaseChart.types.multi_line_chart={class:MultiLineChart,name:"Multi Line Chart",methodsUsingColumns:["changeCategories"],params:[{type:"number",name:"Value (X axis)"},{type:"text",name:"Categories to show"}]};class DensityScatterPlot extends WGLScatterPlot{afterAppCreation(){this.contentDiv.prepend(this.app.div_container),this.svg.style("position","absolute").style("pointer-events","none");const e=this.config;e.contour_bandwidth=e.contour_bandwidth||5,e.contour_intensity=e.contour_intensity||.7,e.contour_opacity=e.contour_opacity||1;const s=e.param,o=this.dataStore.getMinMaxForColumn(s[0]),a=this.dataStore.getMinMaxForColumn(s[1]),d=o[1]-o[0],g=a[1]-a[0];return this.whRatio=d/g,this.catKeys=[-1,-1],this.data=[null,null],this.orig_y_scale=this.y_scale.domain(),this.orig_x_scale=this.x_scale.domain(),this.or_y_scale=[0,400/this.whRatio],this.or_x_scale=[0,400],this.app.addHandler("pan_or_zoom",(_,j,_e)=>{this._updateScale(this.app.getRange()),this._rescaleSVG()},e.id),super.afterAppCreation()}getDimension(){return this.dataStore.getDimension("density_dimension")}onDataFiltered(e){const s=this.config,o=s.param;super.onDataFiltered(e);const a=this.dataStore.getColumnValues(s.param[2]);if(this.catKeys=[a.indexOf(s.category1),a.indexOf(s.category2)],this.catKeys[0]===-1&&this.catKeys[1]===-1){this.data=[null,null];return}const d={categories:this.catKeys,yscale:[this.orig_y_scale,this.or_y_scale],xscale:[this.orig_x_scale,this.or_x_scale],bandwidth:this.config.contour_bandwidth};this.dim.getDensityContours(g=>{this.data=g,this.drawChart(),this._rescaleSVG()},o,d)}setSize(e,s){super.setSize(e,s),this._rescaleSVG()}_drawContours(e,s,o){const a=`dp-poly-${o}`,d=this.config;this.graph_area.selectAll("."+a).data(this.data[o]).join("path").attr("class",a).attr("stroke",d.contour_fill?"none":e).style("opacity",d.contour_opacity).attr("stroke-linejoin","round").attr("d",geoPath()).attr("fill",g=>d.contour_fill?s(g.value):"none")}removeCategory(e){delete this.config["category"+e],this.data[e-1]=null,this.catKeys[e-1]=-1,this.graph_area.selectAll(`.dp-poly-${e-1}`).remove()}changeContourParameter(e){this.config.param[2]=e,this.removeCategory(1),this.removeCategory(2),this.drawChart()}drawChart(e=400){const s=this.config;for(let o in this.catKeys){let a=this.catKeys[o];if(a===-1)this.graph_area.selectAll(`.dp-poly-${o}`).remove();else{let d=this.dataStore.getColumnColors(s.param[2])[a],g=linear$1([0,1-s.contour_intensity],["white",d]);this._drawContours(d,g,o)}}}_rescaleSVG(){const e=this.x_scale.domain(),s=e[1]-e[0],o=this.x_scale.range()[1]/this.or_x_scale[1],a=(this.orig_x_scale[1]-this.orig_x_scale[0])/s*o,d=linear$1().domain(e).range(this.or_x_scale),g=d(e[0])-d(this.orig_x_scale[0])*o,_=this.y_scale.domain(),j=_[0]-_[1],_e=this.y_scale.range()[1]/this.or_y_scale[1],et=(this.orig_y_scale[0]-this.orig_y_scale[1])/j*_e,tt=linear$1().domain(_).range(this.or_y_scale),rt=tt(_[0])-tt(this.orig_y_scale[0])*_e,it=this.margins.left,ot=this.margins.top;this.graph_area.attr("transform",`translate(${it-g},${ot-rt}) scale(${a},${et})  `)}getSettings(){const e=super.getSettings(),s=this.config,o=this.dataStore.getColumnList("text");let a=this.dataStore.getColumnValues(s.param[2]);return a=a.map(d=>({t:d})),a.push({t:"None"}),e.push({type:"dropdown",label:"Contour Parameter",current_value:this.dataStore.getColumnName(s.param[2]),values:[o,"name","field"],func:d=>{this.changeContourParameter(d)},onchange:(d,g)=>{const j=this.dataStore.getColumnValues(g).slice(0);j.push("None");for(let _e of["Contour Category 1","Contour Category 2"]){d[_e].innerHTML="";for(let et of j)createEl("option",{text:et,value:et},d[_e]);d[_e].value="None"}}},{type:"dropdown",label:"Contour Category 1",current_value:s.category1||"None",values:[a,"t","t"],func:d=>{d==="None"?this.removeCategory(1):s.category1=d,this.onDataFiltered()}},{type:"dropdown",label:"Contour Category 2",current_value:s.category2||"None",values:[a,"t","t"],func:d=>{d==="None"?this.removeCategory(2):s.category2=d,this.onDataFiltered()}},{type:"slider",max:25,min:1,doc:this.__doc__,current_value:s.contour_bandwidth,label:"KDE Bandwidth",func:d=>{s.contour_bandwidth=d,this.onDataFiltered()}},{label:"Fill Contours",type:"check",current_value:s.contour_fill,func:d=>{s.contour_fill=d,this.drawChart()}},{type:"slider",max:1,min:0,doc:this.__doc__,current_value:s.contour_intensity,label:"Fill Intensity",func:d=>{s.contour_intensity=d,this.drawChart()}},{type:"slider",max:1,min:0,doc:this.__doc__,current_value:s.contour_opacity,label:"Contour opacity",func:d=>{s.contour_opacity=d,this.drawChart()}}),e}}BaseChart.types.density_scatter_plot={name:"Density Scatter Plot",class:DensityScatterPlot,params:[{type:"number",name:"X axis"},{type:"number",name:"Y axis"},{type:"text",name:"Category Column"}]};class SelectionDialog extends BaseChart{constructor(e,s,o){super(e,s,o);const a=this.config,d=a.param;this.dims={},this.textFilters={},this.numberFilters={},a.filters=a.filters||{},this.hasFiltred=!1,this.contentDiv.style.overflowY="auto";for(let g of d){const _=e.columnIndex[g],j=createEl("div",{styles:{padding:"5px"}},this.contentDiv);j.__fcol__=_.field,createEl("div",{text:_.name,classes:["i-title"],styles:{fontWeight:"bold"}},j),_.datatype==="text"?this.addTextFilter(_,j):_.datatype==="multitext"?this.addMultiTextFilter(_,j):(_.datatype==="integer"||_.datatype==="double")&&this.addNumberFilter(_,j)}makeSortable(this.contentDiv,{handle:"i-title",sortEnded:g=>{this.config.param=g.map(_=>_.__fcol__)}}),this.hasFiltered&&setTimeout(()=>this.dataStore.triggerFilter(),0)}removeFilter(){const e=this.config.filters;for(let s in this.textFilters){const o=this.textFilters[s],a=e[s].operand;a?o[1].innerHTML="":(o[0].value="__none__",o[1].checked=!1),e[s].category=a?[]:"__none__",e[s].exclude=!1}for(let s in this.numberFilters){const o=this.dataStore.getMinMaxForColumn(s);this.numberFilters[s].noUiSlider.set([o[0],o[1]]),e[s]=null}this.resetButton.style.display="none";for(let s in this.dims)this.dims[s].removeFilter(!1);this.dataStore.triggerFilter()}onDataFiltered(e){}addNumberFilter(e,s){const o=createEl("div",{styles:{margin:"10px 10px"}},s),a=createEl("div",{styles:{padding:"3px 10px",overflow:"hidden"}},s);createEl("span",{text:">",styles:{float:"left",fontWeight:"bold"}},a);const d=createEl("input",{styles:{width:"70px",float:"left"}},a);createEl("span",{text:"<",styles:{float:"right",fontWeight:"bold"}},a);const g=createEl("input",{styles:{width:"70px",float:"right"}},a),_=this.config,j=this.dataStore.getDimension("range_dimension");j.noclear=!0,this.dims[e.field]=j;const _e=this.dataStore.getMinMaxForColumn(e.field),et=_.filters[e.field];let tt=[_e[0],_e[1]];et&&(tt=[et[0],et[1]]),noUiSlider.create(o,{start:[tt[0],tt[1]],range:{min:_e[0],max:_e[1]},tooltips:!0,documentElement:this.__doc__}),o.noUiSlider.on("set",rt=>{const it=parseFloat(rt[0]),ot=parseFloat(rt[1]);it<=_e[0]&&ot>=_e[1]?_.filters[e.field]=null:_.filters[e.field]=[it,ot],g.value=ot,d.value=it,this.filterCategories(e.field)}),g.value=tt[1],d.value=tt[0],d.addEventListener("blur",rt=>{let it=parseFloat(d.value);const ot=o.noUiSlider.get();isNaN(it)||it>ot[1]||(it=it<_e[0]?_e[0]:it,o.noUiSlider.set([it,ot[1]],!0,!0))}),d.addEventListener("keypress",rt=>{rt.key==="Enter"&&d.blur()}),g.addEventListener("blur",rt=>{let it=parseFloat(g.value);const ot=o.noUiSlider.get();isNaN(it)||it<ot[0]||(it=it>_e[1]?_e[1]:it,o.noUiSlider.set([ot[0],it],!0,!0))}),g.addEventListener("keypress",rt=>{rt.key==="Enter"&&g.blur()}),et&&(this.filterCategories(e.field,!1),this.hasFiltered=!0),this.numberFilters[e.field]=o}filterCategories(e,s=!0){const o=this.config.filters[e],a=this.dataStore.columnIndex[e].datatype;if(a==="text")if(o.category==="__none__")this.dims[e].removeFilter();else{let d=[o.category];o.exclude&&(d=this.dataStore.getColumnValues(e).filter(g=>g!==o.category)),this.resetButton.style.display="inline",this.dims[e].filter("filterCategories",[e],d,s)}else if(a==="multitext")if(o.category.length===0)this.dims[e].removeFilter();else{this.resetButton.style.display="inline";const d=o.category.slice(0);d.operand=o.operand,this.dims[e].filter("filterCategories",[e],d,s)}else o?(this.resetButton.style.display="inline",this.dims[e].filter("filterRange",[e],{min:o[0],max:o[1]},s)):this.dims[e].removeFilter()}createTag(e,s,o,a=!0){a&&this.config.filters[s.field].category.push(o);const d=createEl("div",{},e);createEl("span",{text:o},d),createEl("i",{classes:["fas","fa-times"]},d).addEventListener("click",_=>{this.config.filters[s.field].category=this.config.filters[s.field].category.filter(j=>j!==o),console.log(this.config.filters[s.field].category),d.remove(),this.filterCategories(s.field)})}addMultiTextFilter(e,s){let o=createEl("div",{style:{whiteSpace:"nowrap"}},s);const a=this.config,d=this.dataStore.getDimension("category_dimension");d.noclear=!0,this.dims[e.field]=d,a.filters[e.field]?(this.filterCategories(e.field,!1),this.hasFiltered=!0):a.filters[e.field]={operand:"or",category:[]};const g=a.filters[e.field],_=createEl("select",{classes:["mdv-select"],styles:{maxWidth:"200px"}});for(let it of e.values.slice(0).sort())createEl("option",{text:it,value:it},_);o.append(_);const j=createEl("button",{classes:["ciview-button-sm"],text:"Add"},o),_e=createEl("div",{},o);j.addEventListener("click",it=>{g.category.indexOf(_.value)===-1&&(this.createTag(_e,e,_.value),this.filterCategories(e.field))}),o=createEl("div",{},s);const et=getRandomString();createEl("span",{text:"and"},o);const tt=createEl("input",{type:"radio",name:et,value:"and"},o);tt.checked=g.operand==="and",tt.addEventListener("click",it=>{g.operand="and",this.filterCategories(e.field)}),createEl("span",{text:"or"},o);const rt=createEl("input",{type:"radio",name:et,value:"or"},o);rt.checked=g.operand==="or",rt.addEventListener("click",it=>{g.operand="or",this.filterCategories(e.field)});for(let it of g.category)this.createTag(_e,e,it,!1);this.textFilters[e.field]=[_,_e]}addTextFilter(e,s){s.style.whiteSpace="nowrap";const o=this.config,a=this.dataStore.getDimension("category_dimension");a.noclear=!0,this.dims[e.field]=a,o.filters[e.field]?(this.filterCategories(e.field,!1),this.hasFiltered=!0):o.filters[e.field]={exclude:!1,category:"__none__"};const d=o.filters[e.field],g=createEl("select",{classes:["mdv-select"],styles:{maxWidth:"200px"}});createEl("option",{text:"None",value:"__none__"},g);for(let j of e.values)createEl("option",{text:j,value:j},g);s.append(g),g.value=d.category,g.addEventListener("change",j=>{d.category=g.value,this.filterCategories(e.field)});const _=createEl("input",{classes:["mdv-checkbox"],type:"checkbox"},s);_.checked=d.exclude,_.addEventListener("click",j=>{d.exclude=_.checked,this.filterCategories(e.field)}),createEl("span",{text:"exclude",style:{fontSize:"11px",verticalAlign:"middle"}},s),this.textFilters[e.field]=[g,_]}remove(e=!0){for(let s in this.dims)this.dims[s].destroy(!1);e&&this.dataStore.triggerFilter(),super.remove()}}BaseChart.types.selection_dialog={name:"Selection Dialog",class:SelectionDialog,params:[{type:"_multi_column:all",name:"Columns To filter"}]};class AutoComplete{constructor(e,s,o={}){this.__doc__=o.doc||document,this.input=e,this.listeners=[],o.minLength=o.minLength||2,this.input.addEventListener("input",a=>{this.input.value.length<o.minLength||(this.text=this.input.value,s(this.text).then(d=>{this.list=d,this.createDropDown()}))}),this.dli=a=>{a.target.parent!==this.lisHolder&&this.listHolder&&(this.listHolder.remove(),this.listHolder=null)},this.__doc__.addEventListener("mousedown",this.dli)}getSelectedItem(){return this.selectedItem}addListener(e){this.listeners.push(e)}destroy(){this.listholder&&this.listholder.remove(),this.__doc__.removeEventListener("click",this.dli)}setSelectedItem(e,s=!0){this.selectedItem=e,this.input.value=e.value,s&&this.listeners.map(o=>o("item_chose",e))}addItemEventListener(e,s){e.addEventListener("click",o=>{this.listHolder.remove(),this.listHolder=null,this.setSelectedItem(s)})}createDropDown(){if(this.listHolder&&this.listHolder.remove(),!this.text)return;const e=getElDim(this.input);this.listHolder=createEl("div",{classes:["autocomplete-items"],styles:{top:e.top+e.height+"px",left:e.left+"px",width:e.width+"px",zIndex:1200}},this.__doc__.body);for(let s=0;s<this.list.length;s++){const o=this.list[s].value;let a=createEl("div",{text:o},this.listHolder);this.addItemEventListener(a,this.list[s])}}}const max_genes=500;class AddColumnsFromRowsDialog extends BaseDialog{constructor(e,s,o,a){const d={title:`Add ${o.name}`,footer:!0,columns:2,width:380};super(d,{ds:e,ds_to:s,link:o,cm:a})}init(e){this.ds=e.ds,this.ds_to=e.ds_to,this.link=e.link,this.cm=e.cm;const s=createEl("div",{classes:["mdv-section"]},this.columns[0]),o=createEl("input",{},s);this.ac=new AutoComplete(o,async j=>this.ds_to.dataStore.getSuggestedValues(j,this.link.name_column,8)),this.ac.addListener((j,_e)=>this.addColumn(_e)),this.rn=getRandomString();for(let j in this.link.subgroups)createEl("label",{text:this.link.subgroups[j].label},this.footer),createEl("input",{type:"radio",name:this.rn,value:j,checked:!0},this.footer);this._addOptionsSection(),createEl("button",{classes:["ciview-button-sm"],styles:[],text:"Apply"},this.columns[0]).addEventListener("click",()=>{this.addColumn(this.ac.getSelectedItem())}),this.ta=createEl("textarea",{rows:10},this.columns[1]),this.errorDiv=createEl("div",{classes:["mdv-section"]},this.columns[1]);let d=createEl("div",{classes:["mdv-section"]},this.columns[1]);this.addHeatMapCheck=createEl("input",{type:"checkbox"},d),createEl("span",{text:"Create Heat Map:",styles:{marginRight:"4px"}},d),d=createEl("div",{classes:["mdv-section"]},this.columns[1]),createEl("span",{text:"Categories:",styles:{marginRight:"4px"}},d),this.heatMapSel=createEl("select",{styles:{maxWidth:"150px"}},d),this.ds.dataStore.getColumnList("text").forEach(j=>createEl("option",{value:j.field,text:j.name},this.heatMapSel)),createEl("button",{classes:["ciview-button-sm"],text:"Add All"},this.columns[1]).addEventListener("click",j=>{this.parseNames()}),this.cm.addListener(this.rn,(j,_e,et)=>{switch(j){case"chart_added":this._addColorChartOption(et);break;case"chart_removed":this._addColorChartOption(et,!0);break;case"filtered":console.log("ss");break;case"view_laoded":this.close()}}),this.itemList=[];const _=this.ds_to.dataStore;_.addListener(this.rn,(j,_e)=>{if(j==="data_highlighted"){const et=_e.indexes.length;if(et==1){const tt=_e.indexes[0],rt=_.getRowText(tt,this.link.name_column);this.ac.setSelectedItem({value:rt,index:tt})}else et<200?this.ta.value=_e.indexes.map(tt=>_.getRowText(tt,this.link.name_column)).join(`
`):this.ta.value="Too many items selected"}else j==="filtered"&&(_.filterSize<max_genes&&_.isFiltered()?this.ta.value=_.getFilteredValues(this.link.name_column).join(`
`):this.ta.value="Too many items selected")})}addFilteredItems(){const e=this.ds_to.dataStore;for(let s=0;s<e.size;s++)e.filterArray[s]===0&&(this.itemList.push(s),createEl("div",{text:e.getRowText(s,this.link.name_column)},this.columns[1]))}close(){this.cm.removeListener(this.rn),this.ds_to.dataStore.removeListener(this.rn),this.ac.destroy(),super.close()}_addColorChartOption(e,s=!1){const o=e.config;if(!(e.dataStore!==this.ds.dataStore||!e.getColorOptions().colorby)){if(s){const a=this.colorChartSelect.querySelector(`[value='${o.id}']`);a&&a.remove(),this.colorChartSelect.children.length===0&&this.colorDiv.classList.add("mdv-disabled");return}createEl("option",{value:o.id,text:o.title},this.colorChartSelect),this.colorDiv.classList.remove("mdv-disabled")}}_addOptionsSection(){this.colorDiv=createEl("div",{classes:["mdv-section","mdv-disabled"]},this.columns[0]),this.colorCheck=createEl("input",{type:"checkbox"},this.colorDiv),createEl("span",{text:"Color Chart:",styles:{marginRight:"4px"}},this.colorDiv),createEl("br",{},this.colorDiv),this.colorChartSelect=createEl("select",{styles:{maxWidth:"150px"}},this.colorDiv);for(let s in this.cm.charts)this._addColorChartOption(this.cm.charts[s].chart);const e=createEl("div",{classes:["mdv-section"]},this.columns[0]);this.histoCheck=createEl("input",{type:"checkbox"},e),createEl("span",{text:"Create Histogram:",styles:{marginRight:"4px"}},e)}parseNames(){let e=this.ta.value.replaceAll('"',"").split(/[,\s]+/);e=e.filter(d=>d!=="");const s=this.ds_to.dataStore.getColumnIndex(this.link.name_column);let o=!1;const a=new Array(e.length);for(let d=0;d<e.length;d++){const g=s[e[d]];g!==void 0?a[d]={value:e[d],index:g}:(o=!0,e[d]=e[d]+"??")}o?(this.errorDiv.textContent="Some Entries were unrecognised",this.ta.value="",this.ta.value=e.join(`
`)):(this.errorDiv.textContent="",this.addColumn(a))}addColumn(e){const o=document.querySelector(`input[name='${this.rn}']:checked`).value,a=Array.isArray(e),d=a?e:[e],g=[];for(let _ of d){const j=`${o}|${_.value}(${o})|${_.index}`;if(this.ds.dataStore.addColumnFromField(j),g.push(j),!a){if(this.colorCheck.checked){const _e=this.colorChartSelect.value;_e&&this.cm.getChart(_e).colorByColumn(j)}this.histoCheck.checked&&this.cm.addChart(this.ds.name,{type:"bar_chart",param:j});return}}this.addHeatMapCheck.checked&&this.cm.addChart(this.ds.name,{type:"heat_map",param:[this.heatMapSel.value].concat(g)})}}class ColorChooser extends BaseDialog{constructor(e,s){const o={footer:!0,width:500,maxHeight:500,title:"Field Colors For "+s.name,columns:2,buttons:[{text:"Apply",method:"applyColor"}]};super(o,{cm:e,ds:s})}init(e){this.cm=e.cm,this.ds=e.ds;const s=this.columns[1];this.columns[0].style.overflowY="auto";const o={whiteSpace:"nowrap",padding:"2px"};createEl("div",{styles:o},s);const a={width:"70px",display:"inline-block"},d=createEl("div",{styles:o},s);createEl("label",{text:"Field:",styles:a},d),this.columnSelect=createEl("select",{classes:["mdv-select"],styles:{maxWidth:"150px"}},d);const g=createEl("div",{styles:o},s);createEl("div",{text:"Color Scheme",styles:{fontWeight:"bold"}},g),createEl("span",{classes:["mdv-info-text"],text:"Paste list of colors (hex)"},g);const _=createEl("div",{styles:{display:"flex",alignItems:"flex-start",marginTop:"2px"}},s);this.colorList=createEl("textarea",{classes:["mdv-select"],styles:{width:"100px",padding:"2px",height:"150px"}},_),this.setDataSource(this.ds.dataStore.name),createEl("button",{classes:["ciview-button-sm"],text:"Use Scheme"},_).addEventListener("click",()=>{this.parseColors(this.colorList.value)})}parseColors(e){const s=/^#[0-9A-F]{6}$/i;let o=e.replaceAll('"',"").split(/[,\s]+/);o=o.filter(g=>g.match(s));const a=o.join(`
`);this.colorList.value=a;let d=0;if(a.length>0)for(let g=0;g<this.colorChoosers.length;g++)this.colorChoosers[g].value=o[d],d++,d===o.length&&(d=0)}setDataSource(e){this.columnSelect.innerHTML="";const s=this.cm.getDataSource(e);this.dataSource=s,this.dsName=e;const o=s.getColumnList("text");for(let a of o)createEl("option",{text:a.name,value:a.field},this.columnSelect);this.columnSelect.addEventListener("change",()=>{this.setColumn(this.columnSelect.value)}),this.setColumn(o[0].field)}applyColor(){const e=new Array(this.colorChoosers.length);this.colorChoosers.forEach(s=>e[s.__index]=s.value),this.dataSource.setColumnColors(this.column,e),this.dataSource.dataChanged([this.column],!1,!1);for(let s of this.cm.dataSources){const o=s.dataStore,a=o.syncColumnColors.find(g=>g.dataSource===this.dataSource.name);if(a){const g=a.columns.find(_=>_.link_to===this.column);g&&(this.cm._sync_colors([g],this.dataSource,o),o.dataChanged([g.col],!1,!1))}const d=o.linkColumns.find(g=>g.dataSource===this.dataSource.name);d&&d.columns.indexOf(this.column)!==-1&&(o.setColumnColors(this.column,e),o.dataChanged([this.column],!1,!1))}}setColumn(e){const s=this.columns[0];this.column=e,s.innerHTML="";const o=this.dataSource.getColumnValues(e),a=o.slice(0).sort(),d=this.dataSource.getColumnColors(e),g=d.map((_,j)=>{const _e=o.indexOf(a[j]);return{index:_e,color:d[_e]}});this.colorChoosers=[];for(let _=0;_<a.length;_++){const j=createEl("div",{styles:{display:"flex",flexWrap:"nowrap"}},s);createEl("span",{styles:{display:"inline-block",fontSize:"0.8erm"},classes:["mdv-flex-dynamic"],text:a[_]},j);const _e=createEl("input",{classes:["mdv-flex-fixed"],styles:{width:"25px",height:"20px",padding:"0px"},type:"color",value:g[_].color},j);_e.__index=g[_].index,this.colorChoosers.push(_e)}}}const gridstack_min="";var gridstack={},gridstackEngine={},utils={};Object.defineProperty(utils,"__esModule",{value:!0});utils.Utils=utils.obsoleteAttr=utils.obsoleteOptsDel=utils.obsoleteOpts=utils.obsolete=void 0;function obsolete(i,e,s,o,a){let d=(...g)=>(console.warn("gridstack.js: Function `"+s+"` is deprecated in "+a+" and has been replaced with `"+o+"`. It will be **removed** in a future release"),e.apply(i,g));return d.prototype=e.prototype,d}utils.obsolete=obsolete;function obsoleteOpts(i,e,s,o){i[e]!==void 0&&(i[s]=i[e],console.warn("gridstack.js: Option `"+e+"` is deprecated in "+o+" and has been replaced with `"+s+"`. It will be **removed** in a future release"))}utils.obsoleteOpts=obsoleteOpts;function obsoleteOptsDel(i,e,s,o){i[e]!==void 0&&console.warn("gridstack.js: Option `"+e+"` is deprecated in "+s+o)}utils.obsoleteOptsDel=obsoleteOptsDel;function obsoleteAttr(i,e,s,o){let a=i.getAttribute(e);a!==null&&(i.setAttribute(s,a),console.warn("gridstack.js: attribute `"+e+"`="+a+" is deprecated on this object in "+o+" and has been replaced with `"+s+"`. It will be **removed** in a future release"))}utils.obsoleteAttr=obsoleteAttr;class Utils{static getElements(e){if(typeof e=="string"){let s=document.querySelectorAll(e);return!s.length&&e[0]!=="."&&e[0]!=="#"&&(s=document.querySelectorAll("."+e),s.length||(s=document.querySelectorAll("#"+e))),Array.from(s)}return[e]}static getElement(e){if(typeof e=="string"){if(!e.length)return null;if(e[0]==="#")return document.getElementById(e.substring(1));if(e[0]==="."||e[0]==="[")return document.querySelector(e);if(!isNaN(+e[0]))return document.getElementById(e);let s=document.querySelector(e);return s||(s=document.getElementById(e)),s||(s=document.querySelector("."+e)),s}return e}static isIntercepted(e,s){return!(e.y>=s.y+s.h||e.y+e.h<=s.y||e.x+e.w<=s.x||e.x>=s.x+s.w)}static isTouching(e,s){return Utils.isIntercepted(e,{x:s.x-.5,y:s.y-.5,w:s.w+1,h:s.h+1})}static areaIntercept(e,s){let o=e.x>s.x?e.x:s.x,a=e.x+e.w<s.x+s.w?e.x+e.w:s.x+s.w;if(a<=o)return 0;let d=e.y>s.y?e.y:s.y,g=e.y+e.h<s.y+s.h?e.y+e.h:s.y+s.h;return g<=d?0:(a-o)*(g-d)}static area(e){return e.w*e.h}static sort(e,s,o){return o=o||e.reduce((a,d)=>Math.max(d.x+d.w,a),0)||12,s===-1?e.sort((a,d)=>d.x+d.y*o-(a.x+a.y*o)):e.sort((a,d)=>a.x+a.y*o-(d.x+d.y*o))}static createStylesheet(e,s){let o=document.createElement("style");return o.setAttribute("type","text/css"),o.setAttribute("gs-style-id",e),o.styleSheet?o.styleSheet.cssText="":o.appendChild(document.createTextNode("")),s?s.insertBefore(o,s.firstChild):(s=document.getElementsByTagName("head")[0],s.appendChild(o)),o.sheet}static removeStylesheet(e){let s=document.querySelector("STYLE[gs-style-id="+e+"]");s&&s.parentNode&&s.remove()}static addCSSRule(e,s,o){typeof e.addRule=="function"?e.addRule(s,o):typeof e.insertRule=="function"&&e.insertRule(`${s}{${o}}`)}static toBool(e){return typeof e=="boolean"?e:typeof e=="string"?(e=e.toLowerCase(),!(e===""||e==="no"||e==="false"||e==="0")):!!e}static toNumber(e){return e===null||e.length===0?void 0:Number(e)}static parseHeight(e){let s,o="px";if(typeof e=="string"){let a=e.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw|%)?$/);if(!a)throw new Error("Invalid height");o=a[2]||"px",s=parseFloat(a[1])}else s=e;return{h:s,unit:o}}static defaults(e,...s){return s.forEach(o=>{for(const a in o){if(!o.hasOwnProperty(a))return;e[a]===null||e[a]===void 0?e[a]=o[a]:typeof o[a]=="object"&&typeof e[a]=="object"&&this.defaults(e[a],o[a])}}),e}static same(e,s){if(typeof e!="object")return e==s;if(typeof e!=typeof s||Object.keys(e).length!==Object.keys(s).length)return!1;for(const o in e)if(e[o]!==s[o])return!1;return!0}static copyPos(e,s,o=!1){return e.x=s.x,e.y=s.y,e.w=s.w,e.h=s.h,o&&(s.minW&&(e.minW=s.minW),s.minH&&(e.minH=s.minH),s.maxW&&(e.maxW=s.maxW),s.maxH&&(e.maxH=s.maxH)),e}static samePos(e,s){return e&&s&&e.x===s.x&&e.y===s.y&&e.w===s.w&&e.h===s.h}static removeInternalAndSame(e,s){if(!(typeof e!="object"||typeof s!="object"))for(let o in e){let a=e[o];if(o[0]==="_"||a===s[o])delete e[o];else if(a&&typeof a=="object"&&s[o]!==void 0){for(let d in a)(a[d]===s[o][d]||d[0]==="_")&&delete a[d];Object.keys(a).length||delete e[o]}}}static removeInternalForSave(e,s=!0){for(let o in e)(o[0]==="_"||e[o]===null||e[o]===void 0)&&delete e[o];delete e.grid,s&&delete e.el,e.autoPosition||delete e.autoPosition,e.noResize||delete e.noResize,e.noMove||delete e.noMove,e.locked||delete e.locked,(e.w===1||e.w===e.minW)&&delete e.w,(e.h===1||e.h===e.minH)&&delete e.h}static closestUpByClass(e,s){for(;e;){if(e.classList.contains(s))return e;e=e.parentElement}return null}static throttle(e,s){let o=!1;return(...a)=>{o||(o=!0,setTimeout(()=>{e(...a),o=!1},s))}}static removePositioningStyles(e){let s=e.style;s.position&&s.removeProperty("position"),s.left&&s.removeProperty("left"),s.top&&s.removeProperty("top"),s.width&&s.removeProperty("width"),s.height&&s.removeProperty("height")}static getScrollElement(e){if(!e)return document.scrollingElement||document.documentElement;const s=getComputedStyle(e);return/(auto|scroll)/.test(s.overflow+s.overflowY)?e:this.getScrollElement(e.parentElement)}static updateScrollPosition(e,s,o){let a=e.getBoundingClientRect(),d=window.innerHeight||document.documentElement.clientHeight;if(a.top<0||a.bottom>d){let g=a.bottom-d,_=a.top,j=this.getScrollElement(e);if(j!==null){let _e=j.scrollTop;a.top<0&&o<0?e.offsetHeight>d?j.scrollTop+=o:j.scrollTop+=Math.abs(_)>Math.abs(o)?o:_:o>0&&(e.offsetHeight>d?j.scrollTop+=o:j.scrollTop+=g>o?o:g),s.top+=j.scrollTop-_e}}}static updateScrollResize(e,s,o){const a=this.getScrollElement(s),d=a.clientHeight,g=a===this.getScrollElement()?0:a.getBoundingClientRect().top,_=e.clientY-g,j=_<o,_e=_>d-o;j?a.scrollBy({behavior:"smooth",top:_-o}):_e&&a.scrollBy({behavior:"smooth",top:o-(d-_)})}static clone(e){return e==null||typeof e!="object"?e:e instanceof Array?[...e]:Object.assign({},e)}static cloneDeep(e){const s=["parentGrid","el","grid","subGrid","engine"],o=Utils.clone(e);for(const a in o)o.hasOwnProperty(a)&&typeof o[a]=="object"&&a.substring(0,2)!=="__"&&!s.find(d=>d===a)&&(o[a]=Utils.cloneDeep(e[a]));return o}static cloneNode(e){const s=e.cloneNode(!0);return s.removeAttribute("id"),s}static appendTo(e,s){let o;typeof s=="string"?o=document.querySelector(s):o=s,o&&o.appendChild(e)}static addElStyles(e,s){if(s instanceof Object)for(const o in s)s.hasOwnProperty(o)&&(Array.isArray(s[o])?s[o].forEach(a=>{e.style[o]=a}):e.style[o]=s[o])}static initEvent(e,s){const o={type:s.type},a={button:0,which:0,buttons:1,bubbles:!0,cancelable:!0,target:s.target?s.target:e.target};return e.dataTransfer&&(o.dataTransfer=e.dataTransfer),["altKey","ctrlKey","metaKey","shiftKey"].forEach(d=>o[d]=e[d]),["pageX","pageY","clientX","clientY","screenX","screenY"].forEach(d=>o[d]=e[d]),Object.assign(Object.assign({},o),a)}static simulateMouseEvent(e,s,o){const a=document.createEvent("MouseEvents");a.initMouseEvent(s,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,e.target),(o||e.target).dispatchEvent(a)}}utils.Utils=Utils;Object.defineProperty(gridstackEngine,"__esModule",{value:!0});gridstackEngine.GridStackEngine=void 0;const utils_1=utils;class GridStackEngine{constructor(e={}){this.addedNodes=[],this.removedNodes=[],this.column=e.column||12,this.maxRow=e.maxRow,this._float=e.float,this.nodes=e.nodes||[],this.onChange=e.onChange}batchUpdate(e=!0){return!!this.batchMode===e?this:(this.batchMode=e,e?(this._prevFloat=this._float,this._float=!0,this.saveInitial()):(this._float=this._prevFloat,delete this._prevFloat,this._packNodes()._notify()),this)}_useEntireRowArea(e,s){return!this.float&&!this._hasLocked&&(!e._moving||e._skipDown||s.y<=e.y)}_fixCollisions(e,s=e,o,a={}){if(this.sortNodes(-1),o=o||this.collide(e,s),!o)return!1;if(e._moving&&!a.nested&&!this.float&&this.swap(e,o))return!0;let d=s;this._useEntireRowArea(e,s)&&(d={x:0,w:this.column,y:s.y,h:s.h},o=this.collide(e,d,a.skip));let g=!1,_={nested:!0,pack:!1};for(;o=o||this.collide(e,d,a.skip);){let j;if(o.locked||e._moving&&!e._skipDown&&s.y>e.y&&!this.float&&(!this.collide(o,Object.assign(Object.assign({},o),{y:e.y}),e)||!this.collide(o,Object.assign(Object.assign({},o),{y:s.y-o.h}),e))?(e._skipDown=e._skipDown||s.y>e.y,j=this.moveNode(e,Object.assign(Object.assign(Object.assign({},s),{y:o.y+o.h}),_)),o.locked&&j?utils_1.Utils.copyPos(s,e):!o.locked&&j&&a.pack&&(this._packNodes(),s.y=o.y+o.h,utils_1.Utils.copyPos(e,s)),g=g||j):j=this.moveNode(o,Object.assign(Object.assign(Object.assign({},o),{y:s.y+s.h,skip:e}),_)),!j)return g;o=void 0}return g}collide(e,s=e,o){return this.nodes.find(a=>a!==e&&a!==o&&utils_1.Utils.isIntercepted(a,s))}collideAll(e,s=e,o){return this.nodes.filter(a=>a!==e&&a!==o&&utils_1.Utils.isIntercepted(a,s))}directionCollideCoverage(e,s,o){if(!s.rect||!e._rect)return;let a=e._rect,d=Object.assign({},s.rect);d.y>a.y?(d.h+=d.y-a.y,d.y=a.y):d.h+=a.y-d.y,d.x>a.x?(d.w+=d.x-a.x,d.x=a.x):d.w+=a.x-d.x;let g;return o.forEach(_=>{if(_.locked||!_._rect)return;let j=_._rect,_e=Number.MAX_VALUE,et=Number.MAX_VALUE,tt=.5;a.y<j.y?_e=(d.y+d.h-j.y)/j.h:a.y+a.h>j.y+j.h&&(_e=(j.y+j.h-d.y)/j.h),a.x<j.x?et=(d.x+d.w-j.x)/j.w:a.x+a.w>j.x+j.w&&(et=(j.x+j.w-d.x)/j.w);let rt=Math.min(et,_e);rt>tt&&(tt=rt,g=_)}),s.collide=g,g}cacheRects(e,s,o,a,d,g){return this.nodes.forEach(_=>_._rect={y:_.y*s+o,x:_.x*e+g,w:_.w*e-g-a,h:_.h*s-o-d}),this}swap(e,s){if(!s||s.locked||!e||e.locked)return!1;function o(){let d=s.x,g=s.y;return s.x=e.x,s.y=e.y,e.h!=s.h?(e.x=d,e.y=s.y+s.h):e.w!=s.w?(e.x=s.x+s.w,e.y=g):(e.x=d,e.y=g),e._dirty=s._dirty=!0,!0}let a;if(e.w===s.w&&e.h===s.h&&(e.x===s.x||e.y===s.y)&&(a=utils_1.Utils.isTouching(e,s)))return o();if(a!==!1){if(e.w===s.w&&e.x===s.x&&(a||(a=utils_1.Utils.isTouching(e,s)))){if(s.y<e.y){let d=e;e=s,s=d}return o()}if(a!==!1){if(e.h===s.h&&e.y===s.y&&(a||(a=utils_1.Utils.isTouching(e,s)))){if(s.x<e.x){let d=e;e=s,s=d}return o()}return!1}}}isAreaEmpty(e,s,o,a){let d={x:e||0,y:s||0,w:o||1,h:a||1};return!this.collide(d)}compact(){if(this.nodes.length===0)return this;this.batchUpdate().sortNodes();let e=this.nodes;return this.nodes=[],e.forEach(s=>{s.locked||(s.autoPosition=!0),this.addNode(s,!1),s._dirty=!0}),this.batchUpdate(!1)}set float(e){this._float!==e&&(this._float=e||!1,e||this._packNodes()._notify())}get float(){return this._float||!1}sortNodes(e){return this.nodes=utils_1.Utils.sort(this.nodes,e,this.column),this}_packNodes(){return this.batchMode?this:(this.sortNodes(),this.float?this.nodes.forEach(e=>{if(e._updating||e._orig===void 0||e.y===e._orig.y)return;let s=e.y;for(;s>e._orig.y;)--s,this.collide(e,{x:e.x,y:s,w:e.w,h:e.h})||(e._dirty=!0,e.y=s)}):this.nodes.forEach((e,s)=>{if(!e.locked)for(;e.y>0;){let o=s===0?0:e.y-1;if(!(s===0||!this.collide(e,{x:e.x,y:o,w:e.w,h:e.h})))break;e._dirty=e.y!==o,e.y=o}}),this)}prepareNode(e,s){e=e||{},e._id=e._id||GridStackEngine._idSeq++,(e.x===void 0||e.y===void 0||e.x===null||e.y===null)&&(e.autoPosition=!0);let o={x:0,y:0,w:1,h:1};return utils_1.Utils.defaults(e,o),e.autoPosition||delete e.autoPosition,e.noResize||delete e.noResize,e.noMove||delete e.noMove,typeof e.x=="string"&&(e.x=Number(e.x)),typeof e.y=="string"&&(e.y=Number(e.y)),typeof e.w=="string"&&(e.w=Number(e.w)),typeof e.h=="string"&&(e.h=Number(e.h)),isNaN(e.x)&&(e.x=o.x,e.autoPosition=!0),isNaN(e.y)&&(e.y=o.y,e.autoPosition=!0),isNaN(e.w)&&(e.w=o.w),isNaN(e.h)&&(e.h=o.h),this.nodeBoundFix(e,s)}nodeBoundFix(e,s){let o=e._orig||utils_1.Utils.copyPos({},e);if(e.maxW&&(e.w=Math.min(e.w,e.maxW)),e.maxH&&(e.h=Math.min(e.h,e.maxH)),e.minW&&e.minW<=this.column&&(e.w=Math.max(e.w,e.minW)),e.minH&&(e.h=Math.max(e.h,e.minH)),(this.column===1||e.x+e.w>this.column)&&this.column<12&&!this._inColumnResize&&!e.autoPosition&&e._id&&this.findCacheLayout(e,12)===-1){let d=Object.assign({},e);d.x=Math.min(11,d.x),d.w=Math.min(12,d.w),this.cacheOneLayout(d,12)}return e.w>this.column?e.w=this.column:e.w<1&&(e.w=1),this.maxRow&&e.h>this.maxRow?e.h=this.maxRow:e.h<1&&(e.h=1),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x+e.w>this.column&&(s?e.w=this.column-e.x:e.x=this.column-e.w),this.maxRow&&e.y+e.h>this.maxRow&&(s?e.h=this.maxRow-e.y:e.y=this.maxRow-e.h),utils_1.Utils.samePos(e,o)||(e._dirty=!0),e}getDirtyNodes(e){return e?this.nodes.filter(s=>s._dirty&&!utils_1.Utils.samePos(s,s._orig)):this.nodes.filter(s=>s._dirty)}_notify(e){if(this.batchMode||!this.onChange)return this;let s=(e||[]).concat(this.getDirtyNodes());return this.onChange(s),this}cleanNodes(){return this.batchMode?this:(this.nodes.forEach(e=>{delete e._dirty,delete e._lastTried}),this)}saveInitial(){return this.nodes.forEach(e=>{e._orig=utils_1.Utils.copyPos({},e),delete e._dirty}),this._hasLocked=this.nodes.some(e=>e.locked),this}restoreInitial(){return this.nodes.forEach(e=>{utils_1.Utils.samePos(e,e._orig)||(utils_1.Utils.copyPos(e,e._orig),e._dirty=!0)}),this._notify(),this}findEmptyPosition(e){this.sortNodes();let s=!1;for(let o=0;!s;++o){let a=o%this.column,d=Math.floor(o/this.column);if(a+e.w>this.column)continue;let g={x:a,y:d,w:e.w,h:e.h};this.nodes.find(_=>utils_1.Utils.isIntercepted(g,_))||(e.x=a,e.y=d,s=!0)}return s}addNode(e,s=!1){let o=this.nodes.find(a=>a._id===e._id);return o||(e=this._inColumnResize?this.nodeBoundFix(e):this.prepareNode(e),delete e._temporaryRemoved,delete e._removeDOM,e.autoPosition&&this.findEmptyPosition(e)&&delete e.autoPosition,this.nodes.push(e),s&&this.addedNodes.push(e),this._fixCollisions(e),this.batchMode||this._packNodes()._notify(),e)}removeNode(e,s=!0,o=!1){return this.nodes.find(a=>a===e)?(o&&this.removedNodes.push(e),s&&(e._removeDOM=!0),this.nodes=this.nodes.filter(a=>a!==e),this._packNodes()._notify([e])):this}removeAll(e=!0){return delete this._layouts,this.nodes.length===0?this:(e&&this.nodes.forEach(s=>s._removeDOM=!0),this.removedNodes=this.nodes,this.nodes=[],this._notify(this.removedNodes))}moveNodeCheck(e,s){if(!this.changedPosConstrain(e,s))return!1;if(s.pack=!0,!this.maxRow)return this.moveNode(e,s);let o,a=new GridStackEngine({column:this.column,float:this.float,nodes:this.nodes.map(g=>g===e?(o=Object.assign({},g),o):Object.assign({},g))});if(!o)return!1;let d=a.moveNode(o,s)&&a.getRow()<=this.maxRow;if(!d&&!s.resizing&&s.collide){let g=s.collide.el.gridstackNode;if(this.swap(e,g))return this._notify(),!0}return d?(a.nodes.filter(g=>g._dirty).forEach(g=>{let _=this.nodes.find(j=>j._id===g._id);_&&(utils_1.Utils.copyPos(_,g),_._dirty=!0)}),this._notify(),!0):!1}willItFit(e){if(delete e._willFitPos,!this.maxRow)return!0;let s=new GridStackEngine({column:this.column,float:this.float,nodes:this.nodes.map(a=>Object.assign({},a))}),o=Object.assign({},e);return this.cleanupNode(o),delete o.el,delete o._id,delete o.content,delete o.grid,s.addNode(o),s.getRow()<=this.maxRow?(e._willFitPos=utils_1.Utils.copyPos({},o),!0):!1}changedPosConstrain(e,s){return s.w=s.w||e.w,s.h=s.h||e.h,e.x!==s.x||e.y!==s.y?!0:(e.maxW&&(s.w=Math.min(s.w,e.maxW)),e.maxH&&(s.h=Math.min(s.h,e.maxH)),e.minW&&(s.w=Math.max(s.w,e.minW)),e.minH&&(s.h=Math.max(s.h,e.minH)),e.w!==s.w||e.h!==s.h)}moveNode(e,s){var o,a;if(!e||!s)return!1;let d;s.pack===void 0&&(d=s.pack=!0),typeof s.x!="number"&&(s.x=e.x),typeof s.y!="number"&&(s.y=e.y),typeof s.w!="number"&&(s.w=e.w),typeof s.h!="number"&&(s.h=e.h);let g=e.w!==s.w||e.h!==s.h,_=utils_1.Utils.copyPos({},e,!0);if(utils_1.Utils.copyPos(_,s),_=this.nodeBoundFix(_,g),utils_1.Utils.copyPos(s,_),utils_1.Utils.samePos(e,s))return!1;let j=utils_1.Utils.copyPos({},e),_e=this.collideAll(e,_,s.skip),et=!0;if(_e.length){let tt=e._moving&&!s.nested,rt=tt?this.directionCollideCoverage(e,s,_e):_e[0];if(tt&&rt&&(!((a=(o=e.grid)===null||o===void 0?void 0:o.opts)===null||a===void 0)&&a.subGridDynamic)&&!e.grid._isTemp){let it=utils_1.Utils.areaIntercept(s.rect,rt._rect),ot=utils_1.Utils.area(s.rect),ct=utils_1.Utils.area(rt._rect);it/(ot<ct?ot:ct)>.8&&(rt.grid.makeSubGrid(rt.el,void 0,e),rt=void 0)}rt?et=!this._fixCollisions(e,_,rt,s):(et=!1,d&&delete s.pack)}return et&&(e._dirty=!0,utils_1.Utils.copyPos(e,_)),s.pack&&this._packNodes()._notify(),!utils_1.Utils.samePos(e,j)}getRow(){return this.nodes.reduce((e,s)=>Math.max(e,s.y+s.h),0)}beginUpdate(e){return e._updating||(e._updating=!0,delete e._skipDown,this.batchMode||this.saveInitial()),this}endUpdate(){let e=this.nodes.find(s=>s._updating);return e&&(delete e._updating,delete e._skipDown),this}save(e=!0){var s;let o=(s=this._layouts)===null||s===void 0?void 0:s.length,a=o&&this.column!==o-1?this._layouts[o-1]:null,d=[];return this.sortNodes(),this.nodes.forEach(g=>{let _=a==null?void 0:a.find(_e=>_e._id===g._id),j=Object.assign({},g);_&&(j.x=_.x,j.y=_.y,j.w=_.w),utils_1.Utils.removeInternalForSave(j,!e),d.push(j)}),d}layoutsNodesChange(e){return!this._layouts||this._inColumnResize?this:(this._layouts.forEach((s,o)=>{if(!s||o===this.column)return this;if(o<this.column)this._layouts[o]=void 0;else{let a=o/this.column;e.forEach(d=>{if(!d._orig)return;let g=s.find(_=>_._id===d._id);g&&(d.y!==d._orig.y&&(g.y+=d.y-d._orig.y),d.x!==d._orig.x&&(g.x=Math.round(d.x*a)),d.w!==d._orig.w&&(g.w=Math.round(d.w*a)))})}}),this)}updateNodeWidths(e,s,o,a="moveScale"){var d;if(!this.nodes.length||!s||e===s)return this;this.cacheLayout(this.nodes,e),this.batchUpdate();let g=[],_=!1;if(s===1&&(o!=null&&o.length)){_=!0;let _e=0;o.forEach(et=>{et.x=0,et.w=1,et.y=Math.max(et.y,_e),_e=et.y+et.h}),g=o,o=[]}else o=utils_1.Utils.sort(this.nodes,-1,e);let j=[];if(s>e){j=this._layouts[s]||[];let _e=this._layouts.length-1;!j.length&&e!==_e&&(!((d=this._layouts[_e])===null||d===void 0)&&d.length)&&(e=_e,this._layouts[_e].forEach(et=>{let tt=o.find(rt=>rt._id===et._id);tt&&(tt.x=et.x,tt.y=et.y,tt.w=et.w)}))}if(j.forEach(_e=>{let et=o.findIndex(tt=>tt._id===_e._id);et!==-1&&(o[et].x=_e.x,o[et].y=_e.y,o[et].w=_e.w,g.push(o[et]),o.splice(et,1))}),o.length){if(typeof a=="function")a(s,e,g,o);else if(!_){let _e=s/e,et=a==="move"||a==="moveScale",tt=a==="scale"||a==="moveScale";o.forEach(rt=>{rt.x=s===1?0:et?Math.round(rt.x*_e):Math.min(rt.x,s-1),rt.w=s===1||e===1?1:tt?Math.round(rt.w*_e)||1:Math.min(rt.w,s),g.push(rt)}),o=[]}}return _||(g=utils_1.Utils.sort(g,-1,s)),this._inColumnResize=!0,this.nodes=[],g.forEach(_e=>{this.addNode(_e,!1),delete _e._orig}),this.batchUpdate(!1),delete this._inColumnResize,this}cacheLayout(e,s,o=!1){let a=[];return e.forEach((d,g)=>{d._id=d._id||GridStackEngine._idSeq++,a[g]={x:d.x,y:d.y,w:d.w,_id:d._id}}),this._layouts=o?[]:this._layouts||[],this._layouts[s]=a,this}cacheOneLayout(e,s){e._id=e._id||GridStackEngine._idSeq++;let o={x:e.x,y:e.y,w:e.w,_id:e._id};this._layouts=this._layouts||[],this._layouts[s]=this._layouts[s]||[];let a=this.findCacheLayout(e,s);return a===-1?this._layouts[s].push(o):this._layouts[s][a]=o,this}findCacheLayout(e,s){var o,a,d;return(d=(a=(o=this._layouts)===null||o===void 0?void 0:o[s])===null||a===void 0?void 0:a.findIndex(g=>g._id===e._id))!==null&&d!==void 0?d:-1}cleanupNode(e){for(let s in e)s[0]==="_"&&s!=="_id"&&delete e[s];return this}}gridstackEngine.GridStackEngine=GridStackEngine;GridStackEngine._idSeq=1;var types={};Object.defineProperty(types,"__esModule",{value:!0});types.dragInDefaultOptions=types.gridDefaults=void 0;types.gridDefaults={alwaysShowResizeHandle:"mobile",animate:!0,auto:!0,cellHeight:"auto",cellHeightThrottle:100,cellHeightUnit:"px",column:12,draggable:{handle:".grid-stack-item-content",appendTo:"body"},handle:".grid-stack-item-content",itemClass:"grid-stack-item",margin:10,marginUnit:"px",maxRow:0,minRow:0,oneColumnSize:768,placeholderClass:"grid-stack-placeholder",placeholderText:"",removableOptions:{accept:".grid-stack-item"},resizable:{handles:"se"},rtl:"auto"};types.dragInDefaultOptions={handle:".grid-stack-item-content",appendTo:"body"};var ddTouch={},ddManager={},hasRequiredDdManager;function requireDdManager(){if(hasRequiredDdManager)return ddManager;hasRequiredDdManager=1,Object.defineProperty(ddManager,"__esModule",{value:!0}),ddManager.DDManager=void 0;class i{}return ddManager.DDManager=i,ddManager}var hasRequiredDdTouch;function requireDdTouch(){if(hasRequiredDdTouch)return ddTouch;hasRequiredDdTouch=1,Object.defineProperty(ddTouch,"__esModule",{value:!0}),ddTouch.pointerleave=ddTouch.pointerenter=ddTouch.pointerdown=ddTouch.touchend=ddTouch.touchmove=ddTouch.touchstart=ddTouch.isTouch=void 0;const i=requireDdManager();ddTouch.isTouch=typeof window<"u"&&typeof document<"u"&&("ontouchstart"in document||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);class e{}function s(et,tt){if(et.touches.length>1)return;et.cancelable&&et.preventDefault();const rt=et.changedTouches[0],it=document.createEvent("MouseEvents");it.initMouseEvent(tt,!0,!0,window,1,rt.screenX,rt.screenY,rt.clientX,rt.clientY,!1,!1,!1,!1,0,null),et.target.dispatchEvent(it)}function o(et,tt){et.cancelable&&et.preventDefault();const rt=document.createEvent("MouseEvents");rt.initMouseEvent(tt,!0,!0,window,1,et.screenX,et.screenY,et.clientX,et.clientY,!1,!1,!1,!1,0,null),et.target.dispatchEvent(rt)}function a(et){e.touchHandled||(e.touchHandled=!0,s(et,"mousedown"))}ddTouch.touchstart=a;function d(et){e.touchHandled&&s(et,"mousemove")}ddTouch.touchmove=d;function g(et){if(!e.touchHandled)return;e.pointerLeaveTimeout&&(window.clearTimeout(e.pointerLeaveTimeout),delete e.pointerLeaveTimeout);const tt=!!i.DDManager.dragElement;s(et,"mouseup"),tt||s(et,"click"),e.touchHandled=!1}ddTouch.touchend=g;function _(et){et.target.releasePointerCapture(et.pointerId)}ddTouch.pointerdown=_;function j(et){i.DDManager.dragElement&&o(et,"mouseenter")}ddTouch.pointerenter=j;function _e(et){i.DDManager.dragElement&&(e.pointerLeaveTimeout=window.setTimeout(()=>{delete e.pointerLeaveTimeout,o(et,"mouseleave")},10))}return ddTouch.pointerleave=_e,ddTouch}var ddGridstack={},ddElement={},ddResizable={},ddResizableHandle={},hasRequiredDdResizableHandle;function requireDdResizableHandle(){if(hasRequiredDdResizableHandle)return ddResizableHandle;hasRequiredDdResizableHandle=1,Object.defineProperty(ddResizableHandle,"__esModule",{value:!0}),ddResizableHandle.DDResizableHandle=void 0;const i=requireDdTouch();class e{constructor(o,a,d){this.moving=!1,this.host=o,this.dir=a,this.option=d,this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._init()}_init(){const o=document.createElement("div");return o.classList.add("ui-resizable-handle"),o.classList.add(`${e.prefix}${this.dir}`),o.style.zIndex="100",o.style.userSelect="none",this.el=o,this.host.appendChild(this.el),this.el.addEventListener("mousedown",this._mouseDown),i.isTouch&&(this.el.addEventListener("touchstart",i.touchstart),this.el.addEventListener("pointerdown",i.pointerdown)),this}destroy(){return this.moving&&this._mouseUp(this.mouseDownEvent),this.el.removeEventListener("mousedown",this._mouseDown),i.isTouch&&(this.el.removeEventListener("touchstart",i.touchstart),this.el.removeEventListener("pointerdown",i.pointerdown)),this.host.removeChild(this.el),delete this.el,delete this.host,this}_mouseDown(o){this.mouseDownEvent=o,document.addEventListener("mousemove",this._mouseMove,!0),document.addEventListener("mouseup",this._mouseUp,!0),i.isTouch&&(this.el.addEventListener("touchmove",i.touchmove),this.el.addEventListener("touchend",i.touchend)),o.stopPropagation(),o.preventDefault()}_mouseMove(o){let a=this.mouseDownEvent;this.moving?this._triggerEvent("move",o):Math.abs(o.x-a.x)+Math.abs(o.y-a.y)>2&&(this.moving=!0,this._triggerEvent("start",this.mouseDownEvent),this._triggerEvent("move",o)),o.stopPropagation(),o.preventDefault()}_mouseUp(o){this.moving&&this._triggerEvent("stop",o),document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp,!0),i.isTouch&&(this.el.removeEventListener("touchmove",i.touchmove),this.el.removeEventListener("touchend",i.touchend)),delete this.moving,delete this.mouseDownEvent,o.stopPropagation(),o.preventDefault()}_triggerEvent(o,a){return this.option[o]&&this.option[o](a),this}}return ddResizableHandle.DDResizableHandle=e,e.prefix="ui-resizable-",ddResizableHandle}var ddBaseImpl={},hasRequiredDdBaseImpl;function requireDdBaseImpl(){if(hasRequiredDdBaseImpl)return ddBaseImpl;hasRequiredDdBaseImpl=1,Object.defineProperty(ddBaseImpl,"__esModule",{value:!0}),ddBaseImpl.DDBaseImplement=void 0;class i{constructor(){this._eventRegister={}}get disabled(){return this._disabled}on(s,o){this._eventRegister[s]=o}off(s){delete this._eventRegister[s]}enable(){this._disabled=!1}disable(){this._disabled=!0}destroy(){delete this._eventRegister}triggerEvent(s,o){if(!this.disabled&&this._eventRegister&&this._eventRegister[s])return this._eventRegister[s](o)}}return ddBaseImpl.DDBaseImplement=i,ddBaseImpl}var hasRequiredDdResizable;function requireDdResizable(){if(hasRequiredDdResizable)return ddResizable;hasRequiredDdResizable=1,Object.defineProperty(ddResizable,"__esModule",{value:!0}),ddResizable.DDResizable=void 0;const i=requireDdResizableHandle(),e=requireDdBaseImpl(),s=utils,o=requireDdManager();class a extends e.DDBaseImplement{constructor(g,_={}){super(),this._ui=()=>{const _e=this.el.parentElement.getBoundingClientRect(),et={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},tt=this.temporalRect||et;return{position:{left:tt.left-_e.left,top:tt.top-_e.top},size:{width:tt.width,height:tt.height}}},this.el=g,this.option=_,this._mouseOver=this._mouseOver.bind(this),this._mouseOut=this._mouseOut.bind(this),this.enable(),this._setupAutoHide(this.option.autoHide),this._setupHandlers()}on(g,_){super.on(g,_)}off(g){super.off(g)}enable(){super.enable(),this.el.classList.add("ui-resizable"),this.el.classList.remove("ui-resizable-disabled"),this._setupAutoHide(this.option.autoHide)}disable(){super.disable(),this.el.classList.add("ui-resizable-disabled"),this.el.classList.remove("ui-resizable"),this._setupAutoHide(!1)}destroy(){this._removeHandlers(),this._setupAutoHide(!1),this.el.classList.remove("ui-resizable"),delete this.el,super.destroy()}updateOption(g){let _=g.handles&&g.handles!==this.option.handles,j=g.autoHide&&g.autoHide!==this.option.autoHide;return Object.keys(g).forEach(_e=>this.option[_e]=g[_e]),_&&(this._removeHandlers(),this._setupHandlers()),j&&this._setupAutoHide(this.option.autoHide),this}_setupAutoHide(g){return g?(this.el.classList.add("ui-resizable-autohide"),this.el.addEventListener("mouseover",this._mouseOver),this.el.addEventListener("mouseout",this._mouseOut)):(this.el.classList.remove("ui-resizable-autohide"),this.el.removeEventListener("mouseover",this._mouseOver),this.el.removeEventListener("mouseout",this._mouseOut),o.DDManager.overResizeElement===this&&delete o.DDManager.overResizeElement),this}_mouseOver(g){o.DDManager.overResizeElement||o.DDManager.dragElement||(o.DDManager.overResizeElement=this,this.el.classList.remove("ui-resizable-autohide"))}_mouseOut(g){o.DDManager.overResizeElement===this&&(delete o.DDManager.overResizeElement,this.el.classList.add("ui-resizable-autohide"))}_setupHandlers(){let g=this.option.handles||"e,s,se";return g==="all"&&(g="n,e,s,w,se,sw,ne,nw"),this.handlers=g.split(",").map(_=>_.trim()).map(_=>new i.DDResizableHandle(this.el,_,{start:j=>{this._resizeStart(j)},stop:j=>{this._resizeStop(j)},move:j=>{this._resizing(j,_)}})),this}_resizeStart(g){this.originalRect=this.el.getBoundingClientRect(),this.scrollEl=s.Utils.getScrollElement(this.el),this.scrollY=this.scrollEl.scrollTop,this.scrolled=0,this.startEvent=g,this._setupHelper(),this._applyChange();const _=s.Utils.initEvent(g,{type:"resizestart",target:this.el});return this.option.start&&this.option.start(_,this._ui()),this.el.classList.add("ui-resizable-resizing"),this.triggerEvent("resizestart",_),this}_resizing(g,_){this.scrolled=this.scrollEl.scrollTop-this.scrollY,this.temporalRect=this._getChange(g,_),this._applyChange();const j=s.Utils.initEvent(g,{type:"resize",target:this.el});return this.option.resize&&this.option.resize(j,this._ui()),this.triggerEvent("resize",j),this}_resizeStop(g){const _=s.Utils.initEvent(g,{type:"resizestop",target:this.el});return this.option.stop&&this.option.stop(_),this.el.classList.remove("ui-resizable-resizing"),this.triggerEvent("resizestop",_),this._cleanHelper(),delete this.startEvent,delete this.originalRect,delete this.temporalRect,delete this.scrollY,delete this.scrolled,this}_setupHelper(){return this.elOriginStyleVal=a._originStyleProp.map(g=>this.el.style[g]),this.parentOriginStylePosition=this.el.parentElement.style.position,window.getComputedStyle(this.el.parentElement).position.match(/static/)&&(this.el.parentElement.style.position="relative"),this.el.style.position="absolute",this.el.style.opacity="0.8",this}_cleanHelper(){return a._originStyleProp.forEach((g,_)=>{this.el.style[g]=this.elOriginStyleVal[_]||null}),this.el.parentElement.style.position=this.parentOriginStylePosition||null,this}_getChange(g,_){const j=this.startEvent,_e={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},et=g.clientX-j.clientX,tt=g.clientY-j.clientY;_.indexOf("e")>-1?_e.width+=et:_.indexOf("w")>-1&&(_e.width-=et,_e.left+=et),_.indexOf("s")>-1?_e.height+=tt:_.indexOf("n")>-1&&(_e.height-=tt,_e.top+=tt);const rt=this._constrainSize(_e.width,_e.height);return Math.round(_e.width)!==Math.round(rt.width)&&(_.indexOf("w")>-1&&(_e.left+=_e.width-rt.width),_e.width=rt.width),Math.round(_e.height)!==Math.round(rt.height)&&(_.indexOf("n")>-1&&(_e.top+=_e.height-rt.height),_e.height=rt.height),_e}_constrainSize(g,_){const j=this.option.maxWidth||Number.MAX_SAFE_INTEGER,_e=this.option.minWidth||g,et=this.option.maxHeight||Number.MAX_SAFE_INTEGER,tt=this.option.minHeight||_,rt=Math.min(j,Math.max(_e,g)),it=Math.min(et,Math.max(tt,_));return{width:rt,height:it}}_applyChange(){let g={left:0,top:0,width:0,height:0};if(this.el.style.position==="absolute"){const _=this.el.parentElement,{left:j,top:_e}=_.getBoundingClientRect();g={left:j,top:_e,width:0,height:0}}return this.temporalRect?(Object.keys(this.temporalRect).forEach(_=>{const j=this.temporalRect[_];this.el.style[_]=j-g[_]+"px"}),this):this}_removeHandlers(){return this.handlers.forEach(g=>g.destroy()),delete this.handlers,this}}return ddResizable.DDResizable=a,a._originStyleProp=["width","height","position","left","top","opacity","zIndex"],ddResizable}var ddDraggable={},hasRequiredDdDraggable;function requireDdDraggable(){if(hasRequiredDdDraggable)return ddDraggable;hasRequiredDdDraggable=1,Object.defineProperty(ddDraggable,"__esModule",{value:!0}),ddDraggable.DDDraggable=void 0;const i=requireDdManager(),e=utils,s=requireDdBaseImpl(),o=requireDdTouch();class a extends s.DDBaseImplement{constructor(g,_={}){super(),this.el=g,this.option=_;let j=_.handle.substring(1);this.dragEl=g.classList.contains(j)?g:g.querySelector(_.handle)||g,this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this.enable()}on(g,_){super.on(g,_)}off(g){super.off(g)}enable(){this.disabled!==!1&&(super.enable(),this.dragEl.addEventListener("mousedown",this._mouseDown),o.isTouch&&(this.dragEl.addEventListener("touchstart",o.touchstart),this.dragEl.addEventListener("pointerdown",o.pointerdown)),this.el.classList.remove("ui-draggable-disabled"),this.el.classList.add("ui-draggable"))}disable(g=!1){this.disabled!==!0&&(super.disable(),this.dragEl.removeEventListener("mousedown",this._mouseDown),o.isTouch&&(this.dragEl.removeEventListener("touchstart",o.touchstart),this.dragEl.removeEventListener("pointerdown",o.pointerdown)),this.el.classList.remove("ui-draggable"),g||this.el.classList.add("ui-draggable-disabled"))}destroy(){this.dragTimeout&&window.clearTimeout(this.dragTimeout),delete this.dragTimeout,this.dragging&&this._mouseUp(this.mouseDownEvent),this.disable(!0),delete this.el,delete this.helper,delete this.option,super.destroy()}updateOption(g){return Object.keys(g).forEach(_=>this.option[_]=g[_]),this}_mouseDown(g){if(i.DDManager.mouseHandled)return;if(g.button!==0)return!0;const _=["input","textarea","button","select","option"],j=g.target.nodeName.toLowerCase();return _.find(_e=>_e===j)||g.target.closest('[contenteditable="true"]')||(this.mouseDownEvent=g,delete this.dragging,delete i.DDManager.dragElement,delete i.DDManager.dropElement,document.addEventListener("mousemove",this._mouseMove,!0),document.addEventListener("mouseup",this._mouseUp,!0),o.isTouch&&(this.dragEl.addEventListener("touchmove",o.touchmove),this.dragEl.addEventListener("touchend",o.touchend)),g.preventDefault(),document.activeElement&&document.activeElement.blur(),i.DDManager.mouseHandled=!0),!0}_callDrag(g){if(!this.dragging)return;const _=e.Utils.initEvent(g,{target:this.el,type:"drag"});this.option.drag&&this.option.drag(_,this.ui()),this.triggerEvent("drag",_)}_mouseMove(g){var _;let j=this.mouseDownEvent;if(this.dragging)if(this._dragFollow(g),i.DDManager.pauseDrag){const _e=Number.isInteger(i.DDManager.pauseDrag)?i.DDManager.pauseDrag:100;this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>this._callDrag(g),_e)}else this._callDrag(g);else if(Math.abs(g.x-j.x)+Math.abs(g.y-j.y)>3){this.dragging=!0,i.DDManager.dragElement=this;let _e=(_=this.el.gridstackNode)===null||_===void 0?void 0:_.grid;_e?i.DDManager.dropElement=_e.el.ddElement.ddDroppable:delete i.DDManager.dropElement,this.helper=this._createHelper(g),this._setupHelperContainmentStyle(),this.dragOffset=this._getDragOffset(g,this.el,this.helperContainment);const et=e.Utils.initEvent(g,{target:this.el,type:"dragstart"});this._setupHelperStyle(g),this.option.start&&this.option.start(et,this.ui()),this.triggerEvent("dragstart",et)}return g.preventDefault(),!0}_mouseUp(g){var _;if(document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp,!0),o.isTouch&&(this.dragEl.removeEventListener("touchmove",o.touchmove,!0),this.dragEl.removeEventListener("touchend",o.touchend,!0)),this.dragging){delete this.dragging,((_=i.DDManager.dropElement)===null||_===void 0?void 0:_.el)===this.el.parentElement&&delete i.DDManager.dropElement,this.helperContainment.style.position=this.parentOriginStylePosition||null,this.helper===this.el?this._removeHelperStyle():this.helper.remove();const j=e.Utils.initEvent(g,{target:this.el,type:"dragstop"});this.option.stop&&this.option.stop(j),this.triggerEvent("dragstop",j),i.DDManager.dropElement&&i.DDManager.dropElement.drop(g)}delete this.helper,delete this.mouseDownEvent,delete i.DDManager.dragElement,delete i.DDManager.dropElement,delete i.DDManager.mouseHandled,g.preventDefault()}_createHelper(g){let _=this.el;return typeof this.option.helper=="function"?_=this.option.helper(g):this.option.helper==="clone"&&(_=e.Utils.cloneNode(this.el)),document.body.contains(_)||e.Utils.appendTo(_,this.option.appendTo==="parent"?this.el.parentNode:this.option.appendTo),_===this.el&&(this.dragElementOriginStyle=a.originStyleProp.map(j=>this.el.style[j])),_}_setupHelperStyle(g){this.helper.classList.add("ui-draggable-dragging");const _=this.helper.style;return _.pointerEvents="none",_["min-width"]=0,_.width=this.dragOffset.width+"px",_.height=this.dragOffset.height+"px",_.willChange="left, top",_.position="fixed",this._dragFollow(g),_.transition="none",setTimeout(()=>{this.helper&&(_.transition=null)},0),this}_removeHelperStyle(){var g;this.helper.classList.remove("ui-draggable-dragging");let _=(g=this.helper)===null||g===void 0?void 0:g.gridstackNode;if(this.dragElementOriginStyle&&(!_||!_._isAboutToRemove)){let j=this.helper,_e=this.dragElementOriginStyle.transition||null;j.style.transition=this.dragElementOriginStyle.transition="none",a.originStyleProp.forEach(et=>j.style[et]=this.dragElementOriginStyle[et]||null),setTimeout(()=>j.style.transition=_e,50)}return delete this.dragElementOriginStyle,this}_dragFollow(g){let _={left:0,top:0};const j=this.helper.style,_e=this.dragOffset;j.left=g.clientX+_e.offsetLeft-_.left+"px",j.top=g.clientY+_e.offsetTop-_.top+"px"}_setupHelperContainmentStyle(){return this.helperContainment=this.helper.parentElement,this.helper.style.position!=="fixed"&&(this.parentOriginStylePosition=this.helperContainment.style.position,window.getComputedStyle(this.helperContainment).position.match(/static/)&&(this.helperContainment.style.position="relative")),this}_getDragOffset(g,_,j){let _e=0,et=0;if(j){const rt=document.createElement("div");e.Utils.addElStyles(rt,{opacity:"0",position:"fixed",top:"0px",left:"0px",width:"1px",height:"1px",zIndex:"-999999"}),j.appendChild(rt);const it=rt.getBoundingClientRect();j.removeChild(rt),_e=it.left,et=it.top}const tt=_.getBoundingClientRect();return{left:tt.left,top:tt.top,offsetLeft:-g.clientX+tt.left-_e,offsetTop:-g.clientY+tt.top-et,width:tt.width,height:tt.height}}ui(){const _=this.el.parentElement.getBoundingClientRect(),j=this.helper.getBoundingClientRect();return{position:{top:j.top-_.top,left:j.left-_.left}}}}return ddDraggable.DDDraggable=a,a.originStyleProp=["transition","pointerEvents","position","left","top"],ddDraggable}var ddDroppable={},hasRequiredDdDroppable;function requireDdDroppable(){if(hasRequiredDdDroppable)return ddDroppable;hasRequiredDdDroppable=1,Object.defineProperty(ddDroppable,"__esModule",{value:!0}),ddDroppable.DDDroppable=void 0;const i=requireDdManager(),e=requireDdBaseImpl(),s=utils,o=requireDdTouch();class a extends e.DDBaseImplement{constructor(g,_={}){super(),this.el=g,this.option=_,this._mouseEnter=this._mouseEnter.bind(this),this._mouseLeave=this._mouseLeave.bind(this),this.enable(),this._setupAccept()}on(g,_){super.on(g,_)}off(g){super.off(g)}enable(){this.disabled!==!1&&(super.enable(),this.el.classList.add("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),this.el.addEventListener("mouseenter",this._mouseEnter),this.el.addEventListener("mouseleave",this._mouseLeave),o.isTouch&&(this.el.addEventListener("pointerenter",o.pointerenter),this.el.addEventListener("pointerleave",o.pointerleave)))}disable(g=!1){this.disabled!==!0&&(super.disable(),this.el.classList.remove("ui-droppable"),g||this.el.classList.add("ui-droppable-disabled"),this.el.removeEventListener("mouseenter",this._mouseEnter),this.el.removeEventListener("mouseleave",this._mouseLeave),o.isTouch&&(this.el.removeEventListener("pointerenter",o.pointerenter),this.el.removeEventListener("pointerleave",o.pointerleave)))}destroy(){this.disable(!0),this.el.classList.remove("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),super.destroy()}updateOption(g){return Object.keys(g).forEach(_=>this.option[_]=g[_]),this._setupAccept(),this}_mouseEnter(g){if(!i.DDManager.dragElement||!this._canDrop(i.DDManager.dragElement.el))return;g.preventDefault(),g.stopPropagation(),i.DDManager.dropElement&&i.DDManager.dropElement!==this&&i.DDManager.dropElement._mouseLeave(g),i.DDManager.dropElement=this;const _=s.Utils.initEvent(g,{target:this.el,type:"dropover"});this.option.over&&this.option.over(_,this._ui(i.DDManager.dragElement)),this.triggerEvent("dropover",_),this.el.classList.add("ui-droppable-over")}_mouseLeave(g){var _;if(!i.DDManager.dragElement||i.DDManager.dropElement!==this)return;g.preventDefault(),g.stopPropagation();const j=s.Utils.initEvent(g,{target:this.el,type:"dropout"});if(this.option.out&&this.option.out(j,this._ui(i.DDManager.dragElement)),this.triggerEvent("dropout",j),i.DDManager.dropElement===this){delete i.DDManager.dropElement;let _e,et=this.el.parentElement;for(;!_e&&et;)_e=(_=et.ddElement)===null||_===void 0?void 0:_.ddDroppable,et=et.parentElement;_e&&_e._mouseEnter(g)}}drop(g){g.preventDefault();const _=s.Utils.initEvent(g,{target:this.el,type:"drop"});this.option.drop&&this.option.drop(_,this._ui(i.DDManager.dragElement)),this.triggerEvent("drop",_)}_canDrop(g){return g&&(!this.accept||this.accept(g))}_setupAccept(){return this.option.accept?(typeof this.option.accept=="string"?this.accept=g=>g.matches(this.option.accept):this.accept=this.option.accept,this):this}_ui(g){return Object.assign({draggable:g.el},g.ui())}}return ddDroppable.DDDroppable=a,ddDroppable}var hasRequiredDdElement;function requireDdElement(){if(hasRequiredDdElement)return ddElement;hasRequiredDdElement=1,Object.defineProperty(ddElement,"__esModule",{value:!0}),ddElement.DDElement=void 0;const i=requireDdResizable(),e=requireDdDraggable(),s=requireDdDroppable();class o{constructor(d){this.el=d}static init(d){return d.ddElement||(d.ddElement=new o(d)),d.ddElement}on(d,g){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(d)>-1?this.ddDraggable.on(d,g):this.ddDroppable&&["drop","dropover","dropout"].indexOf(d)>-1?this.ddDroppable.on(d,g):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(d)>-1&&this.ddResizable.on(d,g),this}off(d){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(d)>-1?this.ddDraggable.off(d):this.ddDroppable&&["drop","dropover","dropout"].indexOf(d)>-1?this.ddDroppable.off(d):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(d)>-1&&this.ddResizable.off(d),this}setupDraggable(d){return this.ddDraggable?this.ddDraggable.updateOption(d):this.ddDraggable=new e.DDDraggable(this.el,d),this}cleanDraggable(){return this.ddDraggable&&(this.ddDraggable.destroy(),delete this.ddDraggable),this}setupResizable(d){return this.ddResizable?this.ddResizable.updateOption(d):this.ddResizable=new i.DDResizable(this.el,d),this}cleanResizable(){return this.ddResizable&&(this.ddResizable.destroy(),delete this.ddResizable),this}setupDroppable(d){return this.ddDroppable?this.ddDroppable.updateOption(d):this.ddDroppable=new s.DDDroppable(this.el,d),this}cleanDroppable(){return this.ddDroppable&&(this.ddDroppable.destroy(),delete this.ddDroppable),this}}return ddElement.DDElement=o,ddElement}var hasRequiredDdGridstack;function requireDdGridstack(){if(hasRequiredDdGridstack)return ddGridstack;hasRequiredDdGridstack=1,Object.defineProperty(ddGridstack,"__esModule",{value:!0}),ddGridstack.DDGridStack=void 0;const i=types,e=requireGridstack(),s=utils,o=requireDdManager(),a=requireDdElement();class d{static get(){return g}resizable(_e,et,tt,rt){return this._getDDElements(_e).forEach(it=>{if(et==="disable"||et==="enable")it.ddResizable&&it.ddResizable[et]();else if(et==="destroy")it.ddResizable&&it.cleanResizable();else if(et==="option")it.setupResizable({[tt]:rt});else{const ot=it.el.gridstackNode.grid;let ct=it.el.getAttribute("gs-resize-handles")?it.el.getAttribute("gs-resize-handles"):ot.opts.resizable.handles,ft=!ot.opts.alwaysShowResizeHandle;it.setupResizable(Object.assign(Object.assign(Object.assign({},ot.opts.resizable),{handles:ct,autoHide:ft}),{start:et.start,stop:et.stop,resize:et.resize}))}}),this}draggable(_e,et,tt,rt){return this._getDDElements(_e).forEach(it=>{if(et==="disable"||et==="enable")it.ddDraggable&&it.ddDraggable[et]();else if(et==="destroy")it.ddDraggable&&it.cleanDraggable();else if(et==="option")it.setupDraggable({[tt]:rt});else{const ot=it.el.gridstackNode.grid;it.setupDraggable(Object.assign(Object.assign({},ot.opts.draggable),{start:et.start,stop:et.stop,drag:et.drag}))}}),this}dragIn(_e,et){return this._getDDElements(_e).forEach(tt=>tt.setupDraggable(et)),this}droppable(_e,et,tt,rt){return typeof et.accept=="function"&&!et._accept&&(et._accept=et.accept,et.accept=it=>et._accept(it)),this._getDDElements(_e).forEach(it=>{et==="disable"||et==="enable"?it.ddDroppable&&it.ddDroppable[et]():et==="destroy"?it.ddDroppable&&it.cleanDroppable():et==="option"?it.setupDroppable({[tt]:rt}):it.setupDroppable(et)}),this}isDroppable(_e){return!!(_e&&_e.ddElement&&_e.ddElement.ddDroppable&&!_e.ddElement.ddDroppable.disabled)}isDraggable(_e){return!!(_e&&_e.ddElement&&_e.ddElement.ddDraggable&&!_e.ddElement.ddDraggable.disabled)}isResizable(_e){return!!(_e&&_e.ddElement&&_e.ddElement.ddResizable&&!_e.ddElement.ddResizable.disabled)}on(_e,et,tt){return this._getDDElements(_e).forEach(rt=>rt.on(et,it=>{tt(it,o.DDManager.dragElement?o.DDManager.dragElement.el:it.target,o.DDManager.dragElement?o.DDManager.dragElement.helper:null)})),this}off(_e,et){return this._getDDElements(_e).forEach(tt=>tt.off(et)),this}_getDDElements(_e,et=!0){let tt=s.Utils.getElements(_e);if(!tt.length)return[];let rt=tt.map(it=>it.ddElement||(et?a.DDElement.init(it):null));return et||rt.filter(it=>it),rt}}ddGridstack.DDGridStack=d;const g=new d;e.GridStack.prototype._setupAcceptWidget=function(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return g.droppable(this.el,"destroy"),this;let j,_e,et=(tt,rt,it)=>{let ot=rt.gridstackNode;if(!ot)return;it=it||rt;let ct=this.el.getBoundingClientRect(),{top:ft,left:dt}=it.getBoundingClientRect();dt-=ct.left,ft-=ct.top;let pt={position:{top:ft,left:dt}};if(ot._temporaryRemoved){if(ot.x=Math.max(0,Math.round(dt/_e)),ot.y=Math.max(0,Math.round(ft/j)),delete ot.autoPosition,this.engine.nodeBoundFix(ot),!this.engine.willItFit(ot)){if(ot.autoPosition=!0,!this.engine.willItFit(ot)){g.off(rt,"drag");return}ot._willFitPos&&(s.Utils.copyPos(ot,ot._willFitPos),delete ot._willFitPos)}this._onStartMoving(it,tt,pt,ot,_e,j)}else this._dragOrResize(it,tt,pt,ot,_e,j)};return g.droppable(this.el,{accept:tt=>{let rt=tt.gridstackNode;if((rt==null?void 0:rt.grid)===this)return!0;if(!this.opts.acceptWidgets)return!1;let it=!0;if(typeof this.opts.acceptWidgets=="function")it=this.opts.acceptWidgets(tt);else{let ot=this.opts.acceptWidgets===!0?".grid-stack-item":this.opts.acceptWidgets;it=tt.matches(ot)}if(it&&rt&&this.opts.maxRow){let ot={w:rt.w,h:rt.h,minW:rt.minW,minH:rt.minH};it=this.engine.willItFit(ot)}return it}}).on(this.el,"dropover",(tt,rt,it)=>{let ot=rt.gridstackNode;if((ot==null?void 0:ot.grid)===this&&!ot._temporaryRemoved)return!1;ot!=null&&ot.grid&&ot.grid!==this&&!ot._temporaryRemoved&&ot.grid._leave(rt,it),_e=this.cellWidth(),j=this.getCellHeight(!0),ot||(ot=this._readAttr(rt)),ot.grid||(ot._isExternal=!0,rt.gridstackNode=ot),it=it||rt;let ct=ot.w||Math.round(it.offsetWidth/_e)||1,ft=ot.h||Math.round(it.offsetHeight/j)||1;return ot.grid&&ot.grid!==this?(rt._gridstackNodeOrig||(rt._gridstackNodeOrig=ot),rt.gridstackNode=ot=Object.assign(Object.assign({},ot),{w:ct,h:ft,grid:this}),this.engine.cleanupNode(ot).nodeBoundFix(ot),ot._initDD=ot._isExternal=ot._temporaryRemoved=!0):(ot.w=ct,ot.h=ft,ot._temporaryRemoved=!0),_(ot.el,!1),g.on(rt,"drag",et),et(tt,rt,it),!1}).on(this.el,"dropout",(tt,rt,it)=>{let ot=rt.gridstackNode;return ot&&(!ot.grid||ot.grid===this)&&(this._leave(rt,it),this._isTemp&&this.removeAsSubGrid(ot)),!1}).on(this.el,"drop",(tt,rt,it)=>{var ot,ct;let ft=rt.gridstackNode;if((ft==null?void 0:ft.grid)===this&&!ft._isExternal)return!1;let dt=!!this.placeholder.parentElement;this.placeholder.remove();let pt=rt._gridstackNodeOrig;if(delete rt._gridstackNodeOrig,dt&&(pt!=null&&pt.grid)&&pt.grid!==this){let Ct=pt.grid;Ct.engine.removedNodes.push(pt),Ct._triggerRemoveEvent(),Ct.parentGridItem&&!Ct.engine.nodes.length&&Ct.opts.subGridDynamic&&Ct.removeAsSubGrid()}if(!ft||(dt&&(this.engine.cleanupNode(ft),ft.grid=this),g.off(rt,"drag"),it!==rt?(it.remove(),rt.gridstackNode=pt,dt&&(rt=rt.cloneNode(!0))):(rt.remove(),this._removeDD(rt)),!dt))return!1;rt.gridstackNode=ft,ft.el=rt;let gt=(ct=(ot=ft.subGrid)===null||ot===void 0?void 0:ot.el)===null||ct===void 0?void 0:ct.gridstack;return s.Utils.copyPos(ft,this._readAttr(this.placeholder)),s.Utils.removePositioningStyles(rt),this._writeAttr(rt,ft),this.el.appendChild(rt),gt&&(gt.parentGridItem=ft,gt.opts.styleInHead||gt._updateStyles(!0)),this._updateContainerHeight(),this.engine.addedNodes.push(ft),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped(Object.assign(Object.assign({},tt),{type:"dropped"}),pt&&pt.grid?pt:void 0,ft),window.setTimeout(()=>{ft.el&&ft.el.parentElement?this._prepareDragDropByNode(ft):this.engine.removeNode(ft),delete ft.grid._isTemp}),!1}),this};function _(j,_e){let et=j?j.gridstackNode:void 0;!et||!et.grid||(_e?et._isAboutToRemove=!0:delete et._isAboutToRemove,_e?j.classList.add("grid-stack-item-removing"):j.classList.remove("grid-stack-item-removing"))}return e.GridStack.prototype._setupRemoveDrop=function(){if(!this.opts.staticGrid&&typeof this.opts.removable=="string"){let j=document.querySelector(this.opts.removable);if(!j)return this;g.isDroppable(j)||g.droppable(j,this.opts.removableOptions).on(j,"dropover",(_e,et)=>_(et,!0)).on(j,"dropout",(_e,et)=>_(et,!1))}return this},e.GridStack.setupDragIn=function(j,_e){(_e==null?void 0:_e.pause)!==void 0&&(o.DDManager.pauseDrag=_e.pause),typeof j=="string"&&(_e=Object.assign(Object.assign({},i.dragInDefaultOptions),_e||{}),s.Utils.getElements(j).forEach(et=>{g.isDraggable(et)||g.dragIn(et,_e)}))},e.GridStack.prototype._prepareDragDropByNode=function(j){let _e=j.el;const et=j.noMove||this.opts.disableDrag,tt=j.noResize||this.opts.disableResize;if(this.opts.staticGrid||et&&tt)return j._initDD&&(this._removeDD(_e),delete j._initDD),_e.classList.add("ui-draggable-disabled","ui-resizable-disabled"),this;if(!j._initDD){let rt,it,ot=(dt,pt)=>{this._gsEventHandler[dt.type]&&this._gsEventHandler[dt.type](dt,dt.target),rt=this.cellWidth(),it=this.getCellHeight(!0),this._onStartMoving(_e,dt,pt,j,rt,it)},ct=(dt,pt)=>{this._dragOrResize(_e,dt,pt,j,rt,it)},ft=dt=>{this.placeholder.remove(),delete j._moving,delete j._event,delete j._lastTried;let pt=dt.target;if(!(!pt.gridstackNode||pt.gridstackNode.grid!==this)){if(j.el=pt,j._isAboutToRemove){let gt=_e.gridstackNode.grid;gt._gsEventHandler[dt.type]&&gt._gsEventHandler[dt.type](dt,pt),this._removeDD(_e),gt.engine.removedNodes.push(j),gt._triggerRemoveEvent(),delete _e.gridstackNode,delete j.el,_e.remove()}else s.Utils.removePositioningStyles(pt),j._temporaryRemoved?(s.Utils.copyPos(j,j._orig),this._writePosAttr(pt,j),this.engine.addNode(j)):this._writePosAttr(pt,j),this._gsEventHandler[dt.type]&&this._gsEventHandler[dt.type](dt,pt);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()}};g.draggable(_e,{start:ot,stop:ft,drag:ct}).resizable(_e,{start:ot,stop:ft,resize:ct}),j._initDD=!0}return g.draggable(_e,et?"disable":"enable").resizable(_e,tt?"disable":"enable"),this},e.GridStack.prototype._onStartMoving=function(j,_e,et,tt,rt,it){this.engine.cleanNodes().beginUpdate(tt),this._writePosAttr(this.placeholder,tt),this.el.appendChild(this.placeholder),tt.el=this.placeholder,tt._lastUiPosition=et.position,tt._prevYPix=et.position.top,tt._moving=_e.type==="dragstart",delete tt._lastTried,_e.type==="dropover"&&tt._temporaryRemoved&&(this.engine.addNode(tt),tt._moving=!0),this.engine.cacheRects(rt,it,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),_e.type==="resizestart"&&(g.resizable(j,"option","minWidth",rt*(tt.minW||1)).resizable(j,"option","minHeight",it*(tt.minH||1)),tt.maxW&&g.resizable(j,"option","maxWidth",rt*tt.maxW),tt.maxH&&g.resizable(j,"option","maxHeight",it*tt.maxH))},e.GridStack.prototype._leave=function(j,_e){let et=j.gridstackNode;et&&(g.off(j,"drag"),!et._temporaryRemoved&&(et._temporaryRemoved=!0,this.engine.removeNode(et),et.el=et._isExternal&&_e?_e:j,this.opts.removable===!0&&_(j,!0),j._gridstackNodeOrig?(j.gridstackNode=j._gridstackNodeOrig,delete j._gridstackNodeOrig):et._isExternal&&(delete et.el,delete j.gridstackNode,this.engine.restoreInitial())))},e.GridStack.prototype._dragOrResize=function(j,_e,et,tt,rt,it){let ot=Object.assign({},tt._orig),ct,ft=this.opts.marginLeft,dt=this.opts.marginRight,pt=this.opts.marginTop,gt=this.opts.marginBottom,Ct=Math.round(it*.1),xt=Math.round(rt*.1);if(ft=Math.min(ft,xt),dt=Math.min(dt,xt),pt=Math.min(pt,Ct),gt=Math.min(gt,Ct),_e.type==="drag"){if(tt._temporaryRemoved)return;let Bt=et.position.top-tt._prevYPix;tt._prevYPix=et.position.top,s.Utils.updateScrollPosition(j,et.position,Bt);let Ht=et.position.left+(et.position.left>tt._lastUiPosition.left?-dt:ft),sr=et.position.top+(et.position.top>tt._lastUiPosition.top?-gt:pt);ot.x=Math.round(Ht/rt),ot.y=Math.round(sr/it);let mr=this._extraDragRow;if(this.engine.collide(tt,ot)){let hr=this.getRow(),Er=Math.max(0,ot.y+tt.h-hr);this.opts.maxRow&&hr+Er>this.opts.maxRow&&(Er=Math.max(0,this.opts.maxRow-hr)),this._extraDragRow=Er}else this._extraDragRow=0;if(this._extraDragRow!==mr&&this._updateContainerHeight(),tt.x===ot.x&&tt.y===ot.y)return}else if(_e.type==="resize"){if(ot.x<0||(s.Utils.updateScrollResize(_e,j,it),ot.w=Math.round((et.size.width-ft)/rt),ot.h=Math.round((et.size.height-pt)/it),tt.w===ot.w&&tt.h===ot.h)||tt._lastTried&&tt._lastTried.w===ot.w&&tt._lastTried.h===ot.h)return;let Bt=et.position.left+ft,Ht=et.position.top+pt;ot.x=Math.round(Bt/rt),ot.y=Math.round(Ht/it),ct=!0}tt._event=_e,tt._lastTried=ot;let at={x:et.position.left+ft,y:et.position.top+pt,w:(et.size?et.size.width:tt.w*rt)-ft-dt,h:(et.size?et.size.height:tt.h*it)-pt-gt};if(this.engine.moveNodeCheck(tt,Object.assign(Object.assign({},ot),{cellWidth:rt,cellHeight:it,rect:at,resizing:ct}))){tt._lastUiPosition=et.position,this.engine.cacheRects(rt,it,pt,dt,gt,ft),delete tt._skipDown,ct&&tt.subGrid&&tt.subGrid.onParentResize(),this._extraDragRow=0,this._updateContainerHeight();let Bt=_e.target;this._writePosAttr(Bt,tt),this._gsEventHandler[_e.type]&&this._gsEventHandler[_e.type](_e,Bt)}},e.GridStack.prototype.movable=function(j,_e){return this.opts.staticGrid?this:(e.GridStack.getElements(j).forEach(et=>{let tt=et.gridstackNode;tt&&(_e?delete tt.noMove:tt.noMove=!0,this._prepareDragDropByNode(tt))}),this)},e.GridStack.prototype.resizable=function(j,_e){return this.opts.staticGrid?this:(e.GridStack.getElements(j).forEach(et=>{let tt=et.gridstackNode;tt&&(_e?delete tt.noResize:tt.noResize=!0,this._prepareDragDropByNode(tt))}),this)},e.GridStack.prototype.disable=function(){if(!this.opts.staticGrid)return this.enableMove(!1),this.enableResize(!1),this._triggerEvent("disable"),this},e.GridStack.prototype.enable=function(){if(!this.opts.staticGrid)return this.enableMove(!0),this.enableResize(!0),this._triggerEvent("enable"),this},e.GridStack.prototype.enableMove=function(j){return this.opts.staticGrid?this:(this.opts.disableDrag=!j,this.engine.nodes.forEach(_e=>this.movable(_e.el,j)),this)},e.GridStack.prototype.enableResize=function(j){return this.opts.staticGrid?this:(this.opts.disableResize=!j,this.engine.nodes.forEach(_e=>this.resizable(_e.el,j)),this)},e.GridStack.prototype._removeDD=function(j){return g.draggable(j,"destroy").resizable(j,"destroy"),j.gridstackNode&&delete j.gridstackNode._initDD,delete j.ddElement,this},ddGridstack}var hasRequiredGridstack;function requireGridstack(){return hasRequiredGridstack||(hasRequiredGridstack=1,function(i){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(_e,et,tt,rt){rt===void 0&&(rt=tt),Object.defineProperty(_e,rt,{enumerable:!0,get:function(){return et[tt]}})}:function(_e,et,tt,rt){rt===void 0&&(rt=tt),_e[rt]=et[tt]}),s=commonjsGlobal&&commonjsGlobal.__exportStar||function(_e,et){for(var tt in _e)tt!=="default"&&!et.hasOwnProperty(tt)&&e(et,_e,tt)};Object.defineProperty(i,"__esModule",{value:!0}),i.GridStack=void 0;/*!
 * GridStack 7.1.1
 * https://gridstackjs.com/
 *
 * Copyright (c) 2021-2022 Alain Dumesny
 * see root license https://github.com/gridstack/gridstack.js/tree/master/LICENSE
 */const o=gridstackEngine,a=utils,d=types;s(types,i),s(utils,i),s(gridstackEngine,i);class g{constructor(et,tt={}){var rt,it;this._gsEventHandler={},this._extraDragRow=0,this.el=et,tt=tt||{},tt.row&&(tt.minRow=tt.maxRow=tt.row,delete tt.row);let ot=a.Utils.toNumber(et.getAttribute("gs-row"));tt.column==="auto"&&delete tt.column;let ct=tt;ct.minWidth!==void 0&&(tt.oneColumnSize=tt.oneColumnSize||ct.minWidth,delete ct.minWidth),tt.alwaysShowResizeHandle!==void 0&&(tt._alwaysShowResizeHandle=tt.alwaysShowResizeHandle);let ft=Object.assign(Object.assign({},a.Utils.cloneDeep(d.gridDefaults)),{column:a.Utils.toNumber(et.getAttribute("gs-column"))||d.gridDefaults.column,minRow:ot||a.Utils.toNumber(et.getAttribute("gs-min-row"))||d.gridDefaults.minRow,maxRow:ot||a.Utils.toNumber(et.getAttribute("gs-max-row"))||d.gridDefaults.maxRow,staticGrid:a.Utils.toBool(et.getAttribute("gs-static"))||d.gridDefaults.staticGrid,draggable:{handle:(tt.handleClass?"."+tt.handleClass:tt.handle?tt.handle:"")||d.gridDefaults.draggable.handle},removableOptions:{accept:tt.itemClass?"."+tt.itemClass:d.gridDefaults.removableOptions.accept}});et.getAttribute("gs-animate")&&(ft.animate=a.Utils.toBool(et.getAttribute("gs-animate"))),this.opts=a.Utils.defaults(tt,ft),tt=null,this._initMargin(),this.opts.column!==1&&!this.opts.disableOneColumnMode&&this._widthOrContainer()<=this.opts.oneColumnSize&&(this._prevColumn=this.getColumn(),this.opts.column=1),this.opts.rtl==="auto"&&(this.opts.rtl=et.style.direction==="rtl"),this.opts.rtl&&this.el.classList.add("grid-stack-rtl");let dt=(rt=a.Utils.closestUpByClass(this.el,d.gridDefaults.itemClass))===null||rt===void 0?void 0:rt.gridstackNode;dt&&(dt.subGrid=this,this.parentGridItem=dt,this.el.classList.add("grid-stack-nested"),dt.el.classList.add("grid-stack-sub-grid")),this._isAutoCellHeight=this.opts.cellHeight==="auto",this._isAutoCellHeight||this.opts.cellHeight==="initial"?this.cellHeight(void 0,!1):(typeof this.opts.cellHeight=="number"&&this.opts.cellHeightUnit&&this.opts.cellHeightUnit!==d.gridDefaults.cellHeightUnit&&(this.opts.cellHeight=this.opts.cellHeight+this.opts.cellHeightUnit,delete this.opts.cellHeightUnit),this.cellHeight(this.opts.cellHeight,!1)),this.opts.alwaysShowResizeHandle==="mobile"&&(this.opts.alwaysShowResizeHandle=_.isTouch),this._styleSheetClass="grid-stack-instance-"+o.GridStackEngine._idSeq++,this.el.classList.add(this._styleSheetClass),this._setStaticClass();let pt=this.opts.engineClass||g.engineClass||o.GridStackEngine;if(this.engine=new pt({column:this.getColumn(),float:this.opts.float,maxRow:this.opts.maxRow,onChange:gt=>{let Ct=0;this.engine.nodes.forEach(xt=>{Ct=Math.max(Ct,xt.y+xt.h)}),gt.forEach(xt=>{let at=xt.el;at&&(xt._removeDOM?(at&&at.remove(),delete xt._removeDOM):this._writePosAttr(at,xt))}),this._updateStyles(!1,Ct)}}),this.opts.auto){this.batchUpdate();let gt=[],Ct=this.getColumn();Ct===1&&this._prevColumn&&(Ct=this._prevColumn),this.getGridItems().forEach(xt=>{let at=parseInt(xt.getAttribute("gs-x")),Bt=parseInt(xt.getAttribute("gs-y"));gt.push({el:xt,i:(Number.isNaN(at)?1e3:at)+(Number.isNaN(Bt)?1e3:Bt)*Ct})}),gt.sort((xt,at)=>at.i-xt.i).forEach(xt=>this._prepareElement(xt.el)),this.batchUpdate(!1)}this.setAnimation(this.opts.animate),this._updateStyles(),this.opts.column!=12&&this.el.classList.add("grid-stack-"+this.opts.column),this.opts.dragIn&&g.setupDragIn(this.opts.dragIn,this.opts.dragInOptions),delete this.opts.dragIn,delete this.opts.dragInOptions,this.opts.subGridDynamic&&!j.DDManager.pauseDrag&&(j.DDManager.pauseDrag=!0),((it=this.opts.draggable)===null||it===void 0?void 0:it.pause)!==void 0&&(j.DDManager.pauseDrag=this.opts.draggable.pause),this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateWindowResizeEvent()}static init(et={},tt=".grid-stack"){let rt=g.getGridElement(tt);return rt?(rt.gridstack||(rt.gridstack=new g(rt,a.Utils.cloneDeep(et))),rt.gridstack):(console.error(typeof tt=="string"?'GridStack.initAll() no grid was found with selector "'+tt+`" - element missing or wrong selector ?
Note: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.`:"GridStack.init() no grid element was passed."),null)}static initAll(et={},tt=".grid-stack"){let rt=[];return g.getGridElements(tt).forEach(it=>{it.gridstack||(it.gridstack=new g(it,a.Utils.cloneDeep(et)),delete et.dragIn,delete et.dragInOptions),rt.push(it.gridstack)}),rt.length===0&&console.error('GridStack.initAll() no grid was found with selector "'+tt+`" - element missing or wrong selector ?
Note: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.`),rt}static addGrid(et,tt={}){if(!et)return null;let rt=et;if(!et.classList.contains("grid-stack")){let ot=document.implementation.createHTMLDocument("");ot.body.innerHTML=`<div class="grid-stack ${tt.class||""}"></div>`,rt=ot.body.children[0],et.appendChild(rt)}let it=g.init(tt,rt);if(it.opts.children){let ot=it.opts.children;delete it.opts.children,it.load(ot)}return it}static registerEngine(et){g.engineClass=et}get placeholder(){if(!this._placeholder){let et=document.createElement("div");et.className="placeholder-content",this.opts.placeholderText&&(et.innerHTML=this.opts.placeholderText),this._placeholder=document.createElement("div"),this._placeholder.classList.add(this.opts.placeholderClass,d.gridDefaults.itemClass,this.opts.itemClass),this.placeholder.appendChild(et)}return this._placeholder}addWidget(et,tt){function rt(ft){return ft.x!==void 0||ft.y!==void 0||ft.w!==void 0||ft.h!==void 0||ft.content!==void 0}let it;if(typeof et=="string"){let ft=document.implementation.createHTMLDocument("");ft.body.innerHTML=et,it=ft.body.children[0]}else if(arguments.length===0||arguments.length===1&&rt(et)){let ft=et&&et.content||"";tt=et;let dt=document.implementation.createHTMLDocument("");dt.body.innerHTML=`<div class="grid-stack-item ${this.opts.itemClass||""}"><div class="grid-stack-item-content">${ft}</div></div>`,it=dt.body.children[0]}else it=et;let ot=this._readAttr(it);tt=a.Utils.cloneDeep(tt)||{},a.Utils.defaults(tt,ot);let ct=this.engine.prepareNode(tt);return this._writeAttr(it,tt),this._insertNotAppend?this.el.prepend(it):this.el.appendChild(it),this._prepareElement(it,!0,tt),this._updateContainerHeight(),ct.subGrid&&this.makeSubGrid(ct.el,void 0,void 0,!1),this._prevColumn&&this.opts.column===1&&(this._ignoreLayoutsNodeChange=!0),this._triggerAddEvent(),this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,it}makeSubGrid(et,tt,rt,it=!0){var ot;let ct=et.gridstackNode;if(ct||(ct=this.makeWidget(et).gridstackNode),!((ot=ct.subGrid)===null||ot===void 0)&&ot.el)return ct.subGrid;tt=a.Utils.cloneDeep(tt||ct.subGrid||Object.assign(Object.assign({},this.opts.subGrid),{children:void 0})),tt.subGrid=a.Utils.cloneDeep(tt),ct.subGrid=tt;let ft;tt.column==="auto"&&(ft=!0,tt.column=Math.max(ct.w||1,(rt==null?void 0:rt.w)||1),tt.disableOneColumnMode=!0);let dt=ct.el.querySelector(".grid-stack-item-content"),pt,gt;if(it){this._removeDD(ct.el);let xt=document.implementation.createHTMLDocument("");xt.body.innerHTML='<div class="grid-stack-item"></div>',pt=xt.body.children[0],pt.appendChild(dt),gt=Object.assign(Object.assign({},ct),{x:0,y:0}),a.Utils.removeInternalForSave(gt),delete gt.subGrid,ct.content&&(gt.content=ct.content,delete ct.content),xt.body.innerHTML='<div class="grid-stack-item-content"></div>',dt=xt.body.children[0],ct.el.appendChild(dt),this._prepareDragDropByNode(ct)}if(rt){let xt=ft?tt.column:ct.w,at=ct.h+rt.h,Bt=ct.el.style;Bt.transition="none",this.update(ct.el,{w:xt,h:at}),setTimeout(()=>Bt.transition=null)}let Ct=ct.subGrid=g.addGrid(dt,tt);return rt!=null&&rt._moving&&(Ct._isTemp=!0),ft&&(Ct._autoColumn=!0),it&&Ct.addWidget(pt,gt),rt&&(rt._moving?window.setTimeout(()=>a.Utils.simulateMouseEvent(rt._event,"mouseenter",Ct.el),0):Ct.addWidget(ct.el,ct)),Ct}removeAsSubGrid(et){var tt;let rt=(tt=this.parentGridItem)===null||tt===void 0?void 0:tt.grid;rt&&(rt.batchUpdate(),rt.removeWidget(this.parentGridItem.el,!0,!0),this.engine.nodes.forEach(it=>{it.x+=this.parentGridItem.x,it.y+=this.parentGridItem.y,rt.addWidget(it.el,it)}),rt.batchUpdate(!1),delete this.parentGridItem,et&&window.setTimeout(()=>a.Utils.simulateMouseEvent(et._event,"mouseenter",rt.el),0))}save(et=!0,tt=!1){let rt=this.engine.save(et);if(rt.forEach(it=>{if(et&&it.el&&!it.subGrid){let ot=it.el.querySelector(".grid-stack-item-content");it.content=ot?ot.innerHTML:void 0,it.content||delete it.content}else et||delete it.content,it.subGrid&&(it.subGrid=it.subGrid.save(et,!0));delete it.el}),tt){let it=a.Utils.cloneDeep(this.opts);it.marginBottom===it.marginTop&&it.marginRight===it.marginLeft&&it.marginTop===it.marginRight&&(it.margin=it.marginTop,delete it.marginTop,delete it.marginRight,delete it.marginBottom,delete it.marginLeft),it.rtl===(this.el.style.direction==="rtl")&&(it.rtl="auto"),this._isAutoCellHeight&&(it.cellHeight="auto"),this._autoColumn&&(it.column="auto",delete it.disableOneColumnMode);const ot=it._alwaysShowResizeHandle;return delete it._alwaysShowResizeHandle,ot!==void 0?it.alwaysShowResizeHandle=ot:delete it.alwaysShowResizeHandle,a.Utils.removeInternalAndSame(it,d.gridDefaults),it.children=rt,it}return rt}load(et,tt=!0){let rt=g.Utils.sort([...et],-1,this._prevColumn||this.getColumn());this._insertNotAppend=!0,this._prevColumn&&this._prevColumn!==this.opts.column&&rt.some(ot=>ot.x+ot.w>this.opts.column)&&(this._ignoreLayoutsNodeChange=!0,this.engine.cacheLayout(rt,this._prevColumn,!0));let it=[];return this.batchUpdate(),tt&&[...this.engine.nodes].forEach(ct=>{rt.find(dt=>ct.id===dt.id)||(typeof tt=="function"?tt(this,ct,!1):(it.push(ct),this.removeWidget(ct.el,!0,!1)))}),rt.forEach(ot=>{let ct=ot.id||ot.id===0?this.engine.nodes.find(ft=>ft.id===ot.id):void 0;if(ct){if(this.update(ct.el,ot),ot.subGrid&&ot.subGrid.children){let ft=ct.el.querySelector(".grid-stack");ft&&ft.gridstack&&(ft.gridstack.load(ot.subGrid.children),this._insertNotAppend=!0)}}else tt&&(typeof tt=="function"?ot=tt(this,ot,!0).gridstackNode:ot=this.addWidget(ot).gridstackNode)}),this.engine.removedNodes=it,this.batchUpdate(!1),delete this._ignoreLayoutsNodeChange,delete this._insertNotAppend,this}batchUpdate(et=!0){return this.engine.batchUpdate(et),et||(this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()),this}getCellHeight(et=!1){if(this.opts.cellHeight&&this.opts.cellHeight!=="auto"&&(!et||!this.opts.cellHeightUnit||this.opts.cellHeightUnit==="px"))return this.opts.cellHeight;let tt=this.el.querySelector("."+this.opts.itemClass);if(tt){let it=a.Utils.toNumber(tt.getAttribute("gs-h"));return Math.round(tt.offsetHeight/it)}let rt=parseInt(this.el.getAttribute("gs-current-row"));return rt?Math.round(this.el.getBoundingClientRect().height/rt):this.opts.cellHeight}cellHeight(et,tt=!0){if(tt&&et!==void 0&&this._isAutoCellHeight!==(et==="auto")&&(this._isAutoCellHeight=et==="auto",this._updateWindowResizeEvent()),(et==="initial"||et==="auto")&&(et=void 0),et===void 0){let it=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom;et=this.cellWidth()+it}let rt=a.Utils.parseHeight(et);return this.opts.cellHeightUnit===rt.unit&&this.opts.cellHeight===rt.h?this:(this.opts.cellHeightUnit=rt.unit,this.opts.cellHeight=rt.h,tt&&this._updateStyles(!0),this)}cellWidth(){return this._widthOrContainer()/this.getColumn()}_widthOrContainer(){return this.el.clientWidth||this.el.parentElement.clientWidth||window.innerWidth}compact(){return this.engine.compact(),this._triggerChangeEvent(),this}column(et,tt="moveScale"){if(et<1||this.opts.column===et)return this;let rt=this.getColumn();et===1?this._prevColumn=rt:delete this._prevColumn,this.el.classList.remove("grid-stack-"+rt),this.el.classList.add("grid-stack-"+et),this.opts.column=this.engine.column=et;let it;return et===1&&this.opts.oneColumnModeDomSort&&(it=[],this.getGridItems().forEach(ot=>{ot.gridstackNode&&it.push(ot.gridstackNode)}),it.length||(it=void 0)),this.engine.updateNodeWidths(rt,et,it,tt),this._isAutoCellHeight&&this.cellHeight(),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,this}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter(et=>et.matches("."+this.opts.itemClass)&&!et.matches("."+this.opts.placeholderClass))}destroy(et=!0){if(this.el)return this._updateWindowResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),et?this.el.parentNode.removeChild(this.el):(this.removeAll(et),this.el.classList.remove(this._styleSheetClass)),this._removeStylesheet(),this.el.removeAttribute("gs-current-row"),delete this.parentGridItem,delete this.opts,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(et){return this.opts.float!==et&&(this.opts.float=this.engine.float=et,this._triggerChangeEvent()),this}getFloat(){return this.engine.float}getCellFromPixel(et,tt=!1){let rt=this.el.getBoundingClientRect(),it;tt?it={top:rt.top+document.documentElement.scrollTop,left:rt.left}:it={top:this.el.offsetTop,left:this.el.offsetLeft};let ot=et.left-it.left,ct=et.top-it.top,ft=rt.width/this.getColumn(),dt=rt.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(ot/ft),y:Math.floor(ct/dt)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow)}isAreaEmpty(et,tt,rt,it){return this.engine.isAreaEmpty(et,tt,rt,it)}makeWidget(et){let tt=g.getElement(et);return this._prepareElement(tt,!0),this._updateContainerHeight(),this._triggerAddEvent(),this._triggerChangeEvent(),tt}on(et,tt){return et.indexOf(" ")!==-1?(et.split(" ").forEach(it=>this.on(it,tt)),this):(et==="change"||et==="added"||et==="removed"||et==="enable"||et==="disable"?(et==="enable"||et==="disable"?this._gsEventHandler[et]=it=>tt(it):this._gsEventHandler[et]=it=>tt(it,it.detail),this.el.addEventListener(et,this._gsEventHandler[et])):et==="drag"||et==="dragstart"||et==="dragstop"||et==="resizestart"||et==="resize"||et==="resizestop"||et==="dropped"?this._gsEventHandler[et]=tt:console.log("GridStack.on("+et+') event not supported, but you can still use $(".grid-stack").on(...) while jquery-ui is still used internally.'),this)}off(et){return et.indexOf(" ")!==-1?(et.split(" ").forEach(rt=>this.off(rt)),this):((et==="change"||et==="added"||et==="removed"||et==="enable"||et==="disable")&&this._gsEventHandler[et]&&this.el.removeEventListener(et,this._gsEventHandler[et]),delete this._gsEventHandler[et],this)}removeWidget(et,tt=!0,rt=!0){return g.getElements(et).forEach(it=>{if(it.parentElement&&it.parentElement!==this.el)return;let ot=it.gridstackNode;ot||(ot=this.engine.nodes.find(ct=>it===ct.el)),ot&&(delete it.gridstackNode,this._removeDD(it),this.engine.removeNode(ot,tt,rt),tt&&it.parentElement&&it.remove())}),rt&&(this._triggerRemoveEvent(),this._triggerChangeEvent()),this}removeAll(et=!0){return this.engine.nodes.forEach(tt=>{delete tt.el.gridstackNode,this._removeDD(tt.el)}),this.engine.removeAll(et),this._triggerRemoveEvent(),this}setAnimation(et){return et?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this}setStatic(et,tt=!0){return this.opts.staticGrid===et?this:(this.opts.staticGrid=et,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach(rt=>this._prepareDragDropByNode(rt)),tt&&this._setStaticClass(),this)}update(et,tt){if(arguments.length>2){console.warn("gridstack.ts: `update(el, x, y, w, h)` is deprecated. Use `update(el, {x, w, content, ...})`. It will be removed soon");let rt=arguments,it=1;return tt={x:rt[it++],y:rt[it++],w:rt[it++],h:rt[it++]},this.update(et,tt)}return g.getElements(et).forEach(rt=>{if(!rt||!rt.gridstackNode)return;let it=rt.gridstackNode,ot=a.Utils.cloneDeep(tt);delete ot.autoPosition;let ct=["x","y","w","h"],ft;if(ct.some(gt=>ot[gt]!==void 0&&ot[gt]!==it[gt])&&(ft={},ct.forEach(gt=>{ft[gt]=ot[gt]!==void 0?ot[gt]:it[gt],delete ot[gt]})),!ft&&(ot.minW||ot.minH||ot.maxW||ot.maxH)&&(ft={}),ot.content){let gt=rt.querySelector(".grid-stack-item-content");gt&&gt.innerHTML!==ot.content&&(gt.innerHTML=ot.content),delete ot.content}let dt=!1,pt=!1;for(const gt in ot)gt[0]!=="_"&&it[gt]!==ot[gt]&&(it[gt]=ot[gt],dt=!0,pt=pt||!this.opts.staticGrid&&(gt==="noResize"||gt==="noMove"||gt==="locked"));ft&&(this.engine.cleanNodes().beginUpdate(it).moveNode(it,ft),this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()),dt&&this._writeAttr(rt,it),pt&&this._prepareDragDropByNode(it)}),this}margin(et){if(!(typeof et=="string"&&et.split(" ").length>1)){let rt=a.Utils.parseHeight(et);if(this.opts.marginUnit===rt.unit&&this.opts.margin===rt.h)return}return this.opts.margin=et,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this._initMargin(),this._updateStyles(!0),this}getMargin(){return this.opts.margin}willItFit(et){if(arguments.length>1){console.warn("gridstack.ts: `willItFit(x,y,w,h,autoPosition)` is deprecated. Use `willItFit({x, y,...})`. It will be removed soon");let tt=arguments,rt=0,it={x:tt[rt++],y:tt[rt++],w:tt[rt++],h:tt[rt++],autoPosition:tt[rt++]};return this.willItFit(it)}return this.engine.willItFit(et)}_triggerChangeEvent(){if(this.engine.batchMode)return this;let et=this.engine.getDirtyNodes(!0);return et&&et.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(et),this._triggerEvent("change",et)),this.engine.saveInitial(),this}_triggerAddEvent(){return this.engine.batchMode?this:(this.engine.addedNodes&&this.engine.addedNodes.length>0&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach(et=>{delete et._dirty}),this._triggerEvent("added",this.engine.addedNodes),this.engine.addedNodes=[]),this)}_triggerRemoveEvent(){return this.engine.batchMode?this:(this.engine.removedNodes&&this.engine.removedNodes.length>0&&(this._triggerEvent("removed",this.engine.removedNodes),this.engine.removedNodes=[]),this)}_triggerEvent(et,tt){let rt=tt?new CustomEvent(et,{bubbles:!1,detail:tt}):new Event(et);return this.el.dispatchEvent(rt),this}_removeStylesheet(){return this._styles&&(a.Utils.removeStylesheet(this._styleSheetClass),delete this._styles),this}_updateStyles(et=!1,tt){if(et&&this._removeStylesheet(),tt||(tt=this.getRow()),this._updateContainerHeight(),this.opts.cellHeight===0)return this;let rt=this.opts.cellHeight,it=this.opts.cellHeightUnit,ot=`.${this._styleSheetClass} > .${this.opts.itemClass}`;if(!this._styles){let ct=this.opts.styleInHead?void 0:this.el.parentNode;if(this._styles=a.Utils.createStylesheet(this._styleSheetClass,ct),!this._styles)return this;this._styles._max=0,a.Utils.addCSSRule(this._styles,ot,`min-height: ${rt}${it}`);let ft=this.opts.marginTop+this.opts.marginUnit,dt=this.opts.marginBottom+this.opts.marginUnit,pt=this.opts.marginRight+this.opts.marginUnit,gt=this.opts.marginLeft+this.opts.marginUnit,Ct=`${ot} > .grid-stack-item-content`,xt=`.${this._styleSheetClass} > .grid-stack-placeholder > .placeholder-content`;a.Utils.addCSSRule(this._styles,Ct,`top: ${ft}; right: ${pt}; bottom: ${dt}; left: ${gt};`),a.Utils.addCSSRule(this._styles,xt,`top: ${ft}; right: ${pt}; bottom: ${dt}; left: ${gt};`),a.Utils.addCSSRule(this._styles,`${ot} > .ui-resizable-ne`,`right: ${pt}`),a.Utils.addCSSRule(this._styles,`${ot} > .ui-resizable-e`,`right: ${pt}`),a.Utils.addCSSRule(this._styles,`${ot} > .ui-resizable-se`,`right: ${pt}; bottom: ${dt}`),a.Utils.addCSSRule(this._styles,`${ot} > .ui-resizable-nw`,`left: ${gt}`),a.Utils.addCSSRule(this._styles,`${ot} > .ui-resizable-w`,`left: ${gt}`),a.Utils.addCSSRule(this._styles,`${ot} > .ui-resizable-sw`,`left: ${gt}; bottom: ${dt}`)}if(tt=tt||this._styles._max,tt>this._styles._max){let ct=ft=>rt*ft+it;for(let ft=this._styles._max+1;ft<=tt;ft++){let dt=ct(ft);a.Utils.addCSSRule(this._styles,`${ot}[gs-y="${ft-1}"]`,`top: ${ct(ft-1)}`),a.Utils.addCSSRule(this._styles,`${ot}[gs-h="${ft}"]`,`height: ${dt}`),a.Utils.addCSSRule(this._styles,`${ot}[gs-min-h="${ft}"]`,`min-height: ${dt}`),a.Utils.addCSSRule(this._styles,`${ot}[gs-max-h="${ft}"]`,`max-height: ${dt}`)}this._styles._max=tt}return this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;let et=this.getRow()+this._extraDragRow;if(this.el.setAttribute("gs-current-row",String(et)),et===0)return this.el.style.removeProperty("min-height"),this;let tt=this.opts.cellHeight,rt=this.opts.cellHeightUnit;return tt?(this.el.style.minHeight=et*tt+rt,this):this}_prepareElement(et,tt=!1,rt){rt||(et.classList.add(this.opts.itemClass),rt=this._readAttr(et)),et.gridstackNode=rt,rt.el=et,rt.grid=this;let it=Object.assign({},rt);return rt=this.engine.addNode(rt,tt),a.Utils.same(rt,it)||this._writeAttr(et,rt),this._prepareDragDropByNode(rt),this}_writePosAttr(et,tt){return tt.x!==void 0&&tt.x!==null&&et.setAttribute("gs-x",String(tt.x)),tt.y!==void 0&&tt.y!==null&&et.setAttribute("gs-y",String(tt.y)),tt.w&&et.setAttribute("gs-w",String(tt.w)),tt.h&&et.setAttribute("gs-h",String(tt.h)),this}_writeAttr(et,tt){if(!tt)return this;this._writePosAttr(et,tt);let rt={autoPosition:"gs-auto-position",minW:"gs-min-w",minH:"gs-min-h",maxW:"gs-max-w",maxH:"gs-max-h",noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id",resizeHandles:"gs-resize-handles"};for(const it in rt)tt[it]?et.setAttribute(rt[it],String(tt[it])):et.removeAttribute(rt[it]);return this}_readAttr(et){let tt={};tt.x=a.Utils.toNumber(et.getAttribute("gs-x")),tt.y=a.Utils.toNumber(et.getAttribute("gs-y")),tt.w=a.Utils.toNumber(et.getAttribute("gs-w")),tt.h=a.Utils.toNumber(et.getAttribute("gs-h")),tt.maxW=a.Utils.toNumber(et.getAttribute("gs-max-w")),tt.minW=a.Utils.toNumber(et.getAttribute("gs-min-w")),tt.maxH=a.Utils.toNumber(et.getAttribute("gs-max-h")),tt.minH=a.Utils.toNumber(et.getAttribute("gs-min-h")),tt.autoPosition=a.Utils.toBool(et.getAttribute("gs-auto-position")),tt.noResize=a.Utils.toBool(et.getAttribute("gs-no-resize")),tt.noMove=a.Utils.toBool(et.getAttribute("gs-no-move")),tt.locked=a.Utils.toBool(et.getAttribute("gs-locked")),tt.resizeHandles=et.getAttribute("gs-resize-handles"),tt.id=et.getAttribute("gs-id");for(const rt in tt){if(!tt.hasOwnProperty(rt))return;!tt[rt]&&tt[rt]!==0&&delete tt[rt]}return tt}_setStaticClass(){let et=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...et),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...et),this.el.removeAttribute("gs-static")),this}onParentResize(){if(!this.el||!this.el.clientWidth)return;let et=!1;if(this._autoColumn&&this.parentGridItem)this.opts.column!==this.parentGridItem.w&&(et=!0,this.column(this.parentGridItem.w,"none"));else{let tt=!this.opts.disableOneColumnMode&&this.el.clientWidth<=this.opts.oneColumnSize;this.opts.column===1!==tt&&(et=!0,this.opts.animate&&this.setAnimation(!1),this.column(tt?1:this._prevColumn),this.opts.animate&&this.setAnimation(!0))}return this._isAutoCellHeight&&(!et&&this.opts.cellHeightThrottle?(this._cellHeightThrottle||(this._cellHeightThrottle=a.Utils.throttle(()=>this.cellHeight(),this.opts.cellHeightThrottle)),this._cellHeightThrottle()):this.cellHeight()),this.engine.nodes.forEach(tt=>{tt.subGrid&&tt.subGrid.onParentResize()}),this}_updateWindowResizeEvent(et=!1){const tt=(this._isAutoCellHeight||!this.opts.disableOneColumnMode)&&!this.parentGridItem;return!et&&tt&&!this._windowResizeBind?(this._windowResizeBind=this.onParentResize.bind(this),window.addEventListener("resize",this._windowResizeBind)):(et||!tt)&&this._windowResizeBind&&(window.removeEventListener("resize",this._windowResizeBind),delete this._windowResizeBind),this}static getElement(et=".grid-stack-item"){return a.Utils.getElement(et)}static getElements(et=".grid-stack-item"){return a.Utils.getElements(et)}static getGridElement(et){return g.getElement(et)}static getGridElements(et){return a.Utils.getElements(et)}_initMargin(){let et,tt=0,rt=[];return typeof this.opts.margin=="string"&&(rt=this.opts.margin.split(" ")),rt.length===2?(this.opts.marginTop=this.opts.marginBottom=rt[0],this.opts.marginLeft=this.opts.marginRight=rt[1]):rt.length===4?(this.opts.marginTop=rt[0],this.opts.marginRight=rt[1],this.opts.marginBottom=rt[2],this.opts.marginLeft=rt[3]):(et=a.Utils.parseHeight(this.opts.margin),this.opts.marginUnit=et.unit,tt=this.opts.margin=et.h),this.opts.marginTop===void 0?this.opts.marginTop=tt:(et=a.Utils.parseHeight(this.opts.marginTop),this.opts.marginTop=et.h,delete this.opts.margin),this.opts.marginBottom===void 0?this.opts.marginBottom=tt:(et=a.Utils.parseHeight(this.opts.marginBottom),this.opts.marginBottom=et.h,delete this.opts.margin),this.opts.marginRight===void 0?this.opts.marginRight=tt:(et=a.Utils.parseHeight(this.opts.marginRight),this.opts.marginRight=et.h,delete this.opts.margin),this.opts.marginLeft===void 0?this.opts.marginLeft=tt:(et=a.Utils.parseHeight(this.opts.marginLeft),this.opts.marginLeft=et.h,delete this.opts.margin),this.opts.marginUnit=et.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop),this}static setupDragIn(et,tt){}movable(et,tt){return this}resizable(et,tt){return this}disable(){return this}enable(){return this}enableMove(et){return this}enableResize(et){return this}_removeDD(et){return this}_setupAcceptWidget(){return this}_setupRemoveDrop(){return this}_prepareDragDropByNode(et){return this}_onStartMoving(et,tt,rt,it,ot,ct){}_dragOrResize(et,tt,rt,it,ot,ct){}_leave(et,tt){}commit(){return a.obsolete(this,this.batchUpdate(!1),"commit","batchUpdate","5.2"),this}}i.GridStack=g,g.Utils=a.Utils,g.Engine=o.GridStackEngine,g.GDRev="7.1.1";const _=requireDdTouch(),j=requireDdManager();s(requireDdGridstack(),i)}(gridstack)),gridstack}var gridstackExports=requireGridstack();function clearPosition(i){i.style.position="",i.style.left="",i.style.right="",i.style.top="",i.style.bottom="",i.style.width="",i.style.height=""}class GridStackManager{constructor(e){Lo(this,"cellHeight",150);Lo(this,"cellApproxWidth",300);Lo(this,"grids");Lo(this,"dragHandle",".ciview-chart-title");Lo(this,"chartManager");this.grids=new Map,this.chartManager=e}getGrid(e){if(!this.grids.has(e)){const s=e.contentDiv;s.classList.add("grid-stack");const o=s.getBoundingClientRect(),a=Math.round(o.width/this.cellApproxWidth);console.log(a);const d=Math.round(o.height/this.cellHeight);this.cellHeight=o.height/d,console.log("gridstack cellHeight",this.cellHeight);const g=gridstackExports.GridStack.init({cellHeight:this.cellHeight,handle:this.dragHandle,float:!0,oneColumnSize:400},s);g.on("resizestop",(j,_e)=>{_e instanceof HTMLElement&&(_e.style.filter="")}),g.on("resizestart",(j,_e)=>{_e instanceof HTMLElement&&(_e.style.filter="blur(1px) opacity(0.5)")});const _=this.chartManager.addMenuIcon(e.name,"fas fa-compress-arrows-alt","compact layout",()=>g.compact());this.grids.set(e,{grid:g,charts:new Set,icon:_})}return this.grids.get(e)}destroy(e){this.grids.has(e)||console.error(`destroying non-existent gridstack - ${e.name}`);const s=this.grids.get(e),o=e.contentDiv,a=new Map;for(let d of s.charts){const g=d.getDiv();a.set(g,[g.offsetWidth,g.offsetHeight,g.offsetLeft,g.offsetTop]),d.removeLayout(),delete d.config.gssize,delete d.config.gsposition}s.grid.destroy(!1);for(let d of s.charts){const g=d.getDiv(),_=a.get(g);g.style.position="absolute",g.style.width=_[0]-5+"px",g.style.height=_[1]-5+"px",g.style.left=_[2]+"px",g.style.top=_[3]+"px",d.config.size=[_[0]-5,_[1]-5],d.config.position=[_[2],_[3]],g.classList.remove("grid-stack-item")}o.classList.remove("grid-stack"),s.icon.remove(),this.grids.delete(e)}getCellDimensions(e){return[this.getGrid(e).grid.cellWidth(),this.cellHeight]}manageChart(e,s,o){const a=this.getGrid(s),d=a.grid;a.charts.add(e);const g=e.getDiv(),_=g.getBoundingClientRect();let j=Math.round(_.width/d.cellWidth()),_e=Math.round(_.height/this.cellHeight),et=Math.round(g.offsetLeft/d.cellWidth());et=et>11?11:et;let tt=Math.floor(g.offsetTop/this.cellHeight);e.config.gsposition&&([et,tt]=e.config.gsposition,[j,_e]=e.config.gssize,o=!1),clearPosition(g),g.style.transition="filter 0.5s ease";const rt=new ResizeObserver(debounce(()=>{try{e.setSize()}catch{}},20));rt.observe(g),d.makeWidget(g),o?d.update(g,{w:j,h:_e}):(console.log({w:j,h:_e,x:et,y:tt}),d.update(g,{w:j,h:_e,x:et,y:tt}));const it=pt(),ot=ft(),ct=dt();function ft(){let Ct=!1;const xt=e.addMenuIcon("fas fa-unlock","lock position"),at=xt.children[0];return xt.addEventListener("click",()=>{Ct=!Ct,at.classList.toggle("fa-lock",Ct),at.classList.toggle("fa-unlock",!Ct),d.update(g,{locked:Ct}),g.classList.toggle("gridLock",Ct)}),xt}function dt(){const{remove:Ct}=e;return e.remove=()=>{d.removeWidget(g,!0),a.charts.delete(e),Ct.apply(e)},Ct}function pt(){const{changeBaseDocument:Ct}=e;return g.gridstackPopoutCallback=()=>{d.removeWidget(g,!0)},e.changeBaseDocument=xt=>{Ct.apply(e,[xt]),xt===document&&console.error("changeBaseDocument should be restored to normal by the time we get here..."),gt()},Ct}function gt(){d.removeWidget(g,!0),ot.remove(),e.remove=ct,e.changeBaseDocument=it}e.removeLayout=()=>{d.removeWidget(g,!1),ot.remove(),delete g.gridstackPopoutCallback,e.remove=ct,e.changeBaseDocument=it,rt.disconnect()}}}const column_orders={double:0,integer:0,int32:0,multitext:1,text:2,unique:2},themes={Dark:{title_bar_color:"#222",main_panel_color:"black",text_color:"white",background_color:"#333"},Light:{title_bar_color:"white",main_panel_color:"#f1f1f1",text_color:"black",background_color:"#bababa"}};function getPreferredColorScheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"Dark":"Light"}function listenPreferredColorScheme(i){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>i(getPreferredColorScheme()))}class ChartManager{constructor(e,s,o,a={},d=null){this.listeners={},this.infoAlerts={},this.progressBars={},this.setTheme(getPreferredColorScheme()),listenPreferredColorScheme(j=>this.setTheme(j)),this.dataSources=[],this.dsIndex={},this.columnsLoading={};for(const j of s){const _e={name:j.name,dataStore:new DataStore(j.size,j),link_to:j.link_to,index_link_to:j.index_link_to,color:j.color||themes[this.theme].background_color,column_link_to:j.column_link_to,links:j.links,custom:j.custom||{}};this.dataSources.push(_e),this.dsIndex[j.name]=_e,this._addDSListeners(_e),this.columnsLoading[j.name]={}}if(d&&this.addListener("_default",d),this.transactions={},this.containerDiv=typeof e=="string"?document.getElementById(e):e,this.containerDiv.style.display="flex",this.containerDiv.style.flexDirection="column",this.menuBar=createEl("div",{classes:["ciview-main-menu-bar"]},this.containerDiv),this.leftMenuBar=createEl("span",{},this.menuBar),this.rightMenuBar=createEl("span",{styles:{float:"right"}},this.menuBar),createEl("span",{classes:["mdv-divider"]},this.menuBar),a.all_views){this.viewSelect=createEl("select",{},this.menuBar);for(let j of a.all_views)createEl("option",{text:j,value:j},this.viewSelect);this.viewSelect.addEventListener("change",j=>{this.config.show_save_view_dialog&&a.permission==="edit"?this.showSaveViewDialog(()=>this.changeView(this.viewSelect.value)):this.changeView(this.viewSelect.value)})}a.permission==="edit"&&createMenuIcon("fas fa-save",{tooltip:{text:"Save View",position:"bottom-right"},func:()=>{const j=this.getState();this._callListeners("state_saved",j)}},this.menuBar),a.permission==="edit"&&a.all_views&&(createMenuIcon("fas fa-plus",{tooltip:{text:"Create New View",position:"bottom-right"},func:()=>{this.showSaveViewDialog(()=>this.showAddViewDialog())}},this.menuBar),createMenuIcon("fas fa-minus",{tooltip:{text:"Delete Current View",position:"bottom-right"},func:()=>{this.showDeleteViewDialog()}},this.menuBar));const g=createMenuIcon("fas fa-adjust",{tooltip:{text:"Change Theme",position:"bottom-left"},func:j=>{this.themeMenu.show(j)}},this.rightMenuBar);g.style.margin="3px",this._setupThemeContextMenu(),this.contentDiv=createEl("div",{styles:{flex:"1 1 auto",position:"relative"}},this.containerDiv),this.contentDiv.classList.add("ciview-contentDiv"),this.gridStack=new GridStackManager(this),this.charts={},this.config=a;const _=this.config;if(_.chart_color=_.chart_color||"white",this.dataLoader=o.function,this.viewLoader=o.viewLoader,this.layoutMenus={},o.files){this.filesToLoad=o.files.length;for(let j of o.files)this.loadFile(j,()=>{this.filesToLoad--,this.filesToLoad===0&&this._loadView(a,o,!0)})}else this._loadView(a,o,!0)}_setUpChangeLayoutMenu(e){this.layoutMenus[e.name]=new ContextMenu(()=>{const s=this.viewData.dataSources[e.name].layout||"absolute";return[{text:"Absolute",ghosted:s==="absolute",func:()=>this.changeLayout("absolute",e)},{text:"Grid Stack",ghosted:s==="gridstack",func:()=>this.changeLayout("gridstack",e)}]})}changeLayout(e,s){const o=this.viewData.dataSources[s.name],a=o.layout||"absolute";e!==a&&(a==="gridstack"?this.gridStack.destroy(s):a==="absolute"&&this.getAllCharts(s.name).forEach(d=>{const g=d.getDiv();removeResizable(g),removeDraggable(g)}),o.layout=e,e==="absolute"?this.getAllCharts(s.name).forEach(d=>this._makeChartRD(d,s)):e==="gridstack"&&this.getAllCharts(s.name).forEach(d=>{this.gridStack.manageChart(d,s,this._inInit)}))}_setupThemeContextMenu(){this.themeMenu=new ContextMenu(()=>{const e=[];for(let s in themes)e.push(this.__getMenuItem(s));return e})}__getMenuItem(e){return{text:e,ghosted:this.theme===e,func:()=>this.setTheme(e)}}setTheme(e){if(this.theme=e,document.getElementsByTagName("html")[0].className=e,!!this.charts)for(let s in this.charts){const o=this.charts[s];o.chart.themeChanged&&o.chart.themeChanged()}}_sync_colors(e,s,o){for(let a of e){const d=s.columnIndex[a.link_to],g=o.columnIndex[a.col],_=new Array(g.values),j=s.getColumnColors(a.link_to);for(let _e=0;_e<d.values.length;_e++){const et=d.values[_e],tt=g.values.indexOf(et);tt!==-1&&(_[tt]=j[_e])}g.colors=_}}_initiateOffsets(e){const s=e.dataStore,o=s.offsets,a=o.param,d=[a[0],a[1],o.groups];o.background_filter&&d.push(o.background_filter),this._getColumnsThen(e.name,d,()=>{s.initiateOffsets(),s.updateColumnOffsets(),s.updateColumnOffsets(null,!0,!0)})}_loadView(e,s,o=!1){e.all_views?(this.currentView=e.initial_view||e.all_views[0],this.viewSelect.value=this.currentView,s.viewLoader(this.currentView).then(a=>{this._init(a,o)})):this._init(e.only_view,o)}getDataSource(e){return this.dsIndex[e].dataStore}_init(e,s=!1){if(e){if(!e.dataSources){e.dataSources={};for(let _ in e.initialCharts)e.dataSources[_]={}}this.viewData=e}else{const _={};for(let j in this.dsIndex)_[j]={layout:"gridstack"};this.viewData={dataSources:_,initialCharts:{}}}for(let _ of this.dataSources)delete _.contentDiv,delete _.menuBar;const o=Object.keys(this.viewData.dataSources);let a=[];for(let _ of o){let j=this.viewData.dataSources[_].panelWidth;if(!j){a=null;break}a.push(j)}this.dsPanes={};const d=splitPane(this.contentDiv,{number:o.length,sizes:a});for(let _=0;_<o.length;_++){const j=d[_];j.style.display="flex",j.style.flexDirection="column";const _e=this.dsIndex[o[_]];this.dsPanes[_e.name]=j,this.columnsLoading[_e.name]={},_e.charts=[],_e.menuBar=createEl("div",{classes:["ciview-menu-bar"]},j);const et=createEl("div",{styles:{flex:"1 1 auto",position:"relative",overflow:"auto",height:"100px"}},j);this._setUpMenu(_e),_e.contentDiv=createEl("div",{styles:{position:"relative",height:"100%"}},et),_e.contentDiv.classList.add("ciview-contentDiv"),this._setUpChangeLayoutMenu(_e)}if(s)for(let _ of this.dataSources){const j=_.dataStore;j.offsets&&this._initiateOffsets(_),_.column_link_to&&this._sync_colors(_.column_link_to.columns,this.dsIndex[_.column_link_to.dataSource].dataStore,j);for(let _e of j.syncColumnColors)this._sync_colors(_e.columns,this.dsIndex[_e.dataSource].dataStore,j)}const g=e.initialCharts||{};this._toLoadCharts=new Set;for(let _ in g)for(let j of g[_])this._toLoadCharts.add(j);this._toLoadCharts.size==0&&(delete this._toLoadCharts,this._callListeners("view_loaded",this.currentView)),this._inInit=!0;for(let _ in g)for(let j of g[_])this.addChart(_,j);this._inInit=!1}_addDSListeners(e){e.dataStore.addListener("l1",(s,o)=>{if(s==="column_removed")this._columnRemoved(e,o);else if(s==="data_highlighted")o.dataStore=e.dataStore,this._callListeners(s,o);else if(s==="filtered"){if(!this.progressBars[e.name])return;e.dataStore.size;const a=e.dataStore.filterSize;this.progressBars[e.name].setValue(a),this.progressBars[e.name].setText(a),this._callListeners(s,o)}})}showAddViewDialog(){const e=[{type:"checkbox",id:"clone-view",label:"Clone current view"},{type:"text",id:"name",label:"name"}];if(this.dataSources.length>1)for(let s of this.dataSources)e.push({type:"checkbox",id:s.name,label:`Include ${s.name}`});new CustomDialog({title:"Add New View",controls:e,buttons:[{text:"Create New View",method:s=>{if(createEl("option",{text:s.name,value:s.name},this.viewSelect),this.viewSelect.value=s.name,this.currentView=s.name,s["clone-view"]){const o=this.getState();this._callListeners("state_saved",o)}else{for(let a in this.viewData.dataSources)this.viewData.dataSources[a].layout==="gridstack"&&this.gridStack.destroy(this.dsIndex[a]);this.removeAllCharts(),this.viewData.links=[];const o=this.getState();if(o.view.initialCharts={},o.view.dataSources={},this.dataSources.length===1)o.view.initialCharts[this.dataSources[0].name]=[],o.viewDataSources[this.dataSources[0].name]={};else for(let a in this.dsIndex)s[a]&&(o.view.initialCharts[a]=[],o.view.dataSources[a]={});this._callListeners("state_saved",o),this.contentDiv.innerHTML="",this._init(o.view)}}}]})}showSaveViewDialog(e){new CustomDialog({title:"Save View",text:"Do you want to save the current view",buttons:[{text:"YES",method:()=>{const s=this.getState();this._callListeners("state_saved",s),e()}},{text:"NO",method:()=>{e()}}]})}showDeleteViewDialog(){new CustomDialog({title:"Delete View",text:"Do you want to delete the current view?",buttons:[{text:"YES",method:()=>{this.deleteCurrentView()}},{text:"NO",method:()=>{}}]})}changeView(e){for(let s in this.viewData.dataSources)this.viewData.dataSources[s].layout==="gridstack"&&this.gridStack.destroy(this.dsIndex[s]);this.removeAllCharts(),this.contentDiv.innerHTML="",this.currentView=e,this.viewLoader(e).then(s=>{this._init(s)})}deleteCurrentView(){const e=this.viewSelect.querySelector(`option[value='${this.viewSelect.value}']`);this.getState(),this.currentView=this.viewSelect.value,e.remove(),this.changeView(this.viewSelect.value)}_columnRemoved(e,s){const o=[];for(let a in this.charts){const d=this.charts[a];if(d.dataSource===e){const g=d.chart,_=g.getDiv();g.onColumnRemoved(s)&&(_.remove(!1),o.push(a),this._removeLinks(g),this._callListeners("chart_removed",g))}}o.length>0&&e.dataStore._callListeners("filtered");for(let a of o)delete this.charts[a]}_getColumnsRequiredForChart(e){const s=new Set,o=e.param;if(o)if(typeof o=="string")s.add(o);else for(let d of o)s.add(d);e.color_by&&(e.color_by.column?s.add(e.color_by.column.field):s.add(e.color_by)),e.tooltip&&e.tooltip.column&&s.add(e.tooltip.column),e.background_filter&&s.add(e.background_filter.column);const a=BaseChart.types[e.type];return a.configEntriesUsingColumns&&a.configEntriesUsingColumns.forEach(d=>{let g=e[d];if(g){g=Array.isArray(g)?g:[g];for(let _ of g)s.add(_)}}),[...s]}loadFile(e,s){const o={csv,json,tsv},a=this.createInfoAlert("loading file",{spinner:!0});o[e.type](e.url).then(d=>{const g={},_=e.dataSource,j=this.dsIndex[_].dataStore,_e=j.getAllColumns();for(let tt of d.columns)j.columnIndex[tt]&&(g[tt]=[]);for(let tt=0;tt<d.length;tt++){const rt=d[tt];tt+1%100===0&&this.updateInfoAlert(a,`processed ${tt}/${d.length} rows`);for(let it in g)g[it].push(rt[it])}let et=0;for(let tt in g)j.setColumnData(tt,g[tt]),et++,this.updateInfoAlert(a,`processed ${et}/${_e.length} columns`);this.updateInfoAlert(a,"complete",{duration:2e3}),s&&s()})}_getUpdatedColumns(e){const s=e.dirtyColumns,o={columns:[],added:[],removed:[],colors_changed:[]};for(let d in s.added){const g=a(d);o.columns.push(g),o.added.push(d)}for(let d in s.removed)o.removed.push(d);for(let d in s.data_changed)if(!o.columns[d]){const g=a(d);o.columns.push(g)}for(let d in s.colors_changed)o.colors_changed.push({column:d,colors:e.columnIndex[d].colors});return o;function a(d){const g=e.columnIndex[d],_={values:g.values,datatype:g.datatype,name:g.name,editable:!0,field:g.field},j=new Array(g.data.length);for(let _e=0;_e<g.data.length;_e++)j[_e]=g.data[_e];return{metadata:_,data:j}}}getState(){const e={},s={},o={};this.contentDiv.offsetWidth;for(const g of this.dataSources){if(g.contentDiv){e[g.name]=[];let j=this.dsPanes[g.name].style.width;const _e=/calc\((.+)\%.+/;this.viewData.dataSources[g.name].panelWidth=parseFloat(j.match(_e)[1])}s[g.name]=this._getUpdatedColumns(g.dataStore);const _=g.dataStore;if(_.dirtyMetadata.size!==0){o[g.name]={};for(let j of _.dirtyMetadata)o[g.name][j]=_[j]}}for(let g in this.charts){const _=this.charts[g],j=_.chart,_e=j.getConfig(),et=j.getDiv();this.viewData.dataSources[_.dataSource.name].layout==="gridstack"?(_e.gsposition=[parseInt(et.getAttribute("gs-x")),parseInt(et.getAttribute("gs-y"))],_e.gssize=[parseInt(et.getAttribute("gs-w")),parseInt(et.getAttribute("gs-h"))]):_e.position=[et.offsetLeft,et.offsetTop],e[_.dataSource.name].push(_e)}const a=JSON.parse(JSON.stringify(this.viewData));a.initialCharts=e;const d=this.viewSelect?Array.from(this.viewSelect.children,g=>g.value):null;return{view:a,currentView:this.currentView,all_views:d,updatedColumns:s,metadata:o}}setAllColumnsClean(){for(let e of this.dataSources)e.dataStore.setAllColumnsClean()}showCustomDialog(e){new CustomDialog(e)}addMenuIcon(e,s,o,a){const d=e==="_main"?"bottom-right":"bottom",g=e==="_main"?this.leftMenuBar:this.dsIndex[e].menuBar;return createMenuIcon(s,{tooltip:{text:o,position:d},func:a},g)}createInfoAlert(e,s={}){let o=getRandomString();const a=Object.keys(this.infoAlerts).length;s.type=s.type||"info";const d=createEl("div",{classes:["ciview-info-alert","ciview-alert-"+s.type],styles:{right:"10px",top:50+a*40+"px"}},this.containerDiv);let g=null;const _=createEl("span",{text:e},d);return s.spinner&&(g=createEl("i",{classes:["fas","fa-spinner","fa-spin","ciview-info-alert-spin"]},d)),this.infoAlerts[o]={div:d,text:_,spinner:g,type:s.type},s.duration&&this.removeInfoAlert(o,s.duration),o}updateInfoAlert(e,s,o={}){const a=this.infoAlerts[e];o.type&&a.type!==o.type&&(a.div.classList.remove("ciview-alert-"+a.type),a.div.classList.add("ciview-alert-"+o.type),a.type=o.type),a.text.textContent=s,o.duration&&this.removeInfoAlert(e,o.duration)}removeInfoAlert(e,s=2e3){const o=this.infoAlerts[e].spinner;o&&o.remove(),setTimeout(()=>{if(!this.infoAlerts[e])return;this.infoAlerts[e].div.remove(),delete this.infoAlerts[e];let a=50;for(let d in this.infoAlerts)this.infoAlerts[d].div.style.top=a+"px",a+=40},s)}clearInfoAlerts(){for(const e in this.infoAlerts)this.infoAlerts[e].div.remove();this.infoAlerts={}}loadColumnSet(e,s,o,a=10,d=2){const g=getRandomString();this.transactions[g]={callback:o,columns:[],totalColumns:e.length,failedColumns:[],nextColumn:0,columnsLoaded:0,id:g};let _=[];const j=this.transactions[g];for(let et of e)this.columnsLoading[s][et]=!0,_.push(et),_.length===a&&(j.columns.push(_),_=[]);_.length!==0&&(j.columns.push(_),_=[]),j.alertID=this.createInfoAlert(`Loading Columns:0/${e.length}`,{spinner:!0});const _e=Math.min(j.columns.length,d);for(let et=0;et<_e;et++)this._loadColumnData(j,s)}_loadColumnData(e,s){const o=this.dsIndex[s].dataStore,a=e.columns[e.nextColumn++],d=[];for(let g of a)d.push(o.getColumnInfo(g));d.sort((g,_)=>column_orders[g.datatype]-column_orders[_.datatype]),this.dataLoader(d,s,o.size).then(g=>{for(let _ of g)o.setColumnData(_.field,_.data);e.columnsLoaded++}).catch(g=>{console.log(g),e.columnsLoaded++,e.failedColumns.push(d)}).finally(()=>{const g=e.columns.length,_=e.columnsLoaded;let j=_*a.length;for(let _e of a)delete this.columnsLoading[s][_e];j=j>e.totalColumns?e.totalColumns:j,this.updateInfoAlert(e.alertID,`Loading Columns:${j}/${e.totalColumns}`),_>=g&&(this.updateInfoAlert(e.alertID,`Loaded ${g} column${g===1?"":"s"}`,{duration:2e3}),e.callback(e.failedColumns),delete this.transactions[e.id]),e.nextColumn<g&&this._loadColumnData(e,s)})}_addLinkIcon(e,s,o){createMenuIcon("fas fa-plus-square",{tooltip:{text:`Add ${o.name}`,position:"bottom-right"},func:()=>{new AddColumnsFromRowsDialog(e,s,o,this)}},e.menuBar)}_setUpMenu(e){const s=e.dataStore;if(createMenuIcon("fas fa-chart-bar",{tooltip:{text:"Add Chart",position:"bottom-right"},func:()=>{new AddChartDialog(e,_=>this.addChart(e.name,_,!0))}},e.menuBar),createMenuIcon("fas fa-sync-alt",{tooltip:{text:"Reset All Filters",position:"bottom-right"},func:()=>{s.removeAllFilters()}},e.menuBar),createMenuIcon("fas fa-palette",{tooltip:{text:"Change Color Scheme",position:"bottom-right"},func:()=>{try{new ColorChooser(this,e)}catch(_){console.error("error making ColorChooser",_),this.createInfoAlert("Error making color chooser",{type:"warning",duration:2e3})}}},e.menuBar),createMenuIcon("fas fa-th",{tooltip:{text:"Change layout",position:"bottom-right"},func:_=>{this.layoutMenus[e.name].show(_)}},e.menuBar),s.links)for(let _ in s.links){const j=s.links[_];j.rows_as_columns&&this._addLinkIcon(e,this.dsIndex[_],j.rows_as_columns)}const o=createEl("div",{styles:{float:"right",lineHeight:"1.0"}},e.menuBar);createEl("span",{text:e.name,styles:{verticalAlign:"top",fontSize:"16px",marginRight:"4px"}},o);const a=e.dataStore.size;e.filterBar=createEl("progress",{value:a},e.menBar);const d=createEl("div",{styles:{width:"100px",display:"inline-block",marginTop:"2px"}},o),g={max:a,value:a,text:`${a}`};this.progressBars[e.name]=new MDVProgress(d,g)}addListener(e,s){this.listeners[e]=s}removeListener(e){delete this.listeners[e]}_callListeners(e,s){for(let o in this.listeners)this.listeners[o](e,this,s)}addChart(e,s,o=!1){const a=this._getColumnsRequiredForChart(s);if(s.location){const it=s.location,ot=5;s.size=[it.width*90+it.width*ot-ot,it.height*40+it.height*ot-ot],s.position=[(it.x+1)*ot+it.x*90,(it.y+1)*ot+it.y*40]}const d=this.dsIndex[e];let g=300,_=300,j=10,_e=10;if(s.size&&(g=s.size[0],_=s.size[1]),s.position&&(j=s.position[0],_e=s.position[1]),this.viewData.dataSources[e].layout==="gridstack"&&s.gssize){const it=this.gridStack.getCellDimensions(this.dsIndex[e]);g=Math.round(s.gssize[0]*it[0]),_=Math.round(s.gssize[1]*it[1]),j=Math.round(s.gsposition[0]*(it[0]+5)),_e=Math.floor(s.gsposition[1]*(it[1]+5))}const et=themes[this.theme],tt=createEl("div",{styles:{position:"absolute",width:g+"px",height:_+"px",left:j+"px",top:_e+"px",background:et.main_panel_color,zIndex:2,display:"flex",alignItems:"center",justifyContent:"center"}},d.contentDiv);createEl("i",{classes:["fas","fa-circle-notch","fa-spin"],styles:{fontSize:"30px",color:et.text_color}},tt),createEl("div",{styles:{position:"absolute",overflow:"hide",textAlign:"center",top:"3px",color:et.text_color,textOverflow:"ellipsis",wordBreak:"break-all",fontSize:"16px"},text:s.title},tt);const rt=()=>{this._addChart(e,s,tt,o)};try{this._getColumnsThen(e,a,rt)}catch(it){this.clearInfoAlerts();const ot=this.createInfoAlert(`Error creating chart with columns [${a.join(", ")}]: '${it}'`,{type:"warning"});console.log(it);const ct=this.infoAlerts[ot].div;ct.onclick=()=>ct.remove(),tt.remove()}}_getColumnsFromOtherSource(e,s,o,a,d){this._getColumnsThen(s,o.concat(a),()=>{const g=this.dsIndex[e].dataStore,_=this.dsIndex[s].dataStore,j=_.getColumnIndex(a),_e=g.columnIndex[a],et=_e.values.map(rt=>j[rt]),tt=o.map(rt=>{const it=g.columnIndex[rt],ot=_.columnIndex[rt];ot.values&&(it.values=ot.values),ot.minMax&&(it.minMax=ot.minMax),ot.quantiles&&(it.quantiles=ot.quantiles);const ct=new SharedArrayBuffer(g.size*(it.datatype==="text"?1:4)),ft=it.datatype==="text"?Uint8Array:Float32Array;return{col:rt,data:ct,arr:new ft(ct),odata:ot.data}});for(let rt=0;rt<g.size;rt++){const it=et[_e.data[rt]];for(let ot of tt)ot.arr[rt]=ot.odata[it]}for(let rt of tt)g.setColumnData(rt.col,rt.data);d()})}_getColumnsThen(e,s,o){const d=this.dsIndex[e].dataStore;if(d.links)for(let _ in d.links){const j=d.links[_];if(j.columns){const _e=[],et=[];for(let tt of s)j.columns.indexOf(tt)===-1?et.push(tt):d.columnIndex[tt].data||_e.push(tt);if(_e.length>0){this._getColumnsThen(e,[j.index],()=>{this._getColumnsFromOtherSource(e,_,_e,j.index,()=>{this._getColumnsThen(e,et,o)})});return}}}const g=s.filter(_=>{if(this.columnsLoading[e][_])return!1;const j=d.columnIndex[_];return j?!j.data:(d.addColumnFromField(_),!0)});g.length===0?this._haveColumnsLoaded(s,e,o):this.loadColumnSet(g,e,()=>{this._haveColumnsLoaded(s,e,o)})}_decorateColumnMethod(e,s,o){const a="_"+e;s[a]=s[e],s[e]=d=>{this._getColumnsThen(o,[d],()=>s[a](d))}}__decorateColumnMethod(e,s,o){const a="_"+e;s[a]=s[e];const d=this;s[e]=function(){if(arguments[0]==null)s[a](...arguments);else{const g=Array.isArray(arguments[0])?arguments[0]:[arguments[0]];d._getColumnsThen(o,g,()=>s[a](...arguments))}}}_haveColumnsLoaded(e,s,o){for(let a of e)if(this.columnsLoading[s][a]){setTimeout(()=>{this._haveColumnsLoaded(e,s,o)},500);return}o()}_addChart(e,s,o,a=!1){const d=this.dsIndex[e];o.innerHTML="",o.style.display="",o.style.alignItems="",o.style.justifyContent="";const g=BaseChart.types[s.type],_=new g.class(d.dataStore,o,s);if(this.charts[_.config.id]={chart:_,dataSource:d},this._makeChartRD(_,d),_.popoutIcon=_.addMenuIcon("fas fa-external-link-alt","popout",{func:()=>{this._popOutChart(_)}}),_.addMenuIcon("fas fa-times","remove chart").addEventListener("click",()=>{_.remove(),o.remove(),delete this.charts[_.config.id],this._removeLinks(_),this._callListeners("chart_removed",_)}),_.colorByColumn&&this._decorateColumnMethod("colorByColumn",_,e),_.setToolTipColumn&&this._decorateColumnMethod("setToolTipColumn",_,e),_.setBackgroundFilter&&this._decorateColumnMethod("setBackgroundFilter",_,e),_.changeContourParameter&&this._decorateColumnMethod("changeContourParameter",_,e),g.methodsUsingColumns)for(let _e of g.methodsUsingColumns)this.__decorateColumnMethod(_e,_,e);if(_.setupLinks){d.index_link_to&&this._giveChartAccess(_,this.dsIndex[d.index_link_to.dataSource].dataStore,d.index_link_to.index);for(let _e of d.dataStore.accessOtherDataStore)this._giveChartAccess(_,this.dsIndex[_e.dataSource].dataStore,_e.index)}const j=d.column_link_to;if(j&&_.createColumnLinks){const _e=(et,tt)=>{this._getColumnsThen(j.dataSource,et,tt)};_.createColumnLinks(this.dsIndex[j.dataSource].dataStore,j.columns,_e)}if(a&&this._callListeners("chart_added",_),this._toLoadCharts&&(this._toLoadCharts.delete(s),this._toLoadCharts.size===0)){if(delete this._toLoadCharts,this.viewData.links)for(let _e of this.viewData.links)this._setUpLink(_e);this._callListeners("view_loaded",this.currentView)}return _}_giveChartAccess(e,s,o){const a=(d,g)=>{d.push(o),this._getColumnsThen(s.name,d,g)};e.setupLinks(s,o,a)}_setUpLink(e){switch(e.id||(e.id=getRandomString()),e.type){case"color_by_column":const s=this.charts[e.source_chart];s||console.error(`broken link link:${e.id}`),s.chart.addListener(e.id,(o,a)=>{if(o==="cell_clicked")for(let d of e.target_charts)this.getChart(d).colorByColumn(a.row)});break}}_removeLinks(e){const s=[],o=e.config.id,a=this.viewData.links;if(a){for(let d=0;d<a.length;d++){const g=a[d];g.source_chart===o&&s.push(d);const _=g.target_charts.indexOf(o);_!==-1&&(g.target_charts.splice(_,1),g.target_charts.length===0&&s.push(d))}for(let d of s)this.removeLink(d)}}removeLink(e){const s=this.viewData.links[e];switch(s.type){case"color_by_column":this.charts[s.source_chart].chart.removeListener(s.id)}this.viewData.links.splice(e,1)}removeAllCharts(e){const s=[];for(let o in this.charts){const a=this.charts[o];e&&e.indexOf(a.dataSource.name)===-1||s.push([a.chart,a.window])}for(let o of s)o[1]&&o[1].close(),o[0].remove(),o[0].div.remove();this.charts={}}getAllFilters(e){const s=this.getAllCharts(e),o=[];for(let a of s){const d=a.getFilter();d&&o.push(d)}return o}getChart(e){const s=this.charts[e];return s?s.chart:null}getAllCharts(e){const s=[];for(let o in this.charts){const a=this.charts[o];a.dataSource.name===e&&s.push(a.chart)}return s}setChartsAsGrid(e=5,s=[300,300],o=10){let a=o,d=o,g=0;for(let _ in this.charts){const _e=this.charts[_].chart.getDiv();_e.style.left=d+"px",_e.style.top=a+"px",d+=s[0]+o,g++,g===e&&(g=0,d=o,a+=s[1]+o)}}addButton(e,s,o){createEl("button",{classes:["ciview-button"],text:e,styles:{position:"fixed",bottom:"40px",right:"40px",fontSize:"18px",zIndex:100}},this.contentDiv).addEventListener("click",()=>s())}_popOutChart(e){const s=e.getDiv(),o=this.charts[e.config.id],a={dim:[e.config.size[0],e.config.size[1]],pos:[s.style.left,s.style.top]};s.gridstackPopoutCallback&&s.gridstackPopoutCallback(),removeResizable(s),removeDraggable(s);const d=new PopOutWindow((g,_)=>{e.setSize(_.width,_.height),s.style.top="5px",s.style.left="5px",g.body.append(s),e.changeBaseDocument(g),g.body.style.overflow="hidden",e.popoutIcon.style.display="none"},(g,_)=>{o.dataSource.contentDiv.append(s),e.changeBaseDocument(document),s.style.left=a.pos[0],s.style.top=a.pos[1],e.setSize(a.dim[0],a.dim[1]),this._makeChartRD(e,o.dataSource),e.popoutIcon.style.display="inline",delete o.window},{onresize:(g,_)=>{e.setSize(_.width,_.height)},url:this.config.popouturl||"/"});o.window=d}_sendAllChartsToBack(e){for(let s in this.charts){const o=this.charts[s];e===o.dataSource&&(o.chart.div.style.zIndex="")}}_makeChartRD(e,s){if(s&&this.gridStack&&this.viewData.dataSources[s.name].layout==="gridstack"){this.gridStack.manageChart(e,s,this._inInit);return}const o=e.getDiv();makeDraggable(o,{handle:".ciview-chart-title",contain:"topleft",ondragstart:a=>{this._sendAllChartsToBack(s),o.style.zIndex=2}}),makeResizable(o,{onResizeStart:()=>{this._sendAllChartsToBack(s),o.style.zIndex=2},onresizeend:(a,d)=>e.setSize(a,d)})}}class ChooseColumnDialog extends BaseDialog{constructor(e,s,o="all"){const a={footer:!0,width:250,maxHeight:500,title:"Select Columns",buttons:[{text:"OK",method:"getColumns"}]};super(a,{dataStore:e,callback:s,filter:o})}init(e){this.ds=e.dataStore;const s=createEl("div",{styles:{padding:"8px"}}),o=getRandomString();createEl("div",{text:"Groups"},this.dialog);const a=Object.keys(this.ds.columnGroups);a.unshift("All");for(let _ of a){const j=createEl("span",{styles:{display:"inline-block",whiteSpace:"nowrap",marginRight:"5px"}},s);createEl("span",{text:_},j),createEl("input",{type:"radio",value:_,name:o},j).addEventListener("click",_e=>{this.checkAllInGroup(_e.target.value)})}this.dialog.append(s),createEl("div",{text:"Select Individual Columns"},this.dialog);const d=createEl("div",{style:{padding:"8px"}}),g=this.ds.getColumnList(e.filter);this.checks=[],this.callback=e.callback;for(let _ of g){const j=createEl("div",{styles:{whiteSpace:"nowrap"}},d),_e=createEl("input",{type:"checkbox"},j);this.checks.push([_e,_.field]),createEl("span",{text:_.name},j)}this.dialog.append(d)}checkAllInGroup(e){if(e==="All")for(let s of this.checks)s[0].checked=!0;else{const s=this.ds.columnGroups[e].columns;for(let o of this.checks)o[0].checked=s.indexOf(o[1])!==-1}}getColumns(){const e=[];for(let s of this.checks)s[0].checked&&e.push(s[1]);this.callback(e),this.close()}}class AddChartDialog extends BaseDialog{constructor(e,s){const o={title:"Add Chart",columns:2,footer:!0,width:380};super(o,{dataSource:e,callback:s})}init(e){this.extraControls={};const s=[];this.dataSource=e.dataSource,this.dataStore=e.dataSource.dataStore;for(let o in BaseChart.types){const a=BaseChart.types[o];let d=!0;if(a.required){for(let g of a.required)this.dataStore[g]||(d=!1);if(!d)continue}a.allow_user_add!==!1&&s.push({name:a.name,type:o})}s.sort((o,a)=>o.name.localeCompare(a.name)),this.defaultType=s[0].type,createEl("div",{text:"Chart Type",classes:["ciview-title-div"]},this.columns[0]),this.chartType=createEl("select",{styles:{maxWidth:"200px"}},this.columns[0]);for(let o of s)createEl("option",{text:o.name,value:o.type},this.chartType);this.chartType.addEventListener("change",o=>{this.setParamDiv(this.chartType.value,e.dataStore)}),createEl("div",{text:"Title",classes:["ciview-title-div"]},this.columns[0]),this.chartName=createEl("input",{},this.columns[0]),createEl("div",{text:"Description",classes:["ciview-title-div"]},this.columns[0]),this.chartDescription=createEl("textarea",{styles:{height:"100px"}},this.columns[0]),createEl("div",{text:"Columns",classes:["ciview-title-div"]},this.columns[1]),this.paramDiv=createEl("div",{},this.columns[1]),this.setParamDiv(s[0].type,e.dataStore),createEl("button",{text:"Add",classes:["ciview-button"]},this.footer).addEventListener("click",()=>this.submit(e.callback))}submit(e){const s={title:this.chartName.value,legend:this.chartDescription.value,type:this.chartType.value,param:this.paramSelects.map(d=>d.value)},o={};for(let d in this.extraControls){const g=this.extraControls[d];o[d]=g.type==="checkbox"?g.value==="on":g.value,s[d]=o[d]}this.multiColumns&&(s.param=s.param.concat(this.multiColumns)),console.log("config from add chart dialog",s);const a=BaseChart.types[this.chartType.value];a.init&&a.init(s,this.dataSource.dataStore,o),e(s),this.chartName.value="",this.chartDescription.value="",this.close()}_addMultiColumnSelect(e,s){const o=this.dataStore.getColumnList(s);let a="";o.length>1&&(a=`${o[0].name},... (1)`,this.multiColumns=[o[0].field]);const d=createEl("span",{text:a},e);createEl("i",{classes:["fas","fa-plus"]},e),e.style.cursor="pointer",e.addEventListener("click",()=>{new ChooseColumnDialog(this.dataStore,g=>{this.multiColumns=g;let _="";if(g.length>0){const j=g.length<3?g.length:3,_e=[];for(let et=0;et<j;et++)_e.push(this.dataStore.getColumnName(g[et]));_=_e.join(","),g.length>3&&(_+=",...."),_+=`(${g.length})`,d.textContent=_}},s)})}setParamDiv(e){this.paramDiv.innerHTML="";const s=BaseChart.types[e].params;if(this.paramSelects=[],s)for(let a of s){const d=createEl("div",{styles:{padding:"4px"}},this.paramDiv);createEl("div",{text:a.name+":"},d);const g=createEl("div",{},this.paramDiv);if(!Array.isArray(a.type)&&a.type.startsWith("_multi"))this._addMultiColumnSelect(g,a.type.split(":")[1]);else{this.multiColumns=null;const _=createEl("select",{styles:{maxWidth:"200px"}},g),j=this.dataStore.getColumnList(a.type),_e={};for(let et of this.dataStore.subgroupDataSources)_e[et]=createEl("optgroup",{label:et});for(let et of j){let tt=_;et.subgroup&&(tt=_e[et.subgroup.dataSource]),createEl("option",{text:et.name,value:et.field},tt)}for(let et of this.dataStore.subgroupDataSources)_.append(_e[et]);this.paramSelects.push(_)}}const o=BaseChart.types[this.chartType.value];if(this.extraControls={},o.extra_controls){const a=o.extra_controls(this.dataSource.dataStore),d=this.paramDiv;for(let g of a)if(createEl("div",{text:g.label,classes:["ciview-title-div"]},d),g.type==="dropdown"){const _=createEl("select",{styles:{maxWidth:"200px"}},d);for(let j of g.values){const _e=createEl("option",{text:j.name,value:j.value},_);j.value===g.defaultVal&&(_e.selected=!0)}this.extraControls[g.name]=_}else if(g.type==="string"){const _=createEl("input",{value:g.defaultVal},d);this.extraControls[g.name]=_}else if(g.type==="textbox"){const _=createEl("textarea",{value:g.defaultVal,styles:{height:"300px"}},d);this.extraControls[g.name]=_}else if(g.type==="checkbox"||g.type==="check"){const _=createEl("input",{type:"checkbox"},d);_.checked=g.defaultVal,this.extraControls[g.name]=_}}}}function assert$3(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const isBrowser$1=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),matches$1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches$1&&parseFloat(matches$1[1]);const VERSION$1="3.2.12";function assert$2(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const isBrowser=typeof process!="object"||String(process)!=="[object process]"||process.browser,isMobile=typeof window<"u"&&typeof window.orientation<"u",matches=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);class WorkerJob{constructor(e,s){_defineProperty(this,"name",void 0),_defineProperty(this,"workerThread",void 0),_defineProperty(this,"isRunning",!0),_defineProperty(this,"result",void 0),_defineProperty(this,"_resolve",()=>{}),_defineProperty(this,"_reject",()=>{}),this.name=e,this.workerThread=s,this.result=new Promise((o,a)=>{this._resolve=o,this._reject=a})}postMessage(e,s){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:s})}done(e){assert$2(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){assert$2(this.isRunning),this.isRunning=!1,this._reject(e)}}let Worker$1=class{};const workerURLCache=new Map;function getLoadableWorkerURL(i){assert$2(i.source&&!i.url||!i.source&&i.url);let e=workerURLCache.get(i.source||i.url);return e||(i.url&&(e=getLoadableWorkerURLFromURL(i.url),workerURLCache.set(i.url,e)),i.source&&(e=getLoadableWorkerURLFromSource(i.source),workerURLCache.set(i.source,e))),assert$2(e),e}function getLoadableWorkerURLFromURL(i){if(!i.startsWith("http"))return i;const e=buildScriptSource(i);return getLoadableWorkerURLFromSource(e)}function getLoadableWorkerURLFromSource(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function buildScriptSource(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function getTransferList(i,e=!0,s){const o=s||new Set;if(i){if(isTransferable(i))o.add(i);else if(isTransferable(i.buffer))o.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const a in i)getTransferList(i[a],e,o)}}return s===void 0?Array.from(o):[]}function isTransferable(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const NOOP=()=>{};class WorkerThread{static isSupported(){return typeof Worker<"u"&&isBrowser||typeof Worker$1<"u"&&!isBrowser}constructor(e){_defineProperty(this,"name",void 0),_defineProperty(this,"source",void 0),_defineProperty(this,"url",void 0),_defineProperty(this,"terminated",!1),_defineProperty(this,"worker",void 0),_defineProperty(this,"onMessage",void 0),_defineProperty(this,"onError",void 0),_defineProperty(this,"_loadableURL","");const{name:s,source:o,url:a}=e;assert$2(o||a),this.name=s,this.source=o,this.url=a,this.onMessage=NOOP,this.onError=d=>console.log(d),this.worker=isBrowser?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=NOOP,this.onError=NOOP,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,s){s=s||getTransferList(e),this.worker.postMessage(e,s)}_getErrorFromErrorEvent(e){let s="Failed to load ";return s+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(s+="".concat(e.message," in ")),e.lineno&&(s+=":".concat(e.lineno,":").concat(e.colno)),new Error(s)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=s=>{s.data?this.onMessage(s.data):this.onError(new Error("No data received"))},e.onerror=s=>{this.onError(this._getErrorFromErrorEvent(s)),this.terminated=!0},e.onmessageerror=s=>console.error(s),e}_createNodeWorker(){let e;if(this.url){const o=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Worker$1(o,{eval:!1})}else if(this.source)e=new Worker$1(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",s=>{this.onMessage(s)}),e.on("error",s=>{this.onError(s)}),e.on("exit",s=>{}),e}}class WorkerPool{static isSupported(){return WorkerThread.isSupported()}constructor(e){_defineProperty(this,"name","unnamed"),_defineProperty(this,"source",void 0),_defineProperty(this,"url",void 0),_defineProperty(this,"maxConcurrency",1),_defineProperty(this,"maxMobileConcurrency",1),_defineProperty(this,"onDebug",()=>{}),_defineProperty(this,"reuseWorkers",!0),_defineProperty(this,"props",{}),_defineProperty(this,"jobQueue",[]),_defineProperty(this,"idleQueue",[]),_defineProperty(this,"count",0),_defineProperty(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,s=(a,d,g)=>a.done(g),o=(a,d)=>a.error(d)){const a=new Promise(d=>(this.jobQueue.push({name:e,onMessage:s,onError:o,onStart:d}),this));return this._startQueuedJob(),await a}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const s=this.jobQueue.shift();if(s){this.onDebug({message:"Starting job",name:s.name,workerThread:e,backlog:this.jobQueue.length});const o=new WorkerJob(s.name,e);e.onMessage=a=>s.onMessage(o,a.type,a.payload),e.onError=a=>s.onError(o,a),s.onStart(o);try{await o.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS$1={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class WorkerFarm{static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){_defineProperty(this,"props",void 0),_defineProperty(this,"workerPools",new Map),this.props={...DEFAULT_PROPS$1},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const s of this.workerPools.values())s.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:s,source:o,url:a}=e;let d=this.workerPools.get(s);return d||(d=new WorkerPool({name:s,source:o,url:a}),d.setProps(this._getWorkerPoolProps()),this.workerPools.set(s,d)),d}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}_defineProperty(WorkerFarm,"_workerFarm",void 0);const NPM_TAG="latest";function getWorkerURL(i,e={}){const s=e[i.id]||{},o="".concat(i.id,"-worker.js");let a=s.workerUrl;if(!a&&i.id==="compression"&&(a=e.workerUrl),e._workerType==="test"&&(a="modules/".concat(i.module,"/dist/").concat(o)),!a){let d=i.version;d==="latest"&&(d=NPM_TAG);const g=d?"@".concat(d):"";a="https://unpkg.com/@loaders.gl/".concat(i.module).concat(g,"/dist/").concat(o)}return assert$2(a),a}function validateWorkerVersion(i,e=VERSION$1){assert$2(i,"no worker provided");const s=i.version;return!(!e||!s)}function canParseWithWorker(i,e){return!WorkerFarm.isSupported()||!isBrowser&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function parseWithWorker(i,e,s,o,a){const d=i.id,g=getWorkerURL(i,s),j=WorkerFarm.getWorkerFarm(s).getWorkerPool({name:d,url:g});s=JSON.parse(JSON.stringify(s)),o=JSON.parse(JSON.stringify(o||{}));const _e=await j.startJob("process-on-worker",onMessage.bind(null,a));return _e.postMessage("process",{input:e,options:s,context:o}),await(await _e.result).result}async function onMessage(i,e,s,o){switch(s){case"done":e.done(o);break;case"error":e.error(new Error(o.error));break;case"process":const{id:a,input:d,options:g}=o;try{const _=await i(d,g);e.postMessage("done",{id:a,result:_})}catch(_){const j=_ instanceof Error?_.message:"unknown error";e.postMessage("error",{id:a,error:j})}break;default:console.warn("parse-with-worker unknown message ".concat(s))}}function isBuffer$1(i){return i&&typeof i=="object"&&i.isBuffer}function bufferToArrayBuffer(i){return isBuffer$1(i)?new Uint8Array(i.buffer,i.byteOffset,i.length).slice().buffer:i}function toArrayBuffer(i){if(isBuffer$1(i))return bufferToArrayBuffer(i);if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function compareArrayBuffers(i,e,s){if(s=s||i.byteLength,i.byteLength<s||e.byteLength<s)return!1;const o=new Uint8Array(i),a=new Uint8Array(e);for(let d=0;d<o.length;++d)if(o[d]!==a[d])return!1;return!0}function concatenateArrayBuffers(...i){const e=i.map(d=>d instanceof ArrayBuffer?new Uint8Array(d):d),s=e.reduce((d,g)=>d+g.byteLength,0),o=new Uint8Array(s);let a=0;for(const d of e)o.set(d,a),a+=d.byteLength;return o.buffer}async function concatenateArrayBuffersAsync(i){const e=[];for await(const s of i)e.push(s);return concatenateArrayBuffers(...e)}let pathPrefix="";const fileAliases={};function resolvePath(i){for(const e in fileAliases)if(i.startsWith(e)){const s=fileAliases[e];i=i.replace(e,s)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(pathPrefix).concat(i)),i}function filename(i){const e=i&&i.lastIndexOf("/");return e>=0?i.substr(e+1):""}const isBoolean=i=>typeof i=="boolean",isFunction=i=>typeof i=="function",isObject$1=i=>i!==null&&typeof i=="object",isPureObject=i=>isObject$1(i)&&i.constructor==={}.constructor,isIterable=i=>i&&typeof i[Symbol.iterator]=="function",isAsyncIterable$1=i=>i&&typeof i[Symbol.asyncIterator]=="function",isResponse=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,isBlob=i=>typeof Blob<"u"&&i instanceof Blob,isBuffer=i=>i&&typeof i=="object"&&i.isBuffer,isReadableDOMStream=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||isObject$1(i)&&isFunction(i.tee)&&isFunction(i.cancel)&&isFunction(i.getReader),isReadableNodeStream=i=>isObject$1(i)&&isFunction(i.read)&&isFunction(i.pipe)&&isBoolean(i.readable),isReadableStream=i=>isReadableDOMStream(i)||isReadableNodeStream(i),DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function parseMIMEType(i){const e=MIME_TYPE_PATTERN.exec(i);return e?e[1]:i}function parseMIMETypeFromURL(i){const e=DATA_URL_PATTERN.exec(i);return e?e[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function getResourceUrlAndType(i){if(isResponse(i)){const e=stripQueryString(i.url||""),s=i.headers.get("content-type")||"";return{url:e,type:parseMIMEType(s)||parseMIMETypeFromURL(e)}}return isBlob(i)?{url:stripQueryString(i.name||""),type:i.type||""}:typeof i=="string"?{url:stripQueryString(i),type:parseMIMETypeFromURL(i)}:{url:"",type:""}}function getResourceContentLength(i){return isResponse(i)?i.headers["content-length"]||-1:isBlob(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}function stripQueryString(i){return i.replace(QUERY_STRING_PATTERN,"")}async function makeResponse(i){if(isResponse(i))return i;const e={},s=getResourceContentLength(i);s>=0&&(e["content-length"]=String(s));const{url:o,type:a}=getResourceUrlAndType(i);a&&(e["content-type"]=a);const d=await getInitialDataUrl(i);d&&(e["x-first-bytes"]=d),typeof i=="string"&&(i=new TextEncoder().encode(i));const g=new Response(i,{headers:e});return Object.defineProperty(g,"url",{value:o}),g}async function checkResponse(i){if(!i.ok){const e=await getResponseError(i);throw new Error(e)}}async function getResponseError(i){let e="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const s=i.headers.get("Content-Type");let o=i.statusText;s.includes("application/json")&&(o+=" ".concat(await i.text())),e+=o,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function getInitialDataUrl(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const s=i.slice(0,5);return await new Promise(o=>{const a=new FileReader;a.onload=d=>{var g;return o(d==null||(g=d.target)===null||g===void 0?void 0:g.result)},a.readAsDataURL(s)})}if(i instanceof ArrayBuffer){const s=i.slice(0,5),o=arrayBufferToBase64(s);return"data:base64,".concat(o)}return null}function arrayBufferToBase64(i){let e="";const s=new Uint8Array(i);for(let o=0;o<s.byteLength;o++)e+=String.fromCharCode(s[o]);return btoa(e)}async function fetchFile(i,e){if(typeof i=="string"){i=resolvePath(i);let s=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(s=e.fetch),await fetch(i,s)}return await makeResponse(i)}const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{constructor(){_defineProperty(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:isBrowser$1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const getGlobalLoaderOptions=()=>{const i=getGlobalLoaderState();return i.globalOptions=i.globalOptions||{...DEFAULT_LOADER_OPTIONS},i.globalOptions};function normalizeOptions(i,e,s,o){return s=s||[],s=Array.isArray(s)?s:[s],validateOptions(i,s),normalizeOptionsInternal(e,i,o)}function getFetchFunction(i,e){const s=getGlobalLoaderOptions(),o=i||s;return typeof o.fetch=="function"?o.fetch:isObject$1(o.fetch)?a=>fetchFile(a,o):e!=null&&e.fetch?e==null?void 0:e.fetch:fetchFile}function validateOptions(i,e){validateOptionsObject(i,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,e);for(const s of e){const o=i&&i[s.id]||{},a=s.options&&s.options[s.id]||{},d=s.deprecatedOptions&&s.deprecatedOptions[s.id]||{};validateOptionsObject(o,s.id,a,d,e)}}function validateOptionsObject(i,e,s,o,a){const d=e||"Top level",g=e?"".concat(e,"."):"";for(const _ in i){const j=!e&&isObject$1(i[_]),_e=_==="baseUri"&&!e,et=_==="workerUrl"&&e;if(!(_ in s)&&!_e&&!et){if(_ in o)probeLog.warn("".concat(d," loader option '").concat(g).concat(_,"' no longer supported, use '").concat(o[_],"'"))();else if(!j){const tt=findSimilarOption(_,a);probeLog.warn("".concat(d," loader option '").concat(g).concat(_,"' not recognized. ").concat(tt))()}}}}function findSimilarOption(i,e){const s=i.toLowerCase();let o="";for(const a of e)for(const d in a.options){if(i===d)return"Did you mean '".concat(a.id,".").concat(d,"'?");const g=d.toLowerCase();(s.startsWith(g)||g.startsWith(s))&&(o=o||"Did you mean '".concat(a.id,".").concat(d,"'?"))}return o}function normalizeOptionsInternal(i,e,s){const a={...i.options||{}};return addUrlOptions(a,s),a.log===null&&(a.log=new NullLog),mergeNestedFields(a,getGlobalLoaderOptions()),mergeNestedFields(a,e),a}function mergeNestedFields(i,e){for(const s in e)if(s in e){const o=e[s];isPureObject(o)&&isPureObject(i[s])?i[s]={...i[s],...e[s]}:i[s]=e[s]}}function addUrlOptions(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function isLoaderObject(i){var e;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((e=i)===null||e===void 0?void 0:e.extensions)):!1}function normalizeLoader(i){var e,s;assert$3(i,"null loader"),assert$3(isLoaderObject(i),"invalid loader");let o;return Array.isArray(i)&&(o=i[1],i=i[0],i={...i,options:{...i.options,...o}}),((e=i)!==null&&e!==void 0&&e.parseTextSync||(s=i)!==null&&s!==void 0&&s.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const getGlobalLoaderRegistry=()=>{const i=getGlobalLoaderState();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function registerLoaders(i){const e=getGlobalLoaderRegistry();i=Array.isArray(i)?i:[i];for(const s of i){const o=normalizeLoader(s);e.find(a=>o===a)||e.unshift(o)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const log$1=new Log({id:"loaders.gl"}),EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(i,e=[],s,o){if(!validHTTPResponse(i))return null;let a=selectLoaderSync(i,e,{...s,nothrow:!0},o);if(a)return a;if(isBlob(i)&&(i=await i.slice(0,10).arrayBuffer(),a=selectLoaderSync(i,e,s,o)),!a&&!(s!=null&&s.nothrow))throw new Error(getNoValidLoaderMessage(i));return a}function selectLoaderSync(i,e=[],s,o){if(!validHTTPResponse(i))return null;if(e&&!Array.isArray(e))return normalizeLoader(e);let a=[];e&&(a=a.concat(e)),s!=null&&s.ignoreRegisteredLoaders||a.push(...getRegisteredLoaders()),normalizeLoaders(a);const d=selectLoaderInternal(i,a,s,o);if(!d&&!(s!=null&&s.nothrow))throw new Error(getNoValidLoaderMessage(i));return d}function selectLoaderInternal(i,e,s,o){const{url:a,type:d}=getResourceUrlAndType(i),g=a||(o==null?void 0:o.url);let _=null,j="";if(s!=null&&s.mimeType&&(_=findLoaderByMIMEType(e,s==null?void 0:s.mimeType),j="match forced by supplied MIME type ".concat(s==null?void 0:s.mimeType)),_=_||findLoaderByUrl(e,g),j=j||(_?"matched url ".concat(g):""),_=_||findLoaderByMIMEType(e,d),j=j||(_?"matched MIME type ".concat(d):""),_=_||findLoaderByInitialBytes(e,i),j=j||(_?"matched initial data ".concat(getFirstCharacters(i)):""),_=_||findLoaderByMIMEType(e,s==null?void 0:s.fallbackMimeType),j=j||(_?"matched fallback MIME type ".concat(d):""),j){var _e;log$1.log(1,"selectLoader selected ".concat((_e=_)===null||_e===void 0?void 0:_e.name,": ").concat(j,"."))}return _}function validHTTPResponse(i){return!(i instanceof Response&&i.status===204)}function getNoValidLoaderMessage(i){const{url:e,type:s}=getResourceUrlAndType(i);let o="No valid loader found (";o+=e?"".concat(filename(e),", "):"no url provided, ",o+="MIME type: ".concat(s?'"'.concat(s,'"'):"not provided",", ");const a=i?getFirstCharacters(i):"";return o+=a?' first bytes: "'.concat(a,'"'):"first bytes: not available",o+=")",o}function normalizeLoaders(i){for(const e of i)normalizeLoader(e)}function findLoaderByUrl(i,e){const s=e&&EXT_PATTERN.exec(e),o=s&&s[1];return o?findLoaderByExtension(i,o):null}function findLoaderByExtension(i,e){e=e.toLowerCase();for(const s of i)for(const o of s.extensions)if(o.toLowerCase()===e)return s;return null}function findLoaderByMIMEType(i,e){for(const s of i)if(s.mimeTypes&&s.mimeTypes.includes(e)||e==="application/x.".concat(s.id))return s;return null}function findLoaderByInitialBytes(i,e){if(!e)return null;for(const s of i)if(typeof e=="string"){if(testDataAgainstText(e,s))return s}else if(ArrayBuffer.isView(e)){if(testDataAgainstBinary(e.buffer,e.byteOffset,s))return s}else if(e instanceof ArrayBuffer&&testDataAgainstBinary(e,0,s))return s;return null}function testDataAgainstText(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(o=>i.startsWith(o))}function testDataAgainstBinary(i,e,s){return(Array.isArray(s.tests)?s.tests:[s.tests]).some(a=>testBinary(i,e,s,a))}function testBinary(i,e,s,o){if(o instanceof ArrayBuffer)return compareArrayBuffers(o,i,o.byteLength);switch(typeof o){case"function":return o(i,s);case"string":const a=getMagicString(i,e,o.length);return o===a;default:return!1}}function getFirstCharacters(i,e=5){return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?getMagicString(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?getMagicString(i,0,e):""}function getMagicString(i,e,s){if(i.byteLength<e+s)return"";const o=new DataView(i);let a="";for(let d=0;d<s;d++)a+=String.fromCharCode(o.getUint8(e+d));return a}const DEFAULT_CHUNK_SIZE$2=256*1024;function*makeStringIterator(i,e){const s=(e==null?void 0:e.chunkSize)||DEFAULT_CHUNK_SIZE$2;let o=0;const a=new TextEncoder;for(;o<i.length;){const d=Math.min(i.length-o,s),g=i.slice(o,o+d);o+=d,yield a.encode(g)}}const DEFAULT_CHUNK_SIZE$1=256*1024;function*makeArrayBufferIterator(i,e={}){const{chunkSize:s=DEFAULT_CHUNK_SIZE$1}=e;let o=0;for(;o<i.byteLength;){const a=Math.min(i.byteLength-o,s),d=new ArrayBuffer(a),g=new Uint8Array(i,o,a);new Uint8Array(d).set(g),o+=a,yield d}}const DEFAULT_CHUNK_SIZE=1024*1024;async function*makeBlobIterator(i,e){const s=(e==null?void 0:e.chunkSize)||DEFAULT_CHUNK_SIZE;let o=0;for(;o<i.size;){const a=o+s,d=await i.slice(o,a).arrayBuffer();o=a,yield d}}function makeStreamIterator(i,e){return isBrowser$1?makeBrowserStreamIterator(i,e):makeNodeStreamIterator(i)}async function*makeBrowserStreamIterator(i,e){const s=i.getReader();let o;try{for(;;){const a=o||s.read();e!=null&&e._streamReadAhead&&(o=s.read());const{done:d,value:g}=await a;if(d)return;yield toArrayBuffer(g)}}catch{s.releaseLock()}}async function*makeNodeStreamIterator(i,e){for await(const s of i)yield toArrayBuffer(s)}function makeIterator(i,e){if(typeof i=="string")return makeStringIterator(i,e);if(i instanceof ArrayBuffer)return makeArrayBufferIterator(i,e);if(isBlob(i))return makeBlobIterator(i,e);if(isReadableStream(i))return makeStreamIterator(i,e);if(isResponse(i))return makeStreamIterator(i.body,e);throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(i,e,s){if(e.text&&typeof i=="string")return i;if(isBuffer(i)&&(i=i.buffer),i instanceof ArrayBuffer){const o=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(o):o}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let o=i.buffer;const a=i.byteLength||i.length;return(i.byteOffset!==0||a!==o.byteLength)&&(o=o.slice(i.byteOffset,i.byteOffset+a)),o}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(i,e,s){const o=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||o)return getArrayBufferOrStringFromDataSync(i,e);if(isBlob(i)&&(i=await makeResponse(i)),isResponse(i)){const a=i;return await checkResponse(a),e.binary?await a.arrayBuffer():await a.text()}if(isReadableStream(i)&&(i=makeIterator(i,s)),isIterable(i)||isAsyncIterable$1(i))return concatenateArrayBuffersAsync(i);throw new Error(ERR_DATA)}function getLoaderContext(i,e,s=null){if(s)return s;const o={fetch:getFetchFunction(e,i),...i};return Array.isArray(o.loaders)||(o.loaders=null),o}function getLoadersFromContext(i,e){if(!e&&i&&!Array.isArray(i))return i;let s;if(i&&(s=Array.isArray(i)?i:[i]),e&&e.loaders){const o=Array.isArray(e.loaders)?e.loaders:[e.loaders];s=s?[...s,...o]:o}return s&&s.length?s:null}async function parse(i,e,s,o){assert$2(!o||typeof o=="object"),e&&!Array.isArray(e)&&!isLoaderObject(e)&&(o=void 0,s=e,e=void 0),i=await i,s=s||{};const{url:a}=getResourceUrlAndType(i),g=getLoadersFromContext(e,o),_=await selectLoader(i,g,s);return _?(s=normalizeOptions(s,_,g,a),o=getLoaderContext({url:a,parse,loaders:g},s,o),await parseWithLoader(_,i,s,o)):null}async function parseWithLoader(i,e,s,o){if(validateWorkerVersion(i),isResponse(e)){const a=e,{ok:d,redirected:g,status:_,statusText:j,type:_e,url:et}=a,tt=Object.fromEntries(a.headers.entries());o.response={headers:tt,ok:d,redirected:g,status:_,statusText:j,type:_e,url:et}}if(e=await getArrayBufferOrStringFromData(e,i,s),i.parseTextSync&&typeof e=="string")return s.dataType="text",i.parseTextSync(e,s,o,i);if(canParseWithWorker(i,s))return await parseWithWorker(i,e,s,o,parse);if(i.parseText&&typeof e=="string")return await i.parseText(e,s,o,i);if(i.parse)return await i.parse(e,s,o,i);throw assert$2(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function load(i,e,s,o){!Array.isArray(e)&&!isLoaderObject(e)&&(s=e,e=void 0);const a=getFetchFunction(s);let d=i;return typeof i=="string"&&(d=await a(i)),isBlob(i)&&(d=await a(i)),await parse(d,e,s)}const VERSION="3.2.12",{_parseImageNode}=globalThis,IMAGE_SUPPORTED=typeof Image<"u",IMAGE_BITMAP_SUPPORTED=typeof ImageBitmap<"u",NODE_IMAGE_SUPPORTED=!!_parseImageNode,DATA_SUPPORTED=isBrowser$1?!0:NODE_IMAGE_SUPPORTED;function isImageTypeSupported(i){switch(i){case"auto":return IMAGE_BITMAP_SUPPORTED||IMAGE_SUPPORTED||DATA_SUPPORTED;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED;case"image":return IMAGE_SUPPORTED;case"data":return DATA_SUPPORTED;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function getDefaultImageType(){if(IMAGE_BITMAP_SUPPORTED)return"imagebitmap";if(IMAGE_SUPPORTED)return"image";if(DATA_SUPPORTED)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType(i){const e=getImageTypeOrNull(i);if(!e)throw new Error("Not an image");return e}function getImageData(i){switch(getImageType(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),s=e.getContext("2d");if(!s)throw new Error("getImageData");return e.width=i.width,e.height=i.height,s.drawImage(i,0,0),s.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function getImageTypeOrNull(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const SVG_DATA_URL_PATTERN=/^data:image\/svg\+xml/,SVG_URL_PATTERN=/\.svg((\?|#).*)?$/;function isSVG(i){return i&&(SVG_DATA_URL_PATTERN.test(i)||SVG_URL_PATTERN.test(i))}function getBlobOrSVGDataUrl(i,e){if(isSVG(e)){let o=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(o=unescape(encodeURIComponent(o)))}catch(d){throw new Error(d.message)}return"data:image/svg+xml;base64,".concat(btoa(o))}return getBlob(i,e)}function getBlob(i,e){if(isSVG(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function parseToImage(i,e,s){const o=getBlobOrSVGDataUrl(i,s),a=self.URL||self.webkitURL,d=typeof o!="string"&&a.createObjectURL(o);try{return await loadToImage(d||o,e)}finally{d&&a.revokeObjectURL(d)}}async function loadToImage(i,e){const s=new Image;return s.src=i,e.image&&e.image.decode&&s.decode?(await s.decode(),s):await new Promise((o,a)=>{try{s.onload=()=>o(s),s.onerror=d=>a(new Error("Could not load image ".concat(i,": ").concat(d)))}catch(d){a(d)}})}const EMPTY_OBJECT={};let imagebitmapOptionsSupported=!0;async function parseToImageBitmap(i,e,s){let o;isSVG(s)?o=await parseToImage(i,e,s):o=getBlob(i,s);const a=e&&e.imagebitmap;return await safeCreateImageBitmap(o,a)}async function safeCreateImageBitmap(i,e=null){if((isEmptyObject(e)||!imagebitmapOptionsSupported)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(s){console.warn(s),imagebitmapOptionsSupported=!1}return await createImageBitmap(i)}function isEmptyObject(i){for(const e in i||EMPTY_OBJECT)return!1;return!0}const BIG_ENDIAN=!1,LITTLE_ENDIAN=!0;function getBinaryImageMetadata(i){const e=toDataView(i);return getPngMetadata(e)||getJpegMetadata(e)||getGifMetadata(e)||getBmpMetadata(e)}function getPngMetadata(i){const e=toDataView(i);return e.byteLength>=24&&e.getUint32(0,BIG_ENDIAN)===2303741511?{mimeType:"image/png",width:e.getUint32(16,BIG_ENDIAN),height:e.getUint32(20,BIG_ENDIAN)}:null}function getGifMetadata(i){const e=toDataView(i);return e.byteLength>=10&&e.getUint32(0,BIG_ENDIAN)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,LITTLE_ENDIAN),height:e.getUint16(8,LITTLE_ENDIAN)}:null}function getBmpMetadata(i){const e=toDataView(i);return e.byteLength>=14&&e.getUint16(0,BIG_ENDIAN)===16973&&e.getUint32(2,LITTLE_ENDIAN)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,LITTLE_ENDIAN),height:e.getUint32(22,LITTLE_ENDIAN)}:null}function getJpegMetadata(i){const e=toDataView(i);if(!(e.byteLength>=3&&e.getUint16(0,BIG_ENDIAN)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:o,sofMarkers:a}=getJpegMarkers();let d=2;for(;d+9<e.byteLength;){const g=e.getUint16(d,BIG_ENDIAN);if(a.has(g))return{mimeType:"image/jpeg",height:e.getUint16(d+5,BIG_ENDIAN),width:e.getUint16(d+7,BIG_ENDIAN)};if(!o.has(g))return null;d+=2,d+=e.getUint16(d,BIG_ENDIAN)}return null}function getJpegMarkers(){const i=new Set([65499,65476,65484,65501,65534]);for(let s=65504;s<65520;++s)i.add(s);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function toDataView(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function parseToNodeImage(i,e){const{mimeType:s}=getBinaryImageMetadata(i)||{},o=globalThis._parseImageNode;return assert$3(o),await o(i,s)}async function parseImage(i,e,s){e=e||{};const a=(e.image||{}).type||"auto",{url:d}=s||{},g=getLoadableImageType(a);let _;switch(g){case"imagebitmap":_=await parseToImageBitmap(i,e,d);break;case"image":_=await parseToImage(i,e,d);break;case"data":_=await parseToNodeImage(i);break;default:assert$3(!1)}return a==="data"&&(_=getImageData(_)),_}function getLoadableImageType(i){switch(i){case"auto":case"data":return getDefaultImageType();default:return isImageTypeSupported(i),i}}const EXTENSIONS=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],MIME_TYPES=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DEFAULT_IMAGE_LOADER_OPTIONS={image:{type:"auto",decode:!0}},ImageLoader={id:"image",module:"images",name:"Images",version:VERSION,mimeTypes:MIME_TYPES,extensions:EXTENSIONS,parse:parseImage,tests:[i=>!!getBinaryImageMetadata(new DataView(i))],options:DEFAULT_IMAGE_LOADER_OPTIONS},log=new Log({id:"deck"});let loggers={};function register(i){loggers=i}function debug(i,e,s,o){log.level>0&&loggers[i]&&loggers[i].call(null,e,s,o)}function isJSON(i){const e=i[0],s=i[i.length-1];return e==="{"&&s==="}"||e==="["&&s==="]"}const jsonLoader={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:isJSON,parseTextSync:JSON.parse},version="8.8.21",existingVersion=globalThis.deck&&globalThis.deck.VERSION;if(existingVersion&&existingVersion!==version)throw new Error("deck.gl - multiple versions detected: ".concat(existingVersion," vs ").concat(version));existingVersion||(log.log(1,"deck.gl ".concat(version))(),globalThis.deck={...globalThis.deck,VERSION:version,version,log,_registerLoggers:register},registerLoaders([jsonLoader,[ImageLoader,{imagebitmap:{premultiplyAlpha:"none"}}]]));const deckGlobal=globalThis.deck,defines="#define SMOOTH_EDGE_RADIUS 0.5",vs$4=`
`.concat(defines,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),fs$2=`
`.concat(defines,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),geometry={name:"geometry",vs:vs$4,fs:fs$2},COORDINATE_SYSTEM={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(COORDINATE_SYSTEM,"IDENTITY",{get:()=>(log.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const PROJECTION_MODE={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},UNIT={common:0,meters:1,pixels:2},EVENTS={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},OPERATION={DRAW:"draw",MASK:"mask"},COORDINATE_SYSTEM_GLSL_CONSTANTS=Object.keys(COORDINATE_SYSTEM).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(COORDINATE_SYSTEM[i],";")).join(""),PROJECTION_MODE_GLSL_CONSTANTS=Object.keys(PROJECTION_MODE).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(PROJECTION_MODE[i],";")).join(""),UNIT_GLSL_CONSTANTS=Object.keys(UNIT).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(UNIT[i],";")).join(""),projectShader="".concat(COORDINATE_SYSTEM_GLSL_CONSTANTS,`
`).concat(PROJECTION_MODE_GLSL_CONSTANTS,`
`).concat(UNIT_GLSL_CONSTANTS,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function isEqual(i,e){if(i===e)return!0;if(Array.isArray(i)){const s=i.length;if(!e||e.length!==s)return!1;for(let o=0;o<s;o++)if(i[o]!==e[o])return!1;return!0}return!1}function memoize(i){let e={},s;return o=>{for(const a in o)if(!isEqual(o[a],e[a])){s=i(o),e=o;break}return s}}const ZERO_VECTOR$1=[0,0,0,0],VECTOR_TO_POINT_MATRIX$1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],IDENTITY_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],DEFAULT_PIXELS_PER_UNIT2=[0,0,0],DEFAULT_COORDINATE_ORIGIN=[0,0,0],getMemoizedViewportUniforms=memoize(calculateViewportUniforms);function getOffsetOrigin(i,e,s=DEFAULT_COORDINATE_ORIGIN){s.length<3&&(s=[s[0],s[1],0]);let o=s,a,d=!0;switch(e===COORDINATE_SYSTEM.LNGLAT_OFFSETS||e===COORDINATE_SYSTEM.METER_OFFSETS?a=s:a=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case PROJECTION_MODE.WEB_MERCATOR:(e===COORDINATE_SYSTEM.LNGLAT||e===COORDINATE_SYSTEM.CARTESIAN)&&(a=[0,0,0],d=!1);break;case PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:e===COORDINATE_SYSTEM.LNGLAT?o=a:e===COORDINATE_SYSTEM.CARTESIAN&&(o=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],a=i.unprojectPosition(o),o[0]-=s[0],o[1]-=s[1],o[2]-=s[2]);break;case PROJECTION_MODE.IDENTITY:o=i.position.map(Math.fround),o[2]=o[2]||0;break;case PROJECTION_MODE.GLOBE:d=!1,a=null;break;default:d=!1}return{geospatialOrigin:a,shaderCoordinateOrigin:o,offsetMode:d}}function calculateMatrixAndOffset(i,e,s){const{viewMatrixUncentered:o,projectionMatrix:a}=i;let{viewMatrix:d,viewProjectionMatrix:g}=i,_=ZERO_VECTOR$1,j=ZERO_VECTOR$1,_e=i.cameraPosition;const{geospatialOrigin:et,shaderCoordinateOrigin:tt,offsetMode:rt}=getOffsetOrigin(i,e,s);return rt&&(j=i.projectPosition(et||tt),_e=[_e[0]-j[0],_e[1]-j[1],_e[2]-j[2]],j[3]=1,_=transformMat4$1([],j,g),d=o||d,g=multiply([],a,d),g=multiply([],g,VECTOR_TO_POINT_MATRIX$1)),{viewMatrix:d,viewProjectionMatrix:g,projectionCenter:_,originCommon:j,cameraPosCommon:_e,shaderCoordinateOrigin:tt,geospatialOrigin:et}}function getUniformsFromViewport({viewport:i,devicePixelRatio:e=1,modelMatrix:s=null,coordinateSystem:o=COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:a=DEFAULT_COORDINATE_ORIGIN,autoWrapLongitude:d=!1}){o===COORDINATE_SYSTEM.DEFAULT&&(o=i.isGeospatial?COORDINATE_SYSTEM.LNGLAT:COORDINATE_SYSTEM.CARTESIAN);const g=getMemoizedViewportUniforms({viewport:i,devicePixelRatio:e,coordinateSystem:o,coordinateOrigin:a});return g.project_uWrapLongitude=d,g.project_uModelMatrix=s||IDENTITY_MATRIX,g}function calculateViewportUniforms({viewport:i,devicePixelRatio:e,coordinateSystem:s,coordinateOrigin:o}){const{projectionCenter:a,viewProjectionMatrix:d,originCommon:g,cameraPosCommon:_,shaderCoordinateOrigin:j,geospatialOrigin:_e}=calculateMatrixAndOffset(i,s,o),et=i.getDistanceScales(),tt=[i.width*e,i.height*e],rt=transformMat4$1([],[0,0,-i.focalDistance,1],i.projectionMatrix)[3]||1,it={project_uCoordinateSystem:s,project_uProjectionMode:i.projectionMode,project_uCoordinateOrigin:j,project_uCommonOrigin:g.slice(0,3),project_uCenter:a,project_uPseudoMeters:!!i._pseudoMeters,project_uViewportSize:tt,project_uDevicePixelRatio:e,project_uFocalDistance:rt,project_uCommonUnitsPerMeter:et.unitsPerMeter,project_uCommonUnitsPerWorldUnit:et.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:DEFAULT_PIXELS_PER_UNIT2,project_uScale:i.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:d,project_uModelMatrix:IDENTITY_MATRIX,project_uCameraPosition:_};if(_e){const ot=i.getDistanceScales(_e);switch(s){case COORDINATE_SYSTEM.METER_OFFSETS:it.project_uCommonUnitsPerWorldUnit=ot.unitsPerMeter,it.project_uCommonUnitsPerWorldUnit2=ot.unitsPerMeter2;break;case COORDINATE_SYSTEM.LNGLAT:case COORDINATE_SYSTEM.LNGLAT_OFFSETS:i._pseudoMeters||(it.project_uCommonUnitsPerMeter=ot.unitsPerMeter),it.project_uCommonUnitsPerWorldUnit=ot.unitsPerDegree,it.project_uCommonUnitsPerWorldUnit2=ot.unitsPerDegree2;break;case COORDINATE_SYSTEM.CARTESIAN:it.project_uCommonUnitsPerWorldUnit=[1,1,ot.unitsPerMeter[2]],it.project_uCommonUnitsPerWorldUnit2=[0,0,ot.unitsPerMeter2[2]];break}}return it}const INITIAL_MODULE_OPTIONS={};function getUniforms(i=INITIAL_MODULE_OPTIONS){return"viewport"in i?getUniformsFromViewport(i):{}}const project={name:"project",dependencies:[fp32,geometry],vs:projectShader,getUniforms},vs$3=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,project32={name:"project32",dependencies:[project],vs:vs$3};function createMat4$1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function transformVector(i,e){const s=transformMat4$1([],e,i);return scale(s,s,1/s[3]),s}function mod$1(i,e){const s=i%e;return s<0?e+s:s}function clamp(i,e,s){return i<e?e:i>s?s:i}function ieLog2(i){return Math.log(i)*Math.LOG2E}const log2=Math.log2||ieLog2;function assert$1(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const PI=Math.PI,PI_4=PI/4,DEGREES_TO_RADIANS$4=PI/180,RADIANS_TO_DEGREES=180/PI,TILE_SIZE$2=512,EARTH_CIRCUMFERENCE$1=4003e4,MAX_LATITUDE=85.051129,DEFAULT_ALTITUDE=1.5;function scaleToZoom(i){return log2(i)}function lngLatToWorld(i){const[e,s]=i;assert$1(Number.isFinite(e)),assert$1(Number.isFinite(s)&&s>=-90&&s<=90,"invalid latitude");const o=e*DEGREES_TO_RADIANS$4,a=s*DEGREES_TO_RADIANS$4,d=TILE_SIZE$2*(o+PI)/(2*PI),g=TILE_SIZE$2*(PI+Math.log(Math.tan(PI_4+a*.5)))/(2*PI);return[d,g]}function worldToLngLat(i){const[e,s]=i,o=e/TILE_SIZE$2*(2*PI)-PI,a=2*(Math.atan(Math.exp(s/TILE_SIZE$2*(2*PI)-PI))-PI_4);return[o*RADIANS_TO_DEGREES,a*RADIANS_TO_DEGREES]}function getMeterZoom(i){const{latitude:e}=i;assert$1(Number.isFinite(e));const s=Math.cos(e*DEGREES_TO_RADIANS$4);return scaleToZoom(EARTH_CIRCUMFERENCE$1*s)-9}function getDistanceScales(i){const{latitude:e,longitude:s,highPrecision:o=!1}=i;assert$1(Number.isFinite(e)&&Number.isFinite(s));const a=TILE_SIZE$2,d=Math.cos(e*DEGREES_TO_RADIANS$4),g=a/360,_=g/d,j=a/EARTH_CIRCUMFERENCE$1/d,_e={unitsPerMeter:[j,j,j],metersPerUnit:[1/j,1/j,1/j],unitsPerDegree:[g,_,j],degreesPerUnit:[1/g,1/_,1/j]};if(o){const et=DEGREES_TO_RADIANS$4*Math.tan(e*DEGREES_TO_RADIANS$4)/d,tt=g*et/2,rt=a/EARTH_CIRCUMFERENCE$1*et,it=rt/_*j;_e.unitsPerDegree2=[0,tt,rt],_e.unitsPerMeter2=[it,0,it]}return _e}function addMetersToLngLat(i,e){const[s,o,a]=i,[d,g,_]=e,{unitsPerMeter:j,unitsPerMeter2:_e}=getDistanceScales({longitude:s,latitude:o,highPrecision:!0}),et=lngLatToWorld(i);et[0]+=d*(j[0]+_e[0]*g),et[1]+=g*(j[1]+_e[1]*g);const tt=worldToLngLat(et),rt=(a||0)+(_||0);return Number.isFinite(a)||Number.isFinite(_)?[tt[0],tt[1],rt]:tt}function getViewMatrix$1(i){const{height:e,pitch:s,bearing:o,altitude:a,scale:d,center:g}=i,_=createMat4$1();translate(_,_,[0,0,-a]),rotateX$1(_,_,-s*DEGREES_TO_RADIANS$4),rotateZ$1(_,_,o*DEGREES_TO_RADIANS$4);const j=d/e;return scale$1(_,_,[j,j,j]),g&&translate(_,_,negate$1([],g)),_}function getProjectionParameters(i){const{width:e,height:s,altitude:o,pitch:a=0,offset:d,center:g,scale:_,nearZMultiplier:j=1,farZMultiplier:_e=1}=i;let{fovy:et=altitudeToFovy(DEFAULT_ALTITUDE)}=i;o!==void 0&&(et=altitudeToFovy(o));const tt=et*DEGREES_TO_RADIANS$4,rt=a*DEGREES_TO_RADIANS$4,it=fovyToAltitude(et);let ot=it;g&&(ot+=g[2]*_/Math.cos(rt)/s);const ct=tt*(.5+(d?d[1]:0)/s),ft=Math.sin(ct)*ot/Math.sin(clamp(Math.PI/2-rt-ct,.01,Math.PI-.01)),dt=Math.sin(rt)*ft+ot,pt=ot*10,gt=Math.min(dt*_e,pt);return{fov:tt,aspect:e/s,focalDistance:it,near:j,far:gt}}function altitudeToFovy(i){return 2*Math.atan(.5/i)*RADIANS_TO_DEGREES}function fovyToAltitude(i){return .5/Math.tan(.5*i*DEGREES_TO_RADIANS$4)}function worldToPixels(i,e){const[s,o,a=0]=i;return assert$1(Number.isFinite(s)&&Number.isFinite(o)&&Number.isFinite(a)),transformVector(e,[s,o,a,1])}function pixelsToWorld(i,e,s=0){const[o,a,d]=i;if(assert$1(Number.isFinite(o)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(d))return transformVector(e,[o,a,d,1]);const g=transformVector(e,[o,a,0,1]),_=transformVector(e,[o,a,1,1]),j=g[2],_e=_[2],et=j===_e?0:((s||0)-j)/(_e-j);return lerp$1([],g,_,et)}function fitBounds(i){const{width:e,height:s,bounds:o,minExtent:a=0,maxZoom:d=24,offset:g=[0,0]}=i,[[_,j],[_e,et]]=o,tt=getPaddingObject(i.padding),rt=lngLatToWorld([_,clamp(et,-MAX_LATITUDE,MAX_LATITUDE)]),it=lngLatToWorld([_e,clamp(j,-MAX_LATITUDE,MAX_LATITUDE)]),ot=[Math.max(Math.abs(it[0]-rt[0]),a),Math.max(Math.abs(it[1]-rt[1]),a)],ct=[e-tt.left-tt.right-Math.abs(g[0])*2,s-tt.top-tt.bottom-Math.abs(g[1])*2];assert$1(ct[0]>0&&ct[1]>0);const ft=ct[0]/ot[0],dt=ct[1]/ot[1],pt=(tt.right-tt.left)/2/ft,gt=(tt.top-tt.bottom)/2/dt,Ct=[(it[0]+rt[0])/2+pt,(it[1]+rt[1])/2+gt],xt=worldToLngLat(Ct),at=Math.min(d,log2(Math.abs(Math.min(ft,dt))));return assert$1(Number.isFinite(at)),{longitude:xt[0],latitude:xt[1],zoom:at}}function getPaddingObject(i=0){return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(assert$1(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const DEGREES_TO_RADIANS$3=Math.PI/180;function getBounds(i,e=0){const{width:s,height:o,unproject:a}=i,d={targetZ:e},g=a([0,o],d),_=a([s,o],d);let j,_e;const et=i.fovy?.5*i.fovy*DEGREES_TO_RADIANS$3:Math.atan(.5/i.altitude),tt=(90-i.pitch)*DEGREES_TO_RADIANS$3;return et>tt-.01?(j=unprojectOnFarPlane(i,0,e),_e=unprojectOnFarPlane(i,s,e)):(j=a([0,0],d),_e=a([s,0],d)),[g,_,_e,j]}function unprojectOnFarPlane(i,e,s){const{pixelUnprojectionMatrix:o}=i,a=transformVector(o,[e,0,1,1]),d=transformVector(o,[e,i.height,1,1]),_=(s*i.distanceScales.unitsPerMeter[2]-a[2])/(d[2]-a[2]),j=lerp$1([],a,d,_),_e=worldToLngLat(j);return _e.push(s),_e}const TILE_SIZE$1=512;function normalizeViewportProps(i){const{width:e,height:s,pitch:o=0}=i;let{longitude:a,latitude:d,zoom:g,bearing:_=0}=i;(a<-180||a>180)&&(a=mod$1(a+180,360)-180),(_<-180||_>180)&&(_=mod$1(_+180,360)-180);const j=log2(s/TILE_SIZE$1);if(g<=j)g=j,d=0;else{const _e=s/2/Math.pow(2,g),et=worldToLngLat([0,_e])[1];if(d<et)d=et;else{const tt=worldToLngLat([0,TILE_SIZE$1-_e])[1];d>tt&&(d=tt)}}return{width:e,height:s,longitude:a,latitude:d,zoom:g,pitch:o,bearing:_}}const vs$2=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,fs$1=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,getMemoizedViewportCenterPosition=memoize(getViewportCenterPosition),getMemoizedViewProjectionMatrices=memoize(getViewProjectionMatrices),DEFAULT_SHADOW_COLOR$1=[0,0,0,1],VECTOR_TO_POINT_MATRIX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function screenToCommonSpace(i,e){const[s,o,a]=i,d=pixelsToWorld([s,o,a],e);return Number.isFinite(a)?d:[d[0],d[1],0]}function getViewportCenterPosition({viewport:i,center:e}){return new Matrix4(i.viewProjectionMatrix).invert().transform(e)}function getViewProjectionMatrices({viewport:i,shadowMatrices:e}){const s=[],o=i.pixelUnprojectionMatrix,a=i.isGeospatial?void 0:1,d=[[0,0,a],[i.width,0,a],[0,i.height,a],[i.width,i.height,a],[0,0,-1],[i.width,0,-1],[0,i.height,-1],[i.width,i.height,-1]].map(g=>screenToCommonSpace(g,o));for(const g of e){const _=g.clone().translate(new Vector3(i.center).negate()),j=d.map(et=>_.transform(et)),_e=new Matrix4().ortho({left:Math.min(...j.map(et=>et[0])),right:Math.max(...j.map(et=>et[0])),bottom:Math.min(...j.map(et=>et[1])),top:Math.max(...j.map(et=>et[1])),near:Math.min(...j.map(et=>-et[2])),far:Math.max(...j.map(et=>-et[2]))});s.push(_e.multiplyRight(g))}return s}function createShadowUniforms(i,e){const{shadowEnabled:s=!0}=i;if(!s||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const o={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||DEFAULT_SHADOW_COLOR$1,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},a=getMemoizedViewportCenterPosition({viewport:i.viewport,center:e.project_uCenter}),d=[],g=getMemoizedViewProjectionMatrices({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let _=0;_<i.shadowMatrices.length;_++){const j=g[_],_e=j.clone().translate(new Vector3(i.viewport.center).negate());e.project_uCoordinateSystem===COORDINATE_SYSTEM.LNGLAT&&e.project_uProjectionMode===PROJECTION_MODE.WEB_MERCATOR?(g[_]=_e,d[_]=a):(g[_]=j.clone().multiplyRight(VECTOR_TO_POINT_MATRIX),d[_]=_e.transform(a))}for(let _=0;_<g.length;_++)o["shadow_uViewProjectionMatrices[".concat(_,"]")]=g[_],o["shadow_uProjectCenters[".concat(_,"]")]=d[_],i.shadowMaps&&i.shadowMaps.length>0?o["shadow_uShadowMap".concat(_)]=i.shadowMaps[_]:o["shadow_uShadowMap".concat(_)]=i.dummyShadowMap;return o}const shadow={name:"shadow",dependencies:[project],vs:vs$2,fs:fs$1,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(i={},e={})=>"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?createShadowUniforms(i,e):{}},picking={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...picking$1},DEFAULT_MODULES=[project],SHADER_HOOKS=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function createProgramManager(i){const e=ProgramManager.getDefaultProgramManager(i);for(const s of DEFAULT_MODULES)e.addDefaultModule(s);for(const s of SHADER_HOOKS)e.addShaderHook(s);return e}const DEFAULT_LIGHT_COLOR$1=[255,255,255],DEFAULT_LIGHT_INTENSITY$1=1;let idCount$1=0;class AmbientLight{constructor(e={}){_defineProperty(this,"id",void 0),_defineProperty(this,"color",void 0),_defineProperty(this,"intensity",void 0),_defineProperty(this,"type","ambient");const{color:s=DEFAULT_LIGHT_COLOR$1}=e,{intensity:o=DEFAULT_LIGHT_INTENSITY$1}=e;this.id=e.id||"ambient-".concat(idCount$1++),this.color=s,this.intensity=o}}const DEFAULT_LIGHT_COLOR=[255,255,255],DEFAULT_LIGHT_INTENSITY=1,DEFAULT_LIGHT_DIRECTION=[0,0,-1];let idCount=0;class DirectionalLight{constructor(e={}){_defineProperty(this,"id",void 0),_defineProperty(this,"color",void 0),_defineProperty(this,"intensity",void 0),_defineProperty(this,"type","directional"),_defineProperty(this,"direction",void 0),_defineProperty(this,"shadow",void 0);const{color:s=DEFAULT_LIGHT_COLOR}=e,{intensity:o=DEFAULT_LIGHT_INTENSITY}=e,{direction:a=DEFAULT_LIGHT_DIRECTION}=e,{_shadow:d=!1}=e;this.id=e.id||"directional-".concat(idCount++),this.color=s,this.intensity=o,this.type="directional",this.direction=new Vector3(a).normalize().toArray(),this.shadow=d}getProjectedLight(e){return this}}class Pass{constructor(e,s={id:"pass"}){_defineProperty(this,"id",void 0),_defineProperty(this,"gl",void 0),_defineProperty(this,"props",void 0);const{id:o}=s;this.id=o,this.gl=e,this.props={...s}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class LayersPass extends Pass{constructor(...e){super(...e),_defineProperty(this,"_lastRenderIndex",-1)}render(e){const s=this.gl;return setParameters(s,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:s,moduleParameters:o,viewports:a,views:d,onViewportActive:g,clearStack:_=!0,clearCanvas:j=!0}=e;e.pass=e.pass||"unknown";const _e=this.gl;j&&clearGLCanvas(_e),_&&(this._lastRenderIndex=-1);const et=[];for(const tt of a){const rt=d&&d[tt.id];g(tt);const it=this._getDrawLayerParams(tt,e),ot=tt.subViewports||[tt];for(const ct of ot){const ft=this._drawLayersInViewport(_e,{target:s,moduleParameters:o,viewport:ct,view:rt,pass:e.pass,layers:e.layers},it);et.push(ft)}}return et}_getDrawLayerParams(e,{layers:s,pass:o,layerFilter:a,cullRect:d,effects:g,moduleParameters:_}){const j=[],_e=layerIndexResolver(this._lastRenderIndex+1),et={layer:s[0],viewport:e,isPicking:o.startsWith("picking"),renderPass:o,cullRect:d},tt={};for(let rt=0;rt<s.length;rt++){const it=s[rt],ot=this._shouldDrawLayer(it,et,a,tt),ct={shouldDrawLayer:ot};ot&&(ct.layerRenderIndex=_e(it,ot),ct.moduleParameters=this._getModuleParameters(it,g,o,_),ct.layerParameters=this.getLayerParameters(it,rt,e)),j[rt]=ct}return j}_drawLayersInViewport(e,{layers:s,moduleParameters:o,pass:a,target:d,viewport:g,view:_},j){const _e=getGLViewport(e,{moduleParameters:o,target:d,viewport:g});if(_&&_.props.clear){const tt=_.props.clear===!0?{color:!0,depth:!0}:_.props.clear;withParameters(e,{scissorTest:!0,scissor:_e},()=>clear(e,tt))}const et={totalCount:s.length,visibleCount:0,compositeCount:0,pickableCount:0};setParameters(e,{viewport:_e});for(let tt=0;tt<s.length;tt++){const rt=s[tt],{shouldDrawLayer:it,layerRenderIndex:ot,moduleParameters:ct,layerParameters:ft}=j[tt];if(it&&rt.props.pickable&&et.pickableCount++,rt.isComposite)et.compositeCount++;else if(it){et.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,ot),ct.viewport=g;try{rt._drawLayer({moduleParameters:ct,uniforms:{layerIndex:ot},parameters:ft})}catch(dt){rt.raiseError(dt,"drawing ".concat(rt," to ").concat(a))}}}return et}shouldDrawLayer(e){return!0}getModuleParameters(e,s){return null}getLayerParameters(e,s,o){return e.props.parameters}_shouldDrawLayer(e,s,o,a){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;s.layer=e;let g=e.parent;for(;g;){if(!g.props.visible||!g.filterSubLayer(s))return!1;s.layer=g,g=g.parent}if(o){const _=s.layer.id;if(_ in a||(a[_]=o(s)),!a[_])return!1}return e.activateViewport(s.viewport),!0}_getModuleParameters(e,s,o,a){var d;const g=Object.assign(Object.create(((d=e.internalState)===null||d===void 0?void 0:d.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:cssToDeviceRatio(this.gl)});if(s)for(const j of s){var _;Object.assign(g,(_=j.getModuleParameters)===null||_===void 0?void 0:_.call(j,e))}return Object.assign(g,this.getModuleParameters(e,s),a)}}function layerIndexResolver(i=0,e={}){const s={},o=(a,d)=>{const g=a.props._offset,_=a.id,j=a.parent&&a.parent.id;let _e;if(j&&!(j in e)&&o(a.parent,!1),j in s){const et=s[j]=s[j]||layerIndexResolver(e[j],e);_e=et(a,d),s[_]=et}else Number.isFinite(g)?(_e=g+(e[j]||0),s[_]=null):_e=i;return d&&_e>=i&&(i=_e+1),e[_]=_e,_e};return o}function getGLViewport(i,{moduleParameters:e,target:s,viewport:o}){const a=s&&s.id!=="default-framebuffer",d=e&&e.devicePixelRatio||cssToDeviceRatio(i),g=a?s.height:i.drawingBufferHeight,_=o;return[_.x*d,g-(_.y+_.height)*d,_.width*d,_.height*d]}function clearGLCanvas(i){const e=i.drawingBufferWidth,s=i.drawingBufferHeight;setParameters(i,{viewport:[0,0,e,s]}),i.clear(16640)}class ShadowPass extends LayersPass{constructor(e,s){super(e,s),_defineProperty(this,"shadowMap",void 0),_defineProperty(this,"depthBuffer",void 0),_defineProperty(this,"fbo",void 0),this.shadowMap=new Texture2D(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Renderbuffer(e,{format:33189,width:1,height:1}),this.fbo=new Framebuffer(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const s=this.fbo;withParameters(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const o=e.viewports[0],a=cssToDeviceRatio(this.gl),d=o.width*a,g=o.height*a;(d!==s.width||g!==s.height)&&s.resize({width:d,height:g}),super.render({...e,target:s,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const DEFAULT_AMBIENT_LIGHT_PROPS={color:[255,255,255],intensity:1},DEFAULT_DIRECTIONAL_LIGHT_PROPS=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],DEFAULT_SHADOW_COLOR=[0,0,0,200/255];class LightingEffect{constructor(e={}){_defineProperty(this,"id","lighting-effect"),_defineProperty(this,"props",null),_defineProperty(this,"shadowColor",DEFAULT_SHADOW_COLOR),_defineProperty(this,"shadow",void 0),_defineProperty(this,"ambientLight",null),_defineProperty(this,"directionalLights",[]),_defineProperty(this,"pointLights",[]),_defineProperty(this,"shadowPasses",[]),_defineProperty(this,"shadowMaps",[]),_defineProperty(this,"dummyShadowMap",null),_defineProperty(this,"programManager",void 0),_defineProperty(this,"shadowMatrices",void 0);for(const s in e){const o=e[s];switch(o.type){case"ambient":this.ambientLight=o;break;case"directional":this.directionalLights.push(o);break;case"point":this.pointLights.push(o);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(s=>s.shadow)}preRender(e,{layers:s,layerFilter:o,viewports:a,onViewportActive:d,views:g}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=ProgramManager.getDefaultProgramManager(e),shadow&&this.programManager.addDefaultModule(shadow)),this.dummyShadowMap||(this.dummyShadowMap=new Texture2D(e,{width:1,height:1}));for(let _=0;_<this.shadowPasses.length;_++)this.shadowPasses[_].render({layers:s,layerFilter:o,viewports:a,onViewportActive:d,views:g,moduleParameters:{shadowLightId:_,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const s=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return s.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(shadow),this.programManager=null)}_calculateMatrices(){const e=[];for(const s of this.directionalLights){const o=new Matrix4().lookAt({eye:new Vector3(s.direction).negate()});e.push(o)}return e}_createShadowPasses(e){for(let s=0;s<this.directionalLights.length;s++){const o=new ShadowPass(e);this.shadowPasses[s]=o,this.shadowMaps[s]=o.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:s,directionalLights:o}=this;!e&&s.length===0&&o.length===0&&(this.ambientLight=new AmbientLight(DEFAULT_AMBIENT_LIGHT_PROPS),this.directionalLights.push(new DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[0]),new DirectionalLight(DEFAULT_DIRECTIONAL_LIGHT_PROPS[1])))}}class TypedArrayManager{constructor(e={}){_defineProperty(this,"_pool",[]),_defineProperty(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,s,{size:o=1,type:a,padding:d=0,copy:g=!1,initialize:_=!1,maxCount:j}){const _e=a||e&&e.constructor||Float32Array,et=s*o+d;if(ArrayBuffer.isView(e)){if(et<=e.length)return e;if(et*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new _e(e.buffer,0,et)}let tt=1/0;j&&(tt=j*o+d);const rt=this._allocate(_e,et,_,tt);return e&&g?rt.set(e):_||rt.fill(0,0,4),this._release(e),rt}release(e){this._release(e)}_allocate(e,s,o,a){let d=Math.max(Math.ceil(s*this.opts.overAlloc),1);d>a&&(d=a);const g=this._pool,_=e.BYTES_PER_ELEMENT*d,j=g.findIndex(_e=>_e.byteLength>=_);if(j>=0){const _e=new e(g.splice(j,1)[0],0,d);return o&&_e.fill(0),_e}return new e(d)}_release(e){if(!ArrayBuffer.isView(e))return;const s=this._pool,{buffer:o}=e,{byteLength:a}=o,d=s.findIndex(g=>g.byteLength>=a);d<0?s.push(o):(d>0||s.length<this.opts.poolSize)&&s.splice(d,0,o),s.length>this.opts.poolSize&&s.shift()}}const defaultTypedArrayManager=new TypedArrayManager;function createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mod(i,e){const s=i%e;return s<0?e+s:s}function getCameraPosition(i){return[i[12],i[13],i[14]]}function getFrustumPlanes(i){return{left:getFrustumPlane(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:getFrustumPlane(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:getFrustumPlane(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:getFrustumPlane(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:getFrustumPlane(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:getFrustumPlane(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const scratchVector=new Vector3;function getFrustumPlane(i,e,s,o){scratchVector.set(i,e,s);const a=scratchVector.len();return{distance:o/a,normal:new Vector3(-i/a,-e/a,-s/a)}}function fp64LowPart(i){return i-Math.fround(i)}let scratchArray;function toDoublePrecisionArray(i,e){const{size:s=1,startIndex:o=0}=e,a=e.endIndex!==void 0?e.endIndex:i.length,d=(a-o)/s;scratchArray=defaultTypedArrayManager.allocate(scratchArray,d,{type:Float32Array,size:s*2});let g=o,_=0;for(;g<a;){for(let j=0;j<s;j++){const _e=i[g++];scratchArray[_+j]=_e,scratchArray[_+j+s]=fp64LowPart(_e)}_+=s*2}return scratchArray.subarray(0,d*s*2)}const DEGREES_TO_RADIANS$2=Math.PI/180,IDENTITY=createMat4(),ZERO_VECTOR=[0,0,0],DEFAULT_DISTANCE_SCALES={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function createProjectionMatrix({width:i,height:e,orthographic:s,fovyRadians:o,focalDistance:a,padding:d,near:g,far:_}){const j=i/e,_e=s?new Matrix4().orthographic({fovy:o,aspect:j,focalDistance:a,near:g,far:_}):new Matrix4().perspective({fovy:o,aspect:j,near:g,far:_});if(d){const{left:et=0,right:tt=0,top:rt=0,bottom:it=0}=d,ot=clamp$1((et+i-tt)/2,0,i)-i/2,ct=clamp$1((rt+e-it)/2,0,e)-e/2;_e[8]-=ot*2/i,_e[9]+=ct*2/e}return _e}class Viewport{constructor(e={}){_defineProperty(this,"id",void 0),_defineProperty(this,"x",void 0),_defineProperty(this,"y",void 0),_defineProperty(this,"width",void 0),_defineProperty(this,"height",void 0),_defineProperty(this,"padding",void 0),_defineProperty(this,"isGeospatial",void 0),_defineProperty(this,"zoom",void 0),_defineProperty(this,"focalDistance",void 0),_defineProperty(this,"position",void 0),_defineProperty(this,"modelMatrix",void 0),_defineProperty(this,"distanceScales",void 0),_defineProperty(this,"scale",void 0),_defineProperty(this,"center",void 0),_defineProperty(this,"cameraPosition",void 0),_defineProperty(this,"projectionMatrix",void 0),_defineProperty(this,"viewMatrix",void 0),_defineProperty(this,"viewMatrixUncentered",void 0),_defineProperty(this,"viewMatrixInverse",void 0),_defineProperty(this,"viewProjectionMatrix",void 0),_defineProperty(this,"pixelProjectionMatrix",void 0),_defineProperty(this,"pixelUnprojectionMatrix",void 0),_defineProperty(this,"resolution",void 0),_defineProperty(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||DEFAULT_DISTANCE_SCALES,this.focalDistance=e.focalDistance||1,this.position=e.position||ZERO_VECTOR,this.modelMatrix=e.modelMatrix||null;const{longitude:s,latitude:o}=e;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(s),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?PROJECTION_MODE.WEB_MERCATOR:PROJECTION_MODE.WEB_MERCATOR_AUTO_OFFSET:PROJECTION_MODE.IDENTITY}equals(e){return e instanceof Viewport?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&equals(e.projectionMatrix,this.projectionMatrix)&&equals(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:s=!0}={}){const o=this.projectPosition(e),a=worldToPixels(o,this.pixelProjectionMatrix),[d,g]=a,_=s?g:this.height-g;return e.length===2?[d,_]:[d,_,a[2]]}unproject(e,{topLeft:s=!0,targetZ:o}={}){const[a,d,g]=e,_=s?d:this.height-d,j=o&&o*this.distanceScales.unitsPerMeter[2],_e=pixelsToWorld([a,_,g],this.pixelUnprojectionMatrix,j),[et,tt,rt]=this.unprojectPosition(_e);return Number.isFinite(g)?[et,tt,rt]:Number.isFinite(o)?[et,tt,o]:[et,tt]}projectPosition(e){const[s,o]=this.projectFlat(e),a=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[s,o,a]}unprojectPosition(e){const[s,o]=this.unprojectFlat(e),a=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[s,o,a]}projectFlat(e){if(this.isGeospatial){const s=lngLatToWorld(e);return s[1]=clamp$1(s[1],-318,830),s}return e}unprojectFlat(e){return this.isGeospatial?worldToLngLat(e):e}getBounds(e={}){const s={targetZ:e.z||0},o=this.unproject([0,0],s),a=this.unproject([this.width,0],s),d=this.unproject([0,this.height],s),g=this.unproject([this.width,this.height],s);return[Math.min(o[0],a[0],d[0],g[0]),Math.min(o[1],a[1],d[1],g[1]),Math.max(o[0],a[0],d[0],g[0]),Math.max(o[1],a[1],d[1],g[1])]}getDistanceScales(e){return e?getDistanceScales({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:s,width:o=1,height:a=1}){return e<this.x+this.width&&this.x<e+o&&s<this.y+this.height&&this.y<s+a}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,getFrustumPlanes(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,s){return null}_initProps(e){const s=e.longitude,o=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=getMeterZoom({latitude:o})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||getDistanceScales({latitude:o,longitude:s}));const a=Math.pow(2,this.zoom);this.scale=a;const{position:d,modelMatrix:g}=e;let _=ZERO_VECTOR;if(d&&(_=g?new Matrix4(g).transformAsVector(d,[]):d),this.isGeospatial){const j=this.projectPosition([s,o,0]);this.center=new Vector3(_).scale(this.distanceScales.unitsPerMeter).add(j)}else this.center=this.projectPosition(_)}_initMatrices(e){const{viewMatrix:s=IDENTITY,projectionMatrix:o=null,orthographic:a=!1,fovyRadians:d,fovy:g=75,near:_=.1,far:j=1e3,padding:_e=null,focalDistance:et=1}=e;this.viewMatrixUncentered=s,this.viewMatrix=new Matrix4().multiplyRight(s).translate(new Vector3(this.center).negate()),this.projectionMatrix=o||createProjectionMatrix({width:this.width,height:this.height,orthographic:a,fovyRadians:d||g*DEGREES_TO_RADIANS$2,focalDistance:et,padding:_e,near:_,far:j});const tt=createMat4();multiply(tt,tt,this.projectionMatrix),multiply(tt,tt,this.viewMatrix),this.viewProjectionMatrix=tt,this.viewMatrixInverse=invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=getCameraPosition(this.viewMatrixInverse);const rt=createMat4(),it=createMat4();scale$1(rt,rt,[this.width/2,-this.height/2,1]),translate(rt,rt,[1,-1,0]),multiply(it,rt,this.viewProjectionMatrix),this.pixelProjectionMatrix=it,this.pixelUnprojectionMatrix=invert(createMat4(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||log.warn("Pixel project matrix not invertible")()}}_defineProperty(Viewport,"displayName","Viewport");const TILE_SIZE=512,EARTH_CIRCUMFERENCE=4003e4,DEGREES_TO_RADIANS$1=Math.PI/180;function unitsPerMeter(i){const e=Math.cos(i*DEGREES_TO_RADIANS$1);return TILE_SIZE/EARTH_CIRCUMFERENCE/e}class WebMercatorViewport extends Viewport{constructor(e={}){const{latitude:s=0,longitude:o=0,zoom:a=0,pitch:d=0,bearing:g=0,nearZMultiplier:_=.1,farZMultiplier:j=1.01,orthographic:_e=!1,projectionMatrix:et,repeat:tt=!1,worldOffset:rt=0,legacyMeterSizes:it=!1}=e;let{width:ot,height:ct,altitude:ft=1.5}=e;const dt=Math.pow(2,a);ot=ot||1,ct=ct||1;let pt,gt=null;et?(ft=et[5]/2,pt=altitudeToFovy(ft)):(e.fovy?(pt=e.fovy,ft=fovyToAltitude(pt)):pt=altitudeToFovy(ft),gt=getProjectionParameters({width:ot,height:ct,pitch:d,fovy:pt,nearZMultiplier:_,farZMultiplier:j}));let Ct=getViewMatrix$1({height:ct,pitch:d,bearing:g,scale:dt,altitude:ft});rt&&(Ct=new Matrix4().translate([512*rt,0,0]).multiplyLeft(Ct)),super({...e,width:ot,height:ct,viewMatrix:Ct,longitude:o,latitude:s,zoom:a,...gt,fovy:pt,focalDistance:ft}),_defineProperty(this,"longitude",void 0),_defineProperty(this,"latitude",void 0),_defineProperty(this,"pitch",void 0),_defineProperty(this,"bearing",void 0),_defineProperty(this,"altitude",void 0),_defineProperty(this,"fovy",void 0),_defineProperty(this,"orthographic",void 0),_defineProperty(this,"_subViewports",void 0),_defineProperty(this,"_pseudoMeters",void 0),this.latitude=s,this.longitude=o,this.zoom=a,this.pitch=d,this.bearing=g,this.altitude=ft,this.fovy=pt,this.orthographic=_e,this._subViewports=tt?[]:null,this._pseudoMeters=it,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),s=Math.floor((e[0]+180)/360),o=Math.ceil((e[2]-180)/360);for(let a=s;a<=o;a++){const d=a?new WebMercatorViewport({...this,worldOffset:a}):this;this._subViewports.push(d)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[s,o]=this.projectFlat(e),a=(e[2]||0)*unitsPerMeter(e[1]);return[s,o,a]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[s,o]=this.unprojectFlat(e),a=(e[2]||0)/unitsPerMeter(o);return[s,o,a]}addMetersToLngLat(e,s){return addMetersToLngLat(e,s)}panByPosition(e,s){const o=pixelsToWorld(s,this.pixelUnprojectionMatrix),a=this.projectFlat(e),d=add$1([],a,negate([],o)),g=add$1([],this.center,d),[_,j]=this.unprojectFlat(g);return{longitude:_,latitude:j}}getBounds(e={}){const s=getBounds(this,e.z||0);return[Math.min(s[0][0],s[1][0],s[2][0],s[3][0]),Math.min(s[0][1],s[1][1],s[2][1],s[3][1]),Math.max(s[0][0],s[1][0],s[2][0],s[3][0]),Math.max(s[0][1],s[1][1],s[2][1],s[3][1])]}fitBounds(e,s={}){const{width:o,height:a}=this,{longitude:d,latitude:g,zoom:_}=fitBounds({width:o,height:a,bounds:e,...s});return new WebMercatorViewport({width:o,height:a,longitude:d,latitude:g,zoom:_})}}_defineProperty(WebMercatorViewport,"displayName","WebMercatorViewport");function lngLatZToWorldPosition(i,e,s=!1){const o=e.projectPosition(i);if(s&&e instanceof WebMercatorViewport){const[a,d,g=0]=i,_=e.getDistanceScales([a,d]);o[2]=g*_.unitsPerMeter[2]}return o}function normalizeParameters(i){const{viewport:e,modelMatrix:s,coordinateOrigin:o}=i;let{coordinateSystem:a,fromCoordinateSystem:d,fromCoordinateOrigin:g}=i;return a===COORDINATE_SYSTEM.DEFAULT&&(a=e.isGeospatial?COORDINATE_SYSTEM.LNGLAT:COORDINATE_SYSTEM.CARTESIAN),d===void 0&&(d=a),g===void 0&&(g=o),{viewport:e,coordinateSystem:a,coordinateOrigin:o,modelMatrix:s,fromCoordinateSystem:d,fromCoordinateOrigin:g}}function getWorldPosition(i,{viewport:e,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:d}){let[g,_,j=0]=i;switch(s&&([g,_,j]=transformMat4$1([],[g,_,j,1],s)),o){case COORDINATE_SYSTEM.LNGLAT:return lngLatZToWorldPosition([g,_,j],e,d);case COORDINATE_SYSTEM.LNGLAT_OFFSETS:return lngLatZToWorldPosition([g+a[0],_+a[1],j+(a[2]||0)],e,d);case COORDINATE_SYSTEM.METER_OFFSETS:return lngLatZToWorldPosition(addMetersToLngLat(a,[g,_,j]),e,d);case COORDINATE_SYSTEM.CARTESIAN:default:return e.isGeospatial?[g+a[0],_+a[1],j+a[2]]:e.projectPosition([g,_,j])}}function projectPosition(i,e){const{viewport:s,coordinateSystem:o,coordinateOrigin:a,modelMatrix:d,fromCoordinateSystem:g,fromCoordinateOrigin:_}=normalizeParameters(e),{geospatialOrigin:j,shaderCoordinateOrigin:_e,offsetMode:et}=getOffsetOrigin(s,o,a),tt=getWorldPosition(i,{viewport:s,modelMatrix:d,coordinateSystem:g,coordinateOrigin:_,offsetMode:et});if(et){const rt=s.projectPosition(j||_e);sub(tt,tt,rt)}return tt}const LIFECYCLE={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},COMPONENT_SYMBOL=Symbol.for("component"),ASYNC_DEFAULTS_SYMBOL=Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL_SYMBOL=Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED_SYMBOL=Symbol.for("asyncPropResolved");function flatten(i,e=()=>!0){return Array.isArray(i)?flattenArray(i,e,[]):e(i)?[i]:[]}function flattenArray(i,e,s){let o=-1;for(;++o<i.length;){const a=i[o];Array.isArray(a)?flattenArray(a,e,s):e(a)&&s.push(a)}return s}function fillArray({target:i,source:e,start:s=0,count:o=1}){const a=e.length,d=o*a;let g=0;for(let _=s;g<a;g++)i[_++]=e[g];for(;g<d;)g<d-g?(i.copyWithin(s+g,s,s+g),g*=2):(i.copyWithin(s+g,s,s+d-g),g=d);return i}class Resource{constructor(e,s,o){_defineProperty(this,"id",void 0),_defineProperty(this,"context",void 0),_defineProperty(this,"isLoaded",void 0),_defineProperty(this,"persistent",void 0),_defineProperty(this,"_loadCount",0),_defineProperty(this,"_subscribers",new Set),_defineProperty(this,"_data",void 0),_defineProperty(this,"_loader",void 0),_defineProperty(this,"_error",void 0),_defineProperty(this,"_content",void 0),this.id=e,this.context=o,this.setData(s)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,s){if(e===this._data&&!s)return;this._data=e;const o=++this._loadCount;let a=e;typeof e=="string"&&(a=load(e)),a instanceof Promise?(this.isLoaded=!1,this._loader=a.then(d=>{this._loadCount===o&&(this.isLoaded=!0,this._error=void 0,this._content=d)}).catch(d=>{this._loadCount===o&&(this.isLoaded=!0,this._error=d||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const d of this._subscribers)d.onChange(this.getData())}}class ResourceManager{constructor({gl:e,protocol:s}){_defineProperty(this,"protocol",void 0),_defineProperty(this,"_context",void 0),_defineProperty(this,"_resources",void 0),_defineProperty(this,"_consumers",void 0),_defineProperty(this,"_pruneRequest",void 0),this.protocol=s||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:s,forceUpdate:o=!1,persistent:a=!0}){let d=this._resources[e];d?d.setData(s,o):(d=new Resource(e,s,this._context),this._resources[e]=d),d.persistent=a}remove(e){const s=this._resources[e];s&&(s.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const s=this._consumers[e];if(s){for(const o in s){const a=s[o],d=this._resources[a.resourceId];d&&d.unsubscribe(a)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:s,consumerId:o,requestId:a="default"}){const{_resources:d,protocol:g}=this;e.startsWith(g)&&(e=e.replace(g,""),d[e]||this.add({resourceId:e,data:null,persistent:!1}));const _=d[e];if(this._track(o,a,_,s),_)return _.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,s,o,a){const d=this._consumers,g=d[e]=d[e]||{},_=g[s]||{},j=_.resourceId&&this._resources[_.resourceId];j&&(j.unsubscribe(_),this.prune()),o&&(g[s]=_,_.onChange=a,_.resourceId=o.id,o.subscribe(_))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const s=this._resources[e];!s.persistent&&!s.inUse()&&(s.delete(),delete this._resources[e])}}}const TRACE_SET_LAYERS="layerManager.setLayers",TRACE_ACTIVATE_VIEWPORT="layerManager.activateViewport";class LayerManager{constructor(e,{deck:s,stats:o,viewport:a,timeline:d}={}){_defineProperty(this,"layers",void 0),_defineProperty(this,"context",void 0),_defineProperty(this,"resourceManager",void 0),_defineProperty(this,"_lastRenderedLayers",[]),_defineProperty(this,"_needsRedraw",!1),_defineProperty(this,"_needsUpdate",!1),_defineProperty(this,"_nextLayers",null),_defineProperty(this,"_debug",!1),_defineProperty(this,"activateViewport",g=>{debug(TRACE_ACTIVATE_VIEWPORT,this,g),g&&(this.context.viewport=g)}),this.layers=[],this.resourceManager=new ResourceManager({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:s,programManager:e&&createProgramManager(e),stats:o||new Stats({id:"deck.gl"}),viewport:a||new Viewport({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:d||new Timeline,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let s=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const o of this.layers){const a=o.getNeedsRedraw(e);s=s||a}return s}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(s=>e.find(o=>s.id.indexOf(o)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,s){debug(TRACE_SET_LAYERS,this,s,e),this._lastRenderedLayers=e;const o=flatten(e,Boolean);for(const a of o)a.context=this.context;this._updateLayers(this.layers,o)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,s,o){o.raiseError(s,"".concat(e," of ").concat(o))}_updateLayers(e,s){const o={};for(const g of e)o[g.id]?log.warn("Multiple old layers with same id ".concat(g.id))():o[g.id]=g;const a=[];this._updateSublayersRecursively(s,o,a),this._finalizeOldLayers(o);let d=!1;for(const g of a)if(g.hasUniformTransition()){d="Uniform transition in ".concat(g);break}this._needsUpdate=d,this.layers=a}_updateSublayersRecursively(e,s,o){for(const a of e){a.context=this.context;const d=s[a.id];d===null&&log.warn("Multiple new layers with same id ".concat(a.id))(),s[a.id]=null;let g=null;try{this._debug&&d!==a&&a.validateProps(),d?(this._transferLayerState(d,a),this._updateLayer(a)):this._initializeLayer(a),o.push(a),g=a.isComposite?a.getSubLayers():null}catch(_){this._handleError("matching",_,a)}g&&this._updateSublayersRecursively(g,s,o)}}_finalizeOldLayers(e){for(const s in e){const o=e[s];o&&this._finalizeLayer(o)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=LIFECYCLE.INITIALIZED}catch(s){this._handleError("initialization",s,e)}}_transferLayerState(e,s){s._transferState(e),s.lifecycle=LIFECYCLE.MATCHED,s!==e&&(e.lifecycle=LIFECYCLE.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(s){this._handleError("update",s,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=LIFECYCLE.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=LIFECYCLE.FINALIZED}catch(s){this._handleError("finalization",s,e)}}}function deepEqual(i,e){if(i===e)return!0;if(!i||!e)return!1;for(const s in i){const o=i[s],a=e[s];if(!(o===a||Array.isArray(o)&&Array.isArray(a)&&deepEqual(o,a)))return!1}return!0}class ViewManager{constructor(e){_defineProperty(this,"width",void 0),_defineProperty(this,"height",void 0),_defineProperty(this,"views",void 0),_defineProperty(this,"viewState",void 0),_defineProperty(this,"controllers",void 0),_defineProperty(this,"timeline",void 0),_defineProperty(this,"_viewports",void 0),_defineProperty(this,"_viewportMap",void 0),_defineProperty(this,"_isUpdating",void 0),_defineProperty(this,"_needsRedraw",void 0),_defineProperty(this,"_needsUpdate",void 0),_defineProperty(this,"_eventManager",void 0),_defineProperty(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const s=this.controllers[e];s&&s.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const s=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),s}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const s=this.controllers[e];s&&s.updateTransition()}}getViewports(e){return e?this._viewports.filter(s=>s.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(s=>{e[s.id]=s}),e}getView(e){return this.views.find(s=>s.id===e)}getViewState(e){const s=typeof e=="string"?this.getView(e):e,o=s&&this.viewState[s.getViewStateId()]||this.viewState;return s?s.filterViewState(o):o}getViewport(e){return this._viewportMap[e]}unproject(e,s){const o=this.getViewports(),a={x:e[0],y:e[1]};for(let d=o.length-1;d>=0;--d){const g=o[d];if(g.containsPixel(a)){const _=e.slice();return _[0]-=g.x,_[1]-=g.y,g.unproject(_,s)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,s){(e!==this.width||s!==this.height)&&(this.width=e,this.height=s,this.setNeedsUpdate("Size changed"))}_setViews(e){e=flatten(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!deepEqual(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):log.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,s){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...s,viewId:e})}_createController(e,s){const o=s.type;return new o({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,s.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:d=>{var g;return(g=this.getView(e.id))===null||g===void 0?void 0:g.makeViewport({viewState:d,width:this.width,height:this.height})}})}_updateController(e,s,o,a){const d=e.controller;if(d){const g={...s,...d,id:e.id,x:o.x,y:o.y,width:o.width,height:o.height};return a||(a=this._createController(e,g)),a&&a.setProps(g),a}return null}_rebuildViewports(){const{views:e}=this,s=this.controllers;this._viewports=[],this.controllers={};let o=!1;for(let a=e.length;a--;){const d=e[a],g=this.getViewState(d),_=d.makeViewport({viewState:g,width:this.width,height:this.height});let j=s[d.id];const _e=!!d.controller;_e&&!j&&(o=!0),(o||!_e)&&j&&(j.finalize(),j=null),this.controllers[d.id]=this._updateController(d,g,_,j),this._viewports.unshift(_)}for(const a in s){const d=s[a];d&&!this.controllers[a]&&d.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,s){return e.length!==s.length?!0:e.some((o,a)=>!e[a].equals(s[a]))}}const PERCENT_OR_PIXELS_REGEX=/([0-9]+\.?[0-9]*)(%|px)/;function parsePosition(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=PERCENT_OR_PIXELS_REGEX.exec(i);if(e&&e.length>=3){const s=e[2]==="%",o=parseFloat(e[1]);return{position:s?o/100:o,relative:s}}default:throw new Error("Could not parse position string ".concat(i))}}function getPosition(i,e){return i.relative?Math.round(i.position*e):i.position}function assert(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class View{constructor(e){_defineProperty(this,"id",void 0),_defineProperty(this,"viewportInstance",void 0),_defineProperty(this,"_x",void 0),_defineProperty(this,"_y",void 0),_defineProperty(this,"_width",void 0),_defineProperty(this,"_height",void 0),_defineProperty(this,"_padding",void 0),_defineProperty(this,"props",void 0);const{id:s,x:o=0,y:a=0,width:d="100%",height:g="100%",padding:_=null,viewportInstance:j}=e||{};assert(!j||j instanceof Viewport),this.viewportInstance=j,this.id=s||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=parsePosition(o),this._y=parsePosition(a),this._width=parsePosition(d),this._height=parsePosition(g),this._padding=_&&{left:parsePosition(_.left||0),right:parsePosition(_.right||0),top:parsePosition(_.top||0),bottom:parsePosition(_.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&deepEqual(this.props,e.props)}makeViewport({width:e,height:s,viewState:o}){if(this.viewportInstance)return this.viewportInstance;o=this.filterViewState(o);const a=this.getDimensions({width:e,height:s});return new this.ViewportType({...o,...this.props,...a})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const s={...e};for(const o in this.props.viewState)o!=="id"&&(s[o]=this.props.viewState[o]);return s}return e}getDimensions({width:e,height:s}){const o={x:getPosition(this._x,e),y:getPosition(this._y,s),width:getPosition(this._width,e),height:getPosition(this._height,s)};return this._padding&&(o.padding={left:getPosition(this._padding.left,e),top:getPosition(this._padding.top,s),right:getPosition(this._padding.right,e),bottom:getPosition(this._padding.bottom,s)}),o}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Transition{constructor(e){_defineProperty(this,"_inProgress",void 0),_defineProperty(this,"_handle",void 0),_defineProperty(this,"_timeline",void 0),_defineProperty(this,"time",void 0),_defineProperty(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var s,o;this.cancel(),this.settings=e,this._inProgress=!0,(s=(o=this.settings).onStart)===null||s===void 0||s.call(o,this)}end(){if(this._inProgress){var e,s;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(s=this.settings).onEnd)===null||e===void 0||e.call(s,this)}}cancel(){if(this._inProgress){var e,s;(e=(s=this.settings).onInterrupt)===null||e===void 0||e.call(s,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,s;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:o,settings:a}=this;this._handle=o.addChannel({delay:o.getTime(),duration:a.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(s=this.settings).onUpdate)===null||e===void 0||e.call(s,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const noop$1=()=>{},TRANSITION_EVENTS={BREAK:1,SNAP_TO_END:2,IGNORE:3},DEFAULT_EASING=i=>i,DEFAULT_INTERRUPTION=TRANSITION_EVENTS.BREAK;class TransitionManager{constructor(e){_defineProperty(this,"getControllerState",void 0),_defineProperty(this,"props",void 0),_defineProperty(this,"propsInTransition",void 0),_defineProperty(this,"transition",void 0),_defineProperty(this,"onViewStateChange",void 0),_defineProperty(this,"onStateChange",void 0),_defineProperty(this,"_onTransitionUpdate",s=>{const{time:o,settings:{interpolator:a,startProps:d,endProps:g,duration:_,easing:j}}=s,_e=j(o/_),et=a.interpolateProps(d,g,_e);this.propsInTransition=this.getControllerState({...this.props,...et}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Transition(e.timeline),this.onViewStateChange=e.onViewStateChange||noop$1,this.onStateChange=e.onStateChange||noop$1}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let s=!1;const o=this.props;if(this.props=e,!o||this._shouldIgnoreViewportChange(o,e))return!1;if(this._isTransitionEnabled(e)){let a=o;if(this.transition.inProgress){const{interruption:d,endProps:g}=this.transition.settings;a={...o,...d===TRANSITION_EVENTS.SNAP_TO_END?g:this.propsInTransition||o}}this._triggerTransition(a,e),s=!0}else this.transition.cancel();return s}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:s,transitionInterpolator:o}=e;return(s>0||s==="auto")&&!!o}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,s){return this.transition.inProgress?this.transition.settings.interruption===TRANSITION_EVENTS.IGNORE||this._isUpdateDueToCurrentTransition(s):this._isTransitionEnabled(s)?s.transitionInterpolator.arePropsEqual(e,s):!0}_triggerTransition(e,s){const o=this.getControllerState(e),a=this.getControllerState(s).shortestPathFrom(o),d=s.transitionInterpolator,g=d.getDuration?d.getDuration(e,s):s.transitionDuration;if(g===0)return;const _=d.initializeProps(e,a);this.propsInTransition={};const j={duration:g,easing:s.transitionEasing||DEFAULT_EASING,interpolator:d,interruption:s.transitionInterruption||DEFAULT_INTERRUPTION,startProps:_.start,endProps:_.end,onStart:s.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(s.onTransitionInterrupt),onEnd:this._onTransitionEnd(s.onTransitionEnd)};this.transition.start(j),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return s=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(s)}}}class TransitionInterpolator{constructor(e){_defineProperty(this,"_propsToCompare",void 0),_defineProperty(this,"_propsToExtract",void 0),_defineProperty(this,"_requiredProps",void 0);const{compare:s,extract:o,required:a}=e;this._propsToCompare=s,this._propsToExtract=o||s,this._requiredProps=a}arePropsEqual(e,s){for(const o of this._propsToCompare)if(!(o in e)||!(o in s)||!equals(e[o],s[o]))return!1;return!0}initializeProps(e,s){const o={},a={};for(const d of this._propsToExtract)(d in e||d in s)&&(o[d]=e[d],a[d]=s[d]);return this._checkRequiredProps(o),this._checkRequiredProps(a),{start:o,end:a}}getDuration(e,s){return s.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(s=>{const o=e[s];assert(Number.isFinite(o)||Array.isArray(o),"".concat(s," is required for transition"))})}}const DEFAULT_PROPS=["longitude","latitude","zoom","bearing","pitch"],DEFAULT_REQUIRED_PROPS=["longitude","latitude","zoom"];class LinearInterpolator extends TransitionInterpolator{constructor(e={}){const s=Array.isArray(e)?e:e.transitionProps,o=Array.isArray(e)?{}:e;o.transitionProps=Array.isArray(s)?{compare:s,required:s}:s||{compare:DEFAULT_PROPS,required:DEFAULT_REQUIRED_PROPS},super(o.transitionProps),_defineProperty(this,"opts",void 0),this.opts=o}initializeProps(e,s){const o=super.initializeProps(e,s),{makeViewport:a,around:d}=this.opts;if(a&&d){const g=a(e),_=a(s),j=g.unproject(d);o.start.around=d,Object.assign(o.end,{around:_.project(j),aroundPosition:j,width:s.width,height:s.height})}return o}interpolateProps(e,s,o){const a={};for(const d of this._propsToExtract)a[d]=lerp(e[d]||0,s[d]||0,o);if(s.aroundPosition&&this.opts.makeViewport){const d=this.opts.makeViewport({...s,...a});Object.assign(a,d.panByPosition(s.aroundPosition,lerp(e.around,s.around,o)))}return a}}const NO_TRANSITION_PROPS={transitionDuration:0},DEFAULT_INERTIA=300,INERTIA_EASING=i=>1-(1-i)*(1-i),EVENT_TYPES={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},pinchEventWorkaround={};class Controller{constructor(e){_defineProperty(this,"props",void 0),_defineProperty(this,"state",{}),_defineProperty(this,"transitionManager",void 0),_defineProperty(this,"eventManager",void 0),_defineProperty(this,"onViewStateChange",void 0),_defineProperty(this,"onStateChange",void 0),_defineProperty(this,"makeViewport",void 0),_defineProperty(this,"_controllerState",void 0),_defineProperty(this,"_events",{}),_defineProperty(this,"_interactionState",{isDragging:!1}),_defineProperty(this,"_customEvents",[]),_defineProperty(this,"_eventStartBlocked",null),_defineProperty(this,"_panMove",!1),_defineProperty(this,"invertPan",!1),_defineProperty(this,"dragMode","rotate"),_defineProperty(this,"inertia",0),_defineProperty(this,"scrollZoom",!0),_defineProperty(this,"dragPan",!0),_defineProperty(this,"dragRotate",!0),_defineProperty(this,"doubleClickZoom",!0),_defineProperty(this,"touchZoom",!0),_defineProperty(this,"touchRotate",!1),_defineProperty(this,"keyboard",!0),this.transitionManager=new TransitionManager({...e,getControllerState:s=>new this.ControllerState(s),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const s in this._events)if(this._events[s]){var e;(e=this.eventManager)===null||e===void 0||e.off(s,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const s=this._eventStartBlocked;switch(e.type){case"panstart":return s?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return s?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return s?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:s,y:o}=this.props,{offsetCenter:a}=e;return[a.x-s,a.y-o]}isPointInBounds(e,s){const{width:o,height:a}=this.props;if(s&&s.handled)return!1;const d=e[0]>=0&&e[0]<=o&&e[1]>=0&&e[1]<=a;return d&&s&&s.stopPropagation(),d}isFunctionKeyPressed(e){const{srcEvent:s}=e;return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const s=setTimeout(()=>{this._eventStartBlocked===s&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=s}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:s}=e;this.inertia=Number.isFinite(s)?s:s===!0?DEFAULT_INERTIA:0;const{scrollZoom:o=!0,dragPan:a=!0,dragRotate:d=!0,doubleClickZoom:g=!0,touchZoom:_=!0,touchRotate:j=!1,keyboard:_e=!0}=e,et=!!this.onViewStateChange;this.toggleEvents(EVENT_TYPES.WHEEL,et&&o),this.toggleEvents(EVENT_TYPES.PAN,et&&(a||d)),this.toggleEvents(EVENT_TYPES.PINCH,et&&(_||j)),this.toggleEvents(EVENT_TYPES.TRIPLE_PAN,et&&j),this.toggleEvents(EVENT_TYPES.DOUBLE_TAP,et&&g),this.toggleEvents(EVENT_TYPES.KEYBOARD,et&&_e),this.scrollZoom=o,this.dragPan=a,this.dragRotate=d,this.doubleClickZoom=g,this.touchZoom=_,this.touchRotate=j,this.keyboard=_e}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,s){this.eventManager&&e.forEach(o=>{this._events[o]!==s&&(this._events[o]=s,s?this.eventManager.on(o,this.handleEvent):this.eventManager.off(o,this.handleEvent))})}updateViewport(e,s=null,o={}){const a={...e.getViewportProps(),...s},d=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(o),d){const g=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:a,interactionState:this._interactionState,oldViewState:g})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const s=this.getCenter(e);if(!this.isPointInBounds(s,e))return!1;let o=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(o=!o);const a=this.controllerState[o?"panStart":"rotateStart"]({pos:s});return this._panMove=o,this.updateViewport(a,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const s=this.getCenter(e),o=this.controllerState.pan({pos:s});return this.updateViewport(o,NO_TRANSITION_PROPS,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:s}=this;if(this.dragPan&&s&&e.velocity){const o=this.getCenter(e),a=[o[0]+e.velocityX*s/2,o[1]+e.velocityY*s/2],d=this.controllerState.pan({pos:a}).panEnd();this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:s,transitionEasing:INERTIA_EASING},{isDragging:!1,isPanning:!0})}else{const o=this.controllerState.panEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const s=this.getCenter(e),o=this.controllerState.rotate({pos:s});return this.updateViewport(o,NO_TRANSITION_PROPS,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:s}=this;if(this.dragRotate&&s&&e.velocity){const o=this.getCenter(e),a=[o[0]+e.velocityX*s/2,o[1]+e.velocityY*s/2],d=this.controllerState.rotate({pos:a}).rotateEnd();this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:s,transitionEasing:INERTIA_EASING},{isDragging:!1,isRotating:!0})}else{const o=this.controllerState.rotateEnd();this.updateViewport(o,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const s=this.getCenter(e);if(!this.isPointInBounds(s,e))return!1;const{speed:o=.01,smooth:a=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:d}=e;let g=2/(1+Math.exp(-Math.abs(d*o)));d<0&&g!==0&&(g=1/g);const _=this.controllerState.zoom({pos:s,scale:g});return this.updateViewport(_,{...this._getTransitionProps({around:s}),transitionDuration:a?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const s=this.getCenter(e);if(!this.isPointInBounds(s,e))return!1;const o=this.controllerState.rotateStart({pos:s});return this.updateViewport(o,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const s=this.getCenter(e);s[0]-=e.deltaX;const o=this.controllerState.rotate({pos:s});return this.updateViewport(o,NO_TRANSITION_PROPS,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:s}=this;if(this.touchRotate&&s&&e.velocityY){const o=this.getCenter(e),a=[o[0],o[1]+=e.velocityY*s/2],d=this.controllerState.rotate({pos:a});this.updateViewport(d,{...this._getTransitionProps(),transitionDuration:s,transitionEasing:INERTIA_EASING},{isDragging:!1,isRotating:!0}),this.blockEvents(s)}else{const o=this.controllerState.rotateEnd();this.updateViewport(o,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const s=this.getCenter(e);if(!this.isPointInBounds(s,e))return!1;const o=this.controllerState.zoomStart({pos:s}).rotateStart({pos:s});return pinchEventWorkaround._startPinchRotation=e.rotation,pinchEventWorkaround._lastPinchEvent=e,this.updateViewport(o,NO_TRANSITION_PROPS,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let s=this.controllerState;if(this.touchZoom){const{scale:o}=e,a=this.getCenter(e);s=s.zoom({pos:a,scale:o})}if(this.touchRotate){const{rotation:o}=e;s=s.rotate({deltaAngleX:pinchEventWorkaround._startPinchRotation-o})}return this.updateViewport(s,NO_TRANSITION_PROPS,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),pinchEventWorkaround._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:s}=this,{_lastPinchEvent:o}=pinchEventWorkaround;if(this.touchZoom&&s&&o&&e.scale!==o.scale){const a=this.getCenter(e);let d=this.controllerState.rotateEnd();const g=Math.log2(e.scale),_=(g-Math.log2(o.scale))/(e.deltaTime-o.deltaTime),j=Math.pow(2,g+_*s/2);d=d.zoom({pos:a,scale:j}).zoomEnd(),this.updateViewport(d,{...this._getTransitionProps({around:a}),transitionDuration:s,transitionEasing:INERTIA_EASING},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(s)}else{const a=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return pinchEventWorkaround._startPinchRotation=null,pinchEventWorkaround._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const s=this.getCenter(e);if(!this.isPointInBounds(s,e))return!1;const o=this.isFunctionKeyPressed(e),a=this.controllerState.zoom({pos:s,scale:o?.5:2});return this.updateViewport(a,this._getTransitionProps({around:s}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const s=this.isFunctionKeyPressed(e),{zoomSpeed:o,moveSpeed:a,rotateSpeedX:d,rotateSpeedY:g}=this.keyboard===!0?{}:this.keyboard,{controllerState:_}=this;let j;const _e={};switch(e.srcEvent.code){case"Minus":j=s?_.zoomOut(o).zoomOut(o):_.zoomOut(o),_e.isZooming=!0;break;case"Equal":j=s?_.zoomIn(o).zoomIn(o):_.zoomIn(o),_e.isZooming=!0;break;case"ArrowLeft":s?(j=_.rotateLeft(d),_e.isRotating=!0):(j=_.moveLeft(a),_e.isPanning=!0);break;case"ArrowRight":s?(j=_.rotateRight(d),_e.isRotating=!0):(j=_.moveRight(a),_e.isPanning=!0);break;case"ArrowUp":s?(j=_.rotateUp(g),_e.isRotating=!0):(j=_.moveUp(a),_e.isPanning=!0);break;case"ArrowDown":s?(j=_.rotateDown(g),_e.isRotating=!0):(j=_.moveDown(a),_e.isPanning=!0);break;default:return!1}return this.updateViewport(j,this._getTransitionProps(),_e),!0}_getTransitionProps(e){const{transition:s}=this;return!s||!s.transitionInterpolator?NO_TRANSITION_PROPS:e?{...s,transitionInterpolator:new LinearInterpolator({...e,...s.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:s}}class ViewState{constructor(e,s){_defineProperty(this,"_viewportProps",void 0),_defineProperty(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=s}getViewportProps(){return this._viewportProps}getState(){return this._state}}const PITCH_MOUSE_THRESHOLD=5,PITCH_ACCEL=1.2;class MapState extends ViewState{constructor(e){const{width:s,height:o,latitude:a,longitude:d,zoom:g,bearing:_=0,pitch:j=0,altitude:_e=1.5,position:et=[0,0,0],maxZoom:tt=20,minZoom:rt=0,maxPitch:it=60,minPitch:ot=0,startPanLngLat:ct,startZoomLngLat:ft,startRotatePos:dt,startBearing:pt,startPitch:gt,startZoom:Ct,normalize:xt=!0}=e;assert(Number.isFinite(d)),assert(Number.isFinite(a)),assert(Number.isFinite(g)),super({width:s,height:o,latitude:a,longitude:d,zoom:g,bearing:_,pitch:j,altitude:_e,maxZoom:tt,minZoom:rt,maxPitch:it,minPitch:ot,normalize:xt,position:et},{startPanLngLat:ct,startZoomLngLat:ft,startRotatePos:dt,startBearing:pt,startPitch:gt,startZoom:Ct}),_defineProperty(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:s}){const o=this.getState().startPanLngLat||this._unproject(s);if(!o)return this;const d=this.makeViewport(this.getViewportProps()).panByPosition(o,e);return this._getUpdatedState(d)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:s=0,deltaAngleY:o=0}){const{startRotatePos:a,startBearing:d,startPitch:g}=this.getState();if(!a||d===void 0||g===void 0)return this;let _;return e?_=this._getNewRotation(e,a,g,d):_={bearing:d+s,pitch:g+o},this._getUpdatedState(_)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:s,scale:o}){let{startZoom:a,startZoomLngLat:d}=this.getState();if(d||(a=this.getViewportProps().zoom,d=this._unproject(s)||this._unproject(e)),!d)return this;const{maxZoom:g,minZoom:_}=this.getViewportProps();let j=a+Math.log2(o);j=clamp$1(j,_,g);const _e=this.makeViewport({...this.getViewportProps(),zoom:j});return this._getUpdatedState({zoom:j,..._e.panByPosition(d,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const s=e.getViewportProps(),o={...this.getViewportProps()},{bearing:a,longitude:d}=o;return Math.abs(a-s.bearing)>180&&(o.bearing=a<0?a+360:a-360),Math.abs(d-s.longitude)>180&&(o.longitude=d<0?d+360:d-360),o}applyConstraints(e){const{maxZoom:s,minZoom:o,zoom:a}=e;e.zoom=clamp$1(a,o,s);const{maxPitch:d,minPitch:g,pitch:_}=e;e.pitch=clamp$1(_,g,d);const{normalize:j=!0}=e;return j&&Object.assign(e,normalizeViewportProps(e)),e}_zoomFromCenter(e){const{width:s,height:o}=this.getViewportProps();return this.zoom({pos:[s/2,o/2],scale:e})}_panFromCenter(e){const{width:s,height:o}=this.getViewportProps();return this.pan({startPos:[s/2,o/2],pos:[s/2+e[0],o/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const s=this.makeViewport(this.getViewportProps());return e&&s.unproject(e)}_getNewRotation(e,s,o,a){const d=e[0]-s[0],g=e[1]-s[1],_=e[1],j=s[1],{width:_e,height:et}=this.getViewportProps(),tt=d/_e;let rt=0;g>0?Math.abs(et-j)>PITCH_MOUSE_THRESHOLD&&(rt=g/(j-et)*PITCH_ACCEL):g<0&&j>PITCH_MOUSE_THRESHOLD&&(rt=1-_/j),rt=clamp$1(rt,-1,1);const{minPitch:it,maxPitch:ot}=this.getViewportProps(),ct=a+180*tt;let ft=o;return rt>0?ft=o+rt*(ot-o):rt<0&&(ft=o-rt*(it-o)),{pitch:ft,bearing:ct}}}class MapController extends Controller{constructor(...e){super(...e),_defineProperty(this,"ControllerState",MapState),_defineProperty(this,"transition",{transitionDuration:300,transitionInterpolator:new LinearInterpolator({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),_defineProperty(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const s=this.props;super.setProps(e),(!s||s.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class MapView extends View{get ViewportType(){return WebMercatorViewport}get ControllerType(){return MapController}}_defineProperty(MapView,"displayName","MapView");class MaskPass extends LayersPass{constructor(e,s){super(e,s),_defineProperty(this,"maskMap",void 0),_defineProperty(this,"fbo",void 0);const{mapSize:o=2048}=s;this.maskMap=new Texture2D(e,{width:o,height:o,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new Framebuffer(e,{id:"maskmap",width:o,height:o,attachments:{[36064]:this.maskMap}})}render(e){const s=this.gl,o=[!1,!1,!1,!1];return o[e.channel]=!0,withParameters(s,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:o,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===OPERATION.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const viewMatrix=new Matrix4().lookAt({eye:[0,0,1]});function getProjectionMatrix({width:i,height:e,near:s,far:o,padding:a}){let d=-i/2,g=i/2,_=-e/2,j=e/2;if(a){const{left:_e=0,right:et=0,top:tt=0,bottom:rt=0}=a,it=clamp$1((_e+i-et)/2,0,i)-i/2,ot=clamp$1((tt+e-rt)/2,0,e)-e/2;d-=it,g-=it,_+=ot,j+=ot}return new Matrix4().ortho({left:d,right:g,bottom:_,top:j,near:s,far:o})}class OrthographicViewport extends Viewport{constructor(e){const{width:s,height:o,near:a=.1,far:d=1e3,zoom:g=0,target:_=[0,0,0],padding:j=null,flipY:_e=!0}=e,et=Array.isArray(g)?g[0]:g,tt=Array.isArray(g)?g[1]:g,rt=Math.min(et,tt),it=Math.pow(2,rt);let ot;if(et!==tt){const ct=Math.pow(2,et),ft=Math.pow(2,tt);ot={unitsPerMeter:[ct/it,ft/it,1],metersPerUnit:[it/ct,it/ft,1]}}super({...e,longitude:void 0,position:_,viewMatrix:viewMatrix.clone().scale([it,it*(_e?-1:1),it]),projectionMatrix:getProjectionMatrix({width:s||1,height:o||1,padding:j,near:a,far:d}),zoom:rt,distanceScales:ot})}projectFlat([e,s]){const{unitsPerMeter:o}=this.distanceScales;return[e*o[0],s*o[1]]}unprojectFlat([e,s]){const{metersPerUnit:o}=this.distanceScales;return[e*o[0],s*o[1]]}panByPosition(e,s){const o=pixelsToWorld(s,this.pixelUnprojectionMatrix),a=this.projectFlat(e),d=add$1([],a,negate([],o)),g=add$1([],this.center,d);return{target:this.unprojectFlat(g)}}}class OrbitState extends ViewState{constructor(e){const{width:s,height:o,rotationX:a=0,rotationOrbit:d=0,target:g=[0,0,0],zoom:_=0,minRotationX:j=-90,maxRotationX:_e=90,minZoom:et=-1/0,maxZoom:tt=1/0,startPanPosition:rt,startRotatePos:it,startRotationX:ot,startRotationOrbit:ct,startZoomPosition:ft,startZoom:dt}=e;super({width:s,height:o,rotationX:a,rotationOrbit:d,target:g,zoom:_,minRotationX:j,maxRotationX:_e,minZoom:et,maxZoom:tt},{startPanPosition:rt,startRotatePos:it,startRotationX:ot,startRotationOrbit:ct,startZoomPosition:ft,startZoom:dt}),_defineProperty(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:s}){const o=this.getState().startPanPosition||s;if(!o)return this;const d=this.makeViewport(this.getViewportProps()).panByPosition(o,e);return this._getUpdatedState(d)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:s=0,deltaAngleY:o=0}){const{startRotatePos:a,startRotationX:d,startRotationOrbit:g}=this.getState(),{width:_,height:j}=this.getViewportProps();if(!a||d===void 0||g===void 0)return this;let _e;if(e){let et=(e[0]-a[0])/_;const tt=(e[1]-a[1])/j;(d<-90||d>90)&&(et*=-1),_e={rotationX:d+tt*180,rotationOrbit:g+et*180}}else _e={rotationX:d+o,rotationOrbit:g+s};return this._getUpdatedState(_e)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const s=e.getViewportProps(),o={...this.getViewportProps()},{rotationOrbit:a}=o;return Math.abs(a-s.rotationOrbit)>180&&(o.rotationOrbit=a<0?a+360:a-360),o}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:s,scale:o}){let{startZoom:a,startZoomPosition:d}=this.getState();if(d||(a=this.getViewportProps().zoom,d=this._unproject(s)||this._unproject(e)),!d)return this;const g=this._calculateNewZoom({scale:o,startZoom:a}),_=this.makeViewport({...this.getViewportProps(),zoom:g});return this._getUpdatedState({zoom:g,..._.panByPosition(d,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const s=this.makeViewport(this.getViewportProps());return e&&s.unproject(e)}_calculateNewZoom({scale:e,startZoom:s}){const{maxZoom:o,minZoom:a}=this.getViewportProps();s===void 0&&(s=this.getViewportProps().zoom);const d=s+Math.log2(e);return clamp$1(d,a,o)}_panFromCenter(e){const{width:s,height:o,target:a}=this.getViewportProps();return this.pan({startPosition:a,pos:[s/2+e[0],o/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:s,minZoom:o,zoom:a,maxRotationX:d,minRotationX:g,rotationOrbit:_}=e;return e.zoom=Array.isArray(a)?[clamp$1(a[0],o,s),clamp$1(a[1],o,s)]:clamp$1(a,o,s),e.rotationX=clamp$1(e.rotationX,g,d),(_<-180||_>180)&&(e.rotationOrbit=mod(_+180,360)-180),e}}class OrbitController extends Controller{constructor(...e){super(...e),_defineProperty(this,"ControllerState",OrbitState),_defineProperty(this,"transition",{transitionDuration:300,transitionInterpolator:new LinearInterpolator({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})})}}class OrthographicState extends OrbitState{constructor(e){super(e),_defineProperty(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:s}){const{maxZoom:o,minZoom:a}=this.getViewportProps();s===void 0&&(s=this.getViewportProps().zoom);let d=Math.log2(e);if(Array.isArray(s)){let[g,_]=s;switch(this.zoomAxis){case"X":g=clamp$1(g+d,a,o);break;case"Y":_=clamp$1(_+d,a,o);break;default:let j=Math.min(g+d,_+d);j<a&&(d+=a-j),j=Math.max(g+d,_+d),j>o&&(d+=o-j),g+=d,_+=d}return[g,_]}return clamp$1(s+d,a,o)}}class OrthographicController extends Controller{constructor(...e){super(...e),_defineProperty(this,"ControllerState",OrthographicState),_defineProperty(this,"transition",{transitionDuration:300,transitionInterpolator:new LinearInterpolator(["target","zoom"])}),_defineProperty(this,"dragMode","pan")}_onPanRotate(){return!1}}class OrthographicView extends View{get ViewportType(){return OrthographicViewport}get ControllerType(){return OrthographicController}}_defineProperty(OrthographicView,"displayName","OrthographicView");function getMaskBounds({layers:i,viewport:e}){let s=null;for(const d of i){const g=d.getBounds();g&&(s?(s[0]=Math.min(s[0],g[0][0]),s[1]=Math.min(s[1],g[0][1]),s[2]=Math.max(s[2],g[1][0]),s[3]=Math.max(s[3],g[1][1])):s=[g[0][0],g[0][1],g[1][0],g[1][1]])}const o=e.getBounds();if(!s)return o;const a=_doubleBounds(o);return s[2]-s[0]<a[2]-a[0]||s[3]-s[1]<a[3]-a[1]||(s[0]=Math.max(s[0],a[0]),s[1]=Math.max(s[1],a[1]),s[2]=Math.min(s[2],a[2]),s[3]=Math.min(s[3],a[3])),s}function getMaskViewport({bounds:i,viewport:e,width:s,height:o}){if(i[2]<=i[0]||i[3]<=i[1])return null;const a=1;if(s-=a*2,o-=a*2,e instanceof WebMercatorViewport){const{longitude:_,latitude:j,zoom:_e}=fitBounds({width:s,height:o,bounds:[[i[0],i[1]],[i[2],i[3]]],maxZoom:20});return new WebMercatorViewport({longitude:_,latitude:j,zoom:_e,x:a,y:a,width:s,height:o})}const d=[(i[0]+i[2])/2,(i[1]+i[3])/2,0],g=Math.min(20,s/(i[2]-i[0]),o/(i[3]-i[1]));return new OrthographicView({x:a,y:a}).makeViewport({width:s,height:o,viewState:{target:d,zoom:Math.log2(g)}})}function _doubleBounds(i){const e={x:i[2]-i[0],y:i[3]-i[1]},s={x:i[0]+.5*e.x,y:i[1]+.5*e.y};return[s.x-e.x,s.y-e.y,s.x+e.x,s.y+e.y]}class MaskEffect{constructor(){_defineProperty(this,"id","mask-effect"),_defineProperty(this,"props",null),_defineProperty(this,"useInPicking",!0),_defineProperty(this,"dummyMaskMap",void 0),_defineProperty(this,"channels",[]),_defineProperty(this,"masks",null),_defineProperty(this,"maskPass",void 0),_defineProperty(this,"maskMap",void 0),_defineProperty(this,"lastViewport",void 0)}preRender(e,{layers:s,layerFilter:o,viewports:a,onViewportActive:d,views:g}){this.dummyMaskMap||(this.dummyMaskMap=new Texture2D(e,{width:1,height:1}));const _=s.filter(tt=>tt.props.visible&&tt.props.operation===OPERATION.MASK);if(_.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new MaskPass(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const j=this._sortMaskChannels(_),_e=a[0],et=!this.lastViewport||!this.lastViewport.equals(_e);for(const tt in j)this._renderChannel(j[tt],{layerFilter:o,onViewportActive:d,views:g,viewport:_e,viewportChanged:et})}_renderChannel(e,{layerFilter:s,onViewportActive:o,views:a,viewport:d,viewportChanged:g}){const _=this.channels[e.index];if(!_)return;const j=e===_||_.layers.length!==e.layers.length||e.layerBounds.some((_e,et)=>_e!==_.layerBounds[et]);if(e.bounds=_.bounds,e.maskBounds=_.maskBounds,this.channels[e.index]=e,(j||g)&&(this.lastViewport=d,e.bounds=getMaskBounds({layers:e.layers,viewport:d}),j||!equals(e.bounds,_.bounds))){const{maskPass:_e,maskMap:et}=this,tt=getMaskViewport({bounds:e.bounds,viewport:d,width:et.width,height:et.height});e.maskBounds=tt?tt.getBounds():[0,0,1,1],_e.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:s,viewports:tt?[tt]:[],onViewportActive:o,views:a,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const s={};let o=0;for(const a of e){const{id:d}=a.root;let g=s[d];if(!g){if(++o>4){log.warn("Too many mask layers. The max supported is 4")();continue}g={id:d,index:this.channels.findIndex(_=>(_==null?void 0:_.id)===d),layers:[],layerBounds:[],coordinateOrigin:a.root.props.coordinateOrigin,coordinateSystem:a.root.props.coordinateSystem},s[d]=g}g.layers.push(a),g.layerBounds.push(a.getBounds())}for(let a=0;a<4;a++){const d=this.channels[a];(!d||!(d.id in s))&&(this.channels[a]=null)}for(const a in s){const d=s[a];d.index<0&&(d.index=this.channels.findIndex(g=>!g),this.channels[d.index]=d)}return s}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const DEFAULT_LIGHTING_EFFECT=new LightingEffect;class EffectManager{constructor(){_defineProperty(this,"effects",void 0),_defineProperty(this,"_internalEffects",void 0),_defineProperty(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!deepEqual(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const s=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),s}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new MaskEffect),e.some(s=>s instanceof LightingEffect)||this._internalEffects.push(DEFAULT_LIGHTING_EFFECT)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class DrawLayersPass extends LayersPass{shouldDrawLayer(e){return e.props.operation===OPERATION.DRAW}}const PICKING_PARAMETERS={blendFunc:[1,0,32771,0],blendEquation:32774};class PickLayersPass extends LayersPass{constructor(...e){super(...e),_defineProperty(this,"pickZ",void 0),_defineProperty(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:s,views:o,viewports:a,onViewportActive:d,pickingFBO:g,deviceRect:{x:_,y:j,width:_e,height:et},cullRect:tt,effects:rt,pass:it="picking",pickZ:ot}){const ct=this.gl;this.pickZ=ot;const ft=ot?null:{byLayer:new Map,byAlpha:[]};this._colors=ft;const dt=withParameters(ct,{scissorTest:!0,scissor:[_,j,_e,et],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...PICKING_PARAMETERS,blend:!ot},()=>super.render({target:g,layers:e,layerFilter:s,views:o,viewports:a,onViewportActive:d,cullRect:tt,effects:rt==null?void 0:rt.filter(gt=>gt.useInPicking),pass:it}));return this._colors=null,{decodePickingColor:ft&&decodeColor.bind(null,ft),stats:dt}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===OPERATION.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,s,o){const a={...e.props.parameters};return this._colors?(Object.assign(a,PICKING_PARAMETERS),a.blend=!0,a.blendColor=encodeColor(this._colors,e,o)):a.blend=!1,a}}function encodeColor(i,e,s){const{byLayer:o,byAlpha:a}=i;let d,g=o.get(e);return g?(g.viewports.push(s),d=g.a):(d=o.size+1,d<=255?(g={a:d,layer:e,viewports:[s]},o.set(e,g),a[d]=g):(log.warn("Too many pickable layers, only picking the first 255")(),d=0)),[0,0,0,d/255]}function decodeColor(i,e){const s=i.byAlpha[e[3]];return s&&{pickedLayer:s.layer,pickedViewports:s.viewports,pickedObjectIndex:s.layer.decodePickingColor(e)}}const TRACE_RENDER_LAYERS="deckRenderer.renderLayers";class DeckRenderer{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new DrawLayersPass(e),this.pickLayersPass=new PickLayersPass(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const s=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||Framebuffer.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const o=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,a=s.render({...e,target:o});this._postRender(e.effects,e),this.renderCount++,debug(TRACE_RENDER_LAYERS,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const s=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),s}finalize(){const{renderBuffers:e}=this;for(const s of e)s.delete();e.length=0}_preRender(e,s){let o=null;for(const a of e)a.preRender(this.gl,s),a.postRender&&(o=a);o&&this._resizeRenderBuffers(),this.lastPostProcessEffect=o}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Framebuffer(this.gl),new Framebuffer(this.gl));for(const s of e)s.resize()}_postRender(e,s){const{renderBuffers:o}=this,a={inputBuffer:o[0],swapBuffer:o[1],target:null};for(const d of e)if(d.postRender){if(d===this.lastPostProcessEffect){a.target=s.target,d.postRender(this.gl,a);break}const g=d.postRender(this.gl,a);a.inputBuffer=g,a.swapBuffer=g===o[0]?o[1]:o[0]}}}const NO_PICKED_OBJECT={pickedColor:null,pickedObjectIndex:-1};function getClosestObject({pickedColors:i,decodePickingColor:e,deviceX:s,deviceY:o,deviceRadius:a,deviceRect:d}){const{x:g,y:_,width:j,height:_e}=d;let et=a*a,tt=-1,rt=0;for(let it=0;it<_e;it++){const ot=it+_-o,ct=ot*ot;if(ct>et)rt+=4*j;else for(let ft=0;ft<j;ft++){if(i[rt+3]-1>=0){const pt=ft+g-s,gt=pt*pt+ct;gt<=et&&(et=gt,tt=rt)}rt+=4}}if(tt>=0){const it=i.slice(tt,tt+4),ot=e(it);if(ot){const ct=Math.floor(tt/4/j),ft=tt/4-ct*j;return{...ot,pickedColor:it,pickedX:g+ft,pickedY:_+ct}}log.error("Picked non-existent layer. Is picking buffer corrupt?")()}return NO_PICKED_OBJECT}function getUniqueObjects({pickedColors:i,decodePickingColor:e}){const s=new Map;if(i){for(let o=0;o<i.length;o+=4)if(i[o+3]-1>=0){const d=i.slice(o,o+4),g=d.join(",");if(!s.has(g)){const _=e(d);_?s.set(g,{..._,color:d}):log.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(s.values())}function getEmptyPickingInfo({pickInfo:i,viewports:e,pixelRatio:s,x:o,y:a,z:d}){let g=e[0];e.length>1&&(g=getViewportFromCoordinates((i==null?void 0:i.pickedViewports)||e,{x:o,y:a}));let _;if(g){const j=[o-g.x,a-g.y];d!==void 0&&(j[2]=d),_=g.unproject(j)}return{color:null,layer:null,viewport:g,index:-1,picked:!1,x:o,y:a,pixel:[o,a],coordinate:_,devicePixel:i&&"pickedX"in i?[i.pickedX,i.pickedY]:void 0,pixelRatio:s}}function processPickInfo(i){const{pickInfo:e,lastPickedInfo:s,mode:o,layers:a}=i,{pickedColor:d,pickedLayer:g,pickedObjectIndex:_}=e,j=g?[g]:[];if(o==="hover"){const tt=s.index,rt=s.layerId,it=g?g.props.id:null;if(it!==rt||_!==tt){if(it!==rt){const ot=a.find(ct=>ct.props.id===rt);ot&&j.unshift(ot)}s.layerId=it,s.index=_,s.info=null}}const _e=getEmptyPickingInfo(i),et=new Map;return et.set(null,_e),j.forEach(tt=>{let rt={..._e};tt===g&&(rt.color=d,rt.index=_,rt.picked=!0),rt=getLayerPickingInfo({layer:tt,info:rt,mode:o});const it=rt.layer;tt===g&&o==="hover"&&(s.info=rt),et.set(it.id,rt),o==="hover"&&it.updateAutoHighlight(rt)}),et}function getLayerPickingInfo({layer:i,info:e,mode:s}){for(;i&&e;){const o=e.layer||null;e.sourceLayer=o,e.layer=i,e=i.getPickingInfo({info:e,mode:s,sourceLayer:o}),i=i.parent}return e}function getViewportFromCoordinates(i,e){for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.containsPixel(e))return o}return i[0]}class DeckPicker{constructor(e){_defineProperty(this,"gl",void 0),_defineProperty(this,"pickingFBO",void 0),_defineProperty(this,"depthFBO",void 0),_defineProperty(this,"pickLayersPass",void 0),_defineProperty(this,"layerFilter",void 0),_defineProperty(this,"lastPickedInfo",void 0),_defineProperty(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new PickLayersPass(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:s,layers:o,viewports:a},d=this.lastPickedInfo.info){const g=d&&d.layer&&d.layer.id,_=d&&d.viewport&&d.viewport.id,j=g?o.find(rt=>rt.id===g):null,_e=_&&a.find(rt=>rt.id===_)||a[0],et=_e&&_e.unproject([e-_e.x,s-_e.y]);return{...d,...{x:e,y:s,viewport:_e,coordinate:et,layer:j}}}_resizeBuffer(){var e,s;const{gl:o}=this;if(!this.pickingFBO&&(this.pickingFBO=new Framebuffer(o),Framebuffer.isSupported(o,{colorBufferFloat:!0}))){const a=new Framebuffer(o);a.attach({[36064]:new Texture2D(o,{format:isWebGL2$1(o)?34836:6408,type:5126})}),this.depthFBO=a}(e=this.pickingFBO)===null||e===void 0||e.resize({width:o.canvas.width,height:o.canvas.height}),(s=this.depthFBO)===null||s===void 0||s.resize({width:o.canvas.width,height:o.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const s=e.filter(o=>o.isPickable()&&!o.isComposite);return s.length?s:null}_pickClosestObject({layers:e,views:s,viewports:o,x:a,y:d,radius:g=0,depth:_=1,mode:j="query",unproject3D:_e,onViewportActive:et,effects:tt}){const rt=this._getPickable(e),it=cssToDeviceRatio(this.gl);if(!rt)return{result:[],emptyInfo:getEmptyPickingInfo({viewports:o,x:a,y:d,pixelRatio:it})};this._resizeBuffer();const ot=cssToDevicePixels(this.gl,[a,d],!0),ct=[ot.x+Math.floor(ot.width/2),ot.y+Math.floor(ot.height/2)],ft=Math.round(g*it),{width:dt,height:pt}=this.pickingFBO,gt=this._getPickingRect({deviceX:ct[0],deviceY:ct[1],deviceRadius:ft,deviceWidth:dt,deviceHeight:pt}),Ct={x:a-g,y:d-g,width:g*2+1,height:g*2+1};let xt;const at=[],Bt=new Set;for(let Ht=0;Ht<_;Ht++){let sr;if(gt){const hr=this._drawAndSample({layers:rt,views:s,viewports:o,onViewportActive:et,deviceRect:gt,cullRect:Ct,effects:tt,pass:"picking:".concat(j)});sr=getClosestObject({...hr,deviceX:ct[0],deviceY:ct[1],deviceRadius:ft,deviceRect:gt})}else sr={pickedColor:null,pickedObjectIndex:-1};let mr;sr.pickedLayer&&_e&&this.depthFBO&&(mr=this._drawAndSample({layers:[sr.pickedLayer],views:s,viewports:o,onViewportActive:et,deviceRect:{x:sr.pickedX,y:sr.pickedY,width:1,height:1},cullRect:Ct,effects:tt,pass:"picking:".concat(j,":z")},!0).pickedColors[0]),sr.pickedLayer&&Ht+1<_&&(Bt.add(sr.pickedLayer),sr.pickedLayer.disablePickingIndex(sr.pickedObjectIndex)),xt=processPickInfo({pickInfo:sr,lastPickedInfo:this.lastPickedInfo,mode:j,layers:rt,viewports:o,x:a,y:d,z:mr,pixelRatio:it});for(const hr of xt.values())hr.layer&&at.push(hr);if(!sr.pickedColor)break}for(const Ht of Bt)Ht.restorePickingColors();return{result:at,emptyInfo:xt.get(null)}}_pickVisibleObjects({layers:e,views:s,viewports:o,x:a,y:d,width:g=1,height:_=1,mode:j="query",maxObjects:_e=null,onViewportActive:et,effects:tt}){const rt=this._getPickable(e);if(!rt)return[];this._resizeBuffer();const it=cssToDeviceRatio(this.gl),ot=cssToDevicePixels(this.gl,[a,d],!0),ct=ot.x,ft=ot.y+ot.height,dt=cssToDevicePixels(this.gl,[a+g,d+_],!0),pt=dt.x+dt.width,gt=dt.y,Ct={x:ct,y:gt,width:pt-ct,height:ft-gt},xt=this._drawAndSample({layers:rt,views:s,viewports:o,onViewportActive:et,deviceRect:Ct,cullRect:{x:a,y:d,width:g,height:_},effects:tt,pass:"picking:".concat(j)}),at=getUniqueObjects(xt),Bt=new Map,Ht=Number.isFinite(_e);for(let sr=0;sr<at.length&&!(Ht&&_e&&Bt.size>=_e);sr++){const mr=at[sr];let hr={color:mr.pickedColor,layer:null,index:mr.pickedObjectIndex,picked:!0,x:a,y:d,pixelRatio:it};hr=getLayerPickingInfo({layer:mr.pickedLayer,info:hr,mode:j}),Bt.has(hr.object)||Bt.set(hr.object,hr)}return Array.from(Bt.values())}_drawAndSample({layers:e,views:s,viewports:o,onViewportActive:a,deviceRect:d,cullRect:g,effects:_,pass:j},_e=!1){const et=_e?this.depthFBO:this.pickingFBO,{decodePickingColor:tt}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:s,viewports:o,onViewportActive:a,pickingFBO:et,deviceRect:d,cullRect:g,effects:_,pass:j,pickZ:_e}),{x:rt,y:it,width:ot,height:ct}=d,ft=new(_e?Float32Array:Uint8Array)(ot*ct*4);return readPixelsToArray(et,{sourceX:rt,sourceY:it,sourceWidth:ot,sourceHeight:ct,target:ft}),{pickedColors:ft,decodePickingColor:tt}}_getPickingRect({deviceX:e,deviceY:s,deviceRadius:o,deviceWidth:a,deviceHeight:d}){const g=Math.max(0,e-o),_=Math.max(0,s-o),j=Math.min(a,e+o+1)-g,_e=Math.min(d,s+o+1)-_;return j<=0||_e<=0?null:{x:g,y:_,width:j,height:_e}}}const defaultStyle={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Tooltip{constructor(e){_defineProperty(this,"el",null),_defineProperty(this,"isVisible",!1);const s=e.parentElement;s&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,defaultStyle),s.appendChild(this.el))}setTooltip(e,s,o){const a=this.el;if(a){if(typeof e=="string")a.innerText=e;else if(e)e.text&&(a.innerText=e.text),e.html&&(a.innerHTML=e.html),e.className&&(a.className=e.className),Object.assign(a.style,e.style);else{this.isVisible=!1,a.style.display="none";return}this.isVisible=!0,a.style.display="block",a.style.transform="translate(".concat(s,"px, ").concat(o,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var hammerExports={},hammer$1={get exports(){return hammerExports},set exports(i){hammerExports=i}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(e,s,o,a){var d=["","webkit","Moz","MS","ms","o"],g=s.createElement("div"),_="function",j=Math.round,_e=Math.abs,et=Date.now;function tt(Et,Rt,Ft){return setTimeout(gt(Et,Ft),Rt)}function rt(Et,Rt,Ft){return Array.isArray(Et)?(it(Et,Ft[Rt],Ft),!0):!1}function it(Et,Rt,Ft){var or;if(Et)if(Et.forEach)Et.forEach(Rt,Ft);else if(Et.length!==a)for(or=0;or<Et.length;)Rt.call(Ft,Et[or],or,Et),or++;else for(or in Et)Et.hasOwnProperty(or)&&Rt.call(Ft,Et[or],or,Et)}function ot(Et,Rt,Ft){var or="DEPRECATED METHOD: "+Rt+`
`+Ft+` AT 
`;return function(){var Gr=new Error("get-stack-trace"),Sn=Gr&&Gr.stack?Gr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Dt=e.console&&(e.console.warn||e.console.log);return Dt&&Dt.call(e.console,or,Sn),Et.apply(this,arguments)}}var ct;typeof Object.assign!="function"?ct=function(Rt){if(Rt===a||Rt===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ft=Object(Rt),or=1;or<arguments.length;or++){var Gr=arguments[or];if(Gr!==a&&Gr!==null)for(var Sn in Gr)Gr.hasOwnProperty(Sn)&&(Ft[Sn]=Gr[Sn])}return Ft}:ct=Object.assign;var ft=ot(function(Rt,Ft,or){for(var Gr=Object.keys(Ft),Sn=0;Sn<Gr.length;)(!or||or&&Rt[Gr[Sn]]===a)&&(Rt[Gr[Sn]]=Ft[Gr[Sn]]),Sn++;return Rt},"extend","Use `assign`."),dt=ot(function(Rt,Ft){return ft(Rt,Ft,!0)},"merge","Use `assign`.");function pt(Et,Rt,Ft){var or=Rt.prototype,Gr;Gr=Et.prototype=Object.create(or),Gr.constructor=Et,Gr._super=or,Ft&&ct(Gr,Ft)}function gt(Et,Rt){return function(){return Et.apply(Rt,arguments)}}function Ct(Et,Rt){return typeof Et==_?Et.apply(Rt&&Rt[0]||a,Rt):Et}function xt(Et,Rt){return Et===a?Rt:Et}function at(Et,Rt,Ft){it(mr(Rt),function(or){Et.addEventListener(or,Ft,!1)})}function Bt(Et,Rt,Ft){it(mr(Rt),function(or){Et.removeEventListener(or,Ft,!1)})}function Ht(Et,Rt){for(;Et;){if(Et==Rt)return!0;Et=Et.parentNode}return!1}function sr(Et,Rt){return Et.indexOf(Rt)>-1}function mr(Et){return Et.trim().split(/\s+/g)}function hr(Et,Rt,Ft){if(Et.indexOf&&!Ft)return Et.indexOf(Rt);for(var or=0;or<Et.length;){if(Ft&&Et[or][Ft]==Rt||!Ft&&Et[or]===Rt)return or;or++}return-1}function Er(Et){return Array.prototype.slice.call(Et,0)}function Lr(Et,Rt,Ft){for(var or=[],Gr=[],Sn=0;Sn<Et.length;){var Dt=Rt?Et[Sn][Rt]:Et[Sn];hr(Gr,Dt)<0&&or.push(Et[Sn]),Gr[Sn]=Dt,Sn++}return Ft&&(Rt?or=or.sort(function(rr,kr){return rr[Rt]>kr[Rt]}):or=or.sort()),or}function sn(Et,Rt){for(var Ft,or,Gr=Rt[0].toUpperCase()+Rt.slice(1),Sn=0;Sn<d.length;){if(Ft=d[Sn],or=Ft?Ft+Gr:Rt,or in Et)return or;Sn++}return a}var vr=1;function Zr(){return vr++}function Hr(Et){var Rt=Et.ownerDocument||Et;return Rt.defaultView||Rt.parentWindow||e}var cr=/mobile|tablet|ip(ad|hone|od)|android/i,lr="ontouchstart"in e,Fr=sn(e,"PointerEvent")!==a,an=lr&&cr.test(navigator.userAgent),kn="touch",ms="pen",Zn="mouse",As="kinect",Rs=25,Gn=1,dn=2,xr=4,Yr=8,Rn=1,Ln=2,pr=4,nn=8,mn=16,Vr=Ln|pr,Mr=nn|mn,Cn=Vr|Mr,is=["x","y"],ts=["clientX","clientY"];function Qn(Et,Rt){var Ft=this;this.manager=Et,this.callback=Rt,this.element=Et.element,this.target=Et.options.inputTarget,this.domHandler=function(or){Ct(Et.options.enable,[Et])&&Ft.handler(or)},this.init()}Qn.prototype={handler:function(){},init:function(){this.evEl&&at(this.element,this.evEl,this.domHandler),this.evTarget&&at(this.target,this.evTarget,this.domHandler),this.evWin&&at(Hr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Bt(this.element,this.evEl,this.domHandler),this.evTarget&&Bt(this.target,this.evTarget,this.domHandler),this.evWin&&Bt(Hr(this.element),this.evWin,this.domHandler)}};function Xs(Et){var Rt,Ft=Et.options.inputClass;return Ft?Rt=Ft:Fr?Rt=wo:an?Rt=ga:lr?Rt=Il:Rt=Ss,new Rt(Et,bt)}function bt(Et,Rt,Ft){var or=Ft.pointers.length,Gr=Ft.changedPointers.length,Sn=Rt&Gn&&or-Gr===0,Dt=Rt&(xr|Yr)&&or-Gr===0;Ft.isFirst=!!Sn,Ft.isFinal=!!Dt,Sn&&(Et.session={}),Ft.eventType=Rt,gs(Et,Ft),Et.emit("hammer.input",Ft),Et.recognize(Ft),Et.session.prevInput=Ft}function gs(Et,Rt){var Ft=Et.session,or=Rt.pointers,Gr=or.length;Ft.firstInput||(Ft.firstInput=Ot(Rt)),Gr>1&&!Ft.firstMultiple?Ft.firstMultiple=Ot(Rt):Gr===1&&(Ft.firstMultiple=!1);var Sn=Ft.firstInput,Dt=Ft.firstMultiple,Wt=Dt?Dt.center:Sn.center,rr=Rt.center=_t(or);Rt.timeStamp=et(),Rt.deltaTime=Rt.timeStamp-Sn.timeStamp,Rt.angle=zn(Wt,rr),Rt.distance=ln(Wt,rr),xs(Ft,Rt),Rt.offsetDirection=en(Rt.deltaX,Rt.deltaY);var kr=Ir(Rt.deltaTime,Rt.deltaX,Rt.deltaY);Rt.overallVelocityX=kr.x,Rt.overallVelocityY=kr.y,Rt.overallVelocity=_e(kr.x)>_e(kr.y)?kr.x:kr.y,Rt.scale=Dt?ys(Dt.pointers,or):1,Rt.rotation=Dt?jn(Dt.pointers,or):0,Rt.maxPointers=Ft.prevInput?Rt.pointers.length>Ft.prevInput.maxPointers?Rt.pointers.length:Ft.prevInput.maxPointers:Rt.pointers.length,Ls(Ft,Rt);var fn=Et.element;Ht(Rt.srcEvent.target,fn)&&(fn=Rt.srcEvent.target),Rt.target=fn}function xs(Et,Rt){var Ft=Rt.center,or=Et.offsetDelta||{},Gr=Et.prevDelta||{},Sn=Et.prevInput||{};(Rt.eventType===Gn||Sn.eventType===xr)&&(Gr=Et.prevDelta={x:Sn.deltaX||0,y:Sn.deltaY||0},or=Et.offsetDelta={x:Ft.x,y:Ft.y}),Rt.deltaX=Gr.x+(Ft.x-or.x),Rt.deltaY=Gr.y+(Ft.y-or.y)}function Ls(Et,Rt){var Ft=Et.lastInterval||Rt,or=Rt.timeStamp-Ft.timeStamp,Gr,Sn,Dt,Wt;if(Rt.eventType!=Yr&&(or>Rs||Ft.velocity===a)){var rr=Rt.deltaX-Ft.deltaX,kr=Rt.deltaY-Ft.deltaY,fn=Ir(or,rr,kr);Sn=fn.x,Dt=fn.y,Gr=_e(fn.x)>_e(fn.y)?fn.x:fn.y,Wt=en(rr,kr),Et.lastInterval=Rt}else Gr=Ft.velocity,Sn=Ft.velocityX,Dt=Ft.velocityY,Wt=Ft.direction;Rt.velocity=Gr,Rt.velocityX=Sn,Rt.velocityY=Dt,Rt.direction=Wt}function Ot(Et){for(var Rt=[],Ft=0;Ft<Et.pointers.length;)Rt[Ft]={clientX:j(Et.pointers[Ft].clientX),clientY:j(Et.pointers[Ft].clientY)},Ft++;return{timeStamp:et(),pointers:Rt,center:_t(Rt),deltaX:Et.deltaX,deltaY:Et.deltaY}}function _t(Et){var Rt=Et.length;if(Rt===1)return{x:j(Et[0].clientX),y:j(Et[0].clientY)};for(var Ft=0,or=0,Gr=0;Gr<Rt;)Ft+=Et[Gr].clientX,or+=Et[Gr].clientY,Gr++;return{x:j(Ft/Rt),y:j(or/Rt)}}function Ir(Et,Rt,Ft){return{x:Rt/Et||0,y:Ft/Et||0}}function en(Et,Rt){return Et===Rt?Rn:_e(Et)>=_e(Rt)?Et<0?Ln:pr:Rt<0?nn:mn}function ln(Et,Rt,Ft){Ft||(Ft=is);var or=Rt[Ft[0]]-Et[Ft[0]],Gr=Rt[Ft[1]]-Et[Ft[1]];return Math.sqrt(or*or+Gr*Gr)}function zn(Et,Rt,Ft){Ft||(Ft=is);var or=Rt[Ft[0]]-Et[Ft[0]],Gr=Rt[Ft[1]]-Et[Ft[1]];return Math.atan2(Gr,or)*180/Math.PI}function jn(Et,Rt){return zn(Rt[1],Rt[0],ts)+zn(Et[1],Et[0],ts)}function ys(Et,Rt){return ln(Rt[0],Rt[1],ts)/ln(Et[0],Et[1],ts)}var Bn={mousedown:Gn,mousemove:dn,mouseup:xr},cs="mousedown",hs="mousemove mouseup";function Ss(){this.evEl=cs,this.evWin=hs,this.pressed=!1,Qn.apply(this,arguments)}pt(Ss,Qn,{handler:function(Rt){var Ft=Bn[Rt.type];Ft&Gn&&Rt.button===0&&(this.pressed=!0),Ft&dn&&Rt.which!==1&&(Ft=xr),this.pressed&&(Ft&xr&&(this.pressed=!1),this.callback(this.manager,Ft,{pointers:[Rt],changedPointers:[Rt],pointerType:Zn,srcEvent:Rt}))}});var us={pointerdown:Gn,pointermove:dn,pointerup:xr,pointercancel:Yr,pointerout:Yr},Hs={2:kn,3:ms,4:Zn,5:As},Ps="pointerdown",Ns="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ps="MSPointerDown",Ns="MSPointerMove MSPointerUp MSPointerCancel");function wo(){this.evEl=Ps,this.evWin=Ns,Qn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pt(wo,Qn,{handler:function(Rt){var Ft=this.store,or=!1,Gr=Rt.type.toLowerCase().replace("ms",""),Sn=us[Gr],Dt=Hs[Rt.pointerType]||Rt.pointerType,Wt=Dt==kn,rr=hr(Ft,Rt.pointerId,"pointerId");Sn&Gn&&(Rt.button===0||Wt)?rr<0&&(Ft.push(Rt),rr=Ft.length-1):Sn&(xr|Yr)&&(or=!0),!(rr<0)&&(Ft[rr]=Rt,this.callback(this.manager,Sn,{pointers:Ft,changedPointers:[Rt],pointerType:Dt,srcEvent:Rt}),or&&Ft.splice(rr,1))}});var Co={touchstart:Gn,touchmove:dn,touchend:xr,touchcancel:Yr},Jo="touchstart",na="touchstart touchmove touchend touchcancel";function js(){this.evTarget=Jo,this.evWin=na,this.started=!1,Qn.apply(this,arguments)}pt(js,Qn,{handler:function(Rt){var Ft=Co[Rt.type];if(Ft===Gn&&(this.started=!0),!!this.started){var or=_u.call(this,Rt,Ft);Ft&(xr|Yr)&&or[0].length-or[1].length===0&&(this.started=!1),this.callback(this.manager,Ft,{pointers:or[0],changedPointers:or[1],pointerType:kn,srcEvent:Rt})}}});function _u(Et,Rt){var Ft=Er(Et.touches),or=Er(Et.changedTouches);return Rt&(xr|Yr)&&(Ft=Lr(Ft.concat(or),"identifier",!0)),[Ft,or]}var Po={touchstart:Gn,touchmove:dn,touchend:xr,touchcancel:Yr},yu="touchstart touchmove touchend touchcancel";function ga(){this.evTarget=yu,this.targetIds={},Qn.apply(this,arguments)}pt(ga,Qn,{handler:function(Rt){var Ft=Po[Rt.type],or=wu.call(this,Rt,Ft);or&&this.callback(this.manager,Ft,{pointers:or[0],changedPointers:or[1],pointerType:kn,srcEvent:Rt})}});function wu(Et,Rt){var Ft=Er(Et.touches),or=this.targetIds;if(Rt&(Gn|dn)&&Ft.length===1)return or[Ft[0].identifier]=!0,[Ft,Ft];var Gr,Sn,Dt=Er(Et.changedTouches),Wt=[],rr=this.target;if(Sn=Ft.filter(function(kr){return Ht(kr.target,rr)}),Rt===Gn)for(Gr=0;Gr<Sn.length;)or[Sn[Gr].identifier]=!0,Gr++;for(Gr=0;Gr<Dt.length;)or[Dt[Gr].identifier]&&Wt.push(Dt[Gr]),Rt&(xr|Yr)&&delete or[Dt[Gr].identifier],Gr++;if(Wt.length)return[Lr(Sn.concat(Wt),"identifier",!0),Wt]}var Eu=2500,Kl=25;function Il(){Qn.apply(this,arguments);var Et=gt(this.handler,this);this.touch=new ga(this.manager,Et),this.mouse=new Ss(this.manager,Et),this.primaryTouch=null,this.lastTouches=[]}pt(Il,Qn,{handler:function(Rt,Ft,or){var Gr=or.pointerType==kn,Sn=or.pointerType==Zn;if(!(Sn&&or.sourceCapabilities&&or.sourceCapabilities.firesTouchEvents)){if(Gr)ko.call(this,Ft,or);else if(Sn&&ks.call(this,or))return;this.callback(Rt,Ft,or)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ko(Et,Rt){Et&Gn?(this.primaryTouch=Rt.changedPointers[0].identifier,_a.call(this,Rt)):Et&(xr|Yr)&&_a.call(this,Rt)}function _a(Et){var Rt=Et.changedPointers[0];if(Rt.identifier===this.primaryTouch){var Ft={x:Rt.clientX,y:Rt.clientY};this.lastTouches.push(Ft);var or=this.lastTouches,Gr=function(){var Sn=or.indexOf(Ft);Sn>-1&&or.splice(Sn,1)};setTimeout(Gr,Eu)}}function ks(Et){for(var Rt=Et.srcEvent.clientX,Ft=Et.srcEvent.clientY,or=0;or<this.lastTouches.length;or++){var Gr=this.lastTouches[or],Sn=Math.abs(Rt-Gr.x),Dt=Math.abs(Ft-Gr.y);if(Sn<=Kl&&Dt<=Kl)return!0}return!1}var Ol=sn(g.style,"touchAction"),Cl=Ol!==a,Nl="compute",nu="auto",Fl="manipulation",Mo="none",Eo="pan-x",Ho="pan-y",bo=bu();function $l(Et,Rt){this.manager=Et,this.set(Rt)}$l.prototype={set:function(Et){Et==Nl&&(Et=this.compute()),Cl&&this.manager.element.style&&bo[Et]&&(this.manager.element.style[Ol]=Et),this.actions=Et.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Et=[];return it(this.manager.recognizers,function(Rt){Ct(Rt.options.enable,[Rt])&&(Et=Et.concat(Rt.getTouchAction()))}),Zl(Et.join(" "))},preventDefaults:function(Et){var Rt=Et.srcEvent,Ft=Et.offsetDirection;if(this.manager.session.prevented){Rt.preventDefault();return}var or=this.actions,Gr=sr(or,Mo)&&!bo[Mo],Sn=sr(or,Ho)&&!bo[Ho],Dt=sr(or,Eo)&&!bo[Eo];if(Gr){var Wt=Et.pointers.length===1,rr=Et.distance<2,kr=Et.deltaTime<250;if(Wt&&rr&&kr)return}if(!(Dt&&Sn)&&(Gr||Sn&&Ft&Vr||Dt&&Ft&Mr))return this.preventSrc(Rt)},preventSrc:function(Et){this.manager.session.prevented=!0,Et.preventDefault()}};function Zl(Et){if(sr(Et,Mo))return Mo;var Rt=sr(Et,Eo),Ft=sr(Et,Ho);return Rt&&Ft?Mo:Rt||Ft?Rt?Eo:Ho:sr(Et,Fl)?Fl:nu}function bu(){if(!Cl)return!1;var Et={},Rt=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ft){Et[Ft]=Rt?e.CSS.supports("touch-action",Ft):!0}),Et}var ba=1,go=2,Fo=4,xo=8,Ao=xo,jo=16,So=32;function Bs(Et){this.options=ct({},this.defaults,Et||{}),this.id=Zr(),this.manager=null,this.options.enable=xt(this.options.enable,!0),this.state=ba,this.simultaneous={},this.requireFail=[]}Bs.prototype={defaults:{},set:function(Et){return ct(this.options,Et),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Et){if(rt(Et,"recognizeWith",this))return this;var Rt=this.simultaneous;return Et=$o(Et,this),Rt[Et.id]||(Rt[Et.id]=Et,Et.recognizeWith(this)),this},dropRecognizeWith:function(Et){return rt(Et,"dropRecognizeWith",this)?this:(Et=$o(Et,this),delete this.simultaneous[Et.id],this)},requireFailure:function(Et){if(rt(Et,"requireFailure",this))return this;var Rt=this.requireFail;return Et=$o(Et,this),hr(Rt,Et)===-1&&(Rt.push(Et),Et.requireFailure(this)),this},dropRequireFailure:function(Et){if(rt(Et,"dropRequireFailure",this))return this;Et=$o(Et,this);var Rt=hr(this.requireFail,Et);return Rt>-1&&this.requireFail.splice(Rt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Et){return!!this.simultaneous[Et.id]},emit:function(Et){var Rt=this,Ft=this.state;function or(Gr){Rt.manager.emit(Gr,Et)}Ft<xo&&or(Rt.options.event+Do(Ft)),or(Rt.options.event),Et.additionalEvent&&or(Et.additionalEvent),Ft>=xo&&or(Rt.options.event+Do(Ft))},tryEmit:function(Et){if(this.canEmit())return this.emit(Et);this.state=So},canEmit:function(){for(var Et=0;Et<this.requireFail.length;){if(!(this.requireFail[Et].state&(So|ba)))return!1;Et++}return!0},recognize:function(Et){var Rt=ct({},Et);if(!Ct(this.options.enable,[this,Rt])){this.reset(),this.state=So;return}this.state&(Ao|jo|So)&&(this.state=ba),this.state=this.process(Rt),this.state&(go|Fo|xo|jo)&&this.tryEmit(Rt)},process:function(Et){},getTouchAction:function(){},reset:function(){}};function Do(Et){return Et&jo?"cancel":Et&xo?"end":Et&Fo?"move":Et&go?"start":""}function Al(Et){return Et==mn?"down":Et==nn?"up":Et==Ln?"left":Et==pr?"right":""}function $o(Et,Rt){var Ft=Rt.manager;return Ft?Ft.get(Et):Et}function _s(){Bs.apply(this,arguments)}pt(_s,Bs,{defaults:{pointers:1},attrTest:function(Et){var Rt=this.options.pointers;return Rt===0||Et.pointers.length===Rt},process:function(Et){var Rt=this.state,Ft=Et.eventType,or=Rt&(go|Fo),Gr=this.attrTest(Et);return or&&(Ft&Yr||!Gr)?Rt|jo:or||Gr?Ft&xr?Rt|xo:Rt&go?Rt|Fo:go:So}});function Io(){_s.apply(this,arguments),this.pX=null,this.pY=null}pt(Io,_s,{defaults:{event:"pan",threshold:10,pointers:1,direction:Cn},getTouchAction:function(){var Et=this.options.direction,Rt=[];return Et&Vr&&Rt.push(Ho),Et&Mr&&Rt.push(Eo),Rt},directionTest:function(Et){var Rt=this.options,Ft=!0,or=Et.distance,Gr=Et.direction,Sn=Et.deltaX,Dt=Et.deltaY;return Gr&Rt.direction||(Rt.direction&Vr?(Gr=Sn===0?Rn:Sn<0?Ln:pr,Ft=Sn!=this.pX,or=Math.abs(Et.deltaX)):(Gr=Dt===0?Rn:Dt<0?nn:mn,Ft=Dt!=this.pY,or=Math.abs(Et.deltaY))),Et.direction=Gr,Ft&&or>Rt.threshold&&Gr&Rt.direction},attrTest:function(Et){return _s.prototype.attrTest.call(this,Et)&&(this.state&go||!(this.state&go)&&this.directionTest(Et))},emit:function(Et){this.pX=Et.deltaX,this.pY=Et.deltaY;var Rt=Al(Et.direction);Rt&&(Et.additionalEvent=this.options.event+Rt),this._super.emit.call(this,Et)}});function xa(){_s.apply(this,arguments)}pt(xa,_s,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Mo]},attrTest:function(Et){return this._super.attrTest.call(this,Et)&&(Math.abs(Et.scale-1)>this.options.threshold||this.state&go)},emit:function(Et){if(Et.scale!==1){var Rt=Et.scale<1?"in":"out";Et.additionalEvent=this.options.event+Rt}this._super.emit.call(this,Et)}});function Wo(){Bs.apply(this,arguments),this._timer=null,this._input=null}pt(Wo,Bs,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[nu]},process:function(Et){var Rt=this.options,Ft=Et.pointers.length===Rt.pointers,or=Et.distance<Rt.threshold,Gr=Et.deltaTime>Rt.time;if(this._input=Et,!or||!Ft||Et.eventType&(xr|Yr)&&!Gr)this.reset();else if(Et.eventType&Gn)this.reset(),this._timer=tt(function(){this.state=Ao,this.tryEmit()},Rt.time,this);else if(Et.eventType&xr)return Ao;return So},reset:function(){clearTimeout(this._timer)},emit:function(Et){this.state===Ao&&(Et&&Et.eventType&xr?this.manager.emit(this.options.event+"up",Et):(this._input.timeStamp=et(),this.manager.emit(this.options.event,this._input)))}});function Bo(){_s.apply(this,arguments)}pt(Bo,_s,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Mo]},attrTest:function(Et){return this._super.attrTest.call(this,Et)&&(Math.abs(Et.rotation)>this.options.threshold||this.state&go)}});function Bl(){_s.apply(this,arguments)}pt(Bl,_s,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Vr|Mr,pointers:1},getTouchAction:function(){return Io.prototype.getTouchAction.call(this)},attrTest:function(Et){var Rt=this.options.direction,Ft;return Rt&(Vr|Mr)?Ft=Et.overallVelocity:Rt&Vr?Ft=Et.overallVelocityX:Rt&Mr&&(Ft=Et.overallVelocityY),this._super.attrTest.call(this,Et)&&Rt&Et.offsetDirection&&Et.distance>this.options.threshold&&Et.maxPointers==this.options.pointers&&_e(Ft)>this.options.velocity&&Et.eventType&xr},emit:function(Et){var Rt=Al(Et.offsetDirection);Rt&&this.manager.emit(this.options.event+Rt,Et),this.manager.emit(this.options.event,Et)}});function $a(){Bs.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pt($a,Bs,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Fl]},process:function(Et){var Rt=this.options,Ft=Et.pointers.length===Rt.pointers,or=Et.distance<Rt.threshold,Gr=Et.deltaTime<Rt.time;if(this.reset(),Et.eventType&Gn&&this.count===0)return this.failTimeout();if(or&&Gr&&Ft){if(Et.eventType!=xr)return this.failTimeout();var Sn=this.pTime?Et.timeStamp-this.pTime<Rt.interval:!0,Dt=!this.pCenter||ln(this.pCenter,Et.center)<Rt.posThreshold;this.pTime=Et.timeStamp,this.pCenter=Et.center,!Dt||!Sn?this.count=1:this.count+=1,this._input=Et;var Wt=this.count%Rt.taps;if(Wt===0)return this.hasRequireFailures()?(this._timer=tt(function(){this.state=Ao,this.tryEmit()},Rt.interval,this),go):Ao}return So},failTimeout:function(){return this._timer=tt(function(){this.state=So},this.options.interval,this),So},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ao&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ms(Et,Rt){return Rt=Rt||{},Rt.recognizers=xt(Rt.recognizers,Ms.defaults.preset),new Yo(Et,Rt)}Ms.VERSION="2.0.7",Ms.defaults={domEvents:!1,touchAction:Nl,enable:!0,inputTarget:null,inputClass:null,preset:[[Bo,{enable:!1}],[xa,{enable:!1},["rotate"]],[Bl,{direction:Vr}],[Io,{direction:Vr},["swipe"]],[$a],[$a,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Xo=1,Oo=2;function Yo(Et,Rt){this.options=ct({},Ms.defaults,Rt||{}),this.options.inputTarget=this.options.inputTarget||Et,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Et,this.input=Xs(this),this.touchAction=new $l(this,this.options.touchAction),zl(this,!0),it(this.options.recognizers,function(Ft){var or=this.add(new Ft[0](Ft[1]));Ft[2]&&or.recognizeWith(Ft[2]),Ft[3]&&or.requireFailure(Ft[3])},this)}Yo.prototype={set:function(Et){return ct(this.options,Et),Et.touchAction&&this.touchAction.update(),Et.inputTarget&&(this.input.destroy(),this.input.target=Et.inputTarget,this.input.init()),this},stop:function(Et){this.session.stopped=Et?Oo:Xo},recognize:function(Et){var Rt=this.session;if(!Rt.stopped){this.touchAction.preventDefaults(Et);var Ft,or=this.recognizers,Gr=Rt.curRecognizer;(!Gr||Gr&&Gr.state&Ao)&&(Gr=Rt.curRecognizer=null);for(var Sn=0;Sn<or.length;)Ft=or[Sn],Rt.stopped!==Oo&&(!Gr||Ft==Gr||Ft.canRecognizeWith(Gr))?Ft.recognize(Et):Ft.reset(),!Gr&&Ft.state&(go|Fo|xo)&&(Gr=Rt.curRecognizer=Ft),Sn++}},get:function(Et){if(Et instanceof Bs)return Et;for(var Rt=this.recognizers,Ft=0;Ft<Rt.length;Ft++)if(Rt[Ft].options.event==Et)return Rt[Ft];return null},add:function(Et){if(rt(Et,"add",this))return this;var Rt=this.get(Et.options.event);return Rt&&this.remove(Rt),this.recognizers.push(Et),Et.manager=this,this.touchAction.update(),Et},remove:function(Et){if(rt(Et,"remove",this))return this;if(Et=this.get(Et),Et){var Rt=this.recognizers,Ft=hr(Rt,Et);Ft!==-1&&(Rt.splice(Ft,1),this.touchAction.update())}return this},on:function(Et,Rt){if(Et!==a&&Rt!==a){var Ft=this.handlers;return it(mr(Et),function(or){Ft[or]=Ft[or]||[],Ft[or].push(Rt)}),this}},off:function(Et,Rt){if(Et!==a){var Ft=this.handlers;return it(mr(Et),function(or){Rt?Ft[or]&&Ft[or].splice(hr(Ft[or],Rt),1):delete Ft[or]}),this}},emit:function(Et,Rt){this.options.domEvents&&qo(Et,Rt);var Ft=this.handlers[Et]&&this.handlers[Et].slice();if(!(!Ft||!Ft.length)){Rt.type=Et,Rt.preventDefault=function(){Rt.srcEvent.preventDefault()};for(var or=0;or<Ft.length;)Ft[or](Rt),or++}},destroy:function(){this.element&&zl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function zl(Et,Rt){var Ft=Et.element;if(Ft.style){var or;it(Et.options.cssProps,function(Gr,Sn){or=sn(Ft.style,Sn),Rt?(Et.oldCssProps[or]=Ft.style[or],Ft.style[or]=Gr):Ft.style[or]=Et.oldCssProps[or]||""}),Rt||(Et.oldCssProps={})}}function qo(Et,Rt){var Ft=s.createEvent("Event");Ft.initEvent(Et,!0,!0),Ft.gesture=Rt,Rt.target.dispatchEvent(Ft)}ct(Ms,{INPUT_START:Gn,INPUT_MOVE:dn,INPUT_END:xr,INPUT_CANCEL:Yr,STATE_POSSIBLE:ba,STATE_BEGAN:go,STATE_CHANGED:Fo,STATE_ENDED:xo,STATE_RECOGNIZED:Ao,STATE_CANCELLED:jo,STATE_FAILED:So,DIRECTION_NONE:Rn,DIRECTION_LEFT:Ln,DIRECTION_RIGHT:pr,DIRECTION_UP:nn,DIRECTION_DOWN:mn,DIRECTION_HORIZONTAL:Vr,DIRECTION_VERTICAL:Mr,DIRECTION_ALL:Cn,Manager:Yo,Input:Qn,TouchAction:$l,TouchInput:ga,MouseInput:Ss,PointerEventInput:wo,TouchMouseInput:Il,SingleTouchInput:js,Recognizer:Bs,AttrRecognizer:_s,Tap:$a,Pan:Io,Swipe:Bl,Pinch:xa,Rotate:Bo,Press:Wo,on:at,off:Bt,each:it,merge:dt,extend:ft,assign:ct,inherit:pt,bindFn:gt,prefixed:sn});var zo=typeof e<"u"?e:typeof self<"u"?self:{};zo.Hammer=Ms,typeof a=="function"&&a.amd?a(function(){return Ms}):i.exports?i.exports=Ms:e[o]=Ms})(window,document,"Hammer")})(hammer$1);const hammer=hammerExports,hammerjs=_mergeNamespaces({__proto__:null,default:hammer},[hammerExports]),INPUT_START=1,INPUT_MOVE=2,INPUT_END=4,MOUSE_INPUT_MAP={mousedown:INPUT_START,mousemove:INPUT_MOVE,mouseup:INPUT_END};function some(i,e){for(let s=0;s<i.length;s++)if(e(i[s]))return!0;return!1}function enhancePointerEventInput(i){const e=i.prototype.handler;i.prototype.handler=function(o){const a=this.store;o.button>0&&o.type==="pointerdown"&&(some(a,d=>d.pointerId===o.pointerId)||a.push(o)),e.call(this,o)}}function enhanceMouseInput(i){i.prototype.handler=function(s){let o=MOUSE_INPUT_MAP[s.type];o&INPUT_START&&s.button>=0&&(this.pressed=!0),o&INPUT_MOVE&&s.which===0&&(o=INPUT_END),this.pressed&&(o&INPUT_END&&(this.pressed=!1),this.callback(this.manager,o,{pointers:[s],changedPointers:[s],pointerType:"mouse",srcEvent:s}))}}enhancePointerEventInput(hammerExports.PointerEventInput);enhanceMouseInput(hammerExports.MouseInput);const Manager=hammerExports.Manager;class Input{constructor(e,s,o){this.element=e,this.callback=s,this.options={enable:!0,...o}}}const RECOGNIZERS=hammerjs?[[hammerjs.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[hammerjs.Rotate,{enable:!1}],[hammerjs.Pinch,{enable:!1}],[hammerjs.Swipe,{enable:!1}],[hammerjs.Pan,{threshold:0,enable:!1}],[hammerjs.Press,{enable:!1}],[hammerjs.Tap,{event:"doubletap",taps:2,enable:!1}],[hammerjs.Tap,{event:"anytap",enable:!1}],[hammerjs.Tap,{enable:!1}]]:null,RECOGNIZER_COMPATIBLE_MAP={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},RECOGNIZER_FALLBACK_MAP={doubletap:["tap"]},BASIC_EVENT_ALIASES={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},INPUT_EVENT_TYPES={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},EVENT_RECOGNIZER_MAP={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},GESTURE_EVENT_ALIASES={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},userAgent=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",window_=typeof window<"u"?window:global;let passiveSupported=!1;try{const i={get passive(){return passiveSupported=!0,!0}};window_.addEventListener("test",null,i),window_.removeEventListener("test",null)}catch(i){passiveSupported=!1}const firefox=userAgent.indexOf("firefox")!==-1,{WHEEL_EVENTS}=INPUT_EVENT_TYPES,EVENT_TYPE$1="wheel",WHEEL_DELTA_MAGIC_SCALER=4.000244140625,WHEEL_DELTA_PER_LINE=40,SHIFT_MULTIPLIER=.25;class WheelInput extends Input{constructor(e,s,o){super(e,s,o),this.handleEvent=a=>{if(!this.options.enable)return;let d=a.deltaY;window_.WheelEvent&&(firefox&&a.deltaMode===window_.WheelEvent.DOM_DELTA_PIXEL&&(d/=window_.devicePixelRatio),a.deltaMode===window_.WheelEvent.DOM_DELTA_LINE&&(d*=WHEEL_DELTA_PER_LINE)),d!==0&&d%WHEEL_DELTA_MAGIC_SCALER===0&&(d=Math.floor(d/WHEEL_DELTA_MAGIC_SCALER)),a.shiftKey&&d&&(d=d*SHIFT_MULTIPLIER),this.callback({type:EVENT_TYPE$1,center:{x:a.clientX,y:a.clientY},delta:-d,srcEvent:a,pointerType:"mouse",target:a.target})},this.events=(this.options.events||[]).concat(WHEEL_EVENTS),this.events.forEach(a=>e.addEventListener(a,this.handleEvent,passiveSupported?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,s){e===EVENT_TYPE$1&&(this.options.enable=s)}}const{MOUSE_EVENTS:MOUSE_EVENTS$1}=INPUT_EVENT_TYPES,MOVE_EVENT_TYPE="pointermove",OVER_EVENT_TYPE="pointerover",OUT_EVENT_TYPE="pointerout",ENTER_EVENT_TYPE="pointerenter",LEAVE_EVENT_TYPE="pointerleave";class MoveInput extends Input{constructor(e,s,o){super(e,s,o),this.handleEvent=d=>{this.handleOverEvent(d),this.handleOutEvent(d),this.handleEnterEvent(d),this.handleLeaveEvent(d),this.handleMoveEvent(d)},this.pressed=!1;const{enable:a}=this.options;this.enableMoveEvent=a,this.enableLeaveEvent=a,this.enableEnterEvent=a,this.enableOutEvent=a,this.enableOverEvent=a,this.events=(this.options.events||[]).concat(MOUSE_EVENTS$1),this.events.forEach(d=>e.addEventListener(d,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,s){e===MOVE_EVENT_TYPE&&(this.enableMoveEvent=s),e===OVER_EVENT_TYPE&&(this.enableOverEvent=s),e===OUT_EVENT_TYPE&&(this.enableOutEvent=s),e===ENTER_EVENT_TYPE&&(this.enableEnterEvent=s),e===LEAVE_EVENT_TYPE&&(this.enableLeaveEvent=s)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(OVER_EVENT_TYPE,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(OUT_EVENT_TYPE,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(ENTER_EVENT_TYPE,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(LEAVE_EVENT_TYPE,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(MOVE_EVENT_TYPE,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,s){this.callback({type:e,center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})}}const{KEY_EVENTS}=INPUT_EVENT_TYPES,DOWN_EVENT_TYPE="keydown",UP_EVENT_TYPE="keyup";class KeyInput extends Input{constructor(e,s,o){super(e,s,o),this.handleEvent=a=>{const d=a.target||a.srcElement;d.tagName==="INPUT"&&d.type==="text"||d.tagName==="TEXTAREA"||(this.enableDownEvent&&a.type==="keydown"&&this.callback({type:DOWN_EVENT_TYPE,srcEvent:a,key:a.key,target:a.target}),this.enableUpEvent&&a.type==="keyup"&&this.callback({type:UP_EVENT_TYPE,srcEvent:a,key:a.key,target:a.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(KEY_EVENTS),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,s){e===DOWN_EVENT_TYPE&&(this.enableDownEvent=s),e===UP_EVENT_TYPE&&(this.enableUpEvent=s)}}const EVENT_TYPE="contextmenu";class ContextmenuInput extends Input{constructor(e,s,o){super(e,s,o),this.handleEvent=a=>{this.options.enable&&this.callback({type:EVENT_TYPE,center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,s){e===EVENT_TYPE&&(this.options.enable=s)}}const DOWN_EVENT=1,MOVE_EVENT=2,UP_EVENT=4,MOUSE_EVENTS={pointerdown:DOWN_EVENT,pointermove:MOVE_EVENT,pointerup:UP_EVENT,mousedown:DOWN_EVENT,mousemove:MOVE_EVENT,mouseup:UP_EVENT},MOUSE_EVENT_WHICH_LEFT=1,MOUSE_EVENT_WHICH_MIDDLE=2,MOUSE_EVENT_WHICH_RIGHT=3,MOUSE_EVENT_BUTTON_LEFT=0,MOUSE_EVENT_BUTTON_MIDDLE=1,MOUSE_EVENT_BUTTON_RIGHT=2,MOUSE_EVENT_BUTTONS_LEFT_MASK=1,MOUSE_EVENT_BUTTONS_RIGHT_MASK=2,MOUSE_EVENT_BUTTONS_MIDDLE_MASK=4;function whichButtons(i){const e=MOUSE_EVENTS[i.srcEvent.type];if(!e)return null;const{buttons:s,button:o,which:a}=i.srcEvent;let d=!1,g=!1,_=!1;return e===UP_EVENT||e===MOVE_EVENT&&!Number.isFinite(s)?(d=a===MOUSE_EVENT_WHICH_LEFT,g=a===MOUSE_EVENT_WHICH_MIDDLE,_=a===MOUSE_EVENT_WHICH_RIGHT):e===MOVE_EVENT?(d=!!(s&MOUSE_EVENT_BUTTONS_LEFT_MASK),g=!!(s&MOUSE_EVENT_BUTTONS_MIDDLE_MASK),_=!!(s&MOUSE_EVENT_BUTTONS_RIGHT_MASK)):e===DOWN_EVENT&&(d=o===MOUSE_EVENT_BUTTON_LEFT,g=o===MOUSE_EVENT_BUTTON_MIDDLE,_=o===MOUSE_EVENT_BUTTON_RIGHT),{leftButton:d,middleButton:g,rightButton:_}}function getOffsetPosition(i,e){const s=i.center;if(!s)return null;const o=e.getBoundingClientRect(),a=o.width/e.offsetWidth||1,d=o.height/e.offsetHeight||1,g={x:(s.x-o.left-e.clientLeft)/a,y:(s.y-o.top-e.clientTop)/d};return{center:s,offsetCenter:g}}const DEFAULT_OPTIONS$1={srcElement:"root",priority:0};class EventRegistrar{constructor(e){this.handleEvent=s=>{if(this.isEmpty())return;const o=this._normalizeEvent(s);let a=s.srcEvent.target;for(;a&&a!==o.rootElement;){if(this._emit(o,a),o.handled)return;a=a.parentNode}this._emit(o,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,s,o,a=!1,d=!1){const{handlers:g,handlersByElement:_}=this;let j=DEFAULT_OPTIONS$1;typeof o=="string"||o&&o.addEventListener?j={...DEFAULT_OPTIONS$1,srcElement:o}:o&&(j={...DEFAULT_OPTIONS$1,...o});let _e=_.get(j.srcElement);_e||(_e=[],_.set(j.srcElement,_e));const et={type:e,handler:s,srcElement:j.srcElement,priority:j.priority};a&&(et.once=!0),d&&(et.passive=!0),g.push(et),this._active=this._active||!et.passive;let tt=_e.length-1;for(;tt>=0&&!(_e[tt].priority>=et.priority);)tt--;_e.splice(tt+1,0,et)}remove(e,s){const{handlers:o,handlersByElement:a}=this;for(let d=o.length-1;d>=0;d--){const g=o[d];if(g.type===e&&g.handler===s){o.splice(d,1);const _=a.get(g.srcElement);_.splice(_.indexOf(g),1),_.length===0&&a.delete(g.srcElement)}}this._active=o.some(d=>!d.passive)}_emit(e,s){const o=this.handlersByElement.get(s);if(o){let a=!1;const d=()=>{e.handled=!0},g=()=>{e.handled=!0,a=!0},_=[];for(let j=0;j<o.length;j++){const{type:_e,handler:et,once:tt}=o[j];if(et({...e,type:_e,stopPropagation:d,stopImmediatePropagation:g}),tt&&_.push(o[j]),a)break}for(let j=0;j<_.length;j++){const{type:_e,handler:et}=_[j];this.remove(_e,et)}}}_normalizeEvent(e){const s=this.eventManager.getElement();return{...e,...whichButtons(e),...getOffsetPosition(e,s),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:s}}}const DEFAULT_OPTIONS={events:null,recognizers:null,recognizerOptions:{},Manager,touchAction:"none",tabIndex:0};class EventManager{constructor(e=null,s){this._onBasicInput=a=>{const{srcEvent:d}=a,g=BASIC_EVENT_ALIASES[d.type];g&&this.manager.emit(g,a)},this._onOtherEvent=a=>{this.manager.emit(a.type,a)},this.options={...DEFAULT_OPTIONS,...s},this.events=new Map,this.setElement(e);const{events:o}=this.options;o&&this.on(o)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:s}=this,o=s.Manager;this.manager=new o(e,{touchAction:s.touchAction,recognizers:s.recognizers||RECOGNIZERS}).on("hammer.input",this._onBasicInput),s.recognizers||Object.keys(RECOGNIZER_COMPATIBLE_MAP).forEach(a=>{const d=this.manager.get(a);d&&RECOGNIZER_COMPATIBLE_MAP[a].forEach(g=>{d.recognizeWith(g)})});for(const a in s.recognizerOptions){const d=this.manager.get(a);if(d){const g=s.recognizerOptions[a];delete g.enable,d.set(g)}}this.wheelInput=new WheelInput(e,this._onOtherEvent,{enable:!1}),this.moveInput=new MoveInput(e,this._onOtherEvent,{enable:!1}),this.keyInput=new KeyInput(e,this._onOtherEvent,{enable:!1,tabIndex:s.tabIndex}),this.contextmenuInput=new ContextmenuInput(e,this._onOtherEvent,{enable:!1});for(const[a,d]of this.events)d.isEmpty()||(this._toggleRecognizer(d.recognizerName,!0),this.manager.on(a,d.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,s,o){this._addEventHandler(e,s,o,!1)}once(e,s,o){this._addEventHandler(e,s,o,!0)}watch(e,s,o){this._addEventHandler(e,s,o,!1,!0)}off(e,s){this._removeEventHandler(e,s)}_toggleRecognizer(e,s){const{manager:o}=this;if(!o)return;const a=o.get(e);if(a&&a.options.enable!==s){a.set({enable:s});const d=RECOGNIZER_FALLBACK_MAP[e];d&&!this.options.recognizers&&d.forEach(g=>{const _=o.get(g);s?(_.requireFailure(e),a.dropRequireFailure(g)):_.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,s),this.moveInput.enableEventType(e,s),this.keyInput.enableEventType(e,s),this.contextmenuInput.enableEventType(e,s)}_addEventHandler(e,s,o,a,d){if(typeof e!="string"){o=s;for(const et in e)this._addEventHandler(et,e[et],o,a,d);return}const{manager:g,events:_}=this,j=GESTURE_EVENT_ALIASES[e]||e;let _e=_.get(j);_e||(_e=new EventRegistrar(this),_.set(j,_e),_e.recognizerName=EVENT_RECOGNIZER_MAP[j]||j,g&&g.on(j,_e.handleEvent)),_e.add(e,s,o,a,d),_e.isEmpty()||this._toggleRecognizer(_e.recognizerName,!0)}_removeEventHandler(e,s){if(typeof e!="string"){for(const g in e)this._removeEventHandler(g,e[g]);return}const{events:o}=this,a=GESTURE_EVENT_ALIASES[e]||e,d=o.get(a);if(d&&(d.remove(e,s),d.isEmpty())){const{recognizerName:g}=d;let _=!1;for(const j of o.values())if(j.recognizerName===g&&!j.isEmpty()){_=!0;break}_||this._toggleRecognizer(g,!1)}}}function noop(){}const getCursor=({isDragging:i})=>i?"grabbing":"grab",defaultProps$2={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:noop,onResize:noop,onViewStateChange:noop,onInteractionStateChange:noop,onBeforeRender:noop,onAfterRender:noop,onLoad:noop,onError:i=>log.error(i.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor,getTooltip:null,debug:!1,drawPickingColors:!1};class Deck{constructor(e){_defineProperty(this,"props",void 0),_defineProperty(this,"width",0),_defineProperty(this,"height",0),_defineProperty(this,"userData",{}),_defineProperty(this,"canvas",null),_defineProperty(this,"viewManager",null),_defineProperty(this,"layerManager",null),_defineProperty(this,"effectManager",null),_defineProperty(this,"deckRenderer",null),_defineProperty(this,"deckPicker",null),_defineProperty(this,"eventManager",null),_defineProperty(this,"tooltip",null),_defineProperty(this,"metrics",void 0),_defineProperty(this,"animationLoop",void 0),_defineProperty(this,"stats",void 0),_defineProperty(this,"viewState",void 0),_defineProperty(this,"cursorState",void 0),_defineProperty(this,"_needsRedraw",void 0),_defineProperty(this,"_pickRequest",void 0),_defineProperty(this,"_lastPointerDownInfo",null),_defineProperty(this,"_metricsCounter",void 0),_defineProperty(this,"_onPointerMove",s=>{const{_pickRequest:o}=this;if(s.type==="pointerleave")o.x=-1,o.y=-1,o.radius=0;else{if(s.leftButton||s.rightButton)return;{const a=s.offsetCenter;if(!a)return;o.x=a.x,o.y=a.y,o.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:o.x,y:o.y}),o.event=s}),_defineProperty(this,"_onEvent",s=>{const o=EVENTS[s.type],a=s.offsetCenter;if(!o||!a||!this.layerManager)return;const d=this.layerManager.getLayers(),g=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:d,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:_}=g,j=_&&(_[o.handler]||_.props[o.handler]),_e=this.props[o.handler];let et=!1;j&&(et=j.call(_,g,s)),!et&&_e&&_e(g,s)}),_defineProperty(this,"_onPointerDown",s=>{const o=s.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:o.x,y:o.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo}),this.props={...defaultProps$2,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&log.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),getBrowser()==="IE"&&log.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&defaultTypedArrayManager.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,s,o,a,d,g,_;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(s=this.viewManager)===null||s===void 0||s.finalize(),this.viewManager=null,(o=this.effectManager)===null||o===void 0||o.finalize(),this.effectManager=null,(a=this.deckRenderer)===null||a===void 0||a.finalize(),this.deckRenderer=null,(d=this.deckPicker)===null||d===void 0||d.finalize(),this.deckPicker=null,(g=this.eventManager)===null||g===void 0||g.destroy(),this.eventManager=null,(_=this.tooltip)===null||_===void 0||_.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var j;(j=this.canvas.parentElement)===null||j===void 0||j.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&log.removed("onLayerHover","onHover")(),"onLayerClick"in e&&log.removed("onLayerClick","onClick")(),e.initialViewState&&!deepEqual(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const s=Object.create(this.props);Object.assign(s,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(s),this.layerManager&&(this.viewManager.setProps(s),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(s),this.effectManager.setProps(s),this.deckRenderer.setProps(s),this.deckPicker.setProps(s)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let s=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const o=this.viewManager.needsRedraw(e),a=this.layerManager.needsRedraw(e),d=this.effectManager.needsRedraw(e),g=this.deckRenderer.needsRedraw(e);return s=s||o||a||d||g,s}redraw(e){if(!this.layerManager)return;let s=this.needsRedraw({clearRedrawFlags:!0});s=e||s,s&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(s):this._drawLayers(s))}get isInitialized(){return this.viewManager!==null}getViews(){return assert(this.viewManager),this.viewManager.views}getViewports(e){return assert(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const s=this._pick("pickObject","pickObject Time",e).result;return s.length?s[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,s=!1){for(const o in e)this.layerManager.resourceManager.add({resourceId:o,data:e[o],forceUpdate:s})}_removeResources(e){for(const s of e)this.layerManager.resourceManager.remove(s)}_pick(e,s,o){assert(this.deckPicker);const{stats:a}=this;a.get("Pick Count").incrementCount(),a.get(s).timeStart();const d=this.deckPicker[e]({layers:this.layerManager.getLayers(o),views:this.viewManager.getViews(),viewports:this.getViewports(o),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...o});return a.get(s).timeEnd(),d}_createCanvas(e){let s=e.canvas;return typeof s=="string"&&(s=document.getElementById(s),assert(s)),s||(s=document.createElement("canvas"),s.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(s)),Object.assign(s.style,e.style),s}_setCanvasSize(e){if(!this.canvas)return;const{width:s,height:o}=e;if(s||s===0){const d=Number.isFinite(s)?"".concat(s,"px"):s;this.canvas.style.width=d}if(o||o===0){var a;const d=Number.isFinite(o)?"".concat(o,"px"):o;this.canvas.style.position=((a=e.style)===null||a===void 0?void 0:a.position)||"absolute",this.canvas.style.height=d}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const s=e.clientWidth||e.width,o=e.clientHeight||e.height;if(s!==this.width||o!==this.height){var a;this.width=s,this.height=o,(a=this.viewManager)===null||a===void 0||a.setProps({width:s,height:o}),this.props.onResize({width:s,height:o})}}_createAnimationLoop(e){const{width:s,height:o,gl:a,glOptions:d,debug:g,onError:_,onBeforeRender:j,onAfterRender:_e,useDevicePixels:et}=e;return new AnimationLoop({width:s,height:o,useDevicePixels:et,autoResizeViewport:!1,gl:a,onCreateContext:tt=>createGLContext({...d,...tt,canvas:this.canvas,debug:g,onContextLost:()=>this._onContextLost()}),onInitialize:tt=>this._setGLContext(tt.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:j,onAfterRender:_e,onError:_})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new MapView({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let d=a,g=!1;for(const _ of o){var s;d=_,g=((s=_.layer)===null||s===void 0?void 0:s.onHover(_,e.event))||g}if(!g&&this.props.onHover&&this.props.onHover(d,e.event),this.props.getTooltip&&this.tooltip){const _=this.props.getTooltip(d);this.tooltip.setTooltip(_,d.x,d.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,instrumentGLContext(e,{enable:!0,copyState:!0})),this.tooltip=new Tooltip(this.canvas),setParameters(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const s=new Timeline;s.play(),this.animationLoop.attachTimeline(s),this.eventManager=new EventManager(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const a in EVENTS)this.eventManager.on(a,this._onEvent);this.viewManager=new ViewManager({timeline:s,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const o=this.viewManager.getViewports()[0];this.layerManager=new LayerManager(e,{deck:this,stats:this.stats,viewport:o,timeline:s}),this.effectManager=new EffectManager,this.deckRenderer=new DeckRenderer(e),this.deckPicker=new DeckPicker(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,s){const{gl:o}=this.layerManager.context;setParameters(o,this.props.parameters),this.props.onBeforeRender({gl:o}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...s}),this.props.onAfterRender({gl:o})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),log.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const s=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:s},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const s=this.animationLoop.stats;e.get("GPU Time").addTime(s.get("GPU Time").lastTiming),e.get("CPU Time").addTime(s.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:s}=this;e.fps=s.get("frameRate").getHz(),e.setPropsTime=s.get("setProps Time").time,e.updateAttributesTime=s.get("Update Attributes").time,e.framesRedrawn=s.get("Redraw Count").count,e.pickTime=s.get("pickObject Time").time+s.get("pickMultipleObjects Time").time+s.get("pickObjects Time").time,e.pickCount=s.get("Pick Count").count,e.gpuTime=s.get("GPU Time").time,e.cpuTime=s.get("CPU Time").time,e.gpuTimePerFrame=s.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=s.get("CPU Time").getAverageTime();const o=lumaStats.get("Memory Usage");e.bufferMemory=o.get("Buffer Memory").count,e.textureMemory=o.get("Texture Memory").count,e.renderbufferMemory=o.get("Renderbuffer Memory").count,e.gpuMemory=o.get("GPU Memory").count}}_defineProperty(Deck,"defaultProps",defaultProps$2);_defineProperty(Deck,"VERSION",deckGlobal.VERSION);class ShaderAttribute{constructor(e,s){_defineProperty(this,"opts",void 0),_defineProperty(this,"source",void 0),this.opts=s,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),s=this.getAccessor();if(e)return[e,s];const{value:o}=this.source,{size:a}=s;let d=o;if(o&&o.length!==a){d=new Float32Array(a);const g=s.elementOffset||0;for(let _=0;_<a;++_)d[_]=o[g+_]}return d}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function glArrayFromType(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function getStride(i){return i.stride||i.size*i.bytesPerElement}function resolveShaderAttribute(i,e){e.offset&&log.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const s=getStride(i),o=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,a=e.elementOffset||0,d=o*s+a*i.bytesPerElement+(i.offset||0);return{...e,offset:d,stride:s}}function resolveDoublePrecisionShaderAttributes(i,e){const s=resolveShaderAttribute(i,e);return{high:s,low:{...s,offset:s.offset+i.size*4}}}class DataColumn{constructor(e,s,o){_defineProperty(this,"gl",void 0),_defineProperty(this,"id",void 0),_defineProperty(this,"size",void 0),_defineProperty(this,"settings",void 0),_defineProperty(this,"value",void 0),_defineProperty(this,"doublePrecision",void 0),_defineProperty(this,"_buffer",void 0),_defineProperty(this,"state",void 0),this.gl=e,this.id=s.id||"",this.size=s.size||1;const a=s.logicalType||s.type,d=a===5130;let{defaultValue:g}=s;g=Number.isFinite(g)?[g]:g||new Array(this.size).fill(0);let _;d?_=5126:!a&&s.isIndexed?_=e&&hasFeature(e,FEATURES$1.ELEMENT_INDEX_UINT32)?5125:5123:_=a||5126;let j=glArrayFromType(a||_||5126);this.doublePrecision=d,d&&s.fp64===!1&&(j=Float32Array),this.value=null,this.settings={...s,defaultType:j,defaultValue:g,logicalType:a,type:_,size:this.size,bytesPerElement:j.BYTES_PER_ELEMENT},this.state={...o,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:s}=this.settings;this._buffer=new Buffer(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:s}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*getStride(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),defaultTypedArrayManager.release(this.state.allocatedValue)}getShaderAttributes(e,s){if(this.doublePrecision){const o={},a=this.value instanceof Float64Array,d=resolveDoublePrecisionShaderAttributes(this.getAccessor(),s||{});return o[e]=new ShaderAttribute(this,d.high),o["".concat(e,"64Low")]=a?new ShaderAttribute(this,d.low):new Float32Array(this.size),o}if(s){const o=resolveShaderAttribute(this.getAccessor(),s);return{[e]:new ShaderAttribute(this,o)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const s=Array.from(this.value);e=[s,s]}else{const{value:s,numInstances:o,size:a}=this,d=o*a;if(s&&d&&s.length>=d){const g=new Array(a).fill(1/0),_=new Array(a).fill(-1/0);for(let j=0;j<d;)for(let _e=0;_e<a;_e++){const et=s[j++];et<g[_e]&&(g[_e]=et),et>_[_e]&&(_[_e]=et)}e=[g,_]}}return this.state.bounds=e,e}setData(e){const{state:s}=this;let o;ArrayBuffer.isView(e)?o={value:e}:e instanceof Buffer?o={buffer:e}:o=e;const a={...this.settings,...o};if(s.bufferAccessor=a,s.bounds=null,o.constant){let d=o.value;if(d=this._normalizeValue(d,[],0),this.settings.normalized&&(d=this.normalizeConstant(d)),!(!s.constant||!this._areValuesEqual(d,this.value)))return!1;s.externalBuffer=null,s.constant=!0,this.value=d}else if(o.buffer){const d=o.buffer;s.externalBuffer=d,s.constant=!1,this.value=o.value||null;const g=o.value instanceof Float64Array;a.type=o.type||d.accessor.type,a.bytesPerElement=d.accessor.BYTES_PER_ELEMENT*(g?2:1),a.stride=getStride(a)}else if(o.value){this._checkExternalBuffer(o);let d=o.value;s.externalBuffer=null,s.constant=!1,this.value=d,a.bytesPerElement=d.BYTES_PER_ELEMENT,a.stride=getStride(a);const{buffer:g,byteOffset:_}=this;this.doublePrecision&&d instanceof Float64Array&&(d=toDoublePrecisionArray(d,a));const j=d.byteLength+_+a.stride*2;g.byteLength<j&&g.reallocate(j),g.setAccessor(null),g.subData({data:d,offset:_}),a.type=o.type||g.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const s=this.value,{startOffset:o=0,endOffset:a}=e;this.buffer.subData({data:this.doublePrecision&&s instanceof Float64Array?toDoublePrecisionArray(s,{size:this.size,startIndex:o,endIndex:a}):s.subarray(o,a),offset:o*s.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,s=!1){const{state:o}=this,a=o.allocatedValue,d=defaultTypedArrayManager.allocate(a,e+1,{size:this.size,type:this.settings.defaultType,copy:s});this.value=d;const{buffer:g,byteOffset:_}=this;return g.byteLength<d.byteLength+_&&(g.reallocate(d.byteLength+_),s&&a&&g.subData({data:a instanceof Float64Array?toDoublePrecisionArray(a,this):a,offset:_})),o.allocatedValue=d,o.constant=!1,o.externalBuffer=null,o.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:s}=e;if(!ArrayBuffer.isView(s))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const o=this.settings.defaultType;let a=!1;if(this.doublePrecision&&(a=s.BYTES_PER_ELEMENT<4),a)throw new Error("Attribute ".concat(this.id," does not support ").concat(s.constructor.name));!(s instanceof o)&&this.settings.normalized&&!("normalized"in e)&&log.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(s=>(s+128)/255*2-1);case 5122:return new Float32Array(e).map(s=>(s+32768)/65535*2-1);case 5121:return new Float32Array(e).map(s=>s/255);case 5123:return new Float32Array(e).map(s=>s/65535);default:return e}}_normalizeValue(e,s,o){const{defaultValue:a,size:d}=this.settings;if(Number.isFinite(e))return s[o]=e,s;if(!e)return s[o]=a[0],s;switch(d){case 4:s[o+3]=Number.isFinite(e[3])?e[3]:a[3];case 3:s[o+2]=Number.isFinite(e[2])?e[2]:a[2];case 2:s[o+1]=Number.isFinite(e[1])?e[1]:a[1];case 1:s[o+0]=Number.isFinite(e[0])?e[0]:a[0];break;default:let g=d;for(;--g>=0;)s[o+g]=Number.isFinite(e[g])?e[g]:a[g]}return s}_areValuesEqual(e,s){if(!e||!s)return!1;const{size:o}=this;for(let a=0;a<o;a++)if(e[a]!==s[a])return!1;return!0}}const EMPTY_ARRAY$1=[],placeholderArray=[];function createIterable(i,e=0,s=1/0){let o=EMPTY_ARRAY$1;const a={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?o=i:i.length>0&&(placeholderArray.length=i.length,o=placeholderArray):o=EMPTY_ARRAY$1,(e>0||Number.isFinite(s))&&(o=(Array.isArray(o)?o:Array.from(o)).slice(e,s),a.index=e-1),{iterable:o,objectInfo:a}}function isAsyncIterable(i){return i&&i[Symbol.asyncIterator]}function getAccessorFromBuffer(i,e){const{size:s,stride:o,offset:a,startIndices:d,nested:g}=e,_=i.BYTES_PER_ELEMENT,j=o?o/_:s,_e=a?a/_:0,et=Math.floor((i.length-_e)/j);return(tt,{index:rt,target:it})=>{if(!d){const dt=rt*j+_e;for(let pt=0;pt<s;pt++)it[pt]=i[dt+pt];return it}const ot=d[rt],ct=d[rt+1]||et;let ft;if(g){ft=new Array(ct-ot);for(let dt=ot;dt<ct;dt++){const pt=dt*j+_e;it=new Array(s);for(let gt=0;gt<s;gt++)it[gt]=i[pt+gt];ft[dt-ot]=it}}else if(j===s)ft=i.subarray(ot*s+_e,ct*s+_e);else{ft=new i.constructor((ct-ot)*s);let dt=0;for(let pt=ot;pt<ct;pt++){const gt=pt*j+_e;for(let Ct=0;Ct<s;Ct++)ft[dt++]=i[gt+Ct]}}return ft}}const EMPTY=[],FULL=[[0,1/0]];function add(i,e){if(i===FULL||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const s=[],o=i.length;let a=0;for(let d=0;d<o;d++){const g=i[d];g[1]<e[0]?(s.push(g),a=d+1):g[0]>e[1]?s.push(g):e=[Math.min(g[0],e[0]),Math.max(g[1],e[1])]}return s.splice(a,0,e),s}function padArrayChunk(i){const{source:e,target:s,start:o=0,size:a,getData:d}=i,g=i.end||s.length,_=e.length,j=g-o;if(_>j){s.set(e.subarray(0,j),o);return}if(s.set(e,o),!d)return;let _e=_;for(;_e<j;){const et=d(_e,e);for(let tt=0;tt<a;tt++)s[o+_e]=et[tt]||0,_e++}}function padArray({source:i,target:e,size:s,getData:o,sourceStartIndices:a,targetStartIndices:d}){if(!Array.isArray(d))return padArrayChunk({source:i,target:e,size:s,getData:o}),e;let g=0,_=0;const j=o&&((et,tt)=>o(et+_,tt)),_e=Math.min(a.length,d.length);for(let et=1;et<_e;et++){const tt=a[et]*s,rt=d[et]*s;padArrayChunk({source:i.subarray(g,tt),target:e,start:_,end:rt,size:s,getData:j}),g=tt,_=rt}return _<e.length&&padArrayChunk({source:[],target:e,start:_,size:s,getData:j}),e}const DEFAULT_TRANSITION_SETTINGS={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function normalizeTransitionSettings(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const s=i.type||"interpolation";return{...DEFAULT_TRANSITION_SETTINGS[s],...e,...i,type:s}}function getSourceBufferAttribute(i,e){const s=e.getBuffer();return s?[s,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function getAttributeTypeFromSize(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function cycleBuffers(i){i.push(i.shift())}function getAttributeBufferLength(i,e){const{doublePrecision:s,settings:o,value:a,size:d}=i,g=s&&a instanceof Float64Array?2:1;return(o.noAlloc?a.length:e*d)*g}function padBuffer({buffer:i,numInstances:e,attribute:s,fromLength:o,fromStartIndices:a,getData:d=g=>g}){const g=s.doublePrecision&&s.value instanceof Float64Array?2:1,_=s.size*g,j=s.byteOffset,_e=s.startIndices,et=a&&_e,tt=getAttributeBufferLength(s,e),rt=s.isConstant;if(!et&&o>=tt)return;const it=rt?s.value:s.getBuffer().getData({srcByteOffset:j});if(s.settings.normalized&&!rt){const dt=d;d=(pt,gt)=>s.normalizeConstant(dt(pt,gt))}const ot=rt?(dt,pt)=>d(it,pt):(dt,pt)=>d(it.subarray(dt,dt+_),pt),ct=i.getData({length:o}),ft=new Float32Array(tt);padArray({source:ct,target:ft,sourceStartIndices:a,targetStartIndices:_e,size:_,getData:ot}),i.byteLength<ft.byteLength+j&&i.reallocate(ft.byteLength+j),i.subData({data:ft,offset:j})}class Attribute extends DataColumn{constructor(e,s){super(e,s,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:FULL}),_defineProperty(this,"constant",!1),this.settings.update=s.update||(s.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const s=this.state.needsRedraw;return this.state.needsRedraw=s&&!e,s}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:s}=this.settings,o=this.settings.transition,a=Array.isArray(s)?e[s.find(d=>e[d])]:e[s];return normalizeTransitionSettings(a,o)}setNeedsUpdate(e=this.id,s){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),s){const{startRow:o=0,endRow:a=1/0}=s;this.state.updateRanges=add(this.state.updateRanges,[o,a])}else this.state.updateRanges=FULL}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=EMPTY}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:s,settings:o}=this;return o.noAlloc?!1:o.update?(super.allocate(e,s.updateRanges!==FULL),!0):!1}updateBuffer({numInstances:e,data:s,props:o,context:a}){if(!this.needsUpdate())return!1;const{state:{updateRanges:d},settings:{update:g,noAlloc:_}}=this;let j=!0;if(g){for(const[_e,et]of d)g.call(a,this,{data:s,startRow:_e,endRow:et,props:o,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[_e,et]of d){const tt=Number.isFinite(_e)?this.getVertexOffset(_e):0,rt=Number.isFinite(et)?this.getVertexOffset(et):_||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:tt,endOffset:rt})}this._checkAttributeArray()}else j=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),j}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:s}=this;return e?(this.clearNeedsUpdate(),s.lastExternalBuffer===e||(s.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(s.lastExternalBuffer=null,!1)}setBinaryValue(e,s=null){const{state:o,settings:a}=this;if(!e)return o.binaryValue=null,o.binaryAccessor=null,!1;if(a.noAlloc)return!1;if(o.binaryValue===e)return this.clearNeedsUpdate(),!0;if(o.binaryValue=e,this.setNeedsRedraw(),a.transform||s!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const g=e;assert(ArrayBuffer.isView(g.value),"invalid ".concat(a.accessor));const _=!!g.size&&g.size!==this.size;return o.binaryAccessor=getAccessorFromBuffer(g.value,{size:g.size||this.size,stride:g.stride,offset:g.offset,startIndices:s,nested:_}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:s}=this;return(s?e<s.length?s[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},s={};for(const o in e)Object.assign(s,super.getShaderAttributes(o,e[o]));return s}_autoUpdater(e,{data:s,startRow:o,endRow:a,props:d,numInstances:g}){if(e.constant)return;const{settings:_,state:j,value:_e,size:et,startIndices:tt}=e,{accessor:rt,transform:it}=_,ot=j.binaryAccessor||(typeof rt=="function"?rt:d[rt]);assert(typeof ot=="function",'accessor "'.concat(rt,'" is not a function'));let ct=e.getVertexOffset(o);const{iterable:ft,objectInfo:dt}=createIterable(s,o,a);for(const pt of ft){dt.index++;let gt=ot(pt,dt);if(it&&(gt=it.call(this,gt)),tt){const Ct=(dt.index<tt.length-1?tt[dt.index+1]:g)-tt[dt.index];if(gt&&Array.isArray(gt[0])){let xt=ct;for(const at of gt)e._normalizeValue(at,_e,xt),xt+=et}else gt&&gt.length>et?_e.set(gt,ct):(e._normalizeValue(gt,dt.target,0),fillArray({target:_e,source:dt.target,start:ct,count:Ct}));ct+=Ct*et}else e._normalizeValue(gt,_e,ct),ct+=et}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,s=Math.min(4,this.size);if(e&&e.length>=s){let o=!0;switch(s){case 4:o=o&&Number.isFinite(e[3]);case 3:o=o&&Number.isFinite(e[2]);case 2:o=o&&Number.isFinite(e[1]);case 1:o=o&&Number.isFinite(e[0]);break;default:o=!1}if(!o)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class GPUInterpolationTransition{constructor({gl:e,attribute:s,timeline:o}){_defineProperty(this,"gl",void 0),_defineProperty(this,"type","interpolation"),_defineProperty(this,"attributeInTransition",void 0),_defineProperty(this,"settings",void 0),_defineProperty(this,"attribute",void 0),_defineProperty(this,"transition",void 0),_defineProperty(this,"currentStartIndices",void 0),_defineProperty(this,"currentLength",void 0),_defineProperty(this,"transform",void 0),_defineProperty(this,"buffers",void 0),this.gl=e,this.transition=new Transition(o),this.attribute=s,this.attributeInTransition=new Attribute(e,s.settings),this.currentStartIndices=s.startIndices,this.currentLength=0,this.transform=getTransform$1(e,s);const a={byteLength:0,usage:35050};this.buffers=[new Buffer(e,a),new Buffer(e,a)]}get inProgress(){return this.transition.inProgress}start(e,s){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:o,buffers:a,attribute:d}=this;cycleBuffers(a);const g={numInstances:s,attribute:d,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const _ of a)padBuffer({buffer:_,...g});this.currentStartIndices=d.startIndices,this.currentLength=getAttributeBufferLength(d,s),this.attributeInTransition.setData({buffer:a[1],value:d.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/d.size),sourceBuffers:{aFrom:a[0],aTo:getSourceBufferAttribute(o,d)},feedbackBuffers:{vCurrent:a[1]}})}update(){const e=this.transition.update();if(e){const{duration:s,easing:o}=this.settings,{time:a}=this.transition;let d=a/s;o&&(d=o(d)),this.transform.run({uniforms:{time:d}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const vs$1=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function getTransform$1(i,e){const s=getAttributeTypeFromSize(e.size);return new Transform(i,{vs:vs$1,defines:{ATTRIBUTE_TYPE:s},varyings:["vCurrent"]})}class GPUSpringTransition{constructor({gl:e,attribute:s,timeline:o}){_defineProperty(this,"gl",void 0),_defineProperty(this,"type","spring"),_defineProperty(this,"attributeInTransition",void 0),_defineProperty(this,"settings",void 0),_defineProperty(this,"attribute",void 0),_defineProperty(this,"transition",void 0),_defineProperty(this,"currentStartIndices",void 0),_defineProperty(this,"currentLength",void 0),_defineProperty(this,"texture",void 0),_defineProperty(this,"framebuffer",void 0),_defineProperty(this,"transform",void 0),_defineProperty(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new Transition(o),this.attribute=s,this.attributeInTransition=new Attribute(e,{...s.settings,normalized:!1}),this.currentStartIndices=s.startIndices,this.currentLength=0,this.texture=getTexture(e),this.framebuffer=getFramebuffer(e,this.texture),this.transform=getTransform(e,s,this.framebuffer);const a={byteLength:0,usage:35050};this.buffers=[new Buffer(e,a),new Buffer(e,a),new Buffer(e,a)]}get inProgress(){return this.transition.inProgress}start(e,s){const{gl:o,buffers:a,attribute:d}=this,g={numInstances:s,attribute:d,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const _ of a)padBuffer({buffer:_,...g});this.settings=e,this.currentStartIndices=d.startIndices,this.currentLength=getAttributeBufferLength(d,s),this.attributeInTransition.setData({buffer:a[1],value:d.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/d.size),sourceBuffers:{aTo:getSourceBufferAttribute(o,d)}})}update(){const{buffers:e,transform:s,framebuffer:o,transition:a}=this;if(!a.update())return!1;const g=this.settings;return s.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),s.run({framebuffer:o,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:g.stiffness,damping:g.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),cycleBuffers(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),readPixelsToArray(o)[0]>0||a.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function getTransform(i,e,s){const o=getAttributeTypeFromSize(e.size);return new Transform(i,{framebuffer:s,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:o},varyings:["vNext"]})}function getTexture(i){return new Texture2D(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function getFramebuffer(i,e){return new Framebuffer(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const TRANSITION_TYPES$1={interpolation:GPUInterpolationTransition,spring:GPUSpringTransition};class AttributeTransitionManager{constructor(e,{id:s,timeline:o}){_defineProperty(this,"id",void 0),_defineProperty(this,"isSupported",void 0),_defineProperty(this,"gl",void 0),_defineProperty(this,"timeline",void 0),_defineProperty(this,"transitions",void 0),_defineProperty(this,"needsRedraw",void 0),_defineProperty(this,"numInstances",void 0),this.id=s,this.gl=e,this.timeline=o,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Transform.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:s,numInstances:o}){this.numInstances=o||1;for(const a in e){const d=e[a],g=d.getTransitionSetting(s);g&&this._updateAttribute(a,d,g)}for(const a in this.transitions){const d=e[a];(!d||!d.getTransitionSetting(s))&&this._removeTransition(a)}}hasAttribute(e){const s=this.transitions[e];return s&&s.inProgress}getAttributes(){const e={};for(const s in this.transitions){const o=this.transitions[s];o.inProgress&&(e[s]=o.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const s in this.transitions)this.transitions[s].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,s,o){const a=this.transitions[e];let d=!a||a.type!==o.type;if(d){if(!this.isSupported){log.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}a&&this._removeTransition(e);const g=TRANSITION_TYPES$1[o.type];g?this.transitions[e]=new g({attribute:s,timeline:this.timeline,gl:this.gl}):(log.error("unsupported transition type '".concat(o.type,"'"))(),d=!1)}(d||s.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(o,this.numInstances))}}const TRACE_INVALIDATE="attributeManager.invalidate",TRACE_UPDATE_START="attributeManager.updateStart",TRACE_UPDATE_END="attributeManager.updateEnd",TRACE_ATTRIBUTE_UPDATE_START="attribute.updateStart",TRACE_ATTRIBUTE_ALLOCATE="attribute.allocate",TRACE_ATTRIBUTE_UPDATE_END="attribute.updateEnd";class AttributeManager{constructor(e,{id:s="attribute-manager",stats:o,timeline:a}={}){_defineProperty(this,"id",void 0),_defineProperty(this,"gl",void 0),_defineProperty(this,"attributes",void 0),_defineProperty(this,"updateTriggers",void 0),_defineProperty(this,"needsRedraw",void 0),_defineProperty(this,"userData",void 0),_defineProperty(this,"stats",void 0),_defineProperty(this,"attributeTransitionManager",void 0),this.id=s,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=o,this.attributeTransitionManager=new AttributeTransitionManager(e,{id:"".concat(s,"-transitions"),timeline:a}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const s=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,s&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const s of e)this.attributes[s]!==void 0&&(this.attributes[s].delete(),delete this.attributes[s])}invalidate(e,s){const o=this._invalidateTrigger(e,s);debug(TRACE_INVALIDATE,this,e,o)}invalidateAll(e){for(const s in this.attributes)this.attributes[s].setNeedsUpdate(s,e);debug(TRACE_INVALIDATE,this,"all")}update({data:e,numInstances:s,startIndices:o=null,transitions:a,props:d={},buffers:g={},context:_={}}){let j=!1;debug(TRACE_UPDATE_START,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const _e in this.attributes){const et=this.attributes[_e],tt=et.settings.accessor;et.startIndices=o,et.numInstances=s,d[_e]&&log.removed("props.".concat(_e),"data.attributes.".concat(_e))(),et.setExternalBuffer(g[_e])||et.setBinaryValue(typeof tt=="string"?g[tt]:void 0,e.startIndices)||typeof tt=="string"&&!g[tt]&&et.setConstantValue(d[tt])||et.needsUpdate()&&(j=!0,this._updateAttribute({attribute:et,numInstances:s,data:e,props:d,context:_})),this.needsRedraw=this.needsRedraw||et.needsRedraw()}j&&debug(TRACE_UPDATE_END,this,s),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:s,transitions:a})}updateTransition(){const{attributeTransitionManager:e}=this,s=e.run();return this.needsRedraw=this.needsRedraw||s,s}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:s,attributeTransitionManager:o}=this,a={...o.getAttributes()};for(const d in s){const g=s[d];g.needsRedraw(e)&&!o.hasAttribute(d)&&(a[d]=g)}return a}getShaderAttributes(e,s={}){e||(e=this.getAttributes());const o={};for(const a in e)s[a]||Object.assign(o,e[a].getShaderAttributes());return o}_add(e,s={}){for(const o in e){const a=e[o];this.attributes[o]=this._createAttribute(o,a,s)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,s,o){const a={...s,id:e,size:s.isIndexed&&1||s.size||1,divisor:o.instanced?1:s.divisor||0};return new Attribute(this.gl,a)}_mapUpdateTriggersToAttributes(){const e={};for(const s in this.attributes)this.attributes[s].getUpdateTriggers().forEach(a=>{e[a]||(e[a]=[]),e[a].push(s)});this.updateTriggers=e}_invalidateTrigger(e,s){const{attributes:o,updateTriggers:a}=this,d=a[e];return d&&d.forEach(g=>{const _=o[g];_&&_.setNeedsUpdate(_.id,s)}),d}_updateAttribute(e){const{attribute:s,numInstances:o}=e;if(debug(TRACE_ATTRIBUTE_UPDATE_START,s),s.constant){s.setConstantValue(s.value);return}s.allocate(o)&&debug(TRACE_ATTRIBUTE_ALLOCATE,s,o),s.updateBuffer(e)&&(this.needsRedraw=!0,debug(TRACE_ATTRIBUTE_UPDATE_END,s,o))}}class CPUInterpolationTransition extends Transition{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:s,toValue:o,duration:a,easing:d}}=this,g=d(e/a);this._value=lerp(s,o,g)}}const EPSILON=1e-5;function updateSpringElement(i,e,s,o,a){const d=e-i,_=(s-e)*a,j=-d*o;return _+j+d+e}function updateSpring(i,e,s,o,a){if(Array.isArray(s)){const d=[];for(let g=0;g<s.length;g++)d[g]=updateSpringElement(i[g],e[g],s[g],o,a);return d}return updateSpringElement(i,e,s,o,a)}function distance(i,e){if(Array.isArray(i)){let s=0;for(let o=0;o<i.length;o++){const a=i[o]-e[o];s+=a*a}return Math.sqrt(s)}return Math.abs(i-e)}class CPUSpringTransition extends Transition{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:s,damping:o,stiffness:a}=this.settings,{_prevValue:d=e,_currValue:g=e}=this;let _=updateSpring(d,g,s,o,a);const j=distance(_,s),_e=distance(_,g);j<EPSILON&&_e<EPSILON&&(_=s,this.end()),this._prevValue=g,this._currValue=_}}const TRANSITION_TYPES={interpolation:CPUInterpolationTransition,spring:CPUSpringTransition};class UniformTransitionManager{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,s,o,a){const{transitions:d}=this;if(d.has(e)){const j=d.get(e),{value:_e=j.settings.fromValue}=j;s=_e,this.remove(e)}if(a=normalizeTransitionSettings(a),!a)return;const g=TRANSITION_TYPES[a.type];if(!g){log.error("unsupported transition type '".concat(a.type,"'"))();return}const _=new g(this.timeline);_.start({...a,fromValue:s,toValue:o}),d.set(e,_)}remove(e){const{transitions:s}=this;s.has(e)&&(s.get(e).cancel(),s.delete(e))}update(){const e={};for(const[s,o]of this.transitions)o.update(),e[s]=o.value,o.inProgress||this.remove(s);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function validateProps(i){const e=getPropTypes(i);for(const s in e){const o=e[s],{validate:a}=o;if(a&&!a(i[s],o))throw new Error("Invalid prop ".concat(s,": ").concat(i[s]))}}function diffProps(i,e){const s=compareProps({newProps:i,oldProps:e,propTypes:getPropTypes(i),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),o=diffDataProps(i,e);let a=!1;return o||(a=diffUpdateTriggers(i,e)),{dataChanged:o,propsChanged:s,updateTriggersChanged:a,extensionsChanged:diffExtensions(i,e),transitionsChanged:diffTransitions(i,e)}}function diffTransitions(i,e){if(!i.transitions)return!1;const s={},o=getPropTypes(i);let a=!1;for(const d in i.transitions){const g=o[d],_=g&&g.type;(_==="number"||_==="color"||_==="array")&&comparePropValues(i[d],e[d],g)&&(s[d]=!0,a=!0)}return a?s:!1}function compareProps({newProps:i,oldProps:e,ignoreProps:s={},propTypes:o={},triggerName:a="props"}){if(e===i)return!1;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return"".concat(a," changed shallowly");for(const d of Object.keys(i))if(!(d in s)){if(!(d in e))return"".concat(a,".").concat(d," added");const g=comparePropValues(i[d],e[d],o[d]);if(g)return"".concat(a,".").concat(d," ").concat(g)}for(const d of Object.keys(e))if(!(d in s)){if(!(d in i))return"".concat(a,".").concat(d," dropped");if(!Object.hasOwnProperty.call(i,d)){const g=comparePropValues(i[d],e[d],o[d]);if(g)return"".concat(a,".").concat(d," ").concat(g)}}return!1}function comparePropValues(i,e,s){let o=s&&s.equal;return o&&!o(i,e,s)||!o&&(o=i&&e&&i.equals,o&&!o.call(i,e))?"changed deeply":!o&&e!==i?"changed shallowly":null}function diffDataProps(i,e){if(e===null)return"oldProps is null, initial diff";let s=!1;const{dataComparator:o,_dataDiff:a}=i;return o?o(i.data,e.data)||(s="Data comparator detected a change"):i.data!==e.data&&(s="A new data container was supplied"),s&&a&&(s=a(i.data,e.data)||s),s}function diffUpdateTriggers(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&diffUpdateTrigger(i,e,"all"))return{all:!0};const s={};let o=!1;for(const a in i.updateTriggers)a!=="all"&&diffUpdateTrigger(i,e,a)&&(s[a]=!0,o=!0);return o?s:!1}function diffExtensions(i,e){if(e===null)return!0;const s=e.extensions,{extensions:o}=i;if(o===s)return!1;if(!s||!o||o.length!==s.length)return!0;for(let a=0;a<o.length;a++)if(!o[a].equals(s[a]))return!0;return!1}function diffUpdateTrigger(i,e,s){let o=i.updateTriggers[s];o=o??{};let a=e.updateTriggers[s];return a=a??{},compareProps({oldProps:a,newProps:o,triggerName:s})}function getPropTypes(i){const e=i[COMPONENT_SYMBOL],s=e&&e.constructor;return s?s._propTypes:{}}const ERR_NOT_OBJECT="count(): argument not an object",ERR_NOT_CONTAINER="count(): argument not a container";function count(i){if(!isObject(i))throw new Error(ERR_NOT_OBJECT);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(isPlainObject(i))return Object.keys(i).length;throw new Error(ERR_NOT_CONTAINER)}function isPlainObject(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function isObject(i){return i!==null&&typeof i=="object"}function mergeShaders(i,e){if(!e)return i;const s={...i,...e};if("defines"in e&&(s.defines={...i.defines,...e.defines}),"modules"in e&&(s.modules=(i.modules||[]).concat(e.modules),e.modules.some(o=>o.name==="project64"))){const o=s.modules.findIndex(a=>a.name==="project32");o>=0&&s.modules.splice(o,1)}if("inject"in e)if(!i.inject)s.inject=e.inject;else{const o={...i.inject};for(const a in e.inject)o[a]=(o[a]||"")+e.inject[a];s.inject=o}return s}const DEFAULT_TEXTURE_PARAMETERS={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},internalTextures={};function createTexture(i,e){const s=i.context&&i.context.gl;if(!s||!e)return null;if(e instanceof Texture2D)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let o=null;e.compressed&&(o={[10241]:e.data.length>1?9985:9729});const a=new Texture2D(s,{...e,parameters:{...DEFAULT_TEXTURE_PARAMETERS,...o,...i.props.textureParameters}});return internalTextures[a.id]=!0,a}function destroyTexture(i){!i||!(i instanceof Texture2D)||internalTextures[i.id]&&(i.delete(),delete internalTextures[i.id])}const TYPE_DEFINITIONS={boolean:{validate(i,e){return!0},equal(i,e,s){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||isArray(i)&&(i.length===3||i.length===4)},equal(i,e,s){return arrayEqual(i,e)}},accessor:{validate(i,e){const s=getTypeOf(i);return s==="function"||s===getTypeOf(e.value)},equal(i,e,s){return typeof e=="function"?!0:arrayEqual(i,e)}},array:{validate(i,e){return e.optional&&!i||isArray(i)},equal(i,e,s){return s.compare?arrayEqual(i,e):i===e}},object:{equal(i,e,s){return s.compare?deepEqual(i,e):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,s){return!s.compare||i===e}},data:{transform:(i,e,s)=>{const{dataTransform:o}=s.props;return o&&i?o(i):i}},image:{transform:(i,e,s)=>createTexture(s,i),release:i=>{destroyTexture(i)}}};function arrayEqual(i,e){if(i===e)return!0;if(!isArray(i)||!isArray(e))return!1;const s=i.length;if(s!==e.length)return!1;for(let o=0;o<s;o++)if(i[o]!==e[o])return!1;return!0}function parsePropTypes(i){const e={},s={},o={};for(const[a,d]of Object.entries(i)){const g=d==null?void 0:d.deprecatedFor;if(g)o[a]=Array.isArray(g)?g:[g];else{const _=parsePropType(a,d);e[a]=_,s[a]=_.value}}return{propTypes:e,defaultProps:s,deprecatedProps:o}}function parsePropType(i,e){switch(getTypeOf(e)){case"object":return normalizePropDefinition(i,e);case"array":return normalizePropDefinition(i,{type:"array",value:e,compare:!1});case"boolean":return normalizePropDefinition(i,{type:"boolean",value:e});case"number":return normalizePropDefinition(i,{type:"number",value:e});case"function":return normalizePropDefinition(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function normalizePropDefinition(i,e){return"type"in e?{name:i,...TYPE_DEFINITIONS[e.type],...e}:"value"in e?{name:i,type:getTypeOf(e.value),...e}:{name:i,type:"object",value:e}}function isArray(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function getTypeOf(i){return isArray(i)?"array":i===null?"null":typeof i}function createProps(i,e){const s=getPropsPrototype(i.constructor),o=Object.create(s);o[COMPONENT_SYMBOL]=i,o[ASYNC_ORIGINAL_SYMBOL]={},o[ASYNC_RESOLVED_SYMBOL]={};for(let a=0;a<e.length;++a){const d=e[a];for(const g in d)o[g]=d[g]}return Object.freeze(o),o}function getPropsPrototype(i){const e=getOwnProperty(i,"_mergedDefaultProps");return e||(createPropsPrototypeAndTypes(i),i._mergedDefaultProps)}function createPropsPrototypeAndTypes(i){if(!i.prototype)return;const s=Object.getPrototypeOf(i),o=getPropsPrototype(s),a=getOwnProperty(i,"defaultProps")||{},d=parsePropTypes(a),g=createPropsPrototype(d.defaultProps,o,i),_={...s._propTypes,...d.propTypes};addAsyncPropsToPropPrototype(g,_);const j={...s._deprecatedProps,...d.deprecatedProps};addDeprecatedPropsToPropPrototype(g,j),i._mergedDefaultProps=g,i._propTypes=_,i._deprecatedProps=j}function createPropsPrototype(i,e,s){const o=Object.create(null);Object.assign(o,e,i);const a=getComponentName(s);return delete i.id,Object.defineProperties(o,{id:{writable:!0,value:a}}),o}function addDeprecatedPropsToPropPrototype(i,e){for(const s in e)Object.defineProperty(i,s,{enumerable:!1,set(o){const a="".concat(this.id,": ").concat(s);for(const d of e[s])hasOwnProperty(this,d)||(this[d]=o);log.deprecated(a,e[s].join("/"))()}})}function addAsyncPropsToPropPrototype(i,e){const s={},o={};for(const a in e){const d=e[a],{name:g,value:_}=d;d.async&&(s[g]=_,o[g]=getDescriptorForAsyncProp(g))}i[ASYNC_DEFAULTS_SYMBOL]=s,i[ASYNC_ORIGINAL_SYMBOL]={},Object.defineProperties(i,o)}function getDescriptorForAsyncProp(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||isAsyncIterable(e)?this[ASYNC_ORIGINAL_SYMBOL][i]=e:this[ASYNC_RESOLVED_SYMBOL][i]=e},get(){if(this[ASYNC_RESOLVED_SYMBOL]){if(i in this[ASYNC_RESOLVED_SYMBOL])return this[ASYNC_RESOLVED_SYMBOL][i]||this[ASYNC_DEFAULTS_SYMBOL][i];if(i in this[ASYNC_ORIGINAL_SYMBOL]){const e=this[COMPONENT_SYMBOL]&&this[COMPONENT_SYMBOL].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[ASYNC_DEFAULTS_SYMBOL][i]}}return this[ASYNC_DEFAULTS_SYMBOL][i]}}}function hasOwnProperty(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function getOwnProperty(i,e){return hasOwnProperty(i,e)&&i[e]}function getComponentName(i){const e=getOwnProperty(i,"layerName")||getOwnProperty(i,"componentName");return e||log.once(0,"".concat(i.name,".componentName not specified"))(),e||i.name}let counter=0;class Component{constructor(...e){_defineProperty(this,"id",void 0),_defineProperty(this,"props",void 0),_defineProperty(this,"count",void 0),this.props=createProps(this,e),this.id=this.props.id,this.count=counter++}clone(e){const{props:s}=this,o={};for(const a in s[ASYNC_DEFAULTS_SYMBOL])a in s[ASYNC_RESOLVED_SYMBOL]?o[a]=s[ASYNC_RESOLVED_SYMBOL][a]:a in s[ASYNC_ORIGINAL_SYMBOL]&&(o[a]=s[ASYNC_ORIGINAL_SYMBOL][a]);return new this.constructor({...s,...o,...e})}}_defineProperty(Component,"componentName","Component");_defineProperty(Component,"defaultProps",{});const EMPTY_PROPS=Object.freeze({});class ComponentState{constructor(e){_defineProperty(this,"component",void 0),_defineProperty(this,"onAsyncPropUpdated",void 0),_defineProperty(this,"asyncProps",void 0),_defineProperty(this,"oldProps",void 0),_defineProperty(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const s=this.asyncProps[e];s&&s.type&&s.type.release&&s.type.release(s.resolvedValue,s.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||EMPTY_PROPS}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const s=this.asyncProps[e];return s&&s.resolvedValue}isAsyncPropLoading(e){if(e){const s=this.asyncProps[e];return!!(s&&s.pendingLoadCount>0&&s.pendingLoadCount!==s.resolvedLoadCount)}for(const s in this.asyncProps)if(this.isAsyncPropLoading(s))return!0;return!1}reloadAsyncProp(e,s){this._watchPromise(e,Promise.resolve(s))}setAsyncProps(e){const s=e[ASYNC_RESOLVED_SYMBOL]||{},o=e[ASYNC_ORIGINAL_SYMBOL]||e,a=e[ASYNC_DEFAULTS_SYMBOL]||{};for(const d in s){const g=s[d];this._createAsyncPropData(d,a[d]),this._updateAsyncProp(d,g),s[d]=this.getAsyncProp(d)}for(const d in o){const g=o[d];this._createAsyncPropData(d,a[d]),this._updateAsyncProp(d,g)}}_fetch(e,s){return null}_onResolve(e,s){}_onError(e,s){}_updateAsyncProp(e,s){if(this._didAsyncInputValueChange(e,s)){if(typeof s=="string"&&(s=this._fetch(e,s)),s instanceof Promise){this._watchPromise(e,s);return}if(isAsyncIterable(s)){this._resolveAsyncIterable(e,s);return}this._setPropValue(e,s)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,s){const o=this.asyncProps[e];return s===o.resolvedValue||s===o.lastValue?!1:(o.lastValue=s,!0)}_setPropValue(e,s){this._freezeAsyncOldProps();const o=this.asyncProps[e];o&&(s=this._postProcessValue(o,s),o.resolvedValue=s,o.pendingLoadCount++,o.resolvedLoadCount=o.pendingLoadCount)}_setAsyncPropValue(e,s,o){const a=this.asyncProps[e];a&&o>=a.resolvedLoadCount&&s!==void 0&&(this._freezeAsyncOldProps(),a.resolvedValue=s,a.resolvedLoadCount=o,this.onAsyncPropUpdated(e,s))}_watchPromise(e,s){const o=this.asyncProps[e];if(o){o.pendingLoadCount++;const a=o.pendingLoadCount;s.then(d=>{d=this._postProcessValue(o,d),this._setAsyncPropValue(e,d,a),this._onResolve(e,d)}).catch(d=>{this._onError(e,d)})}}async _resolveAsyncIterable(e,s){if(e!=="data"){this._setPropValue(e,s);return}const o=this.asyncProps[e];if(!o)return;o.pendingLoadCount++;const a=o.pendingLoadCount;let d=[],g=0;for await(const _ of s){const{dataTransform:j}=this.component.props;j?d=j(_,d):d=d.concat(_),Object.defineProperty(d,"__diff",{enumerable:!1,value:[{startRow:g,endRow:d.length}]}),g=d.length,this._setAsyncPropValue(e,d,a)}this._onResolve(e,d)}_postProcessValue(e,s){const o=e.type;return o&&(o.release&&o.release(e.resolvedValue,o,this.component),o.transform)?o.transform(s,o,this.component):s}_createAsyncPropData(e,s){if(!this.asyncProps[e]){const a=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:a&&a[e],lastValue:null,resolvedValue:s,pendingLoadCount:0,resolvedLoadCount:0}}}}class LayerState extends ComponentState{constructor({attributeManager:e,layer:s}){super(s),_defineProperty(this,"attributeManager",void 0),_defineProperty(this,"needsRedraw",void 0),_defineProperty(this,"needsUpdate",void 0),_defineProperty(this,"subLayers",void 0),_defineProperty(this,"usesPickingColorCache",void 0),_defineProperty(this,"changeFlags",void 0),_defineProperty(this,"viewport",void 0),_defineProperty(this,"uniformTransitions",void 0),_defineProperty(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,s){const o=this.component.props.fetch;return o?o(s,{propName:e,layer:this.layer}):super._fetch(e,s)}_onResolve(e,s){const o=this.component.props.onDataLoad;e==="data"&&o&&o(s,{propName:e,layer:this.layer})}_onError(e,s){this.layer.raiseError(s,"loading ".concat(e," of ").concat(this.layer))}}const TRACE_CHANGE_FLAG="layer.changeFlag",TRACE_INITIALIZE="layer.initialize",TRACE_UPDATE="layer.update",TRACE_FINALIZE="layer.finalize",TRACE_MATCHED="layer.matched",MAX_PICKING_COLOR_CACHE_SIZE=2**24-1,EMPTY_ARRAY=Object.freeze([]),areViewportsEqual=memoize(({oldViewport:i,viewport:e})=>i.equals(e));let pickingColorCache=new Uint8ClampedArray(0);const defaultProps$1={data:{type:"data",value:EMPTY_ARRAY,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(i,{propName:e,layer:s,loaders:o,loadOptions:a,signal:d})=>{const{resourceManager:g}=s.context;if(a=a||s.getLoadOptions(),o=o||s.props.loaders,d){var _;a={...a,fetch:{...(_=a)===null||_===void 0?void 0:_.fetch,signal:d}}}let j=g.contains(i);return!j&&!a&&(g.add({resourceId:i,data:load(i,o),persistent:!1}),j=!0),j?g.subscribe({resourceId:i,onChange:_e=>{var et;return(et=s.internalState)===null||et===void 0?void 0:et.reloadAsyncProp(e,_e)},consumerId:s.id,requestId:e}):load(i,o,a)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:OPERATION.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:COORDINATE_SYSTEM.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:i})=>[0,-i*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Layer extends Component{constructor(...e){super(...e),_defineProperty(this,"internalState",null),_defineProperty(this,"lifecycle",LIFECYCLE.NO_STATE),_defineProperty(this,"context",void 0),_defineProperty(this,"state",void 0),_defineProperty(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){assert(this.internalState);const s=this.internalState.viewport||this.context.viewport,o=getWorldPosition(e,{viewport:s,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[a,d,g]=worldToPixels(o,s.pixelProjectionMatrix);return e.length===2?[a,d]:[a,d,g]}unproject(e){return assert(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,s){assert(this.internalState);const o=this.internalState.viewport||this.context.viewport;return projectPosition(e,{viewport:o,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...s})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const s of this.getModels())s.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===COORDINATE_SYSTEM.DEFAULT||e===COORDINATE_SYSTEM.LNGLAT||e===COORDINATE_SYSTEM.CARTESIAN}onHover(e,s){return this.props.onHover&&this.props.onHover(e,s)||!1}onClick(e,s){return this.props.onClick&&this.props.onClick(e,s)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,s=[]){return s[0]=e+1&255,s[1]=e+1>>8&255,s[2]=e+1>>8>>8&255,s}decodePickingColor(e){assert(e instanceof Uint8Array);const[s,o,a]=e;return s+o*256+a*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:count(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const s=this.getAttributeManager();if(!s)return null;const{positions:o,instancePositions:a}=s.attributes;return(e=o||a)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const s of this.props.extensions)e=mergeShaders(e,s.getShaders.call(this,s));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const s=this.getAttributeManager(),{dataChanged:o}=e.changeFlags;if(o&&s)if(Array.isArray(o))for(const j of o)s.invalidateAll(j);else s.invalidateAll();const{props:a,oldProps:d}=e,g=Number.isInteger(d.highlightedObjectIndex)||d.pickable,_=Number.isInteger(a.highlightedObjectIndex)||a.pickable;if(g!==_&&s){const{pickingColors:j,instancePickingColors:_e}=s.attributes,et=j||_e;et&&(_&&et.constant&&(et.constant=!1,s.invalidate(et.id)),!et.value&&!_&&(et.constant=!0,et.value=[0,0,0]))}}finalizeState(e){for(const o of this.getModels())o.delete();const s=this.getAttributeManager();s&&s.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const s of this.getModels())s.draw(e)}getPickingInfo({info:e,mode:s,sourceLayer:o}){const{index:a}=e;return a>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[a]),e}raiseError(e,s){var o,a;if(s&&(e.message="".concat(s,": ").concat(e.message)),!((o=(a=this.props).onError)!==null&&o!==void 0&&o.call(a,e))){var d,g;(d=this.context)===null||d===void 0||(g=d.onError)===null||g===void 0||g.call(d,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const s=this.internalState.viewport;this.internalState.viewport=e,(!s||!areViewportsEqual({oldViewport:s,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const s=this.getAttributeManager();s&&(e==="all"?s.invalidateAll():s.invalidate(e))}updateAttributes(e){for(const s of this.getModels())this._setModelAttributes(s,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const s=this.props,o=this.getNumInstances(),a=this.getStartIndices();e.update({data:s.data,numInstances:o,startIndices:a,props:s,transitions:s.transitions,buffers:s.data.attributes,context:this});const d=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(d)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const s=e.update(),o=Object.create(this.props);for(const a in s)Object.defineProperty(o,a,{value:s[a]});return o}return this.props}calculateInstancePickingColors(e,{numInstances:s}){if(e.constant)return;const o=Math.floor(pickingColorCache.length/3);if(this.internalState.usesPickingColorCache=!0,o<s){s>MAX_PICKING_COLOR_CACHE_SIZE&&log.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),pickingColorCache=defaultTypedArrayManager.allocate(pickingColorCache,s,{size:3,copy:!0,maxCount:Math.max(s,MAX_PICKING_COLOR_CACHE_SIZE)});const a=Math.floor(pickingColorCache.length/3),d=[];for(let g=o;g<a;g++)this.encodePickingColor(g,d),pickingColorCache[g*3+0]=d[0],pickingColorCache[g*3+1]=d[1],pickingColorCache[g*3+2]=d[2]}e.value=pickingColorCache.subarray(0,s*3)}_setModelAttributes(e,s){const o=this.getAttributeManager(),a=e.userData.excludeAttributes||{},d=o.getShaderAttributes(s,a);e.setAttributes(d)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:s,instancePickingColors:o}=this.getAttributeManager().attributes,a=s||o;if(!a)return;const d=a.getVertexOffset(e),g=a.getVertexOffset(e+1);a.buffer.subData({data:new Uint8Array(g-d),offset:d})}restorePickingColors(){const{pickingColors:e,instancePickingColors:s}=this.getAttributeManager().attributes,o=e||s;o&&(this.internalState.usesPickingColorCache&&o.value.buffer!==pickingColorCache.buffer&&(o.value=pickingColorCache.subarray(0,o.value.length)),o.updateSubBuffer({startOffset:0}))}_initialize(){assert(!this.internalState),assert(Number.isFinite(this.props.coordinateSystem)),debug(TRACE_INITIALIZE,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new LayerState({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(log.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new UniformTransitionManager(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const s of this.props.extensions)s.initializeState.call(this,this.context,s);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){debug(TRACE_MATCHED,this,this===e);const{state:s,internalState:o}=e;this!==e&&(this.internalState=o,this.internalState.layer=this,this.state=s,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(debug(TRACE_UPDATE,this,e),!e)return;const s=this.props,o=this.context,a=this.internalState,d=o.viewport,g=this._updateUniformTransition();a.propsInTransition=g,o.viewport=a.viewport||d,this.props=g;try{const _=this._getUpdateParams(),j=this.getModels();if(o.gl)this.updateState(_);else try{this.updateState(_)}catch{}for(const et of this.props.extensions)et.updateState.call(this,_,et);const _e=this.getModels()[0]!==j[0];this._postUpdate(_,_e)}finally{o.viewport=d,this.props=s,this._clearChangeFlags(),a.needsUpdate=!1,a.resetOldProps()}}_finalize(){debug(TRACE_FINALIZE,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:s={},parameters:o={}}){this._updateAttributeTransition();const a=this.props,d=this.context;this.props=this.internalState.propsInTransition||a;const g=this.props.opacity;s.opacity=Math.pow(g,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:_}=this.props,j=_&&_(s)||[0,0];setParameters(d.gl,{polygonOffset:j}),withParameters(d.gl,o,()=>{const _e={moduleParameters:e,uniforms:s,parameters:o,context:d};for(const et of this.props.extensions)et.draw.call(this,_e,et);this.draw(_e)})}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:s}=this.internalState;for(const a in e)if(e[a]){let d=!1;switch(a){case"dataChanged":const g=e[a],_=s[a];g&&Array.isArray(_)&&(s.dataChanged=Array.isArray(g)?_.concat(g):g,d=!0);default:s[a]||(s[a]=e[a],d=!0)}d&&debug(TRACE_CHANGE_FLAG,this,a,e)}const o=!!(s.dataChanged||s.updateTriggersChanged||s.propsChanged||s.extensionsChanged);s.propsOrDataChanged=o,s.somethingChanged=o||s.viewportChanged||s.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,s){const o=diffProps(e,s);if(o.updateTriggersChanged)for(const d in o.updateTriggersChanged)o.updateTriggersChanged[d]&&this.invalidateAttribute(d);if(o.transitionsChanged)for(const d in o.transitionsChanged){var a;this.internalState.uniformTransitions.add(d,s[d],e[d],(a=e.transitions)===null||a===void 0?void 0:a[d])}return this.setChangeFlags(o)}validateProps(){validateProps(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const s={pickingSelectedColor:e.picked?e.color:null},{highlightColor:o}=this.props;e.picked&&typeof o=="function"&&(s.pickingHighlightColor=o(e)),this.setModuleParameters(s),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new AttributeManager(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,s){const{props:o,oldProps:a}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:d}=this.state;d==null||d.setInstanceCount(this.getNumInstances());const{autoHighlight:g,highlightedObjectIndex:_,highlightColor:j}=o;if(s||a.autoHighlight!==g||a.highlightedObjectIndex!==_||a.highlightColor!==j){const _e={};g||(_e.pickingSelectedColor=null),Array.isArray(j)&&(_e.pickingHighlightColor=j),Number.isInteger(_)&&(_e.pickingSelectedColor=Number.isFinite(_)&&_>=0?this.encodePickingColor(_):null),this.setModuleParameters(_e)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let s=!1;s=s||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const o=this.getAttributeManager(),a=o?o.getNeedsRedraw(e):!1;return s=s||a,s}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}_defineProperty(Layer,"defaultProps",defaultProps$1);_defineProperty(Layer,"layerName","Layer");const DEGREES_TO_RADIANS=Math.PI/180;function getViewMatrix({height:i,focalDistance:e,orbitAxis:s,rotationX:o,rotationOrbit:a,zoom:d}){const g=s==="Z"?[0,0,1]:[0,1,0],_=s==="Z"?[0,-e,0]:[0,0,e],j=new Matrix4().lookAt({eye:_,up:g});j.rotateX(o*DEGREES_TO_RADIANS),s==="Z"?j.rotateZ(a*DEGREES_TO_RADIANS):j.rotateY(a*DEGREES_TO_RADIANS);const _e=Math.pow(2,d)/i;return j.scale(_e),j}class OrbitViewport extends Viewport{constructor(e){const{height:s,projectionMatrix:o,fovy:a=50,orbitAxis:d="Z",target:g=[0,0,0],rotationX:_=0,rotationOrbit:j=0,zoom:_e=0}=e,et=o?o[5]/2:fovyToAltitude(a);super({...e,longitude:void 0,viewMatrix:getViewMatrix({height:s||1,focalDistance:et,orbitAxis:d,rotationX:_,rotationOrbit:j,zoom:_e}),fovy:a,focalDistance:et,position:g,zoom:_e}),_defineProperty(this,"projectedCenter",void 0),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:s=!0}={}){const[o,a,d=this.projectedCenter[2]]=e,g=s?a:this.height-a,[_,j,_e]=pixelsToWorld([o,g,d],this.pixelUnprojectionMatrix);return[_,j,_e]}panByPosition(e,s){const o=this.project(e),a=[this.width/2+o[0]-s[0],this.height/2+o[1]-s[1],this.projectedCenter[2]];return{target:this.unproject(a)}}}class OrbitView extends View{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}get ViewportType(){return OrbitViewport}get ControllerType(){return OrbitController}}_defineProperty(OrbitView,"displayName","OrbitView");class LayerExtension{constructor(e){_defineProperty(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&deepEqual(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:s}=e.constructor,o={updateTriggers:{}};for(const a in s)if(a in this.props){const d=s[a],g=this.props[a];o[a]=g,d&&d.type==="accessor"&&(o.updateTriggers[a]=this.props.updateTriggers[a],typeof g=="function"&&(o[a]=this.getSubLayerAccessor(g)))}return o}initializeState(e,s){}updateState(e,s){}draw(e,s){}finalizeState(e,s){}}_defineProperty(LayerExtension,"defaultProps",{});const vs=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,fs=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,DEFAULT_COLOR=[0,0,0,255],defaultProps={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:i=>i.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:DEFAULT_COLOR},getLineColor:{type:"accessor",value:DEFAULT_COLOR},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ScatterplotLayer extends Layer{getShaders(){return super.getShaders({vs,fs,modules:[project32,picking]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:s,radiusScale:o,radiusMinPixels:a,radiusMaxPixels:d,stroked:g,filled:_,billboard:j,antialiasing:_e,lineWidthUnits:et,lineWidthScale:tt,lineWidthMinPixels:rt,lineWidthMaxPixels:it}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:g?1:0,filled:_,billboard:j,antialiasing:_e,radiusUnits:UNIT[s],radiusScale:o,radiusMinPixels:a,radiusMaxPixels:d,lineWidthUnits:UNIT[et],lineWidthScale:tt,lineWidthMinPixels:rt,lineWidthMaxPixels:it}).draw()}_getModel(e){const s=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Model(e,{...this.getShaders(),id:this.props.id,geometry:new Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(s)}}}),isInstanced:!0})}}_defineProperty(ScatterplotLayer,"defaultProps",defaultProps);_defineProperty(ScatterplotLayer,"layerName","ScatterplotLayer");var reactExports={},react={get exports(){return reactExports},set exports(i){reactExports=i}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(i){return i===null||typeof i!="object"?null:(i=z$1&&i[z$1]||i["@@iterator"],typeof i=="function"?i:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(i,e,s){this.props=i,this.context=e,this.refs=D$1,this.updater=s||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};E$1.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(i,e,s){this.props=i,this.context=e,this.refs=D$1,this.updater=s||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(i,e,s){var o,a={},d=null,g=null;if(e!=null)for(o in e.ref!==void 0&&(g=e.ref),e.key!==void 0&&(d=""+e.key),e)J.call(e,o)&&!L$1.hasOwnProperty(o)&&(a[o]=e[o]);var _=arguments.length-2;if(_===1)a.children=s;else if(1<_){for(var j=Array(_),_e=0;_e<_;_e++)j[_e]=arguments[_e+2];a.children=j}if(i&&i.defaultProps)for(o in _=i.defaultProps,_)a[o]===void 0&&(a[o]=_[o]);return{$$typeof:l$1,type:i,key:d,ref:g,props:a,_owner:K$1.current}}function N$1(i,e){return{$$typeof:l$1,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function O$1(i){return typeof i=="object"&&i!==null&&i.$$typeof===l$1}function escape(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(s){return e[s]})}var P$1=/\/+/g;function Q$1(i,e){return typeof i=="object"&&i!==null&&i.key!=null?escape(""+i.key):e.toString(36)}function R$1(i,e,s,o,a){var d=typeof i;(d==="undefined"||d==="boolean")&&(i=null);var g=!1;if(i===null)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(i.$$typeof){case l$1:case n$1:g=!0}}if(g)return g=i,a=a(g),i=o===""?"."+Q$1(g,0):o,I$1(a)?(s="",i!=null&&(s=i.replace(P$1,"$&/")+"/"),R$1(a,e,s,"",function(_e){return _e})):a!=null&&(O$1(a)&&(a=N$1(a,s+(!a.key||g&&g.key===a.key?"":(""+a.key).replace(P$1,"$&/")+"/")+i)),e.push(a)),1;if(g=0,o=o===""?".":o+":",I$1(i))for(var _=0;_<i.length;_++){d=i[_];var j=o+Q$1(d,_);g+=R$1(d,e,s,j,a)}else if(j=A$1(i),typeof j=="function")for(i=j.call(i),_=0;!(d=i.next()).done;)d=d.value,j=o+Q$1(d,_++),g+=R$1(d,e,s,j,a);else if(d==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return g}function S$1(i,e,s){if(i==null)return i;var o=[],a=0;return R$1(i,o,"","",function(d){return e.call(s,d,a++)}),o}function T$1(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(s){(i._status===0||i._status===-1)&&(i._status=1,i._result=s)},function(s){(i._status===0||i._status===-1)&&(i._status=2,i._result=s)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function(i,e,s){S$1(i,function(){e.apply(this,arguments)},s)},count:function(i){var e=0;return S$1(i,function(){e++}),e},toArray:function(i){return S$1(i,function(e){return e})||[]},only:function(i){if(!O$1(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function(i,e,s){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var o=C$1({},i.props),a=i.key,d=i.ref,g=i._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,g=K$1.current),e.key!==void 0&&(a=""+e.key),i.type&&i.type.defaultProps)var _=i.type.defaultProps;for(j in e)J.call(e,j)&&!L$1.hasOwnProperty(j)&&(o[j]=e[j]===void 0&&_!==void 0?_[j]:e[j])}var j=arguments.length-2;if(j===1)o.children=s;else if(1<j){_=Array(j);for(var _e=0;_e<j;_e++)_[_e]=arguments[_e+2];o.children=_}return{$$typeof:l$1,type:i.type,key:a,ref:d,props:o,_owner:g}};react_production_min.createContext=function(i){return i={$$typeof:u,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:t,_context:i},i.Consumer=i};react_production_min.createElement=M$1;react_production_min.createFactory=function(i){var e=M$1.bind(null,i);return e.type=i,e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(i){return{$$typeof:v$1,render:i}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(i){return{$$typeof:y,_payload:{_status:-1,_result:i},_init:T$1}};react_production_min.memo=function(i,e){return{$$typeof:x,type:i,compare:e===void 0?null:e}};react_production_min.startTransition=function(i){var e=V$1.transition;V$1.transition={};try{i()}finally{V$1.transition=e}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(i,e){return U$1.current.useCallback(i,e)};react_production_min.useContext=function(i){return U$1.current.useContext(i)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(i){return U$1.current.useDeferredValue(i)};react_production_min.useEffect=function(i,e){return U$1.current.useEffect(i,e)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(i,e,s){return U$1.current.useImperativeHandle(i,e,s)};react_production_min.useInsertionEffect=function(i,e){return U$1.current.useInsertionEffect(i,e)};react_production_min.useLayoutEffect=function(i,e){return U$1.current.useLayoutEffect(i,e)};react_production_min.useMemo=function(i,e){return U$1.current.useMemo(i,e)};react_production_min.useReducer=function(i,e,s){return U$1.current.useReducer(i,e,s)};react_production_min.useRef=function(i){return U$1.current.useRef(i)};react_production_min.useState=function(i){return U$1.current.useState(i)};react_production_min.useSyncExternalStore=function(i,e,s){return U$1.current.useSyncExternalStore(i,e,s)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";(function(i){i.exports=react_production_min})(react);var jsxRuntimeExports={},jsxRuntime={get exports(){return jsxRuntimeExports},set exports(i){jsxRuntimeExports=i}},reactJsxRuntime_production_min={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(i,e,s){var o,a={},d=null,g=null;s!==void 0&&(d=""+s),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(g=e.ref);for(o in e)m$1.call(e,o)&&!p$1.hasOwnProperty(o)&&(a[o]=e[o]);if(i&&i.defaultProps)for(o in e=i.defaultProps,e)a[o]===void 0&&(a[o]=e[o]);return{$$typeof:k,type:i,key:d,ref:g,props:a,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;(function(i){i.exports=reactJsxRuntime_production_min})(jsxRuntime);const jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;var reactDomExports={},reactDom={get exports(){return reactDomExports},set exports(i){reactDomExports=i}},reactDom_production_min={},schedulerExports={},scheduler={get exports(){return schedulerExports},set exports(i){schedulerExports=i}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(cr,lr){var Fr=cr.length;cr.push(lr);e:for(;0<Fr;){var an=Fr-1>>>1,kn=cr[an];if(0<a(kn,lr))cr[an]=lr,cr[Fr]=kn,Fr=an;else break e}}function s(cr){return cr.length===0?null:cr[0]}function o(cr){if(cr.length===0)return null;var lr=cr[0],Fr=cr.pop();if(Fr!==lr){cr[0]=Fr;e:for(var an=0,kn=cr.length,ms=kn>>>1;an<ms;){var Zn=2*(an+1)-1,As=cr[Zn],Rs=Zn+1,Gn=cr[Rs];if(0>a(As,Fr))Rs<kn&&0>a(Gn,As)?(cr[an]=Gn,cr[Rs]=Fr,an=Rs):(cr[an]=As,cr[Zn]=Fr,an=Zn);else if(Rs<kn&&0>a(Gn,Fr))cr[an]=Gn,cr[Rs]=Fr,an=Rs;else break e}}return lr}function a(cr,lr){var Fr=cr.sortIndex-lr.sortIndex;return Fr!==0?Fr:cr.id-lr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;i.unstable_now=function(){return d.now()}}else{var g=Date,_=g.now();i.unstable_now=function(){return g.now()-_}}var j=[],_e=[],et=1,tt=null,rt=3,it=!1,ot=!1,ct=!1,ft=typeof setTimeout=="function"?setTimeout:null,dt=typeof clearTimeout=="function"?clearTimeout:null,pt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function gt(cr){for(var lr=s(_e);lr!==null;){if(lr.callback===null)o(_e);else if(lr.startTime<=cr)o(_e),lr.sortIndex=lr.expirationTime,e(j,lr);else break;lr=s(_e)}}function Ct(cr){if(ct=!1,gt(cr),!ot)if(s(j)!==null)ot=!0,Zr(xt);else{var lr=s(_e);lr!==null&&Hr(Ct,lr.startTime-cr)}}function xt(cr,lr){ot=!1,ct&&(ct=!1,dt(Ht),Ht=-1),it=!0;var Fr=rt;try{for(gt(lr),tt=s(j);tt!==null&&(!(tt.expirationTime>lr)||cr&&!hr());){var an=tt.callback;if(typeof an=="function"){tt.callback=null,rt=tt.priorityLevel;var kn=an(tt.expirationTime<=lr);lr=i.unstable_now(),typeof kn=="function"?tt.callback=kn:tt===s(j)&&o(j),gt(lr)}else o(j);tt=s(j)}if(tt!==null)var ms=!0;else{var Zn=s(_e);Zn!==null&&Hr(Ct,Zn.startTime-lr),ms=!1}return ms}finally{tt=null,rt=Fr,it=!1}}var at=!1,Bt=null,Ht=-1,sr=5,mr=-1;function hr(){return!(i.unstable_now()-mr<sr)}function Er(){if(Bt!==null){var cr=i.unstable_now();mr=cr;var lr=!0;try{lr=Bt(!0,cr)}finally{lr?Lr():(at=!1,Bt=null)}}else at=!1}var Lr;if(typeof pt=="function")Lr=function(){pt(Er)};else if(typeof MessageChannel<"u"){var sn=new MessageChannel,vr=sn.port2;sn.port1.onmessage=Er,Lr=function(){vr.postMessage(null)}}else Lr=function(){ft(Er,0)};function Zr(cr){Bt=cr,at||(at=!0,Lr())}function Hr(cr,lr){Ht=ft(function(){cr(i.unstable_now())},lr)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(cr){cr.callback=null},i.unstable_continueExecution=function(){ot||it||(ot=!0,Zr(xt))},i.unstable_forceFrameRate=function(cr){0>cr||125<cr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):sr=0<cr?Math.floor(1e3/cr):5},i.unstable_getCurrentPriorityLevel=function(){return rt},i.unstable_getFirstCallbackNode=function(){return s(j)},i.unstable_next=function(cr){switch(rt){case 1:case 2:case 3:var lr=3;break;default:lr=rt}var Fr=rt;rt=lr;try{return cr()}finally{rt=Fr}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(cr,lr){switch(cr){case 1:case 2:case 3:case 4:case 5:break;default:cr=3}var Fr=rt;rt=cr;try{return lr()}finally{rt=Fr}},i.unstable_scheduleCallback=function(cr,lr,Fr){var an=i.unstable_now();switch(typeof Fr=="object"&&Fr!==null?(Fr=Fr.delay,Fr=typeof Fr=="number"&&0<Fr?an+Fr:an):Fr=an,cr){case 1:var kn=-1;break;case 2:kn=250;break;case 5:kn=1073741823;break;case 4:kn=1e4;break;default:kn=5e3}return kn=Fr+kn,cr={id:et++,callback:lr,priorityLevel:cr,startTime:Fr,expirationTime:kn,sortIndex:-1},Fr>an?(cr.sortIndex=Fr,e(_e,cr),s(j)===null&&cr===s(_e)&&(ct?(dt(Ht),Ht=-1):ct=!0,Hr(Ct,Fr-an))):(cr.sortIndex=kn,e(j,cr),ot||it||(ot=!0,Zr(xt))),cr},i.unstable_shouldYield=hr,i.unstable_wrapCallback=function(cr){var lr=rt;return function(){var Fr=rt;rt=lr;try{return cr.apply(this,arguments)}finally{rt=Fr}}}})(scheduler_production_min);(function(i){i.exports=scheduler_production_min})(scheduler);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,s=1;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(i,e){ha(i,e),ha(i+"Capture",e)}function ha(i,e){for(ea[i]=e,i=0;i<e.length;i++)da.add(e[i])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(i){return ja.call(ma,i)?!0:ja.call(la,i)?!1:ka.test(i)?ma[i]=!0:(la[i]=!0,!1)}function pa(i,e,s,o){if(s!==null&&s.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return o?!1:s!==null?!s.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function qa(i,e,s,o){if(e===null||typeof e>"u"||pa(i,e,s,o))return!0;if(o)return!1;if(s!==null)switch(s.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function v(i,e,s,o,a,d,g){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=o,this.attributeNamespace=a,this.mustUseProperty=s,this.propertyName=i,this.type=e,this.sanitizeURL=d,this.removeEmptyString=g}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){z[i]=new v(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];z[e]=new v(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){z[i]=new v(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){z[i]=new v(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){z[i]=new v(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){z[i]=new v(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){z[i]=new v(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){z[i]=new v(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){z[i]=new v(i,5,!1,i.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(ra,sa);z[e]=new v(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(ra,sa);z[e]=new v(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(ra,sa);z[e]=new v(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){z[i]=new v(i,1,!1,i.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){z[i]=new v(i,1,!1,i.toLowerCase(),null,!0,!0)});function ta(i,e,s,o){var a=z.hasOwnProperty(e)?z[e]:null;(a!==null?a.type!==0:o||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qa(e,s,a,o)&&(s=null),o||a===null?oa(e)&&(s===null?i.removeAttribute(e):i.setAttribute(e,""+s)):a.mustUseProperty?i[a.propertyName]=s===null?a.type===3?!1:"":s:(e=a.attributeName,o=a.attributeNamespace,s===null?i.removeAttribute(e):(a=a.type,s=a===3||a===4&&s===!0?"":""+s,o?i.setAttributeNS(o,e,s):i.setAttribute(e,s))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(i){return i===null||typeof i!="object"?null:(i=Ja&&i[Ja]||i["@@iterator"],typeof i=="function"?i:null)}var A=Object.assign,La;function Ma(i){if(La===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);La=e&&e[1]||""}return`
`+La+i}var Na=!1;function Oa(i,e){if(!i||Na)return"";Na=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(_e){var o=_e}Reflect.construct(i,[],e)}else{try{e.call()}catch(_e){o=_e}i.call(e.prototype)}else{try{throw Error()}catch(_e){o=_e}i()}}catch(_e){if(_e&&o&&typeof _e.stack=="string"){for(var a=_e.stack.split(`
`),d=o.stack.split(`
`),g=a.length-1,_=d.length-1;1<=g&&0<=_&&a[g]!==d[_];)_--;for(;1<=g&&0<=_;g--,_--)if(a[g]!==d[_]){if(g!==1||_!==1)do if(g--,_--,0>_||a[g]!==d[_]){var j=`
`+a[g].replace(" at new "," at ");return i.displayName&&j.includes("<anonymous>")&&(j=j.replace("<anonymous>",i.displayName)),j}while(1<=g&&0<=_);break}}}finally{Na=!1,Error.prepareStackTrace=s}return(i=i?i.displayName||i.name:"")?Ma(i):""}function Pa(i){switch(i.tag){case 5:return Ma(i.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return i=Oa(i.type,!1),i;case 11:return i=Oa(i.type.render,!1),i;case 1:return i=Oa(i.type,!0),i;default:return""}}function Qa(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Ca:return(i.displayName||"Context")+".Consumer";case Ba:return(i._context.displayName||"Context")+".Provider";case Da:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Ga:return e=i.displayName||null,e!==null?e:Qa(i.type)||"Memo";case Ha:e=i._payload,i=i._init;try{return Qa(i(e))}catch{}}return null}function Ra(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(e);case 8:return e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Ta(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ua(i){var e=Ta(i)?"checked":"value",s=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),o=""+i[e];if(!i.hasOwnProperty(e)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var a=s.get,d=s.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return a.call(this)},set:function(g){o=""+g,d.call(this,g)}}),Object.defineProperty(i,e,{enumerable:s.enumerable}),{getValue:function(){return o},setValue:function(g){o=""+g},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Va(i){i._valueTracker||(i._valueTracker=Ua(i))}function Wa(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var s=e.getValue(),o="";return i&&(o=Ta(i)?i.checked?"true":"false":i.value),i=o,i!==s?(e.setValue(i),!0):!1}function Xa(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Ya(i,e){var s=e.checked;return A({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??i._wrapperState.initialChecked})}function Za(i,e){var s=e.defaultValue==null?"":e.defaultValue,o=e.checked!=null?e.checked:e.defaultChecked;s=Sa(e.value!=null?e.value:s),i._wrapperState={initialChecked:o,initialValue:s,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ab(i,e){e=e.checked,e!=null&&ta(i,"checked",e,!1)}function bb(i,e){ab(i,e);var s=Sa(e.value),o=e.type;if(s!=null)o==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+s):i.value!==""+s&&(i.value=""+s);else if(o==="submit"||o==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?cb(i,e.type,s):e.hasOwnProperty("defaultValue")&&cb(i,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function db(i,e,s){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var o=e.type;if(!(o!=="submit"&&o!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,s||e===i.value||(i.value=e),i.defaultValue=e}s=i.name,s!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,s!==""&&(i.name=s)}function cb(i,e,s){(e!=="number"||Xa(i.ownerDocument)!==i)&&(s==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+s&&(i.defaultValue=""+s))}var eb=Array.isArray;function fb(i,e,s,o){if(i=i.options,e){e={};for(var a=0;a<s.length;a++)e["$"+s[a]]=!0;for(s=0;s<i.length;s++)a=e.hasOwnProperty("$"+i[s].value),i[s].selected!==a&&(i[s].selected=a),a&&o&&(i[s].defaultSelected=!0)}else{for(s=""+Sa(s),e=null,a=0;a<i.length;a++){if(i[a].value===s){i[a].selected=!0,o&&(i[a].defaultSelected=!0);return}e!==null||i[a].disabled||(e=i[a])}e!==null&&(e.selected=!0)}}function gb(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function hb(i,e){var s=e.value;if(s==null){if(s=e.children,e=e.defaultValue,s!=null){if(e!=null)throw Error(p(92));if(eb(s)){if(1<s.length)throw Error(p(93));s=s[0]}e=s}e==null&&(e=""),s=e}i._wrapperState={initialValue:Sa(s)}}function ib(i,e){var s=Sa(e.value),o=Sa(e.defaultValue);s!=null&&(s=""+s,s!==i.value&&(i.value=s),e.defaultValue==null&&i.defaultValue!==s&&(i.defaultValue=s)),o!=null&&(i.defaultValue=""+o)}function jb(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function kb(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?kb(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var mb,nb=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,s,o,a){MSApp.execUnsafeLocalFunction(function(){return i(e,s,o,a)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mb.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function ob(i,e){if(e){var s=i.firstChild;if(s&&s===i.lastChild&&s.nodeType===3){s.nodeValue=e;return}}i.textContent=e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(i){qb.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),pb[e]=pb[i]})});function rb(i,e,s){return e==null||typeof e=="boolean"||e===""?"":s||typeof e!="number"||e===0||pb.hasOwnProperty(i)&&pb[i]?(""+e).trim():e+"px"}function sb(i,e){i=i.style;for(var s in e)if(e.hasOwnProperty(s)){var o=s.indexOf("--")===0,a=rb(s,e[s],o);s==="float"&&(s="cssFloat"),o?i.setProperty(s,a):i[s]=a}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(i,e){if(e){if(tb[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(p(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(p(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(p(61))}if(e.style!=null&&typeof e.style!="object")throw Error(p(62))}}function vb(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var yb=null,zb=null,Ab=null;function Bb(i){if(i=Cb(i)){if(typeof yb!="function")throw Error(p(280));var e=i.stateNode;e&&(e=Db(e),yb(i.stateNode,i.type,e))}}function Eb(i){zb?Ab?Ab.push(i):Ab=[i]:zb=i}function Fb(){if(zb){var i=zb,e=Ab;if(Ab=zb=null,Bb(i),e)for(i=0;i<e.length;i++)Bb(e[i])}}function Gb(i,e){return i(e)}function Hb(){}var Ib=!1;function Jb(i,e,s){if(Ib)return i(e,s);Ib=!0;try{return Gb(i,e,s)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(i,e){var s=i.stateNode;if(s===null)return null;var o=Db(s);if(o===null)return null;s=o[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(i=i.type,o=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!o;break e;default:i=!1}if(i)return null;if(s&&typeof s!="function")throw Error(p(231,e,typeof s));return s}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch(i){Lb=!1}function Nb(i,e,s,o,a,d,g,_,j){var _e=Array.prototype.slice.call(arguments,3);try{e.apply(s,_e)}catch(et){this.onError(et)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(i){Ob=!0,Pb=i}};function Tb(i,e,s,o,a,d,g,_,j){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(i,e,s,o,a,d,g,_,j){if(Tb.apply(this,arguments),Ob){if(Ob){var _e=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=_e)}}function Vb(i){var e=i,s=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(s=e.return),i=e.return;while(i)}return e.tag===3?s:null}function Wb(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function Xb(i){if(Vb(i)!==i)throw Error(p(188))}function Yb(i){var e=i.alternate;if(!e){if(e=Vb(i),e===null)throw Error(p(188));return e!==i?null:i}for(var s=i,o=e;;){var a=s.return;if(a===null)break;var d=a.alternate;if(d===null){if(o=a.return,o!==null){s=o;continue}break}if(a.child===d.child){for(d=a.child;d;){if(d===s)return Xb(a),i;if(d===o)return Xb(a),e;d=d.sibling}throw Error(p(188))}if(s.return!==o.return)s=a,o=d;else{for(var g=!1,_=a.child;_;){if(_===s){g=!0,s=a,o=d;break}if(_===o){g=!0,o=a,s=d;break}_=_.sibling}if(!g){for(_=d.child;_;){if(_===s){g=!0,s=d,o=a;break}if(_===o){g=!0,o=d,s=a;break}_=_.sibling}if(!g)throw Error(p(189))}}if(s.alternate!==o)throw Error(p(190))}if(s.tag!==3)throw Error(p(188));return s.stateNode.current===s?i:e}function Zb(i){return i=Yb(i),i!==null?$b(i):null}function $b(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=$b(i);if(e!==null)return e;i=i.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(i){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,i,void 0,(i.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(i){return i>>>=0,i===0?32:31-(pc(i)/qc|0)|0}var rc=64,sc=4194304;function tc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function uc(i,e){var s=i.pendingLanes;if(s===0)return 0;var o=0,a=i.suspendedLanes,d=i.pingedLanes,g=s&268435455;if(g!==0){var _=g&~a;_!==0?o=tc(_):(d&=g,d!==0&&(o=tc(d)))}else g=s&~a,g!==0?o=tc(g):d!==0&&(o=tc(d));if(o===0)return 0;if(e!==0&&e!==o&&!(e&a)&&(a=o&-o,d=e&-e,a>=d||a===16&&(d&4194240)!==0))return e;if(o&4&&(o|=s&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=o;0<e;)s=31-oc(e),a=1<<s,o|=i[s],e&=~a;return o}function vc(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(i,e){for(var s=i.suspendedLanes,o=i.pingedLanes,a=i.expirationTimes,d=i.pendingLanes;0<d;){var g=31-oc(d),_=1<<g,j=a[g];j===-1?(!(_&s)||_&o)&&(a[g]=vc(_,e)):j<=e&&(i.expiredLanes|=_),d&=~_}}function xc(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function yc(){var i=rc;return rc<<=1,!(rc&4194240)&&(rc=64),i}function zc(i){for(var e=[],s=0;31>s;s++)e.push(i);return e}function Ac(i,e,s){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-oc(e),i[e]=s}function Bc(i,e){var s=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var o=i.eventTimes;for(i=i.expirationTimes;0<s;){var a=31-oc(s),d=1<<a;e[a]=0,o[a]=-1,i[a]=-1,s&=~d}}function Cc(i,e){var s=i.entangledLanes|=e;for(i=i.entanglements;s;){var o=31-oc(s),a=1<<o;a&e|i[o]&e&&(i[o]|=e),s&=~a}}var C=0;function Dc(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(i,e){switch(i){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(e.pointerId)}}function Tc(i,e,s,o,a,d){return i===null||i.nativeEvent!==d?(i={blockedOn:e,domEventName:s,eventSystemFlags:o,nativeEvent:d,targetContainers:[a]},e!==null&&(e=Cb(e),e!==null&&Fc(e)),i):(i.eventSystemFlags|=o,e=i.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),i)}function Uc(i,e,s,o,a){switch(e){case"focusin":return Lc=Tc(Lc,i,e,s,o,a),!0;case"dragenter":return Mc=Tc(Mc,i,e,s,o,a),!0;case"mouseover":return Nc=Tc(Nc,i,e,s,o,a),!0;case"pointerover":var d=a.pointerId;return Oc.set(d,Tc(Oc.get(d)||null,i,e,s,o,a)),!0;case"gotpointercapture":return d=a.pointerId,Pc.set(d,Tc(Pc.get(d)||null,i,e,s,o,a)),!0}return!1}function Vc(i){var e=Wc(i.target);if(e!==null){var s=Vb(e);if(s!==null){if(e=s.tag,e===13){if(e=Wb(s),e!==null){i.blockedOn=e,Ic(i.priority,function(){Gc(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){i.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Xc(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var s=Yc(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(s===null){s=i.nativeEvent;var o=new s.constructor(s.type,s);wb=o,s.target.dispatchEvent(o),wb=null}else return e=Cb(s),e!==null&&Fc(e),i.blockedOn=s,!1;e.shift()}return!0}function Zc(i,e,s){Xc(i)&&s.delete(e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(i,e){i.blockedOn===e&&(i.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(i){function e(a){return ad(a,i)}if(0<Kc.length){ad(Kc[0],i);for(var s=1;s<Kc.length;s++){var o=Kc[s];o.blockedOn===i&&(o.blockedOn=null)}}for(Lc!==null&&ad(Lc,i),Mc!==null&&ad(Mc,i),Nc!==null&&ad(Nc,i),Oc.forEach(e),Pc.forEach(e),s=0;s<Qc.length;s++)o=Qc[s],o.blockedOn===i&&(o.blockedOn=null);for(;0<Qc.length&&(s=Qc[0],s.blockedOn===null);)Vc(s),s.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(i,e,s,o){var a=C,d=cd.transition;cd.transition=null;try{C=1,fd(i,e,s,o)}finally{C=a,cd.transition=d}}function gd(i,e,s,o){var a=C,d=cd.transition;cd.transition=null;try{C=4,fd(i,e,s,o)}finally{C=a,cd.transition=d}}function fd(i,e,s,o){if(dd){var a=Yc(i,e,s,o);if(a===null)hd(i,e,o,id,s),Sc(i,o);else if(Uc(a,i,e,s,o))o.stopPropagation();else if(Sc(i,o),e&4&&-1<Rc.indexOf(i)){for(;a!==null;){var d=Cb(a);if(d!==null&&Ec(d),d=Yc(i,e,s,o),d===null&&hd(i,e,o,id,s),d===a)break;a=d}a!==null&&o.stopPropagation()}else hd(i,e,o,null,s)}}var id=null;function Yc(i,e,s,o){if(id=null,i=xb(o),i=Wc(i),i!==null)if(e=Vb(i),e===null)i=null;else if(s=e.tag,s===13){if(i=Wb(e),i!==null)return i;i=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return id=i,null}function jd(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var i,e=ld,s=e.length,o,a="value"in kd?kd.value:kd.textContent,d=a.length;for(i=0;i<s&&e[i]===a[i];i++);var g=s-i;for(o=1;o<=g&&e[s-o]===a[d-o];o++);return md=a.slice(i,1<o?1-o:void 0)}function od(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function pd(){return!0}function qd(){return!1}function rd(i){function e(s,o,a,d,g){this._reactName=s,this._targetInst=a,this.type=o,this.nativeEvent=d,this.target=g,this.currentTarget=null;for(var _ in i)i.hasOwnProperty(_)&&(s=i[_],this[_]=s?s(d):d[_]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==yd&&(yd&&i.type==="mousemove"?(wd=i.screenX-yd.screenX,xd=i.screenY-yd.screenY):xd=wd=0,yd=i),wd)},movementY:function(i){return"movementY"in i?i.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=Od[i])?!!e[i]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(i){if(i.key){var e=Md[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=od(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Nd[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(i){return i.type==="keypress"?od(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?od(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(i,e){switch(i){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ie=!1;function je(i,e){switch(i){case"compositionend":return he(e);case"keypress":return e.which!==32?null:(fe=!0,ee);case"textInput":return i=e.data,i===ee&&fe?null:i;default:return null}}function ke(i,e){if(ie)return i==="compositionend"||!ae&&ge(i,e)?(i=nd(),md=ld=kd=null,ie=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return de&&e.locale!=="ko"?null:e.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!le[i.type]:e==="textarea"}function ne(i,e,s,o){Eb(o),e=oe(e,"onChange"),0<e.length&&(s=new td("onChange","change",null,s,o),i.push({event:s,listeners:e}))}var pe=null,qe=null;function re(i){se(i,0)}function te(i){var e=ue(i);if(Wa(e))return i}function ve(i,e){if(i==="change")return e}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(i){if(i.propertyName==="value"&&te(qe)){var e=[];ne(e,qe,i,xb(i)),Jb(re,e)}}function Ce(i,e,s){i==="focusin"?(Ae(),pe=e,qe=s,pe.attachEvent("onpropertychange",Be)):i==="focusout"&&Ae()}function De(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return te(qe)}function Ee(i,e){if(i==="click")return te(e)}function Fe(i,e){if(i==="input"||i==="change")return te(e)}function Ge(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(i,e){if(He(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var s=Object.keys(i),o=Object.keys(e);if(s.length!==o.length)return!1;for(o=0;o<s.length;o++){var a=s[o];if(!ja.call(e,a)||!He(i[a],e[a]))return!1}return!0}function Je(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Ke(i,e){var s=Je(i);i=0;for(var o;s;){if(s.nodeType===3){if(o=i+s.textContent.length,i<=e&&o>=e)return{node:s,offset:e-i};i=o}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Je(s)}}function Le(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?Le(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function Me(){for(var i=window,e=Xa();e instanceof i.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)i=e.contentWindow;else break;e=Xa(i.document)}return e}function Ne(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function Oe(i){var e=Me(),s=i.focusedElem,o=i.selectionRange;if(e!==s&&s&&s.ownerDocument&&Le(s.ownerDocument.documentElement,s)){if(o!==null&&Ne(s)){if(e=o.start,i=o.end,i===void 0&&(i=e),"selectionStart"in s)s.selectionStart=e,s.selectionEnd=Math.min(i,s.value.length);else if(i=(e=s.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var a=s.textContent.length,d=Math.min(o.start,a);o=o.end===void 0?d:Math.min(o.end,a),!i.extend&&d>o&&(a=o,o=d,d=a),a=Ke(s,d);var g=Ke(s,o);a&&g&&(i.rangeCount!==1||i.anchorNode!==a.node||i.anchorOffset!==a.offset||i.focusNode!==g.node||i.focusOffset!==g.offset)&&(e=e.createRange(),e.setStart(a.node,a.offset),i.removeAllRanges(),d>o?(i.addRange(e),i.extend(g.node,g.offset)):(e.setEnd(g.node,g.offset),i.addRange(e)))}}for(e=[],i=s;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<e.length;s++)i=e[s],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(i,e,s){var o=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Te||Qe==null||Qe!==Xa(o)||(o=Qe,"selectionStart"in o&&Ne(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Se&&Ie(Se,o)||(Se=o,o=oe(Re,"onSelect"),0<o.length&&(e=new td("onSelect","select",null,e,s),i.push({event:e,listeners:o}),e.target=Qe)))}function Ve(i,e){var s={};return s[i.toLowerCase()]=e.toLowerCase(),s["Webkit"+i]="webkit"+e,s["Moz"+i]="moz"+e,s}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(i){if(Xe[i])return Xe[i];if(!We[i])return i;var e=We[i],s;for(s in e)if(e.hasOwnProperty(s)&&s in Ye)return Xe[i]=e[s];return i}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(i,e){df.set(i,e),fa(e,[i])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(i,e,s){var o=i.type||"unknown-event";i.currentTarget=s,Ub(o,e,void 0,i),i.currentTarget=null}function se(i,e){e=(e&4)!==0;for(var s=0;s<i.length;s++){var o=i[s],a=o.event;o=o.listeners;e:{var d=void 0;if(e)for(var g=o.length-1;0<=g;g--){var _=o[g],j=_.instance,_e=_.currentTarget;if(_=_.listener,j!==d&&a.isPropagationStopped())break e;nf(a,_,_e),d=j}else for(g=0;g<o.length;g++){if(_=o[g],j=_.instance,_e=_.currentTarget,_=_.listener,j!==d&&a.isPropagationStopped())break e;nf(a,_,_e),d=j}}}if(Qb)throw i=Rb,Qb=!1,Rb=null,i}function D(i,e){var s=e[of];s===void 0&&(s=e[of]=new Set);var o=i+"__bubble";s.has(o)||(pf(e,i,2,!1),s.add(o))}function qf(i,e,s){var o=0;e&&(o|=4),pf(s,i,o,e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(i){if(!i[rf]){i[rf]=!0,da.forEach(function(s){s!=="selectionchange"&&(mf.has(s)||qf(s,!1,i),qf(s,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[rf]||(e[rf]=!0,qf("selectionchange",!1,e))}}function pf(i,e,s,o){switch(jd(e)){case 1:var a=ed;break;case 4:a=gd;break;default:a=fd}s=a.bind(null,e,s,i),a=void 0,!Lb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),o?a!==void 0?i.addEventListener(e,s,{capture:!0,passive:a}):i.addEventListener(e,s,!0):a!==void 0?i.addEventListener(e,s,{passive:a}):i.addEventListener(e,s,!1)}function hd(i,e,s,o,a){var d=o;if(!(e&1)&&!(e&2)&&o!==null)e:for(;;){if(o===null)return;var g=o.tag;if(g===3||g===4){var _=o.stateNode.containerInfo;if(_===a||_.nodeType===8&&_.parentNode===a)break;if(g===4)for(g=o.return;g!==null;){var j=g.tag;if((j===3||j===4)&&(j=g.stateNode.containerInfo,j===a||j.nodeType===8&&j.parentNode===a))return;g=g.return}for(;_!==null;){if(g=Wc(_),g===null)return;if(j=g.tag,j===5||j===6){o=d=g;continue e}_=_.parentNode}}o=o.return}Jb(function(){var _e=d,et=xb(s),tt=[];e:{var rt=df.get(i);if(rt!==void 0){var it=td,ot=i;switch(i){case"keypress":if(od(s)===0)break e;case"keydown":case"keyup":it=Rd;break;case"focusin":ot="focus",it=Fd;break;case"focusout":ot="blur",it=Fd;break;case"beforeblur":case"afterblur":it=Fd;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":it=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":it=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":it=Vd;break;case $e:case af:case bf:it=Hd;break;case cf:it=Xd;break;case"scroll":it=vd;break;case"wheel":it=Zd;break;case"copy":case"cut":case"paste":it=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":it=Td}var ct=(e&4)!==0,ft=!ct&&i==="scroll",dt=ct?rt!==null?rt+"Capture":null:rt;ct=[];for(var pt=_e,gt;pt!==null;){gt=pt;var Ct=gt.stateNode;if(gt.tag===5&&Ct!==null&&(gt=Ct,dt!==null&&(Ct=Kb(pt,dt),Ct!=null&&ct.push(tf(pt,Ct,gt)))),ft)break;pt=pt.return}0<ct.length&&(rt=new it(rt,ot,null,s,et),tt.push({event:rt,listeners:ct}))}}if(!(e&7)){e:{if(rt=i==="mouseover"||i==="pointerover",it=i==="mouseout"||i==="pointerout",rt&&s!==wb&&(ot=s.relatedTarget||s.fromElement)&&(Wc(ot)||ot[uf]))break e;if((it||rt)&&(rt=et.window===et?et:(rt=et.ownerDocument)?rt.defaultView||rt.parentWindow:window,it?(ot=s.relatedTarget||s.toElement,it=_e,ot=ot?Wc(ot):null,ot!==null&&(ft=Vb(ot),ot!==ft||ot.tag!==5&&ot.tag!==6)&&(ot=null)):(it=null,ot=_e),it!==ot)){if(ct=Bd,Ct="onMouseLeave",dt="onMouseEnter",pt="mouse",(i==="pointerout"||i==="pointerover")&&(ct=Td,Ct="onPointerLeave",dt="onPointerEnter",pt="pointer"),ft=it==null?rt:ue(it),gt=ot==null?rt:ue(ot),rt=new ct(Ct,pt+"leave",it,s,et),rt.target=ft,rt.relatedTarget=gt,Ct=null,Wc(et)===_e&&(ct=new ct(dt,pt+"enter",ot,s,et),ct.target=gt,ct.relatedTarget=ft,Ct=ct),ft=Ct,it&&ot)t:{for(ct=it,dt=ot,pt=0,gt=ct;gt;gt=vf(gt))pt++;for(gt=0,Ct=dt;Ct;Ct=vf(Ct))gt++;for(;0<pt-gt;)ct=vf(ct),pt--;for(;0<gt-pt;)dt=vf(dt),gt--;for(;pt--;){if(ct===dt||dt!==null&&ct===dt.alternate)break t;ct=vf(ct),dt=vf(dt)}ct=null}else ct=null;it!==null&&wf(tt,rt,it,ct,!1),ot!==null&&ft!==null&&wf(tt,ft,ot,ct,!0)}}e:{if(rt=_e?ue(_e):window,it=rt.nodeName&&rt.nodeName.toLowerCase(),it==="select"||it==="input"&&rt.type==="file")var xt=ve;else if(me(rt))if(we)xt=Fe;else{xt=De;var at=Ce}else(it=rt.nodeName)&&it.toLowerCase()==="input"&&(rt.type==="checkbox"||rt.type==="radio")&&(xt=Ee);if(xt&&(xt=xt(i,_e))){ne(tt,xt,s,et);break e}at&&at(i,rt,_e),i==="focusout"&&(at=rt._wrapperState)&&at.controlled&&rt.type==="number"&&cb(rt,"number",rt.value)}switch(at=_e?ue(_e):window,i){case"focusin":(me(at)||at.contentEditable==="true")&&(Qe=at,Re=_e,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(tt,s,et);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(tt,s,et)}var Bt;if(ae)e:{switch(i){case"compositionstart":var Ht="onCompositionStart";break e;case"compositionend":Ht="onCompositionEnd";break e;case"compositionupdate":Ht="onCompositionUpdate";break e}Ht=void 0}else ie?ge(i,s)&&(Ht="onCompositionEnd"):i==="keydown"&&s.keyCode===229&&(Ht="onCompositionStart");Ht&&(de&&s.locale!=="ko"&&(ie||Ht!=="onCompositionStart"?Ht==="onCompositionEnd"&&ie&&(Bt=nd()):(kd=et,ld="value"in kd?kd.value:kd.textContent,ie=!0)),at=oe(_e,Ht),0<at.length&&(Ht=new Ld(Ht,i,null,s,et),tt.push({event:Ht,listeners:at}),Bt?Ht.data=Bt:(Bt=he(s),Bt!==null&&(Ht.data=Bt)))),(Bt=ce?je(i,s):ke(i,s))&&(_e=oe(_e,"onBeforeInput"),0<_e.length&&(et=new Ld("onBeforeInput","beforeinput",null,s,et),tt.push({event:et,listeners:_e}),et.data=Bt))}se(tt,e)})}function tf(i,e,s){return{instance:i,listener:e,currentTarget:s}}function oe(i,e){for(var s=e+"Capture",o=[];i!==null;){var a=i,d=a.stateNode;a.tag===5&&d!==null&&(a=d,d=Kb(i,s),d!=null&&o.unshift(tf(i,d,a)),d=Kb(i,e),d!=null&&o.push(tf(i,d,a))),i=i.return}return o}function vf(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function wf(i,e,s,o,a){for(var d=e._reactName,g=[];s!==null&&s!==o;){var _=s,j=_.alternate,_e=_.stateNode;if(j!==null&&j===o)break;_.tag===5&&_e!==null&&(_=_e,a?(j=Kb(s,d),j!=null&&g.unshift(tf(s,j,_))):a||(j=Kb(s,d),j!=null&&g.push(tf(s,j,_)))),s=s.return}g.length!==0&&i.push({event:e,listeners:g})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(i){return(typeof i=="string"?i:""+i).replace(xf,`
`).replace(yf,"")}function Af(i,e,s){if(e=zf(e),zf(i)!==e&&s)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(i){return Hf.resolve(null).then(i).catch(If)}:Ff;function If(i){setTimeout(function(){throw i})}function Kf(i,e){var s=e,o=0;do{var a=s.nextSibling;if(i.removeChild(s),a&&a.nodeType===8)if(s=a.data,s==="/$"){if(o===0){i.removeChild(a),bd(e);return}o--}else s!=="$"&&s!=="$?"&&s!=="$!"||o++;s=a}while(s);bd(e)}function Lf(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function Mf(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var s=i.data;if(s==="$"||s==="$!"||s==="$?"){if(e===0)return i;e--}else s==="/$"&&e++}i=i.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(i){var e=i[Of];if(e)return e;for(var s=i.parentNode;s;){if(e=s[uf]||s[Of]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(i=Mf(i);i!==null;){if(s=i[Of])return s;i=Mf(i)}return e}i=s,s=i.parentNode}return null}function Cb(i){return i=i[Of]||i[uf],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function ue(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(p(33))}function Db(i){return i[Pf]||null}var Sf=[],Tf=-1;function Uf(i){return{current:i}}function E(i){0>Tf||(i.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(i,e){Tf++,Sf[Tf]=i.current,i.current=e}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(i,e){var s=i.type.contextTypes;if(!s)return Vf;var o=i.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===e)return o.__reactInternalMemoizedMaskedChildContext;var a={},d;for(d in s)a[d]=e[d];return o&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=a),a}function Zf(i){return i=i.childContextTypes,i!=null}function $f(){E(Wf),E(H)}function ag(i,e,s){if(H.current!==Vf)throw Error(p(168));G(H,e),G(Wf,s)}function bg(i,e,s){var o=i.stateNode;if(e=e.childContextTypes,typeof o.getChildContext!="function")return s;o=o.getChildContext();for(var a in o)if(!(a in e))throw Error(p(108,Ra(i)||"Unknown",a));return A({},s,o)}function cg(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,i),G(Wf,Wf.current),!0}function dg(i,e,s){var o=i.stateNode;if(!o)throw Error(p(169));s?(i=bg(i,e,Xf),o.__reactInternalMemoizedMergedChildContext=i,E(Wf),E(H),G(H,i)):E(Wf),G(Wf,s)}var eg=null,fg=!1,gg=!1;function hg(i){eg===null?eg=[i]:eg.push(i)}function ig(i){fg=!0,hg(i)}function jg(){if(!gg&&eg!==null){gg=!0;var i=0,e=C;try{var s=eg;for(C=1;i<s.length;i++){var o=s[i];do o=o(!0);while(o!==null)}eg=null,fg=!1}catch(a){throw eg!==null&&(eg=eg.slice(i+1)),ac(fc,jg),a}finally{C=e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(i,e){kg[lg++]=ng,kg[lg++]=mg,mg=i,ng=e}function ug(i,e,s){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=i;var o=rg;i=sg;var a=32-oc(o)-1;o&=~(1<<a),s+=1;var d=32-oc(e)+a;if(30<d){var g=a-a%5;d=(o&(1<<g)-1).toString(32),o>>=g,a-=g,rg=1<<32-oc(e)+a|s<<a|o,sg=d+i}else rg=1<<d|s<<a|o,sg=i}function vg(i){i.return!==null&&(tg(i,1),ug(i,1,0))}function wg(i){for(;i===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;i===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(i,e){var s=Bg(5,null,null,0);s.elementType="DELETED",s.stateNode=e,s.return=i,e=i.deletions,e===null?(i.deletions=[s],i.flags|=16):e.push(s)}function Cg(i,e){switch(i.tag){case 5:var s=i.type;return e=e.nodeType!==1||s.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,xg=i,yg=Lf(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,xg=i,yg=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(s=qg!==null?{id:rg,overflow:sg}:null,i.memoizedState={dehydrated:e,treeContext:s,retryLane:1073741824},s=Bg(18,null,null,0),s.stateNode=e,s.return=i,i.child=s,xg=i,yg=null,!0):!1;default:return!1}}function Dg(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Eg(i){if(I){var e=yg;if(e){var s=e;if(!Cg(i,e)){if(Dg(i))throw Error(p(418));e=Lf(s.nextSibling);var o=xg;e&&Cg(i,e)?Ag(o,s):(i.flags=i.flags&-4097|2,I=!1,xg=i)}}else{if(Dg(i))throw Error(p(418));i.flags=i.flags&-4097|2,I=!1,xg=i}}}function Fg(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;xg=i}function Gg(i){if(i!==xg)return!1;if(!I)return Fg(i),I=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!Ef(i.type,i.memoizedProps)),e&&(e=yg)){if(Dg(i))throw Hg(),Error(p(418));for(;e;)Ag(i,e),e=Lf(e.nextSibling)}if(Fg(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(p(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var s=i.data;if(s==="/$"){if(e===0){yg=Lf(i.nextSibling);break e}e--}else s!=="$"&&s!=="$!"&&s!=="$?"||e++}i=i.nextSibling}yg=null}}else yg=xg?Lf(i.stateNode.nextSibling):null;return!0}function Hg(){for(var i=yg;i;)i=Lf(i.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(i){zg===null?zg=[i]:zg.push(i)}var Kg=ua.ReactCurrentBatchConfig;function Lg(i,e){if(i&&i.defaultProps){e=A({},e),i=i.defaultProps;for(var s in i)e[s]===void 0&&(e[s]=i[s]);return e}return e}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(i){var e=Mg.current;E(Mg),i._currentValue=e}function Sg(i,e,s){for(;i!==null;){var o=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,o!==null&&(o.childLanes|=e)):o!==null&&(o.childLanes&e)!==e&&(o.childLanes|=e),i===s)break;i=i.return}}function Tg(i,e){Ng=i,Pg=Og=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(Ug=!0),i.firstContext=null)}function Vg(i){var e=i._currentValue;if(Pg!==i)if(i={context:i,memoizedValue:e,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=i,Ng.dependencies={lanes:0,firstContext:i}}else Og=Og.next=i;return e}var Wg=null;function Xg(i){Wg===null?Wg=[i]:Wg.push(i)}function Yg(i,e,s,o){var a=e.interleaved;return a===null?(s.next=s,Xg(e)):(s.next=a.next,a.next=s),e.interleaved=s,Zg(i,o)}function Zg(i,e){i.lanes|=e;var s=i.alternate;for(s!==null&&(s.lanes|=e),s=i,i=i.return;i!==null;)i.childLanes|=e,s=i.alternate,s!==null&&(s.childLanes|=e),s=i,i=i.return;return s.tag===3?s.stateNode:null}var $g=!1;function ah(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function ch(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function dh(i,e,s){var o=i.updateQueue;if(o===null)return null;if(o=o.shared,K&2){var a=o.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),o.pending=e,Zg(i,s)}return a=o.interleaved,a===null?(e.next=e,Xg(o)):(e.next=a.next,a.next=e),o.interleaved=e,Zg(i,s)}function eh(i,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194240)!==0)){var o=e.lanes;o&=i.pendingLanes,s|=o,e.lanes=s,Cc(i,s)}}function fh(i,e){var s=i.updateQueue,o=i.alternate;if(o!==null&&(o=o.updateQueue,s===o)){var a=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var g={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};d===null?a=d=g:d=d.next=g,s=s.next}while(s!==null);d===null?a=d=e:d=d.next=e}else a=d=e;s={baseState:o.baseState,firstBaseUpdate:a,lastBaseUpdate:d,shared:o.shared,effects:o.effects},i.updateQueue=s;return}i=s.lastBaseUpdate,i===null?s.firstBaseUpdate=e:i.next=e,s.lastBaseUpdate=e}function gh(i,e,s,o){var a=i.updateQueue;$g=!1;var d=a.firstBaseUpdate,g=a.lastBaseUpdate,_=a.shared.pending;if(_!==null){a.shared.pending=null;var j=_,_e=j.next;j.next=null,g===null?d=_e:g.next=_e,g=j;var et=i.alternate;et!==null&&(et=et.updateQueue,_=et.lastBaseUpdate,_!==g&&(_===null?et.firstBaseUpdate=_e:_.next=_e,et.lastBaseUpdate=j))}if(d!==null){var tt=a.baseState;g=0,et=_e=j=null,_=d;do{var rt=_.lane,it=_.eventTime;if((o&rt)===rt){et!==null&&(et=et.next={eventTime:it,lane:0,tag:_.tag,payload:_.payload,callback:_.callback,next:null});e:{var ot=i,ct=_;switch(rt=e,it=s,ct.tag){case 1:if(ot=ct.payload,typeof ot=="function"){tt=ot.call(it,tt,rt);break e}tt=ot;break e;case 3:ot.flags=ot.flags&-65537|128;case 0:if(ot=ct.payload,rt=typeof ot=="function"?ot.call(it,tt,rt):ot,rt==null)break e;tt=A({},tt,rt);break e;case 2:$g=!0}}_.callback!==null&&_.lane!==0&&(i.flags|=64,rt=a.effects,rt===null?a.effects=[_]:rt.push(_))}else it={eventTime:it,lane:rt,tag:_.tag,payload:_.payload,callback:_.callback,next:null},et===null?(_e=et=it,j=tt):et=et.next=it,g|=rt;if(_=_.next,_===null){if(_=a.shared.pending,_===null)break;rt=_,_=rt.next,rt.next=null,a.lastBaseUpdate=rt,a.shared.pending=null}}while(1);if(et===null&&(j=tt),a.baseState=j,a.firstBaseUpdate=_e,a.lastBaseUpdate=et,e=a.shared.interleaved,e!==null){a=e;do g|=a.lane,a=a.next;while(a!==e)}else d===null&&(a.shared.lanes=0);hh|=g,i.lanes=g,i.memoizedState=tt}}function ih(i,e,s){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var o=i[e],a=o.callback;if(a!==null){if(o.callback=null,o=s,typeof a!="function")throw Error(p(191,a));a.call(o)}}}var jh=new aa.Component().refs;function kh(i,e,s,o){e=i.memoizedState,s=s(o,e),s=s==null?e:A({},e,s),i.memoizedState=s,i.lanes===0&&(i.updateQueue.baseState=s)}var nh={isMounted:function(i){return(i=i._reactInternals)?Vb(i)===i:!1},enqueueSetState:function(i,e,s){i=i._reactInternals;var o=L(),a=lh(i),d=ch(o,a);d.payload=e,s!=null&&(d.callback=s),e=dh(i,d,a),e!==null&&(mh(e,i,a,o),eh(e,i,a))},enqueueReplaceState:function(i,e,s){i=i._reactInternals;var o=L(),a=lh(i),d=ch(o,a);d.tag=1,d.payload=e,s!=null&&(d.callback=s),e=dh(i,d,a),e!==null&&(mh(e,i,a,o),eh(e,i,a))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var s=L(),o=lh(i),a=ch(s,o);a.tag=2,e!=null&&(a.callback=e),e=dh(i,a,o),e!==null&&(mh(e,i,o,s),eh(e,i,o))}};function oh(i,e,s,o,a,d,g){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(o,d,g):e.prototype&&e.prototype.isPureReactComponent?!Ie(s,o)||!Ie(a,d):!0}function ph(i,e,s){var o=!1,a=Vf,d=e.contextType;return typeof d=="object"&&d!==null?d=Vg(d):(a=Zf(e)?Xf:H.current,o=e.contextTypes,d=(o=o!=null)?Yf(i,a):Vf),e=new e(s,d),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=nh,i.stateNode=e,e._reactInternals=i,o&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=d),e}function qh(i,e,s,o){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,o),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,o),e.state!==i&&nh.enqueueReplaceState(e,e.state,null)}function rh(i,e,s,o){var a=i.stateNode;a.props=s,a.state=i.memoizedState,a.refs=jh,ah(i);var d=e.contextType;typeof d=="object"&&d!==null?a.context=Vg(d):(d=Zf(e)?Xf:H.current,a.context=Yf(i,d)),a.state=i.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(kh(i,e,d,s),a.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(e=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),e!==a.state&&nh.enqueueReplaceState(a,a.state,null),gh(i,s,a,o),a.state=i.memoizedState),typeof a.componentDidMount=="function"&&(i.flags|=4194308)}function sh(i,e,s){if(i=s.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error(p(309));var o=s.stateNode}if(!o)throw Error(p(147,i));var a=o,d=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(g){var _=a.refs;_===jh&&(_=a.refs={}),g===null?delete _[d]:_[d]=g},e._stringRef=d,e)}if(typeof i!="string")throw Error(p(284));if(!s._owner)throw Error(p(290,i))}return i}function th(i,e){throw i=Object.prototype.toString.call(e),Error(p(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function uh(i){var e=i._init;return e(i._payload)}function vh(i){function e(dt,pt){if(i){var gt=dt.deletions;gt===null?(dt.deletions=[pt],dt.flags|=16):gt.push(pt)}}function s(dt,pt){if(!i)return null;for(;pt!==null;)e(dt,pt),pt=pt.sibling;return null}function o(dt,pt){for(dt=new Map;pt!==null;)pt.key!==null?dt.set(pt.key,pt):dt.set(pt.index,pt),pt=pt.sibling;return dt}function a(dt,pt){return dt=wh(dt,pt),dt.index=0,dt.sibling=null,dt}function d(dt,pt,gt){return dt.index=gt,i?(gt=dt.alternate,gt!==null?(gt=gt.index,gt<pt?(dt.flags|=2,pt):gt):(dt.flags|=2,pt)):(dt.flags|=1048576,pt)}function g(dt){return i&&dt.alternate===null&&(dt.flags|=2),dt}function _(dt,pt,gt,Ct){return pt===null||pt.tag!==6?(pt=xh(gt,dt.mode,Ct),pt.return=dt,pt):(pt=a(pt,gt),pt.return=dt,pt)}function j(dt,pt,gt,Ct){var xt=gt.type;return xt===ya?et(dt,pt,gt.props.children,Ct,gt.key):pt!==null&&(pt.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===Ha&&uh(xt)===pt.type)?(Ct=a(pt,gt.props),Ct.ref=sh(dt,pt,gt),Ct.return=dt,Ct):(Ct=yh(gt.type,gt.key,gt.props,null,dt.mode,Ct),Ct.ref=sh(dt,pt,gt),Ct.return=dt,Ct)}function _e(dt,pt,gt,Ct){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==gt.containerInfo||pt.stateNode.implementation!==gt.implementation?(pt=zh(gt,dt.mode,Ct),pt.return=dt,pt):(pt=a(pt,gt.children||[]),pt.return=dt,pt)}function et(dt,pt,gt,Ct,xt){return pt===null||pt.tag!==7?(pt=Ah(gt,dt.mode,Ct,xt),pt.return=dt,pt):(pt=a(pt,gt),pt.return=dt,pt)}function tt(dt,pt,gt){if(typeof pt=="string"&&pt!==""||typeof pt=="number")return pt=xh(""+pt,dt.mode,gt),pt.return=dt,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case va:return gt=yh(pt.type,pt.key,pt.props,null,dt.mode,gt),gt.ref=sh(dt,null,pt),gt.return=dt,gt;case wa:return pt=zh(pt,dt.mode,gt),pt.return=dt,pt;case Ha:var Ct=pt._init;return tt(dt,Ct(pt._payload),gt)}if(eb(pt)||Ka(pt))return pt=Ah(pt,dt.mode,gt,null),pt.return=dt,pt;th(dt,pt)}return null}function rt(dt,pt,gt,Ct){var xt=pt!==null?pt.key:null;if(typeof gt=="string"&&gt!==""||typeof gt=="number")return xt!==null?null:_(dt,pt,""+gt,Ct);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case va:return gt.key===xt?j(dt,pt,gt,Ct):null;case wa:return gt.key===xt?_e(dt,pt,gt,Ct):null;case Ha:return xt=gt._init,rt(dt,pt,xt(gt._payload),Ct)}if(eb(gt)||Ka(gt))return xt!==null?null:et(dt,pt,gt,Ct,null);th(dt,gt)}return null}function it(dt,pt,gt,Ct,xt){if(typeof Ct=="string"&&Ct!==""||typeof Ct=="number")return dt=dt.get(gt)||null,_(pt,dt,""+Ct,xt);if(typeof Ct=="object"&&Ct!==null){switch(Ct.$$typeof){case va:return dt=dt.get(Ct.key===null?gt:Ct.key)||null,j(pt,dt,Ct,xt);case wa:return dt=dt.get(Ct.key===null?gt:Ct.key)||null,_e(pt,dt,Ct,xt);case Ha:var at=Ct._init;return it(dt,pt,gt,at(Ct._payload),xt)}if(eb(Ct)||Ka(Ct))return dt=dt.get(gt)||null,et(pt,dt,Ct,xt,null);th(pt,Ct)}return null}function ot(dt,pt,gt,Ct){for(var xt=null,at=null,Bt=pt,Ht=pt=0,sr=null;Bt!==null&&Ht<gt.length;Ht++){Bt.index>Ht?(sr=Bt,Bt=null):sr=Bt.sibling;var mr=rt(dt,Bt,gt[Ht],Ct);if(mr===null){Bt===null&&(Bt=sr);break}i&&Bt&&mr.alternate===null&&e(dt,Bt),pt=d(mr,pt,Ht),at===null?xt=mr:at.sibling=mr,at=mr,Bt=sr}if(Ht===gt.length)return s(dt,Bt),I&&tg(dt,Ht),xt;if(Bt===null){for(;Ht<gt.length;Ht++)Bt=tt(dt,gt[Ht],Ct),Bt!==null&&(pt=d(Bt,pt,Ht),at===null?xt=Bt:at.sibling=Bt,at=Bt);return I&&tg(dt,Ht),xt}for(Bt=o(dt,Bt);Ht<gt.length;Ht++)sr=it(Bt,dt,Ht,gt[Ht],Ct),sr!==null&&(i&&sr.alternate!==null&&Bt.delete(sr.key===null?Ht:sr.key),pt=d(sr,pt,Ht),at===null?xt=sr:at.sibling=sr,at=sr);return i&&Bt.forEach(function(hr){return e(dt,hr)}),I&&tg(dt,Ht),xt}function ct(dt,pt,gt,Ct){var xt=Ka(gt);if(typeof xt!="function")throw Error(p(150));if(gt=xt.call(gt),gt==null)throw Error(p(151));for(var at=xt=null,Bt=pt,Ht=pt=0,sr=null,mr=gt.next();Bt!==null&&!mr.done;Ht++,mr=gt.next()){Bt.index>Ht?(sr=Bt,Bt=null):sr=Bt.sibling;var hr=rt(dt,Bt,mr.value,Ct);if(hr===null){Bt===null&&(Bt=sr);break}i&&Bt&&hr.alternate===null&&e(dt,Bt),pt=d(hr,pt,Ht),at===null?xt=hr:at.sibling=hr,at=hr,Bt=sr}if(mr.done)return s(dt,Bt),I&&tg(dt,Ht),xt;if(Bt===null){for(;!mr.done;Ht++,mr=gt.next())mr=tt(dt,mr.value,Ct),mr!==null&&(pt=d(mr,pt,Ht),at===null?xt=mr:at.sibling=mr,at=mr);return I&&tg(dt,Ht),xt}for(Bt=o(dt,Bt);!mr.done;Ht++,mr=gt.next())mr=it(Bt,dt,Ht,mr.value,Ct),mr!==null&&(i&&mr.alternate!==null&&Bt.delete(mr.key===null?Ht:mr.key),pt=d(mr,pt,Ht),at===null?xt=mr:at.sibling=mr,at=mr);return i&&Bt.forEach(function(Er){return e(dt,Er)}),I&&tg(dt,Ht),xt}function ft(dt,pt,gt,Ct){if(typeof gt=="object"&&gt!==null&&gt.type===ya&&gt.key===null&&(gt=gt.props.children),typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case va:e:{for(var xt=gt.key,at=pt;at!==null;){if(at.key===xt){if(xt=gt.type,xt===ya){if(at.tag===7){s(dt,at.sibling),pt=a(at,gt.props.children),pt.return=dt,dt=pt;break e}}else if(at.elementType===xt||typeof xt=="object"&&xt!==null&&xt.$$typeof===Ha&&uh(xt)===at.type){s(dt,at.sibling),pt=a(at,gt.props),pt.ref=sh(dt,at,gt),pt.return=dt,dt=pt;break e}s(dt,at);break}else e(dt,at);at=at.sibling}gt.type===ya?(pt=Ah(gt.props.children,dt.mode,Ct,gt.key),pt.return=dt,dt=pt):(Ct=yh(gt.type,gt.key,gt.props,null,dt.mode,Ct),Ct.ref=sh(dt,pt,gt),Ct.return=dt,dt=Ct)}return g(dt);case wa:e:{for(at=gt.key;pt!==null;){if(pt.key===at)if(pt.tag===4&&pt.stateNode.containerInfo===gt.containerInfo&&pt.stateNode.implementation===gt.implementation){s(dt,pt.sibling),pt=a(pt,gt.children||[]),pt.return=dt,dt=pt;break e}else{s(dt,pt);break}else e(dt,pt);pt=pt.sibling}pt=zh(gt,dt.mode,Ct),pt.return=dt,dt=pt}return g(dt);case Ha:return at=gt._init,ft(dt,pt,at(gt._payload),Ct)}if(eb(gt))return ot(dt,pt,gt,Ct);if(Ka(gt))return ct(dt,pt,gt,Ct);th(dt,gt)}return typeof gt=="string"&&gt!==""||typeof gt=="number"?(gt=""+gt,pt!==null&&pt.tag===6?(s(dt,pt.sibling),pt=a(pt,gt),pt.return=dt,dt=pt):(s(dt,pt),pt=xh(gt,dt.mode,Ct),pt.return=dt,dt=pt),g(dt)):s(dt,pt)}return ft}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(i){if(i===Dh)throw Error(p(174));return i}function Ih(i,e){switch(G(Gh,e),G(Fh,i),G(Eh,Dh),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lb(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=lb(e,i)}E(Eh),G(Eh,e)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(i){Hh(Gh.current);var e=Hh(Eh.current),s=lb(e,i.type);e!==s&&(G(Fh,i),G(Eh,s))}function Lh(i){Fh.current===i&&(E(Eh),E(Fh))}var M=Uf(0);function Mh(i){for(var e=i;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Nh=[];function Oh(){for(var i=0;i<Nh.length;i++)Nh[i]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p(321))}function Wh(i,e){if(e===null)return!1;for(var s=0;s<e.length&&s<i.length;s++)if(!He(i[s],e[s]))return!1;return!0}function Xh(i,e,s,o,a,d){if(Rh=d,N=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ph.current=i===null||i.memoizedState===null?Yh:Zh,i=s(o,a),Th){d=0;do{if(Th=!1,Uh=0,25<=d)throw Error(p(301));d+=1,P=O=null,e.updateQueue=null,Ph.current=$h,i=s(o,a)}while(Th)}if(Ph.current=ai,e=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,e)throw Error(p(300));return i}function bi(){var i=Uh!==0;return Uh=0,i}function ci(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=i:P=P.next=i,P}function di(){if(O===null){var i=N.alternate;i=i!==null?i.memoizedState:null}else i=O.next;var e=P===null?N.memoizedState:P.next;if(e!==null)P=e,O=i;else{if(i===null)throw Error(p(310));O=i,i={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=i:P=P.next=i}return P}function ei(i,e){return typeof e=="function"?e(i):e}function fi(i){var e=di(),s=e.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=i;var o=O,a=o.baseQueue,d=s.pending;if(d!==null){if(a!==null){var g=a.next;a.next=d.next,d.next=g}o.baseQueue=a=d,s.pending=null}if(a!==null){d=a.next,o=o.baseState;var _=g=null,j=null,_e=d;do{var et=_e.lane;if((Rh&et)===et)j!==null&&(j=j.next={lane:0,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),o=_e.hasEagerState?_e.eagerState:i(o,_e.action);else{var tt={lane:et,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null};j===null?(_=j=tt,g=o):j=j.next=tt,N.lanes|=et,hh|=et}_e=_e.next}while(_e!==null&&_e!==d);j===null?g=o:j.next=_,He(o,e.memoizedState)||(Ug=!0),e.memoizedState=o,e.baseState=g,e.baseQueue=j,s.lastRenderedState=o}if(i=s.interleaved,i!==null){a=i;do d=a.lane,N.lanes|=d,hh|=d,a=a.next;while(a!==i)}else a===null&&(s.lanes=0);return[e.memoizedState,s.dispatch]}function gi(i){var e=di(),s=e.queue;if(s===null)throw Error(p(311));s.lastRenderedReducer=i;var o=s.dispatch,a=s.pending,d=e.memoizedState;if(a!==null){s.pending=null;var g=a=a.next;do d=i(d,g.action),g=g.next;while(g!==a);He(d,e.memoizedState)||(Ug=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),s.lastRenderedState=d}return[d,o]}function hi(){}function ii(i,e){var s=N,o=di(),a=e(),d=!He(o.memoizedState,a);if(d&&(o.memoizedState=a,Ug=!0),o=o.queue,ji(ki.bind(null,s,o,i),[i]),o.getSnapshot!==e||d||P!==null&&P.memoizedState.tag&1){if(s.flags|=2048,li(9,mi.bind(null,s,o,a,e),void 0,null),R===null)throw Error(p(349));Rh&30||ni(s,e,a)}return a}function ni(i,e,s){i.flags|=16384,i={getSnapshot:e,value:s},e=N.updateQueue,e===null?(e={lastEffect:null,stores:null},N.updateQueue=e,e.stores=[i]):(s=e.stores,s===null?e.stores=[i]:s.push(i))}function mi(i,e,s,o){e.value=s,e.getSnapshot=o,oi(e)&&pi(i)}function ki(i,e,s){return s(function(){oi(e)&&pi(i)})}function oi(i){var e=i.getSnapshot;i=i.value;try{var s=e();return!He(i,s)}catch{return!0}}function pi(i){var e=Zg(i,1);e!==null&&mh(e,i,1,-1)}function qi(i){var e=ci();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:i},e.queue=i,i=i.dispatch=ri.bind(null,N,i),[e.memoizedState,i]}function li(i,e,s,o){return i={tag:i,create:e,destroy:s,deps:o,next:null},e=N.updateQueue,e===null?(e={lastEffect:null,stores:null},N.updateQueue=e,e.lastEffect=i.next=i):(s=e.lastEffect,s===null?e.lastEffect=i.next=i:(o=s.next,s.next=i,i.next=o,e.lastEffect=i)),i}function si(){return di().memoizedState}function ti(i,e,s,o){var a=ci();N.flags|=i,a.memoizedState=li(1|e,s,void 0,o===void 0?null:o)}function ui(i,e,s,o){var a=di();o=o===void 0?null:o;var d=void 0;if(O!==null){var g=O.memoizedState;if(d=g.destroy,o!==null&&Wh(o,g.deps)){a.memoizedState=li(e,s,d,o);return}}N.flags|=i,a.memoizedState=li(1|e,s,d,o)}function vi(i,e){return ti(8390656,8,i,e)}function ji(i,e){return ui(2048,8,i,e)}function wi(i,e){return ui(4,2,i,e)}function xi(i,e){return ui(4,4,i,e)}function yi(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function zi(i,e,s){return s=s!=null?s.concat([i]):null,ui(4,4,yi.bind(null,e,i),s)}function Ai(){}function Bi(i,e){var s=di();e=e===void 0?null:e;var o=s.memoizedState;return o!==null&&e!==null&&Wh(e,o[1])?o[0]:(s.memoizedState=[i,e],i)}function Ci(i,e){var s=di();e=e===void 0?null:e;var o=s.memoizedState;return o!==null&&e!==null&&Wh(e,o[1])?o[0]:(i=i(),s.memoizedState=[i,e],i)}function Di(i,e,s){return Rh&21?(He(s,e)||(s=yc(),N.lanes|=s,hh|=s,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,Ug=!0),i.memoizedState=s)}function Ei(i,e){var s=C;C=s!==0&&4>s?s:4,i(!0);var o=Qh.transition;Qh.transition={};try{i(!1),e()}finally{C=s,Qh.transition=o}}function Fi(){return di().memoizedState}function Gi(i,e,s){var o=lh(i);if(s={lane:o,action:s,hasEagerState:!1,eagerState:null,next:null},Hi(i))Ii(e,s);else if(s=Yg(i,e,s,o),s!==null){var a=L();mh(s,i,o,a),Ji(s,e,o)}}function ri(i,e,s){var o=lh(i),a={lane:o,action:s,hasEagerState:!1,eagerState:null,next:null};if(Hi(i))Ii(e,a);else{var d=i.alternate;if(i.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var g=e.lastRenderedState,_=d(g,s);if(a.hasEagerState=!0,a.eagerState=_,He(_,g)){var j=e.interleaved;j===null?(a.next=a,Xg(e)):(a.next=j.next,j.next=a),e.interleaved=a;return}}catch{}finally{}s=Yg(i,e,a,o),s!==null&&(a=L(),mh(s,i,o,a),Ji(s,e,o))}}function Hi(i){var e=i.alternate;return i===N||e!==null&&e===N}function Ii(i,e){Th=Sh=!0;var s=i.pending;s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e}function Ji(i,e,s){if(s&4194240){var o=e.lanes;o&=i.pendingLanes,s|=o,e.lanes=s,Cc(i,s)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(i,e){return ci().memoizedState=[i,e===void 0?null:e],i},useContext:Vg,useEffect:vi,useImperativeHandle:function(i,e,s){return s=s!=null?s.concat([i]):null,ti(4194308,4,yi.bind(null,e,i),s)},useLayoutEffect:function(i,e){return ti(4194308,4,i,e)},useInsertionEffect:function(i,e){return ti(4,2,i,e)},useMemo:function(i,e){var s=ci();return e=e===void 0?null:e,i=i(),s.memoizedState=[i,e],i},useReducer:function(i,e,s){var o=ci();return e=s!==void 0?s(e):e,o.memoizedState=o.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},o.queue=i,i=i.dispatch=Gi.bind(null,N,i),[o.memoizedState,i]},useRef:function(i){var e=ci();return i={current:i},e.memoizedState=i},useState:qi,useDebugValue:Ai,useDeferredValue:function(i){return ci().memoizedState=i},useTransition:function(){var i=qi(!1),e=i[0];return i=Ei.bind(null,i[1]),ci().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,s){var o=N,a=ci();if(I){if(s===void 0)throw Error(p(407));s=s()}else{if(s=e(),R===null)throw Error(p(349));Rh&30||ni(o,e,s)}a.memoizedState=s;var d={value:s,getSnapshot:e};return a.queue=d,vi(ki.bind(null,o,d,i),[i]),o.flags|=2048,li(9,mi.bind(null,o,d,s,e),void 0,null),s},useId:function(){var i=ci(),e=R.identifierPrefix;if(I){var s=sg,o=rg;s=(o&~(1<<32-oc(o)-1)).toString(32)+s,e=":"+e+"R"+s,s=Uh++,0<s&&(e+="H"+s.toString(32)),e+=":"}else s=Vh++,e=":"+e+"r"+s.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(i){var e=di();return Di(e,O.memoizedState,i)},useTransition:function(){var i=fi(ei)[0],e=di().memoizedState;return[i,e]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(i){var e=di();return O===null?e.memoizedState=i:Di(e,O.memoizedState,i)},useTransition:function(){var i=gi(ei)[0],e=di().memoizedState;return[i,e]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(i,e){try{var s="",o=e;do s+=Pa(o),o=o.return;while(o);var a=s}catch(d){a=`
Error generating stack: `+d.message+`
`+d.stack}return{value:i,source:e,stack:a,digest:null}}function Li(i,e,s){return{value:i,source:null,stack:s??null,digest:e??null}}function Mi(i,e){try{console.error(e.value)}catch(s){setTimeout(function(){throw s})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(i,e,s){s=ch(-1,s),s.tag=3,s.payload={element:null};var o=e.value;return s.callback=function(){Pi||(Pi=!0,Qi=o),Mi(i,e)},s}function Ri(i,e,s){s=ch(-1,s),s.tag=3;var o=i.type.getDerivedStateFromError;if(typeof o=="function"){var a=e.value;s.payload=function(){return o(a)},s.callback=function(){Mi(i,e)}}var d=i.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(s.callback=function(){Mi(i,e),typeof o!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var g=e.stack;this.componentDidCatch(e.value,{componentStack:g!==null?g:""})}),s}function Ti(i,e,s){var o=i.pingCache;if(o===null){o=i.pingCache=new Ni;var a=new Set;o.set(e,a)}else a=o.get(e),a===void 0&&(a=new Set,o.set(e,a));a.has(s)||(a.add(s),i=Ui.bind(null,i,e,s),e.then(i,i))}function Vi(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function Wi(i,e,s,o,a){return i.mode&1?(i.flags|=65536,i.lanes=a,i):(i===e?i.flags|=65536:(i.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(e=ch(-1,1),e.tag=2,dh(s,e,1))),s.lanes|=1),i)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(i,e,s,o){e.child=i===null?Ch(e,null,s,o):Bh(e,i.child,s,o)}function Zi(i,e,s,o,a){s=s.render;var d=e.ref;return Tg(e,a),o=Xh(i,e,s,o,d,a),s=bi(),i!==null&&!Ug?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~a,$i(i,e,a)):(I&&s&&vg(e),e.flags|=1,Yi(i,e,o,a),e.child)}function aj(i,e,s,o,a){if(i===null){var d=s.type;return typeof d=="function"&&!bj(d)&&d.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(e.tag=15,e.type=d,cj(i,e,d,o,a)):(i=yh(s.type,null,o,e,e.mode,a),i.ref=e.ref,i.return=e,e.child=i)}if(d=i.child,!(i.lanes&a)){var g=d.memoizedProps;if(s=s.compare,s=s!==null?s:Ie,s(g,o)&&i.ref===e.ref)return $i(i,e,a)}return e.flags|=1,i=wh(d,o),i.ref=e.ref,i.return=e,e.child=i}function cj(i,e,s,o,a){if(i!==null){var d=i.memoizedProps;if(Ie(d,o)&&i.ref===e.ref)if(Ug=!1,e.pendingProps=o=d,(i.lanes&a)!==0)i.flags&131072&&(Ug=!0);else return e.lanes=i.lanes,$i(i,e,a)}return dj(i,e,s,o,a)}function ej(i,e,s){var o=e.pendingProps,a=o.children,d=i!==null?i.memoizedState:null;if(o.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=s;else{if(!(s&1073741824))return i=d!==null?d.baseLanes|s:s,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,G(fj,gj),gj|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=d!==null?d.baseLanes:s,G(fj,gj),gj|=o}else d!==null?(o=d.baseLanes|s,e.memoizedState=null):o=s,G(fj,gj),gj|=o;return Yi(i,e,a,s),e.child}function hj(i,e){var s=e.ref;(i===null&&s!==null||i!==null&&i.ref!==s)&&(e.flags|=512,e.flags|=2097152)}function dj(i,e,s,o,a){var d=Zf(s)?Xf:H.current;return d=Yf(e,d),Tg(e,a),s=Xh(i,e,s,o,d,a),o=bi(),i!==null&&!Ug?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~a,$i(i,e,a)):(I&&o&&vg(e),e.flags|=1,Yi(i,e,s,a),e.child)}function ij(i,e,s,o,a){if(Zf(s)){var d=!0;cg(e)}else d=!1;if(Tg(e,a),e.stateNode===null)jj(i,e),ph(e,s,o),rh(e,s,o,a),o=!0;else if(i===null){var g=e.stateNode,_=e.memoizedProps;g.props=_;var j=g.context,_e=s.contextType;typeof _e=="object"&&_e!==null?_e=Vg(_e):(_e=Zf(s)?Xf:H.current,_e=Yf(e,_e));var et=s.getDerivedStateFromProps,tt=typeof et=="function"||typeof g.getSnapshotBeforeUpdate=="function";tt||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(_!==o||j!==_e)&&qh(e,g,o,_e),$g=!1;var rt=e.memoizedState;g.state=rt,gh(e,o,g,a),j=e.memoizedState,_!==o||rt!==j||Wf.current||$g?(typeof et=="function"&&(kh(e,s,et,o),j=e.memoizedState),(_=$g||oh(e,s,_,o,rt,j,_e))?(tt||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(e.flags|=4194308)):(typeof g.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=o,e.memoizedState=j),g.props=o,g.state=j,g.context=_e,o=_):(typeof g.componentDidMount=="function"&&(e.flags|=4194308),o=!1)}else{g=e.stateNode,bh(i,e),_=e.memoizedProps,_e=e.type===e.elementType?_:Lg(e.type,_),g.props=_e,tt=e.pendingProps,rt=g.context,j=s.contextType,typeof j=="object"&&j!==null?j=Vg(j):(j=Zf(s)?Xf:H.current,j=Yf(e,j));var it=s.getDerivedStateFromProps;(et=typeof it=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(_!==tt||rt!==j)&&qh(e,g,o,j),$g=!1,rt=e.memoizedState,g.state=rt,gh(e,o,g,a);var ot=e.memoizedState;_!==tt||rt!==ot||Wf.current||$g?(typeof it=="function"&&(kh(e,s,it,o),ot=e.memoizedState),(_e=$g||oh(e,s,_e,o,rt,ot,j)||!1)?(et||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(o,ot,j),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(o,ot,j)),typeof g.componentDidUpdate=="function"&&(e.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof g.componentDidUpdate!="function"||_===i.memoizedProps&&rt===i.memoizedState||(e.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||_===i.memoizedProps&&rt===i.memoizedState||(e.flags|=1024),e.memoizedProps=o,e.memoizedState=ot),g.props=o,g.state=ot,g.context=j,o=_e):(typeof g.componentDidUpdate!="function"||_===i.memoizedProps&&rt===i.memoizedState||(e.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||_===i.memoizedProps&&rt===i.memoizedState||(e.flags|=1024),o=!1)}return kj(i,e,s,o,d,a)}function kj(i,e,s,o,a,d){hj(i,e);var g=(e.flags&128)!==0;if(!o&&!g)return a&&dg(e,s,!1),$i(i,e,d);o=e.stateNode,Xi.current=e;var _=g&&typeof s.getDerivedStateFromError!="function"?null:o.render();return e.flags|=1,i!==null&&g?(e.child=Bh(e,i.child,null,d),e.child=Bh(e,null,_,d)):Yi(i,e,_,d),e.memoizedState=o.state,a&&dg(e,s,!0),e.child}function lj(i){var e=i.stateNode;e.pendingContext?ag(i,e.pendingContext,e.pendingContext!==e.context):e.context&&ag(i,e.context,!1),Ih(i,e.containerInfo)}function mj(i,e,s,o,a){return Ig(),Jg(a),e.flags|=256,Yi(i,e,s,o),e.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(i){return{baseLanes:i,cachePool:null,transitions:null}}function pj(i,e,s){var o=e.pendingProps,a=M.current,d=!1,g=(e.flags&128)!==0,_;if((_=g)||(_=i!==null&&i.memoizedState===null?!1:(a&2)!==0),_?(d=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(a|=1),G(M,a&1),i===null)return Eg(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(g=o.children,i=o.fallback,d?(o=e.mode,d=e.child,g={mode:"hidden",children:g},!(o&1)&&d!==null?(d.childLanes=0,d.pendingProps=g):d=qj(g,o,0,null),i=Ah(i,o,s,null),d.return=e,i.return=e,d.sibling=i,e.child=d,e.child.memoizedState=oj(s),e.memoizedState=nj,i):rj(e,g));if(a=i.memoizedState,a!==null&&(_=a.dehydrated,_!==null))return sj(i,e,g,o,_,a,s);if(d){d=o.fallback,g=e.mode,a=i.child,_=a.sibling;var j={mode:"hidden",children:o.children};return!(g&1)&&e.child!==a?(o=e.child,o.childLanes=0,o.pendingProps=j,e.deletions=null):(o=wh(a,j),o.subtreeFlags=a.subtreeFlags&14680064),_!==null?d=wh(_,d):(d=Ah(d,g,s,null),d.flags|=2),d.return=e,o.return=e,o.sibling=d,e.child=o,o=d,d=e.child,g=i.child.memoizedState,g=g===null?oj(s):{baseLanes:g.baseLanes|s,cachePool:null,transitions:g.transitions},d.memoizedState=g,d.childLanes=i.childLanes&~s,e.memoizedState=nj,o}return d=i.child,i=d.sibling,o=wh(d,{mode:"visible",children:o.children}),!(e.mode&1)&&(o.lanes=s),o.return=e,o.sibling=null,i!==null&&(s=e.deletions,s===null?(e.deletions=[i],e.flags|=16):s.push(i)),e.child=o,e.memoizedState=null,o}function rj(i,e){return e=qj({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function tj(i,e,s,o){return o!==null&&Jg(o),Bh(e,i.child,null,s),i=rj(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function sj(i,e,s,o,a,d,g){if(s)return e.flags&256?(e.flags&=-257,o=Li(Error(p(422))),tj(i,e,g,o)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(d=o.fallback,a=e.mode,o=qj({mode:"visible",children:o.children},a,0,null),d=Ah(d,a,g,null),d.flags|=2,o.return=e,d.return=e,o.sibling=d,e.child=o,e.mode&1&&Bh(e,i.child,null,g),e.child.memoizedState=oj(g),e.memoizedState=nj,d);if(!(e.mode&1))return tj(i,e,g,null);if(a.data==="$!"){if(o=a.nextSibling&&a.nextSibling.dataset,o)var _=o.dgst;return o=_,d=Error(p(419)),o=Li(d,o,void 0),tj(i,e,g,o)}if(_=(g&i.childLanes)!==0,Ug||_){if(o=R,o!==null){switch(g&-g){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(o.suspendedLanes|g)?0:a,a!==0&&a!==d.retryLane&&(d.retryLane=a,Zg(i,a),mh(o,i,a,-1))}return uj(),o=Li(Error(p(421))),tj(i,e,g,o)}return a.data==="$?"?(e.flags|=128,e.child=i.child,e=vj.bind(null,i),a._reactRetry=e,null):(i=d.treeContext,yg=Lf(a.nextSibling),xg=e,I=!0,zg=null,i!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=i.id,sg=i.overflow,qg=e),e=rj(e,o.children),e.flags|=4096,e)}function wj(i,e,s){i.lanes|=e;var o=i.alternate;o!==null&&(o.lanes|=e),Sg(i.return,e,s)}function xj(i,e,s,o,a){var d=i.memoizedState;d===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:o,tail:s,tailMode:a}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=o,d.tail=s,d.tailMode=a)}function yj(i,e,s){var o=e.pendingProps,a=o.revealOrder,d=o.tail;if(Yi(i,e,o.children,s),o=M.current,o&2)o=o&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&wj(i,s,e);else if(i.tag===19)wj(i,s,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}o&=1}if(G(M,o),!(e.mode&1))e.memoizedState=null;else switch(a){case"forwards":for(s=e.child,a=null;s!==null;)i=s.alternate,i!==null&&Mh(i)===null&&(a=s),s=s.sibling;s=a,s===null?(a=e.child,e.child=null):(a=s.sibling,s.sibling=null),xj(e,!1,a,s,d);break;case"backwards":for(s=null,a=e.child,e.child=null;a!==null;){if(i=a.alternate,i!==null&&Mh(i)===null){e.child=a;break}i=a.sibling,a.sibling=s,s=a,a=i}xj(e,!0,s,null,d);break;case"together":xj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jj(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function $i(i,e,s){if(i!==null&&(e.dependencies=i.dependencies),hh|=e.lanes,!(s&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(p(153));if(e.child!==null){for(i=e.child,s=wh(i,i.pendingProps),e.child=s,s.return=e;i.sibling!==null;)i=i.sibling,s=s.sibling=wh(i,i.pendingProps),s.return=e;s.sibling=null}return e.child}function zj(i,e,s){switch(e.tag){case 3:lj(e),Ig();break;case 5:Kh(e);break;case 1:Zf(e.type)&&cg(e);break;case 4:Ih(e,e.stateNode.containerInfo);break;case 10:var o=e.type._context,a=e.memoizedProps.value;G(Mg,o._currentValue),o._currentValue=a;break;case 13:if(o=e.memoizedState,o!==null)return o.dehydrated!==null?(G(M,M.current&1),e.flags|=128,null):s&e.child.childLanes?pj(i,e,s):(G(M,M.current&1),i=$i(i,e,s),i!==null?i.sibling:null);G(M,M.current&1);break;case 19:if(o=(s&e.childLanes)!==0,i.flags&128){if(o)return yj(i,e,s);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),G(M,M.current),o)break;return null;case 22:case 23:return e.lanes=0,ej(i,e,s)}return $i(i,e,s)}var Aj,Bj,Cj,Dj;Aj=function(i,e){for(var s=e.child;s!==null;){if(s.tag===5||s.tag===6)i.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};Bj=function(){};Cj=function(i,e,s,o){var a=i.memoizedProps;if(a!==o){i=e.stateNode,Hh(Eh.current);var d=null;switch(s){case"input":a=Ya(i,a),o=Ya(i,o),d=[];break;case"select":a=A({},a,{value:void 0}),o=A({},o,{value:void 0}),d=[];break;case"textarea":a=gb(i,a),o=gb(i,o),d=[];break;default:typeof a.onClick!="function"&&typeof o.onClick=="function"&&(i.onclick=Bf)}ub(s,o);var g;s=null;for(_e in a)if(!o.hasOwnProperty(_e)&&a.hasOwnProperty(_e)&&a[_e]!=null)if(_e==="style"){var _=a[_e];for(g in _)_.hasOwnProperty(g)&&(s||(s={}),s[g]="")}else _e!=="dangerouslySetInnerHTML"&&_e!=="children"&&_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&_e!=="autoFocus"&&(ea.hasOwnProperty(_e)?d||(d=[]):(d=d||[]).push(_e,null));for(_e in o){var j=o[_e];if(_=a!=null?a[_e]:void 0,o.hasOwnProperty(_e)&&j!==_&&(j!=null||_!=null))if(_e==="style")if(_){for(g in _)!_.hasOwnProperty(g)||j&&j.hasOwnProperty(g)||(s||(s={}),s[g]="");for(g in j)j.hasOwnProperty(g)&&_[g]!==j[g]&&(s||(s={}),s[g]=j[g])}else s||(d||(d=[]),d.push(_e,s)),s=j;else _e==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,_=_?_.__html:void 0,j!=null&&_!==j&&(d=d||[]).push(_e,j)):_e==="children"?typeof j!="string"&&typeof j!="number"||(d=d||[]).push(_e,""+j):_e!=="suppressContentEditableWarning"&&_e!=="suppressHydrationWarning"&&(ea.hasOwnProperty(_e)?(j!=null&&_e==="onScroll"&&D("scroll",i),d||_===j||(d=[])):(d=d||[]).push(_e,j))}s&&(d=d||[]).push("style",s);var _e=d;(e.updateQueue=_e)&&(e.flags|=4)}};Dj=function(i,e,s,o){s!==o&&(e.flags|=4)};function Ej(i,e){if(!I)switch(i.tailMode){case"hidden":e=i.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?i.tail=null:s.sibling=null;break;case"collapsed":s=i.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:o.sibling=null}}function S(i){var e=i.alternate!==null&&i.alternate.child===i.child,s=0,o=0;if(e)for(var a=i.child;a!==null;)s|=a.lanes|a.childLanes,o|=a.subtreeFlags&14680064,o|=a.flags&14680064,a.return=i,a=a.sibling;else for(a=i.child;a!==null;)s|=a.lanes|a.childLanes,o|=a.subtreeFlags,o|=a.flags,a.return=i,a=a.sibling;return i.subtreeFlags|=o,i.childLanes=s,e}function Fj(i,e,s){var o=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(e),null;case 1:return Zf(e.type)&&$f(),S(e),null;case 3:return o=e.stateNode,Jh(),E(Wf),E(H),Oh(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(i===null||i.child===null)&&(Gg(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(i,e),S(e),null;case 5:Lh(e);var a=Hh(Gh.current);if(s=e.type,i!==null&&e.stateNode!=null)Cj(i,e,s,o,a),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!o){if(e.stateNode===null)throw Error(p(166));return S(e),null}if(i=Hh(Eh.current),Gg(e)){o=e.stateNode,s=e.type;var d=e.memoizedProps;switch(o[Of]=e,o[Pf]=d,i=(e.mode&1)!==0,s){case"dialog":D("cancel",o),D("close",o);break;case"iframe":case"object":case"embed":D("load",o);break;case"video":case"audio":for(a=0;a<lf.length;a++)D(lf[a],o);break;case"source":D("error",o);break;case"img":case"image":case"link":D("error",o),D("load",o);break;case"details":D("toggle",o);break;case"input":Za(o,d),D("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!d.multiple},D("invalid",o);break;case"textarea":hb(o,d),D("invalid",o)}ub(s,d),a=null;for(var g in d)if(d.hasOwnProperty(g)){var _=d[g];g==="children"?typeof _=="string"?o.textContent!==_&&(d.suppressHydrationWarning!==!0&&Af(o.textContent,_,i),a=["children",_]):typeof _=="number"&&o.textContent!==""+_&&(d.suppressHydrationWarning!==!0&&Af(o.textContent,_,i),a=["children",""+_]):ea.hasOwnProperty(g)&&_!=null&&g==="onScroll"&&D("scroll",o)}switch(s){case"input":Va(o),db(o,d,!0);break;case"textarea":Va(o),jb(o);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(o.onclick=Bf)}o=a,e.updateQueue=o,o!==null&&(e.flags|=4)}else{g=a.nodeType===9?a:a.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=kb(s)),i==="http://www.w3.org/1999/xhtml"?s==="script"?(i=g.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof o.is=="string"?i=g.createElement(s,{is:o.is}):(i=g.createElement(s),s==="select"&&(g=i,o.multiple?g.multiple=!0:o.size&&(g.size=o.size))):i=g.createElementNS(i,s),i[Of]=e,i[Pf]=o,Aj(i,e,!1,!1),e.stateNode=i;e:{switch(g=vb(s,o),s){case"dialog":D("cancel",i),D("close",i),a=o;break;case"iframe":case"object":case"embed":D("load",i),a=o;break;case"video":case"audio":for(a=0;a<lf.length;a++)D(lf[a],i);a=o;break;case"source":D("error",i),a=o;break;case"img":case"image":case"link":D("error",i),D("load",i),a=o;break;case"details":D("toggle",i),a=o;break;case"input":Za(i,o),a=Ya(i,o),D("invalid",i);break;case"option":a=o;break;case"select":i._wrapperState={wasMultiple:!!o.multiple},a=A({},o,{value:void 0}),D("invalid",i);break;case"textarea":hb(i,o),a=gb(i,o),D("invalid",i);break;default:a=o}ub(s,a),_=a;for(d in _)if(_.hasOwnProperty(d)){var j=_[d];d==="style"?sb(i,j):d==="dangerouslySetInnerHTML"?(j=j?j.__html:void 0,j!=null&&nb(i,j)):d==="children"?typeof j=="string"?(s!=="textarea"||j!=="")&&ob(i,j):typeof j=="number"&&ob(i,""+j):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ea.hasOwnProperty(d)?j!=null&&d==="onScroll"&&D("scroll",i):j!=null&&ta(i,d,j,g))}switch(s){case"input":Va(i),db(i,o,!1);break;case"textarea":Va(i),jb(i);break;case"option":o.value!=null&&i.setAttribute("value",""+Sa(o.value));break;case"select":i.multiple=!!o.multiple,d=o.value,d!=null?fb(i,!!o.multiple,d,!1):o.defaultValue!=null&&fb(i,!!o.multiple,o.defaultValue,!0);break;default:typeof a.onClick=="function"&&(i.onclick=Bf)}switch(s){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return S(e),null;case 6:if(i&&e.stateNode!=null)Dj(i,e,i.memoizedProps,o);else{if(typeof o!="string"&&e.stateNode===null)throw Error(p(166));if(s=Hh(Gh.current),Hh(Eh.current),Gg(e)){if(o=e.stateNode,s=e.memoizedProps,o[Of]=e,(d=o.nodeValue!==s)&&(i=xg,i!==null))switch(i.tag){case 3:Af(o.nodeValue,s,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Af(o.nodeValue,s,(i.mode&1)!==0)}d&&(e.flags|=4)}else o=(s.nodeType===9?s:s.ownerDocument).createTextNode(o),o[Of]=e,e.stateNode=o}return S(e),null;case 13:if(E(M),o=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(I&&yg!==null&&e.mode&1&&!(e.flags&128))Hg(),Ig(),e.flags|=98560,d=!1;else if(d=Gg(e),o!==null&&o.dehydrated!==null){if(i===null){if(!d)throw Error(p(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(p(317));d[Of]=e}else Ig(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;S(e),d=!1}else zg!==null&&(Gj(zg),zg=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=s,e):(o=o!==null,o!==(i!==null&&i.memoizedState!==null)&&o&&(e.child.flags|=8192,e.mode&1&&(i===null||M.current&1?T===0&&(T=3):uj())),e.updateQueue!==null&&(e.flags|=4),S(e),null);case 4:return Jh(),Bj(i,e),i===null&&sf(e.stateNode.containerInfo),S(e),null;case 10:return Rg(e.type._context),S(e),null;case 17:return Zf(e.type)&&$f(),S(e),null;case 19:if(E(M),d=e.memoizedState,d===null)return S(e),null;if(o=(e.flags&128)!==0,g=d.rendering,g===null)if(o)Ej(d,!1);else{if(T!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(g=Mh(i),g!==null){for(e.flags|=128,Ej(d,!1),o=g.updateQueue,o!==null&&(e.updateQueue=o,e.flags|=4),e.subtreeFlags=0,o=s,s=e.child;s!==null;)d=s,i=o,d.flags&=14680066,g=d.alternate,g===null?(d.childLanes=0,d.lanes=i,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=g.childLanes,d.lanes=g.lanes,d.child=g.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=g.memoizedProps,d.memoizedState=g.memoizedState,d.updateQueue=g.updateQueue,d.type=g.type,i=g.dependencies,d.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s=s.sibling;return G(M,M.current&1|2),e.child}i=i.sibling}d.tail!==null&&B()>Hj&&(e.flags|=128,o=!0,Ej(d,!1),e.lanes=4194304)}else{if(!o)if(i=Mh(g),i!==null){if(e.flags|=128,o=!0,s=i.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),Ej(d,!0),d.tail===null&&d.tailMode==="hidden"&&!g.alternate&&!I)return S(e),null}else 2*B()-d.renderingStartTime>Hj&&s!==1073741824&&(e.flags|=128,o=!0,Ej(d,!1),e.lanes=4194304);d.isBackwards?(g.sibling=e.child,e.child=g):(s=d.last,s!==null?s.sibling=g:e.child=g,d.last=g)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=B(),e.sibling=null,s=M.current,G(M,o?s&1|2:s&1),e):(S(e),null);case 22:case 23:return Ij(),o=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==o&&(e.flags|=8192),o&&e.mode&1?gj&1073741824&&(S(e),e.subtreeFlags&6&&(e.flags|=8192)):S(e),null;case 24:return null;case 25:return null}throw Error(p(156,e.tag))}function Jj(i,e){switch(wg(e),e.tag){case 1:return Zf(e.type)&&$f(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Jh(),E(Wf),E(H),Oh(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return Lh(e),null;case 13:if(E(M),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(p(340));Ig()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(e.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj(i,e){var s=i.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(o){W(i,e,o)}else s.current=null}function Nj(i,e,s){try{s()}catch(o){W(i,e,o)}}var Oj=!1;function Pj(i,e){if(Cf=dd,i=Me(),Ne(i)){if("selectionStart"in i)var s={start:i.selectionStart,end:i.selectionEnd};else e:{s=(s=i.ownerDocument)&&s.defaultView||window;var o=s.getSelection&&s.getSelection();if(o&&o.rangeCount!==0){s=o.anchorNode;var a=o.anchorOffset,d=o.focusNode;o=o.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var g=0,_=-1,j=-1,_e=0,et=0,tt=i,rt=null;t:for(;;){for(var it;tt!==s||a!==0&&tt.nodeType!==3||(_=g+a),tt!==d||o!==0&&tt.nodeType!==3||(j=g+o),tt.nodeType===3&&(g+=tt.nodeValue.length),(it=tt.firstChild)!==null;)rt=tt,tt=it;for(;;){if(tt===i)break t;if(rt===s&&++_e===a&&(_=g),rt===d&&++et===o&&(j=g),(it=tt.nextSibling)!==null)break;tt=rt,rt=tt.parentNode}tt=it}s=_===-1||j===-1?null:{start:_,end:j}}else s=null}s=s||{start:0,end:0}}else s=null;for(Df={focusedElem:i,selectionRange:s},dd=!1,V=e;V!==null;)if(e=V,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,V=i;else for(;V!==null;){e=V;try{var ot=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(ot!==null){var ct=ot.memoizedProps,ft=ot.memoizedState,dt=e.stateNode,pt=dt.getSnapshotBeforeUpdate(e.elementType===e.type?ct:Lg(e.type,ct),ft);dt.__reactInternalSnapshotBeforeUpdate=pt}break;case 3:var gt=e.stateNode.containerInfo;gt.nodeType===1?gt.textContent="":gt.nodeType===9&&gt.documentElement&&gt.removeChild(gt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Ct){W(e,e.return,Ct)}if(i=e.sibling,i!==null){i.return=e.return,V=i;break}V=e.return}return ot=Oj,Oj=!1,ot}function Qj(i,e,s){var o=e.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var a=o=o.next;do{if((a.tag&i)===i){var d=a.destroy;a.destroy=void 0,d!==void 0&&Nj(e,s,d)}a=a.next}while(a!==o)}}function Rj(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var s=e=e.next;do{if((s.tag&i)===i){var o=s.create;s.destroy=o()}s=s.next}while(s!==e)}}function Sj(i){var e=i.ref;if(e!==null){var s=i.stateNode;switch(i.tag){case 5:i=s;break;default:i=s}typeof e=="function"?e(i):e.current=i}}function Tj(i){var e=i.alternate;e!==null&&(i.alternate=null,Tj(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[Of],delete e[Pf],delete e[of],delete e[Qf],delete e[Rf])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Uj(i){return i.tag===5||i.tag===3||i.tag===4}function Vj(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Uj(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Wj(i,e,s){var o=i.tag;if(o===5||o===6)i=i.stateNode,e?s.nodeType===8?s.parentNode.insertBefore(i,e):s.insertBefore(i,e):(s.nodeType===8?(e=s.parentNode,e.insertBefore(i,s)):(e=s,e.appendChild(i)),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Bf));else if(o!==4&&(i=i.child,i!==null))for(Wj(i,e,s),i=i.sibling;i!==null;)Wj(i,e,s),i=i.sibling}function Xj(i,e,s){var o=i.tag;if(o===5||o===6)i=i.stateNode,e?s.insertBefore(i,e):s.appendChild(i);else if(o!==4&&(i=i.child,i!==null))for(Xj(i,e,s),i=i.sibling;i!==null;)Xj(i,e,s),i=i.sibling}var X=null,Yj=!1;function Zj(i,e,s){for(s=s.child;s!==null;)ak(i,e,s),s=s.sibling}function ak(i,e,s){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,s)}catch{}switch(s.tag){case 5:U||Mj(s,e);case 6:var o=X,a=Yj;X=null,Zj(i,e,s),X=o,Yj=a,X!==null&&(Yj?(i=X,s=s.stateNode,i.nodeType===8?i.parentNode.removeChild(s):i.removeChild(s)):X.removeChild(s.stateNode));break;case 18:X!==null&&(Yj?(i=X,s=s.stateNode,i.nodeType===8?Kf(i.parentNode,s):i.nodeType===1&&Kf(i,s),bd(i)):Kf(X,s.stateNode));break;case 4:o=X,a=Yj,X=s.stateNode.containerInfo,Yj=!0,Zj(i,e,s),X=o,Yj=a;break;case 0:case 11:case 14:case 15:if(!U&&(o=s.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){a=o=o.next;do{var d=a,g=d.destroy;d=d.tag,g!==void 0&&(d&2||d&4)&&Nj(s,e,g),a=a.next}while(a!==o)}Zj(i,e,s);break;case 1:if(!U&&(Mj(s,e),o=s.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=s.memoizedProps,o.state=s.memoizedState,o.componentWillUnmount()}catch(_){W(s,e,_)}Zj(i,e,s);break;case 21:Zj(i,e,s);break;case 22:s.mode&1?(U=(o=U)||s.memoizedState!==null,Zj(i,e,s),U=o):Zj(i,e,s);break;default:Zj(i,e,s)}}function bk(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var s=i.stateNode;s===null&&(s=i.stateNode=new Lj),e.forEach(function(o){var a=ck.bind(null,i,o);s.has(o)||(s.add(o),o.then(a,a))})}}function dk(i,e){var s=e.deletions;if(s!==null)for(var o=0;o<s.length;o++){var a=s[o];try{var d=i,g=e,_=g;e:for(;_!==null;){switch(_.tag){case 5:X=_.stateNode,Yj=!1;break e;case 3:X=_.stateNode.containerInfo,Yj=!0;break e;case 4:X=_.stateNode.containerInfo,Yj=!0;break e}_=_.return}if(X===null)throw Error(p(160));ak(d,g,a),X=null,Yj=!1;var j=a.alternate;j!==null&&(j.return=null),a.return=null}catch(_e){W(a,e,_e)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ek(e,i),e=e.sibling}function ek(i,e){var s=i.alternate,o=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(dk(e,i),fk(i),o&4){try{Qj(3,i,i.return),Rj(3,i)}catch(ct){W(i,i.return,ct)}try{Qj(5,i,i.return)}catch(ct){W(i,i.return,ct)}}break;case 1:dk(e,i),fk(i),o&512&&s!==null&&Mj(s,s.return);break;case 5:if(dk(e,i),fk(i),o&512&&s!==null&&Mj(s,s.return),i.flags&32){var a=i.stateNode;try{ob(a,"")}catch(ct){W(i,i.return,ct)}}if(o&4&&(a=i.stateNode,a!=null)){var d=i.memoizedProps,g=s!==null?s.memoizedProps:d,_=i.type,j=i.updateQueue;if(i.updateQueue=null,j!==null)try{_==="input"&&d.type==="radio"&&d.name!=null&&ab(a,d),vb(_,g);var _e=vb(_,d);for(g=0;g<j.length;g+=2){var et=j[g],tt=j[g+1];et==="style"?sb(a,tt):et==="dangerouslySetInnerHTML"?nb(a,tt):et==="children"?ob(a,tt):ta(a,et,tt,_e)}switch(_){case"input":bb(a,d);break;case"textarea":ib(a,d);break;case"select":var rt=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!d.multiple;var it=d.value;it!=null?fb(a,!!d.multiple,it,!1):rt!==!!d.multiple&&(d.defaultValue!=null?fb(a,!!d.multiple,d.defaultValue,!0):fb(a,!!d.multiple,d.multiple?[]:"",!1))}a[Pf]=d}catch(ct){W(i,i.return,ct)}}break;case 6:if(dk(e,i),fk(i),o&4){if(i.stateNode===null)throw Error(p(162));a=i.stateNode,d=i.memoizedProps;try{a.nodeValue=d}catch(ct){W(i,i.return,ct)}}break;case 3:if(dk(e,i),fk(i),o&4&&s!==null&&s.memoizedState.isDehydrated)try{bd(e.containerInfo)}catch(ct){W(i,i.return,ct)}break;case 4:dk(e,i),fk(i);break;case 13:dk(e,i),fk(i),a=i.child,a.flags&8192&&(d=a.memoizedState!==null,a.stateNode.isHidden=d,!d||a.alternate!==null&&a.alternate.memoizedState!==null||(gk=B())),o&4&&bk(i);break;case 22:if(et=s!==null&&s.memoizedState!==null,i.mode&1?(U=(_e=U)||et,dk(e,i),U=_e):dk(e,i),fk(i),o&8192){if(_e=i.memoizedState!==null,(i.stateNode.isHidden=_e)&&!et&&i.mode&1)for(V=i,et=i.child;et!==null;){for(tt=V=et;V!==null;){switch(rt=V,it=rt.child,rt.tag){case 0:case 11:case 14:case 15:Qj(4,rt,rt.return);break;case 1:Mj(rt,rt.return);var ot=rt.stateNode;if(typeof ot.componentWillUnmount=="function"){o=rt,s=rt.return;try{e=o,ot.props=e.memoizedProps,ot.state=e.memoizedState,ot.componentWillUnmount()}catch(ct){W(o,s,ct)}}break;case 5:Mj(rt,rt.return);break;case 22:if(rt.memoizedState!==null){hk(tt);continue}}it!==null?(it.return=rt,V=it):hk(tt)}et=et.sibling}e:for(et=null,tt=i;;){if(tt.tag===5){if(et===null){et=tt;try{a=tt.stateNode,_e?(d=a.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(_=tt.stateNode,j=tt.memoizedProps.style,g=j!=null&&j.hasOwnProperty("display")?j.display:null,_.style.display=rb("display",g))}catch(ct){W(i,i.return,ct)}}}else if(tt.tag===6){if(et===null)try{tt.stateNode.nodeValue=_e?"":tt.memoizedProps}catch(ct){W(i,i.return,ct)}}else if((tt.tag!==22&&tt.tag!==23||tt.memoizedState===null||tt===i)&&tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===i)break e;for(;tt.sibling===null;){if(tt.return===null||tt.return===i)break e;et===tt&&(et=null),tt=tt.return}et===tt&&(et=null),tt.sibling.return=tt.return,tt=tt.sibling}}break;case 19:dk(e,i),fk(i),o&4&&bk(i);break;case 21:break;default:dk(e,i),fk(i)}}function fk(i){var e=i.flags;if(e&2){try{e:{for(var s=i.return;s!==null;){if(Uj(s)){var o=s;break e}s=s.return}throw Error(p(160))}switch(o.tag){case 5:var a=o.stateNode;o.flags&32&&(ob(a,""),o.flags&=-33);var d=Vj(i);Xj(i,d,a);break;case 3:case 4:var g=o.stateNode.containerInfo,_=Vj(i);Wj(i,_,g);break;default:throw Error(p(161))}}catch(j){W(i,i.return,j)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function ik(i,e,s){V=i,jk(i)}function jk(i,e,s){for(var o=(i.mode&1)!==0;V!==null;){var a=V,d=a.child;if(a.tag===22&&o){var g=a.memoizedState!==null||Kj;if(!g){var _=a.alternate,j=_!==null&&_.memoizedState!==null||U;_=Kj;var _e=U;if(Kj=g,(U=j)&&!_e)for(V=a;V!==null;)g=V,j=g.child,g.tag===22&&g.memoizedState!==null?kk(a):j!==null?(j.return=g,V=j):kk(a);for(;d!==null;)V=d,jk(d),d=d.sibling;V=a,Kj=_,U=_e}lk(i)}else a.subtreeFlags&8772&&d!==null?(d.return=a,V=d):lk(i)}}function lk(i){for(;V!==null;){var e=V;if(e.flags&8772){var s=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:U||Rj(5,e);break;case 1:var o=e.stateNode;if(e.flags&4&&!U)if(s===null)o.componentDidMount();else{var a=e.elementType===e.type?s.memoizedProps:Lg(e.type,s.memoizedProps);o.componentDidUpdate(a,s.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&ih(e,d,o);break;case 3:var g=e.updateQueue;if(g!==null){if(s=null,e.child!==null)switch(e.child.tag){case 5:s=e.child.stateNode;break;case 1:s=e.child.stateNode}ih(e,g,s)}break;case 5:var _=e.stateNode;if(s===null&&e.flags&4){s=_;var j=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":j.autoFocus&&s.focus();break;case"img":j.src&&(s.src=j.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var _e=e.alternate;if(_e!==null){var et=_e.memoizedState;if(et!==null){var tt=et.dehydrated;tt!==null&&bd(tt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||e.flags&512&&Sj(e)}catch(rt){W(e,e.return,rt)}}if(e===i){V=null;break}if(s=e.sibling,s!==null){s.return=e.return,V=s;break}V=e.return}}function hk(i){for(;V!==null;){var e=V;if(e===i){V=null;break}var s=e.sibling;if(s!==null){s.return=e.return,V=s;break}V=e.return}}function kk(i){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var s=e.return;try{Rj(4,e)}catch(j){W(e,s,j)}break;case 1:var o=e.stateNode;if(typeof o.componentDidMount=="function"){var a=e.return;try{o.componentDidMount()}catch(j){W(e,a,j)}}var d=e.return;try{Sj(e)}catch(j){W(e,d,j)}break;case 5:var g=e.return;try{Sj(e)}catch(j){W(e,g,j)}}}catch(j){W(e,e.return,j)}if(e===i){V=null;break}var _=e.sibling;if(_!==null){_.return=e.return,V=_;break}V=e.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(i){return i.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(i=C,i!==0||(i=window.event,i=i===void 0?16:jd(i.type)),i):1}function mh(i,e,s,o){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac(i,s,o),(!(K&2)||i!==R)&&(i===R&&(!(K&2)&&(rk|=s),T===4&&Dk(i,Z)),Ek(i,o),s===1&&K===0&&!(e.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(i,e){var s=i.callbackNode;wc(i,e);var o=uc(i,i===R?Z:0);if(o===0)s!==null&&bc(s),i.callbackNode=null,i.callbackPriority=0;else if(e=o&-o,i.callbackPriority!==e){if(s!=null&&bc(s),e===1)i.tag===0?ig(Fk.bind(null,i)):hg(Fk.bind(null,i)),Jf(function(){!(K&6)&&jg()}),s=null;else{switch(Dc(o)){case 1:s=fc;break;case 4:s=gc;break;case 16:s=hc;break;case 536870912:s=jc;break;default:s=hc}s=Gk(s,Hk.bind(null,i))}i.callbackPriority=e,i.callbackNode=s}}function Hk(i,e){if(Bk=-1,Ck=0,K&6)throw Error(p(327));var s=i.callbackNode;if(Ik()&&i.callbackNode!==s)return null;var o=uc(i,i===R?Z:0);if(o===0)return null;if(o&30||o&i.expiredLanes||e)e=Jk(i,o);else{e=o;var a=K;K|=2;var d=Kk();(R!==i||Z!==e)&&(vk=null,Hj=B()+500,Lk(i,e));do try{Mk();break}catch(_){Nk(i,_)}while(1);Qg(),nk.current=d,K=a,Y!==null?e=0:(R=null,Z=0,e=T)}if(e!==0){if(e===2&&(a=xc(i),a!==0&&(o=a,e=Ok(i,a))),e===1)throw s=qk,Lk(i,0),Dk(i,o),Ek(i,B()),s;if(e===6)Dk(i,o);else{if(a=i.current.alternate,!(o&30)&&!Pk(a)&&(e=Jk(i,o),e===2&&(d=xc(i),d!==0&&(o=d,e=Ok(i,d))),e===1))throw s=qk,Lk(i,0),Dk(i,o),Ek(i,B()),s;switch(i.finishedWork=a,i.finishedLanes=o,e){case 0:case 1:throw Error(p(345));case 2:Qk(i,uk,vk);break;case 3:if(Dk(i,o),(o&130023424)===o&&(e=gk+500-B(),10<e)){if(uc(i,0)!==0)break;if(a=i.suspendedLanes,(a&o)!==o){L(),i.pingedLanes|=i.suspendedLanes&a;break}i.timeoutHandle=Ff(Qk.bind(null,i,uk,vk),e);break}Qk(i,uk,vk);break;case 4:if(Dk(i,o),(o&4194240)===o)break;for(e=i.eventTimes,a=-1;0<o;){var g=31-oc(o);d=1<<g,g=e[g],g>a&&(a=g),o&=~d}if(o=a,o=B()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*mk(o/1960))-o,10<o){i.timeoutHandle=Ff(Qk.bind(null,i,uk,vk),o);break}Qk(i,uk,vk);break;case 5:Qk(i,uk,vk);break;default:throw Error(p(329))}}}return Ek(i,B()),i.callbackNode===s?Hk.bind(null,i):null}function Ok(i,e){var s=tk;return i.current.memoizedState.isDehydrated&&(Lk(i,e).flags|=256),i=Jk(i,e),i!==2&&(e=uk,uk=s,e!==null&&Gj(e)),i}function Gj(i){uk===null?uk=i:uk.push.apply(uk,i)}function Pk(i){for(var e=i;;){if(e.flags&16384){var s=e.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var o=0;o<s.length;o++){var a=s[o],d=a.getSnapshot;a=a.value;try{if(!He(d(),a))return!1}catch{return!1}}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Dk(i,e){for(e&=~sk,e&=~rk,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var s=31-oc(e),o=1<<s;i[s]=-1,e&=~o}}function Fk(i){if(K&6)throw Error(p(327));Ik();var e=uc(i,0);if(!(e&1))return Ek(i,B()),null;var s=Jk(i,e);if(i.tag!==0&&s===2){var o=xc(i);o!==0&&(e=o,s=Ok(i,o))}if(s===1)throw s=qk,Lk(i,0),Dk(i,e),Ek(i,B()),s;if(s===6)throw Error(p(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,Qk(i,uk,vk),Ek(i,B()),null}function Rk(i,e){var s=K;K|=1;try{return i(e)}finally{K=s,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(i){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var e=K;K|=1;var s=pk.transition,o=C;try{if(pk.transition=null,C=1,i)return i()}finally{C=o,pk.transition=s,K=e,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(i,e){i.finishedWork=null,i.finishedLanes=0;var s=i.timeoutHandle;if(s!==-1&&(i.timeoutHandle=-1,Gf(s)),Y!==null)for(s=Y.return;s!==null;){var o=s;switch(wg(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(o);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(o.type._context);break;case 22:case 23:Ij()}s=s.return}if(R=i,Y=i=wh(i.current,null),Z=gj=e,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(e=0;e<Wg.length;e++)if(s=Wg[e],o=s.interleaved,o!==null){s.interleaved=null;var a=o.next,d=s.pending;if(d!==null){var g=d.next;d.next=a,o.next=g}s.pending=o}Wg=null}return i}function Nk(i,e){do{var s=Y;try{if(Qg(),Ph.current=ai,Sh){for(var o=N.memoizedState;o!==null;){var a=o.queue;a!==null&&(a.pending=null),o=o.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,s===null||s.return===null){T=1,qk=e,Y=null;break}e:{var d=i,g=s.return,_=s,j=e;if(e=Z,_.flags|=32768,j!==null&&typeof j=="object"&&typeof j.then=="function"){var _e=j,et=_,tt=et.tag;if(!(et.mode&1)&&(tt===0||tt===11||tt===15)){var rt=et.alternate;rt?(et.updateQueue=rt.updateQueue,et.memoizedState=rt.memoizedState,et.lanes=rt.lanes):(et.updateQueue=null,et.memoizedState=null)}var it=Vi(g);if(it!==null){it.flags&=-257,Wi(it,g,_,d,e),it.mode&1&&Ti(d,_e,e),e=it,j=_e;var ot=e.updateQueue;if(ot===null){var ct=new Set;ct.add(j),e.updateQueue=ct}else ot.add(j);break e}else{if(!(e&1)){Ti(d,_e,e),uj();break e}j=Error(p(426))}}else if(I&&_.mode&1){var ft=Vi(g);if(ft!==null){!(ft.flags&65536)&&(ft.flags|=256),Wi(ft,g,_,d,e),Jg(Ki(j,_));break e}}d=j=Ki(j,_),T!==4&&(T=2),tk===null?tk=[d]:tk.push(d),d=g;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var dt=Oi(d,j,e);fh(d,dt);break e;case 1:_=j;var pt=d.type,gt=d.stateNode;if(!(d.flags&128)&&(typeof pt.getDerivedStateFromError=="function"||gt!==null&&typeof gt.componentDidCatch=="function"&&(Si===null||!Si.has(gt)))){d.flags|=65536,e&=-e,d.lanes|=e;var Ct=Ri(d,_,e);fh(d,Ct);break e}}d=d.return}while(d!==null)}Tk(s)}catch(xt){e=xt,Y===s&&s!==null&&(Y=s=s.return);continue}break}while(1)}function Kk(){var i=nk.current;return nk.current=ai,i===null?ai:i}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk(i,e){var s=K;K|=2;var o=Kk();(R!==i||Z!==e)&&(vk=null,Lk(i,e));do try{Uk();break}catch(a){Nk(i,a)}while(1);if(Qg(),K=s,nk.current=o,Y!==null)throw Error(p(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk(i){var e=Wk(i.alternate,i,gj);i.memoizedProps=i.pendingProps,e===null?Tk(i):Y=e,ok.current=null}function Tk(i){var e=i;do{var s=e.alternate;if(i=e.return,e.flags&32768){if(s=Jj(s,e),s!==null){s.flags&=32767,Y=s;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{T=6,Y=null;return}}else if(s=Fj(s,e,gj),s!==null){Y=s;return}if(e=e.sibling,e!==null){Y=e;return}Y=e=i}while(e!==null);T===0&&(T=5)}function Qk(i,e,s){var o=C,a=pk.transition;try{pk.transition=null,C=1,Xk(i,e,s,o)}finally{pk.transition=a,C=o}return null}function Xk(i,e,s,o){do Ik();while(xk!==null);if(K&6)throw Error(p(327));s=i.finishedWork;var a=i.finishedLanes;if(s===null)return null;if(i.finishedWork=null,i.finishedLanes=0,s===i.current)throw Error(p(177));i.callbackNode=null,i.callbackPriority=0;var d=s.lanes|s.childLanes;if(Bc(i,d),i===R&&(Y=R=null,Z=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),d=(s.flags&15990)!==0,s.subtreeFlags&15990||d){d=pk.transition,pk.transition=null;var g=C;C=1;var _=K;K|=4,ok.current=null,Pj(i,s),ek(s,i),Oe(Df),dd=!!Cf,Df=Cf=null,i.current=s,ik(s),dc(),K=_,C=g,pk.transition=d}else i.current=s;if(wk&&(wk=!1,xk=i,yk=a),d=i.pendingLanes,d===0&&(Si=null),mc(s.stateNode),Ek(i,B()),e!==null)for(o=i.onRecoverableError,s=0;s<e.length;s++)a=e[s],o(a.value,{componentStack:a.stack,digest:a.digest});if(Pi)throw Pi=!1,i=Qi,Qi=null,i;return yk&1&&i.tag!==0&&Ik(),d=i.pendingLanes,d&1?i===Ak?zk++:(zk=0,Ak=i):zk=0,jg(),null}function Ik(){if(xk!==null){var i=Dc(yk),e=pk.transition,s=C;try{if(pk.transition=null,C=16>i?16:i,xk===null)var o=!1;else{if(i=xk,xk=null,yk=0,K&6)throw Error(p(331));var a=K;for(K|=4,V=i.current;V!==null;){var d=V,g=d.child;if(V.flags&16){var _=d.deletions;if(_!==null){for(var j=0;j<_.length;j++){var _e=_[j];for(V=_e;V!==null;){var et=V;switch(et.tag){case 0:case 11:case 15:Qj(8,et,d)}var tt=et.child;if(tt!==null)tt.return=et,V=tt;else for(;V!==null;){et=V;var rt=et.sibling,it=et.return;if(Tj(et),et===_e){V=null;break}if(rt!==null){rt.return=it,V=rt;break}V=it}}}var ot=d.alternate;if(ot!==null){var ct=ot.child;if(ct!==null){ot.child=null;do{var ft=ct.sibling;ct.sibling=null,ct=ft}while(ct!==null)}}V=d}}if(d.subtreeFlags&2064&&g!==null)g.return=d,V=g;else e:for(;V!==null;){if(d=V,d.flags&2048)switch(d.tag){case 0:case 11:case 15:Qj(9,d,d.return)}var dt=d.sibling;if(dt!==null){dt.return=d.return,V=dt;break e}V=d.return}}var pt=i.current;for(V=pt;V!==null;){g=V;var gt=g.child;if(g.subtreeFlags&2064&&gt!==null)gt.return=g,V=gt;else e:for(g=pt;V!==null;){if(_=V,_.flags&2048)try{switch(_.tag){case 0:case 11:case 15:Rj(9,_)}}catch(xt){W(_,_.return,xt)}if(_===g){V=null;break e}var Ct=_.sibling;if(Ct!==null){Ct.return=_.return,V=Ct;break e}V=_.return}}if(K=a,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,i)}catch{}o=!0}return o}finally{C=s,pk.transition=e}}return!1}function Yk(i,e,s){e=Ki(s,e),e=Oi(i,e,1),i=dh(i,e,1),e=L(),i!==null&&(Ac(i,1,e),Ek(i,e))}function W(i,e,s){if(i.tag===3)Yk(i,i,s);else for(;e!==null;){if(e.tag===3){Yk(e,i,s);break}else if(e.tag===1){var o=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(Si===null||!Si.has(o))){i=Ki(s,i),i=Ri(e,i,1),e=dh(e,i,1),i=L(),e!==null&&(Ac(e,1,i),Ek(e,i));break}}e=e.return}}function Ui(i,e,s){var o=i.pingCache;o!==null&&o.delete(e),e=L(),i.pingedLanes|=i.suspendedLanes&s,R===i&&(Z&s)===s&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk(i,0):sk|=s),Ek(i,e)}function Zk(i,e){e===0&&(i.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var s=L();i=Zg(i,e),i!==null&&(Ac(i,e,s),Ek(i,s))}function vj(i){var e=i.memoizedState,s=0;e!==null&&(s=e.retryLane),Zk(i,s)}function ck(i,e){var s=0;switch(i.tag){case 13:var o=i.stateNode,a=i.memoizedState;a!==null&&(s=a.retryLane);break;case 19:o=i.stateNode;break;default:throw Error(p(314))}o!==null&&o.delete(e),Zk(i,s)}var Wk;Wk=function(i,e,s){if(i!==null)if(i.memoizedProps!==e.pendingProps||Wf.current)Ug=!0;else{if(!(i.lanes&s)&&!(e.flags&128))return Ug=!1,zj(i,e,s);Ug=!!(i.flags&131072)}else Ug=!1,I&&e.flags&1048576&&ug(e,ng,e.index);switch(e.lanes=0,e.tag){case 2:var o=e.type;jj(i,e),i=e.pendingProps;var a=Yf(e,H.current);Tg(e,s),a=Xh(null,e,o,i,a,s);var d=bi();return e.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zf(o)?(d=!0,cg(e)):d=!1,e.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,ah(e),a.updater=nh,e.stateNode=a,a._reactInternals=e,rh(e,o,i,s),e=kj(null,e,o,!0,d,s)):(e.tag=0,I&&d&&vg(e),Yi(null,e,a,s),e=e.child),e;case 16:o=e.elementType;e:{switch(jj(i,e),i=e.pendingProps,a=o._init,o=a(o._payload),e.type=o,a=e.tag=$k(o),i=Lg(o,i),a){case 0:e=dj(null,e,o,i,s);break e;case 1:e=ij(null,e,o,i,s);break e;case 11:e=Zi(null,e,o,i,s);break e;case 14:e=aj(null,e,o,Lg(o.type,i),s);break e}throw Error(p(306,o,""))}return e;case 0:return o=e.type,a=e.pendingProps,a=e.elementType===o?a:Lg(o,a),dj(i,e,o,a,s);case 1:return o=e.type,a=e.pendingProps,a=e.elementType===o?a:Lg(o,a),ij(i,e,o,a,s);case 3:e:{if(lj(e),i===null)throw Error(p(387));o=e.pendingProps,d=e.memoizedState,a=d.element,bh(i,e),gh(e,o,null,s);var g=e.memoizedState;if(o=g.element,d.isDehydrated)if(d={element:o,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){a=Ki(Error(p(423)),e),e=mj(i,e,o,s,a);break e}else if(o!==a){a=Ki(Error(p(424)),e),e=mj(i,e,o,s,a);break e}else for(yg=Lf(e.stateNode.containerInfo.firstChild),xg=e,I=!0,zg=null,s=Ch(e,null,o,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Ig(),o===a){e=$i(i,e,s);break e}Yi(i,e,o,s)}e=e.child}return e;case 5:return Kh(e),i===null&&Eg(e),o=e.type,a=e.pendingProps,d=i!==null?i.memoizedProps:null,g=a.children,Ef(o,a)?g=null:d!==null&&Ef(o,d)&&(e.flags|=32),hj(i,e),Yi(i,e,g,s),e.child;case 6:return i===null&&Eg(e),null;case 13:return pj(i,e,s);case 4:return Ih(e,e.stateNode.containerInfo),o=e.pendingProps,i===null?e.child=Bh(e,null,o,s):Yi(i,e,o,s),e.child;case 11:return o=e.type,a=e.pendingProps,a=e.elementType===o?a:Lg(o,a),Zi(i,e,o,a,s);case 7:return Yi(i,e,e.pendingProps,s),e.child;case 8:return Yi(i,e,e.pendingProps.children,s),e.child;case 12:return Yi(i,e,e.pendingProps.children,s),e.child;case 10:e:{if(o=e.type._context,a=e.pendingProps,d=e.memoizedProps,g=a.value,G(Mg,o._currentValue),o._currentValue=g,d!==null)if(He(d.value,g)){if(d.children===a.children&&!Wf.current){e=$i(i,e,s);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var _=d.dependencies;if(_!==null){g=d.child;for(var j=_.firstContext;j!==null;){if(j.context===o){if(d.tag===1){j=ch(-1,s&-s),j.tag=2;var _e=d.updateQueue;if(_e!==null){_e=_e.shared;var et=_e.pending;et===null?j.next=j:(j.next=et.next,et.next=j),_e.pending=j}}d.lanes|=s,j=d.alternate,j!==null&&(j.lanes|=s),Sg(d.return,s,e),_.lanes|=s;break}j=j.next}}else if(d.tag===10)g=d.type===e.type?null:d.child;else if(d.tag===18){if(g=d.return,g===null)throw Error(p(341));g.lanes|=s,_=g.alternate,_!==null&&(_.lanes|=s),Sg(g,s,e),g=d.sibling}else g=d.child;if(g!==null)g.return=d;else for(g=d;g!==null;){if(g===e){g=null;break}if(d=g.sibling,d!==null){d.return=g.return,g=d;break}g=g.return}d=g}Yi(i,e,a.children,s),e=e.child}return e;case 9:return a=e.type,o=e.pendingProps.children,Tg(e,s),a=Vg(a),o=o(a),e.flags|=1,Yi(i,e,o,s),e.child;case 14:return o=e.type,a=Lg(o,e.pendingProps),a=Lg(o.type,a),aj(i,e,o,a,s);case 15:return cj(i,e,e.type,e.pendingProps,s);case 17:return o=e.type,a=e.pendingProps,a=e.elementType===o?a:Lg(o,a),jj(i,e),e.tag=1,Zf(o)?(i=!0,cg(e)):i=!1,Tg(e,s),ph(e,o,a),rh(e,o,a,s),kj(null,e,o,!0,i,s);case 19:return yj(i,e,s);case 22:return ej(i,e,s)}throw Error(p(156,e.tag))};function Gk(i,e){return ac(i,e)}function al(i,e,s,o){this.tag=i,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(i,e,s,o){return new al(i,e,s,o)}function bj(i){return i=i.prototype,!(!i||!i.isReactComponent)}function $k(i){if(typeof i=="function")return bj(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Da)return 11;if(i===Ga)return 14}return 2}function wh(i,e){var s=i.alternate;return s===null?(s=Bg(i.tag,e,i.key,i.mode),s.elementType=i.elementType,s.type=i.type,s.stateNode=i.stateNode,s.alternate=i,i.alternate=s):(s.pendingProps=e,s.type=i.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=i.flags&14680064,s.childLanes=i.childLanes,s.lanes=i.lanes,s.child=i.child,s.memoizedProps=i.memoizedProps,s.memoizedState=i.memoizedState,s.updateQueue=i.updateQueue,e=i.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=i.sibling,s.index=i.index,s.ref=i.ref,s}function yh(i,e,s,o,a,d){var g=2;if(o=i,typeof i=="function")bj(i)&&(g=1);else if(typeof i=="string")g=5;else e:switch(i){case ya:return Ah(s.children,a,d,e);case za:g=8,a|=8;break;case Aa:return i=Bg(12,s,e,a|2),i.elementType=Aa,i.lanes=d,i;case Ea:return i=Bg(13,s,e,a),i.elementType=Ea,i.lanes=d,i;case Fa:return i=Bg(19,s,e,a),i.elementType=Fa,i.lanes=d,i;case Ia:return qj(s,a,d,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Ba:g=10;break e;case Ca:g=9;break e;case Da:g=11;break e;case Ga:g=14;break e;case Ha:g=16,o=null;break e}throw Error(p(130,i==null?i:typeof i,""))}return e=Bg(g,s,e,a),e.elementType=i,e.type=o,e.lanes=d,e}function Ah(i,e,s,o){return i=Bg(7,i,o,e),i.lanes=s,i}function qj(i,e,s,o){return i=Bg(22,i,o,e),i.elementType=Ia,i.lanes=s,i.stateNode={isHidden:!1},i}function xh(i,e,s){return i=Bg(6,i,null,e),i.lanes=s,i}function zh(i,e,s){return e=Bg(4,i.children!==null?i.children:[],i.key,e),e.lanes=s,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function bl(i,e,s,o,a){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=o,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function cl(i,e,s,o,a,d,g,_,j){return i=new bl(i,e,s,_,j),e===1?(e=1,d===!0&&(e|=8)):e=0,d=Bg(3,null,null,e),i.current=d,d.stateNode=i,d.memoizedState={element:o,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(d),i}function dl(i,e,s){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:o==null?null:""+o,children:i,containerInfo:e,implementation:s}}function el(i){if(!i)return Vf;i=i._reactInternals;e:{if(Vb(i)!==i||i.tag!==1)throw Error(p(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zf(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(p(171))}if(i.tag===1){var s=i.type;if(Zf(s))return bg(i,s,e)}return e}function fl(i,e,s,o,a,d,g,_,j){return i=cl(s,o,!0,i,a,d,g,_,j),i.context=el(null),s=i.current,o=L(),a=lh(s),d=ch(o,a),d.callback=e??null,dh(s,d,a),i.current.lanes=a,Ac(i,a,o),Ek(i,o),i}function gl(i,e,s,o){var a=e.current,d=L(),g=lh(a);return s=el(s),e.context===null?e.context=s:e.pendingContext=s,e=ch(d,g),e.payload={element:i},o=o===void 0?null:o,o!==null&&(e.callback=o),i=dh(a,e,g),i!==null&&(mh(i,a,g,d),eh(i,a,g)),g}function hl(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function il(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var s=i.retryLane;i.retryLane=s!==0&&s<e?s:e}}function jl(i,e){il(i,e),(i=i.alternate)&&il(i,e)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(i){console.error(i)};function ml(i){this._internalRoot=i}nl.prototype.render=ml.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(p(409));gl(i,e,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;Sk(function(){gl(null,i,null,null)}),e[uf]=null}};function nl(i){this._internalRoot=i}nl.prototype.unstable_scheduleHydration=function(i){if(i){var e=Hc();i={blockedOn:null,target:i,priority:e};for(var s=0;s<Qc.length&&e!==0&&e<Qc[s].priority;s++);Qc.splice(s,0,i),s===0&&Vc(i)}};function ol(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function pl(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(i,e,s,o,a){if(a){if(typeof o=="function"){var d=o;o=function(){var _e=hl(g);d.call(_e)}}var g=fl(e,o,i,0,null,!1,!1,"",ql);return i._reactRootContainer=g,i[uf]=g.current,sf(i.nodeType===8?i.parentNode:i),Sk(),g}for(;a=i.lastChild;)i.removeChild(a);if(typeof o=="function"){var _=o;o=function(){var _e=hl(j);_.call(_e)}}var j=cl(i,0,!1,null,null,!1,!1,"",ql);return i._reactRootContainer=j,i[uf]=j.current,sf(i.nodeType===8?i.parentNode:i),Sk(function(){gl(e,j,s,o)}),j}function sl(i,e,s,o,a){var d=s._reactRootContainer;if(d){var g=d;if(typeof a=="function"){var _=a;a=function(){var j=hl(g);_.call(j)}}gl(e,g,i,a)}else g=rl(s,e,i,a,o);return hl(g)}Ec=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var s=tc(e.pendingLanes);s!==0&&(Cc(e,s|1),Ek(e,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var o=Zg(i,1);if(o!==null){var a=L();mh(o,i,1,a)}}),jl(i,1)}};Fc=function(i){if(i.tag===13){var e=Zg(i,134217728);if(e!==null){var s=L();mh(e,i,134217728,s)}jl(i,134217728)}};Gc=function(i){if(i.tag===13){var e=lh(i),s=Zg(i,e);if(s!==null){var o=L();mh(s,i,e,o)}jl(i,e)}};Hc=function(){return C};Ic=function(i,e){var s=C;try{return C=i,e()}finally{C=s}};yb=function(i,e,s){switch(e){case"input":if(bb(i,s),e=s.name,s.type==="radio"&&e!=null){for(s=i;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<s.length;e++){var o=s[e];if(o!==i&&o.form===i.form){var a=Db(o);if(!a)throw Error(p(90));Wa(o),bb(o,a)}}}break;case"textarea":ib(i,s);break;case"select":e=s.value,e!=null&&fb(i,!!s.multiple,e,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Zb(i),i===null?null:i.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(i,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(e))throw Error(p(200));return dl(i,e,null,s)};reactDom_production_min.createRoot=function(i,e){if(!ol(i))throw Error(p(299));var s=!1,o="",a=ll;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(o=e.identifierPrefix),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=cl(i,1,!1,null,null,s,!1,o,a),i[uf]=e.current,sf(i.nodeType===8?i.parentNode:i),new ml(e)};reactDom_production_min.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(p(188)):(i=Object.keys(i).join(","),Error(p(268,i)));return i=Zb(e),i=i===null?null:i.stateNode,i};reactDom_production_min.flushSync=function(i){return Sk(i)};reactDom_production_min.hydrate=function(i,e,s){if(!pl(e))throw Error(p(200));return sl(null,i,e,!0,s)};reactDom_production_min.hydrateRoot=function(i,e,s){if(!ol(i))throw Error(p(405));var o=s!=null&&s.hydratedSources||null,a=!1,d="",g=ll;if(s!=null&&(s.unstable_strictMode===!0&&(a=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(g=s.onRecoverableError)),e=fl(e,null,i,1,s??null,a,!1,d,g),i[uf]=e.current,sf(i),o)for(i=0;i<o.length;i++)s=o[i],a=s._getVersion,a=a(s._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[s,a]:e.mutableSourceEagerHydrationData.push(s,a);return new nl(e)};reactDom_production_min.render=function(i,e,s){if(!pl(e))throw Error(p(200));return sl(null,i,e,!1,s)};reactDom_production_min.unmountComponentAtNode=function(i){if(!pl(i))throw Error(p(40));return i._reactRootContainer?(Sk(function(){sl(null,null,i,!1,function(){i._reactRootContainer=null,i[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(i,e,s,o){if(!pl(s))throw Error(p(200));if(i==null||i._reactInternals===void 0)throw Error(p(38));return sl(i,e,s,!1,o)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";(function(i){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(s){console.error(s)}}e(),i.exports=reactDom_production_min})(reactDom);var createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;const SEP=/\W*\,\W*/,JOIN=", ",splitTags=i=>i.split(SEP).filter(e=>e);function getTagValueIndices(i,e){return i.split(SEP).length>1&&console.error("todo: process multiple tags in tag input"),e.values.map((s,o)=>s.split(SEP).includes(i)?o:-1).filter(s=>s!=-1)}class TagModel{constructor(e){Lo(this,"tagColumn");Lo(this,"dataModel");Lo(this,"listeners",[]);this.dataModel=new DataModel(e,{autoupdate:!0}),this.dataModel.updateModel(),this.dataModel.addListener("tag",()=>{this.listeners.map(s=>s())}),e.columnIndex.__tags||this.dataModel.createColumn("__tags",null),this.tagColumn=e.columnIndex.__tags}addListener(e){return this.listeners.push(e),e}removeListener(e){const s=this.listeners.indexOf(e);s!=-1&&this.listeners.splice(s,1)}setTag(e,s=!0){this.dataModel.updateModel(),setTag({tag:e,...this},s)}getTags(){return getTags(this.tagColumn)}entireSelectionHasTag(e){const s=this.tagColumn,o=getTagValueIndices(e,s);return!this.dataModel.data.some(a=>!o.includes(s.data[a]))}getTagsInSelection(){const{dataModel:e,tagColumn:s}=this,o=new Set;e.data.forEach(d=>o.add(s.data[d]));const a=[...o].map(d=>s.values[d]);return new Set(a.map(splitTags).flat())}}function getValueIndex(i,e){let s=e.values.indexOf(i);if(s===-1){if(e.values.push(i),e.values.length>256)throw new Error(`text column '${e.name}' exceeded 256 values when adding '${i}'`);s=e.values.length-1}return s}function setTag(i,e=!0){const{tag:s,tagColumn:o,dataModel:a}=i;setTagOnAllSelectedValues(s,o,a,!0,e)}function setTagOnAllSelectedValues(i,e,s,o=!0,a=!0){sanitizeTags(e);const d=getTagValueIndices(i,e),g=new Map;a?e.values.filter((_e,et)=>!d.includes(et)).forEach((_e,et)=>{const rt=[i,...splitTags(_e)].sort().join(JOIN);g.set(et,e.values.indexOf(rt))}):e.values.filter((_e,et)=>d.includes(et)).forEach((_e,et)=>{const rt=splitTags(_e).filter(it=>it!==i).sort().join(JOIN);g.set(et,e.values.indexOf(rt))});const{data:_}=s;let j=0;for(let _e=0;_e<_.length;_e++){const et=e.data[_[_e]];if(a==d.includes(et))continue;j++;const tt=et;let rt=g.get(tt);if(rt==null||rt==-1){const it=e.values[tt],ot=splitTags(it),ft=(a?[i,...ot]:ot.filter(dt=>dt!==i)).sort().join(JOIN);rt=getValueIndex(ft,e),g.set(tt,rt)}e.data[_[_e]]=rt}o&&j&&s.dataStore.dataChanged([e.name])}function sanitizeTags(i,e=!1){const s=i.values.map((j,_e)=>{const et=[...new Set(splitTags(j))].sort().join(JOIN);return{i:_e,unsorted:j,sorted:et}}),o=s.filter(j=>j.sorted==j.unsorted);if(o.length===s.length)return;console.log("sanitizing tags...");const a=o.map(j=>j.sorted);i.values=a;const d=new Map;for(const j of s){const{i:_e,sorted:et}=j;d.set(_e,getValueIndex(et,i))}const g=new Set;for(let j=0;j<i.data.length;j++){const _e=i.data[j]=d.get(i.data[j]);g.add(_e)}const _=s.length-g.size;_&&console.warn(`sanitizeTags left ${_} unused values...`),e&&console.warn("sanitizeTags notify ignored")}function getTags(i){return new Set(i.values.map(splitTags).flat())}class AnnotationDialog extends BaseDialog{constructor(s,o){super({title:"Annotate selection",width:400,height:200,columns:1,buttons:[{text:"Add tag to selection",method:"addTag"},{text:"Remove tag from selection",method:"removeTag"}]},null);Lo(this,"tagModel");Lo(this,"tagListElement");Lo(this,"tagInput");this.outer.classList.add("annotationDialog"),this.tagModel=o||new TagModel(s),this.tagModel.addListener(()=>this.updateTagList());const a=createEl("input",{},this.columns[0]);a.addEventListener("keydown",d=>{d.key=="Enter"&&this.setTag(a.value,!0)}),a.focus(),this.tagInput=a,this.tagListElement=createEl("div",{},this.columns[0]),this.updateTagList()}addTag(){const s=this.tagInput.value;this.setTag(s,!0),this.updateTagList()}removeTag(){const s=this.tagInput.value;this.setTag(s,!1),this.updateTagList()}setTag(s,o){this.tagModel.setTag(s,o),this.updateTagList()}updateTagList(){const{tagModel:s}=this,o=this.tagListElement;o.innerHTML="";const a=createEl("ul",{},o);for(const g of s.getTags()){const _=createEl("li",{},a);createEl("button",{text:g},_).addEventListener("click",()=>this.setTag(g,!0))}const d=createEl("ul",{},o);for(const g of s.getTagsInSelection()){const _=this.tagModel.entireSelectionHasTag(g),j=createEl("li",{classes:[_?"allTagged":"someTagged"]},d);createEl("button",{text:g},j).addEventListener("click",()=>this.setTag(g,!_))}}}function AnnotationDialogComponent({tagModel:i}){const[e,s]=reactExports.useState(i.getTags()),[o,a]=reactExports.useState(i.getTagsInSelection());return reactExports.useEffect(()=>{const d=i.addListener(()=>{s(i.getTags()),a(i.getTagsInSelection())});return()=>{i.removeListener(d)}}),jsxs("div",{children:[jsx("input",{}),jsx("h2",{children:"Tags in selection:"}),jsx("ul",{children:[...o].map(d=>jsx("li",{children:d},"a"+d))}),jsx("h2",{children:"All tags:"}),jsx("ul",{children:[...e].map(d=>jsx("li",{children:d},"b"+d))})]})}class AnnotationDialogReact extends BaseDialog{constructor(s,o){super({title:"Annotate selection",width:400,height:200},null);Lo(this,"tagModel");Lo(this,"tagListElement");Lo(this,"tagInput");this.outer.classList.add("annotationDialog"),this.tagModel=o,createRoot(this.dialog).render(jsx(AnnotationDialogComponent,{tagModel:this.tagModel}))}}BaseDialog.experiment.AnnotationDialogReact=AnnotationDialogReact;const SideEffect="AnnotationDialogReact loaded";export{Viewport as $,AnnotationDialog as A,BaseChart as B,ChartManager as C,DataModel as D,EPSILON$1 as E,checkNumber as F,transformMat4$2 as G,vec4_transformMat3 as H,vec4_transformMat2 as I,transformQuat$1 as J,transformMat3$1 as K,LayerExtension as L,Matrix as M,transformMat3 as N,OrbitView as O,checkVector as P,MathArray as Q,transformQuat as R,ScatterplotLayer as S,TagModel as T,_defineProperty as U,Vector as V,Stats as W,Layer as X,flatten as Y,debug as Z,__vitePreload as _,makeSortable as a,Matrix4 as a0,PROJECTION_MODE as a1,sqrLen as a2,sub as a3,lerp$3 as a4,transformMat4$1 as a5,defaultTypedArrayManager as a6,assert as a7,getAccessorFromBuffer as a8,createIterable as a9,isWebGL2$1 as aA,OrthographicView as aB,hasFeature as aC,hexToRGB as aD,getRandomString as aE,RGBToHex as aF,Buffer as aa,lerp as ab,project32 as ac,picking as ad,Model as ae,Geometry as af,lngLatToWorld as ag,COORDINATE_SYSTEM as ah,Texture2D as ai,load as aj,ImageLoader as ak,copyToTexture as al,UNIT as am,log as an,hasFeatures$1 as ao,FEATURES$1 as ap,Vector3 as aq,getScaling as ar,assert$4 as as,equals as at,WebMercatorViewport as au,memoize as av,DensityScatterPlot as aw,noUiSlider as ax,ProgramManager as ay,Texture3D as az,Deck as b,createEl as c,createRoot as d,jsxs as e,SideEffect as f,BaseDialog as g,ARRAY_TYPE as h,add$2 as i,jsx as j,dot as k,lerp$2 as l,makeDraggable as m,length as n,squaredLength as o,create$2 as p,fromValues as q,reactExports as r,scale as s,dot$1 as t,cross as u,len as v,normalize$1 as w,normalize as x,isArray$1 as y,config as z};
