var lu=Object.defineProperty;var cu=(i,e,t)=>e in i?lu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var As=(i,e,t)=>(cu(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const nouislider_min="",microtip="",all="",ContextMenu$1="",charts="",wgl2di="",slickgrid="";var global$1=typeof window<"u"?window:null,ssr=global$1===null,document$1=ssr?void 0:global$1.document,addEventListener="addEventListener",removeEventListener="removeEventListener",getBoundingClientRect="getBoundingClientRect",gutterStartDragging="_a",aGutterSize="_b",bGutterSize="_c",HORIZONTAL="horizontal",NOOP=function(){return!1},calc=ssr?"calc":["","-webkit-","-moz-","-o-"].filter(function(i){var e=document$1.createElement("div");return e.style.cssText="width:"+i+"calc(9px)",!!e.style.length}).shift()+"calc",isString=function(i){return typeof i=="string"||i instanceof String},elementOrSelector=function(i){if(isString(i)){var e=document$1.querySelector(i);if(!e)throw new Error("Selector "+i+" did not match a DOM element");return e}return i},getOption=function(i,e,t){var r=i[e];return r!==void 0?r:t},getGutterSize=function(i,e,t,r){if(e){if(r==="end")return 0;if(r==="center")return i/2}else if(t){if(r==="start")return 0;if(r==="center")return i/2}return i},defaultGutterFn=function(i,e){var t=document$1.createElement("div");return t.className="gutter gutter-"+e,t},defaultElementStyleFn=function(i,e,t){var r={};return isString(e)?r[i]=e:r[i]=calc+"("+e+"% - "+t+"px)",r},defaultGutterStyleFn=function(i,e){var t;return t={},t[i]=e+"px",t},Split=function(i,e){if(e===void 0&&(e={}),ssr)return{};var t=i,r,s,o,a,l,u;Array.from&&(t=Array.from(t));var p=elementOrSelector(t[0]),d=p.parentNode,m=getComputedStyle?getComputedStyle(d):null,g=m?m.flexDirection:null,w=getOption(e,"sizes")||t.map(function(){return 100/t.length}),E=getOption(e,"minSize",100),A=Array.isArray(E)?E:t.map(function(){return E}),k=getOption(e,"maxSize",1/0),O=Array.isArray(k)?k:t.map(function(){return k}),ne=getOption(e,"expandToMin",!1),Q=getOption(e,"gutterSize",10),ue=getOption(e,"gutterAlign","center"),U=getOption(e,"snapOffset",30),_=Array.isArray(U)?U:t.map(function(){return U}),Se=getOption(e,"dragInterval",1),Me=getOption(e,"direction",HORIZONTAL),Ke=getOption(e,"cursor",Me===HORIZONTAL?"col-resize":"row-resize"),kt=getOption(e,"gutter",defaultGutterFn),Qe=getOption(e,"elementStyle",defaultElementStyleFn),ze=getOption(e,"gutterStyle",defaultGutterStyleFn);Me===HORIZONTAL?(r="width",s="clientX",o="left",a="right",l="clientWidth"):Me==="vertical"&&(r="height",s="clientY",o="top",a="bottom",l="clientHeight");function Je(Lt,je,mt,Vt){var Ut=Qe(r,je,mt,Vt);Object.keys(Ut).forEach(function(ke){Lt.style[ke]=Ut[ke]})}function St(Lt,je,mt){var Vt=ze(r,je,mt);Object.keys(Vt).forEach(function(Ut){Lt.style[Ut]=Vt[Ut]})}function Te(){return u.map(function(Lt){return Lt.size})}function dt(Lt){return"touches"in Lt?Lt.touches[0][s]:Lt[s]}function ot(Lt){var je=u[this.a],mt=u[this.b],Vt=je.size+mt.size;je.size=Lt/this.size*Vt,mt.size=Vt-Lt/this.size*Vt,Je(je.element,je.size,this[aGutterSize],je.i),Je(mt.element,mt.size,this[bGutterSize],mt.i)}function yt(Lt){var je,mt=u[this.a],Vt=u[this.b];this.dragging&&(je=dt(Lt)-this.start+(this[aGutterSize]-this.dragOffset),Se>1&&(je=Math.round(je/Se)*Se),je<=mt.minSize+mt.snapOffset+this[aGutterSize]?je=mt.minSize+this[aGutterSize]:je>=this.size-(Vt.minSize+Vt.snapOffset+this[bGutterSize])&&(je=this.size-(Vt.minSize+this[bGutterSize])),je>=mt.maxSize-mt.snapOffset+this[aGutterSize]?je=mt.maxSize+this[aGutterSize]:je<=this.size-(Vt.maxSize-Vt.snapOffset+this[bGutterSize])&&(je=this.size-(Vt.maxSize+this[bGutterSize])),ot.call(this,je),getOption(e,"onDrag",NOOP)(Te()))}function Ue(){var Lt=u[this.a].element,je=u[this.b].element,mt=Lt[getBoundingClientRect](),Vt=je[getBoundingClientRect]();this.size=mt[r]+Vt[r]+this[aGutterSize]+this[bGutterSize],this.start=mt[o],this.end=mt[a]}function Nt(Lt){if(!getComputedStyle)return null;var je=getComputedStyle(Lt);if(!je)return null;var mt=Lt[l];return mt===0?null:(Me===HORIZONTAL?mt-=parseFloat(je.paddingLeft)+parseFloat(je.paddingRight):mt-=parseFloat(je.paddingTop)+parseFloat(je.paddingBottom),mt)}function Ot(Lt){var je=Nt(d);if(je===null||A.reduce(function(ke,_t){return ke+_t},0)>je)return Lt;var mt=0,Vt=[],Ut=Lt.map(function(ke,_t){var $t=je*ke/100,at=getGutterSize(Q,_t===0,_t===Lt.length-1,ue),Xe=A[_t]+at;return $t<Xe?(mt+=Xe-$t,Vt.push(0),Xe):(Vt.push($t-Xe),$t)});return mt===0?Lt:Ut.map(function(ke,_t){var $t=ke;if(mt>0&&Vt[_t]-mt>0){var at=Math.min(mt,Vt[_t]-mt);mt-=at,$t=ke-at}return $t/je*100})}function wi(){var Lt=this,je=u[Lt.a].element,mt=u[Lt.b].element;Lt.dragging&&getOption(e,"onDragEnd",NOOP)(Te()),Lt.dragging=!1,global$1[removeEventListener]("mouseup",Lt.stop),global$1[removeEventListener]("touchend",Lt.stop),global$1[removeEventListener]("touchcancel",Lt.stop),global$1[removeEventListener]("mousemove",Lt.move),global$1[removeEventListener]("touchmove",Lt.move),Lt.stop=null,Lt.move=null,je[removeEventListener]("selectstart",NOOP),je[removeEventListener]("dragstart",NOOP),mt[removeEventListener]("selectstart",NOOP),mt[removeEventListener]("dragstart",NOOP),je.style.userSelect="",je.style.webkitUserSelect="",je.style.MozUserSelect="",je.style.pointerEvents="",mt.style.userSelect="",mt.style.webkitUserSelect="",mt.style.MozUserSelect="",mt.style.pointerEvents="",Lt.gutter.style.cursor="",Lt.parent.style.cursor="",document$1.body.style.cursor=""}function Bi(Lt){if(!("button"in Lt&&Lt.button!==0)){var je=this,mt=u[je.a].element,Vt=u[je.b].element;je.dragging||getOption(e,"onDragStart",NOOP)(Te()),Lt.preventDefault(),je.dragging=!0,je.move=yt.bind(je),je.stop=wi.bind(je),global$1[addEventListener]("mouseup",je.stop),global$1[addEventListener]("touchend",je.stop),global$1[addEventListener]("touchcancel",je.stop),global$1[addEventListener]("mousemove",je.move),global$1[addEventListener]("touchmove",je.move),mt[addEventListener]("selectstart",NOOP),mt[addEventListener]("dragstart",NOOP),Vt[addEventListener]("selectstart",NOOP),Vt[addEventListener]("dragstart",NOOP),mt.style.userSelect="none",mt.style.webkitUserSelect="none",mt.style.MozUserSelect="none",mt.style.pointerEvents="none",Vt.style.userSelect="none",Vt.style.webkitUserSelect="none",Vt.style.MozUserSelect="none",Vt.style.pointerEvents="none",je.gutter.style.cursor=Ke,je.parent.style.cursor=Ke,document$1.body.style.cursor=Ke,Ue.call(je),je.dragOffset=dt(Lt)-je.end}}w=Ot(w);var Ei=[];u=t.map(function(Lt,je){var mt={element:elementOrSelector(Lt),size:w[je],minSize:A[je],maxSize:O[je],snapOffset:_[je],i:je},Vt;if(je>0&&(Vt={a:je-1,b:je,dragging:!1,direction:Me,parent:d},Vt[aGutterSize]=getGutterSize(Q,je-1===0,!1,ue),Vt[bGutterSize]=getGutterSize(Q,!1,je===t.length-1,ue),g==="row-reverse"||g==="column-reverse")){var Ut=Vt.a;Vt.a=Vt.b,Vt.b=Ut}if(je>0){var ke=kt(je,Me,mt.element);St(ke,Q,je),Vt[gutterStartDragging]=Bi.bind(Vt),ke[addEventListener]("mousedown",Vt[gutterStartDragging]),ke[addEventListener]("touchstart",Vt[gutterStartDragging]),d.insertBefore(ke,mt.element),Vt.gutter=ke}return Je(mt.element,mt.size,getGutterSize(Q,je===0,je===t.length-1,ue),je),je>0&&Ei.push(Vt),mt});function Zi(Lt){var je=Lt.i===Ei.length,mt=je?Ei[Lt.i-1]:Ei[Lt.i];Ue.call(mt);var Vt=je?mt.size-Lt.minSize-mt[bGutterSize]:Lt.minSize+mt[aGutterSize];ot.call(mt,Vt)}u.forEach(function(Lt){var je=Lt.element[getBoundingClientRect]()[r];je<Lt.minSize&&(ne?Zi(Lt):Lt.minSize=je)});function fr(Lt){var je=Ot(Lt);je.forEach(function(mt,Vt){if(Vt>0){var Ut=Ei[Vt-1],ke=u[Ut.a],_t=u[Ut.b];ke.size=je[Vt-1],_t.size=mt,Je(ke.element,ke.size,Ut[aGutterSize],ke.i),Je(_t.element,_t.size,Ut[bGutterSize],_t.i)}})}function Ti(Lt,je){Ei.forEach(function(mt){if(je!==!0?mt.parent.removeChild(mt.gutter):(mt.gutter[removeEventListener]("mousedown",mt[gutterStartDragging]),mt.gutter[removeEventListener]("touchstart",mt[gutterStartDragging])),Lt!==!0){var Vt=Qe(r,mt.a.size,mt[aGutterSize]);Object.keys(Vt).forEach(function(Ut){u[mt.a].element.style[Ut]="",u[mt.b].element.style[Ut]=""})}})}return{setSizes:fr,getSizes:Te,collapse:function(je){Zi(u[je])},destroy:Ti,parent:d,pairs:Ei}};function createEl(i,e,t){const r=document.createElement(i);return e&&addElProps(r,e),t&&t.append(r),r}function createSVGEl(i,e,t){const r=document.createElementNS("http://www.w3.org/2000/svg",i);if(e)for(var s in e)if((s==="styles"||s==="style")&&typeof e[s]=="object")for(var o in e[s])r.style[o]=e[s][o];else if(s==="text")r.textContent=e[s];else if(s==="classes")for(var a of e[s])r.classList.add(a);else r.setAttributeNS(null,s,e[s]);return t&&t.append(r),r}function splitPane(i,e={}){const t=e.direction||"horizontal",r=e.number||2,s=[],o=t==="horizontal"?["split-horizontal"]:["split-vertical"];for(let a=0;a<r;a++)s.push(createEl("div",{classes:o},i));return Split(s,{direction:t,gutterSize:5,cursor:"pointer",sizes:e.sizes,onDragEnd:()=>window.dispatchEvent(new Event("resize"))}),s}function createMenuIcon(i,e,t){const r={},s=e.tooltip;s&&Object.assign(r,{"aria-label":s.text,role:"tooltip","data-microtip-size":s.size||"small","data-microtip-position":s.position||"bottom-left"});const o=createEl("span",r);return createEl("i",{classes:["ciview-menu-icon"].concat(i.split(" ")),styles:{fontSize:e.size||"18px"}},o),e.func&&o.addEventListener("click",a=>e.func(a)),t&&t.append(o),o}function addElProps(i,e){for(var t in e)if((t==="styles"||t==="style")&&typeof e[t]=="object")for(var r in e[t])i.style[r]=e[t][r];else if(t==="text")i.textContent=e[t];else if(t==="classes")for(var s of e[t])i.classList.add(s);else i.setAttribute(t,e[t])}function makeSortable(i,e={}){let t=null,r=!1;function s(p){return this.after(t),p.preventDefault(),!1}function o(p){r=!1,t.classList.remove("mdv-element-dragged"),e.sortEnded&&e.sortEnded(Array.from(i.children).slice(1))}function a(p){e.handle?p.target.classList.contains(e.handle)?r=!0:r=!1:r=!0}function l(p){if(!r)return p.preventDefault(),!1;t=this,this.classList.add("mdv-element-dragged"),p.dataTransfer.setDragImage(createEl("div",{}),0,0)}let u=createEl("div",{styles:{height:"5px"}});i.prepend(u),u.addEventListener("dragover",s);for(let p=0;p<i.children.length;p++){const d=i.children[p];d.draggable=!0,d.addEventListener("dragover",s),d.addEventListener("dragstart",l),d.addEventListener("dragend",o),d.addEventListener("mousedown",a)}}function makeResizable(i,e={}){if(i.__resizeinfo__)return;const t={resize:i.style.resize,overflow:i.style.overflow};i.style.overflow="hidden",e.onresizeend&&(t.onresize=addResizeListener(i,(l,u)=>{e.onresizeend(l,u)},e.onResizeStart)),createEl("div",{classes:["resizer-both"]},i).addEventListener("mousedown",s,!1);function s(l){t.startX=l.clientX,t.startY=l.clientY,t.startWidth=parseInt(document.defaultView.getComputedStyle(i).width,10),t.startHeight=parseInt(document.defaultView.getComputedStyle(i).height,10),document.documentElement.addEventListener("mousemove",o,!1),document.documentElement.addEventListener("mouseup",a,!1)}function o(l){i.style.width=t.startWidth+l.clientX-t.startX+"px",i.style.height=t.startHeight+l.clientY-t.startY+"px"}function a(l){document.documentElement.removeEventListener("mousemove",o,!1),document.documentElement.removeEventListener("mouseup",a,!1)}i.__resizeinfo__=t}function removeResizable(i){if(!i.__resizeinfo__)return;const e=i.__resizeinfo__;i.style.resize=e.resize,i.style.overflow=e.overflow,e.onresize&&i.removeEventListener("mouseup",e.onresize),delete i.__resizeinfo__}function removeDraggable(i){const e=i.__draginfo__;e&&(e.handle.style.cursor=e.cursor,i.style.position=e.position,e.handle.onmousedown=null,delete i.__draginfo__)}class MDVProgress{constructor(e,t){this.el=e,this.max=t.max||100,e.classList.add("mdv-progress-outer"),this.bar=createEl("div",{classes:["mdv-progress-inner"]},e),this.text=createEl("div",{classes:["mdv-progress-text"]},e),this.setText(t.text||""),this.setValue(t.value||0)}setText(e){this.text.textContent=e}setValue(e){this.bar.style.width=`${Math.round(e/this.max*100)}%`}}function makeDraggable(i,e={}){e.doc||(e.doc=document);let t=0,r=0,s=0,o=0,a=e.handle?i.querySelector(e.handle):i,l=null;e.contain&&(l={dir:e.contain}),a.onmousedown=u,i.__draginfo__={handle:a,cursor:a.style.cursor,position:i.style.position},a.style.cursor="move",i.style.position="absolute",i.style.margin="0px 0px 0px 0px",i.__doc__=e.doc;function u(m){m=m||window.event,m.preventDefault(),s=m.clientX,o=m.clientY,e.ondragstart&&e.ondragstart(i),l&&(l.p_bb=i.parentElement.getBoundingClientRect(),l.c_bb=i.getBoundingClientRect()),i.__doc__.onmouseup=d,i.__doc__.onmousemove=p}function p(m){m=m||window.event,m.preventDefault(),m.stopPropagation(),t=s-m.clientX,r=o-m.clientY,s=m.clientX,o=m.clientY;let g=i.offsetTop-r,w=i.offsetLeft-t;l&&(g<0||g+l.c_bb.height>l.p_bb.height&&l.dir!=="topleft"||w<0||w+l.c_bb.width>l.p_bb.width&&l.dir!=="topleft")||(e.y_axis||(i.style.top=g+"px"),i.style.left=w+"px")}function d(){e.ondragend&&e.ondragend(),i.__doc__.onmouseup=null,i.__doc__.onmousemove=null}}function addResizeListener(i,e,t){let r=i.getBoundingClientRect(),s=r.width,o=r.height;const a=l=>{let u=i.getBoundingClientRect();(u.width!==s||u.height!==o)&&e(u.width,u.height),s=u.width,o=u.height};return t&&i.addEventListener("mousedown",t),i.addEventListener("mouseup",a),a}function getElDim(i){var e=i.getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{top:e.top+r,left:e.left+t,height:e.height,width:e.width}}function getRandomString(i=6,e){i||(i=6),e=e&&e.toLowerCase();let t="",r=0,s=e=="a"?10:0,o=e=="n"?10:62;for(;r++<i;){let a=Math.random()*(o-s)+s<<0;t+=String.fromCharCode(a+=a>9?a<36?55:61:48)}return t}function debounce(i,e){let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>{i.apply(this,r)},e)}}class ContextMenu{constructor(e){this.setItemFunction=e,this.menus=[]}show(e,t){this.menus.length>0&&this.remove();const r=this.setItemFunction(t);this._addMenu(r,e.pageX,e.pageY),console.log(e.clientY),e.stopPropagation(),this.removeFunc=()=>{this.remove()},this._getDocument().body.addEventListener("click",this.removeFunc)}remove(){for(let e of this.menus)e.remove();this.menus=[],this.removeFunc&&this._getDocument().body.removeEventListener("click",this.removeFunc)}_addMenu(e,t,r){let s=document.createElement("div");const o=this._getDocument();let a=this.menus.length;s.classList.add("ciview-ctm-main");for(let u of e)this._addItem(s,u,a);o.body.append(s);const l=s.getBoundingClientRect();t+l.width>o.body.clientWidth&&(t=o.body.clientWidth-l.width-3),s.style.left=t+"px",s.style.top=r+"px",this.menus.push(s)}_getDocument(){return this.__doc__?this.__doc__:document}_showSubmenu(e,t,r){for(let o=r+1;o<this.menus.length;o++)this.menus[o].remove();this.menus=this.menus.slice(0,r+1);const s=e.getBoundingClientRect();this._addMenu(t,s.left+s.width+1,s.top)}_addItem(e,t,r){const s=document.createElement("div");if(s.classList.add("ciview-ctm-item"),t.ghosted?s.classList.add("ciview-ctm-ghosted"):s.classList.add("ciview-ctm-active"),t.icon){const a=document.createElement("i");for(let l of t.icon.split(" "))a.classList.add(l);a.classList.add("ciview-ctm-left-icon"),s.appendChild(a)}const o=document.createElement("span");if(o.appendChild(document.createTextNode(t.text)),s.append(o),t.subitems){const a=document.createElement("i");a.classList.add("fas","fa-caret-right","ciview-ctm-right-icon"),s.appendChild(a)}s.addEventListener("click",a=>{if(t.func&&!t.ghosted&&t.func(a),t.subitems){this._showSubmenu(s,t.subitems,r);for(let l of e.children)l.classList.remove("ciview-ctm-selected");s.classList.add("ciview-ctm-selected")}else this.remove();a.stopPropagation()}),e.append(s)}}class BaseDialog{constructor(e={},t){e.doc=e.doc||document,this.config=e,this.buttons={};const r=e.width?e.width+"px":"",s=e.height?e.height+"px":"";if(this.outer=createEl("div",{classes:["ciview-dlg-outer"],styles:{width:r,height:s}}),this.header=createEl("div",{classes:["ciview-dlg-header"]},this.outer),createEl("span",{classes:["ciview-dlg-header-text"],text:e.title},this.header),createEl("i",{classes:["fas","fa-times","ciview-dlg-close-icon"]},this.header).addEventListener("click",()=>{this.close()}),this.dialog=createEl("div",{classes:["ciview-dlg-content"]},this.outer),makeResizable(this.outer,{onresizeend:(u,p)=>{this.onResize(u,p)}}),makeDraggable(this.outer,{doc:e.doc,handle:".ciview-dlg-header"}),e.columns&&this._createColumns(e.columns),e.footer&&this._addFooter(),e.buttons){this.footer||this._addFooter();for(let u of e.buttons)this._addButton(u)}this.init(t),e.doc.body.append(this.outer);const o=e.doc.body.getBoundingClientRect(),a=this.outer.getBoundingClientRect();e.maxHeight&&a.height>e.maxHeight&&(a.height=e.maxHeight,this.outer.style.height=e.maxHeight+"px");let l=this.config.position;if(l||(l=[o.width/2-a.width/2,o.height/2-a.height/2]),l[0]+a.width>o.width){let u=o.width-a.width;l[0]=u<0?0:u}if(l[1]+a.height>o.height){let u=o.height-a.height;l[1]=u<0?0:u}this.outer.style.left=l[0]+"px",this.outer.style.top=l[1]+"px"}_addFooter(){this.footer=createEl("div",{styles:{flex:"0 0 auto",padding:"5px",justifyContent:"center",display:"flex",gap:"1em"}},this.outer)}_addButton(e){const t=createEl("button",{text:e.text,classes:["ciview-button"]},this.footer);t.addEventListener("click",()=>this[e.method]()),e.id&&(this.buttons[e.id]=t)}disableButton(e,t){t?this.buttons[e].classList.add("ciview-disabled"):this.buttons[e].classList.remove("ciview-disabled")}_createColumns(e){this.dialog.style.display="flex",this.dialog.style.flexDirection="row",this.columns=[];for(let t=0;t<e;t++)this.columns.push(createEl("div",{styles:{height:"100%",flexBasis:"0",flexGrow:"1",padding:"0px 4px",flexDirection:"column",alignItems:"stretch"}},this.dialog))}close(){this.config.onclose&&this.config.onclose(),this.outer.remove()}init(){}onResize(e,t){}}BaseDialog.experiment={};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var nouisliderExports={},nouislider={get exports(){return nouisliderExports},set exports(i){nouisliderExports=i}};(function(i,e){(function(t,r){r(e)})(commonjsGlobal,function(t){t.PipsMode=void 0,function(q){q.Range="range",q.Steps="steps",q.Positions="positions",q.Count="count",q.Values="values"}(t.PipsMode||(t.PipsMode={})),t.PipsType=void 0,function(q){q[q.None=-1]="None",q[q.NoValue=0]="NoValue",q[q.LargeValue=1]="LargeValue",q[q.SmallValue=2]="SmallValue"}(t.PipsType||(t.PipsType={}));function r(q){return s(q)&&typeof q.from=="function"}function s(q){return typeof q=="object"&&typeof q.to=="function"}function o(q){q.parentElement.removeChild(q)}function a(q){return q!=null}function l(q){q.preventDefault()}function u(q){return q.filter(function(L){return this[L]?!1:this[L]=!0},{})}function p(q,L){return Math.round(q/L)*L}function d(q,L){var Ve=q.getBoundingClientRect(),ht=q.ownerDocument,xt=ht.documentElement,ri=Q(ht);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(ri.x=0),L?Ve.top+ri.y-xt.clientTop:Ve.left+ri.x-xt.clientLeft}function m(q){return typeof q=="number"&&!isNaN(q)&&isFinite(q)}function g(q,L,Ve){Ve>0&&(k(q,L),setTimeout(function(){O(q,L)},Ve))}function w(q){return Math.max(Math.min(q,100),0)}function E(q){return Array.isArray(q)?q:[q]}function A(q){q=String(q);var L=q.split(".");return L.length>1?L[1].length:0}function k(q,L){q.classList&&!/\s/.test(L)?q.classList.add(L):q.className+=" "+L}function O(q,L){q.classList&&!/\s/.test(L)?q.classList.remove(L):q.className=q.className.replace(new RegExp("(^|\\b)"+L.split(" ").join("|")+"(\\b|$)","gi")," ")}function ne(q,L){return q.classList?q.classList.contains(L):new RegExp("\\b"+L+"\\b").test(q.className)}function Q(q){var L=window.pageXOffset!==void 0,Ve=(q.compatMode||"")==="CSS1Compat",ht=L?window.pageXOffset:Ve?q.documentElement.scrollLeft:q.body.scrollLeft,xt=L?window.pageYOffset:Ve?q.documentElement.scrollTop:q.body.scrollTop;return{x:ht,y:xt}}function ue(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function U(){var q=!1;try{var L=Object.defineProperty({},"passive",{get:function(){q=!0}});window.addEventListener("test",null,L)}catch{}return q}function _(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function Se(q,L){return 100/(L-q)}function Me(q,L,Ve){return L*100/(q[Ve+1]-q[Ve])}function Ke(q,L){return Me(q,q[0]<0?L+Math.abs(q[0]):L-q[0],0)}function kt(q,L){return L*(q[1]-q[0])/100+q[0]}function Qe(q,L){for(var Ve=1;q>=L[Ve];)Ve+=1;return Ve}function ze(q,L,Ve){if(Ve>=q.slice(-1)[0])return 100;var ht=Qe(Ve,q),xt=q[ht-1],ri=q[ht],si=L[ht-1],$i=L[ht];return si+Ke([xt,ri],Ve)/Se(si,$i)}function Je(q,L,Ve){if(Ve>=100)return q.slice(-1)[0];var ht=Qe(Ve,L),xt=q[ht-1],ri=q[ht],si=L[ht-1],$i=L[ht];return kt([xt,ri],(Ve-si)*Se(si,$i))}function St(q,L,Ve,ht){if(ht===100)return ht;var xt=Qe(ht,q),ri=q[xt-1],si=q[xt];return Ve?ht-ri>(si-ri)/2?si:ri:L[xt-1]?q[xt-1]+p(ht-q[xt-1],L[xt-1]):ht}var Te=function(){function q(L,Ve,ht){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[ht||!1],this.xNumSteps=[!1],this.snap=Ve;var xt,ri=[];for(Object.keys(L).forEach(function(si){ri.push([E(L[si]),si])}),ri.sort(function(si,$i){return si[0][0]-$i[0][0]}),xt=0;xt<ri.length;xt++)this.handleEntryPoint(ri[xt][1],ri[xt][0]);for(this.xNumSteps=this.xSteps.slice(0),xt=0;xt<this.xNumSteps.length;xt++)this.handleStepPoint(xt,this.xNumSteps[xt])}return q.prototype.getDistance=function(L){for(var Ve=[],ht=0;ht<this.xNumSteps.length-1;ht++)Ve[ht]=Me(this.xVal,L,ht);return Ve},q.prototype.getAbsoluteDistance=function(L,Ve,ht){var xt=0;if(L<this.xPct[this.xPct.length-1])for(;L>this.xPct[xt+1];)xt++;else L===this.xPct[this.xPct.length-1]&&(xt=this.xPct.length-2);!ht&&L===this.xPct[xt+1]&&xt++,Ve===null&&(Ve=[]);var ri,si=1,$i=Ve[xt],Jt=0,xi=0,Ai=0,Wi=0;for(ht?ri=(L-this.xPct[xt])/(this.xPct[xt+1]-this.xPct[xt]):ri=(this.xPct[xt+1]-L)/(this.xPct[xt+1]-this.xPct[xt]);$i>0;)Jt=this.xPct[xt+1+Wi]-this.xPct[xt+Wi],Ve[xt+Wi]*si+100-ri*100>100?(xi=Jt*ri,si=($i-100*ri)/Ve[xt+Wi],ri=1):(xi=Ve[xt+Wi]*Jt/100*si,si=0),ht?(Ai=Ai-xi,this.xPct.length+Wi>=1&&Wi--):(Ai=Ai+xi,this.xPct.length-Wi>=1&&Wi++),$i=Ve[xt+Wi]*si;return L+Ai},q.prototype.toStepping=function(L){return L=ze(this.xVal,this.xPct,L),L},q.prototype.fromStepping=function(L){return Je(this.xVal,this.xPct,L)},q.prototype.getStep=function(L){return L=St(this.xPct,this.xSteps,this.snap,L),L},q.prototype.getDefaultStep=function(L,Ve,ht){var xt=Qe(L,this.xPct);return(L===100||Ve&&L===this.xPct[xt-1])&&(xt=Math.max(xt-1,1)),(this.xVal[xt]-this.xVal[xt-1])/ht},q.prototype.getNearbySteps=function(L){var Ve=Qe(L,this.xPct);return{stepBefore:{startValue:this.xVal[Ve-2],step:this.xNumSteps[Ve-2],highestStep:this.xHighestCompleteStep[Ve-2]},thisStep:{startValue:this.xVal[Ve-1],step:this.xNumSteps[Ve-1],highestStep:this.xHighestCompleteStep[Ve-1]},stepAfter:{startValue:this.xVal[Ve],step:this.xNumSteps[Ve],highestStep:this.xHighestCompleteStep[Ve]}}},q.prototype.countStepDecimals=function(){var L=this.xNumSteps.map(A);return Math.max.apply(null,L)},q.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},q.prototype.convert=function(L){return this.getStep(this.toStepping(L))},q.prototype.handleEntryPoint=function(L,Ve){var ht;if(L==="min"?ht=0:L==="max"?ht=100:ht=parseFloat(L),!m(ht)||!m(Ve[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(ht),this.xVal.push(Ve[0]);var xt=Number(Ve[1]);ht?this.xSteps.push(isNaN(xt)?!1:xt):isNaN(xt)||(this.xSteps[0]=xt),this.xHighestCompleteStep.push(0)},q.prototype.handleStepPoint=function(L,Ve){if(Ve){if(this.xVal[L]===this.xVal[L+1]){this.xSteps[L]=this.xHighestCompleteStep[L]=this.xVal[L];return}this.xSteps[L]=Me([this.xVal[L],this.xVal[L+1]],Ve,0)/Se(this.xPct[L],this.xPct[L+1]);var ht=(this.xVal[L+1]-this.xVal[L])/this.xNumSteps[L],xt=Math.ceil(Number(ht.toFixed(3))-1),ri=this.xVal[L]+this.xNumSteps[L]*xt;this.xHighestCompleteStep[L]=ri}},q}(),dt={to:function(q){return q===void 0?"":q.toFixed(2)},from:Number},ot={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},yt={tooltips:".__tooltips",aria:".__aria"};function Ue(q,L){if(!m(L))throw new Error("noUiSlider: 'step' is not numeric.");q.singleStep=L}function Nt(q,L){if(!m(L))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");q.keyboardPageMultiplier=L}function Ot(q,L){if(!m(L))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");q.keyboardMultiplier=L}function wi(q,L){if(!m(L))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");q.keyboardDefaultStep=L}function Bi(q,L){if(typeof L!="object"||Array.isArray(L))throw new Error("noUiSlider: 'range' is not an object.");if(L.min===void 0||L.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");q.spectrum=new Te(L,q.snap||!1,q.singleStep)}function Ei(q,L){if(L=E(L),!Array.isArray(L)||!L.length)throw new Error("noUiSlider: 'start' option is incorrect.");q.handles=L.length,q.start=L}function Zi(q,L){if(typeof L!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");q.snap=L}function fr(q,L){if(typeof L!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");q.animate=L}function Ti(q,L){if(typeof L!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");q.animationDuration=L}function Lt(q,L){var Ve=[!1],ht;if(L==="lower"?L=[!0,!1]:L==="upper"&&(L=[!1,!0]),L===!0||L===!1){for(ht=1;ht<q.handles;ht++)Ve.push(L);Ve.push(!1)}else{if(!Array.isArray(L)||!L.length||L.length!==q.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");Ve=L}q.connect=Ve}function je(q,L){switch(L){case"horizontal":q.ort=0;break;case"vertical":q.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function mt(q,L){if(!m(L))throw new Error("noUiSlider: 'margin' option must be numeric.");L!==0&&(q.margin=q.spectrum.getDistance(L))}function Vt(q,L){if(!m(L))throw new Error("noUiSlider: 'limit' option must be numeric.");if(q.limit=q.spectrum.getDistance(L),!q.limit||q.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function Ut(q,L){var Ve;if(!m(L)&&!Array.isArray(L))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(L)&&!(L.length===2||m(L[0])||m(L[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(L!==0){for(Array.isArray(L)||(L=[L,L]),q.padding=[q.spectrum.getDistance(L[0]),q.spectrum.getDistance(L[1])],Ve=0;Ve<q.spectrum.xNumSteps.length-1;Ve++)if(q.padding[0][Ve]<0||q.padding[1][Ve]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var ht=L[0]+L[1],xt=q.spectrum.xVal[0],ri=q.spectrum.xVal[q.spectrum.xVal.length-1];if(ht/(ri-xt)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function ke(q,L){switch(L){case"ltr":q.dir=0;break;case"rtl":q.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function _t(q,L){if(typeof L!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var Ve=L.indexOf("tap")>=0,ht=L.indexOf("drag")>=0,xt=L.indexOf("fixed")>=0,ri=L.indexOf("snap")>=0,si=L.indexOf("hover")>=0,$i=L.indexOf("unconstrained")>=0,Jt=L.indexOf("drag-all")>=0,xi=L.indexOf("smooth-steps")>=0;if(xt){if(q.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");mt(q,q.start[1]-q.start[0])}if($i&&(q.margin||q.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");q.events={tap:Ve||ri,drag:ht,dragAll:Jt,smoothSteps:xi,fixed:xt,snap:ri,hover:si,unconstrained:$i}}function $t(q,L){if(L!==!1)if(L===!0||s(L)){q.tooltips=[];for(var Ve=0;Ve<q.handles;Ve++)q.tooltips.push(L)}else{if(L=E(L),L.length!==q.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");L.forEach(function(ht){if(typeof ht!="boolean"&&!s(ht))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),q.tooltips=L}}function at(q,L){if(L.length!==q.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");q.handleAttributes=L}function Xe(q,L){if(!s(L))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");q.ariaFormat=L}function It(q,L){if(!r(L))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");q.format=L}function _i(q,L){if(typeof L!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");q.keyboardSupport=L}function vi(q,L){q.documentElement=L}function Ri(q,L){if(typeof L!="string"&&L!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");q.cssPrefix=L}function sr(q,L){if(typeof L!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof q.cssPrefix=="string"?(q.cssClasses={},Object.keys(L).forEach(function(Ve){q.cssClasses[Ve]=q.cssPrefix+L[Ve]})):q.cssClasses=L}function P(q){var L={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:dt,format:dt},Ve={step:{r:!1,t:Ue},keyboardPageMultiplier:{r:!1,t:Nt},keyboardMultiplier:{r:!1,t:Ot},keyboardDefaultStep:{r:!1,t:wi},start:{r:!0,t:Ei},connect:{r:!0,t:Lt},direction:{r:!0,t:ke},snap:{r:!1,t:Zi},animate:{r:!1,t:fr},animationDuration:{r:!1,t:Ti},range:{r:!0,t:Bi},orientation:{r:!1,t:je},margin:{r:!1,t:mt},limit:{r:!1,t:Vt},padding:{r:!1,t:Ut},behaviour:{r:!0,t:_t},ariaFormat:{r:!1,t:Xe},format:{r:!1,t:It},tooltips:{r:!1,t:$t},keyboardSupport:{r:!0,t:_i},documentElement:{r:!1,t:vi},cssPrefix:{r:!0,t:Ri},cssClasses:{r:!0,t:sr},handleAttributes:{r:!1,t:at}},ht={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:ot,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};q.format&&!q.ariaFormat&&(q.ariaFormat=q.format),Object.keys(Ve).forEach(function(Jt){if(!a(q[Jt])&&ht[Jt]===void 0){if(Ve[Jt].r)throw new Error("noUiSlider: '"+Jt+"' is required.");return}Ve[Jt].t(L,a(q[Jt])?q[Jt]:ht[Jt])}),L.pips=q.pips;var xt=document.createElement("div"),ri=xt.style.msTransform!==void 0,si=xt.style.transform!==void 0;L.transformRule=si?"transform":ri?"msTransform":"webkitTransform";var $i=[["left","top"],["right","bottom"]];return L.style=$i[L.dir][L.ort],L}function ki(q,L,Ve){var ht=ue(),xt=_(),ri=xt&&U(),si=q,$i,Jt,xi,Ai,Wi,Ci=L.spectrum,rr=[],ji=[],Yi=[],Br=0,Nr={},dn=q.ownerDocument,hn=L.documentElement||dn.documentElement,or=dn.body,Qs=dn.dir==="rtl"||L.ort===1?0:100;function Hr(ee,de){var we=dn.createElement("div");return de&&k(we,de),ee.appendChild(we),we}function Zs(ee,de){var we=Hr(ee,L.cssClasses.origin),nt=Hr(we,L.cssClasses.handle);if(Hr(nt,L.cssClasses.touchArea),nt.setAttribute("data-handle",String(de)),L.keyboardSupport&&(nt.setAttribute("tabindex","0"),nt.addEventListener("keydown",function(Rt){return $s(Rt,de)})),L.handleAttributes!==void 0){var Ft=L.handleAttributes[de];Object.keys(Ft).forEach(function(Rt){nt.setAttribute(Rt,Ft[Rt])})}return nt.setAttribute("role","slider"),nt.setAttribute("aria-orientation",L.ort?"vertical":"horizontal"),de===0?k(nt,L.cssClasses.handleLower):de===L.handles-1&&k(nt,L.cssClasses.handleUpper),we}function Zn(ee,de){return de?Hr(ee,L.cssClasses.connect):!1}function Js(ee,de){var we=Hr(de,L.cssClasses.connects);Jt=[],xi=[],xi.push(Zn(we,ee[0]));for(var nt=0;nt<L.handles;nt++)Jt.push(Zs(de,nt)),Yi[nt]=nt,xi.push(Zn(we,ee[nt+1]))}function eo(ee){k(ee,L.cssClasses.target),L.dir===0?k(ee,L.cssClasses.ltr):k(ee,L.cssClasses.rtl),L.ort===0?k(ee,L.cssClasses.horizontal):k(ee,L.cssClasses.vertical);var de=getComputedStyle(ee).direction;return de==="rtl"?k(ee,L.cssClasses.textDirectionRtl):k(ee,L.cssClasses.textDirectionLtr),Hr(ee,L.cssClasses.base)}function Ts(ee,de){return!L.tooltips||!L.tooltips[de]?!1:Hr(ee.firstChild,L.cssClasses.tooltip)}function ks(){return si.hasAttribute("disabled")}function Gr(ee){var de=Jt[ee];return de.hasAttribute("disabled")}function Cn(){Wi&&(Sn("update"+yt.tooltips),Wi.forEach(function(ee){ee&&o(ee)}),Wi=null)}function Vi(){Cn(),Wi=Jt.map(Ts),qr("update"+yt.tooltips,function(ee,de,we){if(!(!Wi||!L.tooltips)&&Wi[de]!==!1){var nt=ee[de];L.tooltips[de]!==!0&&(nt=L.tooltips[de].to(we[de])),Wi[de].innerHTML=nt}})}function Jn(){Sn("update"+yt.aria),qr("update"+yt.aria,function(ee,de,we,nt,Ft){Yi.forEach(function(Rt){var li=Jt[Rt],Gt=pn(ji,Rt,0,!0,!0,!0),Ui=pn(ji,Rt,100,!0,!0,!0),zi=Ft[Rt],Ki=String(L.ariaFormat.to(we[Rt]));Gt=Ci.fromStepping(Gt).toFixed(1),Ui=Ci.fromStepping(Ui).toFixed(1),zi=Ci.fromStepping(zi).toFixed(1),li.children[0].setAttribute("aria-valuemin",Gt),li.children[0].setAttribute("aria-valuemax",Ui),li.children[0].setAttribute("aria-valuenow",zi),li.children[0].setAttribute("aria-valuetext",Ki)})})}function Fn(ee){if(ee.mode===t.PipsMode.Range||ee.mode===t.PipsMode.Steps)return Ci.xVal;if(ee.mode===t.PipsMode.Count){if(ee.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var de=ee.values-1,we=100/de,nt=[];de--;)nt[de]=de*we;return nt.push(100),es(nt,ee.stepped)}return ee.mode===t.PipsMode.Positions?es(ee.values,ee.stepped):ee.mode===t.PipsMode.Values?ee.stepped?ee.values.map(function(Ft){return Ci.fromStepping(Ci.getStep(Ci.toStepping(Ft)))}):ee.values:[]}function es(ee,de){return ee.map(function(we){return Ci.fromStepping(de?Ci.getStep(we):we)})}function to(ee){function de(zi,Ki){return Number((zi+Ki).toFixed(7))}var we=Fn(ee),nt={},Ft=Ci.xVal[0],Rt=Ci.xVal[Ci.xVal.length-1],li=!1,Gt=!1,Ui=0;return we=u(we.slice().sort(function(zi,Ki){return zi-Ki})),we[0]!==Ft&&(we.unshift(Ft),li=!0),we[we.length-1]!==Rt&&(we.push(Rt),Gt=!0),we.forEach(function(zi,Ki){var Qi,Fi,tr,qi=zi,ar=we[Ki+1],lr,an,gn,vn,us,fs,In,Qr=ee.mode===t.PipsMode.Steps;for(Qr&&(Qi=Ci.xNumSteps[Ki]),Qi||(Qi=ar-qi),ar===void 0&&(ar=qi),Qi=Math.max(Qi,1e-7),Fi=qi;Fi<=ar;Fi=de(Fi,Qi)){for(lr=Ci.toStepping(Fi),an=lr-Ui,us=an/(ee.density||1),fs=Math.round(us),In=an/fs,tr=1;tr<=fs;tr+=1)gn=Ui+tr*In,nt[gn.toFixed(5)]=[Ci.fromStepping(gn),0];vn=we.indexOf(Fi)>-1?t.PipsType.LargeValue:Qr?t.PipsType.SmallValue:t.PipsType.NoValue,!Ki&&li&&Fi!==ar&&(vn=0),Fi===ar&&Gt||(nt[lr.toFixed(5)]=[Fi,vn]),Ui=lr}}),nt}function Ds(ee,de,we){var nt,Ft,Rt=dn.createElement("div"),li=(nt={},nt[t.PipsType.None]="",nt[t.PipsType.NoValue]=L.cssClasses.valueNormal,nt[t.PipsType.LargeValue]=L.cssClasses.valueLarge,nt[t.PipsType.SmallValue]=L.cssClasses.valueSub,nt),Gt=(Ft={},Ft[t.PipsType.None]="",Ft[t.PipsType.NoValue]=L.cssClasses.markerNormal,Ft[t.PipsType.LargeValue]=L.cssClasses.markerLarge,Ft[t.PipsType.SmallValue]=L.cssClasses.markerSub,Ft),Ui=[L.cssClasses.valueHorizontal,L.cssClasses.valueVertical],zi=[L.cssClasses.markerHorizontal,L.cssClasses.markerVertical];k(Rt,L.cssClasses.pips),k(Rt,L.ort===0?L.cssClasses.pipsHorizontal:L.cssClasses.pipsVertical);function Ki(Fi,tr){var qi=tr===L.cssClasses.value,ar=qi?Ui:zi,lr=qi?li:Gt;return tr+" "+ar[L.ort]+" "+lr[Fi]}function Qi(Fi,tr,qi){if(qi=de?de(tr,qi):qi,qi!==t.PipsType.None){var ar=Hr(Rt,!1);ar.className=Ki(qi,L.cssClasses.marker),ar.style[L.style]=Fi+"%",qi>t.PipsType.NoValue&&(ar=Hr(Rt,!1),ar.className=Ki(qi,L.cssClasses.value),ar.setAttribute("data-value",String(tr)),ar.style[L.style]=Fi+"%",ar.innerHTML=String(we.to(tr)))}}return Object.keys(ee).forEach(function(Fi){Qi(Fi,ee[Fi][0],ee[Fi][1])}),Rt}function ts(){Ai&&(o(Ai),Ai=null)}function nn(ee){ts();var de=to(ee),we=ee.filter,nt=ee.format||{to:function(Ft){return String(Math.round(Ft))}};return Ai=si.appendChild(Ds(de,we,nt)),Ai}function is(){var ee=$i.getBoundingClientRect(),de="offset"+["Width","Height"][L.ort];return L.ort===0?ee.width||$i[de]:ee.height||$i[de]}function jr(ee,de,we,nt){var Ft=function(li){var Gt=Ls(li,nt.pageOffset,nt.target||de);if(!Gt||ks()&&!nt.doNotReject||ne(si,L.cssClasses.tap)&&!nt.doNotReject||ee===ht.start&&Gt.buttons!==void 0&&Gt.buttons>1||nt.hover&&Gt.buttons)return!1;ri||Gt.preventDefault(),Gt.calcPoint=Gt.points[L.ort],we(Gt,nt)},Rt=[];return ee.split(" ").forEach(function(li){de.addEventListener(li,Ft,ri?{passive:!0}:!1),Rt.push([li,Ft])}),Rt}function Ls(ee,de,we){var nt=ee.type.indexOf("touch")===0,Ft=ee.type.indexOf("mouse")===0,Rt=ee.type.indexOf("pointer")===0,li=0,Gt=0;if(ee.type.indexOf("MSPointer")===0&&(Rt=!0),ee.type==="mousedown"&&!ee.buttons&&!ee.touches)return!1;if(nt){var Ui=function(Qi){var Fi=Qi.target;return Fi===we||we.contains(Fi)||ee.composed&&ee.composedPath().shift()===we};if(ee.type==="touchstart"){var zi=Array.prototype.filter.call(ee.touches,Ui);if(zi.length>1)return!1;li=zi[0].pageX,Gt=zi[0].pageY}else{var Ki=Array.prototype.find.call(ee.changedTouches,Ui);if(!Ki)return!1;li=Ki.pageX,Gt=Ki.pageY}}return de=de||Q(dn),(Ft||Rt)&&(li=ee.clientX+de.x,Gt=ee.clientY+de.y),ee.pageOffset=de,ee.points=[li,Gt],ee.cursor=Ft||Rt,ee}function rs(ee){var de=ee-d($i,L.ort),we=de*100/is();return we=w(we),L.dir?100-we:we}function io(ee){var de=100,we=!1;return Jt.forEach(function(nt,Ft){if(!Gr(Ft)){var Rt=ji[Ft],li=Math.abs(Rt-ee),Gt=li===100&&de===100,Ui=li<de,zi=li<=de&&ee>Rt;(Ui||zi||Gt)&&(we=Ft,de=li)}}),we}function ns(ee,de){ee.type==="mouseout"&&ee.target.nodeName==="HTML"&&ee.relatedTarget===null&&ss(ee,de)}function ro(ee,de){if(navigator.appVersion.indexOf("MSIE 9")===-1&&ee.buttons===0&&de.buttonsProperty!==0)return ss(ee,de);var we=(L.dir?-1:1)*(ee.calcPoint-de.startCalcPoint),nt=we*100/de.baseSize;En(we>0,nt,de.locations,de.handleNumbers,de.connect)}function ss(ee,de){de.handle&&(O(de.handle,L.cssClasses.active),Br-=1),de.listeners.forEach(function(we){hn.removeEventListener(we[0],we[1])}),Br===0&&(O(si,L.cssClasses.drag),as(),ee.cursor&&(or.style.cursor="",or.removeEventListener("selectstart",l))),L.events.smoothSteps&&(de.handleNumbers.forEach(function(we){vr(we,ji[we],!0,!0,!1,!1)}),de.handleNumbers.forEach(function(we){er("update",we)})),de.handleNumbers.forEach(function(we){er("change",we),er("set",we),er("end",we)})}function Pn(ee,de){if(!de.handleNumbers.some(Gr)){var we;if(de.handleNumbers.length===1){var nt=Jt[de.handleNumbers[0]];we=nt.children[0],Br+=1,k(we,L.cssClasses.active)}ee.stopPropagation();var Ft=[],Rt=jr(ht.move,hn,ro,{target:ee.target,handle:we,connect:de.connect,listeners:Ft,startCalcPoint:ee.calcPoint,baseSize:is(),pageOffset:ee.pageOffset,handleNumbers:de.handleNumbers,buttonsProperty:ee.buttons,locations:ji.slice()}),li=jr(ht.end,hn,ss,{target:ee.target,handle:we,listeners:Ft,doNotReject:!0,handleNumbers:de.handleNumbers}),Gt=jr("mouseout",hn,ns,{target:ee.target,handle:we,listeners:Ft,doNotReject:!0,handleNumbers:de.handleNumbers});Ft.push.apply(Ft,Rt.concat(li,Gt)),ee.cursor&&(or.style.cursor=getComputedStyle(ee.target).cursor,Jt.length>1&&k(si,L.cssClasses.drag),or.addEventListener("selectstart",l,!1)),de.handleNumbers.forEach(function(Ui){er("start",Ui)})}}function Ms(ee){ee.stopPropagation();var de=rs(ee.calcPoint),we=io(de);we!==!1&&(L.events.snap||g(si,L.cssClasses.tap,L.animationDuration),vr(we,de,!0,!0),as(),er("slide",we,!0),er("update",we,!0),L.events.snap?Pn(ee,{handleNumbers:[we]}):(er("change",we,!0),er("set",we,!0)))}function os(ee){var de=rs(ee.calcPoint),we=Ci.getStep(de),nt=Ci.fromStepping(we);Object.keys(Nr).forEach(function(Ft){Ft.split(".")[0]==="hover"&&Nr[Ft].forEach(function(Rt){Rt.call(An,nt)})})}function $s(ee,de){if(ks()||Gr(de))return!1;var we=["Left","Right"],nt=["Down","Up"],Ft=["PageDown","PageUp"],Rt=["Home","End"];L.dir&&!L.ort?we.reverse():L.ort&&!L.dir&&(nt.reverse(),Ft.reverse());var li=ee.key.replace("Arrow",""),Gt=li===Ft[0],Ui=li===Ft[1],zi=li===nt[0]||li===we[0]||Gt,Ki=li===nt[1]||li===we[1]||Ui,Qi=li===Rt[0],Fi=li===Rt[1];if(!zi&&!Ki&&!Qi&&!Fi)return!0;ee.preventDefault();var tr;if(Ki||zi){var qi=zi?0:1,ar=Ps(de),lr=ar[qi];if(lr===null)return!1;lr===!1&&(lr=Ci.getDefaultStep(ji[de],zi,L.keyboardDefaultStep)),Ui||Gt?lr*=L.keyboardPageMultiplier:lr*=L.keyboardMultiplier,lr=Math.max(lr,1e-7),lr=(zi?-1:1)*lr,tr=rr[de]+lr}else Fi?tr=L.spectrum.xVal[L.spectrum.xVal.length-1]:tr=L.spectrum.xVal[0];return vr(de,Ci.toStepping(tr),!0,!0),er("slide",de),er("update",de),er("change",de),er("set",de),!1}function Rr(ee){ee.fixed||Jt.forEach(function(de,we){jr(ht.start,de.children[0],Pn,{handleNumbers:[we]})}),ee.tap&&jr(ht.start,$i,Ms,{}),ee.hover&&jr(ht.move,$i,os,{hover:!0}),ee.drag&&xi.forEach(function(de,we){if(!(de===!1||we===0||we===xi.length-1)){var nt=Jt[we-1],Ft=Jt[we],Rt=[de],li=[nt,Ft],Gt=[we-1,we];k(de,L.cssClasses.draggable),ee.fixed&&(Rt.push(nt.children[0]),Rt.push(Ft.children[0])),ee.dragAll&&(li=Jt,Gt=Yi),Rt.forEach(function(Ui){jr(ht.start,Ui,Pn,{handles:li,handleNumbers:Gt,connect:de})})}})}function qr(ee,de){Nr[ee]=Nr[ee]||[],Nr[ee].push(de),ee.split(".")[0]==="update"&&Jt.forEach(function(we,nt){er("update",nt)})}function Nn(ee){return ee===yt.aria||ee===yt.tooltips}function Sn(ee){var de=ee&&ee.split(".")[0],we=de?ee.substring(de.length):ee;Object.keys(Nr).forEach(function(nt){var Ft=nt.split(".")[0],Rt=nt.substring(Ft.length);(!de||de===Ft)&&(!we||we===Rt)&&(!Nn(Rt)||we===Rt)&&delete Nr[nt]})}function er(ee,de,we){Object.keys(Nr).forEach(function(nt){var Ft=nt.split(".")[0];ee===Ft&&Nr[nt].forEach(function(Rt){Rt.call(An,rr.map(L.format.to),de,rr.slice(),we||!1,ji.slice(),An)})})}function pn(ee,de,we,nt,Ft,Rt,li){var Gt;return Jt.length>1&&!L.events.unconstrained&&(nt&&de>0&&(Gt=Ci.getAbsoluteDistance(ee[de-1],L.margin,!1),we=Math.max(we,Gt)),Ft&&de<Jt.length-1&&(Gt=Ci.getAbsoluteDistance(ee[de+1],L.margin,!0),we=Math.min(we,Gt))),Jt.length>1&&L.limit&&(nt&&de>0&&(Gt=Ci.getAbsoluteDistance(ee[de-1],L.limit,!1),we=Math.min(we,Gt)),Ft&&de<Jt.length-1&&(Gt=Ci.getAbsoluteDistance(ee[de+1],L.limit,!0),we=Math.max(we,Gt))),L.padding&&(de===0&&(Gt=Ci.getAbsoluteDistance(0,L.padding[0],!1),we=Math.max(we,Gt)),de===Jt.length-1&&(Gt=Ci.getAbsoluteDistance(100,L.padding[1],!0),we=Math.min(we,Gt))),li||(we=Ci.getStep(we)),we=w(we),we===ee[de]&&!Rt?!1:we}function zn(ee,de){var we=L.ort;return(we?de:ee)+", "+(we?ee:de)}function En(ee,de,we,nt,Ft){var Rt=we.slice(),li=nt[0],Gt=L.events.smoothSteps,Ui=[!ee,ee],zi=[ee,!ee];nt=nt.slice(),ee&&nt.reverse(),nt.length>1?nt.forEach(function(Qi,Fi){var tr=pn(Rt,Qi,Rt[Qi]+de,Ui[Fi],zi[Fi],!1,Gt);tr===!1?de=0:(de=tr-Rt[Qi],Rt[Qi]=tr)}):Ui=zi=[!0];var Ki=!1;nt.forEach(function(Qi,Fi){Ki=vr(Qi,we[Qi]+de,Ui[Fi],zi[Fi],!1,Gt)||Ki}),Ki&&(nt.forEach(function(Qi){er("update",Qi),er("slide",Qi)}),Ft!=null&&er("drag",li))}function mn(ee,de){return L.dir?100-ee-de:ee}function Fs(ee,de){ji[ee]=de,rr[ee]=Ci.fromStepping(de);var we=mn(de,0)-Qs,nt="translate("+zn(we+"%","0")+")";Jt[ee].style[L.transformRule]=nt,sn(ee),sn(ee+1)}function as(){Yi.forEach(function(ee){var de=ji[ee]>50?-1:1,we=3+(Jt.length+de*ee);Jt[ee].style.zIndex=String(we)})}function vr(ee,de,we,nt,Ft,Rt){return Ft||(de=pn(ji,ee,de,we,nt,!1,Rt)),de===!1?!1:(Fs(ee,de),!0)}function sn(ee){if(xi[ee]){var de=0,we=100;ee!==0&&(de=ji[ee-1]),ee!==xi.length-1&&(we=ji[ee]);var nt=we-de,Ft="translate("+zn(mn(de,nt)+"%","0")+")",Rt="scale("+zn(nt/100,"1")+")";xi[ee].style[L.transformRule]=Ft+" "+Rt}}function Xr(ee,de){return ee===null||ee===!1||ee===void 0||(typeof ee=="number"&&(ee=String(ee)),ee=L.format.from(ee),ee!==!1&&(ee=Ci.toStepping(ee)),ee===!1||isNaN(ee))?ji[de]:ee}function Rn(ee,de,we){var nt=E(ee),Ft=ji[0]===void 0;de=de===void 0?!0:de,L.animate&&!Ft&&g(si,L.cssClasses.tap,L.animationDuration),Yi.forEach(function(Gt){vr(Gt,Xr(nt[Gt],Gt),!0,!1,we)});var Rt=Yi.length===1?0:1;if(Ft&&Ci.hasNoSize()&&(we=!0,ji[0]=0,Yi.length>1)){var li=100/(Yi.length-1);Yi.forEach(function(Gt){ji[Gt]=Gt*li})}for(;Rt<Yi.length;++Rt)Yi.forEach(function(Gt){vr(Gt,ji[Gt],!0,!0,we)});as(),Yi.forEach(function(Gt){er("update",Gt),nt[Gt]!==null&&de&&er("set",Gt)})}function ls(ee){Rn(L.start,ee)}function on(ee,de,we,nt){if(ee=Number(ee),!(ee>=0&&ee<Yi.length))throw new Error("noUiSlider: invalid handle number, got: "+ee);vr(ee,Xr(de,ee),!0,!0,nt),er("update",ee),we&&er("set",ee)}function Yr(ee){if(ee===void 0&&(ee=!1),ee)return rr.length===1?rr[0]:rr.slice(0);var de=rr.map(L.format.to);return de.length===1?de[0]:de}function cs(){for(Sn(yt.aria),Sn(yt.tooltips),Object.keys(L.cssClasses).forEach(function(ee){O(si,L.cssClasses[ee])});si.firstChild;)si.removeChild(si.firstChild);delete si.noUiSlider}function Ps(ee){var de=ji[ee],we=Ci.getNearbySteps(de),nt=rr[ee],Ft=we.thisStep.step,Rt=null;if(L.snap)return[nt-we.stepBefore.startValue||null,we.stepAfter.startValue-nt||null];Ft!==!1&&nt+Ft>we.stepAfter.startValue&&(Ft=we.stepAfter.startValue-nt),nt>we.thisStep.startValue?Rt=we.thisStep.step:we.stepBefore.step===!1?Rt=!1:Rt=nt-we.stepBefore.highestStep,de===100?Ft=null:de===0&&(Rt=null);var li=Ci.countStepDecimals();return Ft!==null&&Ft!==!1&&(Ft=Number(Ft.toFixed(li))),Rt!==null&&Rt!==!1&&(Rt=Number(Rt.toFixed(li))),[Rt,Ft]}function $r(){return Yi.map(Ps)}function Ar(ee,de){var we=Yr(),nt=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips"];nt.forEach(function(Rt){ee[Rt]!==void 0&&(Ve[Rt]=ee[Rt])});var Ft=P(Ve);nt.forEach(function(Rt){ee[Rt]!==void 0&&(L[Rt]=Ft[Rt])}),Ci=Ft.spectrum,L.margin=Ft.margin,L.limit=Ft.limit,L.padding=Ft.padding,L.pips?nn(L.pips):ts(),L.tooltips?Vi():Cn(),ji=[],Rn(a(ee.start)?ee.start:we,de)}function Kr(){$i=eo(si),Js(L.connect,$i),Rr(L.events),Rn(L.start),L.pips&&nn(L.pips),L.tooltips&&Vi(),Jn()}Kr();var An={destroy:cs,steps:$r,on:qr,off:Sn,get:Yr,set:Rn,setHandle:on,reset:ls,__moveHandles:function(ee,de,we){En(ee,de,ji,we)},options:Ve,updateOptions:Ar,target:si,removePips:ts,removeTooltips:Cn,getPositions:function(){return ji.slice()},getTooltips:function(){return Wi},getOrigins:function(){return Jt},pips:nn};return An}function Ni(q,L){if(!q||!q.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+q);if(q.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var Ve=P(L),ht=ki(q,Ve,L);return q.noUiSlider=ht,ht}var Gi={__spectrum:Te,cssClasses:ot,create:Ni};t.create=Ni,t.cssClasses=ot,t.default=Gi,Object.defineProperty(t,"__esModule",{value:!0})})})(nouislider,nouisliderExports);const noUiSlider=getDefaultExportFromCjs(nouisliderExports);class SettingsDialog extends BaseDialog{constructor(e,t){super(e,t)}init(e){this.controls=[];for(let t of e){let r=createEl("div",{styles:{}},this.dialog);if(t.type!=="button"&&createEl("label",{text:t.label},r),t.info&&this.addInfoIcon(t.info,r),!this[t.type]){console.warn(`SettingsDialog doesn't have a method '${t.type}'`);continue}this.controls[t.label]=this[t.type](t,r)}}initLilGui(e){const t=new lgui({container:this.dialog});for(let r of e)switch(r.type){case"dropdown":t.add(r,"current_value",r.values[0].map(s=>s[r.values[1]])).name(r.label).onChange(r.func);break;case"check":r.current_value===void 0&&(r.current_value=!1),t.add(r,"current_value").name(r.label).onChange(r.func);break;case"button":t.add(r,"func").name(r.label);break;case"slider":t.add(r,"current_value",r.min,r.max).name(r.label).onChange(r.func);break;case"spinner":t.add(r,"current_value",r.min,r.max).name(r.label).onChange(r.func);break;case"radiobuttons":t.add(r,"current_value",r.choices).name(r.label).onChange(r.func);break;case"text":case"textbox":default:t.add(r,"current_value").name(r.label).onChange(r.func)}}folder(e,t){}spinner(e,t){let r=createEl("input",{type:"number",value:e.current_value,max:e.max||null,min:e.min||0,step:e.step||1},t);r.addEventListener("change",s=>{e.func(parseInt(r.value))})}radiobuttons(e,t){const r=createEl("div",{classes:["ciview-radio-group"]},t);for(let s of e.choices){createEl("span",{text:s[0]},r);const o=createEl("input",{type:"radio",name:e.label,value:s[1]},r);o.checked=e.current_value===s[1],o.addEventListener("click",a=>{e.func(a.currentTarget.value)})}}button(e,t){t.style.textAlign="center",createEl("button",{classes:["ciview-button"],text:e.label},t).addEventListener("click",r=>{e.func()})}slider(e,t){const r=createEl("div",{},t);noUiSlider.create(r,{start:[e.current_value||0],range:{min:[e.min||0],max:[e.max||1]},step:e.step||null,tooltips:!0,documentElement:e.doc||this.config.doc});const s=o=>{e.func(parseFloat(o[0]))};return r.noUiSlider.on("end",s),e.continuous&&(console.log("adding update listener for ",e.label),r.noUiSlider.on("update",s)),r}check(e,t){const r=createEl("input",{type:"checkbox"},t);r.checked=e.current_value,r.addEventListener("click",s=>{e.func(r.checked)})}multidropdown(e,t){const r=createEl("select",{multiple:!0,styles:{maxWidth:"200px",height:"100px"}});createEl("br",{},t);for(let o of e.values[0]){const a=o[e.values[2]],l={text:o[e.values[1]],value:a};e.current_value.indexOf(a)!==-1&&(l.selected=!0),createEl("option",l,r)}return t.append(r),createEl("br",{},t),createEl("button",{classes:["ciview-button-sm"],text:"Change"},t).addEventListener("click",o=>{e.func(Array.from(r.selectedOptions).map(a=>a.value))}),r}dropdown(e,t){const r=createEl("select",{styles:{maxWidth:"200px"}});for(let s of e.values[0])createEl("option",{text:s[e.values[1]],value:s[e.values[2]]},r);return t.append(r),r.value=e.current_value,r.addEventListener("change",s=>{e.func(r.value),r.title=r.value,e.onchange&&e.onchange(this.controls,r.value)}),r}doubleslider(e,t){const r=createEl("div",{styles:{}},t);noUiSlider.create(r,{tooltips:!0,start:[e.current_value[0],e.current_value[1]],range:{min:[e.min],max:[e.max]},documentElement:e.doc});const s=o=>{e.func(parseFloat(o[0]),parseFloat(o[1]))};return r.noUiSlider.on("end",s),e.continuous&&r.noUiSlider.on("update",s),r}text(e,t){const r=createEl("input",{value:e.current_value,size:10,styles:{flex:1}},t);r.addEventListener("keyup",s=>{if(e.only_update_on_enter){s.key==="Enter"&&e.func(r.value);return}e.func(r.value)})}textbox(e,t){const r=createEl("textarea",{styles:{width:"100%"}},t);r.value=e.current_value,r.addEventListener("input",s=>{e.func(r.value)}),r.addEventListener("blur",s=>{e.func(r.value)})}addInfoIcon(e,t){const r=createEl("span",{"aria-label":e.text,role:"tooltip","data-microtip-size":"medium","data-microtip-position":e.position,styles:{marginLeft:"5px"},classes:["ttt"]},t);return createEl("i",{classes:["fas","fa-info"]},r),r}}class BaseChart{constructor(e,t,r){As(this,"getQunatile");r.color_by&&r.color_by.column&&(r.color_by=r.color_by.column.field),this.config=JSON.parse(JSON.stringify(r)),this.config.id||(this.config.id=getRandomString()),this.__doc__=document,this.dataStore=e,this.listeners={},this.div=typeof t=="string"?document.getElementById(t):t,this.div.classList.add("ciview-chart-panel"),this.titleBar=createEl("div",{classes:["ciview-chart-titlebar"]}),this.title=createEl("div",{classes:["ciview-chart-title"],text:r.title},this.titleBar),this.menuSpace=createEl("div",{classes:["ciview-chart-menuspace"]},this.titleBar),this.contentDiv=createEl("div",{classes:["ciview-chart-content"]}),r.title_color&&(this.titleBar.style.backgroundColor=r.title_color),this.resetButton=this.addMenuIcon("fas fa-sync","remove filter"),this.resetButton.style.display="none",this.resetButton.addEventListener("click",()=>{this.removeFilter(),this.resetButton.style.display="none"}),this.dataStore.addListener(this.config.id,(s,o)=>{s==="filtered"?this.onDataFiltered(o):s==="data_changed"?this.onDataChanged(o):s==="data_added"?this.onDataAdded(o):s==="data_highlighted"&&this.onDataHighlighted&&this.onDataHighlighted(o)}),this.contextMenu=new ContextMenu(s=>this.getContextMenu(s)),this.addMenuIcon("fas fa-bars","more").addEventListener("click",s=>this.contextMenu.show(s)),this.addMenuIcon("fas fa-cog","settings").addEventListener("click",s=>this._openSettingsDialog(s)),this.legendIcon=this.addMenuIcon("fas fa-info",r.legend||"No description",{size:"medium"}),this.div.append(this.titleBar),this.div.append(this.contentDiv),this.listeners={},this._setDimensions()}_getContentDimensions(){return{top:5,left:5,height:this.height,width:this.width-5}}getFilter(){}setFilter(){}addListener(e,t){this.listeners[e]=t}removeListener(e){delete this.listeners[e]}_callListeners(e,t){for(let r in this.listeners)this.listeners[r](e,t)}addMenuIcon(e,t,r={}){const s=createEl("span",{"aria-label":t,"data-microtip-color":"red",role:"tooltip","data-microtip-size":r.size||"small","data-microtip-position":r.position||"bottom-left",styles:{margin:"0px 1px"}},this.menuSpace);return createEl("i",{classes:["ciview-chart-icon"].concat(e.split(" "))},s),r.func&&s.addEventListener("click",o=>r.func(o)),s}removeFilter(){}onDataFiltered(e){}onDataChanged(e){const t=e.columns;if(!e.hasFiltered){let r=this.config.param,s=!1;typeof this.config.param=="string"&&(r=[this.config.param]);for(let o of r)if(t.indexOf(o)!==-1){s=!0;break}s&&this.onDataFiltered()}t.indexOf(this.config.color_by)!==-1&&this.colorByColumn(this.config.color_by)}getColorLegend(){const e={overideValues:{colorLogScale:this.config.log_color_scale}};return this._addTrimmedColor(this.config.color_by,e),this.dataStore.getColorLegend(this.config.color_by,e)}_addTrimmedColor(e,t){const r=this.config.trim_color_scale,s=this.dataStore.columnIndex[e];r&&r!=="none"&&s.quantiles&&s.quantiles!=="NA"&&(t.overideValues.min=s.quantiles[r][0],t.overideValues.max=s.quantiles[r][1])}setColorLegend(){if(!this.config.color_legend.display){this.legend&&(this.config.color_legend.pos=[this.legend.offsetLeft,this.legend.offsetTop],this.legend.remove(),delete this.legend);return}const e=this._getContentDimensions();let t=0,r=0;if(this.legend)r=this.legend.style.left,t=this.legend.style.top,this.legend.remove();else{const s=this.config.color_legend;s.pos||(s.pos=[e.left,e.top]),r=s.pos[0]+"px",t=s.pos[1]+"px"}if(this.legend=this.getColorLegend(),!this.legend){console.warn("no color legend");return}this.contentDiv.append(this.legend),this.legend.style.left=r,this.legend.style.top=t,this.legend.__doc__=this.__doc__}getColorFunction(e,t){this.config.color_by=e;const r={asArray:t,overideValues:{colorLogScale:this.config.log_color_scale}};this._addTrimmedColor(e,r);const s=this.dataStore.getColorFunction(e,r);return this.config.color_legend||(this.config.color_legend={display:!0}),this.setColorLegend(),s}onColumnRemoved(e){let t=this.config.param,r=!1;typeof this.config.param=="string"&&(t=[this.config.param]);for(let s of t)if(e===s){r=!0;break}return r?(this.remove(!1),!0):(this.colorByColumn&&this.config.color_by===e&&(delete this.config.color_by,this.colorByDefault()),!1)}onDataAdded(e){this.onDataFiltered()}addToolTip(){this._tooltip=createEl("div",{classes:["ciview-tooltip"],stlyles:{display:"none",position:"absolute"}},this.__doc__.body)}showToolTip(e,t){this._tooltip.innerHTML=t,this._tooltip.style.display="inline-block",this._tooltip.style.left=3+e.clientX+"px",this._tooltip.style.top=3+e.clientY+"px"}hideToolTip(){this._tooltip.style.display="none"}remove(){this.titleBar.remove(),this.contentDiv.remove(),this.dataStore.removeListener(this.config.id),this._tooltip&&this._tooltip.remove()}getSettings(){const e=this.config;let t=[{type:"text",label:"Chart Name",current_value:e.title,func:s=>{this.setTitle(s)}}];const r=this.getColorOptions();if(r.colorby){const s=r.colorby==="all"?["int32","text","integer","double"]:r.colorby,o=this.dataStore.getColumnList(s);o.push({name:"None",field:"_none"}),t.push({label:"Color By",type:"dropdown",values:[o,"name","field"],current_value:e.color_by||"_none",func:a=>{a==="_none"?(delete e.color_by,this.colorByDefault()):(e.color_by=a,this.colorByColumn(a))}}),r.color_overlay!==void 0&&t.push({label:"Color Overlay",type:"slider",current_value:e.color_overlay,func:a=>{e.color_overlay=a,this.colorByColumn(e.color_by)}}),t.push({label:"Show Color Legend",type:"check",current_value:e.color_legend?e.color_legend.display:!0,func:a=>{e.color_by&&(e.color_legend.display=a,this.setColorLegend())}}),t.push({label:"SymLog Color Scale",type:"check",current_value:e.log_color_scale,func:a=>{e.log_color_scale=a,e.color_by&&this.colorByColumn(e.color_by)}}),t.push({type:"radiobuttons",label:"Trim Color Scale to Percentile",current_value:e.trim_color_scale||"none",choices:[["No Trim","none"],["0.001","0.001"],["0.01","0.01"],["0.05","0.05"]],func:a=>{e.trim_color_scale=a,e.color_by&&this.colorByColumn(e.color_by)}})}return t}_addUnpinIcon(){this.unpinIcon=this.addMenuIcon("fas fa-thumbtack","unpin chart"),this.unpinIcon.addEventListener("click",e=>{this.unpinIcon.remove(),this.unpinChart()})}_openSettingsDialog(e){this.settingsDialog||(this.settingsDialog=new SettingsDialog({maxHeight:400,doc:this.__doc__||document,width:300,title:"Settings",position:[e.pageX,e.pageY],onclose:()=>this.settingsDialog=null},this.getSettings()))}getContextMenu(e){let t=[];return this.getImage&&(t=t.concat([{text:"create svg image",icon:"far fa-image",func:()=>this.downloadImage("svg")},{text:"create png image",icon:"far fa-image",func:()=>this.downloadImage("png")}])),this.pinChart&&!this.isPinned&&t.push({text:"pin chart",icon:"fas fa-thumbtack",func:()=>{this.pinChart(),this._addUnpinIcon()}}),this.addToContextMenu&&(t=t.concat(this.addToContextMenu())),t}getDiv(){return this.div}changeBaseDocument(e){this.contextMenu.__doc__=e,this.__doc__=e,this.settingsDialog&&this.settingsDialog.close(),this.legend&&(this.legend.__doc__=e),this._tooltip&&(this._tooltip.remove(),this.addToolTip())}_setConfigValue(e,t,r){return e[t]===void 0&&(e[t]=r),e[t]}drawChart(){}getConfig(){return this.legend&&(this.config.color_legend={display:!0,pos:[this.legend.offsetLeft,this.legend.offsetTop]}),JSON.parse(JSON.stringify(this.config))}getColorOptions(){return{}}setSize(e,t){e&&(this.div.style.height=t+"px",this.div.style.width=e+"px"),this._setDimensions()}_setDimensions(){const e=this.div.getBoundingClientRect(),t=Math.round(e.height),r=Math.round(e.width);this.config.size=[r,t];const s=this.contentDiv.getBoundingClientRect();this.height=Math.round(s.height),this.width=r}downloadImage(e){const t=this.contentDiv.style.color;this.contentDiv.style.color="black",this.getImage(r=>{let s=document.createElement("a"),o=this.config.title||"image";if(s.download=o+"."+e,e==="svg")s.href="data:image/svg+xml,"+encodeURIComponent(r);else{let a=r.toDataURL("image/png");a=a.replace(/^data:image\/png/,"data:application/octet-stream"),s.href=a}s.click(),s.remove(),this.contentDiv.style.color=t},e)}setTitle(e){this.title.textContent=e,this.config.title=e}getImageFromSVG(e,t){var r=e.cloneNode(!0);copyStylesInline(r,e);var s=document.createElement("canvas");r.style.top="0px",s.width=e.width.baseVal.value,s.height=e.height.baseVal.value;var o=s.getContext("2d");o.clearRect(0,0,s.width,s.height);var a=new XMLSerializer().serializeToString(r),l=window.URL||window.webkitURL||window,u=new Image,p=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),d=l.createObjectURL(p);u.src=d,u.onload=function(){o.drawImage(u,0,0),t(s,o)}}}BaseChart.types={};function copyStylesInline(i,e){for(var t=["svg","g"],r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];if(t.indexOf(s.tagName)!=-1){copyStylesInline(s,e.childNodes[r]);continue}var o=e.childNodes[r].currentStyle||window.getComputedStyle(e.childNodes[r]);if(!(o=="undefined"||o==null))for(var a=0;a<o.length;a++)s.style.setProperty(o[a],o.getPropertyValue(o[a]))}}class PopOutWindow{constructor(e,t,r={}){let s=this;const o=document.documentElement.className;let a=URL.createObjectURL(new Blob([],{type:"text/html"}));a=r.url||a;const l=r;this.window=window.open(a,"win"+new Date().getTime(),`width=${l.width||800},
            height=${l.height||400},
            screenX=${l.screenX||200},
            screenY=${l.screenY||200}
            ;modal=yes`),this.window.addEventListener("load",function(){let u=s.window.document;u.documentElement.className=o,this.setTimeout(()=>{u.documentElement.className=o},1e3),u.write("<head>");let p=document.head.innerHTML;if(u.write(p),l.stylesheets)for(let m of l.stylesheets)u.write(`<link rel="stylesheet" type="text/css" href="${m}">`);u.write("</head>"),u.write("<body><body>"),l.title&&(u.title=l.title),e&&e(u,s.getDimensions()),s.onclose=t,s.window.addEventListener("beforeunload",function(m){s.closing(u)}),l.stayInFront&&(s.focusListener=()=>{s.window.focus()},document.body.addEventListener("mousedown",s.focusListener));const d=l.onresize;d&&s.window.addEventListener("resize",function(m){clearTimeout(s.resizeTO),s.resizeTO=setTimeout(()=>{d(u,s.getDimensions())},200)})})}getDimensions(){const e=this.window;return{width:e.innerWidth-10,height:e.innerHeight-10}}closing(e){this.onclose&&this.onclose(e),this.focusListener&&document.body.removeEventListener("mousedown",this.focusListener)}close(){this.window.close()}}class Dimension{constructor(e){this.filterBuffer=new SharedArrayBuffer(e.size),this.parent=e,this.filterArray=new Uint8Array(this.filterBuffer),this.filterArguments=null,this.filterIndexes=null,this.filterMethod=null}removeFilter(e=!0){if(!this.filterMethod)return;const t=this.parent.filterArray,r=this.filterArray,s=this.parent,o=this.parent.size;delete this.filterArguments,delete this.filterColumns,delete this.filterMethod;for(let a=0;a<o;a++)r[a]===1&&(--t[a]==0&&s.filterSize++,r[a]=0);if(this.bgfArray)for(let a=0;a<o;a++)this.bgfArray[a]===0&&(--t[a]===0&&s.filterSize++,r[a]=2);e&&this.parent._callListeners("filtered",this)}getLocalFilter(){return this.filterArray}filterOnIndex(e){const t=this.parent.filterArray,r=this.parent.size,s=this.filterArray,o=this.parent;for(let a=0;a<r;a++)e.has(a)?(s[a]===1&&--t[a]===0&&o.filterSize++,s[a]=0):(s[a]===0&&++t[a]===1&&o.filterSize--,s[a]=1)}filter(e,t,r,s=!0){const o=performance.now();if(this.filterColumns=t,this.filterArguments=r,this.filterMethod=e,this[e](r,t),this.bgfArray){const a=this.parent.filterArray,l=this.parent.size,u=this.filterArray,p=this.parent;for(let d=0;d<l;d++)this.bgfArray[d]===0&&(++a[d]===1&&p.filterSize--,u[d]=2)}s&&this.parent._callListeners("filtered",this),console.log(`method${e}: ${performance.now()-o}`)}reFilterOnDataChanged(e){if(this.filterMethod&&this.filterColumns){for(let t of this.filterColumns)if(typeof t=="string"&&e.indexOf(t)!==-1)return this.filter(this.filterMethod,this.filterColumns,this.filterArguments,!1),!0}return!1}updateSize(){let e=new SharedArrayBuffer(this.parent.size),t=new Uint8Array(e);t.set(this.filterArray),this.filterBuffer=e,this.filterArray=t,this.bgfArray&&(this.bgfData,this.setBackgroundFilter(b.column.b.cat)),this.filterMethod&&this.filter(this.filterMethod,this.filterColumns,this.filterArguments,!1)}setBackgroundFilter(e,t){const r=this.parent.columnIndex[e],s=r.values.indexOf(t),o=r.data;this.bgfData={column:e,cat:t},this.bgfArray=new Uint8Array(this.parent.size);for(let a=0;a<this.parent.size;a++)o[a]===s?this.bgfArray[a]=1:this.filterArray[a]=2}clearBackGroundFilter(){this.bgfArray=null,this.bgfData=null}destroy(e=!0){this.removeFilter(e),this.filterBuffer=null,this.localFilter=null,this.parent.dimensions.splice(this.parent.dimensions.indexOf(this),1)}}Dimension.types={base_dimension:Dimension};class CategoryDimension extends Dimension{constructor(e){super(e),this.worker=new Worker(new URL(""+new URL("catWorker-68e8ef4d.js",import.meta.url).href,self.location))}filterCategories(e,t){const r=e,s=this.parent,o=s.columnIndex[t[0]],a=o.data,l=s.filterArray,u=this.filterArray,p=o.values,d=new Set,m=this.parent.size;if(typeof r=="string"){const g=p.indexOf(r);if(o.datatype==="multitext"){const w=o.stringLength;for(let E=0;E<m;E++){const A=E*w;let k=!1;for(let O=A;O<A+w;O++)if(a[O]===g){k=!0;break}k?(u[E]===1&&--l[E]===0&&s.filterSize++,u[E]=0):(u[E]===0&&++l[E]===1&&s.filterSize--,u[E]=1)}}else for(let w=0;w<m;w++)a[w]===g?(u[w]===1&&--l[w]===0&&s.filterSize++,u[w]=0):(u[w]===0&&++l[w]===1&&s.filterSize--,u[w]=1)}else{for(let g of r)d.add(p.indexOf(g));if(o.datatype==="multitext"){const g=o.stringLength;let w=r.operand==="and";for(let E=0;E<m;E++){const A=E*g;let k=!1,O=0;for(let ne=A;ne<A+g&&a[ne]!==65535;ne++)if(d.has(a[ne]))if(w){if(O++,O===r.length){k=!0;break}}else{k=!0;break}k?(u[E]===1&&--l[E]===0&&s.filterSize++,u[E]=0):(u[E]===0&&++l[E]===1&&s.filterSize--,u[E]=1)}}else for(let g=0;g<m;g++)d.has(a[g])?(u[g]===1&&--l[g]===0&&s.filterSize++,u[g]=0):(u[g]===0&&++l[g]===1&&s.filterSize--,u[g]=1)}}filterMultipleCategories(e,t){const r=this.parent,s=[],o=[];for(let p=0;p<t.length;p++){const d=r.columnIndex[t[p]];s.push(d.data),o.push(d.values.indexOf(e[p]))}const a=r.filterArray,l=this.filterArray,u=r.size;for(let p=0;p<u;p++){let d=!0;for(let m=0;m<s.length;m++)if(s[m][p]!==o[m]){d=!1;break}d?(l[p]===1&&--a[p]===0&&r.filterSize++,l[p]=0):(l[p]===0&&++a[p]===1&&r.filterSize--,l[p]=1)}}getSankeyData(e,t,r={}){const s=this.parent.columnIndex[t[0]],o=this.parent.columnIndex[t[1]];r.values=s.values,r.values2=o.values,r.method=r.method||"sankey",r.method==="proportion"&&(r.cats=r.category==null?null:this.parent.columnIndex[t[2]].buffer);const a=performance.now(),l=u=>{console.log(`calc sankey ${s.name} ${o.name} : ${performance.now()-a}`),e(u.data),this.worker.removeEventListener("message",l)};this.worker.addEventListener("message",l),this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,s.buffer,r,o.buffer])}getCategories(e,t,r={}){const s=this.parent.columnIndex[t];r.values=s.values,r.datatype=s.datatype,r.stringLength=s.stringLength,performance.now();const o=a=>{e(a.data),this.worker.removeEventListener("message",o)};this.worker.addEventListener("message",o),this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,s.buffer,r])}destroy(){super.destroy(),this.worker.terminate()}}Dimension.types.category_dimension=CategoryDimension;class RangeDimension extends Dimension{constructor(e,t){super(e,t),this.worker=new Worker(new URL(""+new URL("binWorker-880d69a8.js",import.meta.url).href,self.location))}filterSquare(e,t){let r=null;typeof t[0]!="string"?r=t[0]:r=this.parent.columnIndex[t[0]].data;const s=this.parent.columnIndex[t[1]].data,o=this.parent.filterArray,a=this.parent,l=e.range1,u=e.range2,p=this.filterArray;for(let d=0;d<this.parent.size;d++){const m=r[d],g=s[d];m<l[0]||m>l[1]||g<u[0]||g>u[1]||isNaN(m)||isNaN(g)?(p[d]===0&&++o[d]===1&&a.filterSize--,p[d]=1):(p[d]===1&&--o[d]===0&&a.filterSize++,p[d]=0)}}filterPoly(e,t){const r=e;let s=Number.MAX_VALUE,o=Number.MAX_VALUE,a=Number.MIN_VALUE,l=Number.MIN_VALUE;for(let A of r)s=Math.min(s,A[0]),a=Math.max(a,A[0]),o=Math.min(o,A[1]),l=Math.max(l,A[1]);let u=null;typeof t[0]!="string"?u=t[0]:u=this.parent.columnIndex[t[0]].data;const p=this.parent.columnIndex[t[1]].data,d=this.parent.filterArray,m=this.parent,g=m.size,w=r,E=this.filterArray;for(let A=0;A<g;A++){let k=u[A],O=p[A],ne=!1;if(k<s||k>a||O<o||O>l||isNaN(k)||isNaN(O))E[A]===0&&++d[A]===1&&m.filterSize--,E[A]=1;else{for(let Q=0,ue=w.length-1;Q<w.length;ue=Q++){let U=w[Q][0],_=w[Q][1],Se=w[ue][0],Me=w[ue][1];_>O!=Me>O&&k<(Se-U)*(O-_)/(Me-_)+U&&(ne=!ne)}ne?(E[A]===1&&--d[A]===0&&m.filterSize++,E[A]=0):(E[A]===0&&++d[A]===1&&m.filterSize--,E[A]=1)}}}filterRange(e,t){const r=e.min,s=e.max,o=this.parent.columnIndex[t[0]].data,a=this.parent.filterArray,l=this.filterArray,u=this.parent;for(let p=0;p<this.parent.size;p++){const d=o[p];d<r||d>s||isNaN(d)?(l[p]===0&&++a[p]===1&&u.filterSize--,l[p]=1):(l[p]===1&&--a[p]===0&&u.filterSize++,l[p]=0)}}getBins(e,t,r={}){const s=this.parent.columnIndex[t];r.bins=r.bins===void 0?10:r.bins,r.min=r.min===void 0?s.minMax[0]:r.min,r.max=r.max===void 0?s.minMax[1]:r.max;const o=performance.now(),a=l=>{console.log(`calculate bins ${s.name} : ${performance.now()-o}`),e(l.data)};this.worker.onmessage=a,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,[s.buffer,s.datatype],r])}destroy(){super.destroy(),this.worker.terminate()}}Dimension.types.range_dimension=RangeDimension;class CatColDimension extends Dimension{constructor(e){super(e),this.worker=new Worker(new URL(""+new URL("catColWorker-2a4aab4d.js",import.meta.url).href,self.location))}getAverages(e,t,r={}){r.method=r.method||"mean";const s=performance.now(),o=this.parent.columnIndex;this.worker.onmessage=l=>{console.log(`calc averages  ${performance.now()-s}`),e(l.data)},r.values=o[t[0]].values;const a=[];for(let l=1;l<t.length;l++)a.push([o[t[l]].buffer,o[t[l]].datatype]);this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,o[t[0]].buffer,a,r])}destroy(){super.destroy(),this.worker.terminate()}}Dimension.types.catcol_dimension=CatColDimension;class CatRangeDimension extends RangeDimension{constructor(e,t){super(e,t),this.worker.terminate(),this.worker=new Worker(new URL(""+new URL("boxPlotWorker-d69acdb3.js",import.meta.url).href,self.location))}getKernalDensity(e,t,r={}){const s=performance.now(),o=this.parent.columnIndex[t[0]],a=this.parent.columnIndex[t[1]];this.parent.getMinMaxForColumn(t[1]),r.type="kernal_density",r.scaletrim&&(r.scaletrim=a.quantiles[r.scaletrim]),r.values=o.values;const l=u=>{console.log(`calculate violin ${o.name} : ${performance.now()-s}`),e(u.data)};this.worker.onmessage=l,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,o.buffer,[a.buffer,a.datatype],r])}getMultiBoxPlotData(e,t,r={}){const s=this.parent.columnIndex,o=performance.now(),a=t.map(u=>[s[u].buffer,c.Index[u].datatype]);r.analysis="multi",r.cat=this.parent.getColumnValues(t[0]).indexOf(r.category);const l=u=>{console.log(`calculate multiboxplot cols:${t.length} time: ${performance.now()-o}`),e(u.data)};this.worker.onmessage=l,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,a.slice(1),a[0],r])}getBoxPlotData(e,t,r={}){const s=performance.now(),o=this.parent.columnIndex[t[0]],a=this.parent.columnIndex[t[1]];r.analysis="boxplot",r.values=o.values;const l=u=>{console.log(`calculate boxplot ${o.name} : ${performance.now()-s}`),e(u.data)};this.worker.onmessage=l,this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,o.buffer,[a.buffer,a.datatype],r])}}Dimension.types.catrange_dimension=CatRangeDimension;class DensityDimension extends RangeDimension{constructor(e){super(e),this.worker.terminate(),this.worker=new Worker(new URL(""+new URL("densityWorker-2040e813.js",import.meta.url).href,self.location))}getDensityContours(e,t,r={}){const s=performance.now(),o=this.parent.columnIndex;this.worker.onmessage=a=>{console.log(`calc density contours  ${performance.now()-s}`),e(a.data)},this.worker.postMessage([this.filterBuffer,this.parent.filterBuffer,[o[t[0]].buffer,o[t[0]].datatype],[o[t[1]].buffer,o[t[1]].datatype],o[t[2]].buffer,r])}}Dimension.types.density_dimension=DensityDimension;function ascending$1(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function bisector(i){let e=i,t=i;i.length===1&&(e=(a,l)=>i(a)-l,t=ascendingComparator(i));function r(a,l,u,p){for(u==null&&(u=0),p==null&&(p=a.length);u<p;){const d=u+p>>>1;t(a[d],l)<0?u=d+1:p=d}return u}function s(a,l,u,p){for(u==null&&(u=0),p==null&&(p=a.length);u<p;){const d=u+p>>>1;t(a[d],l)>0?p=d:u=d+1}return u}function o(a,l,u,p){u==null&&(u=0),p==null&&(p=a.length);const d=r(a,l,u,p-1);return d>u&&e(a[d-1],l)>-e(a[d],l)?d-1:d}return{left:r,center:o,right:s}}function ascendingComparator(i){return(e,t)=>ascending$1(i(e),t)}function number$2(i){return i===null?NaN:+i}const ascendingBisect=bisector(ascending$1),bisectRight=ascendingBisect.right;bisector(number$2).center;const bisect=bisectRight;class Adder{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let r=0;for(let s=0;s<this._n&&s<32;s++){const o=t[s],a=e+o,l=Math.abs(e)<Math.abs(o)?e-(a-o):o-(a-e);l&&(t[r++]=l),e=a}return t[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let t=this._n,r,s,o,a=0;if(t>0){for(a=e[--t];t>0&&(r=a,s=e[--t],a=r+s,o=s-(a-r),!o););t>0&&(o<0&&e[t-1]<0||o>0&&e[t-1]>0)&&(s=o*2,r=a+s,s==r-a&&(a=r))}return a}}class InternMap extends Map{constructor(e,t=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[r,s]of e)this.set(r,s)}get(e){return super.get(intern_get(this,e))}has(e){return super.has(intern_get(this,e))}set(e,t){return super.set(intern_set(this,e),t)}delete(e){return super.delete(intern_delete(this,e))}}function intern_get({_intern:i,_key:e},t){const r=e(t);return i.has(r)?i.get(r):t}function intern_set({_intern:i,_key:e},t){const r=e(t);return i.has(r)?i.get(r):(i.set(r,t),t)}function intern_delete({_intern:i,_key:e},t){const r=e(t);return i.has(r)&&(t=i.get(t),i.delete(r)),t}function keyof(i){return i!==null&&typeof i=="object"?i.valueOf():i}var e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function ticks(i,e,t){var r,s=-1,o,a,l;if(e=+e,i=+i,t=+t,i===e&&t>0)return[i];if((r=e<i)&&(o=i,i=e,e=o),(l=tickIncrement(i,e,t))===0||!isFinite(l))return[];if(l>0){let u=Math.round(i/l),p=Math.round(e/l);for(u*l<i&&++u,p*l>e&&--p,a=new Array(o=p-u+1);++s<o;)a[s]=(u+s)*l}else{l=-l;let u=Math.round(i*l),p=Math.round(e*l);for(u/l<i&&++u,p/l>e&&--p,a=new Array(o=p-u+1);++s<o;)a[s]=(u+s)/l}return r&&a.reverse(),a}function tickIncrement(i,e,t){var r=(e-i)/Math.max(0,t),s=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,s);return s>=0?(o>=e10?10:o>=e5?5:o>=e2?2:1)*Math.pow(10,s):-Math.pow(10,-s)/(o>=e10?10:o>=e5?5:o>=e2?2:1)}function tickStep(i,e,t){var r=Math.abs(e-i)/Math.max(0,t),s=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/s;return o>=e10?s*=10:o>=e5?s*=5:o>=e2&&(s*=2),e<i?-s:s}function max$2(i,e){let t;if(e===void 0)for(const r of i)r!=null&&(t<r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let s of i)(s=e(s,++r,i))!=null&&(t<s||t===void 0&&s>=s)&&(t=s)}return t}function min$2(i,e){let t;if(e===void 0)for(const r of i)r!=null&&(t>r||t===void 0&&r>=r)&&(t=r);else{let r=-1;for(let s of i)(s=e(s,++r,i))!=null&&(t>s||t===void 0&&s>=s)&&(t=s)}return t}function quantileSorted(i,e,t=number$2){if(r=i.length){if((e=+e)<=0||r<2)return+t(i[0],0,i);if(e>=1)return+t(i[r-1],r-1,i);var r,s=(r-1)*e,o=Math.floor(s),a=+t(i[o],o,i),l=+t(i[o+1],o+1,i);return a+(l-a)*(s-o)}}function range$1(i,e,t){i=+i,e=+e,t=(s=arguments.length)<2?(e=i,i=0,1):s<3?1:+t;for(var r=-1,s=Math.max(0,Math.ceil((e-i)/t))|0,o=new Array(s);++r<s;)o[r]=i+r*t;return o}function sum(i,e){let t=0;if(e===void 0)for(let r of i)(r=+r)&&(t+=r);else{let r=-1;for(let s of i)(s=+e(s,++r,i))&&(t+=s)}return t}function initRange(i,e){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(e).domain(i);break}return this}const implicit=Symbol("implicit");function ordinal(){var i=new InternMap,e=[],t=[],r=implicit;function s(o){let a=i.get(o);if(a===void 0){if(r!==implicit)return r;i.set(o,a=e.push(o)-1)}return t[a%t.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],i=new InternMap;for(const a of o)i.has(a)||i.set(a,e.push(a)-1);return s},s.range=function(o){return arguments.length?(t=Array.from(o),s):t.slice()},s.unknown=function(o){return arguments.length?(r=o,s):r},s.copy=function(){return ordinal(e,t).unknown(r)},initRange.apply(s,arguments),s}function band(){var i=ordinal().unknown(void 0),e=i.domain,t=i.range,r=0,s=1,o,a,l=!1,u=0,p=0,d=.5;delete i.unknown;function m(){var g=e().length,w=s<r,E=w?s:r,A=w?r:s;o=(A-E)/Math.max(1,g-u+p*2),l&&(o=Math.floor(o)),E+=(A-E-o*(g-u))*d,a=o*(1-u),l&&(E=Math.round(E),a=Math.round(a));var k=range$1(g).map(function(O){return E+o*O});return t(w?k.reverse():k)}return i.domain=function(g){return arguments.length?(e(g),m()):e()},i.range=function(g){return arguments.length?([r,s]=g,r=+r,s=+s,m()):[r,s]},i.rangeRound=function(g){return[r,s]=g,r=+r,s=+s,l=!0,m()},i.bandwidth=function(){return a},i.step=function(){return o},i.round=function(g){return arguments.length?(l=!!g,m()):l},i.padding=function(g){return arguments.length?(u=Math.min(1,p=+g),m()):u},i.paddingInner=function(g){return arguments.length?(u=Math.min(1,g),m()):u},i.paddingOuter=function(g){return arguments.length?(p=+g,m()):p},i.align=function(g){return arguments.length?(d=Math.max(0,Math.min(1,g)),m()):d},i.copy=function(){return band(e(),[r,s]).round(l).paddingInner(u).paddingOuter(p).align(d)},initRange.apply(m(),arguments)}function define(i,e,t){i.prototype=e.prototype=t,t.constructor=i}function extend(i,e){var t=Object.create(i.prototype);for(var r in e)t[r]=e[r];return t}function Color(){}var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(i){var e,t;return i=(i+"").trim().toLowerCase(),(e=reHex.exec(i))?(t=e[1].length,e=parseInt(e[1],16),t===6?rgbn(e):t===3?new Rgb(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?rgba(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?rgba(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=reRgbInteger.exec(i))?new Rgb(e[1],e[2],e[3],1):(e=reRgbPercent.exec(i))?new Rgb(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=reRgbaInteger.exec(i))?rgba(e[1],e[2],e[3],e[4]):(e=reRgbaPercent.exec(i))?rgba(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=reHslPercent.exec(i))?hsla(e[1],e[2]/100,e[3]/100,1):(e=reHslaPercent.exec(i))?hsla(e[1],e[2]/100,e[3]/100,e[4]):named.hasOwnProperty(i)?rgbn(named[i]):i==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(i){return new Rgb(i>>16&255,i>>8&255,i&255,1)}function rgba(i,e,t,r){return r<=0&&(i=e=t=NaN),new Rgb(i,e,t,r)}function rgbConvert(i){return i instanceof Color||(i=color(i)),i?(i=i.rgb(),new Rgb(i.r,i.g,i.b,i.opacity)):new Rgb}function rgb(i,e,t,r){return arguments.length===1?rgbConvert(i):new Rgb(i,e,t,r??1)}function Rgb(i,e,t,r){this.r=+i,this.g=+e,this.b=+t,this.opacity=+r}define(Rgb,rgb,extend(Color,{brighter(i){return i=i==null?brighter:Math.pow(brighter,i),new Rgb(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?darker:Math.pow(darker,i),new Rgb(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity)?1:this.opacity)*255)}`}function rgb_formatRgb(){const i=clampa(this.opacity);return`${i===1?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${i===1?")":`, ${i})`}`}function clampa(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function clampi(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function hex(i){return i=clampi(i),(i<16?"0":"")+i.toString(16)}function hsla(i,e,t,r){return r<=0?i=e=t=NaN:t<=0||t>=1?i=e=NaN:e<=0&&(i=NaN),new Hsl(i,e,t,r)}function hslConvert(i){if(i instanceof Hsl)return new Hsl(i.h,i.s,i.l,i.opacity);if(i instanceof Color||(i=color(i)),!i)return new Hsl;if(i instanceof Hsl)return i;i=i.rgb();var e=i.r/255,t=i.g/255,r=i.b/255,s=Math.min(e,t,r),o=Math.max(e,t,r),a=NaN,l=o-s,u=(o+s)/2;return l?(e===o?a=(t-r)/l+(t<r)*6:t===o?a=(r-e)/l+2:a=(e-t)/l+4,l/=u<.5?o+s:2-o-s,a*=60):l=u>0&&u<1?0:a,new Hsl(a,l,u,i.opacity)}function hsl(i,e,t,r){return arguments.length===1?hslConvert(i):new Hsl(i,e,t,r??1)}function Hsl(i,e,t,r){this.h=+i,this.s=+e,this.l=+t,this.opacity=+r}define(Hsl,hsl,extend(Color,{brighter(i){return i=i==null?brighter:Math.pow(brighter,i),new Hsl(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?darker:Math.pow(darker,i),new Hsl(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,e=isNaN(i)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,s=2*t-r;return new Rgb(hsl2rgb(i>=240?i-240:i+120,s,r),hsl2rgb(i,s,r),hsl2rgb(i<120?i+240:i-120,s,r),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=clampa(this.opacity);return`${i===1?"hsl(":"hsla("}${clamph(this.h)}, ${clampt(this.s)*100}%, ${clampt(this.l)*100}%${i===1?")":`, ${i})`}`}}));function clamph(i){return i=(i||0)%360,i<0?i+360:i}function clampt(i){return Math.max(0,Math.min(1,i||0))}function hsl2rgb(i,e,t){return(i<60?e+(t-e)*i/60:i<180?t:i<240?e+(t-e)*(240-i)/60:e)*255}const constant$5=i=>()=>i;function linear$2(i,e){return function(t){return i+t*e}}function exponential(i,e,t){return i=Math.pow(i,t),e=Math.pow(e,t)-i,t=1/t,function(r){return Math.pow(i+r*e,t)}}function gamma(i){return(i=+i)==1?nogamma:function(e,t){return t-e?exponential(e,t,i):constant$5(isNaN(e)?t:e)}}function nogamma(i,e){var t=e-i;return t?linear$2(i,t):constant$5(isNaN(i)?e:i)}const interpolateRgb=function i(e){var t=gamma(e);function r(s,o){var a=t((s=rgb(s)).r,(o=rgb(o)).r),l=t(s.g,o.g),u=t(s.b,o.b),p=nogamma(s.opacity,o.opacity);return function(d){return s.r=a(d),s.g=l(d),s.b=u(d),s.opacity=p(d),s+""}}return r.gamma=i,r}(1);function numberArray(i,e){e||(e=[]);var t=i?Math.min(e.length,i.length):0,r=e.slice(),s;return function(o){for(s=0;s<t;++s)r[s]=i[s]*(1-o)+e[s]*o;return r}}function isNumberArray(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function genericArray(i,e){var t=e?e.length:0,r=i?Math.min(t,i.length):0,s=new Array(r),o=new Array(t),a;for(a=0;a<r;++a)s[a]=interpolate$1(i[a],e[a]);for(;a<t;++a)o[a]=e[a];return function(l){for(a=0;a<r;++a)o[a]=s[a](l);return o}}function date(i,e){var t=new Date;return i=+i,e=+e,function(r){return t.setTime(i*(1-r)+e*r),t}}function interpolateNumber(i,e){return i=+i,e=+e,function(t){return i*(1-t)+e*t}}function object(i,e){var t={},r={},s;(i===null||typeof i!="object")&&(i={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in i?t[s]=interpolate$1(i[s],e[s]):r[s]=e[s];return function(o){for(s in t)r[s]=t[s](o);return r}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(i){return function(){return i}}function one(i){return function(e){return i(e)+""}}function interpolateString(i,e){var t=reA.lastIndex=reB.lastIndex=0,r,s,o,a=-1,l=[],u=[];for(i=i+"",e=e+"";(r=reA.exec(i))&&(s=reB.exec(e));)(o=s.index)>t&&(o=e.slice(t,o),l[a]?l[a]+=o:l[++a]=o),(r=r[0])===(s=s[0])?l[a]?l[a]+=s:l[++a]=s:(l[++a]=null,u.push({i:a,x:interpolateNumber(r,s)})),t=reB.lastIndex;return t<e.length&&(o=e.slice(t),l[a]?l[a]+=o:l[++a]=o),l.length<2?u[0]?one(u[0].x):zero(e):(e=u.length,function(p){for(var d=0,m;d<e;++d)l[(m=u[d]).i]=m.x(p);return l.join("")})}function interpolate$1(i,e){var t=typeof e,r;return e==null||t==="boolean"?constant$5(e):(t==="number"?interpolateNumber:t==="string"?(r=color(e))?(e=r,interpolateRgb):interpolateString:e instanceof color?interpolateRgb:e instanceof Date?date:isNumberArray(e)?numberArray:Array.isArray(e)?genericArray:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?object:interpolateNumber)(i,e)}function interpolateRound(i,e){return i=+i,e=+e,function(t){return Math.round(i*(1-t)+e*t)}}var degrees=180/Math.PI,identity$6={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function decompose(i,e,t,r,s,o){var a,l,u;return(a=Math.sqrt(i*i+e*e))&&(i/=a,e/=a),(u=i*t+e*r)&&(t-=i*u,r-=e*u),(l=Math.sqrt(t*t+r*r))&&(t/=l,r/=l,u/=l),i*r<e*t&&(i=-i,e=-e,u=-u,a=-a),{translateX:s,translateY:o,rotate:Math.atan2(e,i)*degrees,skewX:Math.atan(u)*degrees,scaleX:a,scaleY:l}}var svgNode;function parseCss(i){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return e.isIdentity?identity$6:decompose(e.a,e.b,e.c,e.d,e.e,e.f)}function parseSvg(i){return i==null||(svgNode||(svgNode=document.createElementNS("http://www.w3.org/2000/svg","g")),svgNode.setAttribute("transform",i),!(i=svgNode.transform.baseVal.consolidate()))?identity$6:(i=i.matrix,decompose(i.a,i.b,i.c,i.d,i.e,i.f))}function interpolateTransform(i,e,t,r){function s(p){return p.length?p.pop()+" ":""}function o(p,d,m,g,w,E){if(p!==m||d!==g){var A=w.push("translate(",null,e,null,t);E.push({i:A-4,x:interpolateNumber(p,m)},{i:A-2,x:interpolateNumber(d,g)})}else(m||g)&&w.push("translate("+m+e+g+t)}function a(p,d,m,g){p!==d?(p-d>180?d+=360:d-p>180&&(p+=360),g.push({i:m.push(s(m)+"rotate(",null,r)-2,x:interpolateNumber(p,d)})):d&&m.push(s(m)+"rotate("+d+r)}function l(p,d,m,g){p!==d?g.push({i:m.push(s(m)+"skewX(",null,r)-2,x:interpolateNumber(p,d)}):d&&m.push(s(m)+"skewX("+d+r)}function u(p,d,m,g,w,E){if(p!==m||d!==g){var A=w.push(s(w)+"scale(",null,",",null,")");E.push({i:A-4,x:interpolateNumber(p,m)},{i:A-2,x:interpolateNumber(d,g)})}else(m!==1||g!==1)&&w.push(s(w)+"scale("+m+","+g+")")}return function(p,d){var m=[],g=[];return p=i(p),d=i(d),o(p.translateX,p.translateY,d.translateX,d.translateY,m,g),a(p.rotate,d.rotate,m,g),l(p.skewX,d.skewX,m,g),u(p.scaleX,p.scaleY,d.scaleX,d.scaleY,m,g),p=d=null,function(w){for(var E=-1,A=g.length,k;++E<A;)m[(k=g[E]).i]=k.x(w);return m.join("")}}}var interpolateTransformCss=interpolateTransform(parseCss,"px, ","px)","deg)"),interpolateTransformSvg=interpolateTransform(parseSvg,", ",")",")");function constants(i){return function(){return i}}function number$1(i){return+i}var unit=[0,1];function identity$5(i){return i}function normalize(i,e){return(e-=i=+i)?function(t){return(t-i)/e}:constants(isNaN(e)?NaN:.5)}function clamper(i,e){var t;return i>e&&(t=i,i=e,e=t),function(r){return Math.max(i,Math.min(e,r))}}function bimap(i,e,t){var r=i[0],s=i[1],o=e[0],a=e[1];return s<r?(r=normalize(s,r),o=t(a,o)):(r=normalize(r,s),o=t(o,a)),function(l){return o(r(l))}}function polymap(i,e,t){var r=Math.min(i.length,e.length)-1,s=new Array(r),o=new Array(r),a=-1;for(i[r]<i[0]&&(i=i.slice().reverse(),e=e.slice().reverse());++a<r;)s[a]=normalize(i[a],i[a+1]),o[a]=t(e[a],e[a+1]);return function(l){var u=bisect(i,l,1,r)-1;return o[u](s[u](l))}}function copy(i,e){return e.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function transformer(){var i=unit,e=unit,t=interpolate$1,r,s,o,a=identity$5,l,u,p;function d(){var g=Math.min(i.length,e.length);return a!==identity$5&&(a=clamper(i[0],i[g-1])),l=g>2?polymap:bimap,u=p=null,m}function m(g){return g==null||isNaN(g=+g)?o:(u||(u=l(i.map(r),e,t)))(r(a(g)))}return m.invert=function(g){return a(s((p||(p=l(e,i.map(r),interpolateNumber)))(g)))},m.domain=function(g){return arguments.length?(i=Array.from(g,number$1),d()):i.slice()},m.range=function(g){return arguments.length?(e=Array.from(g),d()):e.slice()},m.rangeRound=function(g){return e=Array.from(g),t=interpolateRound,d()},m.clamp=function(g){return arguments.length?(a=g?!0:identity$5,d()):a!==identity$5},m.interpolate=function(g){return arguments.length?(t=g,d()):t},m.unknown=function(g){return arguments.length?(o=g,m):o},function(g,w){return r=g,s=w,d()}}function continuous(){return transformer()(identity$5,identity$5)}function formatDecimal(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function formatDecimalParts(i,e){if((t=(i=e?i.toExponential(e-1):i.toExponential()).indexOf("e"))<0)return null;var t,r=i.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+i.slice(t+1)]}function exponent(i){return i=formatDecimalParts(Math.abs(i)),i?i[1]:NaN}function formatGroup(i,e){return function(t,r){for(var s=t.length,o=[],a=0,l=i[0],u=0;s>0&&l>0&&(u+l+1>r&&(l=Math.max(1,r-u)),o.push(t.substring(s-=l,s+l)),!((u+=l+1)>r));)l=i[a=(a+1)%i.length];return o.reverse().join(e)}}function formatNumerals(i){return function(e){return e.replace(/[0-9]/g,function(t){return i[+t]})}}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(i){if(!(e=re.exec(i)))throw new Error("invalid format: "+i);var e;return new FormatSpecifier({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function formatTrim(i){e:for(var e=i.length,t=1,r=-1,s;t<e;++t)switch(i[t]){case".":r=s=t;break;case"0":r===0&&(r=t),s=t;break;default:if(!+i[t])break e;r>0&&(r=0);break}return r>0?i.slice(0,r)+i.slice(s+1):i}var prefixExponent;function formatPrefixAuto(i,e){var t=formatDecimalParts(i,e);if(!t)return i+"";var r=t[0],s=t[1],o=s-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+formatDecimalParts(i,Math.max(0,e+o-1))[0]}function formatRounded(i,e){var t=formatDecimalParts(i,e);if(!t)return i+"";var r=t[0],s=t[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const formatTypes={"%":(i,e)=>(i*100).toFixed(e),b:i=>Math.round(i).toString(2),c:i=>i+"",d:formatDecimal,e:(i,e)=>i.toExponential(e),f:(i,e)=>i.toFixed(e),g:(i,e)=>i.toPrecision(e),o:i=>Math.round(i).toString(8),p:(i,e)=>formatRounded(i*100,e),r:formatRounded,s:formatPrefixAuto,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function identity$4(i){return i}var map=Array.prototype.map,prefixes=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function formatLocale(i){var e=i.grouping===void 0||i.thousands===void 0?identity$4:formatGroup(map.call(i.grouping,Number),i.thousands+""),t=i.currency===void 0?"":i.currency[0]+"",r=i.currency===void 0?"":i.currency[1]+"",s=i.decimal===void 0?".":i.decimal+"",o=i.numerals===void 0?identity$4:formatNumerals(map.call(i.numerals,String)),a=i.percent===void 0?"%":i.percent+"",l=i.minus===void 0?"":i.minus+"",u=i.nan===void 0?"NaN":i.nan+"";function p(m){m=formatSpecifier(m);var g=m.fill,w=m.align,E=m.sign,A=m.symbol,k=m.zero,O=m.width,ne=m.comma,Q=m.precision,ue=m.trim,U=m.type;U==="n"?(ne=!0,U="g"):formatTypes[U]||(Q===void 0&&(Q=12),ue=!0,U="g"),(k||g==="0"&&w==="=")&&(k=!0,g="0",w="=");var _=A==="$"?t:A==="#"&&/[boxX]/.test(U)?"0"+U.toLowerCase():"",Se=A==="$"?r:/[%p]/.test(U)?a:"",Me=formatTypes[U],Ke=/[defgprs%]/.test(U);Q=Q===void 0?6:/[gprs]/.test(U)?Math.max(1,Math.min(21,Q)):Math.max(0,Math.min(20,Q));function kt(Qe){var ze=_,Je=Se,St,Te,dt;if(U==="c")Je=Me(Qe)+Je,Qe="";else{Qe=+Qe;var ot=Qe<0||1/Qe<0;if(Qe=isNaN(Qe)?u:Me(Math.abs(Qe),Q),ue&&(Qe=formatTrim(Qe)),ot&&+Qe==0&&E!=="+"&&(ot=!1),ze=(ot?E==="("?E:l:E==="-"||E==="("?"":E)+ze,Je=(U==="s"?prefixes[8+prefixExponent/3]:"")+Je+(ot&&E==="("?")":""),Ke){for(St=-1,Te=Qe.length;++St<Te;)if(dt=Qe.charCodeAt(St),48>dt||dt>57){Je=(dt===46?s+Qe.slice(St+1):Qe.slice(St))+Je,Qe=Qe.slice(0,St);break}}}ne&&!k&&(Qe=e(Qe,1/0));var yt=ze.length+Qe.length+Je.length,Ue=yt<O?new Array(O-yt+1).join(g):"";switch(ne&&k&&(Qe=e(Ue+Qe,Ue.length?O-Je.length:1/0),Ue=""),w){case"<":Qe=ze+Qe+Je+Ue;break;case"=":Qe=ze+Ue+Qe+Je;break;case"^":Qe=Ue.slice(0,yt=Ue.length>>1)+ze+Qe+Je+Ue.slice(yt);break;default:Qe=Ue+ze+Qe+Je;break}return o(Qe)}return kt.toString=function(){return m+""},kt}function d(m,g){var w=p((m=formatSpecifier(m),m.type="f",m)),E=Math.max(-8,Math.min(8,Math.floor(exponent(g)/3)))*3,A=Math.pow(10,-E),k=prefixes[8+E/3];return function(O){return w(A*O)+k}}return{format:p,formatPrefix:d}}var locale,format,formatPrefix;defaultLocale({thousands:",",grouping:[3],currency:["$",""]});function defaultLocale(i){return locale=formatLocale(i),format=locale.format,formatPrefix=locale.formatPrefix,locale}function precisionFixed(i){return Math.max(0,-exponent(Math.abs(i)))}function precisionPrefix(i,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(e)/3)))*3-exponent(Math.abs(i)))}function precisionRound(i,e){return i=Math.abs(i),e=Math.abs(e)-i,Math.max(0,exponent(e)-exponent(i))+1}function tickFormat(i,e,t,r){var s=tickStep(i,e,t),o;switch(r=formatSpecifier(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(i),Math.abs(e));return r.precision==null&&!isNaN(o=precisionPrefix(s,a))&&(r.precision=o),formatPrefix(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=precisionRound(s,Math.max(Math.abs(i),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=precisionFixed(s))&&(r.precision=o-(r.type==="%")*2);break}}return format(r)}function linearish(i){var e=i.domain;return i.ticks=function(t){var r=e();return ticks(r[0],r[r.length-1],t??10)},i.tickFormat=function(t,r){var s=e();return tickFormat(s[0],s[s.length-1],t??10,r)},i.nice=function(t){t==null&&(t=10);var r=e(),s=0,o=r.length-1,a=r[s],l=r[o],u,p,d=10;for(l<a&&(p=a,a=l,l=p,p=s,s=o,o=p);d-- >0;){if(p=tickIncrement(a,l,t),p===u)return r[s]=a,r[o]=l,e(r);if(p>0)a=Math.floor(a/p)*p,l=Math.ceil(l/p)*p;else if(p<0)a=Math.ceil(a*p)/p,l=Math.floor(l*p)/p;else break;u=p}return i},i}function linear$1(){var i=continuous();return i.copy=function(){return copy(i,linear$1())},initRange.apply(i,arguments),linearish(i)}function transformSymlog(i){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/i))}}function transformSymexp(i){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*i}}function symlogish(i){var e=1,t=i(transformSymlog(e),transformSymexp(e));return t.constant=function(r){return arguments.length?i(transformSymlog(e=+r),transformSymexp(e)):e},linearish(t)}function symlog(){var i=symlogish(transformer());return i.copy=function(){return copy(i,symlog()).constant(i.constant())},initRange.apply(i,arguments)}var xhtml="http://www.w3.org/1999/xhtml";const namespaces={svg:"http://www.w3.org/2000/svg",xhtml,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function namespace(i){var e=i+="",t=e.indexOf(":");return t>=0&&(e=i.slice(0,t))!=="xmlns"&&(i=i.slice(t+1)),namespaces.hasOwnProperty(e)?{space:namespaces[e],local:i}:i}function creatorInherit(i){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===xhtml&&e.documentElement.namespaceURI===xhtml?e.createElement(i):e.createElementNS(t,i)}}function creatorFixed(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function creator(i){var e=namespace(i);return(e.local?creatorFixed:creatorInherit)(e)}function none(){}function selector(i){return i==null?none:function(){return this.querySelector(i)}}function selection_select(i){typeof i!="function"&&(i=selector(i));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var o=e[s],a=o.length,l=r[s]=new Array(a),u,p,d=0;d<a;++d)(u=o[d])&&(p=i.call(u,u.__data__,d,o))&&("__data__"in u&&(p.__data__=u.__data__),l[d]=p);return new Selection$1(r,this._parents)}function array$1(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function empty$1(){return[]}function selectorAll(i){return i==null?empty$1:function(){return this.querySelectorAll(i)}}function arrayAll(i){return function(){return array$1(i.apply(this,arguments))}}function selection_selectAll(i){typeof i=="function"?i=arrayAll(i):i=selectorAll(i);for(var e=this._groups,t=e.length,r=[],s=[],o=0;o<t;++o)for(var a=e[o],l=a.length,u,p=0;p<l;++p)(u=a[p])&&(r.push(i.call(u,u.__data__,p,a)),s.push(u));return new Selection$1(r,s)}function matcher(i){return function(){return this.matches(i)}}function childMatcher(i){return function(e){return e.matches(i)}}var find$1=Array.prototype.find;function childFind(i){return function(){return find$1.call(this.children,i)}}function childFirst(){return this.firstElementChild}function selection_selectChild(i){return this.select(i==null?childFirst:childFind(typeof i=="function"?i:childMatcher(i)))}var filter=Array.prototype.filter;function children(){return Array.from(this.children)}function childrenFilter(i){return function(){return filter.call(this.children,i)}}function selection_selectChildren(i){return this.selectAll(i==null?children:childrenFilter(typeof i=="function"?i:childMatcher(i)))}function selection_filter(i){typeof i!="function"&&(i=matcher(i));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var o=e[s],a=o.length,l=r[s]=[],u,p=0;p<a;++p)(u=o[p])&&i.call(u,u.__data__,p,o)&&l.push(u);return new Selection$1(r,this._parents)}function sparse(i){return new Array(i.length)}function selection_enter(){return new Selection$1(this._enter||this._groups.map(sparse),this._parents)}function EnterNode(i,e){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=e}EnterNode.prototype={constructor:EnterNode,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,e){return this._parent.insertBefore(i,e)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function constant$4(i){return function(){return i}}function bindIndex(i,e,t,r,s,o){for(var a=0,l,u=e.length,p=o.length;a<p;++a)(l=e[a])?(l.__data__=o[a],r[a]=l):t[a]=new EnterNode(i,o[a]);for(;a<u;++a)(l=e[a])&&(s[a]=l)}function bindKey(i,e,t,r,s,o,a){var l,u,p=new Map,d=e.length,m=o.length,g=new Array(d),w;for(l=0;l<d;++l)(u=e[l])&&(g[l]=w=a.call(u,u.__data__,l,e)+"",p.has(w)?s[l]=u:p.set(w,u));for(l=0;l<m;++l)w=a.call(i,o[l],l,o)+"",(u=p.get(w))?(r[l]=u,u.__data__=o[l],p.delete(w)):t[l]=new EnterNode(i,o[l]);for(l=0;l<d;++l)(u=e[l])&&p.get(g[l])===u&&(s[l]=u)}function datum(i){return i.__data__}function selection_data(i,e){if(!arguments.length)return Array.from(this,datum);var t=e?bindKey:bindIndex,r=this._parents,s=this._groups;typeof i!="function"&&(i=constant$4(i));for(var o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),p=0;p<o;++p){var d=r[p],m=s[p],g=m.length,w=arraylike(i.call(d,d&&d.__data__,p,r)),E=w.length,A=l[p]=new Array(E),k=a[p]=new Array(E),O=u[p]=new Array(g);t(d,m,A,k,O,w,e);for(var ne=0,Q=0,ue,U;ne<E;++ne)if(ue=A[ne]){for(ne>=Q&&(Q=ne+1);!(U=k[Q])&&++Q<E;);ue._next=U||null}}return a=new Selection$1(a,r),a._enter=l,a._exit=u,a}function arraylike(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function selection_exit(){return new Selection$1(this._exit||this._groups.map(sparse),this._parents)}function selection_join(i,e,t){var r=this.enter(),s=this,o=this.exit();return typeof i=="function"?(r=i(r),r&&(r=r.selection())):r=r.append(i+""),e!=null&&(s=e(s),s&&(s=s.selection())),t==null?o.remove():t(o),r&&s?r.merge(s).order():s}function selection_merge(i){for(var e=i.selection?i.selection():i,t=this._groups,r=e._groups,s=t.length,o=r.length,a=Math.min(s,o),l=new Array(s),u=0;u<a;++u)for(var p=t[u],d=r[u],m=p.length,g=l[u]=new Array(m),w,E=0;E<m;++E)(w=p[E]||d[E])&&(g[E]=w);for(;u<s;++u)l[u]=t[u];return new Selection$1(l,this._parents)}function selection_order(){for(var i=this._groups,e=-1,t=i.length;++e<t;)for(var r=i[e],s=r.length-1,o=r[s],a;--s>=0;)(a=r[s])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function selection_sort(i){i||(i=ascending);function e(m,g){return m&&g?i(m.__data__,g.__data__):!m-!g}for(var t=this._groups,r=t.length,s=new Array(r),o=0;o<r;++o){for(var a=t[o],l=a.length,u=s[o]=new Array(l),p,d=0;d<l;++d)(p=a[d])&&(u[d]=p);u.sort(e)}return new Selection$1(s,this._parents).order()}function ascending(i,e){return i<e?-1:i>e?1:i>=e?0:NaN}function selection_call(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function selection_nodes(){return Array.from(this)}function selection_node(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var r=i[e],s=0,o=r.length;s<o;++s){var a=r[s];if(a)return a}return null}function selection_size(){let i=0;for(const e of this)++i;return i}function selection_empty(){return!this.node()}function selection_each(i){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var s=e[t],o=0,a=s.length,l;o<a;++o)(l=s[o])&&i.call(l,l.__data__,o,s);return this}function attrRemove$1(i){return function(){this.removeAttribute(i)}}function attrRemoveNS$1(i){return function(){this.removeAttributeNS(i.space,i.local)}}function attrConstant$1(i,e){return function(){this.setAttribute(i,e)}}function attrConstantNS$1(i,e){return function(){this.setAttributeNS(i.space,i.local,e)}}function attrFunction$1(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(i):this.setAttribute(i,t)}}function attrFunctionNS$1(i,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,t)}}function selection_attr(i,e){var t=namespace(i);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?attrRemoveNS$1:attrRemove$1:typeof e=="function"?t.local?attrFunctionNS$1:attrFunction$1:t.local?attrConstantNS$1:attrConstant$1)(t,e))}function defaultView(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function styleRemove$1(i){return function(){this.style.removeProperty(i)}}function styleConstant$1(i,e,t){return function(){this.style.setProperty(i,e,t)}}function styleFunction$1(i,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(i):this.style.setProperty(i,r,t)}}function selection_style(i,e,t){return arguments.length>1?this.each((e==null?styleRemove$1:typeof e=="function"?styleFunction$1:styleConstant$1)(i,e,t??"")):styleValue(this.node(),i)}function styleValue(i,e){return i.style.getPropertyValue(e)||defaultView(i).getComputedStyle(i,null).getPropertyValue(e)}function propertyRemove(i){return function(){delete this[i]}}function propertyConstant(i,e){return function(){this[i]=e}}function propertyFunction(i,e){return function(){var t=e.apply(this,arguments);t==null?delete this[i]:this[i]=t}}function selection_property(i,e){return arguments.length>1?this.each((e==null?propertyRemove:typeof e=="function"?propertyFunction:propertyConstant)(i,e)):this.node()[i]}function classArray(i){return i.trim().split(/^|\s+/)}function classList(i){return i.classList||new ClassList(i)}function ClassList(i){this._node=i,this._names=classArray(i.getAttribute("class")||"")}ClassList.prototype={add:function(i){var e=this._names.indexOf(i);e<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var e=this._names.indexOf(i);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function classedAdd(i,e){for(var t=classList(i),r=-1,s=e.length;++r<s;)t.add(e[r])}function classedRemove(i,e){for(var t=classList(i),r=-1,s=e.length;++r<s;)t.remove(e[r])}function classedTrue(i){return function(){classedAdd(this,i)}}function classedFalse(i){return function(){classedRemove(this,i)}}function classedFunction(i,e){return function(){(e.apply(this,arguments)?classedAdd:classedRemove)(this,i)}}function selection_classed(i,e){var t=classArray(i+"");if(arguments.length<2){for(var r=classList(this.node()),s=-1,o=t.length;++s<o;)if(!r.contains(t[s]))return!1;return!0}return this.each((typeof e=="function"?classedFunction:e?classedTrue:classedFalse)(t,e))}function textRemove(){this.textContent=""}function textConstant$1(i){return function(){this.textContent=i}}function textFunction$1(i){return function(){var e=i.apply(this,arguments);this.textContent=e??""}}function selection_text(i){return arguments.length?this.each(i==null?textRemove:(typeof i=="function"?textFunction$1:textConstant$1)(i)):this.node().textContent}function htmlRemove(){this.innerHTML=""}function htmlConstant(i){return function(){this.innerHTML=i}}function htmlFunction(i){return function(){var e=i.apply(this,arguments);this.innerHTML=e??""}}function selection_html(i){return arguments.length?this.each(i==null?htmlRemove:(typeof i=="function"?htmlFunction:htmlConstant)(i)):this.node().innerHTML}function raise(){this.nextSibling&&this.parentNode.appendChild(this)}function selection_raise(){return this.each(raise)}function lower(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function selection_lower(){return this.each(lower)}function selection_append(i){var e=typeof i=="function"?i:creator(i);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function constantNull(){return null}function selection_insert(i,e){var t=typeof i=="function"?i:creator(i),r=e==null?constantNull:typeof e=="function"?e:selector(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function remove(){var i=this.parentNode;i&&i.removeChild(this)}function selection_remove(){return this.each(remove)}function selection_cloneShallow(){var i=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function selection_cloneDeep(){var i=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(i,this.nextSibling):i}function selection_clone(i){return this.select(i?selection_cloneDeep:selection_cloneShallow)}function selection_datum(i){return arguments.length?this.property("__data__",i):this.node().__data__}function contextListener(i){return function(e){i.call(this,e,this.__data__)}}function parseTypenames$1(i){return i.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function onRemove(i){return function(){var e=this.__on;if(e){for(var t=0,r=-1,s=e.length,o;t<s;++t)o=e[t],(!i.type||o.type===i.type)&&o.name===i.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function onAdd(i,e,t){return function(){var r=this.__on,s,o=contextListener(e);if(r){for(var a=0,l=r.length;a<l;++a)if((s=r[a]).type===i.type&&s.name===i.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=o,s.options=t),s.value=e;return}}this.addEventListener(i.type,o,t),s={type:i.type,name:i.name,value:e,listener:o,options:t},r?r.push(s):this.__on=[s]}}function selection_on(i,e,t){var r=parseTypenames$1(i+""),s,o=r.length,a;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,p=l.length,d;u<p;++u)for(s=0,d=l[u];s<o;++s)if((a=r[s]).type===d.type&&a.name===d.name)return d.value}return}for(l=e?onAdd:onRemove,s=0;s<o;++s)this.each(l(r[s],e,t));return this}function dispatchEvent(i,e,t){var r=defaultView(i),s=r.CustomEvent;typeof s=="function"?s=new s(e,t):(s=r.document.createEvent("Event"),t?(s.initEvent(e,t.bubbles,t.cancelable),s.detail=t.detail):s.initEvent(e,!1,!1)),i.dispatchEvent(s)}function dispatchConstant(i,e){return function(){return dispatchEvent(this,i,e)}}function dispatchFunction(i,e){return function(){return dispatchEvent(this,i,e.apply(this,arguments))}}function selection_dispatch(i,e){return this.each((typeof e=="function"?dispatchFunction:dispatchConstant)(i,e))}function*selection_iterator(){for(var i=this._groups,e=0,t=i.length;e<t;++e)for(var r=i[e],s=0,o=r.length,a;s<o;++s)(a=r[s])&&(yield a)}var root=[null];function Selection$1(i,e){this._groups=i,this._parents=e}function selection(){return new Selection$1([[document.documentElement]],root)}function selection_selection(){return this}Selection$1.prototype=selection.prototype={constructor:Selection$1,select:selection_select,selectAll:selection_selectAll,selectChild:selection_selectChild,selectChildren:selection_selectChildren,filter:selection_filter,data:selection_data,enter:selection_enter,exit:selection_exit,join:selection_join,merge:selection_merge,selection:selection_selection,order:selection_order,sort:selection_sort,call:selection_call,nodes:selection_nodes,node:selection_node,size:selection_size,empty:selection_empty,each:selection_each,attr:selection_attr,style:selection_style,property:selection_property,classed:selection_classed,text:selection_text,html:selection_html,raise:selection_raise,lower:selection_lower,append:selection_append,insert:selection_insert,remove:selection_remove,clone:selection_clone,datum:selection_datum,on:selection_on,dispatch:selection_dispatch,[Symbol.iterator]:selection_iterator};function select(i){return typeof i=="string"?new Selection$1([[document.querySelector(i)]],[document.documentElement]):new Selection$1([[i]],root)}function sourceEvent(i){let e;for(;e=i.sourceEvent;)i=e;return i}function pointer(i,e){if(i=sourceEvent(i),e===void 0&&(e=i.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var r=t.createSVGPoint();return r.x=i.clientX,r.y=i.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var s=e.getBoundingClientRect();return[i.clientX-s.left-e.clientLeft,i.clientY-s.top-e.clientTop]}}return[i.pageX,i.pageY]}function identity$3(i){return i}var top=1,right=2,bottom=3,left=4,epsilon$3=1e-6;function translateX(i){return"translate("+i+",0)"}function translateY(i){return"translate(0,"+i+")"}function number(i){return e=>+i(e)}function center(i,e){return e=Math.max(0,i.bandwidth()-e*2)/2,i.round()&&(e=Math.round(e)),t=>+i(t)+e}function entering(){return!this.__axis}function axis(i,e){var t=[],r=null,s=null,o=6,a=6,l=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,p=i===top||i===left?-1:1,d=i===left||i===right?"x":"y",m=i===top||i===bottom?translateX:translateY;function g(w){var E=r??(e.ticks?e.ticks.apply(e,t):e.domain()),A=s??(e.tickFormat?e.tickFormat.apply(e,t):identity$3),k=Math.max(o,0)+l,O=e.range(),ne=+O[0]+u,Q=+O[O.length-1]+u,ue=(e.bandwidth?center:number)(e.copy(),u),U=w.selection?w.selection():w,_=U.selectAll(".domain").data([null]),Se=U.selectAll(".tick").data(E,e).order(),Me=Se.exit(),Ke=Se.enter().append("g").attr("class","tick"),kt=Se.select("line"),Qe=Se.select("text");_=_.merge(_.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),Se=Se.merge(Ke),kt=kt.merge(Ke.append("line").attr("stroke","currentColor").attr(d+"2",p*o)),Qe=Qe.merge(Ke.append("text").attr("fill","currentColor").attr(d,p*k).attr("dy",i===top?"0em":i===bottom?"0.71em":"0.32em")),w!==U&&(_=_.transition(w),Se=Se.transition(w),kt=kt.transition(w),Qe=Qe.transition(w),Me=Me.transition(w).attr("opacity",epsilon$3).attr("transform",function(ze){return isFinite(ze=ue(ze))?m(ze+u):this.getAttribute("transform")}),Ke.attr("opacity",epsilon$3).attr("transform",function(ze){var Je=this.parentNode.__axis;return m((Je&&isFinite(Je=Je(ze))?Je:ue(ze))+u)})),Me.remove(),_.attr("d",i===left||i===right?a?"M"+p*a+","+ne+"H"+u+"V"+Q+"H"+p*a:"M"+u+","+ne+"V"+Q:a?"M"+ne+","+p*a+"V"+u+"H"+Q+"V"+p*a:"M"+ne+","+u+"H"+Q),Se.attr("opacity",1).attr("transform",function(ze){return m(ue(ze)+u)}),kt.attr(d+"2",p*o),Qe.attr(d,p*k).text(A),U.filter(entering).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",i===right?"start":i===left?"end":"middle"),U.each(function(){this.__axis=ue})}return g.scale=function(w){return arguments.length?(e=w,g):e},g.ticks=function(){return t=Array.from(arguments),g},g.tickArguments=function(w){return arguments.length?(t=w==null?[]:Array.from(w),g):t.slice()},g.tickValues=function(w){return arguments.length?(r=w==null?null:Array.from(w),g):r&&r.slice()},g.tickFormat=function(w){return arguments.length?(s=w,g):s},g.tickSize=function(w){return arguments.length?(o=a=+w,g):o},g.tickSizeInner=function(w){return arguments.length?(o=+w,g):o},g.tickSizeOuter=function(w){return arguments.length?(a=+w,g):a},g.tickPadding=function(w){return arguments.length?(l=+w,g):l},g.offset=function(w){return arguments.length?(u=+w,g):u},g}function axisBottom(i){return axis(bottom,i)}function axisLeft(i){return axis(left,i)}function getColorLegend(i,e,t={}){const r=i.length,s=t.type||"color",o=s==="circle"?20:12,a=r*o+(r+2)*2,l=createEl("div",{styles:{width:"120px",height:(a>215?215:a)+35+"px",position:"absolute",border:"0.5px solid black"},classes:["legend-container"]});createEl("div",{styles:{height:"20px",whiteSpace:"nowrap"},classes:["legend-title"],text:t.label},l);const u=createEl("div",{styles:{overflowY:"auto",overflowX:"hidden",height:"calc(100% - 10px)",width:"100%"},classes:["legend-body"]},l),p=createSVGEl("svg",{height:a,width:180,styles:{position:"relative"}},u),d=createSVGEl("g",{},p),m=s==="color"?14:s==="line"?20:30;for(let g=0;g<r;g++){s==="color"?createSVGEl("rect",{y:(g+1)*2+g*o,x:2,height:"10",width:"10",styles:{fill:i[g]}},d):s==="line"?createSVGEl("rect",{y:(g+1)*2+g*o,x:2,height:"10",width:i[g],styles:{fill:"gray"}},d):s==="circle"&&createSVGEl("circle",{cy:(g+1)*2+g*o+4,cx:15,r:i[g],styles:{fill:"gray"}},d);const w=createSVGEl("text",{y:(g+1)*2+g*o+6+3,x:m,"alignment-baseline":"center",styles:{"font-size":"12px",fill:"currentcolor"},text:e[g]===""?"none":e[g]},d);select(w).style("fill","currentcolor")}return makeDraggable(l,{handle:".legend-body"}),makeResizable(l),l}function getColorBar(i,e={}){const t=e,r=i.length,s=i.map((w,E)=>[Math.floor(E/r*100)+"%",w]),o=t.width||120,a=t.height||45,l=createSVGEl("svg",{height:a,width:o,styles:{position:"relative"}}),u=select(l).append("g"),p=getRandomString();t.label&&u.append("text").text(t.label).attr("x",10).style("fill","currentColor").attr("alignment-baseline","hanging").style("font-size","12px");const d=u.append("defs").append("linearGradient").attr("id",p).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");let m=a;if(t.label&&(m-=10),t.range&&(m-=25),u.append("rect").attr("x",t.range?10:0).attr("y",t.label?10:0).attr("width",t.range?o-20:20).attr("height",m).style("fill",`url(#${p})`),s.forEach(w=>{d.append("stop").attr("offset",w[0]).attr("stop-color",w[1]).attr("stop-opacity",1)}),t.range){const w=linear$1().domain([t.range[0],t.range[1]]).range([0,o-20]),E=axisBottom(w).tickFormat((A,k)=>A>=1e4?Number.parseFloat(A).toPrecision(2):A).ticks(Math.ceil(o/20));u.append("g").call(E).attr("transform",`translate(10,${a-25})`).selectAll("text").style("text-anchor","end").attr("dx","-.4em").attr("dy",".4em").attr("transform","rotate(-45)")}const g=createEl("div",{height:a,width:o,styles:{position:"absolute"},classes:["legend-container"]});return g.append(l),makeDraggable(g),g}class DataStore{constructor(e,t={}){if(this.size=e,this.filterSize=e,this.columns=[],this.columnIndex={},this.listeners={},this.indexes={},this.filterBuffer=new SharedArrayBuffer(e),this.filterArray=new Uint8Array(this.filterBuffer),this.dimensions=[],this.name=t.name,this.textDecoder=new TextDecoder,this.columnGroups={},this.subtypeToGroup={},this.subgroups={},this.subgroupDataSources=new Set,this.accessOtherDataStore=[],this.syncColumnColors=[],this.linkColumns=[],this.columnsWithData=[],this.dirtyColumns={added:{},removed:{},data_changed:{},colors_changed:{}},this.dirtyMetadata=new Set,t.offsets&&(t.offsets.values=t.offsets.values||{},this.offsets=t.offsets),this.images=t.images,this.genome_browser=t.genome_browser,t.columns)for(let r of t.columns)this.addColumn(r,r.data);if(t.columnGroups)for(let r of t.columnGroups)this.addColumnGroup(r);if(t.large_images&&(this.large_images=t.large_images),t.links){this.links=t.links;for(let r in t.links){const s=t.links[r];if(s.rows_as_columns){const o=s.rows_as_columns.subgroups;this.subgroupDataSources.add(r);for(let a in o)this.subgroups[a]={subgroup:o[a],dataSource:r,name_column:s.rows_as_columns.name_column}}s.access_data&&this.accessOtherDataStore.push({dataSource:r,index:s.index}),s.sync_column_colors&&this.syncColumnColors.push({dataSource:r,columns:s.sync_column_colors}),s.columns&&this.linkColumns.push({dataSource:r,columns:s.columns})}}}isFiltered(){return this.filterSize!==this.size}addListener(e,t){this.listeners[e]=t}removeListener(e){delete this.listeners[e]}_callListeners(e,t){for(let r in this.listeners)this.listeners[r](e,t)}removeAllFilters(){this.filterArray.fill(0);let e=[];for(let t of this.dimensions){if(t.noclear){e.push(t);continue}if(t.filterArray.fill(0),t.filterMethod=null,t.bgfArray)for(let r=0;r<this.size;r++)t.bgfArray[r]===0&&(t.filterArray[r]=2)}this.filterSize=this.size;for(let t of e){const r=t.filterArray;for(let s=0;s<r.length;s++)r[s]===1&&++this.filterArray[s]===1&&this.filterSize--}this._callListeners("filtered","all_removed")}dataChanged(e,t=!0){let r=!1;for(let s of this.dimensions)s.reFilterOnDataChanged(e)&&(r=!0);if(t)for(let s of e)this.setColumnIsDirty(s);r&&this._callListeners("filtered"),this._callListeners("data_changed",{columns:e,hasFiltered:r})}dataHighlighted(e,t){this.highightedData=e,this._callListeners("data_highlighted",{indexes:e,source:t})}getHighlightedData(){return this.highightedData}triggerFilter(){this._callListeners("filtered")}setColumnIsDirty(e){this.dirtyColumns.added[e]||(this.dirtyColumns.data_changed[e]=!0)}setAllColumnsClean(){this.dirtyColumns.added={},this.dirtyColumns.removed={},this.dirtyColumns.data_changed={},this.dirtyColumns.colors_changed={},this.dirtyMetadata.clear()}getFilter(){return this.filterArray}isRowFiltered(e){return this.filterArray[e]===0}_calculateCategories(e){let t=e.values,r=e.data;for(let s of t);for(let s=0;s<r.length;s++)t[r[s]]}addColumn(e,t=null,r=!1){let s={name:e.name,field:e.field,datatype:e.datatype};s.field||(s.field=e.name),e.colors&&(s.colors=e.colors),e.editable&&(s.editable=!0),e.is_url&&(s.is_url=!0),e.subgroup&&(s.subgroup=e.subgroup,s.sgindex=e.sgindex,s.sgtype=e.sgtype),e.datatype==="text"||e.datatype==="multitext"?(s.stringLength=e.stringLength,s.values=e.values||[`Error: no values for '${s.name}'`]):e.datatype==="double"||e.datatype==="integer"||e.datatype==="int32"?(s.colorLogScale=e.colorLogScale,s.minMax=e.minMax,s.quantiles=e.quantiles):s.stringLength=e.stringLength,this.columns.push(s),this.columnIndex[s.field]=s,t&&this.setColumnData(e.field,t),r&&(this.dirtyColumns.added[e.field]=!0)}getSuggestedValues(e,t,r=10){const s=this.columnIndex[t],o=e.toLowerCase(),a=e.toUpperCase(),l=[];if(s.datatype==="unique"){const u=new TextEncoder,p=u.encode(o),d=u.encode(a),m=e.length,g=s.data,w=s.stringLength;for(let E=0;E<g.length-m;E++){let A=!0;for(let k=0;k<m;k++)if(p[k]!=g[E+k]&&d[k]!=g[E+k]){A=!1;break}if(A){const k=Math.floor(E/w),O=this.textDecoder.decode(s.data.slice(k*w,k*w+w)).replaceAll("\0","");if(l.push({value:O,index:k}),l.length>r)break}}}else if(s.datatype==="text"||s.datatype==="multitext"){const u=e.length;for(let p=0;p<s.values.length;p++){const d=s.values[p];for(let m=0;m<d.length-u;m++){let g=!0;for(let w=m;w<m<u;w++)if(e[m]!==o[w]&&e[m]!==a){g=!1;break}if(g)break}l.push({value:d,index:p})}}return l}addColumnFromField(e){const t=e.split("|");let r=this.subtypeToGroup[t[0]],s=null;r?s=r.subgroups[t[0]]:(r=this.subgroups[t[0]],s=r.subgroup),this.columnIndex[e]||this.addColumn({name:t[1],field:e,datatype:"double",subgroup:s.name,sgindex:t[2],sgtype:s.type})}getColumnList(e=null,t=!1){const r=[],s={},o=Object.keys(this.subgroups).map(p=>(s[p]=[],p)),a=Array.isArray(e),l=o.length!==0;for(let p in this.columnIndex){const d=this.columnIndex[p];if(e){if(a){if(e.indexOf(d.datatype)===-1)continue}else if(e==="number"){if(d.datatype==="text"||d.datatype==="unique"||d.datatype==="multitext")continue}else if(e!=="all"&&e!==d.datatype)continue}if(l){let m=!1;for(let g of o)if(d.field.startsWith(`${g}|`)){const w=this.subgroups[g];s[g].push({name:d.name,field:d.field,datatype:d.datatype,subgroup:{dataSource:w.dataSource,name_column:w.name_column}}),m=!0;break}if(m)continue}r.push({name:d.name,field:d.field,datatype:d.datatype})}let u=r.sort((p,d)=>p.name.localeCompare(d.name));if(l)for(let p in s)s[p].sort((d,m)=>d.name.localeCompare(m.name)),u=u.concat(s[p]);return t&&u.push({name:"None",field:"__none__"}),u}getDimension(e){if(!Dimension.types[e])throw`Adding non existent Dimension: ${e}`;const t=new Dimension.types[e](this);return this.dimensions.push(t),t}getRowAsObject(e,t){t||(t=this.columnsWithData);const r={};for(let s of t){const o=this.columnIndex[s];let a=o.data[e];if(o.datatype==="text")a=o.values[a];else if(o.datatype==="double"||o.datatype==="integer"||o.datatype==="int32")isNaN(a)&&(a="missing");else if(o.datatype=="multitext"){const l=o.data.slice(e*o.stringLength,e*o.stringLength+o.stringLength);a=Array.from(l.filter(u=>u!=65535)).map(u=>o.values[u]).join(", ")}else a=this.textDecoder.decode(o.data.slice(e*o.stringLength,e*o.stringLength+o.stringLength)),a=a.replaceAll("\0","");r[s]=a}return r.__index__=e,r}getFirstFilteredIndex(){for(let e=0;e<this.size;e++)if(this.filterArray[e]===0)return e}getFilteredValues(e){const t=new Array(this.filterSize);let r=0;for(let s=0;s<this.size;s++)this.filterArray[s]===0&&(t[r]=this.getRowText(s,e),r++);return t}getRowText(e,t){return this.getRowAsObject(e,[t])[t]}setColumnOffset(e,t){if(!this.offsets)throw new Error("Attempting to set offsets but none are specified in config");e.filter=e.filter||"all";const r=this.offsets.values;let s=r[e.filter];s||(s={},r[e.filter]=s);let o=s[e.group];o||(o={offsets:[0,0],rotation:0},s[e.group]=o),this.updateColumnOffsets(e,e.rotation,t),this.dirtyMetadata.add("offsets")}_getRotationOrigin(e,t,r){const s=this.offsets,o=this.columnIndex[e],a=o.values.indexOf(t),l=o.data,u=this.columnIndex[s.param[0]],p=this.columnIndex[s.param[1]];let d=null,m=null;s.background_filter&&(m=this.columnIndex[s.background_filter],d=m.values.indexOf(r));let g=[Number.MAX_VALUE,Number.MIN_VALUE],w=[Number.MAX_VALUE,Number.MIN_VALUE];for(let A=0;A<this.size;A++)m&&m.data[A]!==d||l[A]===a&&(g[0]=Math.min(g[0],u.originalData[A]),g[1]=Math.max(g[1],u.originalData[A]),w[0]=Math.min(w[0],p.originalData[A]),w[1]=Math.max(w[1],p.originalData[A]));const E=A=>A[0]+(A[1]-A[0])/2;return[E(g),E(w)]}initiateOffsets(){const e=this.offsets,t=this.columnIndex[e.param[0]],r=this.columnIndex[e.param[1]];t.originalData=new Float32Array(t.data),r.originalData=new Float32Array(r.data)}_getOffsetValues(e,t){const r=this.offsets;let s=null,o=null;if(r.background_filter){const u=this.columnIndex[r.background_filter];s=u.data,o=u.values}const a=this.columnIndex[r.groups],l=[];for(let u in r.values)if(!(e&&u!==e.filter))for(let p in r.values[u]){if(e&&p!==e.group)continue;let d=r.values[u][p];const m={index:a.values.indexOf(p)};if(u!=="all"&&(m.filterData=s,m.filterValue=o.indexOf(u)),t&&(d.rotation_center||(d.rotation_center=this._getRotationOrigin(r.groups,p,u)),m.rotation_center=[d.rotation_center[0]+d.offsets[0],d.rotation_center[1]+d.offsets[1]]),e?t?(m.rotation=e.rotation,d.rotation+=e.rotation):(d.offsets[0]+=e.offsets[0],d.offsets[1]+=e.offsets[1],m.offsets=e.offsets):t?m.rotation=d.rotation:m.offsets=d.offsets,t){const g=Math.PI/180*m.rotation;m.cos=Math.cos(g),m.sin=Math.sin(g)}l.push(m)}return l}resetColumnOffsets(e,t,r){e=e||"all";const s=this.offsets;if(!s)throw new Error("Attempting to reset offsets but none are specified in config");delete this.offsets.values[e][t];let o=null,a=null;e!=="all"&&(o=this.columnIndex[this.offsets.background_filter],a=o.values.indexOf(e));const l=this.getColumnValues(s.groups).indexOf(t),u=this.columnIndex[s.groups].data,p=this.columnIndex[s.param[0]],d=this.columnIndex[s.param[1]];for(let m=0;m<this.size;m++)o&&o[m]!==a||u[m]===l&&(d.data[m]=d.originalData[m],p.data[m]=p.originalData[m]);r&&this.dataChanged([s.param[0],s.param[1]],!1),this.dirtyMetadata.add("offsets")}updateColumnOffsets(e,t=!1,r=!1){const s=this.offsets,a=this.columnIndex[s.groups].data,l=this.columnIndex[s.param[0]],u=this.columnIndex[s.param[1]],p=this._getOffsetValues(e,t);for(let d=0;d<this.size;d++)for(let m of p)if(!(m.filterData&&m.filterData[d]!==m.filterValue)&&a[d]===m.index)if(t){let g=m.rotation_center[0],w=m.rotation_center[1],E=m.cos*(l.data[d]-g)+m.sin*(u.data[d]-w)+g,A=m.cos*(u.data[d]-w)-m.sin*(l.data[d]-g)+w;l.data[d]=E,u.data[d]=A}else l.data[d]=l.data[d]+m.offsets[0],u.data[d]=u.data[d]+m.offsets[1];r&&this.dataChanged([s.param[0],s.param[1]],!1)}getColumnIndex(e){if(this.indexes[e])return this.indexes[e];const t=this.columnIndex[e],r={};if(t.datatype==="unique")for(let s=0;s<this.size;s++){let o=this.textDecoder.decode(t.data.slice(s*t.stringLength,s*t.stringLength+t.stringLength)).replaceAll("\0","");o.includes("#")&&(o=o.split("#")[1]),r[o]=s}else for(let s=0;s<this.size;s++)r[t.values[t.data[s]]]=s;return this.indexes[e]=r,r}getDataAsBlob(e,t="all",r="	",s=`
`){let o=null;typeof t!="string"&&(o=t);const a=[],l=["index"].concat(e);for(let p of e){const d=this.columnIndex[p];l.push(d.name)}const u=o?o.length:this.size;a.push(l.join(r));for(let p=0;p<u;p++){let d=p;if(o)d=o[p];else if(t==="filtered"&&this.filterArray[p]===1)continue;const m=this.getRowAsObject(d,e),g=[p].concat(e.map(w=>m[w]));a.push(g.join(r))}return new Blob([a.join(s)],{type:"text/plain"})}setColumnData(e,t){let r=this.columnIndex[e];if(!r)throw`column ${e} is not present in data store`;let s=null;if(Array.isArray(t)?s=this._convertColumn(r,t):s=t,r.buffer=s,r.datatype==="integer"||r.datatype=="double"||r.datatype==="int32"){const o=r.data=r.datatype==="int32"?new Int32Array(s):new Float32Array(s);if(!r.minMax){let a=Number.MAX_VALUE,l=Number.MIN_VALUE;for(let u=0;u<o.length;u++){let p=o[u];isNaN(p)||(a=p<a?p:a,l=p>l?p:l)}r.minMax=[a,l]}if(!r.quantiles){const a=r.data.filter(l=>!isNaN(l)).sort();r.quantiles={};for(let l of[.05,.01,.001])r.quantiles[l]=[quantileSorted(a,l),quantileSorted(a,1-l)]}}else r.datatype==="multitext"?r.data=new Uint16Array(s):r.data=new Uint8Array(s);this.columnsWithData.push(e)}appendColumnData(e,t,r){let s=this.columnIndex[e],o=Uint8Array,a=r;s.datatype==="integer"||s.datatype==="double"?(a=a*4,o=Float32Array):s.datatype==="int32"?(a=a*4,o=Int32Array):s.datatype==="unique"&&(a=a*s.stringLength);let l=new SharedArrayBuffer(a),u=new o(l);u.set(s.data),u.set(new o(t),s.data.length),s.data=u,s.buffer=l}addDataToStore(e,t){const r=t+this.size;for(let a of e)this.appendColumnData(a.column,a.data,r);let s=new SharedArrayBuffer(r),o=new Uint8Array(s);o.set(this.filterArray),this.filterBuffer=s,this.filterArray=o,this.size=r,this.filterSize+=t;for(let a of this.dimensions)a.updateSize();this._callListeners("data_added",this.size)}cleanColumnData(e){const t={},r=this.columnIndex[e];for(let a in r.values)t[a]=0;for(let a=0;a<this.size;a++)t[r.data[a]]++;const s=[],o={};for(let a=0;a<r.values.length;a++)t[a]!==0&&(s.push(r.values[a]),o[a]=s.length-1);for(let a=0;a<this.size;a++)r.data[a]=o[r.data[a]];r.values=s,this.setColumnIsDirty(e),this.dataChanged([e])}_convertColumn(e,t){const r=t.length;if(e.datatype==="text"){const s=new SharedArrayBuffer(this.size),o={};for(let p=0;p<r;p++){const d=t[p];o[d]===void 0?o[d]=1:o[d]++}const a=[];for(let p in o)a.push([p,o[p]]);e.values=[];const l={};a.sort((p,d)=>d[1]-p[1]);for(let p=0;p<a.length;p++)e.values.push(a[p][0]),l[a[p][0]]=p;const u=new Uint8Array(s);for(let p=0;p<r;p++)u[p]=l[t[p]];return s}else if(e.datatype==="integer"||e.datatype==="double"||e.datatype==="int32"){const s=new SharedArrayBuffer(this.size*4),o=e.datatype==="int32"?new Int32Array(s):new Float32Array(s);for(let a=0;a<r;a++)o[a]=t[a];return s}else if(e.datatype==="multitext"){let s=new Set,o=0;for(let m=0;m<r;m++){const w=t[m].split(",");o=Math.max(o,w.length),w.forEach(E=>s.add(E.trim()))}s.delete("");const a=new SharedArrayBuffer(this.size*o*2),l=new Uint16Array(a);l.fill(65535);const u=new Array(s.size),p={};let d=0;for(let m of s)p[m]=d,u[d]=m,d++;for(let m=0;m<r;m++){const g=m*o,w=t[m];if(w==="")continue;const E=w.split(",");E.sort();for(let A=0;A<E.length;A++)l[g+A]=p[E[A].trim()]}return e.values=u,e.stringLength=o,a}else{let s=0;for(let l=0;l<r;l++)s=Math.max(s,t[l].length);e.stringLength=s;const o=new TextEncoder,a=new SharedArrayBuffer(this.size*s);for(let l=0;l<r;l++){const u=o.encode(t[l].substring(0,s));new Uint8Array(a,l*s,s).set(u,0)}return a}}getColorFunction(e,t={}){const r=this.columnIndex[e],s=r.data,o=t.overideValues||{};let a=this.getColumnColors(e,t);if(r.datatype==="text")return l=>a[s[l]];if(r.datatype==="integer"||r.datatype==="double"||r.datatype==="int32"){const l=o.min==null?r.minMax[0]:o.min,u=o.max==null?r.minMax[1]:o.max,p=t.bins||100,d=(u-l)/p,m=t.asArray?[255,255,255]:"#ffffff";return t.useValue?g=>{if(isNaN(g))return m;let w=Math.floor((g-l)/d);return w<0?w=0:w>=a.length&&(w=a.length-1),a[w]}:g=>{const w=s[g];if(isNaN(w))return m;let E=Math.floor((w-l)/d);return E<0?E=0:E>=a.length&&(E=a.length-1),a[E]}}}getColorForCategory(e,t){const s=this.columnIndex[e].values.indexOf(t);return this.getColumnColors(e)[s]}getColorLegend(e,t={}){const r=this.getColumnColors(e,t),s=this.columnIndex[e],o=t.name||s.name;if(s.datatype==="integer"||s.datatype==="double"||s.datatype==="int32"){let a=s.minMaX;if(t.overideValues){const l=t.overideValues;a=[l.min==null?s.minMax[0]:l.min,l.max==null?s.minMax[1]:l.max]}return getColorBar(r,{range:a,label:o})}if(s.datatype==="text")return getColorLegend(r,s.values,{label:o})}getValueToColor(e){const t={},r=this.getColumnColors(e),s=this.getColumnValues(e);for(let o=0;o<s.length;o++)t[s[o]]=r[o];return t}getColumnQuantile(e,t){const r=this.columnIndex[e];if(t&&t!=="none"){if(r.quantiles&&r.quantiles!=="NA")return[r.quantiles[t][0],r.quantiles[t][1]]}else return r.minMax}setColumnColors(e,t,r=!1){const s=this.columnIndex[e];if(t.length!==s.values.length)throw new Error(`${e} being set with incorrect number of columns `);s.colors=t.slice(0),this.dirtyColumns.colors_changed[e]=!0,r&&this.dataChanged([e],!1)}getColumnColors(e,t={}){const r=this.columnIndex[e],s=t.asArray;if(r.datatype==="double"||r.datatype==="integer"||r.datattype==="int32"){const o=t.overideValues||{},a=o.colors||r.colors||defaultIPalette,l=o.min||r.minMax[0],u=o.max||r.minMax[1],p=linspace(l,u,a.length),d=linear$1().domain(p).range(a).clamp(!0),m=t.bins||100,g=(u-l)/m;let w=new Array(m+1);for(let A=0;A<m+1;A++)w[A]=d(l+A*g),s&&(w[A]=rgbToRGB(w[A]));let E=r.colorLogScale;if(o.colorLogScale!=null&&(E=o.colorLogScale),E){const A=symlog().domain([l,u]).range([0,m]).clamp(!0),k=new Array(m+1);for(let O=0;O<m+1;O++)k[O]=w[Math.floor(A(l+O*g))];w=k}return w}else if(r.datatype==="text"||r.datatype==="multitext"){let o=r.colors;if(!o){const a=r.values.length,l=defaultPalette.length;if(a<l)o=defaultPalette.slice(0,a);else{o=[];const u=Math.floor(a/l);for(let p=0;p<u;p++)o=o.concat(defaultPalette);o=o.concat(defaultPalette.slice(0,a%l))}}return s&&(o=o.map(a=>hexToRGB(a))),o}}addColumnGroup(e){e.columns||(e.columns=[]),this.columnGroups[e.name]=e}getColumnGroup(e){const t=this.columnGroups[e];return t?t.columns:null}getRawColumn(e){return this.columnIndex[e].data}getMinMaxForColumn(e){return this.columnIndex[e].minMax}getColumnRange(e){const t=this.columnIndex[e];return t.minMax?t.minMax[1]-t.minMax[0]:(console.error("unknown minMax for column "+e),[0,50])}getColumnInfo(e){const t=this.columnIndex[e];return{name:t.name,field:t.field,datatype:t.datatype,stringLength:t.stringLength,subgroup:t.subgroup,sgindex:t.sgindex,sgtype:t.sgtype}}getLoadedColumns(){return this.columns.filter(e=>e.data!=null).map(e=>e.field)}getAllColumns(){return this.columns.map(e=>e.field)}getColumnValues(e){return this.columnIndex[e].values}getColumnName(e){const t=this.columnIndex[e];return t?t.name:null}removeColumn(e,t=!1,r=!1){const s=this.columnIndex[e];s.data=null,s.buffer=null,this.columns=this.columns.filter(a=>a.field!==e),delete this.columnIndex[e];const o=this.columnsWithData.indexOf(e);o!==-1&&this.columnsWithData.splice(o,1),t&&(this.dirtyColumns.added[e]?delete this.dirtyColumns.added[e]:this.dirtyColumns.removed[e]=!0),r&&this._callListeners("column_removed",e)}}function linspace(i,e,t){for(var r=[],s=(e-i)/(t-1),o=0;o<t-1;)r.push(i+o*s),o++;return r.push(e),r}function hexToRGB(i){i=i.replace("#","");var e=parseInt(i,16),t=e>>16&255,r=e>>8&255,s=e&255;return[t,r,s]}function RGBToHex(i){return"#"+i.map(e=>{const t=e.toString(16);return t.length===1?"0"+t:t}).join("")}function rgbToRGB(i){return i?(i=i.substring(4,i.length-1).split(", "),i.map(e=>parseInt(e))):[255,255,255]}const defaultPalette=["#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#1CE6FF","#FF34FF","#FF4A46","#008941","#676FA6","#A30059","#FFDBE5","#7A4900","#0000A6","#63FFAC","#B79762","#004D43","#8FB0FF","#997D87","#5A0007","#809693","#FEFFE6","#1B4400","#4FC601","#3B5DFF","#4A3B53","#FF2F80","#61615A","#BA0900","#6B7900","#00C2A0","#FFAA92","#FF90C9","#B903AA","#D16100","#DDEFFF","#000035","#7B4F4B","#A1C299","#300018","#0AA6D8","#013349","#00846F","#372101","#FFB500","#C2FFED","#A079BF","#CC0744","#C0B9B2","#C2FF99","#001E09","#00489C","#6F0062","#0CBD66","#EEC3FF","#456D75","#B77B68","#7A87A1","#788D66","#885578","#FAD09F","#FF8A9A","#D157A0","#BEC459","#456648","#0086ED","#886F4C","#34362D","#B4A8BD","#00A6AA","#452C2C","#636375","#A3C8C9","#FF913F","#938A81","#575329","#00FECF","#B05B6F","#8CD0FF","#3B9700","#04F757","#C8A1A1","#1E6E00","#7900D7","#A77500","#6367A9","#A05837","#6B002C","#772600","#D790FF","#9B9700","#549E79","#FFF69F","#201625","#72418F","#BC23FF","#99ADC0","#3A2465","#922329","#5B4534","#FDE8DC"],defaultIPalette=["#3288bd","#66c2a5","#abdda4","#e6f598","#fee08b","#fdae61","#f46d43","#d53e4f"];class CustomDialog extends BaseDialog{constructor(e){e.buttons&&(e.footer=!0,e._buttons=e.buttons,delete e.buttons),e.width=e.width||300,super(e,e)}init(e){if(this.controlValues={},this.controls={},e._buttons)for(let t of e._buttons)this.addButton(t);if(e.text){const t=createEl("div",{},this.dialog);t.innerHTML=e.text}if(e.controls)for(let t of e.controls){t.id||(t.id=t.label);let r=createEl("div",{styles:{padding:"5px"}},this.dialog);if(t.type!=="button"){const s=t.type==="checkbox"?"inline":"block";createEl("label",{text:t.label,styles:{fontWeight:"bold",display:s,marginBottom:"3px"}},r)}this[t.type](t,r),t.description&&createEl("div",{text:t.description,styles:{fontSize:"12px"}},r)}}radiobuttons(e,t){const r=createEl("div",{},t);this.controlValues[e.id]=e.current_value;for(let s of e.choices){createEl("span",{text:s[0]},r);const o=createEl("input",{type:"radio",name:e.label,value:s[1]},r);o.checked=e.current_value===s[1],o.addEventListener("click",a=>{const l=a.currentTarget.value;this.controlValues[e.id]=l,e.func&&e.func(l,this)})}}slider(e,t){const r=createEl("div",{},t);noUiSlider.create(r,{start:[e.current_value],range:{min:[e.min],max:[e.max]},step:e.step||null,tooltips:!0,documentElement:e.doc||document}),this.controlValues[e.id]=e.current_value,r.noUiSlider.on("end",s=>{const o=parseFloat(s[0]);this.controlValues[e.id]=o,e.func&&e.func(o)})}changeDropDownContent(e,t){const r=this.controls[e];for(;r.length!==0;)r.remove(0);for(let s of t)createEl("option",{text:s.text,value:s.value},r);this.controlValues[e]=r.value}dropdown(e,t){const r=createEl("select",{styles:{maxWidth:"200px"}});for(let s of e.items)createEl("option",{text:s.text,value:s.value},r);t.append(r),e.current_value&&(r.value=e.current_value),this.controlValues[e.id]=r.value,r.addEventListener("change",s=>{this.controlValues[e.id]=r.value,e.func&&e.func(r.value,this)}),this.controls[e.id]=r}checkboxgroup(e,t){const r=this,s=createEl("div",{},t);function o(l,u){createEl("button",{text:l,classes:["ciview-button-sm"]},s).addEventListener("click",()=>{for(let d of e.checkboxes)r.controls[d.id].checked=u,r.controlValues[d.id]=u})}o("Check All",!0),o("Uncheck All",!1);const a=createEl("div",{},t);for(let l of e.checkboxes){const u=createEl("div",{styles:{display:"inline-block",padding:"3px"}},a);createEl("span",{styles:{fontSize:"13px"},text:l.label},u),l.id=`${e.id}_${l.id}`,this.checkbox(l,u)}}checkbox(e,t){const r=e.current_value,s=createEl("input",{type:"checkbox",classes:["mdv-checkbox"]},t);s.checked=e.current_value,this.controlValues[e.id]=r,s.addEventListener("click",o=>{this.controlValues[e.id]=s.checked,e.func&&e.func(s.checked)}),this.controls[e.id]=s}text(e,t){const r=e.defaultValue||"",s=createEl("input",{value:r},t);this.controlValues[e.id]=r,s.addEventListener("keyup",()=>{this.controlValues[e.id]=s.value}),this.controls[e.id]=s}buttonClicked(e){e.method(this.controlValues,this.controls)!=="noclose"&&this.close()}addButton(e){createEl("button",{text:e.text,classes:["ciview-button"]},this.footer).addEventListener("click",()=>this.buttonClicked(e))}}const linear=i=>+i;function cubicInOut(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var noop$1={value:()=>{}};function dispatch(){for(var i=0,e=arguments.length,t={},r;i<e;++i){if(!(r=arguments[i]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new Dispatch(t)}function Dispatch(i){this._=i}function parseTypenames(i,e){return i.trim().split(/^|\s+/).map(function(t){var r="",s=t.indexOf(".");if(s>=0&&(r=t.slice(s+1),t=t.slice(0,s)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}Dispatch.prototype=dispatch.prototype={constructor:Dispatch,on:function(i,e){var t=this._,r=parseTypenames(i+"",t),s,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((s=(i=r[o]).type)&&(s=get$1(t[s],i.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<a;)if(s=(i=r[o]).type)t[s]=set$1(t[s],i.name,e);else if(e==null)for(s in t)t[s]=set$1(t[s],i.name,null);return this},copy:function(){var i={},e=this._;for(var t in e)i[t]=e[t].slice();return new Dispatch(i)},call:function(i,e){if((s=arguments.length-2)>0)for(var t=new Array(s),r=0,s,o;r<s;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(o=this._[i],r=0,s=o.length;r<s;++r)o[r].value.apply(e,t)},apply:function(i,e,t){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var r=this._[i],s=0,o=r.length;s<o;++s)r[s].value.apply(e,t)}};function get$1(i,e){for(var t=0,r=i.length,s;t<r;++t)if((s=i[t]).name===e)return s.value}function set$1(i,e,t){for(var r=0,s=i.length;r<s;++r)if(i[r].name===e){i[r]=noop$1,i=i.slice(0,r).concat(i.slice(r+1));break}return t!=null&&i.push({name:e,value:t}),i}var frame=0,timeout$1=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance=="object"&&performance.now?performance:Date,setFrame=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function(i,e,t){if(typeof i!="function")throw new TypeError("callback is not a function");t=(t==null?now():+t)+(e==null?0:+e),!this._next&&taskTail!==this&&(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=i,this._time=t,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};function timer(i,e,t){var r=new Timer;return r.restart(i,e,t),r}function timerFlush(){now(),++frame;for(var i=taskHead,e;i;)(e=clockNow-i._time)>=0&&i._call.call(void 0,e),i=i._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout$1=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var i=clock.now(),e=i-clockLast;e>pokeDelay&&(clockSkew-=e,clockLast=i)}function nap(){for(var i,e=taskHead,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),i=e,e=e._next):(t=e._next,e._next=null,e=i?i._next=t:taskHead=t);taskTail=i,sleep(r)}function sleep(i){if(!frame){timeout$1&&(timeout$1=clearTimeout(timeout$1));var e=i-clockNow;e>24?(i<1/0&&(timeout$1=setTimeout(wake,i-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake))}}function timeout(i,e,t){var r=new Timer;return e=e==null?0:+e,r.restart(s=>{r.stop(),i(s+e)},e,t),r}var emptyOn=dispatch("start","end","cancel","interrupt"),emptyTween=[],CREATED=0,SCHEDULED=1,STARTING=2,STARTED=3,RUNNING=4,ENDING=5,ENDED=6;function schedule(i,e,t,r,s,o){var a=i.__transition;if(!a)i.__transition={};else if(t in a)return;create(i,t,{name:e,index:r,group:s,on:emptyOn,tween:emptyTween,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:CREATED})}function init(i,e){var t=get(i,e);if(t.state>CREATED)throw new Error("too late; already scheduled");return t}function set(i,e){var t=get(i,e);if(t.state>STARTED)throw new Error("too late; already running");return t}function get(i,e){var t=i.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function create(i,e,t){var r=i.__transition,s;r[e]=t,t.timer=timer(o,0,t.time);function o(p){t.state=SCHEDULED,t.timer.restart(a,t.delay,t.time),t.delay<=p&&a(p-t.delay)}function a(p){var d,m,g,w;if(t.state!==SCHEDULED)return u();for(d in r)if(w=r[d],w.name===t.name){if(w.state===STARTED)return timeout(a);w.state===RUNNING?(w.state=ENDED,w.timer.stop(),w.on.call("interrupt",i,i.__data__,w.index,w.group),delete r[d]):+d<e&&(w.state=ENDED,w.timer.stop(),w.on.call("cancel",i,i.__data__,w.index,w.group),delete r[d])}if(timeout(function(){t.state===STARTED&&(t.state=RUNNING,t.timer.restart(l,t.delay,t.time),l(p))}),t.state=STARTING,t.on.call("start",i,i.__data__,t.index,t.group),t.state===STARTING){for(t.state=STARTED,s=new Array(g=t.tween.length),d=0,m=-1;d<g;++d)(w=t.tween[d].value.call(i,i.__data__,t.index,t.group))&&(s[++m]=w);s.length=m+1}}function l(p){for(var d=p<t.duration?t.ease.call(null,p/t.duration):(t.timer.restart(u),t.state=ENDING,1),m=-1,g=s.length;++m<g;)s[m].call(i,d);t.state===ENDING&&(t.on.call("end",i,i.__data__,t.index,t.group),u())}function u(){t.state=ENDED,t.timer.stop(),delete r[e];for(var p in r)return;delete i.__transition}}function interrupt(i,e){var t=i.__transition,r,s,o=!0,a;if(t){e=e==null?null:e+"";for(a in t){if((r=t[a]).name!==e){o=!1;continue}s=r.state>STARTING&&r.state<ENDING,r.state=ENDED,r.timer.stop(),r.on.call(s?"interrupt":"cancel",i,i.__data__,r.index,r.group),delete t[a]}o&&delete i.__transition}}function selection_interrupt(i){return this.each(function(){interrupt(this,i)})}function tweenRemove(i,e){var t,r;return function(){var s=set(this,i),o=s.tween;if(o!==t){r=t=o;for(var a=0,l=r.length;a<l;++a)if(r[a].name===e){r=r.slice(),r.splice(a,1);break}}s.tween=r}}function tweenFunction(i,e,t){var r,s;if(typeof t!="function")throw new Error;return function(){var o=set(this,i),a=o.tween;if(a!==r){s=(r=a).slice();for(var l={name:e,value:t},u=0,p=s.length;u<p;++u)if(s[u].name===e){s[u]=l;break}u===p&&s.push(l)}o.tween=s}}function transition_tween(i,e){var t=this._id;if(i+="",arguments.length<2){for(var r=get(this.node(),t).tween,s=0,o=r.length,a;s<o;++s)if((a=r[s]).name===i)return a.value;return null}return this.each((e==null?tweenRemove:tweenFunction)(t,i,e))}function tweenValue(i,e,t){var r=i._id;return i.each(function(){var s=set(this,r);(s.value||(s.value={}))[e]=t.apply(this,arguments)}),function(s){return get(s,r).value[e]}}function interpolate(i,e){var t;return(typeof e=="number"?interpolateNumber:e instanceof color?interpolateRgb:(t=color(e))?(e=t,interpolateRgb):interpolateString)(i,e)}function attrRemove(i){return function(){this.removeAttribute(i)}}function attrRemoveNS(i){return function(){this.removeAttributeNS(i.space,i.local)}}function attrConstant(i,e,t){var r,s=t+"",o;return function(){var a=this.getAttribute(i);return a===s?null:a===r?o:o=e(r=a,t)}}function attrConstantNS(i,e,t){var r,s=t+"",o;return function(){var a=this.getAttributeNS(i.space,i.local);return a===s?null:a===r?o:o=e(r=a,t)}}function attrFunction(i,e,t){var r,s,o;return function(){var a,l=t(this),u;return l==null?void this.removeAttribute(i):(a=this.getAttribute(i),u=l+"",a===u?null:a===r&&u===s?o:(s=u,o=e(r=a,l)))}}function attrFunctionNS(i,e,t){var r,s,o;return function(){var a,l=t(this),u;return l==null?void this.removeAttributeNS(i.space,i.local):(a=this.getAttributeNS(i.space,i.local),u=l+"",a===u?null:a===r&&u===s?o:(s=u,o=e(r=a,l)))}}function transition_attr(i,e){var t=namespace(i),r=t==="transform"?interpolateTransformSvg:interpolate;return this.attrTween(i,typeof e=="function"?(t.local?attrFunctionNS:attrFunction)(t,r,tweenValue(this,"attr."+i,e)):e==null?(t.local?attrRemoveNS:attrRemove)(t):(t.local?attrConstantNS:attrConstant)(t,r,e))}function attrInterpolate(i,e){return function(t){this.setAttribute(i,e.call(this,t))}}function attrInterpolateNS(i,e){return function(t){this.setAttributeNS(i.space,i.local,e.call(this,t))}}function attrTweenNS(i,e){var t,r;function s(){var o=e.apply(this,arguments);return o!==r&&(t=(r=o)&&attrInterpolateNS(i,o)),t}return s._value=e,s}function attrTween(i,e){var t,r;function s(){var o=e.apply(this,arguments);return o!==r&&(t=(r=o)&&attrInterpolate(i,o)),t}return s._value=e,s}function transition_attrTween(i,e){var t="attr."+i;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=namespace(i);return this.tween(t,(r.local?attrTweenNS:attrTween)(r,e))}function delayFunction(i,e){return function(){init(this,i).delay=+e.apply(this,arguments)}}function delayConstant(i,e){return e=+e,function(){init(this,i).delay=e}}function transition_delay(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?delayFunction:delayConstant)(e,i)):get(this.node(),e).delay}function durationFunction(i,e){return function(){set(this,i).duration=+e.apply(this,arguments)}}function durationConstant(i,e){return e=+e,function(){set(this,i).duration=e}}function transition_duration(i){var e=this._id;return arguments.length?this.each((typeof i=="function"?durationFunction:durationConstant)(e,i)):get(this.node(),e).duration}function easeConstant(i,e){if(typeof e!="function")throw new Error;return function(){set(this,i).ease=e}}function transition_ease(i){var e=this._id;return arguments.length?this.each(easeConstant(e,i)):get(this.node(),e).ease}function easeVarying(i,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;set(this,i).ease=t}}function transition_easeVarying(i){if(typeof i!="function")throw new Error;return this.each(easeVarying(this._id,i))}function transition_filter(i){typeof i!="function"&&(i=matcher(i));for(var e=this._groups,t=e.length,r=new Array(t),s=0;s<t;++s)for(var o=e[s],a=o.length,l=r[s]=[],u,p=0;p<a;++p)(u=o[p])&&i.call(u,u.__data__,p,o)&&l.push(u);return new Transition(r,this._parents,this._name,this._id)}function transition_merge(i){if(i._id!==this._id)throw new Error;for(var e=this._groups,t=i._groups,r=e.length,s=t.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var u=e[l],p=t[l],d=u.length,m=a[l]=new Array(d),g,w=0;w<d;++w)(g=u[w]||p[w])&&(m[w]=g);for(;l<r;++l)a[l]=e[l];return new Transition(a,this._parents,this._name,this._id)}function start(i){return(i+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function onFunction(i,e,t){var r,s,o=start(e)?init:set;return function(){var a=o(this,i),l=a.on;l!==r&&(s=(r=l).copy()).on(e,t),a.on=s}}function transition_on(i,e){var t=this._id;return arguments.length<2?get(this.node(),t).on.on(i):this.each(onFunction(t,i,e))}function removeFunction(i){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==i)return;e&&e.removeChild(this)}}function transition_remove(){return this.on("end.remove",removeFunction(this._id))}function transition_select(i){var e=this._name,t=this._id;typeof i!="function"&&(i=selector(i));for(var r=this._groups,s=r.length,o=new Array(s),a=0;a<s;++a)for(var l=r[a],u=l.length,p=o[a]=new Array(u),d,m,g=0;g<u;++g)(d=l[g])&&(m=i.call(d,d.__data__,g,l))&&("__data__"in d&&(m.__data__=d.__data__),p[g]=m,schedule(p[g],e,t,g,p,get(d,t)));return new Transition(o,this._parents,e,t)}function transition_selectAll(i){var e=this._name,t=this._id;typeof i!="function"&&(i=selectorAll(i));for(var r=this._groups,s=r.length,o=[],a=[],l=0;l<s;++l)for(var u=r[l],p=u.length,d,m=0;m<p;++m)if(d=u[m]){for(var g=i.call(d,d.__data__,m,u),w,E=get(d,t),A=0,k=g.length;A<k;++A)(w=g[A])&&schedule(w,e,t,A,g,E);o.push(g),a.push(d)}return new Transition(o,a,e,t)}var Selection=selection.prototype.constructor;function transition_selection(){return new Selection(this._groups,this._parents)}function styleNull(i,e){var t,r,s;return function(){var o=styleValue(this,i),a=(this.style.removeProperty(i),styleValue(this,i));return o===a?null:o===t&&a===r?s:s=e(t=o,r=a)}}function styleRemove(i){return function(){this.style.removeProperty(i)}}function styleConstant(i,e,t){var r,s=t+"",o;return function(){var a=styleValue(this,i);return a===s?null:a===r?o:o=e(r=a,t)}}function styleFunction(i,e,t){var r,s,o;return function(){var a=styleValue(this,i),l=t(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(i),styleValue(this,i))),a===u?null:a===r&&u===s?o:(s=u,o=e(r=a,l))}}function styleMaybeRemove(i,e){var t,r,s,o="style."+e,a="end."+o,l;return function(){var u=set(this,i),p=u.on,d=u.value[o]==null?l||(l=styleRemove(e)):void 0;(p!==t||s!==d)&&(r=(t=p).copy()).on(a,s=d),u.on=r}}function transition_style(i,e,t){var r=(i+="")=="transform"?interpolateTransformCss:interpolate;return e==null?this.styleTween(i,styleNull(i,r)).on("end.style."+i,styleRemove(i)):typeof e=="function"?this.styleTween(i,styleFunction(i,r,tweenValue(this,"style."+i,e))).each(styleMaybeRemove(this._id,i)):this.styleTween(i,styleConstant(i,r,e),t).on("end.style."+i,null)}function styleInterpolate(i,e,t){return function(r){this.style.setProperty(i,e.call(this,r),t)}}function styleTween(i,e,t){var r,s;function o(){var a=e.apply(this,arguments);return a!==s&&(r=(s=a)&&styleInterpolate(i,a,t)),r}return o._value=e,o}function transition_styleTween(i,e,t){var r="style."+(i+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,styleTween(i,e,t??""))}function textConstant(i){return function(){this.textContent=i}}function textFunction(i){return function(){var e=i(this);this.textContent=e??""}}function transition_text(i){return this.tween("text",typeof i=="function"?textFunction(tweenValue(this,"text",i)):textConstant(i==null?"":i+""))}function textInterpolate(i){return function(e){this.textContent=i.call(this,e)}}function textTween(i){var e,t;function r(){var s=i.apply(this,arguments);return s!==t&&(e=(t=s)&&textInterpolate(s)),e}return r._value=i,r}function transition_textTween(i){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(i==null)return this.tween(e,null);if(typeof i!="function")throw new Error;return this.tween(e,textTween(i))}function transition_transition(){for(var i=this._name,e=this._id,t=newId(),r=this._groups,s=r.length,o=0;o<s;++o)for(var a=r[o],l=a.length,u,p=0;p<l;++p)if(u=a[p]){var d=get(u,e);schedule(u,i,t,p,a,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Transition(r,this._parents,i,t)}function transition_end(){var i,e,t=this,r=t._id,s=t.size();return new Promise(function(o,a){var l={value:a},u={value:function(){--s===0&&o()}};t.each(function(){var p=set(this,r),d=p.on;d!==i&&(e=(i=d).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),p.on=e}),s===0&&o()})}var id=0;function Transition(i,e,t,r){this._groups=i,this._parents=e,this._name=t,this._id=r}function newId(){return++id}var selection_prototype=selection.prototype;Transition.prototype={constructor:Transition,select:transition_select,selectAll:transition_selectAll,selectChild:selection_prototype.selectChild,selectChildren:selection_prototype.selectChildren,filter:transition_filter,merge:transition_merge,selection:transition_selection,transition:transition_transition,call:selection_prototype.call,nodes:selection_prototype.nodes,node:selection_prototype.node,size:selection_prototype.size,empty:selection_prototype.empty,each:selection_prototype.each,on:transition_on,attr:transition_attr,attrTween:transition_attrTween,style:transition_style,styleTween:transition_styleTween,text:transition_text,textTween:transition_textTween,remove:transition_remove,tween:transition_tween,delay:transition_delay,duration:transition_duration,ease:transition_ease,easeVarying:transition_easeVarying,end:transition_end,[Symbol.iterator]:selection_prototype[Symbol.iterator]};var defaultTiming={time:null,delay:0,duration:250,ease:cubicInOut};function inherit(i,e){for(var t;!(t=i.__transition)||!(t=t[e]);)if(!(i=i.parentNode))throw new Error(`transition ${e} not found`);return t}function selection_transition(i){var e,t;i instanceof Transition?(e=i._id,i=i._name):(e=newId(),(t=defaultTiming).time=now(),i=i==null?null:i+"");for(var r=this._groups,s=r.length,o=0;o<s;++o)for(var a=r[o],l=a.length,u,p=0;p<l;++p)(u=a[p])&&schedule(u,i,e,p,a,t||inherit(u,e));return new Transition(r,this._parents,i,e)}selection.prototype.interrupt=selection_interrupt;selection.prototype.transition=selection_transition;function defaultSeparation(i,e){return i.parent===e.parent?1:2}function meanX(i){return i.reduce(meanXReduce,0)/i.length}function meanXReduce(i,e){return i+e.x}function maxY(i){return 1+i.reduce(maxYReduce,0)}function maxYReduce(i,e){return Math.max(i,e.y)}function leafLeft(i){for(var e;e=i.children;)i=e[0];return i}function leafRight(i){for(var e;e=i.children;)i=e[e.length-1];return i}function cluster(){var i=defaultSeparation,e=1,t=1,r=!1;function s(o){var a,l=0;o.eachAfter(function(g){var w=g.children;w?(g.x=meanX(w),g.y=maxY(w)):(g.x=a?l+=i(g,a):0,g.y=0,a=g)});var u=leafLeft(o),p=leafRight(o),d=u.x-i(u,p)/2,m=p.x+i(p,u)/2;return o.eachAfter(r?function(g){g.x=(g.x-o.x)*e,g.y=(o.y-g.y)*t}:function(g){g.x=(g.x-d)/(m-d)*e,g.y=(1-(o.y?g.y/o.y:1))*t})}return s.separation=function(o){return arguments.length?(i=o,s):i},s.size=function(o){return arguments.length?(r=!1,e=+o[0],t=+o[1],s):r?null:[e,t]},s.nodeSize=function(o){return arguments.length?(r=!0,e=+o[0],t=+o[1],s):r?[e,t]:null},s}function count(i){var e=0,t=i.children,r=t&&t.length;if(!r)e=1;else for(;--r>=0;)e+=t[r].value;i.value=e}function node_count(){return this.eachAfter(count)}function node_each(i,e){let t=-1;for(const r of this)i.call(e,r,++t,this);return this}function node_eachBefore(i,e){for(var t=this,r=[t],s,o,a=-1;t=r.pop();)if(i.call(e,t,++a,this),s=t.children)for(o=s.length-1;o>=0;--o)r.push(s[o]);return this}function node_eachAfter(i,e){for(var t=this,r=[t],s=[],o,a,l,u=-1;t=r.pop();)if(s.push(t),o=t.children)for(a=0,l=o.length;a<l;++a)r.push(o[a]);for(;t=s.pop();)i.call(e,t,++u,this);return this}function node_find(i,e){let t=-1;for(const r of this)if(i.call(e,r,++t,this))return r}function node_sum(i){return this.eachAfter(function(e){for(var t=+i(e.data)||0,r=e.children,s=r&&r.length;--s>=0;)t+=r[s].value;e.value=t})}function node_sort(i){return this.eachBefore(function(e){e.children&&e.children.sort(i)})}function node_path(i){for(var e=this,t=leastCommonAncestor(e,i),r=[e];e!==t;)e=e.parent,r.push(e);for(var s=r.length;i!==t;)r.splice(s,0,i),i=i.parent;return r}function leastCommonAncestor(i,e){if(i===e)return i;var t=i.ancestors(),r=e.ancestors(),s=null;for(i=t.pop(),e=r.pop();i===e;)s=i,i=t.pop(),e=r.pop();return s}function node_ancestors(){for(var i=this,e=[i];i=i.parent;)e.push(i);return e}function node_descendants(){return Array.from(this)}function node_leaves(){var i=[];return this.eachBefore(function(e){e.children||i.push(e)}),i}function node_links(){var i=this,e=[];return i.each(function(t){t!==i&&e.push({source:t.parent,target:t})}),e}function*node_iterator(){var i=this,e,t=[i],r,s,o;do for(e=t.reverse(),t=[];i=e.pop();)if(yield i,r=i.children)for(s=0,o=r.length;s<o;++s)t.push(r[s]);while(t.length)}function hierarchy(i,e){i instanceof Map?(i=[void 0,i],e===void 0&&(e=mapChildren)):e===void 0&&(e=objectChildren);for(var t=new Node(i),r,s=[t],o,a,l,u;r=s.pop();)if((a=e(r.data))&&(u=(a=Array.from(a)).length))for(r.children=a,l=u-1;l>=0;--l)s.push(o=a[l]=new Node(a[l])),o.parent=r,o.depth=r.depth+1;return t.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function objectChildren(i){return i.children}function mapChildren(i){return Array.isArray(i)?i[1]:null}function copyData(i){i.data.value!==void 0&&(i.value=i.data.value),i.data=i.data.data}function computeHeight(i){var e=0;do i.height=e;while((i=i.parent)&&i.height<++e)}function Node(i){this.data=i,this.depth=this.height=0,this.parent=null}Node.prototype=hierarchy.prototype={constructor:Node,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,find:node_find,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy,[Symbol.iterator]:node_iterator};class SVGChart extends BaseChart{constructor(e,t,r,s){super(e,t,r),this.svg=select(this.contentDiv).append("svg").attr("width",this.width).attr("height",this.height),this.config.axis=this.config.axis||{};const o=this.config.axis;function a(d,m,g){d[m]==null&&(d[m]=g)}for(let d of[["x",25],["y",40],["ry",25],["tx",25]]){const m=s[d[0]];if(m){o[d[0]]=o[d[0]]||{};const g=o[d[0]];a(g,"textSize",13),a(g,"label",""),a(g,"size",m.size||d[1]),a(g,"tickfont",10)}}this._setMargins(),this.graph_area=this.svg.append("g").attr("transform",`translate(${this.margins.left},${this.margins.top})`),this.ry_axis_svg=this.svg.append("g"),this.tx_axis_svg=this.svg.append("g"),this.x_axis_svg=this.svg.append("g"),this.y_axis_svg=this.svg.append("g");const l=s.x;l&&(l.custom||(this.x_scale=l.type==="band"?band():linear$1(),this.x_axis_call=axisBottom(this.x_scale)),this.x_axis_label=this.x_axis_svg.append("text").style("text-anchor","middle").style("fill","black").attr("alignment-baseline","auto"));const u=s.y;u&&(u.custom||(this.y_scale=u.type==="band"?band():linear$1(),this.y_axis_call=axisLeft(this.y_scale)),this.y_axis_label=this.y_axis_svg.append("text").attr("text-anchor","middle").style("fill","black").attr("alignment-baseline","auto"));const p=s.ry;p&&p.label&&(this.ry_axis_label=this.ry_axis_svg.append("text").attr("text-anchor","middle").style("fill","black").attr("alignment-baseline","text-top"))}_setMargins(){const e=this.config.axis;this.margins={top:e.tx?e.tx.size:10,right:e.ry?e.ry.size:10,bottom:e.x?e.x.size:10,left:e.y?e.y.size:10}}_getContentDimensions(){return{top:this.margins.top,left:this.margins.left,height:this.height-this.margins.bottom-this.margins.top,width:this.width-this.margins.left-this.margins.right}}setAxisSize(e,t){switch(e){case"tx":this.margins.top=t;break;case"y":this.config.axis.y.size=t,this.margins.left=t;break;case"x":this.config.axis.x.size=t,this.margins.bottom=t}this.graph_area.attr("transform",`translate(${this.margins.left},${this.margins.top})`)}updateAxis(){const e=this._getContentDimensions(),t=this.config.axis;if(this.ry_axis_svg.attr("transform",`translate(${e.left+e.width},${e.top})`),this.tx_axis_svg.attr("transform",`translate(${e.left},0)`),this.x_axis_svg.attr("transform",`translate(${e.left},${this.height-this.margins.bottom})`),this.y_axis_svg.attr("transform",`translate(${e.left},${e.top})`),t.x&&(this.x_scale&&(this.x_scale.range([0,e.width]),this.x_axis_svg.selectAll(".tick text").attr("font-family","Helvetica"),this.x_axis_svg.transition().call(this.x_axis_call),t.x.rotate_labels?this.x_axis_svg.selectAll(".tick text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".10em").attr("transform","rotate(-45)"):this.x_axis_svg.selectAll(".tick text").style("text-anchor",null).attr("dx",null).attr("dy",".71em").attr("transform",null),this.x_axis_svg.selectAll(".tick text").attr("font-size",t.x.tickfont)),this.x_axis_label.attr("x",e.width/2).attr("y",this.margins.bottom-4).text(this.config.axis.x.label).attr("font-size",this.config.axis.x.textsize+"px").attr("font-family","Helvetica")),t.y){if(this.y_scale){if(this.y_scale.range([0,e.height]),e.height/this.y_scale.domain().length<8){const s=Math.round(this.y_scale.domain().length/(e.height/10));this.y_axis_call.tickFormat((o,a)=>a%s==0?o:"")}else this.y_axis_call.tickFormat(null);this.y_axis_svg.transition().call(this.y_axis_call),t.y.rotate_labels?this.y_axis_svg.selectAll(".tick text").style("text-anchor","end").attr("dy","1em").attr("transform","rotate(+45)"):this.y_axis_svg.selectAll(".tick text").style("text-anchor",null).attr("dx",null).attr("dy","0.32em").attr("transform",null),this.y_axis_svg.selectAll(".tick text").attr("font-size",t.y.tickfont).attr("font-family","Helvetica")}this.y_axis_label.attr("x",-e.height/2).attr("y",-e.left+10).attr("transform","rotate(-90)").text(this.config.axis.y.label).attr("font-size",this.config.axis.y.textsize+"px").attr("font-family","Helvetica")}this.ry_axis_label&&this.ry_axis_label.attr("x",e.height/2).attr("y",-this.margins.right+15).attr("transform","rotate(90)").text(this.config.axis.ry.label).attr("font-size",this.config.axis.ry.textsize+"px")}setSize(e,t){super.setSize(e,t),this.svg&&this.svg.attr("width",this.width).attr("height",this.height)}drawXTree(e,t,r,s){select(this.contentDiv).transition().duration(400).ease(linear);const o=this._getContentDimensions(),u=cluster().size([o.width,r])(e).descendants(),p=o.width/t;for(let d of u)d.children||(d.x=p/2+p*d.data.order);for(let d of u)if(!d.children){let m=d.parent;for(;m;)m.x=m.children[0].x+(m.children[1].x-m.children[0].x)/2,m=m.parent}this.tx_axis_svg.selectAll(".tree-link").data(u.slice(1)).join("path").attr("class","tree-link").style("stroke","currentColor").style("fill","none").style("stroke-width","1px").transition("trans").attr("d",d=>{let m=d.x;return d.children||(m=p/2+p*d.data.order),`M ${m} ${d.y+s} L${m} ${d.parent.y+s} L${d.parent.x} ${d.parent.y+s}`})}drawYTree(e,t){select(this.contentDiv).transition().duration(400).ease(linear);const r=this._getContentDimensions(),s=this.margins.right,l=cluster().size([r.height,s])(e).descendants(),u=r.height/t;for(let p of l)p.children||(p.x=u/2+u*p.data.order);for(let p of l)if(!p.children){let d=p.parent;for(;d;)d.x=d.children[0].x+(d.children[1].x-d.children[0].x)/2,d=d.parent}this.ry_axis_svg.selectAll(".tree-link").data(l.slice(1)).join("path").attr("class","tree-link").style("stroke","currentColor").style("fill","none").style("stroke-width","1px").transition("trans").attr("d",p=>{let d=p.x;return p.children||(d=u/2+u*p.data.order),`M ${s-p.y} ${d} L${s-p.parent.y} ${d} L${s-p.parent.y} ${p.parent.x}`})}getSettings(){const e=super.getSettings(),t=this.config;let r=[];return this.config.axis.y&&(r=r.concat([{type:"check",current_value:t.axis.y.rotate_labels,label:"Rotate Y axis labels",func:s=>{t.axis.y.rotate_labels=s,this.setSize()}},{type:"slider",max:20,min:4,step:1,doc:this.__doc__,current_value:t.axis.y.tickfont,label:"Y axis text size",func:s=>{t.axis.y.tickfont=s,this.setSize()}},{type:"slider",max:200,min:20,step:1,doc:this.__doc__,current_value:t.axis.y.size,label:"Y axis width",func:s=>{this.setAxisSize("y",s),this.setSize()}}])),this.config.axis.x&&(r=r.concat([{type:"check",current_value:t.axis.x.rotate_labels,label:"Rotate X axis labels",func:s=>{t.axis.x.rotate_labels=s,this.updateAxis()}},{type:"slider",max:20,min:4,step:1,doc:this.__doc__,current_value:t.axis.x.tickfont,label:"X axis text size",func:s=>{t.axis.x.tickfont=s,this.setSize()}},{type:"slider",max:200,min:20,step:1,doc:this.__doc__,current_value:t.axis.x.size,label:"X axis Height",func:s=>{this.setAxisSize("x",s),this.setSize()}}])),e.concat(r)}_addLegendToSVG(e){const t=this[e];if(!t)return;const r=[t.offsetLeft,t.offsetTop];t._leg=t.querySelector("g"),t._leg_g=select(t._leg).attr("transform",`translate(${r[0]},${r[1]})`),this.svg.node().append(t._leg_g.node())}_removeLegendFromSVG(e){const t=this[e];t&&(t._leg_g.attr("transform","translate(0,0)"),this.legend.querySelector("svg").append(t._leg),delete this.legend._leg,delete this.legend._leg_g)}getImage(e,t){this.addToImage&&this.addToImage(),this._addLegendToSVG("legend"),this.extra_legends&&this.extra_legends.forEach(s=>this._addLegendToSVG(s));const r=new XMLSerializer().serializeToString(this.svg.node());t==="png"?this.getImageFromSVG(this.svg.node(),s=>{e(s),this.removeFromImage&&this.removeFromImage(),this._removeLegendFromSVG("legend"),this.extra_legends&&this.extra_legends.forEach(o=>this._removeLegendFromSVG(o))}):(e(r),this.removeFromImage&&this.removeFromImage(),this._removeLegendFromSVG("legend"),this.extra_legends&&this.extra_legends.forEach(s=>this._removeLegendFromSVG(s)))}}const nonpassivecapture={capture:!0,passive:!1};function noevent$1(i){i.preventDefault(),i.stopImmediatePropagation()}function dragDisable(i){var e=i.document.documentElement,t=select(i).on("dragstart.drag",noevent$1,nonpassivecapture);"onselectstart"in e?t.on("selectstart.drag",noevent$1,nonpassivecapture):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function yesdrag(i,e){var t=i.document.documentElement,r=select(i).on("dragstart.drag",null);e&&(r.on("click.drag",noevent$1,nonpassivecapture),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in t?r.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const constant$3=i=>()=>i;function BrushEvent(i,{sourceEvent:e,target:t,selection:r,mode:s,dispatch:o}){Object.defineProperties(this,{type:{value:i,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},selection:{value:r,enumerable:!0,configurable:!0},mode:{value:s,enumerable:!0,configurable:!0},_:{value:o}})}function nopropagation(i){i.stopImmediatePropagation()}function noevent(i){i.preventDefault(),i.stopImmediatePropagation()}var MODE_DRAG={name:"drag"},MODE_SPACE={name:"space"},MODE_HANDLE={name:"handle"},MODE_CENTER={name:"center"};const{abs:abs$2,max:max$1,min:min$1}=Math;function number1(i){return[+i[0],+i[1]]}function number2(i){return[number1(i[0]),number1(i[1])]}var X={name:"x",handles:["w","e"].map(type),input:function(i,e){return i==null?null:[[+i[0],e[0][1]],[+i[1],e[1][1]]]},output:function(i){return i&&[i[0][0],i[1][0]]}},Y={name:"y",handles:["n","s"].map(type),input:function(i,e){return i==null?null:[[e[0][0],+i[0]],[e[1][0],+i[1]]]},output:function(i){return i&&[i[0][1],i[1][1]]}},cursors={overlay:"crosshair",selection:"move",n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},flipX={e:"w",w:"e",nw:"ne",ne:"nw",se:"sw",sw:"se"},flipY={n:"s",s:"n",nw:"sw",ne:"se",se:"ne",sw:"nw"},signsX={overlay:1,selection:1,n:null,e:1,s:null,w:-1,nw:-1,ne:1,se:1,sw:-1},signsY={overlay:1,selection:1,n:-1,e:null,s:1,w:null,nw:-1,ne:-1,se:1,sw:1};function type(i){return{type:i}}function defaultFilter(i){return!i.ctrlKey&&!i.button}function defaultExtent(){var i=this.ownerSVGElement||this;return i.hasAttribute("viewBox")?(i=i.viewBox.baseVal,[[i.x,i.y],[i.x+i.width,i.y+i.height]]):[[0,0],[i.width.baseVal.value,i.height.baseVal.value]]}function defaultTouchable(){return navigator.maxTouchPoints||"ontouchstart"in this}function local(i){for(;!i.__brush;)if(!(i=i.parentNode))return;return i.__brush}function empty(i){return i[0][0]===i[1][0]||i[0][1]===i[1][1]}function brushX(){return brush(X)}function brush(i){var e=defaultExtent,t=defaultFilter,r=defaultTouchable,s=!0,o=dispatch("start","brush","end"),a=6,l;function u(k){var O=k.property("__brush",A).selectAll(".overlay").data([type("overlay")]);O.enter().append("rect").attr("class","overlay").attr("pointer-events","all").attr("cursor",cursors.overlay).merge(O).each(function(){var Q=local(this).extent;select(this).attr("x",Q[0][0]).attr("y",Q[0][1]).attr("width",Q[1][0]-Q[0][0]).attr("height",Q[1][1]-Q[0][1])}),k.selectAll(".selection").data([type("selection")]).enter().append("rect").attr("class","selection").attr("cursor",cursors.selection).attr("fill","#777").attr("fill-opacity",.3).attr("stroke","#fff").attr("shape-rendering","crispEdges");var ne=k.selectAll(".handle").data(i.handles,function(Q){return Q.type});ne.exit().remove(),ne.enter().append("rect").attr("class",function(Q){return"handle handle--"+Q.type}).attr("cursor",function(Q){return cursors[Q.type]}),k.each(p).attr("fill","none").attr("pointer-events","all").on("mousedown.brush",g).filter(r).on("touchstart.brush",g).on("touchmove.brush",w).on("touchend.brush touchcancel.brush",E).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}u.move=function(k,O,ne){k.tween?k.on("start.brush",function(Q){d(this,arguments).beforestart().start(Q)}).on("interrupt.brush end.brush",function(Q){d(this,arguments).end(Q)}).tween("brush",function(){var Q=this,ue=Q.__brush,U=d(Q,arguments),_=ue.selection,Se=i.input(typeof O=="function"?O.apply(this,arguments):O,ue.extent),Me=interpolate$1(_,Se);function Ke(kt){ue.selection=kt===1&&Se===null?null:Me(kt),p.call(Q),U.brush()}return _!==null&&Se!==null?Ke:Ke(1)}):k.each(function(){var Q=this,ue=arguments,U=Q.__brush,_=i.input(typeof O=="function"?O.apply(Q,ue):O,U.extent),Se=d(Q,ue).beforestart();interrupt(Q),U.selection=_===null?null:_,p.call(Q),Se.start(ne).brush(ne).end(ne)})},u.clear=function(k,O){u.move(k,null,O)};function p(){var k=select(this),O=local(this).selection;O?(k.selectAll(".selection").style("display",null).attr("x",O[0][0]).attr("y",O[0][1]).attr("width",O[1][0]-O[0][0]).attr("height",O[1][1]-O[0][1]),k.selectAll(".handle").style("display",null).attr("x",function(ne){return ne.type[ne.type.length-1]==="e"?O[1][0]-a/2:O[0][0]-a/2}).attr("y",function(ne){return ne.type[0]==="s"?O[1][1]-a/2:O[0][1]-a/2}).attr("width",function(ne){return ne.type==="n"||ne.type==="s"?O[1][0]-O[0][0]+a:a}).attr("height",function(ne){return ne.type==="e"||ne.type==="w"?O[1][1]-O[0][1]+a:a})):k.selectAll(".selection,.handle").style("display","none").attr("x",null).attr("y",null).attr("width",null).attr("height",null)}function d(k,O,ne){var Q=k.__brush.emitter;return Q&&(!ne||!Q.clean)?Q:new m(k,O,ne)}function m(k,O,ne){this.that=k,this.args=O,this.state=k.__brush,this.active=0,this.clean=ne}m.prototype={beforestart:function(){return++this.active===1&&(this.state.emitter=this,this.starting=!0),this},start:function(k,O){return this.starting?(this.starting=!1,this.emit("start",k,O)):this.emit("brush",k),this},brush:function(k,O){return this.emit("brush",k,O),this},end:function(k,O){return--this.active===0&&(delete this.state.emitter,this.emit("end",k,O)),this},emit:function(k,O,ne){var Q=select(this.that).datum();o.call(k,this.that,new BrushEvent(k,{sourceEvent:O,target:u,selection:i.output(this.state.selection),mode:ne,dispatch:o}),Q)}};function g(k){if(l&&!k.touches||!t.apply(this,arguments))return;var O=this,ne=k.target.__data__.type,Q=(s&&k.metaKey?ne="overlay":ne)==="selection"?MODE_DRAG:s&&k.altKey?MODE_CENTER:MODE_HANDLE,ue=i===Y?null:signsX[ne],U=i===X?null:signsY[ne],_=local(O),Se=_.extent,Me=_.selection,Ke=Se[0][0],kt,Qe,ze=Se[0][1],Je,St,Te=Se[1][0],dt,ot,yt=Se[1][1],Ue,Nt,Ot=0,wi=0,Bi,Ei=ue&&U&&s&&k.shiftKey,Zi,fr,Ti=Array.from(k.touches||[k],Xe=>{const It=Xe.identifier;return Xe=pointer(Xe,O),Xe.point0=Xe.slice(),Xe.identifier=It,Xe});interrupt(O);var Lt=d(O,arguments,!0).beforestart();if(ne==="overlay"){Me&&(Bi=!0);const Xe=[Ti[0],Ti[1]||Ti[0]];_.selection=Me=[[kt=i===Y?Ke:min$1(Xe[0][0],Xe[1][0]),Je=i===X?ze:min$1(Xe[0][1],Xe[1][1])],[dt=i===Y?Te:max$1(Xe[0][0],Xe[1][0]),Ue=i===X?yt:max$1(Xe[0][1],Xe[1][1])]],Ti.length>1&&ke(k)}else kt=Me[0][0],Je=Me[0][1],dt=Me[1][0],Ue=Me[1][1];Qe=kt,St=Je,ot=dt,Nt=Ue;var je=select(O).attr("pointer-events","none"),mt=je.selectAll(".overlay").attr("cursor",cursors[ne]);if(k.touches)Lt.moved=Ut,Lt.ended=_t;else{var Vt=select(k.view).on("mousemove.brush",Ut,!0).on("mouseup.brush",_t,!0);s&&Vt.on("keydown.brush",$t,!0).on("keyup.brush",at,!0),dragDisable(k.view)}p.call(O),Lt.start(k,Q.name);function Ut(Xe){for(const It of Xe.changedTouches||[Xe])for(const _i of Ti)_i.identifier===It.identifier&&(_i.cur=pointer(It,O));if(Ei&&!Zi&&!fr&&Ti.length===1){const It=Ti[0];abs$2(It.cur[0]-It[0])>abs$2(It.cur[1]-It[1])?fr=!0:Zi=!0}for(const It of Ti)It.cur&&(It[0]=It.cur[0],It[1]=It.cur[1]);Bi=!0,noevent(Xe),ke(Xe)}function ke(Xe){const It=Ti[0],_i=It.point0;var vi;switch(Ot=It[0]-_i[0],wi=It[1]-_i[1],Q){case MODE_SPACE:case MODE_DRAG:{ue&&(Ot=max$1(Ke-kt,min$1(Te-dt,Ot)),Qe=kt+Ot,ot=dt+Ot),U&&(wi=max$1(ze-Je,min$1(yt-Ue,wi)),St=Je+wi,Nt=Ue+wi);break}case MODE_HANDLE:{Ti[1]?(ue&&(Qe=max$1(Ke,min$1(Te,Ti[0][0])),ot=max$1(Ke,min$1(Te,Ti[1][0])),ue=1),U&&(St=max$1(ze,min$1(yt,Ti[0][1])),Nt=max$1(ze,min$1(yt,Ti[1][1])),U=1)):(ue<0?(Ot=max$1(Ke-kt,min$1(Te-kt,Ot)),Qe=kt+Ot,ot=dt):ue>0&&(Ot=max$1(Ke-dt,min$1(Te-dt,Ot)),Qe=kt,ot=dt+Ot),U<0?(wi=max$1(ze-Je,min$1(yt-Je,wi)),St=Je+wi,Nt=Ue):U>0&&(wi=max$1(ze-Ue,min$1(yt-Ue,wi)),St=Je,Nt=Ue+wi));break}case MODE_CENTER:{ue&&(Qe=max$1(Ke,min$1(Te,kt-Ot*ue)),ot=max$1(Ke,min$1(Te,dt+Ot*ue))),U&&(St=max$1(ze,min$1(yt,Je-wi*U)),Nt=max$1(ze,min$1(yt,Ue+wi*U)));break}}ot<Qe&&(ue*=-1,vi=kt,kt=dt,dt=vi,vi=Qe,Qe=ot,ot=vi,ne in flipX&&mt.attr("cursor",cursors[ne=flipX[ne]])),Nt<St&&(U*=-1,vi=Je,Je=Ue,Ue=vi,vi=St,St=Nt,Nt=vi,ne in flipY&&mt.attr("cursor",cursors[ne=flipY[ne]])),_.selection&&(Me=_.selection),Zi&&(Qe=Me[0][0],ot=Me[1][0]),fr&&(St=Me[0][1],Nt=Me[1][1]),(Me[0][0]!==Qe||Me[0][1]!==St||Me[1][0]!==ot||Me[1][1]!==Nt)&&(_.selection=[[Qe,St],[ot,Nt]],p.call(O),Lt.brush(Xe,Q.name))}function _t(Xe){if(nopropagation(Xe),Xe.touches){if(Xe.touches.length)return;l&&clearTimeout(l),l=setTimeout(function(){l=null},500)}else yesdrag(Xe.view,Bi),Vt.on("keydown.brush keyup.brush mousemove.brush mouseup.brush",null);je.attr("pointer-events","all"),mt.attr("cursor",cursors.overlay),_.selection&&(Me=_.selection),empty(Me)&&(_.selection=null,p.call(O)),Lt.end(Xe,Q.name)}function $t(Xe){switch(Xe.keyCode){case 16:{Ei=ue&&U;break}case 18:{Q===MODE_HANDLE&&(ue&&(dt=ot-Ot*ue,kt=Qe+Ot*ue),U&&(Ue=Nt-wi*U,Je=St+wi*U),Q=MODE_CENTER,ke(Xe));break}case 32:{(Q===MODE_HANDLE||Q===MODE_CENTER)&&(ue<0?dt=ot-Ot:ue>0&&(kt=Qe-Ot),U<0?Ue=Nt-wi:U>0&&(Je=St-wi),Q=MODE_SPACE,mt.attr("cursor",cursors.selection),ke(Xe));break}default:return}noevent(Xe)}function at(Xe){switch(Xe.keyCode){case 16:{Ei&&(Zi=fr=Ei=!1,ke(Xe));break}case 18:{Q===MODE_CENTER&&(ue<0?dt=ot:ue>0&&(kt=Qe),U<0?Ue=Nt:U>0&&(Je=St),Q=MODE_HANDLE,ke(Xe));break}case 32:{Q===MODE_SPACE&&(Xe.altKey?(ue&&(dt=ot-Ot*ue,kt=Qe+Ot*ue),U&&(Ue=Nt-wi*U,Je=St+wi*U),Q=MODE_CENTER):(ue<0?dt=ot:ue>0&&(kt=Qe),U<0?Ue=Nt:U>0&&(Je=St),Q=MODE_HANDLE),mt.attr("cursor",cursors[ne]),ke(Xe));break}default:return}noevent(Xe)}}function w(k){d(this,arguments).moved(k)}function E(k){d(this,arguments).ended(k)}function A(){var k=this.__brush||{selection:null};return k.extent=number2(e.apply(this,arguments)),k.dim=i,k}return u.extent=function(k){return arguments.length?(e=typeof k=="function"?k:constant$3(number2(k)),u):e},u.filter=function(k){return arguments.length?(t=typeof k=="function"?k:constant$3(!!k),u):t},u.touchable=function(k){return arguments.length?(r=typeof k=="function"?k:constant$3(!!k),u):r},u.handleSize=function(k){return arguments.length?(a=+k,u):a},u.keyModifiers=function(k){return arguments.length?(s=!!k,u):s},u.on=function(){var k=o.on.apply(o,arguments);return k===o?u:k},u}class HistogramChart extends SVGChart{constructor(e,t,r){Array.isArray(r.param)&&(r.param=r.param[0]);const s=e.getColumnName(r.param);r.axis||(r.axis={x:{size:30,label:s,textsize:13},y:{size:45,label:"frequency",textsize:13}}),r.title||(r.title=s),super(e,t,r,{x:{},y:{}});const o=this.config;o.type="bar_chart";const a=this.dataStore.getMinMaxForColumn(r.param);this._setConfigValue(o,"display_max",a[1]),this._setConfigValue(o,"display_min",a[0]),this._setConfigValue(o,"bin_number",10),this.brush=brushX().on("end",l=>{const u=l.selection;if(u==null)return;const p=this.margins.left;this.setRange(this.x_scale.invert(u[0]-p),this.x_scale.invert(u[1]-p))}),this._setBrushExtent(),this.dim=this.dataStore.getDimension("range_dimension"),this.filter=null,this.binFiltered=new Array(this.config.bin_number).fill(!1),this.onDataFiltered(null,!0)}_setBrushExtent(){this.brush.extent([[this.margins.left,0],[this.width-this.margins.right,this.height-this.margins.bottom]]),this.svg.call(this.brush)}setSize(e,t){super.setSize(e,t),this._setBrushExtent(),this.drawChart(),this.svg.call(this.brush.move,null)}remove(e=!0){this.dim.destroy(e),super.remove()}removeFilter(){this.dim.removeFilter(),this.filter=null,this.binFiltered=new Array(this.config.bin_number).fill(!1),this.drawChart(),this.svg.call(this.brush.move,null)}_calculateFilterBins(){const e=this.config,t=e.bin_number;if(this.binFiltered=new Array(t).fill(!1),!this.filter)return;const r=(e.display_max-e.display_min)/e.bin_number;let s=e.display_min;for(let o=0;o<e.bin_number;o++){const a=s+o*r;(a<=this.filter[0]||a>this.filter[1])&&(this.binFiltered[o]=!0)}}setRange(e,t){this.filter=[e,t],this._calculateFilterBins(),this.dim.filter("filterRange",[this.config.param],{min:e,max:t}),this.drawChart(),this.resetButton.style.display="inline"}getFilter(){if(!this.filter)return null;const e={};return e[this.config.param]=this.filter.slice(0),e}onDataFiltered(e){if(this.dim===e||this.isPinned)return;const t=this.config.bin_number,r={bins:this.config.bin_number,max:this.config.display_max,min:this.config.display_min};e==="all_removed"&&(this.filter=null,this.binFiltered.fill(!1),this.svg.call(this.brush.move,null),this.resetButton.style.display="none"),this.dim.getBins(s=>{this.originalBinData=s,this.binData=s.slice(0,t),this.binData[t-1]+=s[t],this.drawChart()},this.config.param,r)}drawChart(){const e=select(this.contentDiv).transition().duration(400).ease(linear),t=this._getContentDimensions(),r=this.config.bin_number,s=(t.width-(r+1)*3)/r;let o=Math.max(...this.binData);o=o||1,this.x_scale.domain([this.config.display_min,this.config.display_max]),this.y_scale.domain([o,0]),this.updateAxis();const a=t.height/o,l=this;this.graph_area.selectAll(".bar").data(this.binData).join("rect").transition(e).style("fill",(u,p)=>l.binFiltered[p]?"gray":"blue").attr("class","bar").attr("x",(u,p)=>(p+1)*3+p*s).attr("width",s).attr("y",u=>t.height-u*a).attr("height",u=>u*a)}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}getSettings(){const e=super.getSettings(),t=this.config,r=this.dataStore.getMinMaxForColumn(t.param);return e.concat([{type:"doubleslider",min:r[0],max:r[1],doc:this.__doc__||document,current_value:[t.display_min,t.display_max],label:"max min values",info:{text:`Sometimes outliers can skew the histogram to one side.
                     Setting a min/max value will add all counts less/greater than the 
                     value specified to the first/last bin.`,position:"left"},func:(s,o)=>{t.display_min=s,t.display_max=o,this._calculateFilterBins(),this.onDataFiltered()}},{type:"spinner",max:100,min:2,current_value:t.bin_number,label:"Number of bins",func:s=>{t.bin_number=s,this._calculateFilterBins(),this.onDataFiltered()}}])}}BaseChart.types.bar_chart={name:"Histogram",class:HistogramChart,params:[{type:"number",name:"Frequency Data"}]};class CategoryChart extends SVGChart{constructor(e,t,r,s){Array.isArray(r.param)&&(r.param=r.param[0]),r.title=r.title||e.getColumnName(r.param),super(e,t,r,s),this.dim=this.dataStore.getDimension("category_dimension"),this.colors=this.dataStore.getColumnColors(r.param),this.filter=[]}remove(e=!0){this.dim.destroy(e),super.remove()}setSize(e,t){super.setSize(e,t),this.drawChart()}removeFilter(){this.dim.removeFilter(),this.filter=[],this.drawChart()}filterCategories(e,t){if(t)if(this.filter.indexOf(e)!==-1)this.filter=this.filter.filter(r=>r!==e);else if(this.filter.length==0){const r=this.dataStore.getColumnValues(this.config.param);this.filter=r.filter(s=>s!==e)}else this.filter.push(e);else this.filter=[e];this.resetButton.style.display="inline",this.drawChart(100),this.dim.filter("filterCategories",[this.config.param],this.filter)}getFilter(){const e={};return!this.filter||this.filter.length===0?null:(e[this.config.param]=this.filter.slice(0),e)}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}updateData(){const e=this.config;if(this.rowData=this.data.slice(0),e.filter_zeros&&(this.rowData=this.rowData.filter(t=>t[0]!==0)),e.sort==="size"&&this.rowData.sort((t,r)=>r[0]-t[0]),e.sort==="name"){const t=this.dataStore.getColumnValues(e.param);this.rowData.sort((r,s)=>t[r[1]].localeCompare(t[s[1]]))}this.rowData.length>40&&!e.show_limit&&(e.show_limit=40),e.show_limit&&e.show_limit<this.rowData.length&&this.rowData.splice(e.show_limit)}onDataFiltered(e){if(this.dim===e||this.isPinned)return;e==="all_removed"&&(this.filter=[],this.resetButton.style.display="none");const t={};this.dim.getCategories(r=>{this.data=new Array(r.length),this.maxCount=1,this.config;for(let s=0;s<r.length;s++)this.data[s]=[r[s],s],this.maxCount=Math.max(r[s],this.maxCount);this.updateData(),this.drawChart()},this.config.param,t)}}var wordcloud2Exports={},wordcloud2={get exports(){return wordcloud2Exports},set exports(i){wordcloud2Exports=i}};/*!
 * wordcloud2.js
 * http://timdream.org/wordcloud2.js/
 *
 * Copyright 2011 - 2019 Tim Guan-tin Chien and contributors.
 * Released under the MIT license
 */(function(i){window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var r=[void 0],s="zero-timeout-message",o=function(l){var u=r.length;return r.push(l),window.postMessage(s+u.toString(36),"*"),u};return window.addEventListener("message",function(l){if(!(typeof l.data!="string"||l.data.substr(0,s.length)!==s)){l.stopImmediatePropagation();var u=parseInt(l.data.substr(s.length),36);r[u]&&(r[u](),r[u]=void 0)}},!0),window.clearImmediate=function(l){r[l]&&(r[l]=void 0)},o}()||function(r){window.setTimeout(r,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(r){window.clearTimeout(r)}}()),function(e){var t=function(){var p=document.createElement("canvas");if(!p||!p.getContext)return!1;var d=p.getContext("2d");return!(!d||!d.getImageData||!d.fillText||!Array.prototype.some||!Array.prototype.push)}(),r=function(){if(t){for(var p=document.createElement("canvas").getContext("2d"),d=20,m,g;d;){if(p.font=d.toString(10)+"px sans-serif",p.measureText("").width===m&&p.measureText("m").width===g)return d+1;m=p.measureText("").width,g=p.measureText("m").width,d--}return 0}}(),s=function(u){if(Array.isArray(u)){var p=u.slice();return p.splice(0,2),p}else return[]},o=function(p){for(var d,m,g=p.length;g;)d=Math.floor(Math.random()*g),m=p[--g],p[g]=p[d],p[d]=m;return p},a={},l=function(p,d){if(!t)return;var m=Math.floor(Math.random()*Date.now());Array.isArray(p)||(p=[p]),p.forEach(function(Ut,ke){if(typeof Ut=="string"){if(p[ke]=document.getElementById(Ut),!p[ke])throw new Error("The element id specified is not found.")}else if(!Ut.tagName&&!Ut.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")});var g={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(d)for(var w in d)w in g&&(g[w]=d[w]);if(typeof g.weightFactor!="function"){var E=g.weightFactor;g.weightFactor=function(ke){return ke*E}}if(typeof g.shape!="function")switch(g.shape){case"circle":default:g.shape="circle";break;case"cardioid":g.shape=function(ke){return 1-Math.sin(ke)};break;case"diamond":g.shape=function(ke){var _t=ke%(2*Math.PI/4);return 1/(Math.cos(_t)+Math.sin(_t))};break;case"square":g.shape=function(ke){return Math.min(1/Math.abs(Math.cos(ke)),1/Math.abs(Math.sin(ke)))};break;case"triangle-forward":g.shape=function(ke){var _t=ke%(2*Math.PI/3);return 1/(Math.cos(_t)+Math.sqrt(3)*Math.sin(_t))};break;case"triangle":case"triangle-upright":g.shape=function(ke){var _t=(ke+Math.PI*3/2)%(2*Math.PI/3);return 1/(Math.cos(_t)+Math.sqrt(3)*Math.sin(_t))};break;case"pentagon":g.shape=function(ke){var _t=(ke+.955)%(2*Math.PI/5);return 1/(Math.cos(_t)+.726543*Math.sin(_t))};break;case"star":g.shape=function(ke){var _t=(ke+.955)%(2*Math.PI/10);return(ke+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-_t)+3.07768*Math.sin(2*Math.PI/10-_t)):1/(Math.cos(_t)+3.07768*Math.sin(_t))};break}g.gridSize=Math.max(Math.floor(g.gridSize),4);var A=g.gridSize,k=A-g.maskGapWidth,O=Math.abs(g.maxRotation-g.minRotation),ne=Math.abs(Math.floor(g.rotationSteps)),Q=Math.min(g.maxRotation,g.minRotation),ue,U,_,Se,Me,Ke,kt;function Qe(Ut,ke){return"hsl("+(Math.random()*360).toFixed()+","+(Math.random()*30+70).toFixed()+"%,"+(Math.random()*(ke-Ut)+Ut).toFixed()+"%)"}switch(g.color){case"random-dark":kt=function(){return Qe(10,50)};break;case"random-light":kt=function(){return Qe(50,90)};break;default:typeof g.color=="function"&&(kt=g.color);break}var ze;typeof g.fontWeight=="function"&&(ze=g.fontWeight);var Je=null;typeof g.classes=="function"&&(Je=g.classes);var St=!1,Te=[],dt,ot=function(ke){var _t=ke.currentTarget,$t=_t.getBoundingClientRect(),at,Xe;ke.touches?(at=ke.touches[0].clientX,Xe=ke.touches[0].clientY):(at=ke.clientX,Xe=ke.clientY);var It=at-$t.left,_i=Xe-$t.top,vi=Math.floor(It*(_t.width/$t.width||1)/A),Ri=Math.floor(_i*(_t.height/$t.height||1)/A);return Te[vi][Ri]},yt=function(ke){var _t=ot(ke);if(dt!==_t){if(dt=_t,!_t){g.hover(void 0,void 0,ke);return}g.hover(_t.item,_t.dimension,ke)}},Ue=function(ke){var _t=ot(ke);_t&&(g.click(_t.item,_t.dimension,ke),ke.preventDefault())},Nt=[],Ot=function(ke){if(Nt[ke])return Nt[ke];var _t=ke*8,$t=_t,at=[];for(ke===0&&at.push([Se[0],Se[1],0]);$t--;){var Xe=1;g.shape!=="circle"&&(Xe=g.shape($t/_t*2*Math.PI)),at.push([Se[0]+ke*Xe*Math.cos(-$t/_t*2*Math.PI),Se[1]+ke*Xe*Math.sin(-$t/_t*2*Math.PI)*g.ellipticity,$t/_t*2*Math.PI])}return Nt[ke]=at,at},wi=function(){return g.abortThreshold>0&&new Date().getTime()-Ke>g.abortThreshold},Bi=function(){return g.rotateRatio===0||Math.random()>g.rotateRatio?0:O===0?Q:ne>0?Q+Math.floor(Math.random()*ne)*O/(ne-1):Q+Math.random()*O},Ei=function(ke,_t,$t,at){var Xe=g.weightFactor(_t);if(Xe<=g.minSize)return!1;var It=1;Xe<r&&(It=function(){for(var Yi=2;Yi*Xe<r;)Yi+=2;return Yi}());var _i;ze?_i=ze(ke,_t,Xe,at):_i=g.fontWeight;var vi=document.createElement("canvas"),Ri=vi.getContext("2d",{willReadFrequently:!0});Ri.font=_i+" "+(Xe*It).toString(10)+"px "+g.fontFamily;var sr=Ri.measureText(ke).width/It,P=Math.max(Xe*It,Ri.measureText("m").width,Ri.measureText("").width)/It,ki=sr+P*2,Ni=P*3,Gi=Math.ceil(ki/A),q=Math.ceil(Ni/A);ki=Gi*A,Ni=q*A;var L=-sr/2,Ve=-P*.4,ht=Math.ceil((ki*Math.abs(Math.sin($t))+Ni*Math.abs(Math.cos($t)))/A),xt=Math.ceil((ki*Math.abs(Math.cos($t))+Ni*Math.abs(Math.sin($t)))/A),ri=xt*A,si=ht*A;vi.setAttribute("width",ri),vi.setAttribute("height",si),Ri.scale(1/It,1/It),Ri.translate(ri*It/2,si*It/2),Ri.rotate(-$t),Ri.font=_i+" "+(Xe*It).toString(10)+"px "+g.fontFamily,Ri.fillStyle="#000",Ri.textBaseline="middle",Ri.fillText(ke,L*It,(Ve+Xe*.5)*It);var $i=Ri.getImageData(0,0,ri,si).data;if(wi())return!1;for(var Jt=[],xi=xt,Ai,Wi,Ci,rr=[ht/2,xt/2,ht/2,xt/2];xi--;)for(Ai=ht;Ai--;){Ci=A;e:for(;Ci--;)for(Wi=A;Wi--;)if($i[((Ai*A+Ci)*ri+(xi*A+Wi))*4+3]){Jt.push([xi,Ai]),xi<rr[3]&&(rr[3]=xi),xi>rr[1]&&(rr[1]=xi),Ai<rr[0]&&(rr[0]=Ai),Ai>rr[2]&&(rr[2]=Ai);break e}}return{mu:It,occupied:Jt,bounds:rr,gw:xt,gh:ht,fillTextOffsetX:L,fillTextOffsetY:Ve,fillTextWidth:sr,fillTextHeight:P,fontSize:Xe}},Zi=function(ke,_t,$t,at,Xe){for(var It=Xe.length;It--;){var _i=ke+Xe[It][0],vi=_t+Xe[It][1];if(_i>=U||vi>=_||_i<0||vi<0){if(!g.drawOutOfBound)return!1;continue}if(!ue[_i][vi])return!1}return!0},fr=function(ke,_t,$t,at,Xe,It,_i,vi,Ri,sr){var P=$t.fontSize,ki;kt?ki=kt(at,Xe,P,It,_i,sr):ki=g.color;var Ni;ze?Ni=ze(at,Xe,P,sr):Ni=g.fontWeight;var Gi;Je?Gi=Je(at,Xe,P,sr):Gi=g.classes,p.forEach(function(q){if(q.getContext){var L=q.getContext("2d"),Ve=$t.mu;L.save(),L.scale(1/Ve,1/Ve),L.font=Ni+" "+(P*Ve).toString(10)+"px "+g.fontFamily,L.fillStyle=ki,L.translate((ke+$t.gw/2)*A*Ve,(_t+$t.gh/2)*A*Ve),vi!==0&&L.rotate(-vi),L.textBaseline="middle",L.fillText(at,$t.fillTextOffsetX*Ve,($t.fillTextOffsetY+P*.5)*Ve),L.restore()}else{var ht=document.createElement("span"),xt="";xt="rotate("+-vi/Math.PI*180+"deg) ",$t.mu!==1&&(xt+="translateX(-"+$t.fillTextWidth/4+"px) scale("+1/$t.mu+")");var ri={position:"absolute",display:"block",font:Ni+" "+P*$t.mu+"px "+g.fontFamily,left:(ke+$t.gw/2)*A+$t.fillTextOffsetX+"px",top:(_t+$t.gh/2)*A+$t.fillTextOffsetY+"px",width:$t.fillTextWidth+"px",height:$t.fillTextHeight+"px",lineHeight:P+"px",whiteSpace:"nowrap",transform:xt,webkitTransform:xt,msTransform:xt,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};ki&&(ri.color=ki),ht.textContent=at;for(var si in ri)ht.style[si]=ri[si];if(Ri)for(var $i in Ri)ht.setAttribute($i,Ri[$i]);Gi&&(ht.className+=Gi),q.appendChild(ht)}})},Ti=function(ke,_t,$t,at,Xe){if(!(ke>=U||_t>=_||ke<0||_t<0)){if(ue[ke][_t]=!1,$t){var It=p[0].getContext("2d");It.fillRect(ke*A,_t*A,k,k)}St&&(Te[ke][_t]={item:Xe,dimension:at})}},Lt=function(ke,_t,$t,at,Xe,It){var _i=Xe.occupied,vi=g.drawMask,Ri;vi&&(Ri=p[0].getContext("2d"),Ri.save(),Ri.fillStyle=g.maskColor);var sr;if(St){var P=Xe.bounds;sr={x:(ke+P[3])*A,y:(_t+P[0])*A,w:(P[1]-P[3]+1)*A,h:(P[2]-P[0]+1)*A}}for(var ki=_i.length;ki--;){var Ni=ke+_i[ki][0],Gi=_t+_i[ki][1];Ni>=U||Gi>=_||Ni<0||Gi<0||Ti(Ni,Gi,vi,sr,It)}vi&&Ri.restore()},je=function Ut(ke){var _t,$t,at;Array.isArray(ke)?(_t=ke[0],$t=ke[1]):(_t=ke.word,$t=ke.weight,at=ke.attributes);var Xe=Bi(),It=s(ke),_i=Ei(_t,$t,Xe,It);if(!_i||wi())return!1;if(!g.drawOutOfBound&&!g.shrinkToFit){var vi=_i.bounds;if(vi[1]-vi[3]+1>U||vi[2]-vi[0]+1>_)return!1}for(var Ri=Me+1,sr=function(Ni){var Gi=Math.floor(Ni[0]-_i.gw/2),q=Math.floor(Ni[1]-_i.gh/2),L=_i.gw,Ve=_i.gh;return Zi(Gi,q,L,Ve,_i.occupied)?(fr(Gi,q,_i,_t,$t,Me-Ri,Ni[2],Xe,at,It),Lt(Gi,q,L,Ve,_i,ke),!0):!1};Ri--;){var P=Ot(Me-Ri);g.shuffle&&(P=[].concat(P),o(P));var ki=P.some(sr);if(ki)return!0}return g.shrinkToFit?(Array.isArray(ke)?ke[1]=ke[1]*3/4:ke.weight=ke.weight*3/4,Ut(ke)):!1},mt=function(ke,_t,$t){if(_t)return!p.some(function(at){var Xe=new CustomEvent(ke,{detail:$t||{}});return!at.dispatchEvent(Xe)},this);p.forEach(function(at){var Xe=new CustomEvent(ke,{detail:$t||{}});at.dispatchEvent(Xe)},this)},Vt=function(){var ke=p[0];if(ke.getContext)U=Math.ceil(ke.width/A),_=Math.ceil(ke.height/A);else{var _t=ke.getBoundingClientRect();U=Math.ceil(_t.width/A),_=Math.ceil(_t.height/A)}if(mt("wordcloudstart",!0)){Se=g.origin?[g.origin[0]/A,g.origin[1]/A]:[U/2,_/2],Me=Math.floor(Math.sqrt(U*U+_*_)),ue=[];var $t,at,Xe;if(!ke.getContext||g.clearCanvas)for(p.forEach(function(L){if(L.getContext){var Ve=L.getContext("2d");Ve.fillStyle=g.backgroundColor,Ve.clearRect(0,0,U*(A+1),_*(A+1)),Ve.fillRect(0,0,U*(A+1),_*(A+1))}else L.textContent="",L.style.backgroundColor=g.backgroundColor,L.style.position="relative"}),$t=U;$t--;)for(ue[$t]=[],at=_;at--;)ue[$t][at]=!0;else{var It=document.createElement("canvas").getContext("2d");It.fillStyle=g.backgroundColor,It.fillRect(0,0,1,1);var _i=It.getImageData(0,0,1,1).data,vi=ke.getContext("2d").getImageData(0,0,U*A,_*A).data;$t=U;for(var Ri,sr;$t--;)for(ue[$t]=[],at=_;at--;){sr=A;e:for(;sr--;)for(Ri=A;Ri--;)for(Xe=4;Xe--;)if(vi[((at*A+sr)*U*A+($t*A+Ri))*4+Xe]!==_i[Xe]){ue[$t][at]=!1;break e}ue[$t][at]!==!1&&(ue[$t][at]=!0)}vi=It=_i=void 0}if(g.hover||g.click){for(St=!0,$t=U+1;$t--;)Te[$t]=[];g.hover&&ke.addEventListener("mousemove",yt),g.click&&(ke.addEventListener("click",Ue),ke.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),ke.addEventListener("wordcloudstart",function L(){ke.removeEventListener("wordcloudstart",L),ke.removeEventListener("mousemove",yt),ke.removeEventListener("click",Ue),dt=void 0})}Xe=0;var P,ki;g.wait!==0?(P=window.setTimeout,ki=window.clearTimeout):(P=window.setImmediate,ki=window.clearImmediate);var Ni=function(Ve,ht){p.forEach(function(xt){xt.addEventListener(Ve,ht)},this)},Gi=function(Ve,ht){p.forEach(function(xt){xt.removeEventListener(Ve,ht)},this)},q=function L(){Gi("wordcloudstart",L),ki(a[m])};Ni("wordcloudstart",q),a[m]=P(function L(){if(Xe>=g.list.length){ki(a[m]),mt("wordcloudstop",!1),Gi("wordcloudstart",q),delete a[m];return}Ke=new Date().getTime();var Ve=je(g.list[Xe]),ht=!mt("wordclouddrawn",!0,{item:g.list[Xe],drawn:Ve});if(wi()||ht){ki(a[m]),g.abort(),mt("wordcloudabort",!1),mt("wordcloudstop",!1),Gi("wordcloudstart",q),delete a[m];return}Xe++,a[m]=P(L,g.wait)},g.wait)}};Vt()};l.isSupported=t,l.minFontSize=r,l.stop=function(){if(a)for(var p in a)window.clearImmediate(a[p])},i.exports?i.exports=l:e.WordCloud=l}(commonjsGlobal)})(wordcloud2);class RowChart extends CategoryChart{constructor(e,t,r){super(e,t,r,{x:{}}),this.config.type="row_chart",this.onDataFiltered(null),this.labelg=this.graph_area.append("g"),this.wordcloudCanvas=createEl("canvas",{styles:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"}},this.contentDiv)}drawWordCloud(e){const t=this.dataStore.getColumnValues(this.config.param),r=this.dataStore.getColumnColors(this.config.param),s=w=>this.filter.length>0&&this.filter.indexOf(w)===-1?"lightgray":r[t.indexOf(w)],o=(w,E,A)=>this.filterCategories(w[0],A.shiftKey),a=e.map(w=>[t[w[1]],Math.log(w[0])]),l=Math.max(...a.map(w=>w[1])),u=this.wordcloudCanvas;u.width=this.contentDiv.clientWidth,u.height=this.contentDiv.clientHeight;const p=this.config.wordSize/l,d=Math.PI/2;u.style.display="block",this.graph_area.style.display="none";const m=getComputedStyle(u).getPropertyValue("--main_panel_color"),g={list:a,color:s,click:o,weightFactor:p,backgroundColor:m,minRotation:-d,maxRotation:d,rotationSteps:2};console.log("wordcloud options",g),wordcloud2Exports(u,g)}drawChart(e=400){const t=this.config,r=select(this.contentDiv).transition().duration(e).ease(linear),s=this.width-this.margins.left-this.margins.right,o=this.height-this.margins.bottom-this.margins.top,a=this.dataStore.getColumnColors(this.config.param),l=this.dataStore.getColumnValues(this.config.param),u=s/this.maxCount,p=this;let d=this.rowData;if(this.maxCount,t.exclude_categories){const E=new Set;for(let A of t.exclude_categories)E.add(l.indexOf(A));d=this.rowData.filter((A,k)=>!E.has(k)),d.reduce((A,k)=>Math.max(A[0],k[0]))}if(this.config.wordcloud){this.drawWordCloud(d);return}this.wordcloudCanvas.style.display="none",this.graph_area.style.display="block";const m=d.length,g=(o-(m+1)*3)/m;let w=Math.round(g);w=w>20?20:w,this.x_scale.domain([0,this.maxCount]),this.updateAxis(),this.labelg.selectAll(".row-bar").data(d,E=>E[1]).join("rect").attr("class","row-bar").on("click",(E,A)=>{p.filterCategories(l[A[1]],E.shiftKey)}).transition(r).style("fill",E=>{const A=E[1];return p.filter.length>0&&p.filter.indexOf(l[A])===-1?"lightgray":a[A]}).attr("class","row-bar").attr("x",0).attr("width",E=>E[0]*u).attr("y",(E,A)=>(A+1)*3+A*g).attr("height",g),this.graph_area.selectAll(".row-text").data(d,E=>E[1]).join("text").on("click",(E,A)=>{p.filterCategories(l[A[1]],E.shiftKey)}).attr("class","row-text").transition(r).text(E=>l[E[1]]===""?"none":l[E[1]]).attr("font-size",w+"px").attr("x",5).style("fill","currentColor").attr("y",(E,A)=>(A+1)*3+A*g+g/2).attr("dominant-baseline","central")}getSettings(){const e=super.getSettings(),t=this.config;if(t.wordcloud)return this.getWordCloudSettings();const r=Math.max(this.data.length||60);return e.concat([{type:"spinner",label:"Max Rows",current_value:t.show_limit||r,max:r,func:s=>{t.show_limit=s,this.updateData(),this.drawChart()}},{type:"check",label:"Hide zero values",current_value:t.filter_zeros,func:s=>{t.filter_zeros=s,this.updateData(),this.drawChart()}},{type:"radiobuttons",label:"Sort Order",current_value:t.sort||"default",choices:[["Default","default"],["Size","size"],["Name","name"]],func:s=>{t.sort=s,this.updateData(),this.drawChart()}},{type:"check",label:"Display as WordCloud",current_value:t.wordcloud,func:s=>{t.wordcloud=s,this.drawChart()}}])}getWordCloudSettings(){super.getSettings();const e=this.config;return[{type:"slider",label:"Word Size",current_value:e.wordSize||100,min:10,max:100,func:t=>{e.wordSize=t,this.drawChart()}}]}}BaseChart.types.row_chart={class:RowChart,name:"Row Chart",params:[{type:["text","multitext"],name:"Category"}]};BaseChart.types.wordcloud={class:RowChart,name:"Word Cloud",params:[{type:["text","multitext"],name:"Category"}],init:(i,e)=>{i.wordcloud=!0,i.wordSize=20}};function EventData(){var i=!1,e=!1;this.stopPropagation=function(){i=!0},this.isPropagationStopped=function(){return i},this.stopImmediatePropagation=function(){e=!0},this.isImmediatePropagationStopped=function(){return e}}function Event$1(){var i=[];this.subscribe=function(e){i.push(e)},this.unsubscribe=function(e){for(var t=i.length-1;t>=0;t--)i[t]===e&&i.splice(t,1)},this.notify=function(e,t,r){t=t||new EventData,r=r||this;for(var s,o=0;o<i.length&&!(t.isPropagationStopped()||t.isImmediatePropagationStopped());o++)s=i[o].call(r,t,e);return s}}function EventHandler(){var i=[];this.subscribe=function(e,t){return i.push({event:e,handler:t}),e.subscribe(t),this},this.unsubscribe=function(e,t){for(var r=i.length;r--;)if(i[r].event===e&&i[r].handler===t){i.splice(r,1),e.unsubscribe(t);return}return this},this.unsubscribeAll=function(){for(var e=i.length;e--;)i[e].event.unsubscribe(i[e].handler);return i=[],this}}function Range(i,e,t,r){t===void 0&&r===void 0&&(t=i,r=e),this.fromRow=Math.min(i,t),this.fromCell=Math.min(e,r),this.toRow=Math.max(i,t),this.toCell=Math.max(e,r),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(s,o){return s>=this.fromRow&&s<=this.toRow&&o>=this.fromCell&&o<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}}function NonDataItem(){this.__nonDataRow=!0}function Group(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.selectChecked=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}Group.prototype=new NonDataItem;Group.prototype.equals=function(i){return this.value===i.value&&this.count===i.count&&this.collapsed===i.collapsed&&this.title===i.title};function GroupTotals(){this.__groupTotals=!0,this.group=null,this.initialized=!1}GroupTotals.prototype=new NonDataItem;function EditorLock(){var i=null;this.isActive=function(e){return e?i===e:i!==null},this.activate=function(e){if(e!==i){if(i!==null)throw new Error("SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController");if(!e.commitCurrentEdit)throw new Error("SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()");if(!e.cancelCurrentEdit)throw new Error("SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()");i=e}},this.deactivate=function(e){if(i){if(i!==e)throw new Error("SlickGrid.EditorLock.deactivate: specified editController is not the currently active one");i=null}},this.commitCurrentEdit=function(){return i?i.commitCurrentEdit():!0},this.cancelCurrentEdit=function(){return i?i.cancelCurrentEdit():!0}}function TreeColumns(i){var e={};function t(){r(i)}function r(m){m.forEach(function(g){e[g.id]=g,g.columns&&r(g.columns)})}function s(m,g){return m.filter(function(w){var E=g.call(w);return E&&w.columns&&(w.columns=s(w.columns,g)),E&&(!w.columns||w.columns.length)})}function o(m,g){m.sort(function(w,E){var A=a(g.getColumnIndex(w.id)),k=a(g.getColumnIndex(E.id));return A-k}).forEach(function(w){w.columns&&o(w.columns,g)})}function a(m){return typeof m>"u"?-1:m}function l(m){if(m.length)for(var g in m)return l(m[g]);else return m.columns?1+l(m.columns):1}function u(m,g,w){var E=[];if(w=w||0,g==w)return m.length&&m.forEach(function(k){k.columns&&(k.extractColumns=function(){return p(k)})}),m;for(var A in m)m[A].columns&&(E=E.concat(u(m[A].columns,g,w+1)));return E}function p(m){var g=[];if(m.hasOwnProperty("length"))for(var w=0;w<m.length;w++)g=g.concat(p(m[w]));else if(m.hasOwnProperty("columns"))g=g.concat(p(m.columns));else return m;return g}function d(){return JSON.parse(JSON.stringify(nodesArray))}t(),this.hasDepth=function(){for(var m in i)if(i[m].hasOwnProperty("columns"))return!0;return!1},this.getTreeColumns=function(){return i},this.extractColumns=function(){return this.hasDepth()?p(i):i},this.getDepth=function(){return l(i)},this.getColumnsInDepth=function(m){return u(i,m)},this.getColumnsInGroup=function(m){return p(m)},this.visibleColumns=function(){return s(d(),function(){return this.visible})},this.filter=function(m){return s(d(),m)},this.reOrder=function(m){return o(i,m)},this.getById=function(m){return e[m]},this.getInIds=function(m){return m.map(function(g){return e[g]})}}var Map$1="Map"in window?window.Map:function(){var e={};this.get=function(t){return e[t]},this.set=function(t,r){e[t]=r},this.has=function(t){return t in e},this.delete=function(t){delete e[t]}};const Slick={Event:Event$1,EventData,EventHandler,Range,Map:Map$1,NonDataRow:NonDataItem,Group,GroupTotals,EditorLock,GlobalEditorLock:new EditorLock,TreeColumns,keyCode:{SPACE:8,BACKSPACE:8,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,RIGHT:39,TAB:9,UP:38,A:65},preClickClassName:"slick-edit-preclick",GridAutosizeColsMode:{None:"NOA",LegacyOff:"LOF",LegacyForceFit:"LFF",IgnoreViewport:"IGV",FitColsToViewport:"FCV",FitViewportToCols:"FVC"},ColAutosizeMode:{Locked:"LCK",Guide:"GUI",Content:"CON",ContentIntelligent:"CTI"},RowSelectionMode:{FirstRow:"FS1",FirstNRows:"FSN",AllRows:"ALL",LastRow:"LS1"},ValueFilterMode:{None:"NONE",DeDuplicate:"DEDP",GetGreatestAndSub:"GR8T",GetLongestTextAndSub:"LNSB",GetLongestText:"LNSC"},WidthEvalMode:{CanvasTextSize:"CANV",HTML:"HTML"}};var jqueryExports={},jquery={get exports(){return jqueryExports},set exports(i){jqueryExports=i}};/*!
 * jQuery JavaScript Library v3.6.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2022-08-26T17:52Z
 */(function(i){(function(e,t){i.exports=e.document?t(e,!0):function(r){if(!r.document)throw new Error("jQuery requires a window with a document");return t(r)}})(typeof window<"u"?window:commonjsGlobal,function(e,t){var r=[],s=Object.getPrototypeOf,o=r.slice,a=r.flat?function(f){return r.flat.call(f)}:function(f){return r.concat.apply([],f)},l=r.push,u=r.indexOf,p={},d=p.toString,m=p.hasOwnProperty,g=m.toString,w=g.call(Object),E={},A=function(v){return typeof v=="function"&&typeof v.nodeType!="number"&&typeof v.item!="function"},k=function(v){return v!=null&&v===v.window},O=e.document,ne={type:!0,src:!0,nonce:!0,noModule:!0};function Q(f,v,C){C=C||O;var S,T,D=C.createElement("script");if(D.text=f,v)for(S in ne)T=v[S]||v.getAttribute&&v.getAttribute(S),T&&D.setAttribute(S,T);C.head.appendChild(D).parentNode.removeChild(D)}function ue(f){return f==null?f+"":typeof f=="object"||typeof f=="function"?p[d.call(f)]||"object":typeof f}var U="3.6.1",_=function(f,v){return new _.fn.init(f,v)};_.fn=_.prototype={jquery:U,constructor:_,length:0,toArray:function(){return o.call(this)},get:function(f){return f==null?o.call(this):f<0?this[f+this.length]:this[f]},pushStack:function(f){var v=_.merge(this.constructor(),f);return v.prevObject=this,v},each:function(f){return _.each(this,f)},map:function(f){return this.pushStack(_.map(this,function(v,C){return f.call(v,C,v)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(_.grep(this,function(f,v){return(v+1)%2}))},odd:function(){return this.pushStack(_.grep(this,function(f,v){return v%2}))},eq:function(f){var v=this.length,C=+f+(f<0?v:0);return this.pushStack(C>=0&&C<v?[this[C]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:r.sort,splice:r.splice},_.extend=_.fn.extend=function(){var f,v,C,S,T,D,M=arguments[0]||{},ie=1,K=arguments.length,he=!1;for(typeof M=="boolean"&&(he=M,M=arguments[ie]||{},ie++),typeof M!="object"&&!A(M)&&(M={}),ie===K&&(M=this,ie--);ie<K;ie++)if((f=arguments[ie])!=null)for(v in f)S=f[v],!(v==="__proto__"||M===S)&&(he&&S&&(_.isPlainObject(S)||(T=Array.isArray(S)))?(C=M[v],T&&!Array.isArray(C)?D=[]:!T&&!_.isPlainObject(C)?D={}:D=C,T=!1,M[v]=_.extend(he,D,S)):S!==void 0&&(M[v]=S));return M},_.extend({expando:"jQuery"+(U+Math.random()).replace(/\D/g,""),isReady:!0,error:function(f){throw new Error(f)},noop:function(){},isPlainObject:function(f){var v,C;return!f||d.call(f)!=="[object Object]"?!1:(v=s(f),v?(C=m.call(v,"constructor")&&v.constructor,typeof C=="function"&&g.call(C)===w):!0)},isEmptyObject:function(f){var v;for(v in f)return!1;return!0},globalEval:function(f,v,C){Q(f,{nonce:v&&v.nonce},C)},each:function(f,v){var C,S=0;if(Se(f))for(C=f.length;S<C&&v.call(f[S],S,f[S])!==!1;S++);else for(S in f)if(v.call(f[S],S,f[S])===!1)break;return f},makeArray:function(f,v){var C=v||[];return f!=null&&(Se(Object(f))?_.merge(C,typeof f=="string"?[f]:f):l.call(C,f)),C},inArray:function(f,v,C){return v==null?-1:u.call(v,f,C)},merge:function(f,v){for(var C=+v.length,S=0,T=f.length;S<C;S++)f[T++]=v[S];return f.length=T,f},grep:function(f,v,C){for(var S,T=[],D=0,M=f.length,ie=!C;D<M;D++)S=!v(f[D],D),S!==ie&&T.push(f[D]);return T},map:function(f,v,C){var S,T,D=0,M=[];if(Se(f))for(S=f.length;D<S;D++)T=v(f[D],D,C),T!=null&&M.push(T);else for(D in f)T=v(f[D],D,C),T!=null&&M.push(T);return a(M)},guid:1,support:E}),typeof Symbol=="function"&&(_.fn[Symbol.iterator]=r[Symbol.iterator]),_.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(f,v){p["[object "+v+"]"]=v.toLowerCase()});function Se(f){var v=!!f&&"length"in f&&f.length,C=ue(f);return A(f)||k(f)?!1:C==="array"||v===0||typeof v=="number"&&v>0&&v-1 in f}var Me=function(f){var v,C,S,T,D,M,ie,K,he,Re,et,xe,Pe,Yt,ai,jt,yr,dr,Pr,Ii="sizzle"+1*new Date,fi=f.document,Fr=0,Di=0,ci=_n(),Bn=_n(),Ns=_n(),nr=_n(),cn=function(z,Z){return z===Z&&(et=!0),0},Zr={}.hasOwnProperty,hr=[],Jr=hr.pop,Mr=hr.push,zr=hr.push,ds=hr.slice,yn=function(z,Z){for(var oe=0,Oe=z.length;oe<Oe;oe++)if(z[oe]===Z)return oe;return-1},hs="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Pi="[\\x20\\t\\r\\n\\f]",Tn="(?:\\\\[\\da-fA-F]{1,6}"+Pi+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",Lo="\\["+Pi+"*("+Tn+")(?:"+Pi+"*([*^$|!~]?=)"+Pi+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Tn+"))|)"+Pi+"*\\]",no=":("+Tn+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Lo+")*)|.*)\\)|)",na=new RegExp(Pi+"+","g"),Hn=new RegExp("^"+Pi+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Pi+"+$","g"),zs=new RegExp("^"+Pi+"*,"+Pi+"*"),Is=new RegExp("^"+Pi+"*([>+~]|"+Pi+")"+Pi+"*"),so=new RegExp(Pi+"|>"),Gn=new RegExp(no),oo=new RegExp("^"+Tn+"$"),Wn={ID:new RegExp("^#("+Tn+")"),CLASS:new RegExp("^\\.("+Tn+")"),TAG:new RegExp("^("+Tn+"|[*])"),ATTR:new RegExp("^"+Lo),PSEUDO:new RegExp("^"+no),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+Pi+"*(even|odd|(([+-]|)(\\d*)n|)"+Pi+"*(?:([+-]|)"+Pi+"*(\\d+)|))"+Pi+"*\\)|)","i"),bool:new RegExp("^(?:"+hs+")$","i"),needsContext:new RegExp("^"+Pi+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+Pi+"*((?:-\\d)?\\d*)"+Pi+"*\\)|)(?=[^-]|$)","i")},ao=/HTML$/i,lo=/^(?:input|select|textarea|button)$/i,Mo=/^h\d$/i,Vn=/^[^{]+\{\s*\[native \w/,$o=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Os=/[+~]/,en=new RegExp("\\\\[\\da-fA-F]{1,6}"+Pi+"?|\\\\([^\\r\\n\\f])","g"),tn=function(z,Z){var oe="0x"+z.slice(1)-65536;return Z||(oe<0?String.fromCharCode(oe+65536):String.fromCharCode(oe>>10|55296,oe&1023|56320))},co=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,uo=function(z,Z){return Z?z==="\0"?"":z.slice(0,-1)+"\\"+z.charCodeAt(z.length-1).toString(16)+" ":"\\"+z},kn=function(){xe()},fo=ms(function(z){return z.disabled===!0&&z.nodeName.toLowerCase()==="fieldset"},{dir:"parentNode",next:"legend"});try{zr.apply(hr=ds.call(fi.childNodes),fi.childNodes),hr[fi.childNodes.length].nodeType}catch{zr={apply:hr.length?function(Z,oe){Mr.apply(Z,ds.call(oe))}:function(Z,oe){for(var Oe=Z.length,me=0;Z[Oe++]=oe[me++];);Z.length=Oe-1}}}function Oi(z,Z,oe,Oe){var me,Be,st,At,Et,Qt,ei,oi=Z&&Z.ownerDocument,bi=Z?Z.nodeType:9;if(oe=oe||[],typeof z!="string"||!z||bi!==1&&bi!==9&&bi!==11)return oe;if(!Oe&&(xe(Z),Z=Z||Pe,ai)){if(bi!==11&&(Et=$o.exec(z)))if(me=Et[1]){if(bi===9)if(st=Z.getElementById(me)){if(st.id===me)return oe.push(st),oe}else return oe;else if(oi&&(st=oi.getElementById(me))&&Pr(Z,st)&&st.id===me)return oe.push(st),oe}else{if(Et[2])return zr.apply(oe,Z.getElementsByTagName(z)),oe;if((me=Et[3])&&C.getElementsByClassName&&Z.getElementsByClassName)return zr.apply(oe,Z.getElementsByClassName(me)),oe}if(C.qsa&&!nr[z+" "]&&(!jt||!jt.test(z))&&(bi!==1||Z.nodeName.toLowerCase()!=="object")){if(ei=z,oi=Z,bi===1&&(so.test(z)||Is.test(z))){for(oi=Os.test(z)&&po(Z.parentNode)||Z,(oi!==Z||!C.scope)&&((At=Z.getAttribute("id"))?At=At.replace(co,uo):Z.setAttribute("id",At=Ii)),Qt=M(z),Be=Qt.length;Be--;)Qt[Be]=(At?"#"+At:":scope")+" "+ps(Qt[Be]);ei=Qt.join(",")}try{return zr.apply(oe,oi.querySelectorAll(ei)),oe}catch{nr(z,!0)}finally{At===Ii&&Z.removeAttribute("id")}}}return K(z.replace(Hn,"$1"),Z,oe,Oe)}function _n(){var z=[];function Z(oe,Oe){return z.push(oe+" ")>S.cacheLength&&delete Z[z.shift()],Z[oe+" "]=Oe}return Z}function Wr(z){return z[Ii]=!0,z}function Vr(z){var Z=Pe.createElement("fieldset");try{return!!z(Z)}catch{return!1}finally{Z.parentNode&&Z.parentNode.removeChild(Z),Z=null}}function ho(z,Z){for(var oe=z.split("|"),Oe=oe.length;Oe--;)S.attrHandle[oe[Oe]]=Z}function Bs(z,Z){var oe=Z&&z,Oe=oe&&z.nodeType===1&&Z.nodeType===1&&z.sourceIndex-Z.sourceIndex;if(Oe)return Oe;if(oe){for(;oe=oe.nextSibling;)if(oe===Z)return-1}return z?1:-1}function sa(z){return function(Z){var oe=Z.nodeName.toLowerCase();return oe==="input"&&Z.type===z}}function oa(z){return function(Z){var oe=Z.nodeName.toLowerCase();return(oe==="input"||oe==="button")&&Z.type===z}}function Fo(z){return function(Z){return"form"in Z?Z.parentNode&&Z.disabled===!1?"label"in Z?"label"in Z.parentNode?Z.parentNode.disabled===z:Z.disabled===z:Z.isDisabled===z||Z.isDisabled!==!z&&fo(Z)===z:Z.disabled===z:"label"in Z?Z.disabled===z:!1}}function un(z){return Wr(function(Z){return Z=+Z,Wr(function(oe,Oe){for(var me,Be=z([],oe.length,Z),st=Be.length;st--;)oe[me=Be[st]]&&(oe[me]=!(Oe[me]=oe[me]))})})}function po(z){return z&&typeof z.getElementsByTagName<"u"&&z}C=Oi.support={},D=Oi.isXML=function(z){var Z=z&&z.namespaceURI,oe=z&&(z.ownerDocument||z).documentElement;return!ao.test(Z||oe&&oe.nodeName||"HTML")},xe=Oi.setDocument=function(z){var Z,oe,Oe=z?z.ownerDocument||z:fi;return Oe==Pe||Oe.nodeType!==9||!Oe.documentElement||(Pe=Oe,Yt=Pe.documentElement,ai=!D(Pe),fi!=Pe&&(oe=Pe.defaultView)&&oe.top!==oe&&(oe.addEventListener?oe.addEventListener("unload",kn,!1):oe.attachEvent&&oe.attachEvent("onunload",kn)),C.scope=Vr(function(me){return Yt.appendChild(me).appendChild(Pe.createElement("div")),typeof me.querySelectorAll<"u"&&!me.querySelectorAll(":scope fieldset div").length}),C.attributes=Vr(function(me){return me.className="i",!me.getAttribute("className")}),C.getElementsByTagName=Vr(function(me){return me.appendChild(Pe.createComment("")),!me.getElementsByTagName("*").length}),C.getElementsByClassName=Vn.test(Pe.getElementsByClassName),C.getById=Vr(function(me){return Yt.appendChild(me).id=Ii,!Pe.getElementsByName||!Pe.getElementsByName(Ii).length}),C.getById?(S.filter.ID=function(me){var Be=me.replace(en,tn);return function(st){return st.getAttribute("id")===Be}},S.find.ID=function(me,Be){if(typeof Be.getElementById<"u"&&ai){var st=Be.getElementById(me);return st?[st]:[]}}):(S.filter.ID=function(me){var Be=me.replace(en,tn);return function(st){var At=typeof st.getAttributeNode<"u"&&st.getAttributeNode("id");return At&&At.value===Be}},S.find.ID=function(me,Be){if(typeof Be.getElementById<"u"&&ai){var st,At,Et,Qt=Be.getElementById(me);if(Qt){if(st=Qt.getAttributeNode("id"),st&&st.value===me)return[Qt];for(Et=Be.getElementsByName(me),At=0;Qt=Et[At++];)if(st=Qt.getAttributeNode("id"),st&&st.value===me)return[Qt]}return[]}}),S.find.TAG=C.getElementsByTagName?function(me,Be){if(typeof Be.getElementsByTagName<"u")return Be.getElementsByTagName(me);if(C.qsa)return Be.querySelectorAll(me)}:function(me,Be){var st,At=[],Et=0,Qt=Be.getElementsByTagName(me);if(me==="*"){for(;st=Qt[Et++];)st.nodeType===1&&At.push(st);return At}return Qt},S.find.CLASS=C.getElementsByClassName&&function(me,Be){if(typeof Be.getElementsByClassName<"u"&&ai)return Be.getElementsByClassName(me)},yr=[],jt=[],(C.qsa=Vn.test(Pe.querySelectorAll))&&(Vr(function(me){var Be;Yt.appendChild(me).innerHTML="<a id='"+Ii+"'></a><select id='"+Ii+"-\r\\' msallowcapture=''><option selected=''></option></select>",me.querySelectorAll("[msallowcapture^='']").length&&jt.push("[*^$]="+Pi+`*(?:''|"")`),me.querySelectorAll("[selected]").length||jt.push("\\["+Pi+"*(?:value|"+hs+")"),me.querySelectorAll("[id~="+Ii+"-]").length||jt.push("~="),Be=Pe.createElement("input"),Be.setAttribute("name",""),me.appendChild(Be),me.querySelectorAll("[name='']").length||jt.push("\\["+Pi+"*name"+Pi+"*="+Pi+`*(?:''|"")`),me.querySelectorAll(":checked").length||jt.push(":checked"),me.querySelectorAll("a#"+Ii+"+*").length||jt.push(".#.+[+~]"),me.querySelectorAll("\\\f"),jt.push("[\\r\\n\\f]")}),Vr(function(me){me.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var Be=Pe.createElement("input");Be.setAttribute("type","hidden"),me.appendChild(Be).setAttribute("name","D"),me.querySelectorAll("[name=d]").length&&jt.push("name"+Pi+"*[*^$|!~]?="),me.querySelectorAll(":enabled").length!==2&&jt.push(":enabled",":disabled"),Yt.appendChild(me).disabled=!0,me.querySelectorAll(":disabled").length!==2&&jt.push(":enabled",":disabled"),me.querySelectorAll("*,:x"),jt.push(",.*:")})),(C.matchesSelector=Vn.test(dr=Yt.matches||Yt.webkitMatchesSelector||Yt.mozMatchesSelector||Yt.oMatchesSelector||Yt.msMatchesSelector))&&Vr(function(me){C.disconnectedMatch=dr.call(me,"*"),dr.call(me,"[s!='']:x"),yr.push("!=",no)}),jt=jt.length&&new RegExp(jt.join("|")),yr=yr.length&&new RegExp(yr.join("|")),Z=Vn.test(Yt.compareDocumentPosition),Pr=Z||Vn.test(Yt.contains)?function(me,Be){var st=me.nodeType===9?me.documentElement:me,At=Be&&Be.parentNode;return me===At||!!(At&&At.nodeType===1&&(st.contains?st.contains(At):me.compareDocumentPosition&&me.compareDocumentPosition(At)&16))}:function(me,Be){if(Be){for(;Be=Be.parentNode;)if(Be===me)return!0}return!1},cn=Z?function(me,Be){if(me===Be)return et=!0,0;var st=!me.compareDocumentPosition-!Be.compareDocumentPosition;return st||(st=(me.ownerDocument||me)==(Be.ownerDocument||Be)?me.compareDocumentPosition(Be):1,st&1||!C.sortDetached&&Be.compareDocumentPosition(me)===st?me==Pe||me.ownerDocument==fi&&Pr(fi,me)?-1:Be==Pe||Be.ownerDocument==fi&&Pr(fi,Be)?1:Re?yn(Re,me)-yn(Re,Be):0:st&4?-1:1)}:function(me,Be){if(me===Be)return et=!0,0;var st,At=0,Et=me.parentNode,Qt=Be.parentNode,ei=[me],oi=[Be];if(!Et||!Qt)return me==Pe?-1:Be==Pe?1:Et?-1:Qt?1:Re?yn(Re,me)-yn(Re,Be):0;if(Et===Qt)return Bs(me,Be);for(st=me;st=st.parentNode;)ei.unshift(st);for(st=Be;st=st.parentNode;)oi.unshift(st);for(;ei[At]===oi[At];)At++;return At?Bs(ei[At],oi[At]):ei[At]==fi?-1:oi[At]==fi?1:0}),Pe},Oi.matches=function(z,Z){return Oi(z,null,null,Z)},Oi.matchesSelector=function(z,Z){if(xe(z),C.matchesSelector&&ai&&!nr[Z+" "]&&(!yr||!yr.test(Z))&&(!jt||!jt.test(Z)))try{var oe=dr.call(z,Z);if(oe||C.disconnectedMatch||z.document&&z.document.nodeType!==11)return oe}catch{nr(Z,!0)}return Oi(Z,Pe,null,[z]).length>0},Oi.contains=function(z,Z){return(z.ownerDocument||z)!=Pe&&xe(z),Pr(z,Z)},Oi.attr=function(z,Z){(z.ownerDocument||z)!=Pe&&xe(z);var oe=S.attrHandle[Z.toLowerCase()],Oe=oe&&Zr.call(S.attrHandle,Z.toLowerCase())?oe(z,Z,!ai):void 0;return Oe!==void 0?Oe:C.attributes||!ai?z.getAttribute(Z):(Oe=z.getAttributeNode(Z))&&Oe.specified?Oe.value:null},Oi.escape=function(z){return(z+"").replace(co,uo)},Oi.error=function(z){throw new Error("Syntax error, unrecognized expression: "+z)},Oi.uniqueSort=function(z){var Z,oe=[],Oe=0,me=0;if(et=!C.detectDuplicates,Re=!C.sortStable&&z.slice(0),z.sort(cn),et){for(;Z=z[me++];)Z===z[me]&&(Oe=oe.push(me));for(;Oe--;)z.splice(oe[Oe],1)}return Re=null,z},T=Oi.getText=function(z){var Z,oe="",Oe=0,me=z.nodeType;if(me){if(me===1||me===9||me===11){if(typeof z.textContent=="string")return z.textContent;for(z=z.firstChild;z;z=z.nextSibling)oe+=T(z)}else if(me===3||me===4)return z.nodeValue}else for(;Z=z[Oe++];)oe+=T(Z);return oe},S=Oi.selectors={cacheLength:50,createPseudo:Wr,match:Wn,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(z){return z[1]=z[1].replace(en,tn),z[3]=(z[3]||z[4]||z[5]||"").replace(en,tn),z[2]==="~="&&(z[3]=" "+z[3]+" "),z.slice(0,4)},CHILD:function(z){return z[1]=z[1].toLowerCase(),z[1].slice(0,3)==="nth"?(z[3]||Oi.error(z[0]),z[4]=+(z[4]?z[5]+(z[6]||1):2*(z[3]==="even"||z[3]==="odd")),z[5]=+(z[7]+z[8]||z[3]==="odd")):z[3]&&Oi.error(z[0]),z},PSEUDO:function(z){var Z,oe=!z[6]&&z[2];return Wn.CHILD.test(z[0])?null:(z[3]?z[2]=z[4]||z[5]||"":oe&&Gn.test(oe)&&(Z=M(oe,!0))&&(Z=oe.indexOf(")",oe.length-Z)-oe.length)&&(z[0]=z[0].slice(0,Z),z[2]=oe.slice(0,Z)),z.slice(0,3))}},filter:{TAG:function(z){var Z=z.replace(en,tn).toLowerCase();return z==="*"?function(){return!0}:function(oe){return oe.nodeName&&oe.nodeName.toLowerCase()===Z}},CLASS:function(z){var Z=ci[z+" "];return Z||(Z=new RegExp("(^|"+Pi+")"+z+"("+Pi+"|$)"))&&ci(z,function(oe){return Z.test(typeof oe.className=="string"&&oe.className||typeof oe.getAttribute<"u"&&oe.getAttribute("class")||"")})},ATTR:function(z,Z,oe){return function(Oe){var me=Oi.attr(Oe,z);return me==null?Z==="!=":Z?(me+="",Z==="="?me===oe:Z==="!="?me!==oe:Z==="^="?oe&&me.indexOf(oe)===0:Z==="*="?oe&&me.indexOf(oe)>-1:Z==="$="?oe&&me.slice(-oe.length)===oe:Z==="~="?(" "+me.replace(na," ")+" ").indexOf(oe)>-1:Z==="|="?me===oe||me.slice(0,oe.length+1)===oe+"-":!1):!0}},CHILD:function(z,Z,oe,Oe,me){var Be=z.slice(0,3)!=="nth",st=z.slice(-4)!=="last",At=Z==="of-type";return Oe===1&&me===0?function(Et){return!!Et.parentNode}:function(Et,Qt,ei){var oi,bi,Hi,ni,pr,Tr,Cr=Be!==st?"nextSibling":"previousSibling",yi=Et.parentNode,Un=At&&Et.nodeName.toLowerCase(),jn=!ei&&!At,_r=!1;if(yi){if(Be){for(;Cr;){for(ni=Et;ni=ni[Cr];)if(At?ni.nodeName.toLowerCase()===Un:ni.nodeType===1)return!1;Tr=Cr=z==="only"&&!Tr&&"nextSibling"}return!0}if(Tr=[st?yi.firstChild:yi.lastChild],st&&jn){for(ni=yi,Hi=ni[Ii]||(ni[Ii]={}),bi=Hi[ni.uniqueID]||(Hi[ni.uniqueID]={}),oi=bi[z]||[],pr=oi[0]===Fr&&oi[1],_r=pr&&oi[2],ni=pr&&yi.childNodes[pr];ni=++pr&&ni&&ni[Cr]||(_r=pr=0)||Tr.pop();)if(ni.nodeType===1&&++_r&&ni===Et){bi[z]=[Fr,pr,_r];break}}else if(jn&&(ni=Et,Hi=ni[Ii]||(ni[Ii]={}),bi=Hi[ni.uniqueID]||(Hi[ni.uniqueID]={}),oi=bi[z]||[],pr=oi[0]===Fr&&oi[1],_r=pr),_r===!1)for(;(ni=++pr&&ni&&ni[Cr]||(_r=pr=0)||Tr.pop())&&!((At?ni.nodeName.toLowerCase()===Un:ni.nodeType===1)&&++_r&&(jn&&(Hi=ni[Ii]||(ni[Ii]={}),bi=Hi[ni.uniqueID]||(Hi[ni.uniqueID]={}),bi[z]=[Fr,_r]),ni===Et)););return _r-=me,_r===Oe||_r%Oe===0&&_r/Oe>=0}}},PSEUDO:function(z,Z){var oe,Oe=S.pseudos[z]||S.setFilters[z.toLowerCase()]||Oi.error("unsupported pseudo: "+z);return Oe[Ii]?Oe(Z):Oe.length>1?(oe=[z,z,"",Z],S.setFilters.hasOwnProperty(z.toLowerCase())?Wr(function(me,Be){for(var st,At=Oe(me,Z),Et=At.length;Et--;)st=yn(me,At[Et]),me[st]=!(Be[st]=At[Et])}):function(me){return Oe(me,0,oe)}):Oe}},pseudos:{not:Wr(function(z){var Z=[],oe=[],Oe=ie(z.replace(Hn,"$1"));return Oe[Ii]?Wr(function(me,Be,st,At){for(var Et,Qt=Oe(me,null,At,[]),ei=me.length;ei--;)(Et=Qt[ei])&&(me[ei]=!(Be[ei]=Et))}):function(me,Be,st){return Z[0]=me,Oe(Z,null,st,oe),Z[0]=null,!oe.pop()}}),has:Wr(function(z){return function(Z){return Oi(z,Z).length>0}}),contains:Wr(function(z){return z=z.replace(en,tn),function(Z){return(Z.textContent||T(Z)).indexOf(z)>-1}}),lang:Wr(function(z){return oo.test(z||"")||Oi.error("unsupported lang: "+z),z=z.replace(en,tn).toLowerCase(),function(Z){var oe;do if(oe=ai?Z.lang:Z.getAttribute("xml:lang")||Z.getAttribute("lang"))return oe=oe.toLowerCase(),oe===z||oe.indexOf(z+"-")===0;while((Z=Z.parentNode)&&Z.nodeType===1);return!1}}),target:function(z){var Z=f.location&&f.location.hash;return Z&&Z.slice(1)===z.id},root:function(z){return z===Yt},focus:function(z){return z===Pe.activeElement&&(!Pe.hasFocus||Pe.hasFocus())&&!!(z.type||z.href||~z.tabIndex)},enabled:Fo(!1),disabled:Fo(!0),checked:function(z){var Z=z.nodeName.toLowerCase();return Z==="input"&&!!z.checked||Z==="option"&&!!z.selected},selected:function(z){return z.parentNode&&z.parentNode.selectedIndex,z.selected===!0},empty:function(z){for(z=z.firstChild;z;z=z.nextSibling)if(z.nodeType<6)return!1;return!0},parent:function(z){return!S.pseudos.empty(z)},header:function(z){return Mo.test(z.nodeName)},input:function(z){return lo.test(z.nodeName)},button:function(z){var Z=z.nodeName.toLowerCase();return Z==="input"&&z.type==="button"||Z==="button"},text:function(z){var Z;return z.nodeName.toLowerCase()==="input"&&z.type==="text"&&((Z=z.getAttribute("type"))==null||Z.toLowerCase()==="text")},first:un(function(){return[0]}),last:un(function(z,Z){return[Z-1]}),eq:un(function(z,Z,oe){return[oe<0?oe+Z:oe]}),even:un(function(z,Z){for(var oe=0;oe<Z;oe+=2)z.push(oe);return z}),odd:un(function(z,Z){for(var oe=1;oe<Z;oe+=2)z.push(oe);return z}),lt:un(function(z,Z,oe){for(var Oe=oe<0?oe+Z:oe>Z?Z:oe;--Oe>=0;)z.push(Oe);return z}),gt:un(function(z,Z,oe){for(var Oe=oe<0?oe+Z:oe;++Oe<Z;)z.push(Oe);return z})}},S.pseudos.nth=S.pseudos.eq;for(v in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})S.pseudos[v]=sa(v);for(v in{submit:!0,reset:!0})S.pseudos[v]=oa(v);function Hs(){}Hs.prototype=S.filters=S.pseudos,S.setFilters=new Hs,M=Oi.tokenize=function(z,Z){var oe,Oe,me,Be,st,At,Et,Qt=Bn[z+" "];if(Qt)return Z?0:Qt.slice(0);for(st=z,At=[],Et=S.preFilter;st;){(!oe||(Oe=zs.exec(st)))&&(Oe&&(st=st.slice(Oe[0].length)||st),At.push(me=[])),oe=!1,(Oe=Is.exec(st))&&(oe=Oe.shift(),me.push({value:oe,type:Oe[0].replace(Hn," ")}),st=st.slice(oe.length));for(Be in S.filter)(Oe=Wn[Be].exec(st))&&(!Et[Be]||(Oe=Et[Be](Oe)))&&(oe=Oe.shift(),me.push({value:oe,type:Be,matches:Oe}),st=st.slice(oe.length));if(!oe)break}return Z?st.length:st?Oi.error(z):Bn(z,At).slice(0)};function ps(z){for(var Z=0,oe=z.length,Oe="";Z<oe;Z++)Oe+=z[Z].value;return Oe}function ms(z,Z,oe){var Oe=Z.dir,me=Z.next,Be=me||Oe,st=oe&&Be==="parentNode",At=Di++;return Z.first?function(Et,Qt,ei){for(;Et=Et[Oe];)if(Et.nodeType===1||st)return z(Et,Qt,ei);return!1}:function(Et,Qt,ei){var oi,bi,Hi,ni=[Fr,At];if(ei){for(;Et=Et[Oe];)if((Et.nodeType===1||st)&&z(Et,Qt,ei))return!0}else for(;Et=Et[Oe];)if(Et.nodeType===1||st)if(Hi=Et[Ii]||(Et[Ii]={}),bi=Hi[Et.uniqueID]||(Hi[Et.uniqueID]={}),me&&me===Et.nodeName.toLowerCase())Et=Et[Oe]||Et;else{if((oi=bi[Be])&&oi[0]===Fr&&oi[1]===At)return ni[2]=oi[2];if(bi[Be]=ni,ni[2]=z(Et,Qt,ei))return!0}return!1}}function gs(z){return z.length>1?function(Z,oe,Oe){for(var me=z.length;me--;)if(!z[me](Z,oe,Oe))return!1;return!0}:z[0]}function aa(z,Z,oe){for(var Oe=0,me=Z.length;Oe<me;Oe++)Oi(z,Z[Oe],oe);return oe}function Dn(z,Z,oe,Oe,me){for(var Be,st=[],At=0,Et=z.length,Qt=Z!=null;At<Et;At++)(Be=z[At])&&(!oe||oe(Be,Oe,me))&&(st.push(Be),Qt&&Z.push(At));return st}function mo(z,Z,oe,Oe,me,Be){return Oe&&!Oe[Ii]&&(Oe=mo(Oe)),me&&!me[Ii]&&(me=mo(me,Be)),Wr(function(st,At,Et,Qt){var ei,oi,bi,Hi=[],ni=[],pr=At.length,Tr=st||aa(Z||"*",Et.nodeType?[Et]:Et,[]),Cr=z&&(st||!Z)?Dn(Tr,Hi,z,Et,Qt):Tr,yi=oe?me||(st?z:pr||Oe)?[]:At:Cr;if(oe&&oe(Cr,yi,Et,Qt),Oe)for(ei=Dn(yi,ni),Oe(ei,[],Et,Qt),oi=ei.length;oi--;)(bi=ei[oi])&&(yi[ni[oi]]=!(Cr[ni[oi]]=bi));if(st){if(me||z){if(me){for(ei=[],oi=yi.length;oi--;)(bi=yi[oi])&&ei.push(Cr[oi]=bi);me(null,yi=[],ei,Qt)}for(oi=yi.length;oi--;)(bi=yi[oi])&&(ei=me?yn(st,bi):Hi[oi])>-1&&(st[ei]=!(At[ei]=bi))}}else yi=Dn(yi===At?yi.splice(pr,yi.length):yi),me?me(null,At,yi,Qt):zr.apply(At,yi)})}function go(z){for(var Z,oe,Oe,me=z.length,Be=S.relative[z[0].type],st=Be||S.relative[" "],At=Be?1:0,Et=ms(function(oi){return oi===Z},st,!0),Qt=ms(function(oi){return yn(Z,oi)>-1},st,!0),ei=[function(oi,bi,Hi){var ni=!Be&&(Hi||bi!==he)||((Z=bi).nodeType?Et(oi,bi,Hi):Qt(oi,bi,Hi));return Z=null,ni}];At<me;At++)if(oe=S.relative[z[At].type])ei=[ms(gs(ei),oe)];else{if(oe=S.filter[z[At].type].apply(null,z[At].matches),oe[Ii]){for(Oe=++At;Oe<me&&!S.relative[z[Oe].type];Oe++);return mo(At>1&&gs(ei),At>1&&ps(z.slice(0,At-1).concat({value:z[At-2].type===" "?"*":""})).replace(Hn,"$1"),oe,At<Oe&&go(z.slice(At,Oe)),Oe<me&&go(z=z.slice(Oe)),Oe<me&&ps(z))}ei.push(oe)}return gs(ei)}function la(z,Z){var oe=Z.length>0,Oe=z.length>0,me=function(Be,st,At,Et,Qt){var ei,oi,bi,Hi=0,ni="0",pr=Be&&[],Tr=[],Cr=he,yi=Be||Oe&&S.find.TAG("*",Qt),Un=Fr+=Cr==null?1:Math.random()||.1,jn=yi.length;for(Qt&&(he=st==Pe||st||Qt);ni!==jn&&(ei=yi[ni])!=null;ni++){if(Oe&&ei){for(oi=0,!st&&ei.ownerDocument!=Pe&&(xe(ei),At=!ai);bi=z[oi++];)if(bi(ei,st||Pe,At)){Et.push(ei);break}Qt&&(Fr=Un)}oe&&((ei=!bi&&ei)&&Hi--,Be&&pr.push(ei))}if(Hi+=ni,oe&&ni!==Hi){for(oi=0;bi=Z[oi++];)bi(pr,Tr,st,At);if(Be){if(Hi>0)for(;ni--;)pr[ni]||Tr[ni]||(Tr[ni]=Jr.call(Et));Tr=Dn(Tr)}zr.apply(Et,Tr),Qt&&!Be&&Tr.length>0&&Hi+Z.length>1&&Oi.uniqueSort(Et)}return Qt&&(Fr=Un,he=Cr),pr};return oe?Wr(me):me}return ie=Oi.compile=function(z,Z){var oe,Oe=[],me=[],Be=Ns[z+" "];if(!Be){for(Z||(Z=M(z)),oe=Z.length;oe--;)Be=go(Z[oe]),Be[Ii]?Oe.push(Be):me.push(Be);Be=Ns(z,la(me,Oe)),Be.selector=z}return Be},K=Oi.select=function(z,Z,oe,Oe){var me,Be,st,At,Et,Qt=typeof z=="function"&&z,ei=!Oe&&M(z=Qt.selector||z);if(oe=oe||[],ei.length===1){if(Be=ei[0]=ei[0].slice(0),Be.length>2&&(st=Be[0]).type==="ID"&&Z.nodeType===9&&ai&&S.relative[Be[1].type]){if(Z=(S.find.ID(st.matches[0].replace(en,tn),Z)||[])[0],Z)Qt&&(Z=Z.parentNode);else return oe;z=z.slice(Be.shift().value.length)}for(me=Wn.needsContext.test(z)?0:Be.length;me--&&(st=Be[me],!S.relative[At=st.type]);)if((Et=S.find[At])&&(Oe=Et(st.matches[0].replace(en,tn),Os.test(Be[0].type)&&po(Z.parentNode)||Z))){if(Be.splice(me,1),z=Oe.length&&ps(Be),!z)return zr.apply(oe,Oe),oe;break}}return(Qt||ie(z,ei))(Oe,Z,!ai,oe,!Z||Os.test(z)&&po(Z.parentNode)||Z),oe},C.sortStable=Ii.split("").sort(cn).join("")===Ii,C.detectDuplicates=!!et,xe(),C.sortDetached=Vr(function(z){return z.compareDocumentPosition(Pe.createElement("fieldset"))&1}),Vr(function(z){return z.innerHTML="<a href='#'></a>",z.firstChild.getAttribute("href")==="#"})||ho("type|href|height|width",function(z,Z,oe){if(!oe)return z.getAttribute(Z,Z.toLowerCase()==="type"?1:2)}),(!C.attributes||!Vr(function(z){return z.innerHTML="<input/>",z.firstChild.setAttribute("value",""),z.firstChild.getAttribute("value")===""}))&&ho("value",function(z,Z,oe){if(!oe&&z.nodeName.toLowerCase()==="input")return z.defaultValue}),Vr(function(z){return z.getAttribute("disabled")==null})||ho(hs,function(z,Z,oe){var Oe;if(!oe)return z[Z]===!0?Z.toLowerCase():(Oe=z.getAttributeNode(Z))&&Oe.specified?Oe.value:null}),Oi}(e);_.find=Me,_.expr=Me.selectors,_.expr[":"]=_.expr.pseudos,_.uniqueSort=_.unique=Me.uniqueSort,_.text=Me.getText,_.isXMLDoc=Me.isXML,_.contains=Me.contains,_.escapeSelector=Me.escape;var Ke=function(f,v,C){for(var S=[],T=C!==void 0;(f=f[v])&&f.nodeType!==9;)if(f.nodeType===1){if(T&&_(f).is(C))break;S.push(f)}return S},kt=function(f,v){for(var C=[];f;f=f.nextSibling)f.nodeType===1&&f!==v&&C.push(f);return C},Qe=_.expr.match.needsContext;function ze(f,v){return f.nodeName&&f.nodeName.toLowerCase()===v.toLowerCase()}var Je=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function St(f,v,C){return A(v)?_.grep(f,function(S,T){return!!v.call(S,T,S)!==C}):v.nodeType?_.grep(f,function(S){return S===v!==C}):typeof v!="string"?_.grep(f,function(S){return u.call(v,S)>-1!==C}):_.filter(v,f,C)}_.filter=function(f,v,C){var S=v[0];return C&&(f=":not("+f+")"),v.length===1&&S.nodeType===1?_.find.matchesSelector(S,f)?[S]:[]:_.find.matches(f,_.grep(v,function(T){return T.nodeType===1}))},_.fn.extend({find:function(f){var v,C,S=this.length,T=this;if(typeof f!="string")return this.pushStack(_(f).filter(function(){for(v=0;v<S;v++)if(_.contains(T[v],this))return!0}));for(C=this.pushStack([]),v=0;v<S;v++)_.find(f,T[v],C);return S>1?_.uniqueSort(C):C},filter:function(f){return this.pushStack(St(this,f||[],!1))},not:function(f){return this.pushStack(St(this,f||[],!0))},is:function(f){return!!St(this,typeof f=="string"&&Qe.test(f)?_(f):f||[],!1).length}});var Te,dt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,ot=_.fn.init=function(f,v,C){var S,T;if(!f)return this;if(C=C||Te,typeof f=="string")if(f[0]==="<"&&f[f.length-1]===">"&&f.length>=3?S=[null,f,null]:S=dt.exec(f),S&&(S[1]||!v))if(S[1]){if(v=v instanceof _?v[0]:v,_.merge(this,_.parseHTML(S[1],v&&v.nodeType?v.ownerDocument||v:O,!0)),Je.test(S[1])&&_.isPlainObject(v))for(S in v)A(this[S])?this[S](v[S]):this.attr(S,v[S]);return this}else return T=O.getElementById(S[2]),T&&(this[0]=T,this.length=1),this;else return!v||v.jquery?(v||C).find(f):this.constructor(v).find(f);else{if(f.nodeType)return this[0]=f,this.length=1,this;if(A(f))return C.ready!==void 0?C.ready(f):f(_)}return _.makeArray(f,this)};ot.prototype=_.fn,Te=_(O);var yt=/^(?:parents|prev(?:Until|All))/,Ue={children:!0,contents:!0,next:!0,prev:!0};_.fn.extend({has:function(f){var v=_(f,this),C=v.length;return this.filter(function(){for(var S=0;S<C;S++)if(_.contains(this,v[S]))return!0})},closest:function(f,v){var C,S=0,T=this.length,D=[],M=typeof f!="string"&&_(f);if(!Qe.test(f)){for(;S<T;S++)for(C=this[S];C&&C!==v;C=C.parentNode)if(C.nodeType<11&&(M?M.index(C)>-1:C.nodeType===1&&_.find.matchesSelector(C,f))){D.push(C);break}}return this.pushStack(D.length>1?_.uniqueSort(D):D)},index:function(f){return f?typeof f=="string"?u.call(_(f),this[0]):u.call(this,f.jquery?f[0]:f):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(f,v){return this.pushStack(_.uniqueSort(_.merge(this.get(),_(f,v))))},addBack:function(f){return this.add(f==null?this.prevObject:this.prevObject.filter(f))}});function Nt(f,v){for(;(f=f[v])&&f.nodeType!==1;);return f}_.each({parent:function(f){var v=f.parentNode;return v&&v.nodeType!==11?v:null},parents:function(f){return Ke(f,"parentNode")},parentsUntil:function(f,v,C){return Ke(f,"parentNode",C)},next:function(f){return Nt(f,"nextSibling")},prev:function(f){return Nt(f,"previousSibling")},nextAll:function(f){return Ke(f,"nextSibling")},prevAll:function(f){return Ke(f,"previousSibling")},nextUntil:function(f,v,C){return Ke(f,"nextSibling",C)},prevUntil:function(f,v,C){return Ke(f,"previousSibling",C)},siblings:function(f){return kt((f.parentNode||{}).firstChild,f)},children:function(f){return kt(f.firstChild)},contents:function(f){return f.contentDocument!=null&&s(f.contentDocument)?f.contentDocument:(ze(f,"template")&&(f=f.content||f),_.merge([],f.childNodes))}},function(f,v){_.fn[f]=function(C,S){var T=_.map(this,v,C);return f.slice(-5)!=="Until"&&(S=C),S&&typeof S=="string"&&(T=_.filter(S,T)),this.length>1&&(Ue[f]||_.uniqueSort(T),yt.test(f)&&T.reverse()),this.pushStack(T)}});var Ot=/[^\x20\t\r\n\f]+/g;function wi(f){var v={};return _.each(f.match(Ot)||[],function(C,S){v[S]=!0}),v}_.Callbacks=function(f){f=typeof f=="string"?wi(f):_.extend({},f);var v,C,S,T,D=[],M=[],ie=-1,K=function(){for(T=T||f.once,S=v=!0;M.length;ie=-1)for(C=M.shift();++ie<D.length;)D[ie].apply(C[0],C[1])===!1&&f.stopOnFalse&&(ie=D.length,C=!1);f.memory||(C=!1),v=!1,T&&(C?D=[]:D="")},he={add:function(){return D&&(C&&!v&&(ie=D.length-1,M.push(C)),function Re(et){_.each(et,function(xe,Pe){A(Pe)?(!f.unique||!he.has(Pe))&&D.push(Pe):Pe&&Pe.length&&ue(Pe)!=="string"&&Re(Pe)})}(arguments),C&&!v&&K()),this},remove:function(){return _.each(arguments,function(Re,et){for(var xe;(xe=_.inArray(et,D,xe))>-1;)D.splice(xe,1),xe<=ie&&ie--}),this},has:function(Re){return Re?_.inArray(Re,D)>-1:D.length>0},empty:function(){return D&&(D=[]),this},disable:function(){return T=M=[],D=C="",this},disabled:function(){return!D},lock:function(){return T=M=[],!C&&!v&&(D=C=""),this},locked:function(){return!!T},fireWith:function(Re,et){return T||(et=et||[],et=[Re,et.slice?et.slice():et],M.push(et),v||K()),this},fire:function(){return he.fireWith(this,arguments),this},fired:function(){return!!S}};return he};function Bi(f){return f}function Ei(f){throw f}function Zi(f,v,C,S){var T;try{f&&A(T=f.promise)?T.call(f).done(v).fail(C):f&&A(T=f.then)?T.call(f,v,C):v.apply(void 0,[f].slice(S))}catch(D){C.apply(void 0,[D])}}_.extend({Deferred:function(f){var v=[["notify","progress",_.Callbacks("memory"),_.Callbacks("memory"),2],["resolve","done",_.Callbacks("once memory"),_.Callbacks("once memory"),0,"resolved"],["reject","fail",_.Callbacks("once memory"),_.Callbacks("once memory"),1,"rejected"]],C="pending",S={state:function(){return C},always:function(){return T.done(arguments).fail(arguments),this},catch:function(D){return S.then(null,D)},pipe:function(){var D=arguments;return _.Deferred(function(M){_.each(v,function(ie,K){var he=A(D[K[4]])&&D[K[4]];T[K[1]](function(){var Re=he&&he.apply(this,arguments);Re&&A(Re.promise)?Re.promise().progress(M.notify).done(M.resolve).fail(M.reject):M[K[0]+"With"](this,he?[Re]:arguments)})}),D=null}).promise()},then:function(D,M,ie){var K=0;function he(Re,et,xe,Pe){return function(){var Yt=this,ai=arguments,jt=function(){var dr,Pr;if(!(Re<K)){if(dr=xe.apply(Yt,ai),dr===et.promise())throw new TypeError("Thenable self-resolution");Pr=dr&&(typeof dr=="object"||typeof dr=="function")&&dr.then,A(Pr)?Pe?Pr.call(dr,he(K,et,Bi,Pe),he(K,et,Ei,Pe)):(K++,Pr.call(dr,he(K,et,Bi,Pe),he(K,et,Ei,Pe),he(K,et,Bi,et.notifyWith))):(xe!==Bi&&(Yt=void 0,ai=[dr]),(Pe||et.resolveWith)(Yt,ai))}},yr=Pe?jt:function(){try{jt()}catch(dr){_.Deferred.exceptionHook&&_.Deferred.exceptionHook(dr,yr.stackTrace),Re+1>=K&&(xe!==Ei&&(Yt=void 0,ai=[dr]),et.rejectWith(Yt,ai))}};Re?yr():(_.Deferred.getStackHook&&(yr.stackTrace=_.Deferred.getStackHook()),e.setTimeout(yr))}}return _.Deferred(function(Re){v[0][3].add(he(0,Re,A(ie)?ie:Bi,Re.notifyWith)),v[1][3].add(he(0,Re,A(D)?D:Bi)),v[2][3].add(he(0,Re,A(M)?M:Ei))}).promise()},promise:function(D){return D!=null?_.extend(D,S):S}},T={};return _.each(v,function(D,M){var ie=M[2],K=M[5];S[M[1]]=ie.add,K&&ie.add(function(){C=K},v[3-D][2].disable,v[3-D][3].disable,v[0][2].lock,v[0][3].lock),ie.add(M[3].fire),T[M[0]]=function(){return T[M[0]+"With"](this===T?void 0:this,arguments),this},T[M[0]+"With"]=ie.fireWith}),S.promise(T),f&&f.call(T,T),T},when:function(f){var v=arguments.length,C=v,S=Array(C),T=o.call(arguments),D=_.Deferred(),M=function(ie){return function(K){S[ie]=this,T[ie]=arguments.length>1?o.call(arguments):K,--v||D.resolveWith(S,T)}};if(v<=1&&(Zi(f,D.done(M(C)).resolve,D.reject,!v),D.state()==="pending"||A(T[C]&&T[C].then)))return D.then();for(;C--;)Zi(T[C],M(C),D.reject);return D.promise()}});var fr=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;_.Deferred.exceptionHook=function(f,v){e.console&&e.console.warn&&f&&fr.test(f.name)&&e.console.warn("jQuery.Deferred exception: "+f.message,f.stack,v)},_.readyException=function(f){e.setTimeout(function(){throw f})};var Ti=_.Deferred();_.fn.ready=function(f){return Ti.then(f).catch(function(v){_.readyException(v)}),this},_.extend({isReady:!1,readyWait:1,ready:function(f){(f===!0?--_.readyWait:_.isReady)||(_.isReady=!0,!(f!==!0&&--_.readyWait>0)&&Ti.resolveWith(O,[_]))}}),_.ready.then=Ti.then;function Lt(){O.removeEventListener("DOMContentLoaded",Lt),e.removeEventListener("load",Lt),_.ready()}O.readyState==="complete"||O.readyState!=="loading"&&!O.documentElement.doScroll?e.setTimeout(_.ready):(O.addEventListener("DOMContentLoaded",Lt),e.addEventListener("load",Lt));var je=function(f,v,C,S,T,D,M){var ie=0,K=f.length,he=C==null;if(ue(C)==="object"){T=!0;for(ie in C)je(f,v,ie,C[ie],!0,D,M)}else if(S!==void 0&&(T=!0,A(S)||(M=!0),he&&(M?(v.call(f,S),v=null):(he=v,v=function(Re,et,xe){return he.call(_(Re),xe)})),v))for(;ie<K;ie++)v(f[ie],C,M?S:S.call(f[ie],ie,v(f[ie],C)));return T?f:he?v.call(f):K?v(f[0],C):D},mt=/^-ms-/,Vt=/-([a-z])/g;function Ut(f,v){return v.toUpperCase()}function ke(f){return f.replace(mt,"ms-").replace(Vt,Ut)}var _t=function(f){return f.nodeType===1||f.nodeType===9||!+f.nodeType};function $t(){this.expando=_.expando+$t.uid++}$t.uid=1,$t.prototype={cache:function(f){var v=f[this.expando];return v||(v={},_t(f)&&(f.nodeType?f[this.expando]=v:Object.defineProperty(f,this.expando,{value:v,configurable:!0}))),v},set:function(f,v,C){var S,T=this.cache(f);if(typeof v=="string")T[ke(v)]=C;else for(S in v)T[ke(S)]=v[S];return T},get:function(f,v){return v===void 0?this.cache(f):f[this.expando]&&f[this.expando][ke(v)]},access:function(f,v,C){return v===void 0||v&&typeof v=="string"&&C===void 0?this.get(f,v):(this.set(f,v,C),C!==void 0?C:v)},remove:function(f,v){var C,S=f[this.expando];if(S!==void 0){if(v!==void 0)for(Array.isArray(v)?v=v.map(ke):(v=ke(v),v=v in S?[v]:v.match(Ot)||[]),C=v.length;C--;)delete S[v[C]];(v===void 0||_.isEmptyObject(S))&&(f.nodeType?f[this.expando]=void 0:delete f[this.expando])}},hasData:function(f){var v=f[this.expando];return v!==void 0&&!_.isEmptyObject(v)}};var at=new $t,Xe=new $t,It=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,_i=/[A-Z]/g;function vi(f){return f==="true"?!0:f==="false"?!1:f==="null"?null:f===+f+""?+f:It.test(f)?JSON.parse(f):f}function Ri(f,v,C){var S;if(C===void 0&&f.nodeType===1)if(S="data-"+v.replace(_i,"-$&").toLowerCase(),C=f.getAttribute(S),typeof C=="string"){try{C=vi(C)}catch{}Xe.set(f,v,C)}else C=void 0;return C}_.extend({hasData:function(f){return Xe.hasData(f)||at.hasData(f)},data:function(f,v,C){return Xe.access(f,v,C)},removeData:function(f,v){Xe.remove(f,v)},_data:function(f,v,C){return at.access(f,v,C)},_removeData:function(f,v){at.remove(f,v)}}),_.fn.extend({data:function(f,v){var C,S,T,D=this[0],M=D&&D.attributes;if(f===void 0){if(this.length&&(T=Xe.get(D),D.nodeType===1&&!at.get(D,"hasDataAttrs"))){for(C=M.length;C--;)M[C]&&(S=M[C].name,S.indexOf("data-")===0&&(S=ke(S.slice(5)),Ri(D,S,T[S])));at.set(D,"hasDataAttrs",!0)}return T}return typeof f=="object"?this.each(function(){Xe.set(this,f)}):je(this,function(ie){var K;if(D&&ie===void 0)return K=Xe.get(D,f),K!==void 0||(K=Ri(D,f),K!==void 0)?K:void 0;this.each(function(){Xe.set(this,f,ie)})},null,v,arguments.length>1,null,!0)},removeData:function(f){return this.each(function(){Xe.remove(this,f)})}}),_.extend({queue:function(f,v,C){var S;if(f)return v=(v||"fx")+"queue",S=at.get(f,v),C&&(!S||Array.isArray(C)?S=at.access(f,v,_.makeArray(C)):S.push(C)),S||[]},dequeue:function(f,v){v=v||"fx";var C=_.queue(f,v),S=C.length,T=C.shift(),D=_._queueHooks(f,v),M=function(){_.dequeue(f,v)};T==="inprogress"&&(T=C.shift(),S--),T&&(v==="fx"&&C.unshift("inprogress"),delete D.stop,T.call(f,M,D)),!S&&D&&D.empty.fire()},_queueHooks:function(f,v){var C=v+"queueHooks";return at.get(f,C)||at.access(f,C,{empty:_.Callbacks("once memory").add(function(){at.remove(f,[v+"queue",C])})})}}),_.fn.extend({queue:function(f,v){var C=2;return typeof f!="string"&&(v=f,f="fx",C--),arguments.length<C?_.queue(this[0],f):v===void 0?this:this.each(function(){var S=_.queue(this,f,v);_._queueHooks(this,f),f==="fx"&&S[0]!=="inprogress"&&_.dequeue(this,f)})},dequeue:function(f){return this.each(function(){_.dequeue(this,f)})},clearQueue:function(f){return this.queue(f||"fx",[])},promise:function(f,v){var C,S=1,T=_.Deferred(),D=this,M=this.length,ie=function(){--S||T.resolveWith(D,[D])};for(typeof f!="string"&&(v=f,f=void 0),f=f||"fx";M--;)C=at.get(D[M],f+"queueHooks"),C&&C.empty&&(S++,C.empty.add(ie));return ie(),T.promise(v)}});var sr=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,P=new RegExp("^(?:([+-])=|)("+sr+")([a-z%]*)$","i"),ki=["Top","Right","Bottom","Left"],Ni=O.documentElement,Gi=function(f){return _.contains(f.ownerDocument,f)},q={composed:!0};Ni.getRootNode&&(Gi=function(f){return _.contains(f.ownerDocument,f)||f.getRootNode(q)===f.ownerDocument});var L=function(f,v){return f=v||f,f.style.display==="none"||f.style.display===""&&Gi(f)&&_.css(f,"display")==="none"};function Ve(f,v,C,S){var T,D,M=20,ie=S?function(){return S.cur()}:function(){return _.css(f,v,"")},K=ie(),he=C&&C[3]||(_.cssNumber[v]?"":"px"),Re=f.nodeType&&(_.cssNumber[v]||he!=="px"&&+K)&&P.exec(_.css(f,v));if(Re&&Re[3]!==he){for(K=K/2,he=he||Re[3],Re=+K||1;M--;)_.style(f,v,Re+he),(1-D)*(1-(D=ie()/K||.5))<=0&&(M=0),Re=Re/D;Re=Re*2,_.style(f,v,Re+he),C=C||[]}return C&&(Re=+Re||+K||0,T=C[1]?Re+(C[1]+1)*C[2]:+C[2],S&&(S.unit=he,S.start=Re,S.end=T)),T}var ht={};function xt(f){var v,C=f.ownerDocument,S=f.nodeName,T=ht[S];return T||(v=C.body.appendChild(C.createElement(S)),T=_.css(v,"display"),v.parentNode.removeChild(v),T==="none"&&(T="block"),ht[S]=T,T)}function ri(f,v){for(var C,S,T=[],D=0,M=f.length;D<M;D++)S=f[D],S.style&&(C=S.style.display,v?(C==="none"&&(T[D]=at.get(S,"display")||null,T[D]||(S.style.display="")),S.style.display===""&&L(S)&&(T[D]=xt(S))):C!=="none"&&(T[D]="none",at.set(S,"display",C)));for(D=0;D<M;D++)T[D]!=null&&(f[D].style.display=T[D]);return f}_.fn.extend({show:function(){return ri(this,!0)},hide:function(){return ri(this)},toggle:function(f){return typeof f=="boolean"?f?this.show():this.hide():this.each(function(){L(this)?_(this).show():_(this).hide()})}});var si=/^(?:checkbox|radio)$/i,$i=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Jt=/^$|^module$|\/(?:java|ecma)script/i;(function(){var f=O.createDocumentFragment(),v=f.appendChild(O.createElement("div")),C=O.createElement("input");C.setAttribute("type","radio"),C.setAttribute("checked","checked"),C.setAttribute("name","t"),v.appendChild(C),E.checkClone=v.cloneNode(!0).cloneNode(!0).lastChild.checked,v.innerHTML="<textarea>x</textarea>",E.noCloneChecked=!!v.cloneNode(!0).lastChild.defaultValue,v.innerHTML="<option></option>",E.option=!!v.lastChild})();var xi={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};xi.tbody=xi.tfoot=xi.colgroup=xi.caption=xi.thead,xi.th=xi.td,E.option||(xi.optgroup=xi.option=[1,"<select multiple='multiple'>","</select>"]);function Ai(f,v){var C;return typeof f.getElementsByTagName<"u"?C=f.getElementsByTagName(v||"*"):typeof f.querySelectorAll<"u"?C=f.querySelectorAll(v||"*"):C=[],v===void 0||v&&ze(f,v)?_.merge([f],C):C}function Wi(f,v){for(var C=0,S=f.length;C<S;C++)at.set(f[C],"globalEval",!v||at.get(v[C],"globalEval"))}var Ci=/<|&#?\w+;/;function rr(f,v,C,S,T){for(var D,M,ie,K,he,Re,et=v.createDocumentFragment(),xe=[],Pe=0,Yt=f.length;Pe<Yt;Pe++)if(D=f[Pe],D||D===0)if(ue(D)==="object")_.merge(xe,D.nodeType?[D]:D);else if(!Ci.test(D))xe.push(v.createTextNode(D));else{for(M=M||et.appendChild(v.createElement("div")),ie=($i.exec(D)||["",""])[1].toLowerCase(),K=xi[ie]||xi._default,M.innerHTML=K[1]+_.htmlPrefilter(D)+K[2],Re=K[0];Re--;)M=M.lastChild;_.merge(xe,M.childNodes),M=et.firstChild,M.textContent=""}for(et.textContent="",Pe=0;D=xe[Pe++];){if(S&&_.inArray(D,S)>-1){T&&T.push(D);continue}if(he=Gi(D),M=Ai(et.appendChild(D),"script"),he&&Wi(M),C)for(Re=0;D=M[Re++];)Jt.test(D.type||"")&&C.push(D)}return et}var ji=/^([^.]*)(?:\.(.+)|)/;function Yi(){return!0}function Br(){return!1}function Nr(f,v){return f===dn()==(v==="focus")}function dn(){try{return O.activeElement}catch{}}function hn(f,v,C,S,T,D){var M,ie;if(typeof v=="object"){typeof C!="string"&&(S=S||C,C=void 0);for(ie in v)hn(f,ie,C,S,v[ie],D);return f}if(S==null&&T==null?(T=C,S=C=void 0):T==null&&(typeof C=="string"?(T=S,S=void 0):(T=S,S=C,C=void 0)),T===!1)T=Br;else if(!T)return f;return D===1&&(M=T,T=function(K){return _().off(K),M.apply(this,arguments)},T.guid=M.guid||(M.guid=_.guid++)),f.each(function(){_.event.add(this,v,T,S,C)})}_.event={global:{},add:function(f,v,C,S,T){var D,M,ie,K,he,Re,et,xe,Pe,Yt,ai,jt=at.get(f);if(_t(f))for(C.handler&&(D=C,C=D.handler,T=D.selector),T&&_.find.matchesSelector(Ni,T),C.guid||(C.guid=_.guid++),(K=jt.events)||(K=jt.events=Object.create(null)),(M=jt.handle)||(M=jt.handle=function(yr){return typeof _<"u"&&_.event.triggered!==yr.type?_.event.dispatch.apply(f,arguments):void 0}),v=(v||"").match(Ot)||[""],he=v.length;he--;)ie=ji.exec(v[he])||[],Pe=ai=ie[1],Yt=(ie[2]||"").split(".").sort(),Pe&&(et=_.event.special[Pe]||{},Pe=(T?et.delegateType:et.bindType)||Pe,et=_.event.special[Pe]||{},Re=_.extend({type:Pe,origType:ai,data:S,handler:C,guid:C.guid,selector:T,needsContext:T&&_.expr.match.needsContext.test(T),namespace:Yt.join(".")},D),(xe=K[Pe])||(xe=K[Pe]=[],xe.delegateCount=0,(!et.setup||et.setup.call(f,S,Yt,M)===!1)&&f.addEventListener&&f.addEventListener(Pe,M)),et.add&&(et.add.call(f,Re),Re.handler.guid||(Re.handler.guid=C.guid)),T?xe.splice(xe.delegateCount++,0,Re):xe.push(Re),_.event.global[Pe]=!0)},remove:function(f,v,C,S,T){var D,M,ie,K,he,Re,et,xe,Pe,Yt,ai,jt=at.hasData(f)&&at.get(f);if(!(!jt||!(K=jt.events))){for(v=(v||"").match(Ot)||[""],he=v.length;he--;){if(ie=ji.exec(v[he])||[],Pe=ai=ie[1],Yt=(ie[2]||"").split(".").sort(),!Pe){for(Pe in K)_.event.remove(f,Pe+v[he],C,S,!0);continue}for(et=_.event.special[Pe]||{},Pe=(S?et.delegateType:et.bindType)||Pe,xe=K[Pe]||[],ie=ie[2]&&new RegExp("(^|\\.)"+Yt.join("\\.(?:.*\\.|)")+"(\\.|$)"),M=D=xe.length;D--;)Re=xe[D],(T||ai===Re.origType)&&(!C||C.guid===Re.guid)&&(!ie||ie.test(Re.namespace))&&(!S||S===Re.selector||S==="**"&&Re.selector)&&(xe.splice(D,1),Re.selector&&xe.delegateCount--,et.remove&&et.remove.call(f,Re));M&&!xe.length&&((!et.teardown||et.teardown.call(f,Yt,jt.handle)===!1)&&_.removeEvent(f,Pe,jt.handle),delete K[Pe])}_.isEmptyObject(K)&&at.remove(f,"handle events")}},dispatch:function(f){var v,C,S,T,D,M,ie=new Array(arguments.length),K=_.event.fix(f),he=(at.get(this,"events")||Object.create(null))[K.type]||[],Re=_.event.special[K.type]||{};for(ie[0]=K,v=1;v<arguments.length;v++)ie[v]=arguments[v];if(K.delegateTarget=this,!(Re.preDispatch&&Re.preDispatch.call(this,K)===!1)){for(M=_.event.handlers.call(this,K,he),v=0;(T=M[v++])&&!K.isPropagationStopped();)for(K.currentTarget=T.elem,C=0;(D=T.handlers[C++])&&!K.isImmediatePropagationStopped();)(!K.rnamespace||D.namespace===!1||K.rnamespace.test(D.namespace))&&(K.handleObj=D,K.data=D.data,S=((_.event.special[D.origType]||{}).handle||D.handler).apply(T.elem,ie),S!==void 0&&(K.result=S)===!1&&(K.preventDefault(),K.stopPropagation()));return Re.postDispatch&&Re.postDispatch.call(this,K),K.result}},handlers:function(f,v){var C,S,T,D,M,ie=[],K=v.delegateCount,he=f.target;if(K&&he.nodeType&&!(f.type==="click"&&f.button>=1)){for(;he!==this;he=he.parentNode||this)if(he.nodeType===1&&!(f.type==="click"&&he.disabled===!0)){for(D=[],M={},C=0;C<K;C++)S=v[C],T=S.selector+" ",M[T]===void 0&&(M[T]=S.needsContext?_(T,this).index(he)>-1:_.find(T,this,null,[he]).length),M[T]&&D.push(S);D.length&&ie.push({elem:he,handlers:D})}}return he=this,K<v.length&&ie.push({elem:he,handlers:v.slice(K)}),ie},addProp:function(f,v){Object.defineProperty(_.Event.prototype,f,{enumerable:!0,configurable:!0,get:A(v)?function(){if(this.originalEvent)return v(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[f]},set:function(C){Object.defineProperty(this,f,{enumerable:!0,configurable:!0,writable:!0,value:C})}})},fix:function(f){return f[_.expando]?f:new _.Event(f)},special:{load:{noBubble:!0},click:{setup:function(f){var v=this||f;return si.test(v.type)&&v.click&&ze(v,"input")&&or(v,"click",Yi),!1},trigger:function(f){var v=this||f;return si.test(v.type)&&v.click&&ze(v,"input")&&or(v,"click"),!0},_default:function(f){var v=f.target;return si.test(v.type)&&v.click&&ze(v,"input")&&at.get(v,"click")||ze(v,"a")}},beforeunload:{postDispatch:function(f){f.result!==void 0&&f.originalEvent&&(f.originalEvent.returnValue=f.result)}}}};function or(f,v,C){if(!C){at.get(f,v)===void 0&&_.event.add(f,v,Yi);return}at.set(f,v,!1),_.event.add(f,v,{namespace:!1,handler:function(S){var T,D,M=at.get(this,v);if(S.isTrigger&1&&this[v]){if(M.length)(_.event.special[v]||{}).delegateType&&S.stopPropagation();else if(M=o.call(arguments),at.set(this,v,M),T=C(this,v),this[v](),D=at.get(this,v),M!==D||T?at.set(this,v,!1):D={},M!==D)return S.stopImmediatePropagation(),S.preventDefault(),D&&D.value}else M.length&&(at.set(this,v,{value:_.event.trigger(_.extend(M[0],_.Event.prototype),M.slice(1),this)}),S.stopImmediatePropagation())}})}_.removeEvent=function(f,v,C){f.removeEventListener&&f.removeEventListener(v,C)},_.Event=function(f,v){if(!(this instanceof _.Event))return new _.Event(f,v);f&&f.type?(this.originalEvent=f,this.type=f.type,this.isDefaultPrevented=f.defaultPrevented||f.defaultPrevented===void 0&&f.returnValue===!1?Yi:Br,this.target=f.target&&f.target.nodeType===3?f.target.parentNode:f.target,this.currentTarget=f.currentTarget,this.relatedTarget=f.relatedTarget):this.type=f,v&&_.extend(this,v),this.timeStamp=f&&f.timeStamp||Date.now(),this[_.expando]=!0},_.Event.prototype={constructor:_.Event,isDefaultPrevented:Br,isPropagationStopped:Br,isImmediatePropagationStopped:Br,isSimulated:!1,preventDefault:function(){var f=this.originalEvent;this.isDefaultPrevented=Yi,f&&!this.isSimulated&&f.preventDefault()},stopPropagation:function(){var f=this.originalEvent;this.isPropagationStopped=Yi,f&&!this.isSimulated&&f.stopPropagation()},stopImmediatePropagation:function(){var f=this.originalEvent;this.isImmediatePropagationStopped=Yi,f&&!this.isSimulated&&f.stopImmediatePropagation(),this.stopPropagation()}},_.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},_.event.addProp),_.each({focus:"focusin",blur:"focusout"},function(f,v){_.event.special[f]={setup:function(){return or(this,f,Nr),!1},trigger:function(){return or(this,f),!0},_default:function(C){return at.get(C.target,f)},delegateType:v}}),_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(f,v){_.event.special[f]={delegateType:v,bindType:v,handle:function(C){var S,T=this,D=C.relatedTarget,M=C.handleObj;return(!D||D!==T&&!_.contains(T,D))&&(C.type=M.origType,S=M.handler.apply(this,arguments),C.type=v),S}}}),_.fn.extend({on:function(f,v,C,S){return hn(this,f,v,C,S)},one:function(f,v,C,S){return hn(this,f,v,C,S,1)},off:function(f,v,C){var S,T;if(f&&f.preventDefault&&f.handleObj)return S=f.handleObj,_(f.delegateTarget).off(S.namespace?S.origType+"."+S.namespace:S.origType,S.selector,S.handler),this;if(typeof f=="object"){for(T in f)this.off(T,v,f[T]);return this}return(v===!1||typeof v=="function")&&(C=v,v=void 0),C===!1&&(C=Br),this.each(function(){_.event.remove(this,f,C,v)})}});var Qs=/<script|<style|<link/i,Hr=/checked\s*(?:[^=]|=\s*.checked.)/i,Zs=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Zn(f,v){return ze(f,"table")&&ze(v.nodeType!==11?v:v.firstChild,"tr")&&_(f).children("tbody")[0]||f}function Js(f){return f.type=(f.getAttribute("type")!==null)+"/"+f.type,f}function eo(f){return(f.type||"").slice(0,5)==="true/"?f.type=f.type.slice(5):f.removeAttribute("type"),f}function Ts(f,v){var C,S,T,D,M,ie,K;if(v.nodeType===1){if(at.hasData(f)&&(D=at.get(f),K=D.events,K)){at.remove(v,"handle events");for(T in K)for(C=0,S=K[T].length;C<S;C++)_.event.add(v,T,K[T][C])}Xe.hasData(f)&&(M=Xe.access(f),ie=_.extend({},M),Xe.set(v,ie))}}function ks(f,v){var C=v.nodeName.toLowerCase();C==="input"&&si.test(f.type)?v.checked=f.checked:(C==="input"||C==="textarea")&&(v.defaultValue=f.defaultValue)}function Gr(f,v,C,S){v=a(v);var T,D,M,ie,K,he,Re=0,et=f.length,xe=et-1,Pe=v[0],Yt=A(Pe);if(Yt||et>1&&typeof Pe=="string"&&!E.checkClone&&Hr.test(Pe))return f.each(function(ai){var jt=f.eq(ai);Yt&&(v[0]=Pe.call(this,ai,jt.html())),Gr(jt,v,C,S)});if(et&&(T=rr(v,f[0].ownerDocument,!1,f,S),D=T.firstChild,T.childNodes.length===1&&(T=D),D||S)){for(M=_.map(Ai(T,"script"),Js),ie=M.length;Re<et;Re++)K=T,Re!==xe&&(K=_.clone(K,!0,!0),ie&&_.merge(M,Ai(K,"script"))),C.call(f[Re],K,Re);if(ie)for(he=M[M.length-1].ownerDocument,_.map(M,eo),Re=0;Re<ie;Re++)K=M[Re],Jt.test(K.type||"")&&!at.access(K,"globalEval")&&_.contains(he,K)&&(K.src&&(K.type||"").toLowerCase()!=="module"?_._evalUrl&&!K.noModule&&_._evalUrl(K.src,{nonce:K.nonce||K.getAttribute("nonce")},he):Q(K.textContent.replace(Zs,""),K,he))}return f}function Cn(f,v,C){for(var S,T=v?_.filter(v,f):f,D=0;(S=T[D])!=null;D++)!C&&S.nodeType===1&&_.cleanData(Ai(S)),S.parentNode&&(C&&Gi(S)&&Wi(Ai(S,"script")),S.parentNode.removeChild(S));return f}_.extend({htmlPrefilter:function(f){return f},clone:function(f,v,C){var S,T,D,M,ie=f.cloneNode(!0),K=Gi(f);if(!E.noCloneChecked&&(f.nodeType===1||f.nodeType===11)&&!_.isXMLDoc(f))for(M=Ai(ie),D=Ai(f),S=0,T=D.length;S<T;S++)ks(D[S],M[S]);if(v)if(C)for(D=D||Ai(f),M=M||Ai(ie),S=0,T=D.length;S<T;S++)Ts(D[S],M[S]);else Ts(f,ie);return M=Ai(ie,"script"),M.length>0&&Wi(M,!K&&Ai(f,"script")),ie},cleanData:function(f){for(var v,C,S,T=_.event.special,D=0;(C=f[D])!==void 0;D++)if(_t(C)){if(v=C[at.expando]){if(v.events)for(S in v.events)T[S]?_.event.remove(C,S):_.removeEvent(C,S,v.handle);C[at.expando]=void 0}C[Xe.expando]&&(C[Xe.expando]=void 0)}}}),_.fn.extend({detach:function(f){return Cn(this,f,!0)},remove:function(f){return Cn(this,f)},text:function(f){return je(this,function(v){return v===void 0?_.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=v)})},null,f,arguments.length)},append:function(){return Gr(this,arguments,function(f){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var v=Zn(this,f);v.appendChild(f)}})},prepend:function(){return Gr(this,arguments,function(f){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var v=Zn(this,f);v.insertBefore(f,v.firstChild)}})},before:function(){return Gr(this,arguments,function(f){this.parentNode&&this.parentNode.insertBefore(f,this)})},after:function(){return Gr(this,arguments,function(f){this.parentNode&&this.parentNode.insertBefore(f,this.nextSibling)})},empty:function(){for(var f,v=0;(f=this[v])!=null;v++)f.nodeType===1&&(_.cleanData(Ai(f,!1)),f.textContent="");return this},clone:function(f,v){return f=f??!1,v=v??f,this.map(function(){return _.clone(this,f,v)})},html:function(f){return je(this,function(v){var C=this[0]||{},S=0,T=this.length;if(v===void 0&&C.nodeType===1)return C.innerHTML;if(typeof v=="string"&&!Qs.test(v)&&!xi[($i.exec(v)||["",""])[1].toLowerCase()]){v=_.htmlPrefilter(v);try{for(;S<T;S++)C=this[S]||{},C.nodeType===1&&(_.cleanData(Ai(C,!1)),C.innerHTML=v);C=0}catch{}}C&&this.empty().append(v)},null,f,arguments.length)},replaceWith:function(){var f=[];return Gr(this,arguments,function(v){var C=this.parentNode;_.inArray(this,f)<0&&(_.cleanData(Ai(this)),C&&C.replaceChild(v,this))},f)}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,v){_.fn[f]=function(C){for(var S,T=[],D=_(C),M=D.length-1,ie=0;ie<=M;ie++)S=ie===M?this:this.clone(!0),_(D[ie])[v](S),l.apply(T,S.get());return this.pushStack(T)}});var Vi=new RegExp("^("+sr+")(?!px)[a-z%]+$","i"),Jn=/^--/,Fn=function(f){var v=f.ownerDocument.defaultView;return(!v||!v.opener)&&(v=e),v.getComputedStyle(f)},es=function(f,v,C){var S,T,D={};for(T in v)D[T]=f.style[T],f.style[T]=v[T];S=C.call(f);for(T in v)f.style[T]=D[T];return S},to=new RegExp(ki.join("|"),"i"),Ds="[\\x20\\t\\r\\n\\f]",ts=new RegExp("^"+Ds+"+|((?:^|[^\\\\])(?:\\\\.)*)"+Ds+"+$","g");(function(){function f(){if(he){K.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",he.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Ni.appendChild(K).appendChild(he);var Re=e.getComputedStyle(he);C=Re.top!=="1%",ie=v(Re.marginLeft)===12,he.style.right="60%",D=v(Re.right)===36,S=v(Re.width)===36,he.style.position="absolute",T=v(he.offsetWidth/3)===12,Ni.removeChild(K),he=null}}function v(Re){return Math.round(parseFloat(Re))}var C,S,T,D,M,ie,K=O.createElement("div"),he=O.createElement("div");he.style&&(he.style.backgroundClip="content-box",he.cloneNode(!0).style.backgroundClip="",E.clearCloneStyle=he.style.backgroundClip==="content-box",_.extend(E,{boxSizingReliable:function(){return f(),S},pixelBoxStyles:function(){return f(),D},pixelPosition:function(){return f(),C},reliableMarginLeft:function(){return f(),ie},scrollboxSize:function(){return f(),T},reliableTrDimensions:function(){var Re,et,xe,Pe;return M==null&&(Re=O.createElement("table"),et=O.createElement("tr"),xe=O.createElement("div"),Re.style.cssText="position:absolute;left:-11111px;border-collapse:separate",et.style.cssText="border:1px solid",et.style.height="1px",xe.style.height="9px",xe.style.display="block",Ni.appendChild(Re).appendChild(et).appendChild(xe),Pe=e.getComputedStyle(et),M=parseInt(Pe.height,10)+parseInt(Pe.borderTopWidth,10)+parseInt(Pe.borderBottomWidth,10)===et.offsetHeight,Ni.removeChild(Re)),M}}))})();function nn(f,v,C){var S,T,D,M,ie=Jn.test(v),K=f.style;return C=C||Fn(f),C&&(M=C.getPropertyValue(v)||C[v],ie&&(M=M.replace(ts,"$1")),M===""&&!Gi(f)&&(M=_.style(f,v)),!E.pixelBoxStyles()&&Vi.test(M)&&to.test(v)&&(S=K.width,T=K.minWidth,D=K.maxWidth,K.minWidth=K.maxWidth=K.width=M,M=C.width,K.width=S,K.minWidth=T,K.maxWidth=D)),M!==void 0?M+"":M}function is(f,v){return{get:function(){if(f()){delete this.get;return}return(this.get=v).apply(this,arguments)}}}var jr=["Webkit","Moz","ms"],Ls=O.createElement("div").style,rs={};function io(f){for(var v=f[0].toUpperCase()+f.slice(1),C=jr.length;C--;)if(f=jr[C]+v,f in Ls)return f}function ns(f){var v=_.cssProps[f]||rs[f];return v||(f in Ls?f:rs[f]=io(f)||f)}var ro=/^(none|table(?!-c[ea]).+)/,ss={position:"absolute",visibility:"hidden",display:"block"},Pn={letterSpacing:"0",fontWeight:"400"};function Ms(f,v,C){var S=P.exec(v);return S?Math.max(0,S[2]-(C||0))+(S[3]||"px"):v}function os(f,v,C,S,T,D){var M=v==="width"?1:0,ie=0,K=0;if(C===(S?"border":"content"))return 0;for(;M<4;M+=2)C==="margin"&&(K+=_.css(f,C+ki[M],!0,T)),S?(C==="content"&&(K-=_.css(f,"padding"+ki[M],!0,T)),C!=="margin"&&(K-=_.css(f,"border"+ki[M]+"Width",!0,T))):(K+=_.css(f,"padding"+ki[M],!0,T),C!=="padding"?K+=_.css(f,"border"+ki[M]+"Width",!0,T):ie+=_.css(f,"border"+ki[M]+"Width",!0,T));return!S&&D>=0&&(K+=Math.max(0,Math.ceil(f["offset"+v[0].toUpperCase()+v.slice(1)]-D-K-ie-.5))||0),K}function $s(f,v,C){var S=Fn(f),T=!E.boxSizingReliable()||C,D=T&&_.css(f,"boxSizing",!1,S)==="border-box",M=D,ie=nn(f,v,S),K="offset"+v[0].toUpperCase()+v.slice(1);if(Vi.test(ie)){if(!C)return ie;ie="auto"}return(!E.boxSizingReliable()&&D||!E.reliableTrDimensions()&&ze(f,"tr")||ie==="auto"||!parseFloat(ie)&&_.css(f,"display",!1,S)==="inline")&&f.getClientRects().length&&(D=_.css(f,"boxSizing",!1,S)==="border-box",M=K in f,M&&(ie=f[K])),ie=parseFloat(ie)||0,ie+os(f,v,C||(D?"border":"content"),M,S,ie)+"px"}_.extend({cssHooks:{opacity:{get:function(f,v){if(v){var C=nn(f,"opacity");return C===""?"1":C}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(f,v,C,S){if(!(!f||f.nodeType===3||f.nodeType===8||!f.style)){var T,D,M,ie=ke(v),K=Jn.test(v),he=f.style;if(K||(v=ns(ie)),M=_.cssHooks[v]||_.cssHooks[ie],C!==void 0){if(D=typeof C,D==="string"&&(T=P.exec(C))&&T[1]&&(C=Ve(f,v,T),D="number"),C==null||C!==C)return;D==="number"&&!K&&(C+=T&&T[3]||(_.cssNumber[ie]?"":"px")),!E.clearCloneStyle&&C===""&&v.indexOf("background")===0&&(he[v]="inherit"),(!M||!("set"in M)||(C=M.set(f,C,S))!==void 0)&&(K?he.setProperty(v,C):he[v]=C)}else return M&&"get"in M&&(T=M.get(f,!1,S))!==void 0?T:he[v]}},css:function(f,v,C,S){var T,D,M,ie=ke(v),K=Jn.test(v);return K||(v=ns(ie)),M=_.cssHooks[v]||_.cssHooks[ie],M&&"get"in M&&(T=M.get(f,!0,C)),T===void 0&&(T=nn(f,v,S)),T==="normal"&&v in Pn&&(T=Pn[v]),C===""||C?(D=parseFloat(T),C===!0||isFinite(D)?D||0:T):T}}),_.each(["height","width"],function(f,v){_.cssHooks[v]={get:function(C,S,T){if(S)return ro.test(_.css(C,"display"))&&(!C.getClientRects().length||!C.getBoundingClientRect().width)?es(C,ss,function(){return $s(C,v,T)}):$s(C,v,T)},set:function(C,S,T){var D,M=Fn(C),ie=!E.scrollboxSize()&&M.position==="absolute",K=ie||T,he=K&&_.css(C,"boxSizing",!1,M)==="border-box",Re=T?os(C,v,T,he,M):0;return he&&ie&&(Re-=Math.ceil(C["offset"+v[0].toUpperCase()+v.slice(1)]-parseFloat(M[v])-os(C,v,"border",!1,M)-.5)),Re&&(D=P.exec(S))&&(D[3]||"px")!=="px"&&(C.style[v]=S,S=_.css(C,v)),Ms(C,S,Re)}}}),_.cssHooks.marginLeft=is(E.reliableMarginLeft,function(f,v){if(v)return(parseFloat(nn(f,"marginLeft"))||f.getBoundingClientRect().left-es(f,{marginLeft:0},function(){return f.getBoundingClientRect().left}))+"px"}),_.each({margin:"",padding:"",border:"Width"},function(f,v){_.cssHooks[f+v]={expand:function(C){for(var S=0,T={},D=typeof C=="string"?C.split(" "):[C];S<4;S++)T[f+ki[S]+v]=D[S]||D[S-2]||D[0];return T}},f!=="margin"&&(_.cssHooks[f+v].set=Ms)}),_.fn.extend({css:function(f,v){return je(this,function(C,S,T){var D,M,ie={},K=0;if(Array.isArray(S)){for(D=Fn(C),M=S.length;K<M;K++)ie[S[K]]=_.css(C,S[K],!1,D);return ie}return T!==void 0?_.style(C,S,T):_.css(C,S)},f,v,arguments.length>1)}});function Rr(f,v,C,S,T){return new Rr.prototype.init(f,v,C,S,T)}_.Tween=Rr,Rr.prototype={constructor:Rr,init:function(f,v,C,S,T,D){this.elem=f,this.prop=C,this.easing=T||_.easing._default,this.options=v,this.start=this.now=this.cur(),this.end=S,this.unit=D||(_.cssNumber[C]?"":"px")},cur:function(){var f=Rr.propHooks[this.prop];return f&&f.get?f.get(this):Rr.propHooks._default.get(this)},run:function(f){var v,C=Rr.propHooks[this.prop];return this.options.duration?this.pos=v=_.easing[this.easing](f,this.options.duration*f,0,1,this.options.duration):this.pos=v=f,this.now=(this.end-this.start)*v+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),C&&C.set?C.set(this):Rr.propHooks._default.set(this),this}},Rr.prototype.init.prototype=Rr.prototype,Rr.propHooks={_default:{get:function(f){var v;return f.elem.nodeType!==1||f.elem[f.prop]!=null&&f.elem.style[f.prop]==null?f.elem[f.prop]:(v=_.css(f.elem,f.prop,""),!v||v==="auto"?0:v)},set:function(f){_.fx.step[f.prop]?_.fx.step[f.prop](f):f.elem.nodeType===1&&(_.cssHooks[f.prop]||f.elem.style[ns(f.prop)]!=null)?_.style(f.elem,f.prop,f.now+f.unit):f.elem[f.prop]=f.now}}},Rr.propHooks.scrollTop=Rr.propHooks.scrollLeft={set:function(f){f.elem.nodeType&&f.elem.parentNode&&(f.elem[f.prop]=f.now)}},_.easing={linear:function(f){return f},swing:function(f){return .5-Math.cos(f*Math.PI)/2},_default:"swing"},_.fx=Rr.prototype.init,_.fx.step={};var qr,Nn,Sn=/^(?:toggle|show|hide)$/,er=/queueHooks$/;function pn(){Nn&&(O.hidden===!1&&e.requestAnimationFrame?e.requestAnimationFrame(pn):e.setTimeout(pn,_.fx.interval),_.fx.tick())}function zn(){return e.setTimeout(function(){qr=void 0}),qr=Date.now()}function En(f,v){var C,S=0,T={height:f};for(v=v?1:0;S<4;S+=2-v)C=ki[S],T["margin"+C]=T["padding"+C]=f;return v&&(T.opacity=T.width=f),T}function mn(f,v,C){for(var S,T=(vr.tweeners[v]||[]).concat(vr.tweeners["*"]),D=0,M=T.length;D<M;D++)if(S=T[D].call(C,v,f))return S}function Fs(f,v,C){var S,T,D,M,ie,K,he,Re,et="width"in v||"height"in v,xe=this,Pe={},Yt=f.style,ai=f.nodeType&&L(f),jt=at.get(f,"fxshow");C.queue||(M=_._queueHooks(f,"fx"),M.unqueued==null&&(M.unqueued=0,ie=M.empty.fire,M.empty.fire=function(){M.unqueued||ie()}),M.unqueued++,xe.always(function(){xe.always(function(){M.unqueued--,_.queue(f,"fx").length||M.empty.fire()})}));for(S in v)if(T=v[S],Sn.test(T)){if(delete v[S],D=D||T==="toggle",T===(ai?"hide":"show"))if(T==="show"&&jt&&jt[S]!==void 0)ai=!0;else continue;Pe[S]=jt&&jt[S]||_.style(f,S)}if(K=!_.isEmptyObject(v),!(!K&&_.isEmptyObject(Pe))){et&&f.nodeType===1&&(C.overflow=[Yt.overflow,Yt.overflowX,Yt.overflowY],he=jt&&jt.display,he==null&&(he=at.get(f,"display")),Re=_.css(f,"display"),Re==="none"&&(he?Re=he:(ri([f],!0),he=f.style.display||he,Re=_.css(f,"display"),ri([f]))),(Re==="inline"||Re==="inline-block"&&he!=null)&&_.css(f,"float")==="none"&&(K||(xe.done(function(){Yt.display=he}),he==null&&(Re=Yt.display,he=Re==="none"?"":Re)),Yt.display="inline-block")),C.overflow&&(Yt.overflow="hidden",xe.always(function(){Yt.overflow=C.overflow[0],Yt.overflowX=C.overflow[1],Yt.overflowY=C.overflow[2]})),K=!1;for(S in Pe)K||(jt?"hidden"in jt&&(ai=jt.hidden):jt=at.access(f,"fxshow",{display:he}),D&&(jt.hidden=!ai),ai&&ri([f],!0),xe.done(function(){ai||ri([f]),at.remove(f,"fxshow");for(S in Pe)_.style(f,S,Pe[S])})),K=mn(ai?jt[S]:0,S,xe),S in jt||(jt[S]=K.start,ai&&(K.end=K.start,K.start=0))}}function as(f,v){var C,S,T,D,M;for(C in f)if(S=ke(C),T=v[S],D=f[C],Array.isArray(D)&&(T=D[1],D=f[C]=D[0]),C!==S&&(f[S]=D,delete f[C]),M=_.cssHooks[S],M&&"expand"in M){D=M.expand(D),delete f[S];for(C in D)C in f||(f[C]=D[C],v[C]=T)}else v[S]=T}function vr(f,v,C){var S,T,D=0,M=vr.prefilters.length,ie=_.Deferred().always(function(){delete K.elem}),K=function(){if(T)return!1;for(var et=qr||zn(),xe=Math.max(0,he.startTime+he.duration-et),Pe=xe/he.duration||0,Yt=1-Pe,ai=0,jt=he.tweens.length;ai<jt;ai++)he.tweens[ai].run(Yt);return ie.notifyWith(f,[he,Yt,xe]),Yt<1&&jt?xe:(jt||ie.notifyWith(f,[he,1,0]),ie.resolveWith(f,[he]),!1)},he=ie.promise({elem:f,props:_.extend({},v),opts:_.extend(!0,{specialEasing:{},easing:_.easing._default},C),originalProperties:v,originalOptions:C,startTime:qr||zn(),duration:C.duration,tweens:[],createTween:function(et,xe){var Pe=_.Tween(f,he.opts,et,xe,he.opts.specialEasing[et]||he.opts.easing);return he.tweens.push(Pe),Pe},stop:function(et){var xe=0,Pe=et?he.tweens.length:0;if(T)return this;for(T=!0;xe<Pe;xe++)he.tweens[xe].run(1);return et?(ie.notifyWith(f,[he,1,0]),ie.resolveWith(f,[he,et])):ie.rejectWith(f,[he,et]),this}}),Re=he.props;for(as(Re,he.opts.specialEasing);D<M;D++)if(S=vr.prefilters[D].call(he,f,Re,he.opts),S)return A(S.stop)&&(_._queueHooks(he.elem,he.opts.queue).stop=S.stop.bind(S)),S;return _.map(Re,mn,he),A(he.opts.start)&&he.opts.start.call(f,he),he.progress(he.opts.progress).done(he.opts.done,he.opts.complete).fail(he.opts.fail).always(he.opts.always),_.fx.timer(_.extend(K,{elem:f,anim:he,queue:he.opts.queue})),he}_.Animation=_.extend(vr,{tweeners:{"*":[function(f,v){var C=this.createTween(f,v);return Ve(C.elem,f,P.exec(v),C),C}]},tweener:function(f,v){A(f)?(v=f,f=["*"]):f=f.match(Ot);for(var C,S=0,T=f.length;S<T;S++)C=f[S],vr.tweeners[C]=vr.tweeners[C]||[],vr.tweeners[C].unshift(v)},prefilters:[Fs],prefilter:function(f,v){v?vr.prefilters.unshift(f):vr.prefilters.push(f)}}),_.speed=function(f,v,C){var S=f&&typeof f=="object"?_.extend({},f):{complete:C||!C&&v||A(f)&&f,duration:f,easing:C&&v||v&&!A(v)&&v};return _.fx.off?S.duration=0:typeof S.duration!="number"&&(S.duration in _.fx.speeds?S.duration=_.fx.speeds[S.duration]:S.duration=_.fx.speeds._default),(S.queue==null||S.queue===!0)&&(S.queue="fx"),S.old=S.complete,S.complete=function(){A(S.old)&&S.old.call(this),S.queue&&_.dequeue(this,S.queue)},S},_.fn.extend({fadeTo:function(f,v,C,S){return this.filter(L).css("opacity",0).show().end().animate({opacity:v},f,C,S)},animate:function(f,v,C,S){var T=_.isEmptyObject(f),D=_.speed(v,C,S),M=function(){var ie=vr(this,_.extend({},f),D);(T||at.get(this,"finish"))&&ie.stop(!0)};return M.finish=M,T||D.queue===!1?this.each(M):this.queue(D.queue,M)},stop:function(f,v,C){var S=function(T){var D=T.stop;delete T.stop,D(C)};return typeof f!="string"&&(C=v,v=f,f=void 0),v&&this.queue(f||"fx",[]),this.each(function(){var T=!0,D=f!=null&&f+"queueHooks",M=_.timers,ie=at.get(this);if(D)ie[D]&&ie[D].stop&&S(ie[D]);else for(D in ie)ie[D]&&ie[D].stop&&er.test(D)&&S(ie[D]);for(D=M.length;D--;)M[D].elem===this&&(f==null||M[D].queue===f)&&(M[D].anim.stop(C),T=!1,M.splice(D,1));(T||!C)&&_.dequeue(this,f)})},finish:function(f){return f!==!1&&(f=f||"fx"),this.each(function(){var v,C=at.get(this),S=C[f+"queue"],T=C[f+"queueHooks"],D=_.timers,M=S?S.length:0;for(C.finish=!0,_.queue(this,f,[]),T&&T.stop&&T.stop.call(this,!0),v=D.length;v--;)D[v].elem===this&&D[v].queue===f&&(D[v].anim.stop(!0),D.splice(v,1));for(v=0;v<M;v++)S[v]&&S[v].finish&&S[v].finish.call(this);delete C.finish})}}),_.each(["toggle","show","hide"],function(f,v){var C=_.fn[v];_.fn[v]=function(S,T,D){return S==null||typeof S=="boolean"?C.apply(this,arguments):this.animate(En(v,!0),S,T,D)}}),_.each({slideDown:En("show"),slideUp:En("hide"),slideToggle:En("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(f,v){_.fn[f]=function(C,S,T){return this.animate(v,C,S,T)}}),_.timers=[],_.fx.tick=function(){var f,v=0,C=_.timers;for(qr=Date.now();v<C.length;v++)f=C[v],!f()&&C[v]===f&&C.splice(v--,1);C.length||_.fx.stop(),qr=void 0},_.fx.timer=function(f){_.timers.push(f),_.fx.start()},_.fx.interval=13,_.fx.start=function(){Nn||(Nn=!0,pn())},_.fx.stop=function(){Nn=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(f,v){return f=_.fx&&_.fx.speeds[f]||f,v=v||"fx",this.queue(v,function(C,S){var T=e.setTimeout(C,f);S.stop=function(){e.clearTimeout(T)}})},function(){var f=O.createElement("input"),v=O.createElement("select"),C=v.appendChild(O.createElement("option"));f.type="checkbox",E.checkOn=f.value!=="",E.optSelected=C.selected,f=O.createElement("input"),f.value="t",f.type="radio",E.radioValue=f.value==="t"}();var sn,Xr=_.expr.attrHandle;_.fn.extend({attr:function(f,v){return je(this,_.attr,f,v,arguments.length>1)},removeAttr:function(f){return this.each(function(){_.removeAttr(this,f)})}}),_.extend({attr:function(f,v,C){var S,T,D=f.nodeType;if(!(D===3||D===8||D===2)){if(typeof f.getAttribute>"u")return _.prop(f,v,C);if((D!==1||!_.isXMLDoc(f))&&(T=_.attrHooks[v.toLowerCase()]||(_.expr.match.bool.test(v)?sn:void 0)),C!==void 0){if(C===null){_.removeAttr(f,v);return}return T&&"set"in T&&(S=T.set(f,C,v))!==void 0?S:(f.setAttribute(v,C+""),C)}return T&&"get"in T&&(S=T.get(f,v))!==null?S:(S=_.find.attr(f,v),S??void 0)}},attrHooks:{type:{set:function(f,v){if(!E.radioValue&&v==="radio"&&ze(f,"input")){var C=f.value;return f.setAttribute("type",v),C&&(f.value=C),v}}}},removeAttr:function(f,v){var C,S=0,T=v&&v.match(Ot);if(T&&f.nodeType===1)for(;C=T[S++];)f.removeAttribute(C)}}),sn={set:function(f,v,C){return v===!1?_.removeAttr(f,C):f.setAttribute(C,C),C}},_.each(_.expr.match.bool.source.match(/\w+/g),function(f,v){var C=Xr[v]||_.find.attr;Xr[v]=function(S,T,D){var M,ie,K=T.toLowerCase();return D||(ie=Xr[K],Xr[K]=M,M=C(S,T,D)!=null?K:null,Xr[K]=ie),M}});var Rn=/^(?:input|select|textarea|button)$/i,ls=/^(?:a|area)$/i;_.fn.extend({prop:function(f,v){return je(this,_.prop,f,v,arguments.length>1)},removeProp:function(f){return this.each(function(){delete this[_.propFix[f]||f]})}}),_.extend({prop:function(f,v,C){var S,T,D=f.nodeType;if(!(D===3||D===8||D===2))return(D!==1||!_.isXMLDoc(f))&&(v=_.propFix[v]||v,T=_.propHooks[v]),C!==void 0?T&&"set"in T&&(S=T.set(f,C,v))!==void 0?S:f[v]=C:T&&"get"in T&&(S=T.get(f,v))!==null?S:f[v]},propHooks:{tabIndex:{get:function(f){var v=_.find.attr(f,"tabindex");return v?parseInt(v,10):Rn.test(f.nodeName)||ls.test(f.nodeName)&&f.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),E.optSelected||(_.propHooks.selected={get:function(f){var v=f.parentNode;return v&&v.parentNode&&v.parentNode.selectedIndex,null},set:function(f){var v=f.parentNode;v&&(v.selectedIndex,v.parentNode&&v.parentNode.selectedIndex)}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});function on(f){var v=f.match(Ot)||[];return v.join(" ")}function Yr(f){return f.getAttribute&&f.getAttribute("class")||""}function cs(f){return Array.isArray(f)?f:typeof f=="string"?f.match(Ot)||[]:[]}_.fn.extend({addClass:function(f){var v,C,S,T,D,M;return A(f)?this.each(function(ie){_(this).addClass(f.call(this,ie,Yr(this)))}):(v=cs(f),v.length?this.each(function(){if(S=Yr(this),C=this.nodeType===1&&" "+on(S)+" ",C){for(D=0;D<v.length;D++)T=v[D],C.indexOf(" "+T+" ")<0&&(C+=T+" ");M=on(C),S!==M&&this.setAttribute("class",M)}}):this)},removeClass:function(f){var v,C,S,T,D,M;return A(f)?this.each(function(ie){_(this).removeClass(f.call(this,ie,Yr(this)))}):arguments.length?(v=cs(f),v.length?this.each(function(){if(S=Yr(this),C=this.nodeType===1&&" "+on(S)+" ",C){for(D=0;D<v.length;D++)for(T=v[D];C.indexOf(" "+T+" ")>-1;)C=C.replace(" "+T+" "," ");M=on(C),S!==M&&this.setAttribute("class",M)}}):this):this.attr("class","")},toggleClass:function(f,v){var C,S,T,D,M=typeof f,ie=M==="string"||Array.isArray(f);return A(f)?this.each(function(K){_(this).toggleClass(f.call(this,K,Yr(this),v),v)}):typeof v=="boolean"&&ie?v?this.addClass(f):this.removeClass(f):(C=cs(f),this.each(function(){if(ie)for(D=_(this),T=0;T<C.length;T++)S=C[T],D.hasClass(S)?D.removeClass(S):D.addClass(S);else(f===void 0||M==="boolean")&&(S=Yr(this),S&&at.set(this,"__className__",S),this.setAttribute&&this.setAttribute("class",S||f===!1?"":at.get(this,"__className__")||""))}))},hasClass:function(f){var v,C,S=0;for(v=" "+f+" ";C=this[S++];)if(C.nodeType===1&&(" "+on(Yr(C))+" ").indexOf(v)>-1)return!0;return!1}});var Ps=/\r/g;_.fn.extend({val:function(f){var v,C,S,T=this[0];return arguments.length?(S=A(f),this.each(function(D){var M;this.nodeType===1&&(S?M=f.call(this,D,_(this).val()):M=f,M==null?M="":typeof M=="number"?M+="":Array.isArray(M)&&(M=_.map(M,function(ie){return ie==null?"":ie+""})),v=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],(!v||!("set"in v)||v.set(this,M,"value")===void 0)&&(this.value=M))})):T?(v=_.valHooks[T.type]||_.valHooks[T.nodeName.toLowerCase()],v&&"get"in v&&(C=v.get(T,"value"))!==void 0?C:(C=T.value,typeof C=="string"?C.replace(Ps,""):C??"")):void 0}}),_.extend({valHooks:{option:{get:function(f){var v=_.find.attr(f,"value");return v??on(_.text(f))}},select:{get:function(f){var v,C,S,T=f.options,D=f.selectedIndex,M=f.type==="select-one",ie=M?null:[],K=M?D+1:T.length;for(D<0?S=K:S=M?D:0;S<K;S++)if(C=T[S],(C.selected||S===D)&&!C.disabled&&(!C.parentNode.disabled||!ze(C.parentNode,"optgroup"))){if(v=_(C).val(),M)return v;ie.push(v)}return ie},set:function(f,v){for(var C,S,T=f.options,D=_.makeArray(v),M=T.length;M--;)S=T[M],(S.selected=_.inArray(_.valHooks.option.get(S),D)>-1)&&(C=!0);return C||(f.selectedIndex=-1),D}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(f,v){if(Array.isArray(v))return f.checked=_.inArray(_(f).val(),v)>-1}},E.checkOn||(_.valHooks[this].get=function(f){return f.getAttribute("value")===null?"on":f.value})}),E.focusin="onfocusin"in e;var $r=/^(?:focusinfocus|focusoutblur)$/,Ar=function(f){f.stopPropagation()};_.extend(_.event,{trigger:function(f,v,C,S){var T,D,M,ie,K,he,Re,et,xe=[C||O],Pe=m.call(f,"type")?f.type:f,Yt=m.call(f,"namespace")?f.namespace.split("."):[];if(D=et=M=C=C||O,!(C.nodeType===3||C.nodeType===8)&&!$r.test(Pe+_.event.triggered)&&(Pe.indexOf(".")>-1&&(Yt=Pe.split("."),Pe=Yt.shift(),Yt.sort()),K=Pe.indexOf(":")<0&&"on"+Pe,f=f[_.expando]?f:new _.Event(Pe,typeof f=="object"&&f),f.isTrigger=S?2:3,f.namespace=Yt.join("."),f.rnamespace=f.namespace?new RegExp("(^|\\.)"+Yt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,f.result=void 0,f.target||(f.target=C),v=v==null?[f]:_.makeArray(v,[f]),Re=_.event.special[Pe]||{},!(!S&&Re.trigger&&Re.trigger.apply(C,v)===!1))){if(!S&&!Re.noBubble&&!k(C)){for(ie=Re.delegateType||Pe,$r.test(ie+Pe)||(D=D.parentNode);D;D=D.parentNode)xe.push(D),M=D;M===(C.ownerDocument||O)&&xe.push(M.defaultView||M.parentWindow||e)}for(T=0;(D=xe[T++])&&!f.isPropagationStopped();)et=D,f.type=T>1?ie:Re.bindType||Pe,he=(at.get(D,"events")||Object.create(null))[f.type]&&at.get(D,"handle"),he&&he.apply(D,v),he=K&&D[K],he&&he.apply&&_t(D)&&(f.result=he.apply(D,v),f.result===!1&&f.preventDefault());return f.type=Pe,!S&&!f.isDefaultPrevented()&&(!Re._default||Re._default.apply(xe.pop(),v)===!1)&&_t(C)&&K&&A(C[Pe])&&!k(C)&&(M=C[K],M&&(C[K]=null),_.event.triggered=Pe,f.isPropagationStopped()&&et.addEventListener(Pe,Ar),C[Pe](),f.isPropagationStopped()&&et.removeEventListener(Pe,Ar),_.event.triggered=void 0,M&&(C[K]=M)),f.result}},simulate:function(f,v,C){var S=_.extend(new _.Event,C,{type:f,isSimulated:!0});_.event.trigger(S,null,v)}}),_.fn.extend({trigger:function(f,v){return this.each(function(){_.event.trigger(f,v,this)})},triggerHandler:function(f,v){var C=this[0];if(C)return _.event.trigger(f,v,C,!0)}}),E.focusin||_.each({focus:"focusin",blur:"focusout"},function(f,v){var C=function(S){_.event.simulate(v,S.target,_.event.fix(S))};_.event.special[v]={setup:function(){var S=this.ownerDocument||this.document||this,T=at.access(S,v);T||S.addEventListener(f,C,!0),at.access(S,v,(T||0)+1)},teardown:function(){var S=this.ownerDocument||this.document||this,T=at.access(S,v)-1;T?at.access(S,v,T):(S.removeEventListener(f,C,!0),at.remove(S,v))}}});var Kr=e.location,An={guid:Date.now()},ee=/\?/;_.parseXML=function(f){var v,C;if(!f||typeof f!="string")return null;try{v=new e.DOMParser().parseFromString(f,"text/xml")}catch{}return C=v&&v.getElementsByTagName("parsererror")[0],(!v||C)&&_.error("Invalid XML: "+(C?_.map(C.childNodes,function(S){return S.textContent}).join(`
`):f)),v};var de=/\[\]$/,we=/\r?\n/g,nt=/^(?:submit|button|image|reset|file)$/i,Ft=/^(?:input|select|textarea|keygen)/i;function Rt(f,v,C,S){var T;if(Array.isArray(v))_.each(v,function(D,M){C||de.test(f)?S(f,M):Rt(f+"["+(typeof M=="object"&&M!=null?D:"")+"]",M,C,S)});else if(!C&&ue(v)==="object")for(T in v)Rt(f+"["+T+"]",v[T],C,S);else S(f,v)}_.param=function(f,v){var C,S=[],T=function(D,M){var ie=A(M)?M():M;S[S.length]=encodeURIComponent(D)+"="+encodeURIComponent(ie??"")};if(f==null)return"";if(Array.isArray(f)||f.jquery&&!_.isPlainObject(f))_.each(f,function(){T(this.name,this.value)});else for(C in f)Rt(C,f[C],v,T);return S.join("&")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var f=_.prop(this,"elements");return f?_.makeArray(f):this}).filter(function(){var f=this.type;return this.name&&!_(this).is(":disabled")&&Ft.test(this.nodeName)&&!nt.test(f)&&(this.checked||!si.test(f))}).map(function(f,v){var C=_(this).val();return C==null?null:Array.isArray(C)?_.map(C,function(S){return{name:v.name,value:S.replace(we,`\r
`)}}):{name:v.name,value:C.replace(we,`\r
`)}}).get()}});var li=/%20/g,Gt=/#.*$/,Ui=/([?&])_=[^&]*/,zi=/^(.*?):[ \t]*([^\r\n]*)$/mg,Ki=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Qi=/^(?:GET|HEAD)$/,Fi=/^\/\//,tr={},qi={},ar="*/".concat("*"),lr=O.createElement("a");lr.href=Kr.href;function an(f){return function(v,C){typeof v!="string"&&(C=v,v="*");var S,T=0,D=v.toLowerCase().match(Ot)||[];if(A(C))for(;S=D[T++];)S[0]==="+"?(S=S.slice(1)||"*",(f[S]=f[S]||[]).unshift(C)):(f[S]=f[S]||[]).push(C)}}function gn(f,v,C,S){var T={},D=f===qi;function M(ie){var K;return T[ie]=!0,_.each(f[ie]||[],function(he,Re){var et=Re(v,C,S);if(typeof et=="string"&&!D&&!T[et])return v.dataTypes.unshift(et),M(et),!1;if(D)return!(K=et)}),K}return M(v.dataTypes[0])||!T["*"]&&M("*")}function vn(f,v){var C,S,T=_.ajaxSettings.flatOptions||{};for(C in v)v[C]!==void 0&&((T[C]?f:S||(S={}))[C]=v[C]);return S&&_.extend(!0,f,S),f}function us(f,v,C){for(var S,T,D,M,ie=f.contents,K=f.dataTypes;K[0]==="*";)K.shift(),S===void 0&&(S=f.mimeType||v.getResponseHeader("Content-Type"));if(S){for(T in ie)if(ie[T]&&ie[T].test(S)){K.unshift(T);break}}if(K[0]in C)D=K[0];else{for(T in C){if(!K[0]||f.converters[T+" "+K[0]]){D=T;break}M||(M=T)}D=D||M}if(D)return D!==K[0]&&K.unshift(D),C[D]}function fs(f,v,C,S){var T,D,M,ie,K,he={},Re=f.dataTypes.slice();if(Re[1])for(M in f.converters)he[M.toLowerCase()]=f.converters[M];for(D=Re.shift();D;)if(f.responseFields[D]&&(C[f.responseFields[D]]=v),!K&&S&&f.dataFilter&&(v=f.dataFilter(v,f.dataType)),K=D,D=Re.shift(),D){if(D==="*")D=K;else if(K!=="*"&&K!==D){if(M=he[K+" "+D]||he["* "+D],!M){for(T in he)if(ie=T.split(" "),ie[1]===D&&(M=he[K+" "+ie[0]]||he["* "+ie[0]],M)){M===!0?M=he[T]:he[T]!==!0&&(D=ie[0],Re.unshift(ie[1]));break}}if(M!==!0)if(M&&f.throws)v=M(v);else try{v=M(v)}catch(et){return{state:"parsererror",error:M?et:"No conversion from "+K+" to "+D}}}}return{state:"success",data:v}}_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Kr.href,type:"GET",isLocal:Ki.test(Kr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ar,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(f,v){return v?vn(vn(f,_.ajaxSettings),v):vn(_.ajaxSettings,f)},ajaxPrefilter:an(tr),ajaxTransport:an(qi),ajax:function(f,v){typeof f=="object"&&(v=f,f=void 0),v=v||{};var C,S,T,D,M,ie,K,he,Re,et,xe=_.ajaxSetup({},v),Pe=xe.context||xe,Yt=xe.context&&(Pe.nodeType||Pe.jquery)?_(Pe):_.event,ai=_.Deferred(),jt=_.Callbacks("once memory"),yr=xe.statusCode||{},dr={},Pr={},Ii="canceled",fi={readyState:0,getResponseHeader:function(Di){var ci;if(K){if(!D)for(D={};ci=zi.exec(T);)D[ci[1].toLowerCase()+" "]=(D[ci[1].toLowerCase()+" "]||[]).concat(ci[2]);ci=D[Di.toLowerCase()+" "]}return ci==null?null:ci.join(", ")},getAllResponseHeaders:function(){return K?T:null},setRequestHeader:function(Di,ci){return K==null&&(Di=Pr[Di.toLowerCase()]=Pr[Di.toLowerCase()]||Di,dr[Di]=ci),this},overrideMimeType:function(Di){return K==null&&(xe.mimeType=Di),this},statusCode:function(Di){var ci;if(Di)if(K)fi.always(Di[fi.status]);else for(ci in Di)yr[ci]=[yr[ci],Di[ci]];return this},abort:function(Di){var ci=Di||Ii;return C&&C.abort(ci),Fr(0,ci),this}};if(ai.promise(fi),xe.url=((f||xe.url||Kr.href)+"").replace(Fi,Kr.protocol+"//"),xe.type=v.method||v.type||xe.method||xe.type,xe.dataTypes=(xe.dataType||"*").toLowerCase().match(Ot)||[""],xe.crossDomain==null){ie=O.createElement("a");try{ie.href=xe.url,ie.href=ie.href,xe.crossDomain=lr.protocol+"//"+lr.host!=ie.protocol+"//"+ie.host}catch{xe.crossDomain=!0}}if(xe.data&&xe.processData&&typeof xe.data!="string"&&(xe.data=_.param(xe.data,xe.traditional)),gn(tr,xe,v,fi),K)return fi;he=_.event&&xe.global,he&&_.active++===0&&_.event.trigger("ajaxStart"),xe.type=xe.type.toUpperCase(),xe.hasContent=!Qi.test(xe.type),S=xe.url.replace(Gt,""),xe.hasContent?xe.data&&xe.processData&&(xe.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(xe.data=xe.data.replace(li,"+")):(et=xe.url.slice(S.length),xe.data&&(xe.processData||typeof xe.data=="string")&&(S+=(ee.test(S)?"&":"?")+xe.data,delete xe.data),xe.cache===!1&&(S=S.replace(Ui,"$1"),et=(ee.test(S)?"&":"?")+"_="+An.guid+++et),xe.url=S+et),xe.ifModified&&(_.lastModified[S]&&fi.setRequestHeader("If-Modified-Since",_.lastModified[S]),_.etag[S]&&fi.setRequestHeader("If-None-Match",_.etag[S])),(xe.data&&xe.hasContent&&xe.contentType!==!1||v.contentType)&&fi.setRequestHeader("Content-Type",xe.contentType),fi.setRequestHeader("Accept",xe.dataTypes[0]&&xe.accepts[xe.dataTypes[0]]?xe.accepts[xe.dataTypes[0]]+(xe.dataTypes[0]!=="*"?", "+ar+"; q=0.01":""):xe.accepts["*"]);for(Re in xe.headers)fi.setRequestHeader(Re,xe.headers[Re]);if(xe.beforeSend&&(xe.beforeSend.call(Pe,fi,xe)===!1||K))return fi.abort();if(Ii="abort",jt.add(xe.complete),fi.done(xe.success),fi.fail(xe.error),C=gn(qi,xe,v,fi),!C)Fr(-1,"No Transport");else{if(fi.readyState=1,he&&Yt.trigger("ajaxSend",[fi,xe]),K)return fi;xe.async&&xe.timeout>0&&(M=e.setTimeout(function(){fi.abort("timeout")},xe.timeout));try{K=!1,C.send(dr,Fr)}catch(Di){if(K)throw Di;Fr(-1,Di)}}function Fr(Di,ci,Bn,Ns){var nr,cn,Zr,hr,Jr,Mr=ci;K||(K=!0,M&&e.clearTimeout(M),C=void 0,T=Ns||"",fi.readyState=Di>0?4:0,nr=Di>=200&&Di<300||Di===304,Bn&&(hr=us(xe,fi,Bn)),!nr&&_.inArray("script",xe.dataTypes)>-1&&_.inArray("json",xe.dataTypes)<0&&(xe.converters["text script"]=function(){}),hr=fs(xe,hr,fi,nr),nr?(xe.ifModified&&(Jr=fi.getResponseHeader("Last-Modified"),Jr&&(_.lastModified[S]=Jr),Jr=fi.getResponseHeader("etag"),Jr&&(_.etag[S]=Jr)),Di===204||xe.type==="HEAD"?Mr="nocontent":Di===304?Mr="notmodified":(Mr=hr.state,cn=hr.data,Zr=hr.error,nr=!Zr)):(Zr=Mr,(Di||!Mr)&&(Mr="error",Di<0&&(Di=0))),fi.status=Di,fi.statusText=(ci||Mr)+"",nr?ai.resolveWith(Pe,[cn,Mr,fi]):ai.rejectWith(Pe,[fi,Mr,Zr]),fi.statusCode(yr),yr=void 0,he&&Yt.trigger(nr?"ajaxSuccess":"ajaxError",[fi,xe,nr?cn:Zr]),jt.fireWith(Pe,[fi,Mr]),he&&(Yt.trigger("ajaxComplete",[fi,xe]),--_.active||_.event.trigger("ajaxStop")))}return fi},getJSON:function(f,v,C){return _.get(f,v,C,"json")},getScript:function(f,v){return _.get(f,void 0,v,"script")}}),_.each(["get","post"],function(f,v){_[v]=function(C,S,T,D){return A(S)&&(D=D||T,T=S,S=void 0),_.ajax(_.extend({url:C,type:v,dataType:D,data:S,success:T},_.isPlainObject(C)&&C))}}),_.ajaxPrefilter(function(f){var v;for(v in f.headers)v.toLowerCase()==="content-type"&&(f.contentType=f.headers[v]||"")}),_._evalUrl=function(f,v,C){return _.ajax({url:f,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(S){_.globalEval(S,v,C)}})},_.fn.extend({wrapAll:function(f){var v;return this[0]&&(A(f)&&(f=f.call(this[0])),v=_(f,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&v.insertBefore(this[0]),v.map(function(){for(var C=this;C.firstElementChild;)C=C.firstElementChild;return C}).append(this)),this},wrapInner:function(f){return A(f)?this.each(function(v){_(this).wrapInner(f.call(this,v))}):this.each(function(){var v=_(this),C=v.contents();C.length?C.wrapAll(f):v.append(f)})},wrap:function(f){var v=A(f);return this.each(function(C){_(this).wrapAll(v?f.call(this,C):f)})},unwrap:function(f){return this.parent(f).not("body").each(function(){_(this).replaceWith(this.childNodes)}),this}}),_.expr.pseudos.hidden=function(f){return!_.expr.pseudos.visible(f)},_.expr.pseudos.visible=function(f){return!!(f.offsetWidth||f.offsetHeight||f.getClientRects().length)},_.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch{}};var In={0:200,1223:204},Qr=_.ajaxSettings.xhr();E.cors=!!Qr&&"withCredentials"in Qr,E.ajax=Qr=!!Qr,_.ajaxTransport(function(f){var v,C;if(E.cors||Qr&&!f.crossDomain)return{send:function(S,T){var D,M=f.xhr();if(M.open(f.type,f.url,f.async,f.username,f.password),f.xhrFields)for(D in f.xhrFields)M[D]=f.xhrFields[D];f.mimeType&&M.overrideMimeType&&M.overrideMimeType(f.mimeType),!f.crossDomain&&!S["X-Requested-With"]&&(S["X-Requested-With"]="XMLHttpRequest");for(D in S)M.setRequestHeader(D,S[D]);v=function(ie){return function(){v&&(v=C=M.onload=M.onerror=M.onabort=M.ontimeout=M.onreadystatechange=null,ie==="abort"?M.abort():ie==="error"?typeof M.status!="number"?T(0,"error"):T(M.status,M.statusText):T(In[M.status]||M.status,M.statusText,(M.responseType||"text")!=="text"||typeof M.responseText!="string"?{binary:M.response}:{text:M.responseText},M.getAllResponseHeaders()))}},M.onload=v(),C=M.onerror=M.ontimeout=v("error"),M.onabort!==void 0?M.onabort=C:M.onreadystatechange=function(){M.readyState===4&&e.setTimeout(function(){v&&C()})},v=v("abort");try{M.send(f.hasContent&&f.data||null)}catch(ie){if(v)throw ie}},abort:function(){v&&v()}}}),_.ajaxPrefilter(function(f){f.crossDomain&&(f.contents.script=!1)}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(f){return _.globalEval(f),f}}}),_.ajaxPrefilter("script",function(f){f.cache===void 0&&(f.cache=!1),f.crossDomain&&(f.type="GET")}),_.ajaxTransport("script",function(f){if(f.crossDomain||f.scriptAttrs){var v,C;return{send:function(S,T){v=_("<script>").attr(f.scriptAttrs||{}).prop({charset:f.scriptCharset,src:f.url}).on("load error",C=function(D){v.remove(),C=null,D&&T(D.type==="error"?404:200,D.type)}),O.head.appendChild(v[0])},abort:function(){C&&C()}}}});var ln=[],On=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var f=ln.pop()||_.expando+"_"+An.guid++;return this[f]=!0,f}}),_.ajaxPrefilter("json jsonp",function(f,v,C){var S,T,D,M=f.jsonp!==!1&&(On.test(f.url)?"url":typeof f.data=="string"&&(f.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&On.test(f.data)&&"data");if(M||f.dataTypes[0]==="jsonp")return S=f.jsonpCallback=A(f.jsonpCallback)?f.jsonpCallback():f.jsonpCallback,M?f[M]=f[M].replace(On,"$1"+S):f.jsonp!==!1&&(f.url+=(ee.test(f.url)?"&":"?")+f.jsonp+"="+S),f.converters["script json"]=function(){return D||_.error(S+" was not called"),D[0]},f.dataTypes[0]="json",T=e[S],e[S]=function(){D=arguments},C.always(function(){T===void 0?_(e).removeProp(S):e[S]=T,f[S]&&(f.jsonpCallback=v.jsonpCallback,ln.push(S)),D&&A(T)&&T(D[0]),D=T=void 0}),"script"}),E.createHTMLDocument=function(){var f=O.implementation.createHTMLDocument("").body;return f.innerHTML="<form></form><form></form>",f.childNodes.length===2}(),_.parseHTML=function(f,v,C){if(typeof f!="string")return[];typeof v=="boolean"&&(C=v,v=!1);var S,T,D;return v||(E.createHTMLDocument?(v=O.implementation.createHTMLDocument(""),S=v.createElement("base"),S.href=O.location.href,v.head.appendChild(S)):v=O),T=Je.exec(f),D=!C&&[],T?[v.createElement(T[1])]:(T=rr([f],v,D),D&&D.length&&_(D).remove(),_.merge([],T.childNodes))},_.fn.load=function(f,v,C){var S,T,D,M=this,ie=f.indexOf(" ");return ie>-1&&(S=on(f.slice(ie)),f=f.slice(0,ie)),A(v)?(C=v,v=void 0):v&&typeof v=="object"&&(T="POST"),M.length>0&&_.ajax({url:f,type:T||"GET",dataType:"html",data:v}).done(function(K){D=arguments,M.html(S?_("<div>").append(_.parseHTML(K)).find(S):K)}).always(C&&function(K,he){M.each(function(){C.apply(this,D||[K.responseText,he,K])})}),this},_.expr.pseudos.animated=function(f){return _.grep(_.timers,function(v){return f===v.elem}).length},_.offset={setOffset:function(f,v,C){var S,T,D,M,ie,K,he,Re=_.css(f,"position"),et=_(f),xe={};Re==="static"&&(f.style.position="relative"),ie=et.offset(),D=_.css(f,"top"),K=_.css(f,"left"),he=(Re==="absolute"||Re==="fixed")&&(D+K).indexOf("auto")>-1,he?(S=et.position(),M=S.top,T=S.left):(M=parseFloat(D)||0,T=parseFloat(K)||0),A(v)&&(v=v.call(f,C,_.extend({},ie))),v.top!=null&&(xe.top=v.top-ie.top+M),v.left!=null&&(xe.left=v.left-ie.left+T),"using"in v?v.using.call(f,xe):et.css(xe)}},_.fn.extend({offset:function(f){if(arguments.length)return f===void 0?this:this.each(function(T){_.offset.setOffset(this,f,T)});var v,C,S=this[0];if(S)return S.getClientRects().length?(v=S.getBoundingClientRect(),C=S.ownerDocument.defaultView,{top:v.top+C.pageYOffset,left:v.left+C.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var f,v,C,S=this[0],T={top:0,left:0};if(_.css(S,"position")==="fixed")v=S.getBoundingClientRect();else{for(v=this.offset(),C=S.ownerDocument,f=S.offsetParent||C.documentElement;f&&(f===C.body||f===C.documentElement)&&_.css(f,"position")==="static";)f=f.parentNode;f&&f!==S&&f.nodeType===1&&(T=_(f).offset(),T.top+=_.css(f,"borderTopWidth",!0),T.left+=_.css(f,"borderLeftWidth",!0))}return{top:v.top-T.top-_.css(S,"marginTop",!0),left:v.left-T.left-_.css(S,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var f=this.offsetParent;f&&_.css(f,"position")==="static";)f=f.offsetParent;return f||Ni})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(f,v){var C=v==="pageYOffset";_.fn[f]=function(S){return je(this,function(T,D,M){var ie;if(k(T)?ie=T:T.nodeType===9&&(ie=T.defaultView),M===void 0)return ie?ie[v]:T[D];ie?ie.scrollTo(C?ie.pageXOffset:M,C?M:ie.pageYOffset):T[D]=M},f,S,arguments.length)}}),_.each(["top","left"],function(f,v){_.cssHooks[v]=is(E.pixelPosition,function(C,S){if(S)return S=nn(C,v),Vi.test(S)?_(C).position()[v]+"px":S})}),_.each({Height:"height",Width:"width"},function(f,v){_.each({padding:"inner"+f,content:v,"":"outer"+f},function(C,S){_.fn[S]=function(T,D){var M=arguments.length&&(C||typeof T!="boolean"),ie=C||(T===!0||D===!0?"margin":"border");return je(this,function(K,he,Re){var et;return k(K)?S.indexOf("outer")===0?K["inner"+f]:K.document.documentElement["client"+f]:K.nodeType===9?(et=K.documentElement,Math.max(K.body["scroll"+f],et["scroll"+f],K.body["offset"+f],et["offset"+f],et["client"+f])):Re===void 0?_.css(K,he,ie):_.style(K,he,Re,ie)},v,M?T:void 0,M)}})}),_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(f,v){_.fn[v]=function(C){return this.on(v,C)}}),_.fn.extend({bind:function(f,v,C){return this.on(f,null,v,C)},unbind:function(f,v){return this.off(f,null,v)},delegate:function(f,v,C,S){return this.on(v,f,C,S)},undelegate:function(f,v,C){return arguments.length===1?this.off(f,"**"):this.off(v,f||"**",C)},hover:function(f,v){return this.mouseenter(f).mouseleave(v||f)}}),_.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(f,v){_.fn[v]=function(C,S){return arguments.length>0?this.on(v,null,C,S):this.trigger(v)}});var ko=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;_.proxy=function(f,v){var C,S,T;if(typeof v=="string"&&(C=f[v],v=f,f=C),!!A(f))return S=o.call(arguments,2),T=function(){return f.apply(v||this,S.concat(o.call(arguments)))},T.guid=f.guid=f.guid||_.guid++,T},_.holdReady=function(f){f?_.readyWait++:_.ready(!0)},_.isArray=Array.isArray,_.parseJSON=JSON.parse,_.nodeName=ze,_.isFunction=A,_.isWindow=k,_.camelCase=ke,_.type=ue,_.now=Date.now,_.isNumeric=function(f){var v=_.type(f);return(v==="number"||v==="string")&&!isNaN(f-parseFloat(f))},_.trim=function(f){return f==null?"":(f+"").replace(ko,"$1")};var Do=e.jQuery,ra=e.$;return _.noConflict=function(f){return e.$===_&&(e.$=ra),f&&e.jQuery===_&&(e.jQuery=Do),_},typeof t>"u"&&(e.jQuery=e.$=_),_})})(jquery);const $=jqueryExports;/**
 * @license
 * (c) 2009-2016 Michael Leibman
 * michael{dot}leibman{at}gmail{dot}com
 * http://github.com/mleibman/slickgrid
 *
 * Distributed under MIT license.
 * All rights reserved.
 *
 * SlickGrid v2.4
 *
 * NOTES:
 *     Cell/row DOM manipulations are done directly bypassing jQuery's DOM manipulation methods.
 *     This increases the speed dramatically, but can only be done safely because there are no event handlers
 *     or data associated with any cell/row DOM nodes.  Cell editors must make sure they implement .destroy()
 *     and do proper cleanup.
 */const jQuery=$;(function(i){i.fn.drag=function(o,a,l){var u=typeof o=="string"?o:"",p=i.isFunction(o)?o:i.isFunction(a)?a:null;return u.indexOf("drag")!==0&&(u="drag"+u),l=(o==p?a:l)||{},p?this.on(u,l,p):this.trigger(u)};var e=i.event,t=e.special,r=t.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(o){var a=i.data(this,r.datakey),l=o.data||{};a.related+=1,i.each(r.defaults,function(u,p){l[u]!==void 0&&(a[u]=l[u])})},remove:function(){i.data(this,r.datakey).related-=1},setup:function(){if(!i.data(this,r.datakey)){var o=i.extend({related:0},r.defaults);i.data(this,r.datakey,o),e.add(this,"touchstart mousedown",r.init,o),this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)}},teardown:function(){var o=i.data(this,r.datakey)||{};o.related||(i.removeData(this,r.datakey),e.remove(this,"touchstart mousedown",r.init),r.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",r.dontstart))},init:function(o,a){if(r.touched)return;var l=o.data,u;if(o.which!=0&&l.which>0&&o.which!=l.which||i(o.target).is(l.not)||l.handle&&!i(o.target).closest(l.handle,o.currentTarget).length||(r.touched=o.type=="touchstart"?this:null,l.propagates=1,l.mousedown=this,l.interactions=[r.interaction(this,l)],l.target=o.target,l.pageX=o.pageX,l.pageY=o.pageY,l.dragging=null,u=r.hijack(o,"draginit",l),!l.propagates))return;u=r.flatten(u),u&&u.length&&(l.interactions=[],i.each(u,function(){l.interactions.push(r.interaction(this,l))})),l.propagates=l.interactions.length,l.drop!==!1&&t.drop&&t.drop.handler(o,l),r.textselect(!1);let p=i(o.currentTarget).data("__doc__")||document;if(r.touched?e.add(r.touched,"touchmove touchend",r.handler,l):e.add(p,"mousemove mouseup",r.handler,l),!r.touched||l.live)return!1},interaction:function(o,a){var l=o&&o.ownerDocument?i(o)[a.relative?"position":"offset"]()||{top:0,left:0}:{top:0,left:0};return{drag:o,callback:new r.callback,droppable:[],offset:l}},handler:function(o){var a=o.data;switch(o.type){case(!a.dragging&&"touchmove"):o.preventDefault();case(!a.dragging&&"mousemove"):if(Math.pow(o.pageX-a.pageX,2)+Math.pow(o.pageY-a.pageY,2)<Math.pow(a.distance,2))break;o.target=a.target,r.hijack(o,"dragstart",a),a.propagates&&(a.dragging=!0);case"touchmove":o.preventDefault();case"mousemove":if(a.dragging){if(r.hijack(o,"drag",a),a.propagates){a.drop!==!1&&t.drop&&t.drop.handler(o,a);break}o.type="mouseup"}case"touchend":case"mouseup":default:let l=i(a.target).data("__doc__")||o.currentTarget||document;r.touched?e.remove(r.touched,"touchmove touchend",r.handler):e.remove(l,"mousemove mouseup",r.handler),a.dragging&&(a.drop!==!1&&t.drop&&t.drop.handler(o,a),r.hijack(o,"dragend",a)),r.textselect(!0),a.click===!1&&a.dragging&&i.data(a.mousedown,"suppress.click",new Date().getTime()+5),a.dragging=r.touched=!1;break}},hijack:function(o,a,l,u,p){if(l){var d={event:o.originalEvent,type:o.type},m=a.indexOf("drop")?"drag":"drop",g,w=u||0,E,A,k=isNaN(u)?l.interactions.length:u;o.type=a;var O=function(){};o.originalEvent=new jQuery.Event(d.event,{preventDefault:O,stopPropagation:O,stopImmediatePropagation:O}),l.results=[];do if(E=l.interactions[w]){if(a!=="dragend"&&E.cancelled)continue;A=r.properties(o,l,E),E.results=[],i(p||E[m]||l.droppable).each(function(ne,Q){if(A.target=Q,o.isPropagationStopped=function(){return!1},g=Q?e.dispatch.call(Q,o,A):null,g===!1?(m=="drag"&&(E.cancelled=!0,l.propagates-=1),a=="drop"&&(E[m][ne]=null)):a=="dropinit"&&E.droppable.push(r.element(g)||Q),a=="dragstart"&&(E.proxy=i(r.element(g)||E.drag)[0]),E.results.push(g),delete o.result,a!=="dropinit")return g}),l.results[w]=r.flatten(E.results),a=="dropinit"&&(E.droppable=r.flatten(E.droppable)),a=="dragstart"&&!E.cancelled&&A.update()}while(++w<k);return o.type=d.type,o.originalEvent=d.event,r.flatten(l.results)}},properties:function(o,a,l){var u=l.callback;return u.drag=l.drag,u.proxy=l.proxy||l.drag,u.startX=a.pageX,u.startY=a.pageY,u.deltaX=o.pageX-a.pageX,u.deltaY=o.pageY-a.pageY,u.originalX=l.offset.left,u.originalY=l.offset.top,u.offsetX=u.originalX+u.deltaX,u.offsetY=u.originalY+u.deltaY,u.drop=r.flatten((l.drop||[]).slice()),u.available=r.flatten((l.droppable||[]).slice()),u},element:function(o){if(o&&(o.jquery||o.nodeType==1))return o},flatten:function(o){return i.map(o,function(a){return a&&a.jquery?i.makeArray(a):a&&a.length?r.flatten(a):a})},textselect:function(o){i(document)[o?"off":"on"]("selectstart",r.dontstart).css("MozUserSelect",o?"":"none"),document.unselectable=o?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){t.drop&&this.available.length&&i.each(this.available,function(o){t.drop.locate(this,o)})}};var s=e.dispatch;e.dispatch=function(o){if(i.data(this,"suppress."+o.type)-new Date().getTime()>0){i.removeData(this,"suppress."+o.type);return}return s.apply(this,arguments)},t.draginit=t.dragstart=t.dragend=r})($);var scrollbarDimensions,maxSupportedCssHeight;function SlickGrid(container,data,columns,options){var defaults={alwaysShowVerticalScroll:!1,alwaysAllowHorizontalScroll:!1,explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,suppressActiveCellChangeOnEdit:!1,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,enableAsyncPostRenderCleanup:!1,asyncPostRenderCleanupDelay:40,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showColumnHeader:!0,showHeaderRow:!1,headerRowHeight:25,createFooterRow:!1,showFooterRow:!1,footerRowHeight:25,createPreHeaderPanel:!1,showPreHeaderPanel:!1,preHeaderPanelHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,frozenBottom:!1,frozenColumn:-1,frozenRow:-1,frozenRightViewportMinWidth:100,fullWidthRows:!1,multiColumnSort:!1,numberedMultiColumnSort:!1,tristateMultiColumnSort:!1,sortColNumberInSeparateSpan:!1,defaultFormatter,forceSyncScrolling:!1,addNewRowCssClass:"new-row",preserveCopiedSelectionOnPaste:!1,showCellSelection:!0,viewportClass:null,minRowBuffer:3,emulatePagingWhenScrolling:!0,editorCellNavOnLRKeys:!1,enableMouseWheelScrollHandler:!0,doPaging:!0,autosizeColsMode:Slick.GridAutosizeColsMode.LegacyOff,autosizeColPaddingPx:4,autosizeTextAvgToMWidthRatio:.75,viewportSwitchToScrollModeWidthPercent:void 0,viewportMinWidthPx:void 0,viewportMaxWidthPx:void 0,suppressCssChangesOnHiddenInit:!1},columnDefaults={name:"",resizable:!0,sortable:!1,minWidth:30,maxWidth:void 0,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},columnAutosizeDefaults={ignoreHeaderText:!1,colValueArray:void 0,allowAddlPercent:void 0,formatterOverride:void 0,autosizeMode:Slick.ColAutosizeMode.ContentIntelligent,rowSelectionModeOnInit:void 0,rowSelectionMode:Slick.RowSelectionMode.FirstNRows,rowSelectionCount:100,valueFilterMode:Slick.ValueFilterMode.None,widthEvalMode:Slick.WidthEvalMode.CanvasTextSize,sizeToRemaining:void 0,widthPx:void 0,colDataTypeOf:void 0},th,h,ph,n,cj,page=0,offset=0,vScrollDir=1,initialized=!1,$container,uid="slickgrid_"+Math.round(1e6*Math.random()),self=this,$focusSink,$focusSink2;$();var $headerScroller,$headers,$headerRow,$headerRowScroller,$headerRowSpacerL,$headerRowSpacerR,$footerRow,$footerRowScroller,$footerRowSpacerL,$footerRowSpacerR,$preHeaderPanel,$preHeaderPanelScroller,$preHeaderPanelSpacer,$preHeaderPanelR,$preHeaderPanelScrollerR,$topPanelScroller,$topPanel,$viewport,$canvas,$style,$boundAncestors,treeColumns,stylesheet,columnCssRulesL,columnCssRulesR,viewportH,viewportW,canvasWidth,canvasWidthL,canvasWidthR,headersWidth,headersWidthL,headersWidthR,viewportHasHScroll,viewportHasVScroll,headerColumnWidthDiff=0,headerColumnHeightDiff=0,cellWidthDiff=0,cellHeightDiff=0,jQueryNewWidthBehaviour=!1,absoluteColumnMinWidth,hasFrozenRows=!1,frozenRowsHeight=0,actualFrozenRow=-1,paneTopH=0,paneBottomH=0,viewportTopH=0,topPanelH=0,headerRowH=0,footerRowH=0,tabbingDirection=1,$activeCanvasNode,$activeViewportNode,activePosX,activeRow,activeCell,activeCellNode=null,currentEditor=null,serializedEditorValue,editController,rowsCache={},renderedRows=0,numVisibleRows=0,prevScrollTop=0,scrollTop=0,lastRenderedScrollTop=0,lastRenderedScrollLeft=0,prevScrollLeft=0,scrollLeft=0,selectionModel,selectedRows=[],plugins=[],cellCssClasses={},columnsById={},sortColumns=[],columnPosLeft=[],columnPosRight=[],pagingActive=!1,pagingIsLastPage=!1,scrollThrottle=ActionThrottle(render,50),h_editorLoader=null,h_postrender=null,h_postrenderCleanup=null,postProcessedRows={},postProcessToRow=null,postProcessFromRow=null,postProcessedCleanupQueue=[],counter_rows_rendered=0,counter_rows_removed=0,rowNodeFromLastMouseWheelEvent,zombieRowNodeFromLastMouseWheelEvent,$paneHeaderL,$paneHeaderR,$paneTopL,$paneTopR,$paneBottomL,$paneBottomR,$headerScrollerL,$headerScrollerR,$headerL,$headerR,$groupHeadersL,$groupHeadersR,$headerRowScrollerL,$headerRowScrollerR,$footerRowScrollerL,$footerRowScrollerR,$headerRowL,$headerRowR,$footerRowL,$footerRowR,$topPanelScrollerL,$topPanelScrollerR,$topPanelL,$topPanelR,$viewportTopL,$viewportTopR,$viewportBottomL,$viewportBottomR,$canvasTopL,$canvasTopR,$canvasBottomL,$canvasBottomR,$viewportScrollContainerX,$viewportScrollContainerY,$headerScrollContainer,$headerRowScrollContainer,$footerRowScrollContainer,cssShow={position:"absolute",visibility:"hidden",display:"block"},$hiddenParents,oldProps=[],columnResizeDragging=!1,__doc__=document;function init(){if(container instanceof $?$container=container:$container=$(container),$container.length<1)throw new Error("SlickGrid requires a valid container, "+container+" does not exist in the DOM.");if(options.suppressCssChangesOnHiddenInit||cacheCssForHiddenInit(),maxSupportedCssHeight=maxSupportedCssHeight||getMaxSupportedCssHeight(),options=$.extend({},defaults,options),validateAndEnforceOptions(),columnDefaults.width=options.defaultColumnWidth,treeColumns=new Slick.TreeColumns(columns),columns=treeColumns.extractColumns(),updateColumnProps(),options.enableColumnReorder&&!$.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");if(editController={commitCurrentEdit,cancelCurrentEdit},$container.empty().css("overflow","hidden").css("outline",0).addClass(uid).addClass("ui-widget"),/relative|absolute|fixed/.test($container.css("position"))||$container.css("position","relative"),$focusSink=$("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo($container),$paneHeaderL=$("<div class='slick-pane slick-pane-header slick-pane-left' tabIndex='0' />").appendTo($container),$paneHeaderR=$("<div class='slick-pane slick-pane-header slick-pane-right' tabIndex='0' />").appendTo($container),$paneTopL=$("<div class='slick-pane slick-pane-top slick-pane-left' tabIndex='0' />").appendTo($container),$paneTopR=$("<div class='slick-pane slick-pane-top slick-pane-right' tabIndex='0' />").appendTo($container),$paneBottomL=$("<div class='slick-pane slick-pane-bottom slick-pane-left' tabIndex='0' />").appendTo($container),$paneBottomR=$("<div class='slick-pane slick-pane-bottom slick-pane-right' tabIndex='0' />").appendTo($container),options.createPreHeaderPanel&&($preHeaderPanelScroller=$("<div class='slick-preheader-panel ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($paneHeaderL),$preHeaderPanel=$("<div />").appendTo($preHeaderPanelScroller),$preHeaderPanelSpacer=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($preHeaderPanelScroller),$preHeaderPanelScrollerR=$("<div class='slick-preheader-panel ui-state-default' style='overflow:hidden;position:relative;' />").appendTo($paneHeaderR),$preHeaderPanelR=$("<div />").appendTo($preHeaderPanelScrollerR),$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($preHeaderPanelScrollerR),options.showPreHeaderPanel||($preHeaderPanelScroller.hide(),$preHeaderPanelScrollerR.hide())),$headerScrollerL=$("<div class='slick-header ui-state-default slick-header-left' />").appendTo($paneHeaderL),$headerScrollerR=$("<div class='slick-header ui-state-default slick-header-right' />").appendTo($paneHeaderR),$headerScroller=$().add($headerScrollerL).add($headerScrollerR),treeColumns.hasDepth()){$groupHeadersL=[],$groupHeadersR=[];for(var i=0;i<treeColumns.getDepth()-1;i++)$groupHeadersL[i]=$("<div class='slick-group-header-columns slick-group-header-columns-left' style='left:-1000px' />").appendTo($headerScrollerL),$groupHeadersR[i]=$("<div class='slick-group-header-columns slick-group-header-columns-right' style='left:-1000px' />").appendTo($headerScrollerR);$().add($groupHeadersL).add($groupHeadersR)}$headerL=$("<div class='slick-header-columns slick-header-columns-left' style='left:-1000px' />").data("__doc__",__doc__).appendTo($headerScrollerL),$headerR=$("<div class='slick-header-columns slick-header-columns-right' style='left:-1000px' />").appendTo($headerScrollerR),$headers=$().add($headerL).add($headerR),$headerRowScrollerL=$("<div class='slick-headerrow ui-state-default' />").appendTo($paneTopL),$headerRowScrollerR=$("<div class='slick-headerrow ui-state-default' />").appendTo($paneTopR),$headerRowScroller=$().add($headerRowScrollerL).add($headerRowScrollerR),$headerRowSpacerL=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($headerRowScrollerL),$headerRowSpacerR=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").appendTo($headerRowScrollerR),$headerRowL=$("<div class='slick-headerrow-columns slick-headerrow-columns-left' />").appendTo($headerRowScrollerL),$headerRowR=$("<div class='slick-headerrow-columns slick-headerrow-columns-right' />").appendTo($headerRowScrollerR),$headerRow=$().add($headerRowL).add($headerRowR),$topPanelScrollerL=$("<div class='slick-top-panel-scroller ui-state-default' />").appendTo($paneTopL),$topPanelScrollerR=$("<div class='slick-top-panel-scroller ui-state-default' />").appendTo($paneTopR),$topPanelScroller=$().add($topPanelScrollerL).add($topPanelScrollerR),$topPanelL=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScrollerL),$topPanelR=$("<div class='slick-top-panel' style='width:10000px' />").appendTo($topPanelScrollerR),$topPanel=$().add($topPanelL).add($topPanelR),options.showColumnHeader||$headerScroller.hide(),options.showTopPanel||$topPanelScroller.hide(),options.showHeaderRow||$headerRowScroller.hide(),$viewportTopL=$("<div class='slick-viewport slick-viewport-top slick-viewport-left' tabIndex='0' hideFocus />").appendTo($paneTopL),$viewportTopR=$("<div class='slick-viewport slick-viewport-top slick-viewport-right' tabIndex='0' hideFocus />").appendTo($paneTopR),$viewportBottomL=$("<div class='slick-viewport slick-viewport-bottom slick-viewport-left' tabIndex='0' hideFocus />").appendTo($paneBottomL),$viewportBottomR=$("<div class='slick-viewport slick-viewport-bottom slick-viewport-right' tabIndex='0' hideFocus />").appendTo($paneBottomR),$viewport=$().add($viewportTopL).add($viewportTopR).add($viewportBottomL).add($viewportBottomR),$activeViewportNode=$viewportTopL,$canvasTopL=$("<div class='grid-canvas grid-canvas-top grid-canvas-left' tabIndex='0' hideFocus />").appendTo($viewportTopL),$canvasTopR=$("<div class='grid-canvas grid-canvas-top grid-canvas-right' tabIndex='0' hideFocus />").appendTo($viewportTopR),$canvasBottomL=$("<div class='grid-canvas grid-canvas-bottom grid-canvas-left' tabIndex='0' hideFocus />").appendTo($viewportBottomL),$canvasBottomR=$("<div class='grid-canvas grid-canvas-bottom grid-canvas-right' tabIndex='0' hideFocus />").appendTo($viewportBottomR),options.viewportClass&&$viewport.toggleClass(options.viewportClass,!0),$canvas=$().add($canvasTopL).add($canvasTopR).add($canvasBottomL).add($canvasBottomR),scrollbarDimensions=scrollbarDimensions||measureScrollbar(),$activeCanvasNode=$canvasTopL,$preHeaderPanelSpacer&&$preHeaderPanelSpacer.css("width",getCanvasWidth()+scrollbarDimensions.width+"px"),$headers.width(getHeadersWidth()),$headerRowSpacerL.css("width",getCanvasWidth()+scrollbarDimensions.width+"px"),$headerRowSpacerR.css("width",getCanvasWidth()+scrollbarDimensions.width+"px"),options.createFooterRow&&($footerRowScrollerR=$("<div class='slick-footerrow ui-state-default' />").appendTo($paneTopR),$footerRowScrollerL=$("<div class='slick-footerrow ui-state-default' />").appendTo($paneTopL),$footerRowScroller=$().add($footerRowScrollerL).add($footerRowScrollerR),$footerRowSpacerL=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($footerRowScrollerL),$footerRowSpacerR=$("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",getCanvasWidth()+scrollbarDimensions.width+"px").appendTo($footerRowScrollerR),$footerRowL=$("<div class='slick-footerrow-columns slick-footerrow-columns-left' />").appendTo($footerRowScrollerL),$footerRowR=$("<div class='slick-footerrow-columns slick-footerrow-columns-right' />").appendTo($footerRowScrollerR),$footerRow=$().add($footerRowL).add($footerRowR),options.showFooterRow||$footerRowScroller.hide()),$focusSink2=$focusSink.clone().appendTo($container),options.explicitInitialization||finishInitialization()}function finishInitialization(){initialized||(initialized=!0,getViewportWidth(),getViewportHeight(),measureCellPaddingAndBorder(),disableSelection($headers),options.enableTextSelectionOnCells||$viewport.on("selectstart.ui",function(i){return $(i.target).is("input,textarea")}),setFrozenOptions(),setPaneVisibility(),setScroller(),setOverflow(),updateColumnCaches(),createColumnHeaders(),createColumnGroupHeaders(),createColumnFooter(),setupColumnSort(),createCssRules(),resizeCanvas(),bindAncestorScrollEvents(),$container.on("resize.slickgrid",resizeCanvas),$viewport.on("scroll",handleScroll),jQuery.fn.mousewheel&&options.enableMouseWheelScrollHandler&&$viewport.on("mousewheel",handleMouseWheel),$headerScroller.on("contextmenu",handleHeaderContextMenu).on("click",handleHeaderClick).on("mouseenter",".slick-header-column",handleHeaderMouseEnter).on("mouseleave",".slick-header-column",handleHeaderMouseLeave),$headerRowScroller.on("scroll",handleHeaderRowScroll),options.createFooterRow&&($footerRow.on("contextmenu",handleFooterContextMenu).on("click",handleFooterClick),$footerRowScroller.on("scroll",handleFooterRowScroll)),options.createPreHeaderPanel&&$preHeaderPanelScroller.on("scroll",handlePreHeaderPanelScroll),$focusSink.add($focusSink2).on("keydown",handleKeyDown),$canvas.on("keydown",handleKeyDown).on("click",handleClick).on("dblclick",handleDblClick).on("contextmenu",handleContextMenu).on("draginit",handleDragInit).on("dragstart",{distance:3},handleDragStart).on("drag",handleDrag).on("dragend",handleDragEnd).on("mouseenter",".slick-cell",handleMouseEnter).on("mouseleave",".slick-cell",handleMouseLeave),options.suppressCssChangesOnHiddenInit||restoreCssFromHiddenInit())}function cacheCssForHiddenInit(){$hiddenParents=$container.parents().addBack().not(":visible"),$hiddenParents.each(function(){var i={};for(var e in cssShow)i[e]=this.style[e],this.style[e]=cssShow[e];oldProps.push(i)})}function restoreCssFromHiddenInit(){$hiddenParents.each(function(i){var e=oldProps[i];for(var t in cssShow)this.style[t]=e[t]})}function hasFrozenColumns(){return options.frozenColumn>-1}function registerPlugin(i){plugins.unshift(i),i.init(self)}function unregisterPlugin(i){for(var e=plugins.length;e>=0;e--)if(plugins[e]===i){plugins[e].destroy&&plugins[e].destroy(),plugins.splice(e,1);break}}function getPluginByName(i){for(var e=plugins.length-1;e>=0;e--)if(plugins[e].pluginName===i)return plugins[e]}function setSelectionModel(i){selectionModel&&(selectionModel.onSelectedRangesChanged.unsubscribe(handleSelectedRangesChanged),selectionModel.destroy&&selectionModel.destroy()),selectionModel=i,selectionModel&&(selectionModel.init(self),selectionModel.onSelectedRangesChanged.subscribe(handleSelectedRangesChanged))}function getSelectionModel(){return selectionModel}function getCanvasNode(i,e){return _getContainerElement(getCanvases(),i,e)}function getActiveCanvasNode(i){return setActiveCanvasNode(i),$activeCanvasNode[0]}function getCanvases(){return $canvas}function setActiveCanvasNode(i){i&&($activeCanvasNode=$(i.target).closest(".grid-canvas"))}function getViewportNode(i,e){return _getContainerElement(getViewports(),i,e)}function getViewports(){return $viewport}function getActiveViewportNode(i){return setActiveViewportNode(i),$activeViewportNode[0]}function setActiveViewportNode(i){i&&($activeViewportNode=$(i.target).closest(".slick-viewport"))}function _getContainerElement(i,e,t){if(i){e||(e=0),t||(t=0);var r=typeof e=="number"?e:getColumnIndex(e),s=hasFrozenRows&&t>=actualFrozenRow+(options.frozenBottom?0:1),o=hasFrozenColumns()&&r>options.frozenColumn;return i[(s?2:0)+(o?1:0)]}}function measureScrollbar(){var i=$('<div class="'+$viewport.className+'" style="position:absolute; top:-10000px; left:-10000px; overflow:auto; width:100px; height:100px;"></div>').appendTo("body"),e=$('<div style="width:200px; height:200px; overflow:auto;"></div>').appendTo(i),t={width:i[0].offsetWidth-i[0].clientWidth,height:i[0].offsetHeight-i[0].clientHeight};return e.remove(),i.remove(),t}function getHeadersWidth(){headersWidth=headersWidthL=headersWidthR=0;for(var i=!options.autoHeight,e=0,t=columns.length;e<t;e++){var r=columns[e].width;options.frozenColumn>-1&&e>options.frozenColumn?headersWidthR+=r:headersWidthL+=r}return i&&(options.frozenColumn>-1&&e>options.frozenColumn?headersWidthR+=scrollbarDimensions.width:headersWidthL+=scrollbarDimensions.width),hasFrozenColumns()?(headersWidthL=headersWidthL+1e3,headersWidthR=Math.max(headersWidthR,viewportW)+headersWidthL,headersWidthR+=scrollbarDimensions.width):(headersWidthL+=scrollbarDimensions.width,headersWidthL=Math.max(headersWidthL,viewportW)+1e3),headersWidth=headersWidthL+headersWidthR,Math.max(headersWidth,viewportW)+1e3}function getHeadersWidthL(){return headersWidthL=0,columns.forEach(function(i,e){options.frozenColumn>-1&&e>options.frozenColumn||(headersWidthL+=i.width)}),hasFrozenColumns()?headersWidthL+=1e3:(headersWidthL+=scrollbarDimensions.width,headersWidthL=Math.max(headersWidthL,viewportW)+1e3),headersWidthL}function getHeadersWidthR(){return headersWidthR=0,columns.forEach(function(i,e){options.frozenColumn>-1&&e>options.frozenColumn&&(headersWidthR+=i.width)}),hasFrozenColumns()&&(headersWidthR=Math.max(headersWidthR,viewportW)+getHeadersWidthL(),headersWidthR+=scrollbarDimensions.width),headersWidthR}function getCanvasWidth(){var i=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,e=columns.length;for(canvasWidthL=canvasWidthR=0;e--;)hasFrozenColumns()&&e>options.frozenColumn?canvasWidthR+=columns[e].width:canvasWidthL+=columns[e].width;var t=canvasWidthL+canvasWidthR;return options.fullWidthRows?Math.max(t,i):t}function updateCanvasWidth(i){var e=canvasWidth,t=canvasWidthL,r=canvasWidthR,s;canvasWidth=getCanvasWidth(),s=canvasWidth!==e||canvasWidthL!==t||canvasWidthR!==r,(s||hasFrozenColumns()||hasFrozenRows)&&($canvasTopL.width(canvasWidthL),getHeadersWidth(),$headerL.width(headersWidthL),$headerR.width(headersWidthR),hasFrozenColumns()?($canvasTopR.width(canvasWidthR),$paneHeaderL.width(canvasWidthL),$paneHeaderR.css("left",canvasWidthL),$paneHeaderR.css("width",viewportW-canvasWidthL),$paneTopL.width(canvasWidthL),$paneTopR.css("left",canvasWidthL),$paneTopR.css("width",viewportW-canvasWidthL),$headerRowScrollerL.width(canvasWidthL),$headerRowScrollerR.width(viewportW-canvasWidthL),$headerRowL.width(canvasWidthL),$headerRowR.width(canvasWidthR),options.createFooterRow&&($footerRowScrollerL.width(canvasWidthL),$footerRowScrollerR.width(viewportW-canvasWidthL),$footerRowL.width(canvasWidthL),$footerRowR.width(canvasWidthR)),options.createPreHeaderPanel&&$preHeaderPanel.width(canvasWidth),$viewportTopL.width(canvasWidthL),$viewportTopR.width(viewportW-canvasWidthL),hasFrozenRows&&($paneBottomL.width(canvasWidthL),$paneBottomR.css("left",canvasWidthL),$viewportBottomL.width(canvasWidthL),$viewportBottomR.width(viewportW-canvasWidthL),$canvasBottomL.width(canvasWidthL),$canvasBottomR.width(canvasWidthR))):($paneHeaderL.width("100%"),$paneTopL.width("100%"),$headerRowScrollerL.width("100%"),$headerRowL.width(canvasWidth),options.createFooterRow&&($footerRowScrollerL.width("100%"),$footerRowL.width(canvasWidth)),options.createPreHeaderPanel&&($preHeaderPanel.width("100%"),$preHeaderPanel.width(canvasWidth)),$viewportTopL.width("100%"),hasFrozenRows&&($viewportBottomL.width("100%"),$canvasBottomL.width(canvasWidthL))),viewportHasHScroll=canvasWidth>=viewportW-scrollbarDimensions.width),$headerRowSpacerL.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),$headerRowSpacerR.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),options.createFooterRow&&($footerRowSpacerL.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0)),$footerRowSpacerR.width(canvasWidth+(viewportHasVScroll?scrollbarDimensions.width:0))),(s||i)&&applyColumnWidths()}function disableSelection(i){i&&i.jquery&&i.attr("unselectable","on").css("MozUserSelect","none").on("selectstart.ui",function(){return!1})}function getMaxSupportedCssHeight(){for(var i=1e6,e=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,t=$("<div style='display:none' />").appendTo(__doc__.body);;){var r=i*2;if(t.css("height",r),r>e||t.height()!==r)break;i=r}return t.remove(),i}function getUID(){return uid}function getHeaderColumnWidthDiff(){return headerColumnWidthDiff}function getScrollbarDimensions(){return scrollbarDimensions}function bindAncestorScrollEvents(){for(var i=hasFrozenRows&&!options.frozenBottom?$canvasBottomL[0]:$canvasTopL[0];(i=i.parentNode)!=__doc__.body&&i!=null;)if(i==$viewportTopL[0]||i.scrollWidth!=i.clientWidth||i.scrollHeight!=i.clientHeight){var e=$(i);$boundAncestors?$boundAncestors=$boundAncestors.add(e):$boundAncestors=e,e.on("scroll."+uid,handleActiveCellPositionChange)}}function unbindAncestorScrollEvents(){$boundAncestors&&($boundAncestors.off("scroll."+uid),$boundAncestors=null)}function updateColumnHeader(i,e,t){if(initialized){var r=getColumnIndex(i);if(r!=null){var s=columns[r],o=$headers.children().eq(r);o&&(e!==void 0&&(columns[r].name=e),t!==void 0&&(columns[r].toolTip=t),trigger(self.onBeforeHeaderCellDestroy,{node:o[0],column:s,grid:self}),o.attr("title",t||"").children().eq(0).html(e),trigger(self.onHeaderCellRendered,{node:o[0],column:s,grid:self}))}}}function getHeader(i){if(!i)return hasFrozenColumns()?$headers:$headerL;var e=getColumnIndex(i.id);return hasFrozenColumns()?e<=options.frozenColumn?$headerL:$headerR:$headerL}function getHeaderColumn(i){var e=typeof i=="number"?i:getColumnIndex(i),t=hasFrozenColumns()?e<=options.frozenColumn?$headerL:$headerR:$headerL,r=hasFrozenColumns()?e<=options.frozenColumn?e:e-options.frozenColumn-1:e,s=t.children().eq(r);return s&&s[0]}function getHeaderRow(){return hasFrozenColumns()?$headerRow:$headerRow[0]}function getFooterRow(){return hasFrozenColumns()?$footerRow:$footerRow[0]}function getPreHeaderPanel(){return $preHeaderPanel[0]}function getPreHeaderPanelRight(){return $preHeaderPanelR[0]}function getHeaderRowColumn(i){var e=typeof i=="number"?i:getColumnIndex(i),t;hasFrozenColumns()?e<=options.frozenColumn?t=$headerRowL:(t=$headerRowR,e-=options.frozenColumn+1):t=$headerRowL;var r=t.children().eq(e);return r&&r[0]}function getFooterRowColumn(i){var e=typeof i=="number"?i:getColumnIndex(i),t;hasFrozenColumns()?e<=options.frozenColumn?t=$footerRowL:(t=$footerRowR,e-=options.frozenColumn+1):t=$footerRowL;var r=t&&t.children().eq(e);return r&&r[0]}function createColumnFooter(){if(options.createFooterRow){$footerRow.find(".slick-footerrow-column").each(function(){var r=$(this).data("column");r&&trigger(self.onBeforeFooterRowCellDestroy,{node:this,column:r,grid:self})}),$footerRowL.empty(),$footerRowR.empty();for(var i=0;i<columns.length;i++){var e=columns[i],t=$("<div class='ui-state-default slick-footerrow-column l"+i+" r"+i+"'></div>").data("column",e).addClass(hasFrozenColumns()&&i<=options.frozenColumn?"frozen":"").appendTo(hasFrozenColumns()&&i>options.frozenColumn?$footerRowR:$footerRowL);trigger(self.onFooterRowCellRendered,{node:t[0],column:e,grid:self})}}}function createColumnGroupHeaders(){var i=0,e=!1;if(treeColumns.hasDepth()){for(var t=0;t<$groupHeadersL.length;t++){$groupHeadersL[t].empty(),$groupHeadersR[t].empty();var r=treeColumns.getColumnsInDepth(t);for(var s in r){var o=r[s];i+=o.extractColumns().length,hasFrozenColumns()&&t===0&&i-1===options.frozenColumn&&(e=!0),$("<div class='ui-state-default slick-group-header-column' />").html("<span class='slick-column-name'>"+o.name+"</span>").attr("id",""+uid+o.id).attr("title",o.toolTip||"").data("column",o).addClass(o.headerCssClass||"").addClass(hasFrozenColumns()&&i-1>options.frozenColumn?"frozen":"").appendTo(hasFrozenColumns()&&i-1>options.frozenColumn?$groupHeadersR[t]:$groupHeadersL[t])}if(hasFrozenColumns()&&t===0&&!e){$groupHeadersL[t].empty(),$groupHeadersR[t].empty(),alert("All columns of group should to be grouped!");break}}applyColumnGroupHeaderWidths()}}function createColumnHeaders(){function i(){$(this).addClass("ui-state-hover")}function e(){$(this).removeClass("ui-state-hover")}$headers.find(".slick-header-column").each(function(){var d=$(this).data("column");d&&trigger(self.onBeforeHeaderCellDestroy,{node:this,column:d,grid:self})}),$headerL.empty(),$headerR.empty(),getHeadersWidth(),$headerL.width(headersWidthL),$headerR.width(headersWidthR),$headerRow.find(".slick-headerrow-column").each(function(){var d=$(this).data("column");d&&trigger(self.onBeforeHeaderRowCellDestroy,{node:this,column:d,grid:self})}),$headerRowL.empty(),$headerRowR.empty(),options.createFooterRow&&($footerRowL.find(".slick-footerrow-column").each(function(){var d=$(this).data("column");d&&trigger(self.onBeforeFooterRowCellDestroy,{node:this,column:d,grid:self})}),$footerRowL.empty(),hasFrozenColumns()&&($footerRowR.find(".slick-footerrow-column").each(function(){var d=$(this).data("column");d&&trigger(self.onBeforeFooterRowCellDestroy,{node:this,column:d,grid:self})}),$footerRowR.empty()));for(var t=0;t<columns.length;t++){var r=columns[t],s=hasFrozenColumns()?t<=options.frozenColumn?$headerL:$headerR:$headerL,o=hasFrozenColumns()?t<=options.frozenColumn?$headerRowL:$headerRowR:$headerRowL,a=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+r.name+"</span>").width(r.width-headerColumnWidthDiff).attr("id",""+uid+r.id).attr("title",r.toolTip||"").data("column",r).data("__doc__",__doc__).addClass(r.headerCssClass||"").addClass(hasFrozenColumns()&&t<=options.frozenColumn?"frozen":"").appendTo(s);if((options.enableColumnReorder||r.sortable)&&a.on("mouseenter",i).on("mouseleave",e),a.on("dragstart",(d,m)=>{m.target.style.zIndex=1,m.target.style.opacity=.6}).on("drag",(d,m)=>{m.target.style.left=1e3+(m.offsetX-m.originalX)+"px"}).on("dragend",(d,m)=>{if(Math.abs(m.deltaX)<5){m.target.style.opacity=1,m.target.style.zIndex="";return}const g=$(m.target).data("column");let w=0;const E=[];let A=0;for(let ne of columns)E.push(A),ne===g&&(w=A),A+=ne.width;E.push(A+1e3);const k=[];let O=w+m.deltaX;O<0&&k.push(g);for(let ne=0;ne<columns.length;ne++)columns[ne]!==g&&k.push(columns[ne]),O>E[ne]&&O<E[ne+1]&&(k.push(g),O=-1e3);columns=k,setColumns(columns)}),r.hasOwnProperty("headerCellAttrs")&&r.headerCellAttrs instanceof Object)for(var l in r.headerCellAttrs)r.headerCellAttrs.hasOwnProperty(l)&&a.attr(l,r.headerCellAttrs[l]);if(r.sortable&&(a.addClass("slick-header-sortable"),a.append("<span class='slick-sort-indicator"+(options.numberedMultiColumnSort&&!options.sortColNumberInSeparateSpan?" slick-sort-indicator-numbered":"")+"' />"),options.numberedMultiColumnSort&&options.sortColNumberInSeparateSpan&&a.append("<span class='slick-sort-indicator-numbered' />")),trigger(self.onHeaderCellRendered,{node:a[0],column:r,grid:self}),options.showHeaderRow){var u=$("<div class='ui-state-default slick-headerrow-column l"+t+" r"+t+"'></div>").data("column",r).addClass(hasFrozenColumns()&&t<=options.frozenColumn?"frozen":"").appendTo(o);trigger(self.onHeaderRowCellRendered,{node:u[0],column:r,grid:self})}if(options.createFooterRow&&options.showFooterRow){var p=$("<div class='ui-state-default slick-footerrow-column l"+t+" r"+t+"'></div>").data("column",r).appendTo($footerRow);trigger(self.onFooterRowCellRendered,{node:p[0],column:r,grid:self})}}setSortColumns(sortColumns),setupColumnResize(),options.enableColumnReorder&&(typeof options.enableColumnReorder=="function"?options.enableColumnReorder(self,$headers,headerColumnWidthDiff,setColumns,setupColumnResize,columns,getColumnIndex,uid,trigger):setupColumnReorder())}function setupColumnSort(){$headers.click(function(i){if(!columnResizeDragging&&(i.metaKey=i.metaKey||i.ctrlKey,!$(i.target).hasClass("slick-resizable-handle"))){var e=$(i.target).closest(".slick-header-column");if(e.length){var t=e.data("column");if(t.sortable){if(!getEditorLock().commitCurrentEdit())return;for(var r=null,s=0;s<sortColumns.length;s++)if(sortColumns[s].columnId==t.id){r=sortColumns[s],r.sortAsc=!r.sortAsc;break}var o=!!r;options.tristateMultiColumnSort?(r||(r={columnId:t.id,sortAsc:t.defaultSortAsc}),o&&r.sortAsc&&(sortColumns.splice(s,1),r=null),options.multiColumnSort||(sortColumns=[]),r&&(!o||!options.multiColumnSort)&&sortColumns.push(r)):i.metaKey&&options.multiColumnSort?r&&sortColumns.splice(s,1):((!i.shiftKey&&!i.metaKey||!options.multiColumnSort)&&(sortColumns=[]),r?sortColumns.length===0&&sortColumns.push(r):(r={columnId:t.id,sortAsc:t.defaultSortAsc},sortColumns.push(r))),setSortColumns(sortColumns),options.multiColumnSort?trigger(self.onSort,{multiColumnSort:!0,sortCols:$.map(sortColumns,function(a){return{columnId:columns[getColumnIndex(a.columnId)].id,sortCol:columns[getColumnIndex(a.columnId)],sortAsc:a.sortAsc}})},i):trigger(self.onSort,{multiColumnSort:!1,columnId:sortColumns.length>0?t.id:null,sortCol:sortColumns.length>0?t:null,sortAsc:sortColumns.length>0?sortColumns[0].sortAsc:!0},i)}}}})}function currentPositionInHeader(i){var e=0;return $headers.find(".slick-header-column").each(function(t){if(this.id==i)return e=t,!1}),e}function limitPositionInGroup(i){var e,t=0,r=0;return treeColumns.getColumnsInDepth($groupHeadersL.length-1).some(function(s){return t=r,r+=s.columns.length,s.columns.some(function(o){return o.id===i&&(e=s),e}),e}),r--,{start:t,end:r,group:e}}function columnPositionValidInGroup(i){var e=currentPositionInHeader(i[0].id),t=limitPositionInGroup(i.data("column").id),r=t.start<=e&&e<=t.end;return{limit:t,valid:r,message:r?"":'Column "'.concat(i.text(),'" can be reordered only within the "',t.group.name,'" group!')}}function setupColumnReorder(){$headers.filter(":ui-sortable").sortable("destroy");var i=null;function e(){$viewportScrollContainerX[0].scrollLeft=$viewportScrollContainerX[0].scrollLeft+10}function t(){$viewportScrollContainerX[0].scrollLeft=$viewportScrollContainerX[0].scrollLeft-10}var r;$headers.sortable({containment:"parent",distance:3,axis:"x",cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",start:function(s,o){o.placeholder.width(o.helper.outerWidth()-headerColumnWidthDiff),r=!hasFrozenColumns()||o.placeholder.offset().left+o.placeholder.width()>$viewportScrollContainerX.offset().left,$(o.helper).addClass("slick-header-column-active")},beforeStop:function(s,o){$(o.helper).removeClass("slick-header-column-active")},sort:function(s,o){r&&s.originalEvent.pageX>$container[0].clientWidth?i||(i=setInterval(e,100)):r&&s.originalEvent.pageX<$viewportScrollContainerX.offset().left?i||(i=setInterval(t,100)):(clearInterval(i),i=null)},stop:function(s,o){var a=!1;clearInterval(i),i=null;var l=null;if(treeColumns.hasDepth()){var u=columnPositionValidInGroup(o.item);l=u.limit,a=!u.valid,a&&alert(u.message)}if(a||!getEditorLock().commitCurrentEdit()){$(this).sortable("cancel");return}var p=$headerL.sortable("toArray");p=p.concat($headerR.sortable("toArray"));for(var d=[],m=0;m<p.length;m++)d.push(columns[getColumnIndex(p[m].replace(uid,""))]);setColumns(d),trigger(self.onColumnsReordered,{impactedColumns:getImpactedColumns(l)}),s.stopPropagation(),setupColumnResize()}})}function getImpactedColumns(i){var e=[];if(i)for(var t=i.start;t<=i.end;t++)e.push(columns[t]);else e=columns;return e}function setupColumnResize(){var i,e,t,r,s,o,a,l,u,p=0;s=$headers.children(),s.find(".slick-resizable-handle").remove(),s.each(function(d,m){d>=columns.length||columns[d].resizable&&(l===void 0&&(l=d),u=d)}),l!==void 0&&s.each(function(d,m){d>=columns.length||d<l||options.forceFitColumns&&d>=u||($(m),$("<div class='slick-resizable-handle' />").data("__doc__",__doc__).appendTo(m).on("dragstart",function(g,w){if(!getEditorLock().commitCurrentEdit())return!1;r=g.pageX,p=0,$(this).parent().addClass("slick-header-column-active");var E=null,A=null;if(s.each(function(ne,Q){ne>=columns.length||(columns[ne].previousWidth=$(Q).outerWidth())}),options.forceFitColumns)for(E=0,A=0,i=d+1;i<columns.length;i++)t=columns[i],t.resizable&&(A!==null&&(t.maxWidth?A+=t.maxWidth-t.previousWidth:A=null),E+=t.previousWidth-Math.max(t.minWidth||0,absoluteColumnMinWidth));var k=0,O=0;for(i=0;i<=d;i++)t=columns[i],t.resizable&&(O!==null&&(t.maxWidth?O+=t.maxWidth-t.previousWidth:O=null),k+=t.previousWidth-Math.max(t.minWidth||0,absoluteColumnMinWidth));E===null&&(E=1e5),k===null&&(k=1e5),A===null&&(A=1e5),O===null&&(O=1e5),a=r+Math.min(E,O),o=r-Math.min(k,A)}).on("drag",function(g,w){columnResizeDragging=!0;var E,A=Math.min(a,Math.max(o,g.pageX))-r,k,O=0,ne=0,Q=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;if(A<0){for(k=A,i=d;i>=0;i--)t=columns[i],t.resizable&&(E=Math.max(t.minWidth||0,absoluteColumnMinWidth),k&&t.previousWidth+k<E?(k+=t.previousWidth-E,t.width=E):(t.width=t.previousWidth+k,k=0));for(e=0;e<=d;e++)t=columns[e],hasFrozenColumns()&&e>options.frozenColumn?ne+=t.width:O+=t.width;if(options.forceFitColumns)for(k=-A,i=d+1;i<columns.length;i++)t=columns[i],t.resizable&&(k&&t.maxWidth&&t.maxWidth-t.previousWidth<k?(k-=t.maxWidth-t.previousWidth,t.width=t.maxWidth):(t.width=t.previousWidth+k,k=0),hasFrozenColumns()&&i>options.frozenColumn?ne+=t.width:O+=t.width);else for(i=d+1;i<columns.length;i++)t=columns[i],hasFrozenColumns()&&i>options.frozenColumn?ne+=t.width:O+=t.width;if(options.forceFitColumns)for(k=-A,i=d+1;i<columns.length;i++)t=columns[i],t.resizable&&(k&&t.maxWidth&&t.maxWidth-t.previousWidth<k?(k-=t.maxWidth-t.previousWidth,t.width=t.maxWidth):(t.width=t.previousWidth+k,k=0))}else{for(k=A,O=0,ne=0,i=d;i>=0;i--)if(t=columns[i],t.resizable)if(k&&t.maxWidth&&t.maxWidth-t.previousWidth<k)k-=t.maxWidth-t.previousWidth,t.width=t.maxWidth;else{var ue=t.previousWidth+k,U=canvasWidthL+k;hasFrozenColumns()&&i<=options.frozenColumn?(ue>p&&U<Q-options.frozenRightViewportMinWidth&&(p=ue),t.width=U+options.frozenRightViewportMinWidth>Q?p:ue):t.width=ue,k=0}for(e=0;e<=d;e++)t=columns[e],hasFrozenColumns()&&e>options.frozenColumn?ne+=t.width:O+=t.width;if(options.forceFitColumns)for(k=-A,i=d+1;i<columns.length;i++)t=columns[i],t.resizable&&(E=Math.max(t.minWidth||0,absoluteColumnMinWidth),k&&t.previousWidth+k<E?(k+=t.previousWidth-E,t.width=E):(t.width=t.previousWidth+k,k=0),hasFrozenColumns()&&i>options.frozenColumn?ne+=t.width:O+=t.width);else for(i=d+1;i<columns.length;i++)t=columns[i],hasFrozenColumns()&&i>options.frozenColumn?ne+=t.width:O+=t.width}hasFrozenColumns()&&O!=canvasWidthL&&($headerL.width(O+1e3),$paneHeaderR.css("left",O)),applyColumnHeaderWidths(),applyColumnGroupHeaderWidths(),options.syncColumnCellResize&&applyColumnWidths(),trigger(self.onColumnsDrag,{triggeredByColumn:$(this).parent().attr("id").replace(uid,""),resizeHandle:$(this)})}).on("dragend",function(g,w){$(this).parent().removeClass("slick-header-column-active");var E=$(this).parent().attr("id").replace(uid,"");trigger(self.onBeforeColumnsResize,{triggeredByColumn:E})===!0&&(applyColumnHeaderWidths(),applyColumnGroupHeaderWidths());var A;for(i=0;i<columns.length;i++)t=columns[i],A=$(s[i]).outerWidth(),t.previousWidth!==A&&t.rerenderOnResize&&invalidateAllRows();updateCanvasWidth(!0),render(),trigger(self.onColumnsResized,{triggeredByColumn:E}),setTimeout(function(){columnResizeDragging=!1},300)}).on("dblclick",function(){var g=$(this).parent().attr("id").replace(uid,"");trigger(self.onColumnsResizeDblClick,{triggeredByColumn:g})}))})}function getVBoxDelta(i){var e=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],t=0;return i&&typeof i.css=="function"&&$.each(e,function(r,s){t+=parseFloat(i.css(s))||0}),t}function setFrozenOptions(){options.frozenColumn=options.frozenColumn>=0&&options.frozenColumn<columns.length?parseInt(options.frozenColumn):-1,options.frozenRow>-1?(hasFrozenRows=!0,frozenRowsHeight=options.frozenRow*options.rowHeight,getDataLength(),actualFrozenRow=options.frozenBottom?dataLength-options.frozenRow:options.frozenRow):hasFrozenRows=!1}function setPaneVisibility(){hasFrozenColumns()?($paneHeaderR.show(),$paneTopR.show(),hasFrozenRows?($paneBottomL.show(),$paneBottomR.show()):($paneBottomR.hide(),$paneBottomL.hide())):($paneHeaderR.hide(),$paneTopR.hide(),$paneBottomR.hide(),hasFrozenRows?$paneBottomL.show():($paneBottomR.hide(),$paneBottomL.hide()))}function setOverflow(){$viewportTopL.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"scroll":hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"auto","overflow-y":!hasFrozenColumns()&&options.alwaysShowVerticalScroll?"scroll":hasFrozenColumns()?"hidden":hasFrozenRows?"scroll":"auto"}),$viewportTopR.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"scroll":hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"hidden":"auto","overflow-y":options.alwaysShowVerticalScroll?"scroll":(hasFrozenColumns(),hasFrozenRows?"scroll":"auto")}),$viewportBottomL.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"scroll":"auto":(hasFrozenRows&&!options.alwaysAllowHorizontalScroll,"auto"),"overflow-y":!hasFrozenColumns()&&options.alwaysShowVerticalScroll?"scroll":hasFrozenColumns()?"hidden":hasFrozenRows?"scroll":"auto"}),$viewportBottomR.css({"overflow-x":hasFrozenColumns()?hasFrozenRows&&!options.alwaysAllowHorizontalScroll?"scroll":"auto":(hasFrozenRows&&!options.alwaysAllowHorizontalScroll,"auto"),"overflow-y":options.alwaysShowVerticalScroll?"scroll":(hasFrozenColumns(),"auto")}),options.viewportClass&&($viewportTopL.toggleClass(options.viewportClass,!0),$viewportTopR.toggleClass(options.viewportClass,!0),$viewportBottomL.toggleClass(options.viewportClass,!0),$viewportBottomR.toggleClass(options.viewportClass,!0))}function setScroller(){hasFrozenColumns()?($headerScrollContainer=$headerScrollerR,$headerRowScrollContainer=$headerRowScrollerR,$footerRowScrollContainer=$footerRowScrollerR,hasFrozenRows?options.frozenBottom?($viewportScrollContainerX=$viewportBottomR,$viewportScrollContainerY=$viewportTopR):$viewportScrollContainerX=$viewportScrollContainerY=$viewportBottomR:$viewportScrollContainerX=$viewportScrollContainerY=$viewportTopR):($headerScrollContainer=$headerScrollerL,$headerRowScrollContainer=$headerRowScrollerL,$footerRowScrollContainer=$footerRowScrollerL,hasFrozenRows?options.frozenBottom?($viewportScrollContainerX=$viewportBottomL,$viewportScrollContainerY=$viewportTopL):$viewportScrollContainerX=$viewportScrollContainerY=$viewportBottomL:$viewportScrollContainerX=$viewportScrollContainerY=$viewportTopL)}function measureCellPaddingAndBorder(){var i,e=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],t=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],r=$.fn.jquery.split(".");jQueryNewWidthBehaviour=r[0]==1&&r[1]>=8||r[0]>=2,i=$("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo($headers),headerColumnWidthDiff=headerColumnHeightDiff=0,i.css("box-sizing")!="border-box"&&i.css("-moz-box-sizing")!="border-box"&&i.css("-webkit-box-sizing")!="border-box"&&($.each(e,function(o,a){headerColumnWidthDiff+=parseFloat(i.css(a))||0}),$.each(t,function(o,a){headerColumnHeightDiff+=parseFloat(i.css(a))||0})),i.remove();var s=$("<div class='slick-row' />").appendTo($canvas);i=$("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(s),cellWidthDiff=cellHeightDiff=0,i.css("box-sizing")!="border-box"&&i.css("-moz-box-sizing")!="border-box"&&i.css("-webkit-box-sizing")!="border-box"&&($.each(e,function(o,a){cellWidthDiff+=parseFloat(i.css(a))||0}),$.each(t,function(o,a){cellHeightDiff+=parseFloat(i.css(a))||0})),s.remove(),absoluteColumnMinWidth=Math.max(headerColumnWidthDiff,cellWidthDiff)}function createCssRules(){$style=$("<style type='text/css' rel='stylesheet'/>").appendTo(__doc__.head);for(var i=options.rowHeight-cellHeightDiff,e=["."+uid+" .slick-group-header-column { left: 1000px; }","."+uid+" .slick-header-column { left: 1000px; }","."+uid+" .slick-top-panel { height:"+options.topPanelHeight+"px; }","."+uid+" .slick-preheader-panel { height:"+options.preHeaderPanelHeight+"px; }","."+uid+" .slick-headerrow-columns { height:"+options.headerRowHeight+"px; }","."+uid+" .slick-footerrow-columns { height:"+options.footerRowHeight+"px; }","."+uid+" .slick-cell { height:"+i+"px; }","."+uid+" .slick-row { height:"+options.rowHeight+"px; }"],t=0;t<columns.length;t++)e.push("."+uid+" .l"+t+" { }"),e.push("."+uid+" .r"+t+" { }");$style[0].styleSheet?$style[0].styleSheet.cssText=e.join(" "):$style[0].appendChild(__doc__.createTextNode(e.join(" ")))}function getColumnCssRules(i){var e;if(!stylesheet){var t=__doc__.styleSheets;for(let l=0;l<t.length;l++){if((t[l].ownerNode||t[l].owningElement)==$style[0]){stylesheet=t[l];break}if(t[l].rules[0].selectorText&&t[l].rules[0].selectorText.includes(uid)){stylesheet=t[l];break}}if(!stylesheet)throw new Error("SlickGrid Cannot find stylesheet.");columnCssRulesL=[],columnCssRulesR=[];var r=stylesheet.cssRules||stylesheet.rules,s,o;for(e=0;e<r.length;e++){var a=r[e].selectorText;(s=/\.l\d+/.exec(a))?(o=parseInt(s[0].substr(2,s[0].length-2),10),columnCssRulesL[o]=r[e]):(s=/\.r\d+/.exec(a))&&(o=parseInt(s[0].substr(2,s[0].length-2),10),columnCssRulesR[o]=r[e])}}return{left:columnCssRulesL[i],right:columnCssRulesR[i]}}function removeCssRules(){$style.remove(),stylesheet=null}function destroy(i){getEditorLock().cancelCurrentEdit(),trigger(self.onBeforeDestroy,{});for(var e=plugins.length;e--;)unregisterPlugin(plugins[e]);options.enableColumnReorder&&$headers.filter(":ui-sortable").sortable("destroy"),unbindAncestorScrollEvents(),$container.off(".slickgrid"),removeCssRules(),$canvas.off(),$viewport.off(),$headerScroller.off(),$headerRowScroller.off(),$footerRow&&$footerRow.off(),$footerRowScroller&&$footerRowScroller.off(),$preHeaderPanelScroller&&$preHeaderPanelScroller.off(),$focusSink.off(),$(".slick-resizable-handle").off(),$(".slick-header-column").off(),$container.empty().removeClass(uid),i&&destroyAllElements()}function destroyAllElements(){$activeCanvasNode=null,$activeViewportNode=null,$boundAncestors=null,$canvas=null,$canvasTopL=null,$canvasTopR=null,$canvasBottomL=null,$canvasBottomR=null,$container=null,$focusSink=null,$focusSink2=null,$groupHeadersL=null,$groupHeadersR=null,$headerL=null,$headerR=null,$headers=null,$headerRow=null,$headerRowL=null,$headerRowR=null,$headerRowSpacerL=null,$headerRowSpacerR=null,$headerRowScrollContainer=null,$headerRowScroller=null,$headerRowScrollerL=null,$headerRowScrollerR=null,$headerScrollContainer=null,$headerScroller=null,$headerScrollerL=null,$headerScrollerR=null,$hiddenParents=null,$footerRow=null,$footerRowL=null,$footerRowR=null,$footerRowSpacerL=null,$footerRowSpacerR=null,$footerRowScroller=null,$footerRowScrollerL=null,$footerRowScrollerR=null,$footerRowScrollContainer=null,$preHeaderPanel=null,$preHeaderPanelR=null,$preHeaderPanelScroller=null,$preHeaderPanelScrollerR=null,$preHeaderPanelSpacer=null,$topPanel=null,$topPanelScroller=null,$style=null,$topPanelScrollerL=null,$topPanelScrollerR=null,$topPanelL=null,$topPanelR=null,$paneHeaderL=null,$paneHeaderR=null,$paneTopL=null,$paneTopR=null,$paneBottomL=null,$paneBottomR=null,$viewport=null,$viewportTopL=null,$viewportTopR=null,$viewportBottomL=null,$viewportBottomR=null,$viewportScrollContainerX=null,$viewportScrollContainerY=null}var canvas=null,canvas_context=null;function autosizeColumn(i,e){var t=i;if(typeof i=="number")t=columns[i];else if(typeof i=="string")for(var r=0;r<columns.length;r++)columns[r].Id===i&&(t=columns[r]);var s=$(getCanvasNode(0,0));getColAutosizeWidth(t,s,e)}function autosizeColumns(i,e){if(i=i||options.autosizeColsMode,i===Slick.GridAutosizeColsMode.LegacyForceFit||i===Slick.GridAutosizeColsMode.LegacyOff){legacyAutosizeColumns();return}if(i!==Slick.GridAutosizeColsMode.None){canvas=__doc__.createElement("canvas"),canvas&&canvas.getContext&&(canvas_context=canvas.getContext("2d"));var t=$(getCanvasNode(0,0)),r=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW,s,o,a,l,u=0,p=0,d=0,m=0,g=0;for(s=0;s<columns.length;s++)o=columns[s],getColAutosizeWidth(o,t,e),g+=o.autoSize.autosizeMode===Slick.ColAutosizeMode.Locked?o.width:0,m+=o.autoSize.autosizeMode===Slick.ColAutosizeMode.Locked?o.width:o.minWidth,u+=o.autoSize.widthPx,p+=o.autoSize.sizeToRemaining?0:o.autoSize.widthPx,d+=o.autoSize.sizeToRemaining&&o.minWidth||0;var w=u-p;if(i===Slick.GridAutosizeColsMode.FitViewportToCols){var E=u+scrollbarDimensions.width;i=Slick.GridAutosizeColsMode.IgnoreViewport,options.viewportMaxWidthPx&&E>options.viewportMaxWidthPx?(E=options.viewportMaxWidthPx,i=Slick.GridAutosizeColsMode.FitColsToViewport):options.viewportMinWidthPx&&E<options.viewportMinWidthPx&&(E=options.viewportMinWidthPx,i=Slick.GridAutosizeColsMode.FitColsToViewport),$container.width(E)}if(i===Slick.GridAutosizeColsMode.FitColsToViewport)if(w>0&&p<r-d)for(s=0;s<columns.length;s++){o=columns[s];var A=r-p;o.autoSize.sizeToRemaining?a=A*o.autoSize.widthPx/w:a=o.autoSize.widthPx,o.rerenderOnResize&&o.width!=a&&(l=!0),o.width=a}else if(options.viewportSwitchToScrollModeWidthPercent&&p+d>r*options.viewportSwitchToScrollModeWidthPercent/100||m>r)i=Slick.GridAutosizeColsMode.IgnoreViewport;else{var k=p-g,O=r-g-d;for(s=0;s<columns.length;s++)o=columns[s],a=o.width,o.autoSize.autosizeMode!==Slick.ColAutosizeMode.Locked&&(o.autoSize.sizeToRemaining?a=o.minWidth:(a=O/k*o.autoSize.widthPx,a<o.minWidth&&(a=o.minWidth),k-=o.autoSize.widthPx,O-=a)),o.rerenderOnResize&&o.width!=a&&(l=!0),o.width=a}if(i===Slick.GridAutosizeColsMode.IgnoreViewport)for(s=0;s<columns.length;s++)a=columns[s].autoSize.widthPx,columns[s].rerenderOnResize&&columns[s].width!=a&&(l=!0),columns[s].width=a;reRenderColumns(l)}}function getColAutosizeWidth(i,e,t){var r=i.autoSize;if(r.widthPx=i.width,!(r.autosizeMode===Slick.ColAutosizeMode.Locked||r.autosizeMode===Slick.ColAutosizeMode.Guide)){var s=getDataLength();if(r.autosizeMode===Slick.ColAutosizeMode.ContentIntelligent){var o=r.colDataTypeOf,a;if(s>0){var l=getDataItem(0);l&&(a=l[i.field],o=typeof a,o==="object"&&(a instanceof Date&&(o="date"),typeof moment<"u"&&a instanceof moment&&(o="moment")))}o==="boolean"&&(r.colValueArray=[!0,!1]),o==="number"&&(r.valueFilterMode=Slick.ValueFilterMode.GetGreatestAndSub,r.rowSelectionMode=Slick.RowSelectionMode.AllRows),o==="string"&&(r.valueFilterMode=Slick.ValueFilterMode.GetLongestText,r.rowSelectionMode=Slick.RowSelectionMode.AllRows,r.allowAddlPercent=5),o==="date"&&(r.colValueArray=[new Date(2009,8,30,12,20,20)]),o==="moment"&&typeof moment<"u"&&(r.colValueArray=[moment([2009,8,30,12,20,20])])}var u=getColContentSize(i,e,t),p=r.allowAddlPercent?1+r.allowAddlPercent/100:1;u=u*p+options.autosizeColPaddingPx,i.minWidth&&u<i.minWidth&&(u=i.minWidth),i.maxWidth&&u>i.maxWidth&&(u=i.maxWidth),r.widthPx=u}}function getColContentSize(i,e,t){var r=i.autoSize,s=1,o,a,l=0,u=0;if(r.ignoreHeaderText||(u=getColHeaderWidth(i)),r.colValueArray)return l=getColWidth(i,e,r.colValueArray),Math.max(u,l);var p=getData();p.getItems&&(p=p.getItems());var d=(t?r.rowSelectionModeOnInit:void 0)||r.rowSelectionMode;if(d===Slick.RowSelectionMode.FirstRow&&(p=p.slice(0,1)),d===Slick.RowSelectionMode.LastRow&&(p=p.slice(p.length-1,p.length)),d===Slick.RowSelectionMode.FirstNRows&&(p=p.slice(0,r.rowSelectionCount)),r.valueFilterMode===Slick.ValueFilterMode.DeDuplicate){var m={};for(o=0,a=p.length;o<a;o++)m[p[o][i.field]]=!0;if(Object.keys)p=Object.keys(m);else{p=[];for(var o in m)p.push(o)}}if(r.valueFilterMode===Slick.ValueFilterMode.GetGreatestAndSub){var g,w,E=0;for(o=0,a=p.length;o<a;o++)g=p[o][i.field],Math.abs(g)>E&&(w=g,E=Math.abs(g));w=""+w,w=Array(w.length+1).join("9"),w=+w,p=[w]}if(r.valueFilterMode===Slick.ValueFilterMode.GetLongestTextAndSub){var g,A=0;for(o=0,a=p.length;o<a;o++)g=p[o][i.field],(g||"").length>A&&(A=g.length);g=Array(A+1).join("m"),s=options.autosizeTextAvgToMWidthRatio,p=[g]}if(r.valueFilterMode===Slick.ValueFilterMode.GetLongestText){var g,A=0,k=0;for(o=0,a=p.length;o<a;o++)g=p[o][i.field],(g||"").length>A&&(A=g.length,k=o);g=p[k][i.field],p=[g]}return l=getColWidth(i,e,p)*s,Math.max(u,l)}function getColWidth(i,e,t){var r=getColumnIndex(i.id),s=$('<div class="slick-row ui-widget-content"></div>'),o=$('<div class="slick-cell"></div>');o.css({position:"absolute",visibility:"hidden","text-overflow":"initial","white-space":"nowrap"}),s.append(o),e.append(s);var a,l=0,u,p,d,m;return canvas_context&&i.autoSize.widthEvalMode===Slick.WidthEvalMode.CanvasTextSize?(canvas_context.font=o.css("font-size")+" "+o.css("font-family"),$(t).each(function(g,w){m=Array.isArray(w)?w[i.field]:w,u=""+m,a=u?canvas_context.measureText(u).width:0,a>l&&(l=a,p=u)}),o.html(p),a=o.outerWidth(),s.remove(),o=null,a):($(t).each(function(g,w){m=Array.isArray(w)?w[i.field]:w,i.formatterOverride?d=i.formatterOverride(g,r,m,i,w,self):i.formatter?d=i.formatter(g,r,m,i,w,self):d=""+m,applyFormatResultToCellNode(d,o[0]),a=o.outerWidth(),a>l&&(l=a)}),s.remove(),o=null,l)}function getColHeaderWidth(i){var e=0,t=getUID()+i.id,r=__doc__.getElementById(t),s=t+"_";if(r){var o=r.cloneNode(!0);o.id=s,o.style.cssText="position: absolute; visibility: hidden;right: auto;text-overflow: initial;white-space: nowrap;",r.parentNode.insertBefore(o,r),e=o.offsetWidth,o.parentNode.removeChild(o)}else{var a=getHeader(i);r=$("<div class='ui-state-default slick-header-column' />").html("<span class='slick-column-name'>"+i.name+"</span>").attr("id",s).css({position:"absolute",visibility:"hidden",right:"auto","text-overflow:":"initial","white-space":"nowrap"}).addClass(i.headerCssClass||"").appendTo(a),e=r[0].offsetWidth,a[0].removeChild(r[0])}return e}function legacyAutosizeColumns(){var i,e,t=[],r=0,s=0,o,a=viewportHasVScroll?viewportW-scrollbarDimensions.width:viewportW;for(i=0;i<columns.length;i++)e=columns[i],t.push(e.width),s+=e.width,e.resizable&&(r+=e.width-Math.max(e.minWidth,absoluteColumnMinWidth));for(o=s;s>a&&r;){var l=(s-a)/r;for(i=0;i<columns.length&&s>a;i++){e=columns[i];var u=t[i];if(!(!e.resizable||u<=e.minWidth||u<=absoluteColumnMinWidth)){var p=Math.max(e.minWidth,absoluteColumnMinWidth),d=Math.floor(l*(u-p))||1;d=Math.min(d,u-p),s-=d,r-=d,t[i]-=d}}if(o<=s)break;o=s}for(o=s;s<a;){var m=a/s;for(i=0;i<columns.length&&s<a;i++){e=columns[i];var g=t[i],w;!e.resizable||e.maxWidth<=g?w=0:w=Math.min(Math.floor(m*g)-g,e.maxWidth-g||1e6)||1,s+=w,t[i]+=s<=a?w:0}if(o>=s)break;o=s}var E=!1;for(i=0;i<columns.length;i++)columns[i].rerenderOnResize&&columns[i].width!=t[i]&&(E=!0),columns[i].width=t[i];reRenderColumns(E)}function reRenderColumns(i){applyColumnHeaderWidths(),applyColumnGroupHeaderWidths(),updateCanvasWidth(!0),trigger(self.onAutosizeColumns,{columns}),i&&(invalidateAllRows(),render())}function trigger(i,e,t){return t=t||new Slick.EventData,e=e||{},e.grid=self,i.notify(e,t,self)}function getEditorLock(){return options.editorLock}function getEditController(){return editController}function getColumnIndex(i){return columnsById[i]}function applyColumnGroupHeaderWidths(){if(treeColumns.hasDepth())for(var i=$groupHeadersL.length-1;i>=0;i--)treeColumns.getColumnsInDepth(i),$().add($groupHeadersL[i]).add($groupHeadersR[i]).each(function(e){var t=$(this),r=0;t.width(e===0?getHeadersWidthL():getHeadersWidthR()),t.children().each(function(){var s=$(this),o=$(this).data("column");o.width=0,o.columns.forEach(function(){var a=t.next().children(":eq("+r+++")");o.width+=a.outerWidth()}),s.width(o.width-headerColumnWidthDiff)})})}function applyColumnHeaderWidths(){if(initialized){for(var i,e=0,t=$headers.children(),r=columns.length;e<r;e++)i=$(t[e]),jQueryNewWidthBehaviour?i.outerWidth()!==columns[e].width&&i.outerWidth(columns[e].width):i.width()!==columns[e].width-headerColumnWidthDiff&&i.width(columns[e].width-headerColumnWidthDiff);updateColumnCaches()}}function applyColumnWidths(){for(var i=0,e,t,r=0;r<columns.length;r++)e=columns[r].width,t=getColumnCssRules(r),t.left.style.left=i+"px",t.right.style.right=(options.frozenColumn!=-1&&r>options.frozenColumn?canvasWidthR:canvasWidthL)-i-e+"px",options.frozenColumn==r?i=0:i+=columns[r].width}function setSortColumn(i,e){setSortColumns([{columnId:i,sortAsc:e}])}function setSortColumns(i){sortColumns=i;var e=options.numberedMultiColumnSort&&sortColumns.length>1,t=$headers.children();t.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),t.find(".slick-sort-indicator-numbered").text(""),$.each(sortColumns,function(r,s){s.sortAsc==null&&(s.sortAsc=!0);var o=getColumnIndex(s.columnId);o!=null&&(t.eq(o).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(s.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc"),e&&t.eq(o).find(".slick-sort-indicator-numbered").text(r+1))})}function getSortColumns(){return sortColumns}function handleSelectedRangesChanged(i,e){var t=selectedRows.slice(0);selectedRows=[];for(var r={},s=0;s<e.length;s++)for(var o=e[s].fromRow;o<=e[s].toRow;o++){r[o]||(selectedRows.push(o),r[o]={});for(var a=e[s].fromCell;a<=e[s].toCell;a++)canCellBeSelected(o,a)&&(r[o][columns[a].id]=options.selectedCellCssClass)}setCellCssStyles(options.selectedCellCssClass,r),simpleArrayEquals(t,selectedRows)&&trigger(self.onSelectedRowsChanged,{rows:getSelectedRows(),previousSelectedRows:t},i)}function simpleArrayEquals(i,e){return Array.isArray(i)&&Array.isArray(e)&&e.sort().toString()!==i.sort().toString()}function getColumns(){return columns}function updateColumnCaches(){columnPosLeft=[],columnPosRight=[];for(var i=0,e=0,t=columns.length;e<t;e++)columnPosLeft[e]=i,columnPosRight[e]=i+columns[e].width,options.frozenColumn==e?i=0:i+=columns[e].width}function updateColumnProps(){columnsById={};for(var i=0;i<columns.length;i++){columns[i].width&&(columns[i].widthRequest=columns[i].width);var e=columns[i]=$.extend({},columnDefaults,columns[i]);e.autoSize=$.extend({},columnAutosizeDefaults,e.autoSize),columnsById[e.id]=i,e.minWidth&&e.width<e.minWidth&&(e.width=e.minWidth),e.maxWidth&&e.width>e.maxWidth&&(e.width=e.maxWidth),e.resizable}}function setColumns(i){var e=new Slick.TreeColumns(i);e.hasDepth()?(treeColumns=e,columns=treeColumns.extractColumns()):columns=i,updateColumnProps(),updateColumnCaches(),initialized&&(setPaneVisibility(),setOverflow(),invalidateAllRows(),createColumnHeaders(),createColumnGroupHeaders(),createColumnFooter(),removeCssRules(),createCssRules(),resizeCanvas(),updateCanvasWidth(),applyColumnHeaderWidths(),applyColumnWidths(),handleScroll())}function getOptions(){return options}function setOptions(i,e,t,r){if(getEditorLock().commitCurrentEdit()){makeActiveCellNormal(),i.showColumnHeader!==void 0&&setColumnHeaderVisibility(i.showColumnHeader),options.enableAddRow!==i.enableAddRow&&invalidateRow(getDataLength());var s=$.extend(!0,{},options);if(options=$.extend(options,i),trigger(self.onSetOptions,{optionsBefore:s,optionsAfter:options}),validateAndEnforceOptions(),$viewport.css("overflow-y",options.autoHeight?"hidden":"auto"),e||render(),setFrozenOptions(),setScroller(),r||setOverflow(),zombieRowNodeFromLastMouseWheelEvent=null,t||setColumns(treeColumns.extractColumns()),options.enableMouseWheelScrollHandler&&$viewport&&jQuery.fn.mousewheel){var o=$._data($viewport[0],"events");(!o||!o.mousewheel)&&$viewport.on("mousewheel",handleMouseWheel)}else options.enableMouseWheelScrollHandler===!1&&$viewport.off("mousewheel")}}function validateAndEnforceOptions(){options.autoHeight&&(options.leaveSpaceForNewRows=!1),options.forceFitColumns&&(options.autosizeColsMode=Slick.GridAutosizeColsMode.LegacyForceFit,console.log("forceFitColumns option is deprecated - use autosizeColsMode"))}function setData(i,e){data=i,invalidateAllRows(),updateRowCount(),e&&scrollTo(0)}function getData(){return data}function getDataLength(){return data.getLength?data.getLength():data&&data.length||0}function getDataLengthIncludingAddNew(){return getDataLength()+(options.enableAddRow&&(!pagingActive||pagingIsLastPage)?1:0)}function getDataItem(i){return data.getItem?data.getItem(i):data[i]}function getTopPanel(){return $topPanel[0]}function setTopPanelVisibility(i,e){var t=e!==!1;options.showTopPanel!=i&&(options.showTopPanel=i,i?t?$topPanelScroller.slideDown("fast",resizeCanvas):($topPanelScroller.show(),resizeCanvas()):t?$topPanelScroller.slideUp("fast",resizeCanvas):($topPanelScroller.hide(),resizeCanvas()))}function setHeaderRowVisibility(i,e){var t=e!==!1;options.showHeaderRow!=i&&(options.showHeaderRow=i,i?t?$headerRowScroller.slideDown("fast",resizeCanvas):($headerRowScroller.show(),resizeCanvas()):t?$headerRowScroller.slideUp("fast",resizeCanvas):($headerRowScroller.hide(),resizeCanvas()))}function setColumnHeaderVisibility(i,e){options.showColumnHeader!=i&&(options.showColumnHeader=i,i?e?$headerScroller.slideDown("fast",resizeCanvas):($headerScroller.show(),resizeCanvas()):e?$headerScroller.slideUp("fast",resizeCanvas):($headerScroller.hide(),resizeCanvas()))}function setFooterRowVisibility(i,e){var t=e!==!1;options.showFooterRow!=i&&(options.showFooterRow=i,i?t?$footerRowScroller.slideDown("fast",resizeCanvas):($footerRowScroller.show(),resizeCanvas()):t?$footerRowScroller.slideUp("fast",resizeCanvas):($footerRowScroller.hide(),resizeCanvas()))}function setPreHeaderPanelVisibility(i,e){var t=e!==!1;options.showPreHeaderPanel!=i&&(options.showPreHeaderPanel=i,i?t?($preHeaderPanelScroller.slideDown("fast",resizeCanvas),$preHeaderPanelScrollerR.slideDown("fast",resizeCanvas)):($preHeaderPanelScroller.show(),$preHeaderPanelScrollerR.show(),resizeCanvas()):t?($preHeaderPanelScroller.slideUp("fast",resizeCanvas),$preHeaderPanelScrollerR.slideUp("fast",resizeCanvas)):($preHeaderPanelScroller.hide(),$preHeaderPanelScrollerR.hide(),resizeCanvas()))}function getContainerNode(){return $container.get(0)}function getRowTop(i){return options.rowHeight*i-offset}function getRowFromPosition(i){return Math.floor((i+offset)/options.rowHeight)}function scrollTo(i){i=Math.max(i,0),i=Math.min(i,th-$viewportScrollContainerY.height()+(viewportHasHScroll||hasFrozenColumns()?scrollbarDimensions.height:0));var e=offset;page=Math.min(n-1,Math.floor(i/ph)),offset=Math.round(page*cj);var t=i-offset;if(offset!=e){var r=getVisibleRange(t);cleanupRows(r),updateRowPositions()}prevScrollTop!=t&&(vScrollDir=prevScrollTop+e<t+offset?1:-1,lastRenderedScrollTop=scrollTop=prevScrollTop=t,hasFrozenColumns()&&($viewportTopL[0].scrollTop=t),hasFrozenRows&&($viewportBottomL[0].scrollTop=$viewportBottomR[0].scrollTop=t),$viewportScrollContainerY[0].scrollTop=t,trigger(self.onViewportChanged,{}))}function defaultFormatter(i,e,t,r,s,o){return t==null?"":(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function getFormatter(i,e){var t=data.getItemMetadata&&data.getItemMetadata(i),r=t&&t.columns&&(t.columns[e.id]||t.columns[getColumnIndex(e.id)]);return r&&r.formatter||t&&t.formatter||e.formatter||options.formatterFactory&&options.formatterFactory.getFormatter(e)||options.defaultFormatter}function getEditor(i,e){var t=columns[e],r=data.getItemMetadata&&data.getItemMetadata(i),s=r&&r.columns;return s&&s[t.id]&&s[t.id].editor!==void 0?s[t.id].editor:s&&s[e]&&s[e].editor!==void 0?s[e].editor:t.editor||options.editorFactory&&options.editorFactory.getEditor(t)}function getDataItemValueForColumn(i,e){return options.dataItemColumnValueExtractor?options.dataItemColumnValueExtractor(i,e):i[e.field]}function appendRowHtml(i,e,t,r,s){var o=getDataItem(t),a=t<s&&!o,l="slick-row"+(hasFrozenRows&&t<=options.frozenRow?" frozen":"")+(a?" loading":"")+(t===activeRow&&options.showCellSelection?" active":"")+(t%2==1?" odd":" even");o||(l+=" "+options.addNewRowCssClass);var u=data.getItemMetadata&&data.getItemMetadata(t);u&&u.cssClasses&&(l+=" "+u.cssClasses);var p=getFrozenRowOffset(t),d="<div class='ui-widget-content "+l+"' style='top:"+(getRowTop(t)-p)+"px'>";i.push(d),hasFrozenColumns()&&e.push(d);for(var m,g,w=0,E=columns.length;w<E;w++){if(g=columns[w],m=1,u&&u.columns){var A=u.columns[g.id]||u.columns[w];m=A&&A.colspan||1,m==="*"&&(m=E-w)}if(columnPosRight[Math.min(E-1,w+m-1)]>r.leftPx){if(!g.alwaysRenderColumn&&columnPosLeft[w]>r.rightPx)break;hasFrozenColumns()&&w>options.frozenColumn?appendCellHtml(e,t,w,m,o):appendCellHtml(i,t,w,m,o)}else(g.alwaysRenderColumn||hasFrozenColumns()&&w<=options.frozenColumn)&&appendCellHtml(i,t,w,m,o);m>1&&(w+=m-1)}i.push("</div>"),hasFrozenColumns()&&e.push("</div>")}function appendCellHtml(i,e,t,r,s){var o=columns[t],a="slick-cell l"+t+" r"+Math.min(columns.length-1,t+r-1)+(o.cssClass?" "+o.cssClass:"");hasFrozenColumns()&&t<=options.frozenColumn&&(a+=" frozen"),e===activeRow&&t===activeCell&&options.showCellSelection&&(a+=" active");for(var l in cellCssClasses)cellCssClasses[l][e]&&cellCssClasses[l][e][o.id]&&(a+=" "+cellCssClasses[l][e][o.id]);var u=null,p="";s&&(u=getDataItemValueForColumn(s,o),p=getFormatter(e,o)(e,t,u,o,s,self),p==null&&(p=""));var d=trigger(self.onBeforeAppendCell,{row:e,cell:t,value:u,dataContext:s})||"";d+=p&&p.addClasses?(d?" ":"")+p.addClasses:"";var m=p&&p.toolTip?"title='"+p.toolTip+"'":"",g="";if(o.hasOwnProperty("cellAttrs")&&o.cellAttrs instanceof Object)for(var l in o.cellAttrs)o.cellAttrs.hasOwnProperty(l)&&(g+=" "+l+'="'+o.cellAttrs[l]+'" ');i.push("<div class='"+a+(d?" "+d:"")+"' "+m+g+">"),s&&i.push(Object.prototype.toString.call(p)!=="[object Object]"?p:p.text),i.push("</div>"),rowsCache[e].cellRenderQueue.push(t),rowsCache[e].cellColSpans[t]=r}function cleanupRows(i){for(var e in rowsCache){var t=!0;hasFrozenRows&&(options.frozenBottom&&e>=actualFrozenRow||!options.frozenBottom&&e<=actualFrozenRow)&&(t=!1),(e=parseInt(e,10))!==activeRow&&(e<i.top||e>i.bottom)&&t&&removeRowFromCache(e)}options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}function invalidate(){updateRowCount(),invalidateAllRows(),render()}function invalidateAllRows(){currentEditor&&makeActiveCellNormal();for(var i in rowsCache)removeRowFromCache(i);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}function removeRowFromCache(i){var e=rowsCache[i];e&&(rowNodeFromLastMouseWheelEvent==e.rowNode[0]||hasFrozenColumns()&&rowNodeFromLastMouseWheelEvent==e.rowNode[1]?(e.rowNode.hide(),zombieRowNodeFromLastMouseWheelEvent=e.rowNode):e.rowNode.each(function(){this.parentElement.removeChild(this)}),delete rowsCache[i],delete postProcessedRows[i],renderedRows--,counter_rows_removed++)}function invalidateRows(i){var e,t;if(!(!i||!i.length)){for(vScrollDir=0,t=i.length,e=0;e<t;e++)currentEditor&&activeRow===i[e]&&makeActiveCellNormal(),rowsCache[i[e]]&&removeRowFromCache(i[e]);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup()}}function invalidateRow(i){!i&&i!==0||invalidateRows([i])}function applyFormatResultToCellNode(i,e,t){if(i==null&&(i=""),Object.prototype.toString.call(i)!=="[object Object]"){e.innerHTML=i;return}e.innerHTML=i.text,i.removeClasses&&!t&&$(e).removeClass(i.removeClasses),i.addClasses&&$(e).addClass(i.addClasses),i.toolTip&&$(e).attr("title",i.toolTip)}function updateCell(i,e){var t=getCellNode(i,e);if(t){var r=columns[e],s=getDataItem(i);if(currentEditor&&activeRow===i&&activeCell===e)currentEditor.loadValue(s);else{var o=s?getFormatter(i,r)(i,e,getDataItemValueForColumn(s,r),r,s,self):"";applyFormatResultToCellNode(o,t),invalidatePostProcessingResults(i)}}}function updateRow(i){var e=rowsCache[i];if(e){ensureCellNodesInRowsCache(i);var t,r=getDataItem(i);for(var s in e.cellNodesByColumnIdx)if(e.cellNodesByColumnIdx.hasOwnProperty(s)){s=s|0;var o=columns[s],a=e.cellNodesByColumnIdx[s][0];i===activeRow&&s===activeCell&&currentEditor?currentEditor.loadValue(r):r?(t=getFormatter(i,o)(i,s,getDataItemValueForColumn(r,o),o,r,self),applyFormatResultToCellNode(t,a)):a.innerHTML=""}invalidatePostProcessingResults(i)}}function getViewportHeight(){if((!options.autoHeight||options.frozenColumn!=-1)&&(topPanelH=options.showTopPanel?options.topPanelHeight+getVBoxDelta($topPanelScroller):0,headerRowH=options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0,footerRowH=options.showFooterRow?options.footerRowHeight+getVBoxDelta($footerRowScroller):0),options.autoHeight){var i=$paneHeaderL.outerHeight();i+=options.showHeaderRow?options.headerRowHeight+getVBoxDelta($headerRowScroller):0,i+=options.showFooterRow?options.footerRowHeight+getVBoxDelta($footerRowScroller):0,i+=getCanvasWidth()>viewportW?scrollbarDimensions.height:0,viewportH=options.rowHeight*getDataLengthIncludingAddNew()+(options.frozenColumn==-1?i:0)}else{var e=options.showColumnHeader?parseFloat($.css($headerScroller[0],"height"))+getVBoxDelta($headerScroller):0,t=options.createPreHeaderPanel&&options.showPreHeaderPanel?options.preHeaderPanelHeight+getVBoxDelta($preHeaderPanelScroller):0;viewportH=parseFloat($.css($container[0],"height",!0))-parseFloat($.css($container[0],"paddingTop",!0))-parseFloat($.css($container[0],"paddingBottom",!0))-e-topPanelH-headerRowH-footerRowH-t}return numVisibleRows=Math.ceil(viewportH/options.rowHeight),viewportH}function getViewportWidth(){viewportW=parseFloat($container.width())}function resizeCanvas(){if(initialized){paneTopH=0,paneBottomH=0,viewportTopH=0,getViewportWidth(),getViewportHeight(),hasFrozenRows?options.frozenBottom?(paneTopH=viewportH-frozenRowsHeight-scrollbarDimensions.height,paneBottomH=frozenRowsHeight+scrollbarDimensions.height):(paneTopH=frozenRowsHeight,paneBottomH=viewportH-frozenRowsHeight):paneTopH=viewportH,paneTopH+=topPanelH+headerRowH+footerRowH,hasFrozenColumns()&&options.autoHeight&&(paneTopH+=scrollbarDimensions.height),viewportTopH=paneTopH-topPanelH-headerRowH-footerRowH,options.autoHeight&&(hasFrozenColumns()&&$container.height(paneTopH+parseFloat($.css($headerScrollerL[0],"height"))),$paneTopL.css("position","relative")),$paneTopL.css({top:$paneHeaderL.height()||(options.showHeaderRow?options.headerRowHeight:0)+(options.showPreHeaderPanel?options.preHeaderPanelHeight:0),height:paneTopH});var i=$paneTopL.position().top+paneTopH;options.autoHeight||$viewportTopL.height(viewportTopH),hasFrozenColumns()?($paneTopR.css({top:$paneHeaderL.height(),height:paneTopH}),$viewportTopR.height(viewportTopH),hasFrozenRows&&($paneBottomL.css({top:i,height:paneBottomH}),$paneBottomR.css({top:i,height:paneBottomH}),$viewportBottomR.height(paneBottomH))):hasFrozenRows&&($paneBottomL.css({width:"100%",height:paneBottomH}),$paneBottomL.css("top",i)),hasFrozenRows?($viewportBottomL.height(paneBottomH),options.frozenBottom?($canvasBottomL.height(frozenRowsHeight),hasFrozenColumns()&&$canvasBottomR.height(frozenRowsHeight)):($canvasTopL.height(frozenRowsHeight),hasFrozenColumns()&&$canvasTopR.height(frozenRowsHeight))):$viewportTopR.height(viewportTopH),(!scrollbarDimensions||!scrollbarDimensions.width)&&(scrollbarDimensions=measureScrollbar()),options.autosizeColsMode===Slick.GridAutosizeColsMode.LegacyForceFit&&autosizeColumns(),updateRowCount(),handleScroll(),lastRenderedScrollLeft=-1,render()}}function updatePagingStatusFromView(i){pagingActive=i.pageSize!==0,pagingIsLastPage=i.pageNum==i.totalPages-1}function updateRowCount(){if(initialized){var i=getDataLength(),e=getDataLengthIncludingAddNew(),t=0,l=hasFrozenRows&&!options.frozenBottom?$canvasBottomL.height():$canvasTopL.height();if(hasFrozenRows)var t=getDataLength()-options.frozenRow;else var t=e+(options.leaveSpaceForNewRows?numVisibleRows-1:0);var r=$viewportScrollContainerY.height(),s=viewportHasVScroll;viewportHasVScroll=options.alwaysShowVerticalScroll||!options.autoHeight&&t*options.rowHeight>r,makeActiveCellNormal();var o=i-1;for(var a in rowsCache)a>o&&removeRowFromCache(a);options.enableAsyncPostRenderCleanup&&startPostProcessingCleanup(),activeCellNode&&activeRow>o&&resetActiveCell();var l=h;options.autoHeight?h=options.rowHeight*t:(th=Math.max(options.rowHeight*t,r-scrollbarDimensions.height),th<maxSupportedCssHeight?(h=ph=th,n=1,cj=0):(h=maxSupportedCssHeight,ph=h/100,n=Math.floor(th/ph),cj=(th-h)/(n-1))),h!==l&&(hasFrozenRows&&!options.frozenBottom?($canvasBottomL.css("height",h),hasFrozenColumns()&&$canvasBottomR.css("height",h)):($canvasTopL.css("height",h),$canvasTopR.css("height",h)),scrollTop=$viewportScrollContainerY[0].scrollTop);var u=scrollTop+offset<=th-r;th==0||scrollTop==0?page=offset=0:scrollTo(u?scrollTop+offset:th-r),h!=l&&options.autoHeight&&resizeCanvas(),options.autosizeColsMode===Slick.GridAutosizeColsMode.LegacyForceFit&&s!=viewportHasVScroll&&autosizeColumns(),updateCanvasWidth(!1)}}function getVisibleRange(i,e){return i==null&&(i=scrollTop),e==null&&(e=scrollLeft),{top:getRowFromPosition(i),bottom:getRowFromPosition(i+viewportH)+1,leftPx:e,rightPx:e+viewportW}}function getRenderedRange(i,e){var t=getVisibleRange(i,e),r=Math.round(viewportH/options.rowHeight),s=options.minRowBuffer;return vScrollDir==-1?(t.top-=r,t.bottom+=s):vScrollDir==1?(t.top-=s,t.bottom+=r):(t.top-=s,t.bottom+=s),t.top=Math.max(0,t.top),t.bottom=Math.min(getDataLengthIncludingAddNew()-1,t.bottom),t.leftPx-=viewportW,t.rightPx+=viewportW,t.leftPx=Math.max(0,t.leftPx),t.rightPx=Math.min(canvasWidth,t.rightPx),t}function ensureCellNodesInRowsCache(i){var e=rowsCache[i];if(e&&e.cellRenderQueue.length)for(var t=e.rowNode.children().last();e.cellRenderQueue.length;){var r=e.cellRenderQueue.pop();e.cellNodesByColumnIdx[r]=t,t=t.prev(),t.length===0&&(t=$(e.rowNode[0]).children().last())}}function cleanUpCells(i,e){if(!(hasFrozenRows&&(options.frozenBottom&&e>actualFrozenRow||e<=actualFrozenRow))){var t=rowsCache[e],r=[];for(var s in t.cellNodesByColumnIdx)if(t.cellNodesByColumnIdx.hasOwnProperty(s)&&(s=s|0,!(s<=options.frozenColumn)&&!(Array.isArray(columns)&&columns[s]&&columns[s].alwaysRenderColumn))){var o=t.cellColSpans[s];(columnPosLeft[s]>i.rightPx||columnPosRight[Math.min(columns.length-1,s+o-1)]<i.leftPx)&&(e==activeRow&&s==activeCell||r.push(s))}for(var a;(a=r.pop())!=null;)t.cellNodesByColumnIdx[a][0].parentElement.removeChild(t.cellNodesByColumnIdx[a][0]),delete t.cellColSpans[a],delete t.cellNodesByColumnIdx[a],postProcessedRows[e]&&delete postProcessedRows[e][a]}}function cleanUpAndRenderCells(i){for(var e,t=[],r=[],s,o,a=i.top,l=i.bottom;a<=l;a++)if(e=rowsCache[a],!!e){ensureCellNodesInRowsCache(a),cleanUpCells(i,a),s=0;var u=data.getItemMetadata&&data.getItemMetadata(a);u=u&&u.columns;for(var p=getDataItem(a),d=0,m=columns.length;d<m&&!(columnPosLeft[d]>i.rightPx);d++){if((o=e.cellColSpans[d])!=null){d+=o>1?o-1:0;continue}if(o=1,u){var g=u[columns[d].id]||u[d];o=g&&g.colspan||1,o==="*"&&(o=m-d)}columnPosRight[Math.min(m-1,d+o-1)]>i.leftPx&&(appendCellHtml(t,a,d,o,p),s++),d+=o>1?o-1:0}s&&r.push(a)}if(t.length){var w=__doc__.createElement("div");w.innerHTML=t.join("");for(var E,A;(E=r.pop())!=null;){e=rowsCache[E];for(var k;(k=e.cellRenderQueue.pop())!=null;)A=w.lastChild,hasFrozenColumns()&&k>options.frozenColumn?e.rowNode[1].appendChild(A):e.rowNode[0].appendChild(A),e.cellNodesByColumnIdx[k]=$(A)}}}function renderRows(i){for(var e=[],t=[],r=[],s=!1,o=getDataLength(),a=i.top,l=i.bottom;a<=l;a++)rowsCache[a]||hasFrozenRows&&options.frozenBottom&&a==getDataLength()||(renderedRows++,r.push(a),rowsCache[a]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},appendRowHtml(e,t,a,i,o),activeCellNode&&activeRow===a&&(s=!0),counter_rows_rendered++);if(r.length){var u=__doc__.createElement("div"),p=__doc__.createElement("div");u.innerHTML=e.join(""),p.innerHTML=t.join("");for(var a=0,l=r.length;a<l;a++)hasFrozenRows&&r[a]>=actualFrozenRow?hasFrozenColumns()?rowsCache[r[a]].rowNode=$().add($(u.firstChild).appendTo($canvasBottomL)).add($(p.firstChild).appendTo($canvasBottomR)):rowsCache[r[a]].rowNode=$().add($(u.firstChild).appendTo($canvasBottomL)):hasFrozenColumns()?rowsCache[r[a]].rowNode=$().add($(u.firstChild).appendTo($canvasTopL)).add($(p.firstChild).appendTo($canvasTopR)):rowsCache[r[a]].rowNode=$().add($(u.firstChild).appendTo($canvasTopL));s&&(activeCellNode=getCellNode(activeRow,activeCell))}}function startPostProcessing(){options.enableAsyncPostRender&&(clearTimeout(h_postrender),h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay))}function startPostProcessingCleanup(){options.enableAsyncPostRenderCleanup&&(clearTimeout(h_postrenderCleanup),h_postrenderCleanup=setTimeout(asyncPostProcessCleanupRows,options.asyncPostRenderCleanupDelay))}function invalidatePostProcessingResults(i){for(var e in postProcessedRows[i])postProcessedRows[i].hasOwnProperty(e)&&(postProcessedRows[i][e]="C");postProcessFromRow=Math.min(postProcessFromRow,i),postProcessToRow=Math.max(postProcessToRow,i),startPostProcessing()}function updateRowPositions(){for(var i in rowsCache){var e=i?parseInt(i):0;rowsCache[e].rowNode[0].style.top=getRowTop(e)+"px"}}function render(){if(initialized){scrollThrottle.dequeue();var i=getVisibleRange(),e=getRenderedRange();if(cleanupRows(e),lastRenderedScrollLeft!=scrollLeft){if(hasFrozenRows){var t=jQuery.extend(!0,{},e);options.frozenBottom?(t.top=actualFrozenRow,t.bottom=getDataLength()):(t.top=0,t.bottom=options.frozenRow),cleanUpAndRenderCells(t)}cleanUpAndRenderCells(e)}renderRows(e),hasFrozenRows&&(options.frozenBottom?renderRows({top:actualFrozenRow,bottom:getDataLength()-1,leftPx:e.leftPx,rightPx:e.rightPx}):renderRows({top:0,bottom:options.frozenRow-1,leftPx:e.leftPx,rightPx:e.rightPx})),postProcessFromRow=i.top,postProcessToRow=Math.min(getDataLengthIncludingAddNew()-1,i.bottom),startPostProcessing(),lastRenderedScrollTop=scrollTop,lastRenderedScrollLeft=scrollLeft,trigger(self.onRendered,{startRow:i.top,endRow:i.bottom,grid:self})}}function handleHeaderRowScroll(){var i=$headerRowScrollContainer[0].scrollLeft;i!=$viewportScrollContainerX[0].scrollLeft&&($viewportScrollContainerX[0].scrollLeft=i)}function handleFooterRowScroll(){var i=$footerRowScrollContainer[0].scrollLeft;i!=$viewportScrollContainerX[0].scrollLeft&&($viewportScrollContainerX[0].scrollLeft=i)}function handlePreHeaderPanelScroll(){handleElementScroll($preHeaderPanelScroller[0])}function handleElementScroll(i){var e=i.scrollLeft;e!=$viewportScrollContainerX[0].scrollLeft&&($viewportScrollContainerX[0].scrollLeft=e)}function handleScroll(){return scrollTop=$viewportScrollContainerY[0].scrollTop,scrollLeft=$viewportScrollContainerX[0].scrollLeft,_handleScroll(!1)}function _handleScroll(i){var e=$viewportScrollContainerY[0].scrollHeight-$viewportScrollContainerY[0].clientHeight,t=$viewportScrollContainerY[0].scrollWidth-$viewportScrollContainerY[0].clientWidth;e=Math.max(0,e),t=Math.max(0,t),scrollTop>e&&(scrollTop=e),scrollLeft>t&&(scrollLeft=t);var r=Math.abs(scrollTop-prevScrollTop),s=Math.abs(scrollLeft-prevScrollLeft);if(s&&(prevScrollLeft=scrollLeft,$viewportScrollContainerX[0].scrollLeft=scrollLeft,$headerScrollContainer[0].scrollLeft=scrollLeft,$topPanelScroller[0].scrollLeft=scrollLeft,$headerRowScrollContainer[0].scrollLeft=scrollLeft,options.createFooterRow&&($footerRowScrollContainer[0].scrollLeft=scrollLeft),options.createPreHeaderPanel&&(hasFrozenColumns()?$preHeaderPanelScrollerR[0].scrollLeft=scrollLeft:$preHeaderPanelScroller[0].scrollLeft=scrollLeft),hasFrozenColumns()?hasFrozenRows&&($viewportTopR[0].scrollLeft=scrollLeft):hasFrozenRows&&($viewportTopL[0].scrollLeft=scrollLeft)),r)if(vScrollDir=prevScrollTop<scrollTop?1:-1,prevScrollTop=scrollTop,i&&($viewportScrollContainerY[0].scrollTop=scrollTop),hasFrozenColumns()&&(hasFrozenRows&&!options.frozenBottom?$viewportBottomL[0].scrollTop=scrollTop:$viewportTopL[0].scrollTop=scrollTop),r<viewportH)scrollTo(scrollTop+offset);else{var o=offset;h==viewportH?page=0:page=Math.min(n-1,Math.floor(scrollTop*((th-viewportH)/(h-viewportH))*(1/ph))),offset=Math.round(page*cj),o!=offset&&invalidateAllRows()}if(s||r){var a=Math.abs(lastRenderedScrollLeft-scrollLeft),l=Math.abs(lastRenderedScrollTop-scrollTop);(a>20||l>20)&&(options.forceSyncScrolling||l<viewportH&&a<viewportW?render():scrollThrottle.enqueue(),trigger(self.onViewportChanged,{}))}return trigger(self.onScroll,{scrollLeft,scrollTop}),!!(s||r)}function ActionThrottle(i,e){var t=!1,r=!1;function s(){t?r=!0:a()}function o(){r=!1}function a(){t=!0,setTimeout(l,e),i()}function l(){r?(o(),a()):t=!1}return{enqueue:s,dequeue:o}}function asyncPostProcessRows(){for(var i=getDataLength();postProcessFromRow<=postProcessToRow;){var e=vScrollDir>=0?postProcessFromRow++:postProcessToRow--,t=rowsCache[e];if(!(!t||e>=i)){postProcessedRows[e]||(postProcessedRows[e]={}),ensureCellNodesInRowsCache(e);for(var r in t.cellNodesByColumnIdx)if(t.cellNodesByColumnIdx.hasOwnProperty(r)){r=r|0;var s=columns[r],o=postProcessedRows[e][r];if(s.asyncPostRender&&o!=="R"){var a=t.cellNodesByColumnIdx[r];a&&s.asyncPostRender(a,e,getDataItem(e),s,o==="C"),postProcessedRows[e][r]="R"}}h_postrender=setTimeout(asyncPostProcessRows,options.asyncPostRenderDelay);return}}}function asyncPostProcessCleanupRows(){if(postProcessedCleanupQueue.length>0){for(var i=postProcessedCleanupQueue[0].groupId;postProcessedCleanupQueue.length>0&&postProcessedCleanupQueue[0].groupId==i;){var e=postProcessedCleanupQueue.shift();if(e.actionType=="R"&&$(e.node).remove(),e.actionType=="C"){var t=columns[e.columnIdx];t.asyncPostRenderCleanup&&e.node&&t.asyncPostRenderCleanup(e.node,e.rowIdx,t)}}h_postrenderCleanup=setTimeout(asyncPostProcessCleanupRows,options.asyncPostRenderCleanupDelay)}}function updateCellCssStylesOnRenderedRows(i,e){var t,r,s,o;for(var a in rowsCache){if(o=e&&e[a],s=i&&i[a],o)for(r in o)(!s||o[r]!=s[r])&&(t=getCellNode(a,getColumnIndex(r)),t&&$(t).removeClass(o[r]));if(s)for(r in s)(!o||o[r]!=s[r])&&(t=getCellNode(a,getColumnIndex(r)),t&&$(t).addClass(s[r]))}}function addCellCssStyles(i,e){if(cellCssClasses[i])throw new Error("SlickGrid addCellCssStyles: cell CSS hash with key '"+i+"' already exists.");cellCssClasses[i]=e,updateCellCssStylesOnRenderedRows(e,null),trigger(self.onCellCssStylesChanged,{key:i,hash:e,grid:self})}function removeCellCssStyles(i){cellCssClasses[i]&&(updateCellCssStylesOnRenderedRows(null,cellCssClasses[i]),delete cellCssClasses[i],trigger(self.onCellCssStylesChanged,{key:i,hash:null,grid:self}))}function setCellCssStyles(i,e){var t=cellCssClasses[i];cellCssClasses[i]=e,updateCellCssStylesOnRenderedRows(e,t),trigger(self.onCellCssStylesChanged,{key:i,hash:e,grid:self})}function getCellCssStyles(i){return cellCssClasses[i]}function flashCell(i,e,t){t=t||100;function r(o,a){a&&setTimeout(function(){o.queue(function(){o.toggleClass(options.cellFlashingCssClass).dequeue(),r(o,a-1)})},t)}if(rowsCache[i]){var s=$(getCellNode(i,e));r(s,4)}}function handleMouseWheel(i,e,t,r){var s=$(i.target).closest(".slick-row"),o=s[0];if(o!=rowNodeFromLastMouseWheelEvent){var a=s.parents(".grid-canvas"),l=a.hasClass("grid-canvas-left");if(zombieRowNodeFromLastMouseWheelEvent&&zombieRowNodeFromLastMouseWheelEvent[l?0:1]!=o){var u=zombieRowNodeFromLastMouseWheelEvent[l||zombieRowNodeFromLastMouseWheelEvent.length==1?0:1];u.parentElement.removeChild(u),zombieRowNodeFromLastMouseWheelEvent=null}rowNodeFromLastMouseWheelEvent=o}scrollTop=Math.max(0,$viewportScrollContainerY[0].scrollTop-r*options.rowHeight),scrollLeft=$viewportScrollContainerX[0].scrollLeft+t*10;var p=_handleScroll(!0);p&&i.preventDefault()}function handleDragInit(i,e){var t=getCellFromEvent(i);if(!t||!cellExists(t.row,t.cell))return!1;var r=trigger(self.onDragInit,e,i);return i.isImmediatePropagationStopped()?r:!1}function handleDragStart(i,e){var t=getCellFromEvent(i);if(!t||!cellExists(t.row,t.cell))return!1;var r=trigger(self.onDragStart,e,i);return i.isImmediatePropagationStopped()?r:!1}function handleDrag(i,e){return trigger(self.onDrag,e,i)}function handleDragEnd(i,e){trigger(self.onDragEnd,e,i)}function handleKeyDown(i){trigger(self.onKeyDown,{row:activeRow,cell:activeCell},i);var e=i.isImmediatePropagationStopped(),t=Slick.keyCode;if(!e&&!i.shiftKey&&!i.altKey){if(options.editable&&currentEditor&&currentEditor.keyCaptureList&&currentEditor.keyCaptureList.indexOf(i.which)>-1)return;i.which==t.HOME?e=i.ctrlKey?navigateTop():navigateRowStart():i.which==t.END&&(e=i.ctrlKey?navigateBottom():navigateRowEnd())}if(!e)if(!i.shiftKey&&!i.altKey&&!i.ctrlKey){if(options.editable&&currentEditor&&currentEditor.keyCaptureList&&currentEditor.keyCaptureList.indexOf(i.which)>-1)return;if(i.which==t.ESCAPE){if(!getEditorLock().isActive())return;cancelEditAndSetFocus()}else i.which==t.PAGE_DOWN?(navigatePageDown(),e=!0):i.which==t.PAGE_UP?(navigatePageUp(),e=!0):i.which==t.LEFT?e=navigateLeft():i.which==t.RIGHT?e=navigateRight():i.which==t.UP?e=navigateUp():i.which==t.DOWN?e=navigateDown():i.which==t.TAB?e=navigateNext():i.which==t.ENTER&&(options.editable&&(currentEditor?activeRow===getDataLength()?navigateDown():commitEditAndSetFocus():getEditorLock().commitCurrentEdit()&&makeActiveCellEditable(void 0,void 0,i)),e=!0)}else i.which==t.TAB&&i.shiftKey&&!i.ctrlKey&&!i.altKey&&(e=navigatePrev());if(e){i.stopPropagation(),i.preventDefault();try{i.originalEvent.keyCode=0}catch{}}}function handleClick(i){currentEditor||(i.target!=__doc__.activeElement||$(i.target).hasClass("slick-cell"))&&setFocus();var e=getCellFromEvent(i);if(!(!e||currentEditor!==null&&activeRow==e.row&&activeCell==e.cell)&&(trigger(self.onClick,{row:e.row,cell:e.cell},i),!i.isImmediatePropagationStopped()&&canCellBeActive(e.row,e.cell)&&(!getEditorLock().isActive()||getEditorLock().commitCurrentEdit()))){scrollRowIntoView(e.row,!1);var t=i.target&&i.target.className===Slick.preClickClassName,r=columns[e.cell],s=!!(options.editable&&r&&r.editor&&options.suppressActiveCellChangeOnEdit);setActiveCellInternal(getCellNode(e.row,e.cell),null,t,s,i)}}function handleContextMenu(i){var e=$(i.target).closest(".slick-cell",$canvas);e.length!==0&&(activeCellNode===e[0]&&currentEditor!==null||trigger(self.onContextMenu,{},i))}function handleDblClick(i){var e=getCellFromEvent(i);!e||currentEditor!==null&&activeRow==e.row&&activeCell==e.cell||(trigger(self.onDblClick,{row:e.row,cell:e.cell},i),!i.isImmediatePropagationStopped()&&options.editable&&gotoCell(e.row,e.cell,!0,i))}function handleHeaderMouseEnter(i){trigger(self.onHeaderMouseEnter,{column:$(this).data("column"),grid:self},i)}function handleHeaderMouseLeave(i){trigger(self.onHeaderMouseLeave,{column:$(this).data("column"),grid:self},i)}function handleHeaderContextMenu(i){var e=$(i.target).closest(".slick-header-column",".slick-header-columns"),t=e&&e.data("column");trigger(self.onHeaderContextMenu,{column:t},i)}function handleHeaderClick(i){if(!columnResizeDragging){var e=$(i.target).closest(".slick-header-column",".slick-header-columns"),t=e&&e.data("column");t&&trigger(self.onHeaderClick,{column:t},i)}}function handleFooterContextMenu(i){var e=$(i.target).closest(".slick-footerrow-column",".slick-footerrow-columns"),t=e&&e.data("column");trigger(self.onFooterContextMenu,{column:t},i)}function handleFooterClick(i){var e=$(i.target).closest(".slick-footerrow-column",".slick-footerrow-columns"),t=e&&e.data("column");trigger(self.onFooterClick,{column:t},i)}function handleMouseEnter(i){trigger(self.onMouseEnter,{},i)}function handleMouseLeave(i){trigger(self.onMouseLeave,{},i)}function cellExists(i,e){return!(i<0||i>=getDataLength()||e<0||e>=columns.length)}function getCellFromPoint(i,e){for(var t=getRowFromPosition(e),r=0,s=0,o=0;o<columns.length&&s<i;o++)s+=columns[o].width,r++;return r<0&&(r=0),{row:t,cell:r-1}}function getCellFromNode(i){var e=/l\d+/.exec(i.className);if(!e)throw new Error("SlickGrid getCellFromNode: cannot get cell - "+i.className);return parseInt(e[0].substr(1,e[0].length-1),10)}function getRowFromNode(i){for(var e in rowsCache)for(var t in rowsCache[e].rowNode)if(rowsCache[e].rowNode[t]===i)return e?parseInt(e):0;return null}function getFrozenRowOffset(i){var e=hasFrozenRows?options.frozenBottom?i>=actualFrozenRow?h<viewportTopH?actualFrozenRow*options.rowHeight:h:0:i>=actualFrozenRow?frozenRowsHeight:0:0;return e}function getCellFromEvent(i){var e,t,r=$(i.target).closest(".slick-cell",$canvas);if(!r.length)return null;if(e=getRowFromNode(r[0].parentNode),hasFrozenRows){var s=r.parents(".grid-canvas").offset(),o=0,a=r.parents(".grid-canvas-bottom").length;a&&(o=options.frozenBottom?$canvasTopL.height():frozenRowsHeight),e=getCellFromPoint(i.clientX-s.left,i.clientY-s.top+o+$(__doc__).scrollTop()).row}return t=getCellFromNode(r[0]),e==null||t==null?null:{row:e,cell:t}}function getCellNodeBox(i,e){if(!cellExists(i,e))return null;for(var t=getFrozenRowOffset(i),r=getRowTop(i)-t,s=r+options.rowHeight-1,o=0,a=0;a<e;a++)o+=columns[a].width,options.frozenColumn==a&&(o=0);var l=o+columns[e].width;return{top:r,left:o,bottom:s,right:l}}function resetActiveCell(){setActiveCellInternal(null,!1)}function setFocus(){tabbingDirection==-1?$focusSink[0].focus():$focusSink2[0].focus()}function scrollCellIntoView(i,e,t){if(scrollRowIntoView(i,t),!(e<=options.frozenColumn)){var r=getColspan(i,e);internalScrollColumnIntoView(columnPosLeft[e],columnPosRight[e+(r>1?r-1:0)])}}function internalScrollColumnIntoView(i,e){var t=scrollLeft+$viewportScrollContainerX.width();i<scrollLeft?($viewportScrollContainerX.scrollLeft(i),handleScroll(),render()):e>t&&($viewportScrollContainerX.scrollLeft(Math.min(i,e-$viewportScrollContainerX[0].clientWidth)),handleScroll(),render())}function scrollColumnIntoView(i){internalScrollColumnIntoView(columnPosLeft[i],columnPosRight[i])}function setActiveCellInternal(i,e,t,r,s){if(activeCellNode!==null&&(makeActiveCellNormal(),$(activeCellNode).removeClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).removeClass("active")),activeCellNode=i,activeCellNode!=null){var o=$(activeCellNode),a=o.offset(),l=Math.floor(o.parents(".grid-canvas").offset().top),u=o.parents(".grid-canvas-bottom").length;hasFrozenRows&&u&&(l-=options.frozenBottom?$canvasTopL.height():frozenRowsHeight);var p=getCellFromPoint(a.left,Math.ceil(a.top)-l);activeRow=p.row,activeCell=activePosX=activeCell=activePosX=getCellFromNode(activeCellNode),e==null&&(e=activeRow==getDataLength()||options.autoEdit),options.showCellSelection&&(o.addClass("active"),rowsCache[activeRow]&&$(rowsCache[activeRow].rowNode).addClass("active")),options.editable&&e&&isCellPotentiallyEditable(activeRow,activeCell)&&(clearTimeout(h_editorLoader),options.asyncEditorLoading?h_editorLoader=setTimeout(function(){makeActiveCellEditable(void 0,t,s)},options.asyncEditorLoadDelay):makeActiveCellEditable(void 0,t,s))}else activeRow=activeCell=null;r||trigger(self.onActiveCellChanged,getActiveCell())}function clearTextSelection(){if(__doc__.selection&&__doc__.selection.empty)try{__doc__.selection.empty()}catch{}else if(window.getSelection){var i=window.getSelection();i&&i.removeAllRanges&&i.removeAllRanges()}}function isCellPotentiallyEditable(i,e){var t=getDataLength();return!(i<t&&!getDataItem(i)||columns[e].cannotTriggerInsert&&i>=t||!getEditor(i,e))}function makeActiveCellNormal(){if(currentEditor){if(trigger(self.onBeforeCellEditorDestroy,{editor:currentEditor}),currentEditor.destroy(),currentEditor=null,activeCellNode){var i=getDataItem(activeRow);if($(activeCellNode).removeClass("editable invalid"),i){var e=columns[activeCell],t=getFormatter(activeRow,e),r=t(activeRow,activeCell,getDataItemValueForColumn(i,e),e,i,self);applyFormatResultToCellNode(r,activeCellNode),invalidatePostProcessingResults(activeRow)}}navigator.userAgent.toLowerCase().match(/msie/)&&clearTextSelection(),getEditorLock().deactivate(editController)}}function makeActiveCellEditable(i,e,t){if(activeCellNode){if(!options.editable)throw new Error("SlickGrid makeActiveCellEditable : should never get called when options.editable is false");if(clearTimeout(h_editorLoader),!!isCellPotentiallyEditable(activeRow,activeCell)){var r=columns[activeCell],s=getDataItem(activeRow);if(trigger(self.onBeforeEditCell,{row:activeRow,cell:activeCell,item:s,column:r,target:"grid"})===!1){setFocus();return}getEditorLock().activate(editController),$(activeCellNode).addClass("editable");var o=i||getEditor(activeRow,activeCell);!i&&!o.suppressClearOnEdit&&(activeCellNode.innerHTML="");var a=data.getItemMetadata&&data.getItemMetadata(activeRow);a=a&&a.columns;var l=a&&(a[r.id]||a[activeCell]);currentEditor=new o({grid:self,gridPosition:absBox($container[0]),position:absBox(activeCellNode),container:activeCellNode,column:r,columnMetaData:l,item:s||{},event:t,commitChanges:commitEditAndSetFocus,cancelChanges:cancelEditAndSetFocus}),s&&(currentEditor.loadValue(s),e&&currentEditor.preClick&&currentEditor.preClick()),serializedEditorValue=currentEditor.serializeValue(),currentEditor.position&&handleActiveCellPositionChange()}}}function commitEditAndSetFocus(){getEditorLock().commitCurrentEdit()&&(setFocus(),options.autoEdit&&navigateDown())}function cancelEditAndSetFocus(){getEditorLock().cancelCurrentEdit()&&setFocus()}function absBox(i){var e={top:i.offsetTop,left:i.offsetLeft,bottom:0,right:0,width:$(i).outerWidth(),height:$(i).outerHeight(),visible:!0};e.bottom=e.top+e.height,e.right=e.left+e.width;for(var t=i.offsetParent;(i=i.parentNode)!=__doc__.body&&i!=null;)e.visible&&i.scrollHeight!=i.offsetHeight&&$(i).css("overflowY")!="visible"&&(e.visible=e.bottom>i.scrollTop&&e.top<i.scrollTop+i.clientHeight),e.visible&&i.scrollWidth!=i.offsetWidth&&$(i).css("overflowX")!="visible"&&(e.visible=e.right>i.scrollLeft&&e.left<i.scrollLeft+i.clientWidth),e.left-=i.scrollLeft,e.top-=i.scrollTop,i===t&&(e.left+=i.offsetLeft,e.top+=i.offsetTop,t=i.offsetParent),e.bottom=e.top+e.height,e.right=e.left+e.width;return e}function getActiveCellPosition(){return absBox(activeCellNode)}function getGridPosition(){return absBox($container[0])}function handleActiveCellPositionChange(){if(activeCellNode&&(trigger(self.onActiveCellPositionChanged,{}),currentEditor)){var i=getActiveCellPosition();currentEditor.show&&currentEditor.hide&&(i.visible?currentEditor.show():currentEditor.hide()),currentEditor.position&&currentEditor.position(i)}}function getCellEditor(){return currentEditor}function getActiveCell(){return activeCellNode?{row:activeRow,cell:activeCell}:null}function getActiveCellNode(){return activeCellNode}function scrollRowIntoView(i,e){if(!hasFrozenRows||!options.frozenBottom&&i>actualFrozenRow-1||options.frozenBottom&&i<actualFrozenRow-1){var t=$viewportScrollContainerY.height(),r=hasFrozenRows&&!options.frozenBottom?i-options.frozenRow:i,s=r*options.rowHeight,o=(r+1)*options.rowHeight-t+(viewportHasHScroll?scrollbarDimensions.height:0);(r+1)*options.rowHeight>scrollTop+t+offset?(scrollTo(e?s:o),render()):r*options.rowHeight<scrollTop+offset&&(scrollTo(e?o:s),render())}}function scrollRowToTop(i){scrollTo(i*options.rowHeight),render()}function scrollPage(i){var e=i*numVisibleRows,t=scrollTop+options.rowHeight-1;if(scrollTo((getRowFromPosition(t)+e)*options.rowHeight),render(),options.enableCellNavigation&&activeRow!=null){var r=activeRow+e,s=getDataLengthIncludingAddNew();r>=s&&(r=s-1),r<0&&(r=0);for(var o=0,a=null,l=activePosX;o<=activePosX;)canCellBeActive(r,o)&&(a=o),o+=getColspan(r,o);a!==null?(setActiveCellInternal(getCellNode(r,a)),activePosX=l):resetActiveCell()}}function navigatePageDown(){scrollPage(1)}function navigatePageUp(){scrollPage(-1)}function navigateTop(){navigateToRow(0)}function navigateBottom(){navigateToRow(getDataLength()-1)}function navigateToRow(i){var e=getDataLength();if(!e)return!0;if(i<0?i=0:i>=e&&(i=e-1),scrollCellIntoView(i,0,!0),options.enableCellNavigation&&activeRow!=null){for(var t=0,r=null,s=activePosX;t<=activePosX;)canCellBeActive(i,t)&&(r=t),t+=getColspan(i,t);r!==null?(setActiveCellInternal(getCellNode(i,r)),activePosX=s):resetActiveCell()}return!0}function getColspan(i,e){var t=data.getItemMetadata&&data.getItemMetadata(i);if(!t||!t.columns)return 1;var r=t.columns[columns[e].id]||t.columns[e],s=r&&r.colspan;return s==="*"?s=columns.length-e:s=s||1,s}function findFirstFocusableCell(i){for(var e=0;e<columns.length;){if(canCellBeActive(i,e))return e;e+=getColspan(i,e)}return null}function findLastFocusableCell(i){for(var e=0,t=null;e<columns.length;)canCellBeActive(i,e)&&(t=e),e+=getColspan(i,e);return t}function gotoRight(i,e,t){if(e>=columns.length)return null;do e+=getColspan(i,e);while(e<columns.length&&!canCellBeActive(i,e));return e<columns.length?{row:i,cell:e,posX:e}:null}function gotoLeft(i,e,t){if(e<=0)return null;var r=findFirstFocusableCell(i);if(r===null||r>=e)return null;for(var s={row:i,cell:r,posX:r},o;;){if(o=gotoRight(s.row,s.cell,s.posX),!o)return null;if(o.cell>=e)return s;s=o}}function gotoDown(i,e,t){for(var r,s=getDataLengthIncludingAddNew();;){if(++i>=s)return null;for(r=e=0;e<=t;)r=e,e+=getColspan(i,e);if(canCellBeActive(i,r))return{row:i,cell:r,posX:t}}}function gotoUp(i,e,t){for(var r;;){if(--i<0)return null;for(r=e=0;e<=t;)r=e,e+=getColspan(i,e);if(canCellBeActive(i,r))return{row:i,cell:r,posX:t}}}function gotoNext(i,e,t){if(i==null&&e==null&&(i=e=0,canCellBeActive(i,e)))return{row:i,cell:e,posX:e};var r=gotoRight(i,e);if(r)return r;var s=null,o=getDataLengthIncludingAddNew();for(i===o-1&&i--;++i<o;)if(s=findFirstFocusableCell(i),s!==null)return{row:i,cell:s,posX:s};return null}function gotoPrev(i,e,t){if(i==null&&e==null&&(i=getDataLengthIncludingAddNew()-1,e=columns.length-1,canCellBeActive(i,e)))return{row:i,cell:e,posX:e};for(var r,s;!r&&(r=gotoLeft(i,e),!r);){if(--i<0)return null;e=0,s=findLastFocusableCell(i),s!==null&&(r={row:i,cell:s,posX:s})}return r}function gotoRowStart(i,e,t){var r=findFirstFocusableCell(i);return r===null?null:{row:i,cell:r,posX:r}}function gotoRowEnd(i,e,t){var r=findLastFocusableCell(i);return r===null?null:{row:i,cell:r,posX:r}}function navigateRight(){return navigate("right")}function navigateLeft(){return navigate("left")}function navigateDown(){return navigate("down")}function navigateUp(){return navigate("up")}function navigateNext(){return navigate("next")}function navigatePrev(){return navigate("prev")}function navigateRowStart(){return navigate("home")}function navigateRowEnd(){return navigate("end")}function navigate(i){if(!options.enableCellNavigation||!activeCellNode&&i!="prev"&&i!="next")return!1;if(!getEditorLock().commitCurrentEdit())return!0;setFocus();var e={up:-1,down:1,left:-1,right:1,prev:-1,next:1,home:-1,end:1};tabbingDirection=e[i];var t={up:gotoUp,down:gotoDown,left:gotoLeft,right:gotoRight,prev:gotoPrev,next:gotoNext,home:gotoRowStart,end:gotoRowEnd},r=t[i],s=r(activeRow,activeCell,activePosX);if(s){if(hasFrozenRows&&options.frozenBottom&s.row==getDataLength())return;var o=s.row==getDataLength();return(!options.frozenBottom&&s.row>=actualFrozenRow||options.frozenBottom&&s.row<actualFrozenRow)&&scrollCellIntoView(s.row,s.cell,!o&&options.emulatePagingWhenScrolling),setActiveCellInternal(getCellNode(s.row,s.cell)),activePosX=s.posX,!0}else return setActiveCellInternal(getCellNode(activeRow,activeCell)),!1}function getCellNode(i,e){if(rowsCache[i]){ensureCellNodesInRowsCache(i);try{return rowsCache[i].cellNodesByColumnIdx.length>e?rowsCache[i].cellNodesByColumnIdx[e][0]:null}catch{return rowsCache[i].cellNodesByColumnIdx[e]}}return null}function setActiveCell(i,e,t,r,s){initialized&&(i>getDataLength()||i<0||e>=columns.length||e<0||options.enableCellNavigation&&(scrollCellIntoView(i,e,!1),setActiveCellInternal(getCellNode(i,e),t,r,s)))}function setActiveRow(i,e,t){initialized&&(i>getDataLength()||i<0||e>=columns.length||e<0||(activeRow=i,t||scrollCellIntoView(i,e||0,!1)))}function canCellBeActive(i,e){if(!options.enableCellNavigation||i>=getDataLengthIncludingAddNew()||i<0||e>=columns.length||e<0)return!1;var t=data.getItemMetadata&&data.getItemMetadata(i);if(t&&typeof t.focusable<"u")return!!t.focusable;var r=t&&t.columns;return r&&r[columns[e].id]&&typeof r[columns[e].id].focusable<"u"?!!r[columns[e].id].focusable:r&&r[e]&&typeof r[e].focusable<"u"?!!r[e].focusable:!!columns[e].focusable}function canCellBeSelected(i,e){if(i>=getDataLength()||i<0||e>=columns.length||e<0)return!1;var t=data.getItemMetadata&&data.getItemMetadata(i);if(t&&typeof t.selectable<"u")return!!t.selectable;var r=t&&t.columns&&(t.columns[columns[e].id]||t.columns[e]);return r&&typeof r.selectable<"u"?!!r.selectable:!!columns[e].selectable}function gotoCell(i,e,t,r){if(initialized&&canCellBeActive(i,e)&&getEditorLock().commitCurrentEdit()){scrollCellIntoView(i,e,!1);var s=getCellNode(i,e),o=columns[e],a=!!(options.editable&&o&&o.editor&&options.suppressActiveCellChangeOnEdit);setActiveCellInternal(s,t||i===getDataLength()||options.autoEdit,null,a,r),currentEditor||setFocus()}}function commitCurrentEdit(){var i=getDataItem(activeRow),e=columns[activeCell];if(currentEditor){if(currentEditor.isValueChanged()){var t=currentEditor.validate();if(t.valid){if(activeRow<getDataLength()){var r={row:activeRow,cell:activeCell,editor:currentEditor,serializedValue:currentEditor.serializeValue(),prevSerializedValue:serializedEditorValue,execute:function(){this.editor.applyValue(i,this.serializedValue),updateRow(this.row),trigger(self.onCellChange,{row:this.row,cell:this.cell,item:i,column:e})},undo:function(){this.editor.applyValue(i,this.prevSerializedValue),updateRow(this.row),trigger(self.onCellChange,{row:this.row,cell:this.cell,item:i,column:e})}};options.editCommandHandler?(makeActiveCellNormal(),options.editCommandHandler(i,e,r)):(r.execute(),makeActiveCellNormal())}else{var s={};currentEditor.applyValue(s,currentEditor.serializeValue()),makeActiveCellNormal(),trigger(self.onAddNewRow,{item:s,column:e})}return!getEditorLock().isActive()}else return $(activeCellNode).removeClass("invalid"),$(activeCellNode).width(),$(activeCellNode).addClass("invalid"),trigger(self.onValidationError,{editor:currentEditor,cellNode:activeCellNode,validationResults:t,row:activeRow,cell:activeCell,column:e}),currentEditor.focus(),!1}makeActiveCellNormal()}return!0}function cancelCurrentEdit(){return makeActiveCellNormal(),!0}function rowsToRanges(i){for(var e=[],t=columns.length-1,r=0;r<i.length;r++)e.push(new Slick.Range(i[r],0,i[r],t));return e}function getSelectedRows(){if(!selectionModel)throw new Error("SlickGrid Selection model is not set");return selectedRows.slice(0)}function setSelectedRows(i){if(!selectionModel)throw new Error("SlickGrid Selection model is not set");self&&self.getEditorLock&&!self.getEditorLock().isActive()&&selectionModel.setSelectedRanges(rowsToRanges(i))}function getBaseDocument(){return __doc__}function setBaseDocument(i){__doc__=i,stylesheet=null;var e=__doc__.styleSheets;for(let t=0;t<e.length;t++)if(e[t].rules[0].selectorText&&e[t].rules[0].selectorText.includes(uid)){stylesheet=e[t];break}$style=$(stylesheet.ownerNode),removeCssRules(),createCssRules(),setColumns(columns)}this.debug=function(){var i="";i+=`
counter_rows_rendered:  `+counter_rows_rendered,i+=`
counter_rows_removed:  `+counter_rows_removed,i+=`
renderedRows:  `+renderedRows,i+=`
numVisibleRows:  `+numVisibleRows,i+=`
maxSupportedCssHeight:  `+maxSupportedCssHeight,i+=`
n(umber of pages):  `+n,i+=`
(current) page:  `+page,i+=`
page height (ph):  `+ph,i+=`
vScrollDir:  `+vScrollDir,alert(i)},this.eval=function(expr){return eval(expr)},$.extend(this,{slickGridVersion:"2.4.38",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onFooterRowCellRendered:new Slick.Event,onFooterContextMenu:new Slick.Event,onFooterClick:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onBeforeFooterRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onAddNewRow:new Slick.Event,onBeforeAppendCell:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsDrag:new Slick.Event,onColumnsResized:new Slick.Event,onColumnsResizeDblClick:new Slick.Event,onBeforeColumnsResize:new Slick.Event,onCellChange:new Slick.Event,onCompositeEditorChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,onAutosizeColumns:new Slick.Event,onRendered:new Slick.Event,onSetOptions:new Slick.Event,registerPlugin,unregisterPlugin,getPluginByName,getColumns,setColumns,getColumnIndex,updateColumnHeader,setSortColumn,setSortColumns,getSortColumns,autosizeColumns,autosizeColumn,getOptions,setOptions,getData,getDataLength,getDataItem,setData,getSelectionModel,setSelectionModel,getSelectedRows,setSelectedRows,getContainerNode,updatePagingStatusFromView,applyFormatResultToCellNode,render,reRenderColumns,invalidate,invalidateRow,invalidateRows,invalidateAllRows,updateCell,updateRow,getViewport:getVisibleRange,getRenderedRange,resizeCanvas,updateRowCount,scrollRowIntoView,scrollRowToTop,scrollCellIntoView,scrollColumnIntoView,getCanvasNode,getUID,getHeaderColumnWidthDiff,getScrollbarDimensions,getHeadersWidth,getCanvasWidth,getCanvases,getActiveCanvasNode,setActiveCanvasNode,getViewportNode,getViewports,getActiveViewportNode,setActiveViewportNode,focus:setFocus,scrollTo,cacheCssForHiddenInit,restoreCssFromHiddenInit,getCellFromPoint,getCellFromEvent,getActiveCell,setActiveCell,setActiveRow,getActiveCellNode,getActiveCellPosition,resetActiveCell,editActiveCell:makeActiveCellEditable,getCellEditor,getCellNode,getCellNodeBox,canCellBeSelected,canCellBeActive,navigatePrev,navigateNext,navigateUp,navigateDown,navigateLeft,navigateRight,navigatePageUp,navigatePageDown,navigateTop,navigateBottom,navigateRowStart,navigateRowEnd,gotoCell,getTopPanel,setTopPanelVisibility,getPreHeaderPanel,getPreHeaderPanelLeft:getPreHeaderPanel,getPreHeaderPanelRight,setPreHeaderPanelVisibility,getHeader,getHeaderColumn,setHeaderRowVisibility,getHeaderRow,getHeaderRowColumn,setFooterRowVisibility,getFooterRow,getFooterRowColumn,getGridPosition,flashCell,addCellCssStyles,setCellCssStyles,removeCellCssStyles,getCellCssStyles,getFrozenRowOffset,setColumnHeaderVisibility,init:finishInitialization,destroy,getEditorLock,getEditController,applyColumnWidths,setBaseDocument,getBaseDocument}),init()}function TextEditor(i){var e,t;this.init=function(){e=$("<INPUT type=text class='editor-text' />").appendTo(i.container).on("keyup",r=>{const s=r.which;if(s===37||s===39||s===8){r.stopImmediatePropagation();return}this.autoCorrect(e.val())})},this.autoCorrect=function(r){const o=i.grid.getData().getValueSuggestion(r,i.column.field);o&&e.val(o)},this.destroy=function(){e.remove()},this.focus=function(){e.focus()},this.getValue=function(){return e.val()},this.setValue=function(r){e.val(r)},this.loadValue=function(r){t=r[i.column.field]||"",e.val(t),e[0].defaultValue=t,e.select()},this.serializeValue=function(){return e.val()},this.applyValue=function(r,s,o=!0){i.grid.getData().updateValue(s,r.__index__,i.column.field,o)},this.isValueChanged=function(){return!(e.val()==""&&t==null)&&e.val()!=t},this.validate=function(){if(i.column.validator){var r=i.column.validator(e.val());if(!r.valid)return r}return{valid:!0,msg:null}},this.init()}function Overlays(i){var e,t,r,s,o=this,a=new Slick.EventHandler,l,u={buttonCssClass:null,buttonImage:"../images/down.gif",decoratorWidth:2};function p(U){i=$.extend(!0,{},u,i),s=U,l=new ue(s),e=m(),a.subscribe(s.onActiveCellChanged,g).subscribe(s.onColumnsResized,w).subscribe(s.onScroll,E)}function d(){a.unsubscribeAll(),e.$handle.unbind("dragstart",k).unbind("drag",O).unbind("dragend",ne),e.remove()}function m(){var U=s.getCanvasNode(),_=new Q(U);return _.$handle.bind("dragstart",k).bind("drag",O).bind("dragend",ne),_}function g(U,_){l.hide(),A()}function w(U,_){A()}function E(U,_){A()}function A(U,_){var Se=s.getActiveCell();if(!Se){e.toggle(!1);return}var Me=s.getColumns()[Se.cell];e.toggle(!0),e.$handle.toggle(typeof Me.editor<"u");var Ke=s.getCellNodeBox(Se.row,Se.cell);Ke.height=Ke.bottom-Ke.top,Ke.width=Ke.right-Ke.left,e.$left.css({left:Ke.left-2,top:Ke.top,width:2,height:Ke.height}),e.$right.css({left:Ke.left+Ke.width-1,top:Ke.top,width:2,height:Ke.height}),e.$top.css({left:Ke.left-2,top:Ke.top-2,width:Ke.width+3,height:2}),e.$bottom.css({left:Ke.left-2,top:Ke.top+Ke.height-1,width:Ke.width+3,height:2}),e.$handle.css({left:Ke.left+Ke.width-4,top:Ke.top+Ke.height-4,width:1,height:1})}function k(U,_){var Se=s.getActiveCell();if(s.canCellBeSelected(Se.row,Se.cell)&&(r=!0,U.stopImmediatePropagation()),!r)return null;const Me=s.getCellEditor();return Me&&Me.applyValue(s.getDataItem(Se.row),Me.getValue(),!1),s.focus(),t=Se.row,_.range={start:Se,end:{}},$(this).css({"background-color":"transparent","border-color":"transparent"}),l.show(new Slick.Range(Se.row,Se.cell))}function O(U,_){if(!r)return;var Se=s.getCanvasNode();U.stopImmediatePropagation();var Me=s.getCellFromPoint(U.pageX-$(Se).offset().left,U.pageY-$(Se).offset().top);if(!s.canCellBeSelected(Me.row,Me.cell))return;_.range.end=Me,l.show(new Slick.Range(_.range.start.row,_.range.start.cell,Me.row,_.range.start.cell));const Ke=s.getViewport();Ke.bottom===Me.row&&s.scrollRowIntoView(Me.row+7),Ke.top===Me.row&&s.scrollRowIntoView(Ke.top-7)}function ne(U,_){if(!r)return;r=!1,$(this).css({"background-color":"","border-color":""}),l.hideHandle();const Se=l.getSelectedRange(),Me=t<Se.toRow?"+":"-";o.onFillUpDown.notify({dir:Me,grid:s,range:Se},U,o),l.hide(),U.preventDefault(),U.stopPropagation()}function Q(U,_){var Se=(_||"")+"cell-overlay";this.$left=$("<div>").addClass(Se).addClass("left").appendTo(U),this.$right=$("<div>").addClass(Se).addClass("right").appendTo(U),this.$top=$("<div>").addClass(Se).addClass("top").appendTo(U),this.$bottom=$("<div>").addClass(Se).addClass("bottom").appendTo(U),this.$handle=$("<div>").addClass("handle-overlay").data("__doc__",s.getBaseDocument()).appendTo(U),this.toggle=function(Me){this.$left.toggle(Me),this.$right.toggle(Me),this.$top.toggle(Me),this.$bottom.toggle(Me),this.$handle.toggle(Me)},this.remove=function(){this.$left.remove(),this.$right.remove(),this.$top.remove(),this.$bottom.remove(),this.$handle.remove()}}function ue(U){var _,Se;function Me(ze){Se=ze,_||(_=new Q(s.getCanvasNode(),"selection-"));var Je=U.getCellNodeBox(ze.fromRow,ze.fromCell),St=U.getCellNodeBox(ze.toRow,ze.toCell);return _.$left.css({top:Je.top-2,left:Je.left-2,height:St.bottom-Je.top+2,width:i.decoratorWidth}),_.$right.css({top:Je.top-2,left:St.right-1,height:St.bottom-Je.top+2,width:i.decoratorWidth}),_.$top.css({top:Je.top-2,left:St.left-1,height:i.decoratorWidth,width:St.right-Je.left+2}),_.$bottom.css({top:St.bottom-1,left:Je.left-2,height:i.decoratorWidth,width:St.right-Je.left+3}),_.$handle.css({top:St.bottom-3,left:Je.right-4,height:1,width:1}),_}function Ke(){return Se}function kt(){_&&(_.toggle(!1),_=null)}function Qe(){_.$handle.hide()}return{hide:kt,hideHandle:Qe,show:Me,getSelectedRange:Ke}}$.extend(this,{init:p,destroy:d,onFillUpDown:new Slick.Event})}function RowSelectionModel(i){var e,t=[],r=this,s=new Slick.EventHandler,o,a,l={selectActiveRow:!0};function u(U){a=Object.assign(l,i),e=U,s.subscribe(e.onActiveCellChanged,d(ne)),s.subscribe(e.onKeyDown,d(Q)),s.subscribe(e.onClick,d(ue))}function p(){s.unsubscribeAll()}function d(U){return function(){o||(o=!0,U.apply(this,arguments),o=!1)}}function m(U){for(var _=[],Se=0;Se<U.length;Se++)for(var Me=U[Se].fromRow;Me<=U[Se].toRow;Me++)_.push(Me);return _}function g(U){for(var _=[],Se=e.getColumns().length-1,Me=0;Me<U.length;Me++)_.push(new Slick.Range(U[Me],0,U[Me],Se));return _}function w(U,_){var Se,Me=[];for(Se=U;Se<=_;Se++)Me.push(Se);for(Se=_;Se<U;Se++)Me.push(Se);return Me}function E(){return m(t)}function A(U){k(g(U))}function k(U){(!t||t.length===0)&&(!U||U.length===0)||(t=U,r.onSelectedRangesChanged.notify(t))}function O(){return t}function ne(U,_){a.selectActiveRow&&_.row!=null&&k([new Slick.Range(_.row,0,_.row,e.getColumns().length-1)])}function Q(U){var _=e.getActiveCell();if(e.getOptions().multiSelect&&_&&U.shiftKey&&!U.ctrlKey&&!U.altKey&&!U.metaKey&&(U.which==Slick.keyCode.UP||U.which==Slick.keyCode.DOWN)){var Se=E();Se.sort(function(ze,Je){return ze-Je}),Se.length||(Se=[_.row]);var Me=Se[0],Ke=Se[Se.length-1],kt;if(U.which==Slick.keyCode.DOWN?kt=_.row<Ke||Me==Ke?++Ke:++Me:kt=_.row<Ke?--Ke:--Me,kt>=0&&kt<e.getDataLength()){e.scrollRowIntoView(kt);var Qe=g(w(Me,Ke));k(Qe)}U.preventDefault(),U.stopPropagation()}}function ue(U){var _=e.getCellFromEvent(U);if(!_||!e.canCellBeActive(_.row,_.cell)||!e.getOptions().multiSelect||!U.ctrlKey&&!U.shiftKey&&!U.metaKey)return!1;var Se=m(t),Me=Se.indexOf(_.row);if(Me===-1&&(U.ctrlKey||U.metaKey))Se.push(_.row),e.setActiveCell(_.row,_.cell);else if(Me!==-1&&(U.ctrlKey||U.metaKey))Se=Se.filter(function(St,Te){return St!==_.row}),e.setActiveCell(_.row,_.cell);else if(Se.length&&U.shiftKey){var Ke=Se.pop(),kt=Math.min(_.row,Ke),Qe=Math.max(_.row,Ke);Se=[];for(var ze=kt;ze<=Qe;ze++)ze!==Ke&&Se.push(ze);Se.push(Ke),e.setActiveCell(_.row,_.cell)}var Je=g(Se);return k(Je),U.stopImmediatePropagation(),!0}Object.assign(this,{getSelectedRows:E,setSelectedRows:A,getSelectedRanges:O,setSelectedRanges:k,init:u,destroy:p,pluginName:"RowSelectionModel",onSelectedRangesChanged:new Slick.Event})}class DataModel{constructor(e,t={}){this.dataStore=e,this.data=new Int32Array(0);let r=0;for(let s=0;s<r;s++)this.data[s]=s;this.size=r,(t.autoupdate==null||t.autoupdate===!0)&&e.addListener("sss",s=>{s==="filtered"&&this.updateModel()}),this.listeners={}}getLength(){return this.size}addListener(e,t){this.listeners[e]=t}setColumns(e){this.columns=e}sort(e,t){const r=this.dataStore.getRawColumn(e),s=this.dataStore.columnIndex[e];if(s.datatype==="unique"){const o={},a=new TextDecoder,l=s.stringLength,u=t==="desc"?1:-1;for(let p=0;p<this.data.length;p++){const d=this.data[p];o[d]=a.decode(r.slice(d*l,d*l+l))}this.data.sort((p,d)=>o[p].localeCompare(o[d])*u)}else t==="desc"?this.data.sort((o,a)=>{let l=r[o],u=r[a];return l=isNaN(l)?Number.MAX_VALUE:l,u=isNaN(u)?Number.MAX_VALUE:u,l-u}):this.data.sort((o,a)=>{let l=r[o],u=r[a];return l=isNaN(l)?Number.MIN_VALUE:l,u=isNaN(u)?Number.MIN_VALUE:u,u-l})}createColumn(e,t){const r={name:e,field:e,datatype:"text",values:[""]},s=new SharedArrayBuffer(this.dataStore.size);if(t){const o=this.dataStore.getRawColumn(t);new Uint8Array(s).set(o),r.values=this.dataStore.getColumnValues(t).slice(0)}this.dataStore.addColumn(r,s,!0)}removeColumn(e){this.dataStore.removeColumn(e,!0,!0)}getDataAsBlob(e="	",t=`
`){return this.dataStore.getDataAsBlob(this.columns,this.data,e,t)}getValueSuggestion(e,t){const r=this.dataStore.getColumnValues(t);for(let s of r)if(s===e||s.startsWith(e))return s;return null}_getValueIndex(e,t){let r=t.values.indexOf(e);if(r===-1){if(t.values.push(e),t.values.length>256)throw new Error(`text column '${t.name}' exceeded 256 values when adding '${e}'`);r=t.values.length-1}return r}updateValue(e,t,r,s=!0){const o=this.dataStore.columnIndex[r];let a=this._getValueIndex(e,o);o.data[t]=a,s&&this.dataStore.dataChanged([r])}updateRange(e,t,r,s){const o=this.dataStore.getRawColumn(e),a=s==="+"?o[this.data[t]]:o[this.data[r]];let l=s==="+"?t:r,u=s==="+"?1:-1,p=s==="+"?r+1:t-1;for(;l!==p;l+=u)o[this.data[l]]=a;this.dataStore.dataChanged([e])}replaceValues(e,t,r,s=!0){const o=this.dataStore.columnIndex[r];let a=this._getValueIndex(e,o);if(t==="_all_")for(let l=0;l<this.data.length;l++)o.data[this.data[l]]=a;else if(t==="_blank_"){let l=o.values.indexOf(e);if(l===-1)return;for(let u=0;u<this.data.length;u++){const p=this.data[u];o.data[p]===l&&(o.data[this.data[u]]=a)}}else if(t=="_delete_"){this.dataStore.cleanColumnData(r);return}else{let l=this._getValueIndex(t,o);for(let u=0;u<this.data.length;u++){const p=this.data[u];o.data[p]===a&&(o.data[this.data[u]]=l)}}s&&this.dataStore.dataChanged([r])}updateModel(){const e=this.dataStore.filterArray;this.data=new Int32Array(this.dataStore.filterSize);const t=this.data,r=this.dataStore.size;let s=0;for(let o=0;o<r;o++)e[o]===0&&(t[s++]=o);this.size=this.dataStore.filterSize;for(let o in this.listeners)this.listeners[o]()}getId(e){return this.data[e]}getItemField(e,t){return this.dataStore.getRowAsObject(this.data[e],[t])[t]}getItem(e){return this.dataStore.getRowAsObject(this.data[e],this.columns)}}class TableChart extends BaseChart{constructor(e,t,r){super(e,t,r),this.config.type="table_chart";let s=[];s=[{field:"__index__",id:"__index__",name:"index",datatype:"integer",sortable:!0,width:100}];const o=r.column_widths||{};for(let a of this.config.param){const l=e.columnIndex[a],u={id:l.field,field:l.field,name:l.name,datatype:l.datatype,sortable:!0,width:o[a]?o[a]:100};l.editable&&(u.editor=TextEditor),l.is_url&&(u.formatter=(p,d,m,g,w)=>`<a href="${m}" target="_blank">${m}</a>`),s.push(u)}this.options={enableCellNavigation:!0,enableColumnReorder:!1,editable:!1,autoEdit:!0,enableAsyncPostRender:!0,frozenColumn:null},this.dataModel=new DataModel(e,{autoupdate:!1}),this.dataModel.setColumns(this.config.param),this.grid=new SlickGrid(this.contentDiv,this.dataModel,s,this.options),this.grid.onHeaderCellRendered.subscribe((a,l)=>{const u=l.column;if(u.editor&&this.mode==="edit"){const p=createEl("i",{classes:["far","fa-edit"],style:{cursor:"pointer"}});l.node.prepend(p),p.addEventListener("click",d=>{d.stopImmediatePropagation(),new EditColumnDialog(this,u.field,u.name,this.__doc__)})}}),this.dataModel.addListener(this.config.id,()=>{this.grid.invalidate()}),this.grid.setColumns(this.grid.getColumns()),this.mode="select",this.grid.setSelectionModel(new RowSelectionModel),this.grid.init(),this.grid.onSort.subscribe((a,l)=>{this.dataModel.sort(l.columnId,l.sortAsc?"asc":"desc"),this.grid.invalidateAllRows(),this.grid.render()}),this.grid.onSelectedRowsChanged.subscribe((a,l)=>{this.mode==="select"&&this._rowsSelected(l)}),this.editIcon=this.addMenuIcon("fas fa-edit","Change To Edit Mode",{func:()=>{this.editIcon.firstElementChild.remove(),this.mode=this.mode==="select"?"edit":"select";const a=this.mode==="select"?["fas","fa-edit"]:["fas","fa-table"];createEl("i",{classes:a},this.editIcon),this.editIcon.setAttribute("aria-label",this.mode==="edit"?"Change To Selection Mode":"Change To Edit Mode"),this._changeMode()}}),this.addMenuIcon("fas fa-download","Download data",{func:()=>{this.downloadData()}}),this.filter=[],this.themeChanged(),this.onDataFiltered()}onDataHighlighted(e){if(e.source===this)return;const t=this.dataModel.data.indexOf(e.indexes[0]);t!==-1&&(this.grid.scrollRowIntoView(t),this.tempMode=this.mode,this.mode="",this.grid.setSelectedRows([t]),this.mode=this.tempMode)}onColumnRemoved(e){if(this.config.param.indexOf(e)===-1)return!1;const t=this.grid.getCellEditor();t&&t.destroy(),this.grid.setActiveCell(null);let r=this.grid.getColumns();return r=r.filter(s=>s.field!==e),this.config.param=this.config.param.filter(s=>s!==e),this.dataModel.setColumns(this.config.param),this.grid.setColumns(r),!1}getConfig(){const e=super.getConfig(),t=this.grid.getColumns();e.param=t.filter(r=>r.field!=="__index__").map(r=>r.field),e.column_widths={};for(let r of t)r.width!==100&&(e.column_widths[r.field]=r.width);return e}downloadData(){const e=this.dataModel.getDataAsBlob(),t=createEl("a",{download:"data",target:"_blank",href:window.URL.createObjectURL(e)},this.__doc__.body);t.click(),t.remove()}_changeMode(){this.mode==="select"?(this.addColumnIcon&&(this.addColumnIcon.remove(),this.addColumnIcon=null),this.selectionModel=new RowSelectionModel,this.grid.setSelectionModel(this.selectionModel),this.overlay&&(this.grid.unregisterPlugin(this.overlay),this.overlay=null),this.grid.setOptions({editable:!1},!0,!0),this.grid.setColumns(this.grid.getColumns())):(this.grid.setSelectedRows([]),this.selectionModel&&(this.grid.setSelectionModel(null),this.selectionModel=null),this.grid.setOptions({editable:!0},!0,!0),this.grid.setColumns(this.grid.getColumns()),this.addColumnIcon=this.addMenuIcon("fas fa-plus","Add Column",{func:e=>{new AddColumnDialog(this)}}),this.overlay=new Overlays({}),this.overlay.onFillUpDown.subscribe((e,t)=>this._updateOverlay(t)),this.grid.registerPlugin(this.overlay))}onDataChanged(e){this.grid.invalidate()}getColumnInfo(){return this.grid.getColumns().filter(e=>e.datatype==="text").map(e=>({name:e.name,field:e.field})).sort((e,t)=>e.name.localeCompare(t.name))}createColumn(e,t=null,r=2){this.dataModel.createColumn(e,t);const s=this.grid.getColumns();r-=1,r<0||r>=s.length&&(r=s.length-1),s.splice(r,0,{name:e,field:e,id:e,datatype:"text",editor:TextEditor,sortable:!0}),this.config.param.push(e),this.grid.setColumns(s),this.grid.invalidate()}_removeColumn(e){this.dataModel.removeColumn(e,!0,!0)}_updateOverlay(e){var t=this.grid.getColumns()[e.range.fromCell];t.editor&&(this.dataModel.updateRange(t.field,e.range.fromRow,e.range.toRow,e.dir),this.grid.invalidate())}_rowsSelected(e){const t=[];for(let r of e.rows)t.push(this.dataModel.data[r]);this.dataStore.dataHighlighted(t,this)}themeChanged(){console.warn("themeChanged() deprecated")}changeBaseDocument(e){super.changeBaseDocument(e),this.grid.setBaseDocument(e),this.mode==="edit"&&(this.grid.unregisterPlugin(this.overlay),this.grid.registerPlugin(this.overlay))}setSize(e,t){super.setSize(e,t),this.grid.resizeCanvas(),this.grid.invalidate()}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}addColumns(){}remove(){this.grid.destroy(),super.remove()}onDataFiltered(){this.isPinned||this.dataModel.updateModel()}}class EditColumnDialog extends BaseDialog{constructor(e,t,r,s){const o={doc:s,columns:2,width:380,maxHeight:500,title:"Bulk Edit "+r};super(o,{table:e,column:t})}init(e){this.col=e.column,this.dataModel=e.table.dataModel,this.table=e.table;const t=createEl("div",{},this.columns[0]);createEl("label",{text:"Value:"},t),this.valInput=createEl("input",{},t),this.valInput.addEventListener("keyup",s=>{const o=s.which;if(o===37||o===39||o===8){s.stopImmediatePropagation();return}const a=this.dataModel.getValueSuggestion(this.valInput.value,this.col);a&&(this.valInput.value=a)});const r=createEl("div",{},this.columns[0]);createEl("label",{text:"Replace With:"},r),this.replaceInput=createEl("input",{},r),this._createButton("Fill All Cells","_all_"),this._createButton("Fill Empty Cells","_blank_"),this._createButton("Replace Value",null),this._createButton("Delete Unused Values","_delete_"),this._createButton("Remove Column","_delete_column_")}_createButton(e,t){const r=createEl("div",{style:{padding:"5px 10px"}},this.columns[1]);createEl("button",{classes:["ciview-button"],text:e},r).addEventListener("click",()=>{const s=t||this.replaceInput.value;s==="_delete_column_"?(this.table._removeColumn(this.col),this.close()):this.dataModel.replaceValues(this.valInput.value,s,this.col)})}}class AddColumnDialog extends BaseDialog{constructor(e,t){const r={doc:t,footer:!0,buttons:[{text:"Add",method:"addColumn"}],width:300,maxHeight:500,title:"Add Column"};super(r,e)}init(e){const t={padding:"5px"};this.table=e;const r=createEl("div",{style:t},this.dialog);createEl("label",{text:"Column Name"},r),this.name=createEl("input",{},r),this.name.addEventListener("keydown",u=>{u.key==="Enter"&&this.addColumn()});const s=createEl("div",{style:t},this.dialog),o=createEl("label",{style:{display:"flex"}},s);this.cloneCheck=createEl("input",{type:"checkbox"},o),createEl("div",{text:"Copy Existing Column"},o);const a=e.getColumnInfo();this.cloneCol=createEl("select",{},s);for(let u of a)createEl("option",{text:u.name,value:u.field},this.cloneCol);const l=createEl("div",{style:t},this.dialog);createEl("label",{text:"Position"},l),this.position=createEl("input",{style:{width:"100px"},value:2},l),setTimeout(()=>this.name.focus(),100)}addColumn(){if(!this.name.value){this.name.focus();return}let e=this.cloneCheck.checked?this.cloneCol.value:null,t=parseInt(this.position.value);t=isNaN(t)?null:t,this.table.createColumn(this.name.value,e,t),this.close()}}BaseChart.types.table_chart={class:TableChart,name:"Table",params:[{type:"_multi_column:all",name:"Columns To Display"}]};var reglExports={},regl={get exports(){return reglExports},set exports(i){reglExports=i}};(function(i,e){(function(t,r){i.exports=r()})(commonjsGlobal,function(){var t=function(R){return R instanceof Uint8Array||R instanceof Uint16Array||R instanceof Uint32Array||R instanceof Int8Array||R instanceof Int16Array||R instanceof Int32Array||R instanceof Float32Array||R instanceof Float64Array||R instanceof Uint8ClampedArray},r=function(R,N){for(var V=Object.keys(N),ye=0;ye<V.length;++ye)R[V[ye]]=N[V[ye]];return R},s=`
`;function o(R){return typeof atob<"u"?atob(R):"base64:"+R}function a(R){var N=new Error("(regl) "+R);throw console.error(N),N}function l(R,N){R||a(N)}function u(R){return R?": "+R:""}function p(R,N,V){R in N||a("unknown parameter ("+R+")"+u(V)+". possible values: "+Object.keys(N).join())}function d(R,N){t(R)||a("invalid parameter type"+u(N)+". must be a typed array")}function m(R,N){switch(N){case"number":return typeof R=="number";case"object":return typeof R=="object";case"string":return typeof R=="string";case"boolean":return typeof R=="boolean";case"function":return typeof R=="function";case"undefined":return typeof R>"u";case"symbol":return typeof R=="symbol"}}function g(R,N,V){m(R,N)||a("invalid parameter type"+u(V)+". expected "+N+", got "+typeof R)}function w(R,N){R>=0&&(R|0)===R||a("invalid parameter type, ("+R+")"+u(N)+". must be a nonnegative integer")}function E(R,N,V){N.indexOf(R)<0&&a("invalid value"+u(V)+". must be one of: "+N)}var A=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function k(R){Object.keys(R).forEach(function(N){A.indexOf(N)<0&&a('invalid regl constructor argument "'+N+'". must be one of '+A)})}function O(R,N){for(R=R+"";R.length<N;)R=" "+R;return R}function ne(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Q(R,N){this.number=R,this.line=N,this.errors=[]}function ue(R,N,V){this.file=R,this.line=N,this.message=V}function U(){var R=new Error,N=(R.stack||R).toString(),V=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(N);if(V)return V[1];var ye=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(N);return ye?ye[1]:"unknown"}function _(){var R=new Error,N=(R.stack||R).toString(),V=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(N);if(V)return V[1];var ye=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(N);return ye?ye[1]:"unknown"}function Se(R,N){var V=R.split(`
`),ye=1,Le=0,ve={unknown:new ne,0:new ne};ve.unknown.name=ve[0].name=N||U(),ve.unknown.lines.push(new Q(0,""));for(var Ce=0;Ce<V.length;++Ce){var Ge=V[Ce],He=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ge);if(He)switch(He[1]){case"line":var tt=/(\d+)(\s+\d+)?/.exec(He[2]);tt&&(ye=tt[1]|0,tt[2]&&(Le=tt[2]|0,Le in ve||(ve[Le]=new ne)));break;case"define":var rt=/SHADER_NAME(_B64)?\s+(.*)$/.exec(He[2]);rt&&(ve[Le].name=rt[1]?o(rt[2]):rt[2]);break}ve[Le].lines.push(new Q(ye++,Ge))}return Object.keys(ve).forEach(function(it){var ct=ve[it];ct.lines.forEach(function(We){ct.index[We.number]=We})}),ve}function Me(R){var N=[];return R.split(`
`).forEach(function(V){if(!(V.length<5)){var ye=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(V);ye?N.push(new ue(ye[1]|0,ye[2]|0,ye[3].trim())):V.length>0&&N.push(new ue("unknown",0,V))}}),N}function Ke(R,N){N.forEach(function(V){var ye=R[V.file];if(ye){var Le=ye.index[V.line];if(Le){Le.errors.push(V),ye.hasErrors=!0;return}}R.unknown.hasErrors=!0,R.unknown.lines[0].errors.push(V)})}function kt(R,N,V,ye,Le){if(!R.getShaderParameter(N,R.COMPILE_STATUS)){var ve=R.getShaderInfoLog(N),Ce=ye===R.FRAGMENT_SHADER?"fragment":"vertex";ot(V,"string",Ce+" shader source must be a string",Le);var Ge=Se(V,Le),He=Me(ve);Ke(Ge,He),Object.keys(Ge).forEach(function(tt){var rt=Ge[tt];if(!rt.hasErrors)return;var it=[""],ct=[""];function We(Ze,le){it.push(Ze),ct.push(le||"")}We("file number "+tt+": "+rt.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),rt.lines.forEach(function(Ze){if(Ze.errors.length>0){We(O(Ze.number,4)+"|  ","background-color:yellow; font-weight:bold"),We(Ze.line+s,"color:red; background-color:yellow; font-weight:bold");var le=0;Ze.errors.forEach(function(be){var Ye=be.message,Ct=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Ye);if(Ct){var Ie=Ct[1];switch(Ye=Ct[2],Ie){case"assign":Ie="=";break}le=Math.max(Ze.line.indexOf(Ie,le),0)}else le=0;We(O("| ",6)),We(O("^^^",le+3)+s,"font-weight:bold"),We(O("| ",6)),We(Ye+s,"font-weight:bold")}),We(O("| ",6)+s)}else We(O(Ze.number,4)+"|  "),We(Ze.line+s,"color:red")}),typeof document<"u"&&!window.chrome?(ct[0]=it.join("%c"),console.log.apply(console,ct)):console.log(it.join(""))}),l.raise("Error compiling "+Ce+" shader, "+Ge[0].name)}}function Qe(R,N,V,ye,Le){if(!R.getProgramParameter(N,R.LINK_STATUS)){var ve=R.getProgramInfoLog(N),Ce=Se(V,Le),Ge=Se(ye,Le),He='Error linking program with vertex shader, "'+Ge[0].name+'", and fragment shader "'+Ce[0].name+'"';typeof document<"u"?console.log("%c"+He+s+"%c"+ve,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(He+s+ve),l.raise(He)}}function ze(R){R._commandRef=U()}function Je(R,N,V,ye){ze(R);function Le(He){return He?ye.id(He):0}R._fragId=Le(R.static.frag),R._vertId=Le(R.static.vert);function ve(He,tt){Object.keys(tt).forEach(function(rt){He[ye.id(rt)]=!0})}var Ce=R._uniformSet={};ve(Ce,N.static),ve(Ce,N.dynamic);var Ge=R._attributeSet={};ve(Ge,V.static),ve(Ge,V.dynamic),R._hasCount="count"in R.static||"count"in R.dynamic||"elements"in R.static||"elements"in R.dynamic}function St(R,N){var V=_();a(R+" in command "+(N||U())+(V==="unknown"?"":" called from "+V))}function Te(R,N,V){R||St(N,V||U())}function dt(R,N,V,ye){R in N||St("unknown parameter ("+R+")"+u(V)+". possible values: "+Object.keys(N).join(),ye||U())}function ot(R,N,V,ye){m(R,N)||St("invalid parameter type"+u(V)+". expected "+N+", got "+typeof R,ye||U())}function yt(R){R()}function Ue(R,N,V){R.texture?E(R.texture._texture.internalformat,N,"unsupported texture format for attachment"):E(R.renderbuffer._renderbuffer.format,V,"unsupported renderbuffer format for attachment")}var Nt=33071,Ot=9728,wi=9984,Bi=9985,Ei=9986,Zi=9987,fr=5120,Ti=5121,Lt=5122,je=5123,mt=5124,Vt=5125,Ut=5126,ke=32819,_t=32820,$t=33635,at=34042,Xe=36193,It={};It[fr]=It[Ti]=1,It[Lt]=It[je]=It[Xe]=It[$t]=It[ke]=It[_t]=2,It[mt]=It[Vt]=It[Ut]=It[at]=4;function _i(R,N){return R===_t||R===ke||R===$t?2:R===at?4:It[R]*N}function vi(R){return!(R&R-1)&&!!R}function Ri(R,N,V){var ye,Le=N.width,ve=N.height,Ce=N.channels;l(Le>0&&Le<=V.maxTextureSize&&ve>0&&ve<=V.maxTextureSize,"invalid texture shape"),(R.wrapS!==Nt||R.wrapT!==Nt)&&l(vi(Le)&&vi(ve),"incompatible wrap mode for texture, both width and height must be power of 2"),N.mipmask===1?Le!==1&&ve!==1&&l(R.minFilter!==wi&&R.minFilter!==Ei&&R.minFilter!==Bi&&R.minFilter!==Zi,"min filter requires mipmap"):(l(vi(Le)&&vi(ve),"texture must be a square power of 2 to support mipmapping"),l(N.mipmask===(Le<<1)-1,"missing or incomplete mipmap data")),N.type===Ut&&(V.extensions.indexOf("oes_texture_float_linear")<0&&l(R.minFilter===Ot&&R.magFilter===Ot,"filter not supported, must enable oes_texture_float_linear"),l(!R.genMipmaps,"mipmap generation not supported with float textures"));var Ge=N.images;for(ye=0;ye<16;++ye)if(Ge[ye]){var He=Le>>ye,tt=ve>>ye;l(N.mipmask&1<<ye,"missing mipmap data");var rt=Ge[ye];if(l(rt.width===He&&rt.height===tt,"invalid shape for mip images"),l(rt.format===N.format&&rt.internalformat===N.internalformat&&rt.type===N.type,"incompatible type for mip image"),!rt.compressed)if(rt.data){var it=Math.ceil(_i(rt.type,Ce)*He/rt.unpackAlignment)*rt.unpackAlignment;l(rt.data.byteLength===it*tt,"invalid data for image, buffer size is inconsistent with image format")}else rt.element||rt.copy}else R.genMipmaps||l((N.mipmask&1<<ye)===0,"extra mipmap data");N.compressed&&l(!R.genMipmaps,"mipmap generation for compressed images not supported")}function sr(R,N,V,ye){var Le=R.width,ve=R.height,Ce=R.channels;l(Le>0&&Le<=ye.maxTextureSize&&ve>0&&ve<=ye.maxTextureSize,"invalid texture shape"),l(Le===ve,"cube map must be square"),l(N.wrapS===Nt&&N.wrapT===Nt,"wrap mode not supported by cube map");for(var Ge=0;Ge<V.length;++Ge){var He=V[Ge];l(He.width===Le&&He.height===ve,"inconsistent cube map face shape"),N.genMipmaps&&(l(!He.compressed,"can not generate mipmap for compressed textures"),l(He.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var tt=He.images,rt=0;rt<16;++rt){var it=tt[rt];if(it){var ct=Le>>rt,We=ve>>rt;l(He.mipmask&1<<rt,"missing mipmap data"),l(it.width===ct&&it.height===We,"invalid shape for mip images"),l(it.format===R.format&&it.internalformat===R.internalformat&&it.type===R.type,"incompatible type for mip image"),it.compressed||(it.data?l(it.data.byteLength===ct*We*Math.max(_i(it.type,Ce),it.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):it.element||it.copy)}}}}var P=r(l,{optional:yt,raise:a,commandRaise:St,command:Te,parameter:p,commandParameter:dt,constructor:k,type:g,commandType:ot,isTypedArray:d,nni:w,oneOf:E,shaderError:kt,linkError:Qe,callSite:_,saveCommandRef:ze,saveDrawInfo:Je,framebufferFormat:Ue,guessCommand:U,texture2D:Ri,textureCube:sr}),ki=0,Ni=0,Gi=5,q=6;function L(R,N){this.id=ki++,this.type=R,this.data=N}function Ve(R){return R.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ht(R){if(R.length===0)return[];var N=R.charAt(0),V=R.charAt(R.length-1);if(R.length>1&&N===V&&(N==='"'||N==="'"))return['"'+Ve(R.substr(1,R.length-2))+'"'];var ye=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(R);if(ye)return ht(R.substr(0,ye.index)).concat(ht(ye[1])).concat(ht(R.substr(ye.index+ye[0].length)));var Le=R.split(".");if(Le.length===1)return['"'+Ve(R)+'"'];for(var ve=[],Ce=0;Ce<Le.length;++Ce)ve=ve.concat(ht(Le[Ce]));return ve}function xt(R){return"["+ht(R).join("][")+"]"}function ri(R,N){return new L(R,xt(N+""))}function si(R){return typeof R=="function"&&!R._reglType||R instanceof L}function $i(R,N){if(typeof R=="function")return new L(Ni,R);if(typeof R=="number"||typeof R=="boolean")return new L(Gi,R);if(Array.isArray(R))return new L(q,R.map(function(V,ye){return $i(V,N+"["+ye+"]")}));if(R instanceof L)return R;P(!1,"invalid option type in uniform "+N)}var Jt={DynamicVariable:L,define:ri,isDynamic:si,unbox:$i,accessor:xt},xi={next:typeof requestAnimationFrame=="function"?function(R){return requestAnimationFrame(R)}:function(R){return setTimeout(R,16)},cancel:typeof cancelAnimationFrame=="function"?function(R){return cancelAnimationFrame(R)}:clearTimeout},Ai=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Wi(){var R={"":0},N=[""];return{id:function(V){var ye=R[V];return ye||(ye=R[V]=N.length,N.push(V),ye)},str:function(V){return N[V]}}}function Ci(R,N,V){var ye=document.createElement("canvas");r(ye.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),R.appendChild(ye),R===document.body&&(ye.style.position="absolute",r(R.style,{margin:0,padding:0}));function Le(){var Ge=window.innerWidth,He=window.innerHeight;if(R!==document.body){var tt=ye.getBoundingClientRect();Ge=tt.right-tt.left,He=tt.bottom-tt.top}ye.width=V*Ge,ye.height=V*He}var ve;R!==document.body&&typeof ResizeObserver=="function"?(ve=new ResizeObserver(function(){setTimeout(Le)}),ve.observe(R)):window.addEventListener("resize",Le,!1);function Ce(){ve?ve.disconnect():window.removeEventListener("resize",Le),R.removeChild(ye)}return Le(),{canvas:ye,onDestroy:Ce}}function rr(R,N){function V(ye){try{return R.getContext(ye,N)}catch{return null}}return V("webgl")||V("experimental-webgl")||V("webgl-experimental")}function ji(R){return typeof R.nodeName=="string"&&typeof R.appendChild=="function"&&typeof R.getBoundingClientRect=="function"}function Yi(R){return typeof R.drawArrays=="function"||typeof R.drawElements=="function"}function Br(R){return typeof R=="string"?R.split():(P(Array.isArray(R),"invalid extension array"),R)}function Nr(R){return typeof R=="string"?(P(typeof document<"u","not supported outside of DOM"),document.querySelector(R)):R}function dn(R){var N=R||{},V,ye,Le,ve,Ce={},Ge=[],He=[],tt=typeof window>"u"?1:window.devicePixelRatio,rt=!1,it=function(Ze){Ze&&P.raise(Ze)},ct=function(){};if(typeof N=="string"?(P(typeof document<"u","selector queries only supported in DOM enviroments"),V=document.querySelector(N),P(V,"invalid query string for element")):typeof N=="object"?ji(N)?V=N:Yi(N)?(ve=N,Le=ve.canvas):(P.constructor(N),"gl"in N?ve=N.gl:"canvas"in N?Le=Nr(N.canvas):"container"in N&&(ye=Nr(N.container)),"attributes"in N&&(Ce=N.attributes,P.type(Ce,"object","invalid context attributes")),"extensions"in N&&(Ge=Br(N.extensions)),"optionalExtensions"in N&&(He=Br(N.optionalExtensions)),"onDone"in N&&(P.type(N.onDone,"function","invalid or missing onDone callback"),it=N.onDone),"profile"in N&&(rt=!!N.profile),"pixelRatio"in N&&(tt=+N.pixelRatio,P(tt>0,"invalid pixel ratio"))):P.raise("invalid arguments to regl"),V&&(V.nodeName.toLowerCase()==="canvas"?Le=V:ye=V),!ve){if(!Le){P(typeof document<"u","must manually specify webgl context outside of DOM environments");var We=Ci(ye||document.body,it,tt);if(!We)return null;Le=We.canvas,ct=We.onDestroy}Ce.premultipliedAlpha===void 0&&(Ce.premultipliedAlpha=!0),ve=rr(Le,Ce)}return ve?{gl:ve,canvas:Le,container:ye,extensions:Ge,optionalExtensions:He,pixelRatio:tt,profile:rt,onDone:it,onDestroy:ct}:(ct(),it("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function hn(R,N){var V={};function ye(Ce){P.type(Ce,"string","extension name must be string");var Ge=Ce.toLowerCase(),He;try{He=V[Ge]=R.getExtension(Ge)}catch{}return!!He}for(var Le=0;Le<N.extensions.length;++Le){var ve=N.extensions[Le];if(!ye(ve))return N.onDestroy(),N.onDone('"'+ve+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return N.optionalExtensions.forEach(ye),{extensions:V,restore:function(){Object.keys(V).forEach(function(Ce){if(V[Ce]&&!ye(Ce))throw new Error("(regl): error restoring extension "+Ce)})}}}function or(R,N){for(var V=Array(R),ye=0;ye<R;++ye)V[ye]=N(ye);return V}var Qs=5120,Hr=5121,Zs=5122,Zn=5123,Js=5124,eo=5125,Ts=5126;function ks(R){for(var N=16;N<=1<<28;N*=16)if(R<=N)return N;return 0}function Gr(R){var N,V;return N=(R>65535)<<4,R>>>=N,V=(R>255)<<3,R>>>=V,N|=V,V=(R>15)<<2,R>>>=V,N|=V,V=(R>3)<<1,R>>>=V,N|=V,N|R>>1}function Cn(){var R=or(8,function(){return[]});function N(ve){var Ce=ks(ve),Ge=R[Gr(Ce)>>2];return Ge.length>0?Ge.pop():new ArrayBuffer(Ce)}function V(ve){R[Gr(ve.byteLength)>>2].push(ve)}function ye(ve,Ce){var Ge=null;switch(ve){case Qs:Ge=new Int8Array(N(Ce),0,Ce);break;case Hr:Ge=new Uint8Array(N(Ce),0,Ce);break;case Zs:Ge=new Int16Array(N(2*Ce),0,Ce);break;case Zn:Ge=new Uint16Array(N(2*Ce),0,Ce);break;case Js:Ge=new Int32Array(N(4*Ce),0,Ce);break;case eo:Ge=new Uint32Array(N(4*Ce),0,Ce);break;case Ts:Ge=new Float32Array(N(4*Ce),0,Ce);break;default:return null}return Ge.length!==Ce?Ge.subarray(0,Ce):Ge}function Le(ve){V(ve.buffer)}return{alloc:N,free:V,allocType:ye,freeType:Le}}var Vi=Cn();Vi.zero=Cn();var Jn=3408,Fn=3410,es=3411,to=3412,Ds=3413,ts=3414,nn=3415,is=33901,jr=33902,Ls=3379,rs=3386,io=34921,ns=36347,ro=36348,ss=35661,Pn=35660,Ms=34930,os=36349,$s=34076,Rr=34024,qr=7936,Nn=7937,Sn=7938,er=35724,pn=34047,zn=36063,En=34852,mn=3553,Fs=34067,as=34069,vr=33984,sn=6408,Xr=5126,Rn=5121,ls=36160,on=36053,Yr=36064,cs=16384,Ps=function(R,N){var V=1;N.ext_texture_filter_anisotropic&&(V=R.getParameter(pn));var ye=1,Le=1;N.webgl_draw_buffers&&(ye=R.getParameter(En),Le=R.getParameter(zn));var ve=!!N.oes_texture_float;if(ve){var Ce=R.createTexture();R.bindTexture(mn,Ce),R.texImage2D(mn,0,sn,1,1,0,sn,Xr,null);var Ge=R.createFramebuffer();if(R.bindFramebuffer(ls,Ge),R.framebufferTexture2D(ls,Yr,mn,Ce,0),R.bindTexture(mn,null),R.checkFramebufferStatus(ls)!==on)ve=!1;else{R.viewport(0,0,1,1),R.clearColor(1,0,0,1),R.clear(cs);var He=Vi.allocType(Xr,4);R.readPixels(0,0,1,1,sn,Xr,He),R.getError()?ve=!1:(R.deleteFramebuffer(Ge),R.deleteTexture(Ce),ve=He[0]===1),Vi.freeType(He)}}var tt=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),rt=!0;if(!tt){var it=R.createTexture(),ct=Vi.allocType(Rn,36);R.activeTexture(vr),R.bindTexture(Fs,it),R.texImage2D(as,0,sn,3,3,0,sn,Rn,ct),Vi.freeType(ct),R.bindTexture(Fs,null),R.deleteTexture(it),rt=!R.getError()}return{colorBits:[R.getParameter(Fn),R.getParameter(es),R.getParameter(to),R.getParameter(Ds)],depthBits:R.getParameter(ts),stencilBits:R.getParameter(nn),subpixelBits:R.getParameter(Jn),extensions:Object.keys(N).filter(function(We){return!!N[We]}),maxAnisotropic:V,maxDrawbuffers:ye,maxColorAttachments:Le,pointSizeDims:R.getParameter(is),lineWidthDims:R.getParameter(jr),maxViewportDims:R.getParameter(rs),maxCombinedTextureUnits:R.getParameter(ss),maxCubeMapSize:R.getParameter($s),maxRenderbufferSize:R.getParameter(Rr),maxTextureUnits:R.getParameter(Ms),maxTextureSize:R.getParameter(Ls),maxAttributes:R.getParameter(io),maxVertexUniforms:R.getParameter(ns),maxVertexTextureUnits:R.getParameter(Pn),maxVaryingVectors:R.getParameter(ro),maxFragmentUniforms:R.getParameter(os),glsl:R.getParameter(er),renderer:R.getParameter(Nn),vendor:R.getParameter(qr),version:R.getParameter(Sn),readFloat:ve,npotTextureCube:rt}};function $r(R){return!!R&&typeof R=="object"&&Array.isArray(R.shape)&&Array.isArray(R.stride)&&typeof R.offset=="number"&&R.shape.length===R.stride.length&&(Array.isArray(R.data)||t(R.data))}var Ar=function(R){return Object.keys(R).map(function(N){return R[N]})},Kr={shape:Ft,flatten:nt};function An(R,N,V){for(var ye=0;ye<N;++ye)V[ye]=R[ye]}function ee(R,N,V,ye){for(var Le=0,ve=0;ve<N;++ve)for(var Ce=R[ve],Ge=0;Ge<V;++Ge)ye[Le++]=Ce[Ge]}function de(R,N,V,ye,Le,ve){for(var Ce=ve,Ge=0;Ge<N;++Ge)for(var He=R[Ge],tt=0;tt<V;++tt)for(var rt=He[tt],it=0;it<ye;++it)Le[Ce++]=rt[it]}function we(R,N,V,ye,Le){for(var ve=1,Ce=V+1;Ce<N.length;++Ce)ve*=N[Ce];var Ge=N[V];if(N.length-V===4){var He=N[V+1],tt=N[V+2],rt=N[V+3];for(Ce=0;Ce<Ge;++Ce)de(R[Ce],He,tt,rt,ye,Le),Le+=ve}else for(Ce=0;Ce<Ge;++Ce)we(R[Ce],N,V+1,ye,Le),Le+=ve}function nt(R,N,V,ye){var Le=1;if(N.length)for(var ve=0;ve<N.length;++ve)Le*=N[ve];else Le=0;var Ce=ye||Vi.allocType(V,Le);switch(N.length){case 0:break;case 1:An(R,N[0],Ce);break;case 2:ee(R,N[0],N[1],Ce);break;case 3:de(R,N[0],N[1],N[2],Ce,0);break;default:we(R,N,0,Ce,0)}return Ce}function Ft(R){for(var N=[],V=R;V.length;V=V[0])N.push(V.length);return N}var Rt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},li=5120,Gt=5122,Ui=5124,zi=5121,Ki=5123,Qi=5125,Fi=5126,tr=5126,qi={int8:li,int16:Gt,int32:Ui,uint8:zi,uint16:Ki,uint32:Qi,float:Fi,float32:tr},ar=35048,lr=35040,an={dynamic:ar,stream:lr,static:35044},gn=Kr.flatten,vn=Kr.shape,us=35044,fs=35040,In=5121,Qr=5126,ln=[];ln[5120]=1,ln[5122]=2,ln[5124]=4,ln[5121]=1,ln[5123]=2,ln[5125]=4,ln[5126]=4;function On(R){return Rt[Object.prototype.toString.call(R)]|0}function ko(R,N){for(var V=0;V<N.length;++V)R[V]=N[V]}function Do(R,N,V,ye,Le,ve,Ce){for(var Ge=0,He=0;He<V;++He)for(var tt=0;tt<ye;++tt)R[Ge++]=N[Le*He+ve*tt+Ce]}function ra(R,N,V,ye){var Le=0,ve={};function Ce(le){this.id=Le++,this.buffer=R.createBuffer(),this.type=le,this.usage=us,this.byteLength=0,this.dimension=1,this.dtype=In,this.persistentData=null,V.profile&&(this.stats={size:0})}Ce.prototype.bind=function(){R.bindBuffer(this.type,this.buffer)},Ce.prototype.destroy=function(){ct(this)};var Ge=[];function He(le,be){var Ye=Ge.pop();return Ye||(Ye=new Ce(le)),Ye.bind(),it(Ye,be,fs,0,1,!1),Ye}function tt(le){Ge.push(le)}function rt(le,be,Ye){le.byteLength=be.byteLength,R.bufferData(le.type,be,Ye)}function it(le,be,Ye,Ct,Ie,wt){var gt;if(le.usage=Ye,Array.isArray(be)){if(le.dtype=Ct||Qr,be.length>0){var Ht;if(Array.isArray(be[0])){gt=vn(be);for(var $e=1,De=1;De<gt.length;++De)$e*=gt[De];le.dimension=$e,Ht=gn(be,gt,le.dtype),rt(le,Ht,Ye),wt?le.persistentData=Ht:Vi.freeType(Ht)}else if(typeof be[0]=="number"){le.dimension=Ie;var Mt=Vi.allocType(le.dtype,be.length);ko(Mt,be),rt(le,Mt,Ye),wt?le.persistentData=Mt:Vi.freeType(Mt)}else t(be[0])?(le.dimension=be[0].length,le.dtype=Ct||On(be[0])||Qr,Ht=gn(be,[be.length,be[0].length],le.dtype),rt(le,Ht,Ye),wt?le.persistentData=Ht:Vi.freeType(Ht)):P.raise("invalid buffer data")}}else if(t(be))le.dtype=Ct||On(be),le.dimension=Ie,rt(le,be,Ye),wt&&(le.persistentData=new Uint8Array(new Uint8Array(be.buffer)));else if($r(be)){gt=be.shape;var ut=be.stride,qe=be.offset,ft=0,pt=0,ti=0,Zt=0;gt.length===1?(ft=gt[0],pt=1,ti=ut[0],Zt=0):gt.length===2?(ft=gt[0],pt=gt[1],ti=ut[0],Zt=ut[1]):P.raise("invalid shape"),le.dtype=Ct||On(be.data)||Qr,le.dimension=pt;var vt=Vi.allocType(le.dtype,ft*pt);Do(vt,be.data,ft,pt,ti,Zt,qe),rt(le,vt,Ye),wt?le.persistentData=vt:Vi.freeType(vt)}else be instanceof ArrayBuffer?(le.dtype=In,le.dimension=Ie,rt(le,be,Ye),wt&&(le.persistentData=new Uint8Array(new Uint8Array(be)))):P.raise("invalid buffer data")}function ct(le){N.bufferCount--,ye(le);var be=le.buffer;P(be,"buffer must not be deleted already"),R.deleteBuffer(be),le.buffer=null,delete ve[le.id]}function We(le,be,Ye,Ct){N.bufferCount++;var Ie=new Ce(be);ve[Ie.id]=Ie;function wt($e){var De=us,Mt=null,ut=0,qe=0,ft=1;return Array.isArray($e)||t($e)||$r($e)||$e instanceof ArrayBuffer?Mt=$e:typeof $e=="number"?ut=$e|0:$e&&(P.type($e,"object","buffer arguments must be an object, a number or an array"),"data"in $e&&(P(Mt===null||Array.isArray(Mt)||t(Mt)||$r(Mt),"invalid data for buffer"),Mt=$e.data),"usage"in $e&&(P.parameter($e.usage,an,"invalid buffer usage"),De=an[$e.usage]),"type"in $e&&(P.parameter($e.type,qi,"invalid buffer type"),qe=qi[$e.type]),"dimension"in $e&&(P.type($e.dimension,"number","invalid dimension"),ft=$e.dimension|0),"length"in $e&&(P.nni(ut,"buffer length must be a nonnegative integer"),ut=$e.length|0)),Ie.bind(),Mt?it(Ie,Mt,De,qe,ft,Ct):(ut&&R.bufferData(Ie.type,ut,De),Ie.dtype=qe||In,Ie.usage=De,Ie.dimension=ft,Ie.byteLength=ut),V.profile&&(Ie.stats.size=Ie.byteLength*ln[Ie.dtype]),wt}function gt($e,De){P(De+$e.byteLength<=Ie.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+$e.byteLength+" starting from offset "+De+" to a buffer of size "+Ie.byteLength),R.bufferSubData(Ie.type,De,$e)}function Ht($e,De){var Mt=(De||0)|0,ut;if(Ie.bind(),t($e)||$e instanceof ArrayBuffer)gt($e,Mt);else if(Array.isArray($e)){if($e.length>0)if(typeof $e[0]=="number"){var qe=Vi.allocType(Ie.dtype,$e.length);ko(qe,$e),gt(qe,Mt),Vi.freeType(qe)}else if(Array.isArray($e[0])||t($e[0])){ut=vn($e);var ft=gn($e,ut,Ie.dtype);gt(ft,Mt),Vi.freeType(ft)}else P.raise("invalid buffer data")}else if($r($e)){ut=$e.shape;var pt=$e.stride,ti=0,Zt=0,vt=0,bt=0;ut.length===1?(ti=ut[0],Zt=1,vt=pt[0],bt=0):ut.length===2?(ti=ut[0],Zt=ut[1],vt=pt[0],bt=pt[1]):P.raise("invalid shape");var qt=Array.isArray($e.data)?Ie.dtype:On($e.data),ii=Vi.allocType(qt,ti*Zt);Do(ii,$e.data,ti,Zt,vt,bt,$e.offset),gt(ii,Mt),Vi.freeType(ii)}else P.raise("invalid data for buffer subdata");return wt}return Ye||wt(le),wt._reglType="buffer",wt._buffer=Ie,wt.subdata=Ht,V.profile&&(wt.stats=Ie.stats),wt.destroy=function(){ct(Ie)},wt}function Ze(){Ar(ve).forEach(function(le){le.buffer=R.createBuffer(),R.bindBuffer(le.type,le.buffer),R.bufferData(le.type,le.persistentData||le.byteLength,le.usage)})}return V.profile&&(N.getTotalBufferSize=function(){var le=0;return Object.keys(ve).forEach(function(be){le+=ve[be].stats.size}),le}),{create:We,createStream:He,destroyStream:tt,clear:function(){Ar(ve).forEach(ct),Ge.forEach(ct)},getBuffer:function(le){return le&&le._buffer instanceof Ce?le._buffer:null},restore:Ze,_initBuffer:it}}var f=0,v=0,C=1,S=1,T=4,D=4,M={points:f,point:v,lines:C,line:S,triangles:T,triangle:D,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ie=0,K=1,he=4,Re=5120,et=5121,xe=5122,Pe=5123,Yt=5124,ai=5125,jt=34963,yr=35040,dr=35044;function Pr(R,N,V,ye){var Le={},ve=0,Ce={uint8:et,uint16:Pe};N.oes_element_index_uint&&(Ce.uint32=ai);function Ge(Ze){this.id=ve++,Le[this.id]=this,this.buffer=Ze,this.primType=he,this.vertCount=0,this.type=0}Ge.prototype.bind=function(){this.buffer.bind()};var He=[];function tt(Ze){var le=He.pop();return le||(le=new Ge(V.create(null,jt,!0,!1)._buffer)),it(le,Ze,yr,-1,-1,0,0),le}function rt(Ze){He.push(Ze)}function it(Ze,le,be,Ye,Ct,Ie,wt){Ze.buffer.bind();var gt;if(le){var Ht=wt;!wt&&(!t(le)||$r(le)&&!t(le.data))&&(Ht=N.oes_element_index_uint?ai:Pe),V._initBuffer(Ze.buffer,le,be,Ht,3)}else R.bufferData(jt,Ie,be),Ze.buffer.dtype=gt||et,Ze.buffer.usage=be,Ze.buffer.dimension=3,Ze.buffer.byteLength=Ie;if(gt=wt,!wt){switch(Ze.buffer.dtype){case et:case Re:gt=et;break;case Pe:case xe:gt=Pe;break;case ai:case Yt:gt=ai;break;default:P.raise("unsupported type for element array")}Ze.buffer.dtype=gt}Ze.type=gt,P(gt!==ai||!!N.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var $e=Ct;$e<0&&($e=Ze.buffer.byteLength,gt===Pe?$e>>=1:gt===ai&&($e>>=2)),Ze.vertCount=$e;var De=Ye;if(Ye<0){De=he;var Mt=Ze.buffer.dimension;Mt===1&&(De=ie),Mt===2&&(De=K),Mt===3&&(De=he)}Ze.primType=De}function ct(Ze){ye.elementsCount--,P(Ze.buffer!==null,"must not double destroy elements"),delete Le[Ze.id],Ze.buffer.destroy(),Ze.buffer=null}function We(Ze,le){var be=V.create(null,jt,!0),Ye=new Ge(be._buffer);ye.elementsCount++;function Ct(Ie){if(!Ie)be(),Ye.primType=he,Ye.vertCount=0,Ye.type=et;else if(typeof Ie=="number")be(Ie),Ye.primType=he,Ye.vertCount=Ie|0,Ye.type=et;else{var wt=null,gt=dr,Ht=-1,$e=-1,De=0,Mt=0;Array.isArray(Ie)||t(Ie)||$r(Ie)?wt=Ie:(P.type(Ie,"object","invalid arguments for elements"),"data"in Ie&&(wt=Ie.data,P(Array.isArray(wt)||t(wt)||$r(wt),"invalid data for element buffer")),"usage"in Ie&&(P.parameter(Ie.usage,an,"invalid element buffer usage"),gt=an[Ie.usage]),"primitive"in Ie&&(P.parameter(Ie.primitive,M,"invalid element buffer primitive"),Ht=M[Ie.primitive]),"count"in Ie&&(P(typeof Ie.count=="number"&&Ie.count>=0,"invalid vertex count for elements"),$e=Ie.count|0),"type"in Ie&&(P.parameter(Ie.type,Ce,"invalid buffer type"),Mt=Ce[Ie.type]),"length"in Ie?De=Ie.length|0:(De=$e,Mt===Pe||Mt===xe?De*=2:(Mt===ai||Mt===Yt)&&(De*=4))),it(Ye,wt,gt,Ht,$e,De,Mt)}return Ct}return Ct(Ze),Ct._reglType="elements",Ct._elements=Ye,Ct.subdata=function(Ie,wt){return be.subdata(Ie,wt),Ct},Ct.destroy=function(){ct(Ye)},Ct}return{create:We,createStream:tt,destroyStream:rt,getElements:function(Ze){return typeof Ze=="function"&&Ze._elements instanceof Ge?Ze._elements:null},clear:function(){Ar(Le).forEach(ct)}}}var Ii=new Float32Array(1),fi=new Uint32Array(Ii.buffer),Fr=5123;function Di(R){for(var N=Vi.allocType(Fr,R.length),V=0;V<R.length;++V)if(isNaN(R[V]))N[V]=65535;else if(R[V]===1/0)N[V]=31744;else if(R[V]===-1/0)N[V]=64512;else{Ii[0]=R[V];var ye=fi[0],Le=ye>>>31<<15,ve=(ye<<1>>>24)-127,Ce=ye>>13&(1<<10)-1;if(ve<-24)N[V]=Le;else if(ve<-14){var Ge=-14-ve;N[V]=Le+(Ce+(1<<10)>>Ge)}else ve>15?N[V]=Le+31744:N[V]=Le+(ve+15<<10)+Ce}return N}function ci(R){return Array.isArray(R)||t(R)}var Bn=function(R){return!(R&R-1)&&!!R},Ns=34467,nr=3553,cn=34067,Zr=34069,hr=6408,Jr=6406,Mr=6407,zr=6409,ds=6410,yn=32854,hs=32855,Pi=36194,Tn=32819,Lo=32820,no=33635,na=34042,Hn=6402,zs=34041,Is=35904,so=35906,Gn=36193,oo=33776,Wn=33777,ao=33778,lo=33779,Mo=35986,Vn=35987,$o=34798,Os=35840,en=35841,tn=35842,co=35843,uo=36196,kn=5121,fo=5123,Oi=5125,_n=5126,Wr=10242,Vr=10243,ho=10497,Bs=33071,sa=33648,oa=10240,Fo=10241,un=9728,po=9729,Hs=9984,ps=9985,ms=9986,gs=9987,aa=33170,Dn=4352,mo=4353,go=4354,la=34046,z=3317,Z=37440,oe=37441,Oe=37443,me=37444,Be=33984,st=[Hs,ms,ps,gs],At=[0,zr,ds,Mr,hr],Et={};Et[zr]=Et[Jr]=Et[Hn]=1,Et[zs]=Et[ds]=2,Et[Mr]=Et[Is]=3,Et[hr]=Et[so]=4;function Qt(R){return"[object "+R+"]"}var ei=Qt("HTMLCanvasElement"),oi=Qt("OffscreenCanvas"),bi=Qt("CanvasRenderingContext2D"),Hi=Qt("ImageBitmap"),ni=Qt("HTMLImageElement"),pr=Qt("HTMLVideoElement"),Tr=Object.keys(Rt).concat([ei,oi,bi,Hi,ni,pr]),Cr=[];Cr[kn]=1,Cr[_n]=4,Cr[Gn]=2,Cr[fo]=2,Cr[Oi]=4;var yi=[];yi[yn]=2,yi[hs]=2,yi[Pi]=2,yi[zs]=4,yi[oo]=.5,yi[Wn]=.5,yi[ao]=1,yi[lo]=1,yi[Mo]=.5,yi[Vn]=1,yi[$o]=1,yi[Os]=.5,yi[en]=.25,yi[tn]=.5,yi[co]=.25,yi[uo]=.5;function Un(R){return Array.isArray(R)&&(R.length===0||typeof R[0]=="number")}function jn(R){if(!Array.isArray(R))return!1;var N=R.length;return!(N===0||!ci(R[0]))}function _r(R){return Object.prototype.toString.call(R)}function Na(R){return _r(R)===ei}function za(R){return _r(R)===oi}function jl(R){return _r(R)===bi}function ql(R){return _r(R)===Hi}function Xl(R){return _r(R)===ni}function Yl(R){return _r(R)===pr}function ca(R){if(!R)return!1;var N=_r(R);return Tr.indexOf(N)>=0?!0:Un(R)||jn(R)||$r(R)}function Ia(R){return Rt[Object.prototype.toString.call(R)]|0}function Kl(R,N){var V=N.length;switch(R.type){case kn:case fo:case Oi:case _n:var ye=Vi.allocType(R.type,V);ye.set(N),R.data=ye;break;case Gn:R.data=Di(N);break;default:P.raise("unsupported texture type, must specify a typed array")}}function Oa(R,N){return Vi.allocType(R.type===Gn?_n:R.type,N)}function Ba(R,N){R.type===Gn?(R.data=Di(N),Vi.freeType(N)):R.data=N}function Ql(R,N,V,ye,Le,ve){for(var Ce=R.width,Ge=R.height,He=R.channels,tt=Ce*Ge*He,rt=Oa(R,tt),it=0,ct=0;ct<Ge;++ct)for(var We=0;We<Ce;++We)for(var Ze=0;Ze<He;++Ze)rt[it++]=N[V*We+ye*ct+Le*Ze+ve];Ba(R,rt)}function Po(R,N,V,ye,Le,ve){var Ce;if(typeof yi[R]<"u"?Ce=yi[R]:Ce=Et[R]*Cr[N],ve&&(Ce*=6),Le){for(var Ge=0,He=V;He>=1;)Ge+=Ce*He*He,He/=2;return Ge}else return Ce*V*ye}function Zl(R,N,V,ye,Le,ve,Ce){var Ge={"don't care":Dn,"dont care":Dn,nice:go,fast:mo},He={repeat:ho,clamp:Bs,mirror:sa},tt={nearest:un,linear:po},rt=r({mipmap:gs,"nearest mipmap nearest":Hs,"linear mipmap nearest":ps,"nearest mipmap linear":ms,"linear mipmap linear":gs},tt),it={none:0,browser:me},ct={uint8:kn,rgba4:Tn,rgb565:no,"rgb5 a1":Lo},We={alpha:Jr,luminance:zr,"luminance alpha":ds,rgb:Mr,rgba:hr,rgba4:yn,"rgb5 a1":hs,rgb565:Pi},Ze={};N.ext_srgb&&(We.srgb=Is,We.srgba=so),N.oes_texture_float&&(ct.float32=ct.float=_n),N.oes_texture_half_float&&(ct.float16=ct["half float"]=Gn),N.webgl_depth_texture&&(r(We,{depth:Hn,"depth stencil":zs}),r(ct,{uint16:fo,uint32:Oi,"depth stencil":na})),N.webgl_compressed_texture_s3tc&&r(Ze,{"rgb s3tc dxt1":oo,"rgba s3tc dxt1":Wn,"rgba s3tc dxt3":ao,"rgba s3tc dxt5":lo}),N.webgl_compressed_texture_atc&&r(Ze,{"rgb atc":Mo,"rgba atc explicit alpha":Vn,"rgba atc interpolated alpha":$o}),N.webgl_compressed_texture_pvrtc&&r(Ze,{"rgb pvrtc 4bppv1":Os,"rgb pvrtc 2bppv1":en,"rgba pvrtc 4bppv1":tn,"rgba pvrtc 2bppv1":co}),N.webgl_compressed_texture_etc1&&(Ze["rgb etc1"]=uo);var le=Array.prototype.slice.call(R.getParameter(Ns));Object.keys(Ze).forEach(function(G){var _e=Ze[G];le.indexOf(_e)>=0&&(We[G]=_e)});var be=Object.keys(We);V.textureFormats=be;var Ye=[];Object.keys(We).forEach(function(G){var _e=We[G];Ye[_e]=G});var Ct=[];Object.keys(ct).forEach(function(G){var _e=ct[G];Ct[_e]=G});var Ie=[];Object.keys(tt).forEach(function(G){var _e=tt[G];Ie[_e]=G});var wt=[];Object.keys(rt).forEach(function(G){var _e=rt[G];wt[_e]=G});var gt=[];Object.keys(He).forEach(function(G){var _e=He[G];gt[_e]=G});var Ht=be.reduce(function(G,_e){var ge=We[_e];return ge===zr||ge===Jr||ge===zr||ge===ds||ge===Hn||ge===zs||N.ext_srgb&&(ge===Is||ge===so)?G[ge]=ge:ge===hs||_e.indexOf("rgba")>=0?G[ge]=hr:G[ge]=Mr,G},{});function $e(){this.internalformat=hr,this.format=hr,this.type=kn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=me,this.width=0,this.height=0,this.channels=0}function De(G,_e){G.internalformat=_e.internalformat,G.format=_e.format,G.type=_e.type,G.compressed=_e.compressed,G.premultiplyAlpha=_e.premultiplyAlpha,G.flipY=_e.flipY,G.unpackAlignment=_e.unpackAlignment,G.colorSpace=_e.colorSpace,G.width=_e.width,G.height=_e.height,G.channels=_e.channels}function Mt(G,_e){if(!(typeof _e!="object"||!_e)){if("premultiplyAlpha"in _e&&(P.type(_e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),G.premultiplyAlpha=_e.premultiplyAlpha),"flipY"in _e&&(P.type(_e.flipY,"boolean","invalid texture flip"),G.flipY=_e.flipY),"alignment"in _e&&(P.oneOf(_e.alignment,[1,2,4,8],"invalid texture unpack alignment"),G.unpackAlignment=_e.alignment),"colorSpace"in _e&&(P.parameter(_e.colorSpace,it,"invalid colorSpace"),G.colorSpace=it[_e.colorSpace]),"type"in _e){var ge=_e.type;P(N.oes_texture_float||!(ge==="float"||ge==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),P(N.oes_texture_half_float||!(ge==="half float"||ge==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),P(N.webgl_depth_texture||!(ge==="uint16"||ge==="uint32"||ge==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),P.parameter(ge,ct,"invalid texture type"),G.type=ct[ge]}var Dt=G.width,di=G.height,I=G.channels,F=!1;"shape"in _e?(P(Array.isArray(_e.shape)&&_e.shape.length>=2,"shape must be an array"),Dt=_e.shape[0],di=_e.shape[1],_e.shape.length===3&&(I=_e.shape[2],P(I>0&&I<=4,"invalid number of channels"),F=!0),P(Dt>=0&&Dt<=V.maxTextureSize,"invalid width"),P(di>=0&&di<=V.maxTextureSize,"invalid height")):("radius"in _e&&(Dt=di=_e.radius,P(Dt>=0&&Dt<=V.maxTextureSize,"invalid radius")),"width"in _e&&(Dt=_e.width,P(Dt>=0&&Dt<=V.maxTextureSize,"invalid width")),"height"in _e&&(di=_e.height,P(di>=0&&di<=V.maxTextureSize,"invalid height")),"channels"in _e&&(I=_e.channels,P(I>0&&I<=4,"invalid number of channels"),F=!0)),G.width=Dt|0,G.height=di|0,G.channels=I|0;var j=!1;if("format"in _e){var ae=_e.format;P(N.webgl_depth_texture||!(ae==="depth"||ae==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),P.parameter(ae,We,"invalid texture format");var ce=G.internalformat=We[ae];G.format=Ht[ce],ae in ct&&("type"in _e||(G.type=ct[ae])),ae in Ze&&(G.compressed=!0),j=!0}!F&&j?G.channels=Et[G.format]:F&&!j?G.channels!==At[G.format]&&(G.format=G.internalformat=At[G.channels]):j&&F&&P(G.channels===Et[G.format],"number of channels inconsistent with specified format")}}function ut(G){R.pixelStorei(Z,G.flipY),R.pixelStorei(oe,G.premultiplyAlpha),R.pixelStorei(Oe,G.colorSpace),R.pixelStorei(z,G.unpackAlignment)}function qe(){$e.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ft(G,_e){var ge=null;if(ca(_e)?ge=_e:_e&&(P.type(_e,"object","invalid pixel data type"),Mt(G,_e),"x"in _e&&(G.xOffset=_e.x|0),"y"in _e&&(G.yOffset=_e.y|0),ca(_e.data)&&(ge=_e.data)),P(!G.compressed||ge instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),_e.copy){P(!ge,"can not specify copy and data field for the same texture");var Dt=Le.viewportWidth,di=Le.viewportHeight;G.width=G.width||Dt-G.xOffset,G.height=G.height||di-G.yOffset,G.needsCopy=!0,P(G.xOffset>=0&&G.xOffset<Dt&&G.yOffset>=0&&G.yOffset<di&&G.width>0&&G.width<=Dt&&G.height>0&&G.height<=di,"copy texture read out of bounds")}else if(!ge)G.width=G.width||1,G.height=G.height||1,G.channels=G.channels||4;else if(t(ge))G.channels=G.channels||4,G.data=ge,!("type"in _e)&&G.type===kn&&(G.type=Ia(ge));else if(Un(ge))G.channels=G.channels||4,Kl(G,ge),G.alignment=1,G.needsFree=!0;else if($r(ge)){var I=ge.data;!Array.isArray(I)&&G.type===kn&&(G.type=Ia(I));var F=ge.shape,j=ge.stride,ae,ce,te,J,se,B;F.length===3?(te=F[2],B=j[2]):(P(F.length===2,"invalid ndarray pixel data, must be 2 or 3D"),te=1,B=1),ae=F[0],ce=F[1],J=j[0],se=j[1],G.alignment=1,G.width=ae,G.height=ce,G.channels=te,G.format=G.internalformat=At[te],G.needsFree=!0,Ql(G,I,J,se,B,ge.offset)}else if(Na(ge)||za(ge)||jl(ge))Na(ge)||za(ge)?G.element=ge:G.element=ge.canvas,G.width=G.element.width,G.height=G.element.height,G.channels=4;else if(ql(ge))G.element=ge,G.width=ge.width,G.height=ge.height,G.channels=4;else if(Xl(ge))G.element=ge,G.width=ge.naturalWidth,G.height=ge.naturalHeight,G.channels=4;else if(Yl(ge))G.element=ge,G.width=ge.videoWidth,G.height=ge.videoHeight,G.channels=4;else if(jn(ge)){var W=G.width||ge[0].length,H=G.height||ge.length,pe=G.channels;ci(ge[0][0])?pe=pe||ge[0][0].length:pe=pe||1;for(var fe=Kr.shape(ge),Ae=1,Fe=0;Fe<fe.length;++Fe)Ae*=fe[Fe];var lt=Oa(G,Ae);Kr.flatten(ge,fe,"",lt),Ba(G,lt),G.alignment=1,G.width=W,G.height=H,G.channels=pe,G.format=G.internalformat=At[pe],G.needsFree=!0}G.type===_n?P(V.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):G.type===Gn&&P(V.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function pt(G,_e,ge){var Dt=G.element,di=G.data,I=G.internalformat,F=G.format,j=G.type,ae=G.width,ce=G.height;ut(G),Dt?R.texImage2D(_e,ge,F,F,j,Dt):G.compressed?R.compressedTexImage2D(_e,ge,I,ae,ce,0,di):G.needsCopy?(ye(),R.copyTexImage2D(_e,ge,F,G.xOffset,G.yOffset,ae,ce,0)):R.texImage2D(_e,ge,F,ae,ce,0,F,j,di||null)}function ti(G,_e,ge,Dt,di){var I=G.element,F=G.data,j=G.internalformat,ae=G.format,ce=G.type,te=G.width,J=G.height;ut(G),I?R.texSubImage2D(_e,di,ge,Dt,ae,ce,I):G.compressed?R.compressedTexSubImage2D(_e,di,ge,Dt,j,te,J,F):G.needsCopy?(ye(),R.copyTexSubImage2D(_e,di,ge,Dt,G.xOffset,G.yOffset,te,J)):R.texSubImage2D(_e,di,ge,Dt,te,J,ae,ce,F)}var Zt=[];function vt(){return Zt.pop()||new qe}function bt(G){G.needsFree&&Vi.freeType(G.data),qe.call(G),Zt.push(G)}function qt(){$e.call(this),this.genMipmaps=!1,this.mipmapHint=Dn,this.mipmask=0,this.images=Array(16)}function ii(G,_e,ge){var Dt=G.images[0]=vt();G.mipmask=1,Dt.width=G.width=_e,Dt.height=G.height=ge,Dt.channels=G.channels=4}function hi(G,_e){var ge=null;if(ca(_e))ge=G.images[0]=vt(),De(ge,G),ft(ge,_e),G.mipmask=1;else if(Mt(G,_e),Array.isArray(_e.mipmap))for(var Dt=_e.mipmap,di=0;di<Dt.length;++di)ge=G.images[di]=vt(),De(ge,G),ge.width>>=di,ge.height>>=di,ft(ge,Dt[di]),G.mipmask|=1<<di;else ge=G.images[0]=vt(),De(ge,G),ft(ge,_e),G.mipmask=1;De(G,G.images[0]),G.compressed&&(G.internalformat===oo||G.internalformat===Wn||G.internalformat===ao||G.internalformat===lo)&&P(G.width%4===0&&G.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ji(G,_e){for(var ge=G.images,Dt=0;Dt<ge.length;++Dt){if(!ge[Dt])return;pt(ge[Dt],_e,Dt)}}var ir=[];function gi(){var G=ir.pop()||new qt;$e.call(G),G.mipmask=0;for(var _e=0;_e<16;++_e)G.images[_e]=null;return G}function wr(G){for(var _e=G.images,ge=0;ge<_e.length;++ge)_e[ge]&&bt(_e[ge]),_e[ge]=null;ir.push(G)}function Xi(){this.minFilter=un,this.magFilter=un,this.wrapS=Bs,this.wrapT=Bs,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Dn}function gr(G,_e){if("min"in _e){var ge=_e.min;P.parameter(ge,rt),G.minFilter=rt[ge],st.indexOf(G.minFilter)>=0&&!("faces"in _e)&&(G.genMipmaps=!0)}if("mag"in _e){var Dt=_e.mag;P.parameter(Dt,tt),G.magFilter=tt[Dt]}var di=G.wrapS,I=G.wrapT;if("wrap"in _e){var F=_e.wrap;typeof F=="string"?(P.parameter(F,He),di=I=He[F]):Array.isArray(F)&&(P.parameter(F[0],He),P.parameter(F[1],He),di=He[F[0]],I=He[F[1]])}else{if("wrapS"in _e){var j=_e.wrapS;P.parameter(j,He),di=He[j]}if("wrapT"in _e){var ae=_e.wrapT;P.parameter(ae,He),I=He[ae]}}if(G.wrapS=di,G.wrapT=I,"anisotropic"in _e){var ce=_e.anisotropic;P(typeof ce=="number"&&ce>=1&&ce<=V.maxAnisotropic,"aniso samples must be between 1 and "),G.anisotropic=_e.anisotropic}if("mipmap"in _e){var te=!1;switch(typeof _e.mipmap){case"string":P.parameter(_e.mipmap,Ge,"invalid mipmap hint"),G.mipmapHint=Ge[_e.mipmap],G.genMipmaps=!0,te=!0;break;case"boolean":te=G.genMipmaps=_e.mipmap;break;case"object":P(Array.isArray(_e.mipmap),"invalid mipmap type"),G.genMipmaps=!1,te=!0;break;default:P.raise("invalid mipmap type")}te&&!("min"in _e)&&(G.minFilter=Hs)}}function br(G,_e){R.texParameteri(_e,Fo,G.minFilter),R.texParameteri(_e,oa,G.magFilter),R.texParameteri(_e,Wr,G.wrapS),R.texParameteri(_e,Vr,G.wrapT),N.ext_texture_filter_anisotropic&&R.texParameteri(_e,la,G.anisotropic),G.genMipmaps&&(R.hint(aa,G.mipmapHint),R.generateMipmap(_e))}var xr=0,Er={},kr=V.maxTextureUnits,cr=Array(kr).map(function(){return null});function ui(G){$e.call(this),this.mipmask=0,this.internalformat=hr,this.id=xr++,this.refCount=1,this.target=G,this.texture=R.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Xi,Ce.profile&&(this.stats={size:0})}function Dr(G){R.activeTexture(Be),R.bindTexture(G.target,G.texture)}function Li(){var G=cr[0];G?R.bindTexture(G.target,G.texture):R.bindTexture(nr,null)}function Wt(G){var _e=G.texture;P(_e,"must not double destroy texture");var ge=G.unit,Dt=G.target;ge>=0&&(R.activeTexture(Be+ge),R.bindTexture(Dt,null),cr[ge]=null),R.deleteTexture(_e),G.texture=null,G.params=null,G.pixels=null,G.refCount=0,delete Er[G.id],ve.textureCount--}r(ui.prototype,{bind:function(){var G=this;G.bindCount+=1;var _e=G.unit;if(_e<0){for(var ge=0;ge<kr;++ge){var Dt=cr[ge];if(Dt){if(Dt.bindCount>0)continue;Dt.unit=-1}cr[ge]=G,_e=ge;break}_e>=kr&&P.raise("insufficient number of texture units"),Ce.profile&&ve.maxTextureUnits<_e+1&&(ve.maxTextureUnits=_e+1),G.unit=_e,R.activeTexture(Be+_e),R.bindTexture(G.target,G.texture)}return _e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Wt(this)}});function mi(G,_e){var ge=new ui(nr);Er[ge.id]=ge,ve.textureCount++;function Dt(F,j){var ae=ge.texInfo;Xi.call(ae);var ce=gi();return typeof F=="number"?typeof j=="number"?ii(ce,F|0,j|0):ii(ce,F|0,F|0):F?(P.type(F,"object","invalid arguments to regl.texture"),gr(ae,F),hi(ce,F)):ii(ce,1,1),ae.genMipmaps&&(ce.mipmask=(ce.width<<1)-1),ge.mipmask=ce.mipmask,De(ge,ce),P.texture2D(ae,ce,V),ge.internalformat=ce.internalformat,Dt.width=ce.width,Dt.height=ce.height,Dr(ge),Ji(ce,nr),br(ae,nr),Li(),wr(ce),Ce.profile&&(ge.stats.size=Po(ge.internalformat,ge.type,ce.width,ce.height,ae.genMipmaps,!1)),Dt.format=Ye[ge.internalformat],Dt.type=Ct[ge.type],Dt.mag=Ie[ae.magFilter],Dt.min=wt[ae.minFilter],Dt.wrapS=gt[ae.wrapS],Dt.wrapT=gt[ae.wrapT],Dt}function di(F,j,ae,ce){P(!!F,"must specify image data");var te=j|0,J=ae|0,se=ce|0,B=vt();return De(B,ge),B.width=0,B.height=0,ft(B,F),B.width=B.width||(ge.width>>se)-te,B.height=B.height||(ge.height>>se)-J,P(ge.type===B.type&&ge.format===B.format&&ge.internalformat===B.internalformat,"incompatible format for texture.subimage"),P(te>=0&&J>=0&&te+B.width<=ge.width&&J+B.height<=ge.height,"texture.subimage write out of bounds"),P(ge.mipmask&1<<se,"missing mipmap data"),P(B.data||B.element||B.needsCopy,"missing image data"),Dr(ge),ti(B,nr,te,J,se),Li(),bt(B),Dt}function I(F,j){var ae=F|0,ce=j|0||ae;if(ae===ge.width&&ce===ge.height)return Dt;Dt.width=ge.width=ae,Dt.height=ge.height=ce,Dr(ge);for(var te=0;ge.mipmask>>te;++te){var J=ae>>te,se=ce>>te;if(!J||!se)break;R.texImage2D(nr,te,ge.format,J,se,0,ge.format,ge.type,null)}return Li(),Ce.profile&&(ge.stats.size=Po(ge.internalformat,ge.type,ae,ce,!1,!1)),Dt}return Dt(G,_e),Dt.subimage=di,Dt.resize=I,Dt._reglType="texture2d",Dt._texture=ge,Ce.profile&&(Dt.stats=ge.stats),Dt.destroy=function(){ge.decRef()},Dt}function Si(G,_e,ge,Dt,di,I){var F=new ui(cn);Er[F.id]=F,ve.cubeCount++;var j=new Array(6);function ae(J,se,B,W,H,pe){var fe,Ae=F.texInfo;for(Xi.call(Ae),fe=0;fe<6;++fe)j[fe]=gi();if(typeof J=="number"||!J){var Fe=J|0||1;for(fe=0;fe<6;++fe)ii(j[fe],Fe,Fe)}else if(typeof J=="object")if(se)hi(j[0],J),hi(j[1],se),hi(j[2],B),hi(j[3],W),hi(j[4],H),hi(j[5],pe);else if(gr(Ae,J),Mt(F,J),"faces"in J){var lt=J.faces;for(P(Array.isArray(lt)&&lt.length===6,"cube faces must be a length 6 array"),fe=0;fe<6;++fe)P(typeof lt[fe]=="object"&&!!lt[fe],"invalid input for cube map face"),De(j[fe],F),hi(j[fe],lt[fe])}else for(fe=0;fe<6;++fe)hi(j[fe],J);else P.raise("invalid arguments to cube map");for(De(F,j[0]),P.optional(function(){V.npotTextureCube||P(Bn(F.width)&&Bn(F.height),"your browser does not support non power or two texture dimensions")}),Ae.genMipmaps?F.mipmask=(j[0].width<<1)-1:F.mipmask=j[0].mipmask,P.textureCube(F,Ae,j,V),F.internalformat=j[0].internalformat,ae.width=j[0].width,ae.height=j[0].height,Dr(F),fe=0;fe<6;++fe)Ji(j[fe],Zr+fe);for(br(Ae,cn),Li(),Ce.profile&&(F.stats.size=Po(F.internalformat,F.type,ae.width,ae.height,Ae.genMipmaps,!0)),ae.format=Ye[F.internalformat],ae.type=Ct[F.type],ae.mag=Ie[Ae.magFilter],ae.min=wt[Ae.minFilter],ae.wrapS=gt[Ae.wrapS],ae.wrapT=gt[Ae.wrapT],fe=0;fe<6;++fe)wr(j[fe]);return ae}function ce(J,se,B,W,H){P(!!se,"must specify image data"),P(typeof J=="number"&&J===(J|0)&&J>=0&&J<6,"invalid face");var pe=B|0,fe=W|0,Ae=H|0,Fe=vt();return De(Fe,F),Fe.width=0,Fe.height=0,ft(Fe,se),Fe.width=Fe.width||(F.width>>Ae)-pe,Fe.height=Fe.height||(F.height>>Ae)-fe,P(F.type===Fe.type&&F.format===Fe.format&&F.internalformat===Fe.internalformat,"incompatible format for texture.subimage"),P(pe>=0&&fe>=0&&pe+Fe.width<=F.width&&fe+Fe.height<=F.height,"texture.subimage write out of bounds"),P(F.mipmask&1<<Ae,"missing mipmap data"),P(Fe.data||Fe.element||Fe.needsCopy,"missing image data"),Dr(F),ti(Fe,Zr+J,pe,fe,Ae),Li(),bt(Fe),ae}function te(J){var se=J|0;if(se!==F.width){ae.width=F.width=se,ae.height=F.height=se,Dr(F);for(var B=0;B<6;++B)for(var W=0;F.mipmask>>W;++W)R.texImage2D(Zr+B,W,F.format,se>>W,se>>W,0,F.format,F.type,null);return Li(),Ce.profile&&(F.stats.size=Po(F.internalformat,F.type,ae.width,ae.height,!1,!0)),ae}}return ae(G,_e,ge,Dt,di,I),ae.subimage=ce,ae.resize=te,ae._reglType="textureCube",ae._texture=F,Ce.profile&&(ae.stats=F.stats),ae.destroy=function(){F.decRef()},ae}function ur(){for(var G=0;G<kr;++G)R.activeTexture(Be+G),R.bindTexture(nr,null),cr[G]=null;Ar(Er).forEach(Wt),ve.cubeCount=0,ve.textureCount=0}Ce.profile&&(ve.getTotalTextureSize=function(){var G=0;return Object.keys(Er).forEach(function(_e){G+=Er[_e].stats.size}),G});function bn(){for(var G=0;G<kr;++G){var _e=cr[G];_e&&(_e.bindCount=0,_e.unit=-1,cr[G]=null)}Ar(Er).forEach(function(ge){ge.texture=R.createTexture(),R.bindTexture(ge.target,ge.texture);for(var Dt=0;Dt<32;++Dt)if(ge.mipmask&1<<Dt)if(ge.target===nr)R.texImage2D(nr,Dt,ge.internalformat,ge.width>>Dt,ge.height>>Dt,0,ge.internalformat,ge.type,null);else for(var di=0;di<6;++di)R.texImage2D(Zr+di,Dt,ge.internalformat,ge.width>>Dt,ge.height>>Dt,0,ge.internalformat,ge.type,null);br(ge.texInfo,ge.target)})}function Cs(){for(var G=0;G<kr;++G){var _e=cr[G];_e&&(_e.bindCount=0,_e.unit=-1,cr[G]=null),R.activeTexture(Be+G),R.bindTexture(nr,null),R.bindTexture(cn,null)}}return{create2D:mi,createCube:Si,clear:ur,getTexture:function(G){return null},restore:bn,refresh:Cs}}var qn=36161,No=32854,Ha=32855,Ga=36194,Wa=33189,Va=36168,Ua=34041,ja=35907,qa=34836,Xa=34842,Ya=34843,fn=[];fn[No]=2,fn[Ha]=2,fn[Ga]=2,fn[Wa]=2,fn[Va]=1,fn[Ua]=4,fn[ja]=4,fn[qa]=16,fn[Xa]=8,fn[Ya]=6;function Ka(R,N,V){return fn[R]*N*V}var Jl=function(R,N,V,ye,Le){var ve={rgba4:No,rgb565:Ga,"rgb5 a1":Ha,depth:Wa,stencil:Va,"depth stencil":Ua};N.ext_srgb&&(ve.srgba=ja),N.ext_color_buffer_half_float&&(ve.rgba16f=Xa,ve.rgb16f=Ya),N.webgl_color_buffer_float&&(ve.rgba32f=qa);var Ce=[];Object.keys(ve).forEach(function(We){var Ze=ve[We];Ce[Ze]=We});var Ge=0,He={};function tt(We){this.id=Ge++,this.refCount=1,this.renderbuffer=We,this.format=No,this.width=0,this.height=0,Le.profile&&(this.stats={size:0})}tt.prototype.decRef=function(){--this.refCount<=0&&rt(this)};function rt(We){var Ze=We.renderbuffer;P(Ze,"must not double destroy renderbuffer"),R.bindRenderbuffer(qn,null),R.deleteRenderbuffer(Ze),We.renderbuffer=null,We.refCount=0,delete He[We.id],ye.renderbufferCount--}function it(We,Ze){var le=new tt(R.createRenderbuffer());He[le.id]=le,ye.renderbufferCount++;function be(Ct,Ie){var wt=0,gt=0,Ht=No;if(typeof Ct=="object"&&Ct){var $e=Ct;if("shape"in $e){var De=$e.shape;P(Array.isArray(De)&&De.length>=2,"invalid renderbuffer shape"),wt=De[0]|0,gt=De[1]|0}else"radius"in $e&&(wt=gt=$e.radius|0),"width"in $e&&(wt=$e.width|0),"height"in $e&&(gt=$e.height|0);"format"in $e&&(P.parameter($e.format,ve,"invalid renderbuffer format"),Ht=ve[$e.format])}else typeof Ct=="number"?(wt=Ct|0,typeof Ie=="number"?gt=Ie|0:gt=wt):Ct?P.raise("invalid arguments to renderbuffer constructor"):wt=gt=1;if(P(wt>0&&gt>0&&wt<=V.maxRenderbufferSize&&gt<=V.maxRenderbufferSize,"invalid renderbuffer size"),!(wt===le.width&&gt===le.height&&Ht===le.format))return be.width=le.width=wt,be.height=le.height=gt,le.format=Ht,R.bindRenderbuffer(qn,le.renderbuffer),R.renderbufferStorage(qn,Ht,wt,gt),P(R.getError()===0,"invalid render buffer format"),Le.profile&&(le.stats.size=Ka(le.format,le.width,le.height)),be.format=Ce[le.format],be}function Ye(Ct,Ie){var wt=Ct|0,gt=Ie|0||wt;return wt===le.width&&gt===le.height||(P(wt>0&&gt>0&&wt<=V.maxRenderbufferSize&&gt<=V.maxRenderbufferSize,"invalid renderbuffer size"),be.width=le.width=wt,be.height=le.height=gt,R.bindRenderbuffer(qn,le.renderbuffer),R.renderbufferStorage(qn,le.format,wt,gt),P(R.getError()===0,"invalid render buffer format"),Le.profile&&(le.stats.size=Ka(le.format,le.width,le.height))),be}return be(We,Ze),be.resize=Ye,be._reglType="renderbuffer",be._renderbuffer=le,Le.profile&&(be.stats=le.stats),be.destroy=function(){le.decRef()},be}Le.profile&&(ye.getTotalRenderbufferSize=function(){var We=0;return Object.keys(He).forEach(function(Ze){We+=He[Ze].stats.size}),We});function ct(){Ar(He).forEach(function(We){We.renderbuffer=R.createRenderbuffer(),R.bindRenderbuffer(qn,We.renderbuffer),R.renderbufferStorage(qn,We.format,We.width,We.height)}),R.bindRenderbuffer(qn,null)}return{create:it,clear:function(){Ar(He).forEach(rt)},restore:ct}},Ln=36160,ua=36161,vs=3553,zo=34069,Qa=36064,Za=36096,Ja=36128,el=33306,tl=36053,ec=36054,tc=36055,ic=36057,rc=36061,nc=36193,sc=5121,oc=5126,il=6407,rl=6408,ac=6402,lc=[il,rl],fa=[];fa[rl]=4,fa[il]=3;var Io=[];Io[sc]=1,Io[oc]=4,Io[nc]=2;var cc=32854,uc=32855,fc=36194,dc=33189,hc=36168,nl=34041,pc=35907,mc=34836,gc=34842,vc=34843,yc=[cc,uc,fc,pc,gc,vc,mc],Gs={};Gs[tl]="complete",Gs[ec]="incomplete attachment",Gs[ic]="incomplete dimensions",Gs[tc]="incomplete, missing attachment",Gs[rc]="unsupported";function _c(R,N,V,ye,Le,ve){var Ce={cur:null,next:null,dirty:!1,setFBO:null},Ge=["rgba"],He=["rgba4","rgb565","rgb5 a1"];N.ext_srgb&&He.push("srgba"),N.ext_color_buffer_half_float&&He.push("rgba16f","rgb16f"),N.webgl_color_buffer_float&&He.push("rgba32f");var tt=["uint8"];N.oes_texture_half_float&&tt.push("half float","float16"),N.oes_texture_float&&tt.push("float","float32");function rt(qe,ft,pt){this.target=qe,this.texture=ft,this.renderbuffer=pt;var ti=0,Zt=0;ft?(ti=ft.width,Zt=ft.height):pt&&(ti=pt.width,Zt=pt.height),this.width=ti,this.height=Zt}function it(qe){qe&&(qe.texture&&qe.texture._texture.decRef(),qe.renderbuffer&&qe.renderbuffer._renderbuffer.decRef())}function ct(qe,ft,pt){if(qe)if(qe.texture){var ti=qe.texture._texture,Zt=Math.max(1,ti.width),vt=Math.max(1,ti.height);P(Zt===ft&&vt===pt,"inconsistent width/height for supplied texture"),ti.refCount+=1}else{var bt=qe.renderbuffer._renderbuffer;P(bt.width===ft&&bt.height===pt,"inconsistent width/height for renderbuffer"),bt.refCount+=1}}function We(qe,ft){ft&&(ft.texture?R.framebufferTexture2D(Ln,qe,ft.target,ft.texture._texture.texture,0):R.framebufferRenderbuffer(Ln,qe,ua,ft.renderbuffer._renderbuffer.renderbuffer))}function Ze(qe){var ft=vs,pt=null,ti=null,Zt=qe;typeof qe=="object"&&(Zt=qe.data,"target"in qe&&(ft=qe.target|0)),P.type(Zt,"function","invalid attachment data");var vt=Zt._reglType;return vt==="texture2d"?(pt=Zt,P(ft===vs)):vt==="textureCube"?(pt=Zt,P(ft>=zo&&ft<zo+6,"invalid cube map target")):vt==="renderbuffer"?(ti=Zt,ft=ua):P.raise("invalid regl object for attachment"),new rt(ft,pt,ti)}function le(qe,ft,pt,ti,Zt){if(pt){var vt=ye.create2D({width:qe,height:ft,format:ti,type:Zt});return vt._texture.refCount=0,new rt(vs,vt,null)}else{var bt=Le.create({width:qe,height:ft,format:ti});return bt._renderbuffer.refCount=0,new rt(ua,null,bt)}}function be(qe){return qe&&(qe.texture||qe.renderbuffer)}function Ye(qe,ft,pt){qe&&(qe.texture?qe.texture.resize(ft,pt):qe.renderbuffer&&qe.renderbuffer.resize(ft,pt),qe.width=ft,qe.height=pt)}var Ct=0,Ie={};function wt(){this.id=Ct++,Ie[this.id]=this,this.framebuffer=R.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function gt(qe){qe.colorAttachments.forEach(it),it(qe.depthAttachment),it(qe.stencilAttachment),it(qe.depthStencilAttachment)}function Ht(qe){var ft=qe.framebuffer;P(ft,"must not double destroy framebuffer"),R.deleteFramebuffer(ft),qe.framebuffer=null,ve.framebufferCount--,delete Ie[qe.id]}function $e(qe){var ft;R.bindFramebuffer(Ln,qe.framebuffer);var pt=qe.colorAttachments;for(ft=0;ft<pt.length;++ft)We(Qa+ft,pt[ft]);for(ft=pt.length;ft<V.maxColorAttachments;++ft)R.framebufferTexture2D(Ln,Qa+ft,vs,null,0);R.framebufferTexture2D(Ln,el,vs,null,0),R.framebufferTexture2D(Ln,Za,vs,null,0),R.framebufferTexture2D(Ln,Ja,vs,null,0),We(Za,qe.depthAttachment),We(Ja,qe.stencilAttachment),We(el,qe.depthStencilAttachment);var ti=R.checkFramebufferStatus(Ln);!R.isContextLost()&&ti!==tl&&P.raise("framebuffer configuration not supported, status = "+Gs[ti]),R.bindFramebuffer(Ln,Ce.next?Ce.next.framebuffer:null),Ce.cur=Ce.next,R.getError()}function De(qe,ft){var pt=new wt;ve.framebufferCount++;function ti(vt,bt){var qt;P(Ce.next!==pt,"can not update framebuffer which is currently in use");var ii=0,hi=0,Ji=!0,ir=!0,gi=null,wr=!0,Xi="rgba",gr="uint8",br=1,xr=null,Er=null,kr=null,cr=!1;if(typeof vt=="number")ii=vt|0,hi=bt|0||ii;else if(!vt)ii=hi=1;else{P.type(vt,"object","invalid arguments for framebuffer");var ui=vt;if("shape"in ui){var Dr=ui.shape;P(Array.isArray(Dr)&&Dr.length>=2,"invalid shape for framebuffer"),ii=Dr[0],hi=Dr[1]}else"radius"in ui&&(ii=hi=ui.radius),"width"in ui&&(ii=ui.width),"height"in ui&&(hi=ui.height);("color"in ui||"colors"in ui)&&(gi=ui.color||ui.colors,Array.isArray(gi)&&P(gi.length===1||N.webgl_draw_buffers,"multiple render targets not supported")),gi||("colorCount"in ui&&(br=ui.colorCount|0,P(br>0,"invalid color buffer count")),"colorTexture"in ui&&(wr=!!ui.colorTexture,Xi="rgba4"),"colorType"in ui&&(gr=ui.colorType,wr?(P(N.oes_texture_float||!(gr==="float"||gr==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),P(N.oes_texture_half_float||!(gr==="half float"||gr==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):gr==="half float"||gr==="float16"?(P(N.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Xi="rgba16f"):(gr==="float"||gr==="float32")&&(P(N.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Xi="rgba32f"),P.oneOf(gr,tt,"invalid color type")),"colorFormat"in ui&&(Xi=ui.colorFormat,Ge.indexOf(Xi)>=0?wr=!0:He.indexOf(Xi)>=0?wr=!1:P.optional(function(){wr?P.oneOf(ui.colorFormat,Ge,"invalid color format for texture"):P.oneOf(ui.colorFormat,He,"invalid color format for renderbuffer")}))),("depthTexture"in ui||"depthStencilTexture"in ui)&&(cr=!!(ui.depthTexture||ui.depthStencilTexture),P(!cr||N.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ui&&(typeof ui.depth=="boolean"?Ji=ui.depth:(xr=ui.depth,ir=!1)),"stencil"in ui&&(typeof ui.stencil=="boolean"?ir=ui.stencil:(Er=ui.stencil,Ji=!1)),"depthStencil"in ui&&(typeof ui.depthStencil=="boolean"?Ji=ir=ui.depthStencil:(kr=ui.depthStencil,Ji=!1,ir=!1))}var Li=null,Wt=null,mi=null,Si=null;if(Array.isArray(gi))Li=gi.map(Ze);else if(gi)Li=[Ze(gi)];else for(Li=new Array(br),qt=0;qt<br;++qt)Li[qt]=le(ii,hi,wr,Xi,gr);P(N.webgl_draw_buffers||Li.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),P(Li.length<=V.maxColorAttachments,"too many color attachments, not supported"),ii=ii||Li[0].width,hi=hi||Li[0].height,xr?Wt=Ze(xr):Ji&&!ir&&(Wt=le(ii,hi,cr,"depth","uint32")),Er?mi=Ze(Er):ir&&!Ji&&(mi=le(ii,hi,!1,"stencil","uint8")),kr?Si=Ze(kr):!xr&&!Er&&ir&&Ji&&(Si=le(ii,hi,cr,"depth stencil","depth stencil")),P(!!xr+!!Er+!!kr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ur=null;for(qt=0;qt<Li.length;++qt)if(ct(Li[qt],ii,hi),P(!Li[qt]||Li[qt].texture&&lc.indexOf(Li[qt].texture._texture.format)>=0||Li[qt].renderbuffer&&yc.indexOf(Li[qt].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+qt+" is invalid"),Li[qt]&&Li[qt].texture){var bn=fa[Li[qt].texture._texture.format]*Io[Li[qt].texture._texture.type];ur===null?ur=bn:P(ur===bn,"all color attachments much have the same number of bits per pixel.")}return ct(Wt,ii,hi),P(!Wt||Wt.texture&&Wt.texture._texture.format===ac||Wt.renderbuffer&&Wt.renderbuffer._renderbuffer.format===dc,"invalid depth attachment for framebuffer object"),ct(mi,ii,hi),P(!mi||mi.renderbuffer&&mi.renderbuffer._renderbuffer.format===hc,"invalid stencil attachment for framebuffer object"),ct(Si,ii,hi),P(!Si||Si.texture&&Si.texture._texture.format===nl||Si.renderbuffer&&Si.renderbuffer._renderbuffer.format===nl,"invalid depth-stencil attachment for framebuffer object"),gt(pt),pt.width=ii,pt.height=hi,pt.colorAttachments=Li,pt.depthAttachment=Wt,pt.stencilAttachment=mi,pt.depthStencilAttachment=Si,ti.color=Li.map(be),ti.depth=be(Wt),ti.stencil=be(mi),ti.depthStencil=be(Si),ti.width=pt.width,ti.height=pt.height,$e(pt),ti}function Zt(vt,bt){P(Ce.next!==pt,"can not resize a framebuffer which is currently in use");var qt=Math.max(vt|0,1),ii=Math.max(bt|0||qt,1);if(qt===pt.width&&ii===pt.height)return ti;for(var hi=pt.colorAttachments,Ji=0;Ji<hi.length;++Ji)Ye(hi[Ji],qt,ii);return Ye(pt.depthAttachment,qt,ii),Ye(pt.stencilAttachment,qt,ii),Ye(pt.depthStencilAttachment,qt,ii),pt.width=ti.width=qt,pt.height=ti.height=ii,$e(pt),ti}return ti(qe,ft),r(ti,{resize:Zt,_reglType:"framebuffer",_framebuffer:pt,destroy:function(){Ht(pt),gt(pt)},use:function(vt){Ce.setFBO({framebuffer:ti},vt)}})}function Mt(qe){var ft=Array(6);function pt(Zt){var vt;P(ft.indexOf(Ce.next)<0,"can not update framebuffer which is currently in use");var bt={color:null},qt=0,ii=null,hi="rgba",Ji="uint8",ir=1;if(typeof Zt=="number")qt=Zt|0;else if(!Zt)qt=1;else{P.type(Zt,"object","invalid arguments for framebuffer");var gi=Zt;if("shape"in gi){var wr=gi.shape;P(Array.isArray(wr)&&wr.length>=2,"invalid shape for framebuffer"),P(wr[0]===wr[1],"cube framebuffer must be square"),qt=wr[0]}else"radius"in gi&&(qt=gi.radius|0),"width"in gi?(qt=gi.width|0,"height"in gi&&P(gi.height===qt,"must be square")):"height"in gi&&(qt=gi.height|0);("color"in gi||"colors"in gi)&&(ii=gi.color||gi.colors,Array.isArray(ii)&&P(ii.length===1||N.webgl_draw_buffers,"multiple render targets not supported")),ii||("colorCount"in gi&&(ir=gi.colorCount|0,P(ir>0,"invalid color buffer count")),"colorType"in gi&&(P.oneOf(gi.colorType,tt,"invalid color type"),Ji=gi.colorType),"colorFormat"in gi&&(hi=gi.colorFormat,P.oneOf(gi.colorFormat,Ge,"invalid color format for texture"))),"depth"in gi&&(bt.depth=gi.depth),"stencil"in gi&&(bt.stencil=gi.stencil),"depthStencil"in gi&&(bt.depthStencil=gi.depthStencil)}var Xi;if(ii)if(Array.isArray(ii))for(Xi=[],vt=0;vt<ii.length;++vt)Xi[vt]=ii[vt];else Xi=[ii];else{Xi=Array(ir);var gr={radius:qt,format:hi,type:Ji};for(vt=0;vt<ir;++vt)Xi[vt]=ye.createCube(gr)}for(bt.color=Array(Xi.length),vt=0;vt<Xi.length;++vt){var br=Xi[vt];P(typeof br=="function"&&br._reglType==="textureCube","invalid cube map"),qt=qt||br.width,P(br.width===qt&&br.height===qt,"invalid cube map shape"),bt.color[vt]={target:zo,data:Xi[vt]}}for(vt=0;vt<6;++vt){for(var xr=0;xr<Xi.length;++xr)bt.color[xr].target=zo+vt;vt>0&&(bt.depth=ft[0].depth,bt.stencil=ft[0].stencil,bt.depthStencil=ft[0].depthStencil),ft[vt]?ft[vt](bt):ft[vt]=De(bt)}return r(pt,{width:qt,height:qt,color:Xi})}function ti(Zt){var vt,bt=Zt|0;if(P(bt>0&&bt<=V.maxCubeMapSize,"invalid radius for cube fbo"),bt===pt.width)return pt;var qt=pt.color;for(vt=0;vt<qt.length;++vt)qt[vt].resize(bt);for(vt=0;vt<6;++vt)ft[vt].resize(bt);return pt.width=pt.height=bt,pt}return pt(qe),r(pt,{faces:ft,resize:ti,_reglType:"framebufferCube",destroy:function(){ft.forEach(function(Zt){Zt.destroy()})}})}function ut(){Ce.cur=null,Ce.next=null,Ce.dirty=!0,Ar(Ie).forEach(function(qe){qe.framebuffer=R.createFramebuffer(),$e(qe)})}return r(Ce,{getFramebuffer:function(qe){if(typeof qe=="function"&&qe._reglType==="framebuffer"){var ft=qe._framebuffer;if(ft instanceof wt)return ft}return null},create:De,createCube:Mt,clear:function(){Ar(Ie).forEach(Ht)},restore:ut})}var wc=5126,sl=34962,Oo=34963,ol=["attributes","elements","offset","count","primitive","instances"];function da(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=wc,this.offset=0,this.stride=0,this.divisor=0}function bc(R,N,V,ye,Le,ve,Ce){for(var Ge=V.maxAttributes,He=new Array(Ge),tt=0;tt<Ge;++tt)He[tt]=new da;var rt=0,it={},ct={Record:da,scope:{},state:He,currentVAO:null,targetVAO:null,restore:Ze()?gt:function(){},createVAO:Ht,getVAO:be,destroyBuffer:We,setVAO:Ze()?Ye:Ct,clear:Ze()?Ie:function(){}};function We($e){for(var De=0;De<He.length;++De){var Mt=He[De];Mt.buffer===$e&&(R.disableVertexAttribArray(De),Mt.buffer=null)}}function Ze(){return N.oes_vertex_array_object}function le(){return N.angle_instanced_arrays}function be($e){return typeof $e=="function"&&$e._vao?$e._vao:null}function Ye($e){if($e!==ct.currentVAO){var De=Ze();$e?De.bindVertexArrayOES($e.vao):De.bindVertexArrayOES(null),ct.currentVAO=$e}}function Ct($e){if($e!==ct.currentVAO){if($e)$e.bindAttrs();else{for(var De=le(),Mt=0;Mt<He.length;++Mt){var ut=He[Mt];ut.buffer?(R.enableVertexAttribArray(Mt),ut.buffer.bind(),R.vertexAttribPointer(Mt,ut.size,ut.type,ut.normalized,ut.stride,ut.offfset),De&&ut.divisor&&De.vertexAttribDivisorANGLE(Mt,ut.divisor)):(R.disableVertexAttribArray(Mt),R.vertexAttrib4f(Mt,ut.x,ut.y,ut.z,ut.w))}Ce.elements?R.bindBuffer(Oo,Ce.elements.buffer.buffer):R.bindBuffer(Oo,null)}ct.currentVAO=$e}}function Ie(){Ar(it).forEach(function($e){$e.destroy()})}function wt(){this.id=++rt,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var $e=Ze();$e?this.vao=$e.createVertexArrayOES():this.vao=null,it[this.id]=this,this.buffers=[]}wt.prototype.bindAttrs=function(){for(var $e=le(),De=this.attributes,Mt=0;Mt<De.length;++Mt){var ut=De[Mt];ut.buffer?(R.enableVertexAttribArray(Mt),R.bindBuffer(sl,ut.buffer.buffer),R.vertexAttribPointer(Mt,ut.size,ut.type,ut.normalized,ut.stride,ut.offset),$e&&ut.divisor&&$e.vertexAttribDivisorANGLE(Mt,ut.divisor)):(R.disableVertexAttribArray(Mt),R.vertexAttrib4f(Mt,ut.x,ut.y,ut.z,ut.w))}for(var qe=De.length;qe<Ge;++qe)R.disableVertexAttribArray(qe);var ft=ve.getElements(this.elements);ft?R.bindBuffer(Oo,ft.buffer.buffer):R.bindBuffer(Oo,null)},wt.prototype.refresh=function(){var $e=Ze();$e&&($e.bindVertexArrayOES(this.vao),this.bindAttrs(),ct.currentVAO=null,$e.bindVertexArrayOES(null))},wt.prototype.destroy=function(){if(this.vao){var $e=Ze();this===ct.currentVAO&&(ct.currentVAO=null,$e.bindVertexArrayOES(null)),$e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),it[this.id]&&(delete it[this.id],ye.vaoCount-=1)};function gt(){var $e=Ze();$e&&Ar(it).forEach(function(De){De.refresh()})}function Ht($e){var De=new wt;ye.vaoCount+=1;function Mt(ut){var qe;if(Array.isArray(ut))qe=ut,De.elements&&De.ownsElements&&De.elements.destroy(),De.elements=null,De.ownsElements=!1,De.offset=0,De.count=0,De.instances=-1,De.primitive=4;else{if(P(typeof ut=="object","invalid arguments for create vao"),P("attributes"in ut,"must specify attributes for vao"),ut.elements){var ft=ut.elements;De.ownsElements?typeof ft=="function"&&ft._reglType==="elements"?(De.elements.destroy(),De.ownsElements=!1):(De.elements(ft),De.ownsElements=!1):ve.getElements(ut.elements)?(De.elements=ut.elements,De.ownsElements=!1):(De.elements=ve.create(ut.elements),De.ownsElements=!0)}else De.elements=null,De.ownsElements=!1;qe=ut.attributes,De.offset=0,De.count=-1,De.instances=-1,De.primitive=4,De.elements&&(De.count=De.elements._elements.vertCount,De.primitive=De.elements._elements.primType),"offset"in ut&&(De.offset=ut.offset|0),"count"in ut&&(De.count=ut.count|0),"instances"in ut&&(De.instances=ut.instances|0),"primitive"in ut&&(P(ut.primitive in M,"bad primitive type: "+ut.primitive),De.primitive=M[ut.primitive]),P.optional(()=>{for(var Ji=Object.keys(ut),ir=0;ir<Ji.length;++ir)P(ol.indexOf(Ji[ir])>=0,'invalid option for vao: "'+Ji[ir]+'" valid options are '+ol)}),P(Array.isArray(qe),"attributes must be an array")}P(qe.length<Ge,"too many attributes"),P(qe.length>0,"must specify at least one attribute");var pt={},ti=De.attributes;ti.length=qe.length;for(var Zt=0;Zt<qe.length;++Zt){var vt=qe[Zt],bt=ti[Zt]=new da,qt=vt.data||vt;if(Array.isArray(qt)||t(qt)||$r(qt)){var ii;De.buffers[Zt]&&(ii=De.buffers[Zt],t(qt)&&ii._buffer.byteLength>=qt.byteLength?ii.subdata(qt):(ii.destroy(),De.buffers[Zt]=null)),De.buffers[Zt]||(ii=De.buffers[Zt]=Le.create(vt,sl,!1,!0)),bt.buffer=Le.getBuffer(ii),bt.size=bt.buffer.dimension|0,bt.normalized=!1,bt.type=bt.buffer.dtype,bt.offset=0,bt.stride=0,bt.divisor=0,bt.state=1,pt[Zt]=1}else Le.getBuffer(vt)?(bt.buffer=Le.getBuffer(vt),bt.size=bt.buffer.dimension|0,bt.normalized=!1,bt.type=bt.buffer.dtype,bt.offset=0,bt.stride=0,bt.divisor=0,bt.state=1):Le.getBuffer(vt.buffer)?(bt.buffer=Le.getBuffer(vt.buffer),bt.size=(+vt.size||bt.buffer.dimension)|0,bt.normalized=!!vt.normalized||!1,"type"in vt?(P.parameter(vt.type,qi,"invalid buffer type"),bt.type=qi[vt.type]):bt.type=bt.buffer.dtype,bt.offset=(vt.offset||0)|0,bt.stride=(vt.stride||0)|0,bt.divisor=(vt.divisor||0)|0,bt.state=1,P(bt.size>=1&&bt.size<=4,"size must be between 1 and 4"),P(bt.offset>=0,"invalid offset"),P(bt.stride>=0&&bt.stride<=255,"stride must be between 0 and 255"),P(bt.divisor>=0,"divisor must be positive"),P(!bt.divisor||!!N.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in vt?(P(Zt>0,"first attribute must not be a constant"),bt.x=+vt.x||0,bt.y=+vt.y||0,bt.z=+vt.z||0,bt.w=+vt.w||0,bt.state=2):P(!1,"invalid attribute spec for location "+Zt)}for(var hi=0;hi<De.buffers.length;++hi)!pt[hi]&&De.buffers[hi]&&(De.buffers[hi].destroy(),De.buffers[hi]=null);return De.refresh(),Mt}return Mt.destroy=function(){for(var ut=0;ut<De.buffers.length;++ut)De.buffers[ut]&&De.buffers[ut].destroy();De.buffers.length=0,De.ownsElements&&(De.elements.destroy(),De.elements=null,De.ownsElements=!1),De.destroy()},Mt._vao=De,Mt._reglType="vao",Mt($e)}return ct}var al=35632,xc=35633,Cc=35718,Sc=35721;function Ec(R,N,V,ye){var Le={},ve={};function Ce(le,be,Ye,Ct){this.name=le,this.id=be,this.location=Ye,this.info=Ct}function Ge(le,be){for(var Ye=0;Ye<le.length;++Ye)if(le[Ye].id===be.id){le[Ye].location=be.location;return}le.push(be)}function He(le,be,Ye){var Ct=le===al?Le:ve,Ie=Ct[be];if(!Ie){var wt=N.str(be);Ie=R.createShader(le),R.shaderSource(Ie,wt),R.compileShader(Ie),P.shaderError(R,Ie,wt,le,Ye),Ct[be]=Ie}return Ie}var tt={},rt=[],it=0;function ct(le,be){this.id=it++,this.fragId=le,this.vertId=be,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ye.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function We(le,be,Ye){var Ct,Ie,wt=He(al,le.fragId),gt=He(xc,le.vertId),Ht=le.program=R.createProgram();if(R.attachShader(Ht,wt),R.attachShader(Ht,gt),Ye)for(Ct=0;Ct<Ye.length;++Ct){var $e=Ye[Ct];R.bindAttribLocation(Ht,$e[0],$e[1])}R.linkProgram(Ht),P.linkError(R,Ht,N.str(le.fragId),N.str(le.vertId),be);var De=R.getProgramParameter(Ht,Cc);ye.profile&&(le.stats.uniformsCount=De);var Mt=le.uniforms;for(Ct=0;Ct<De;++Ct)if(Ie=R.getActiveUniform(Ht,Ct),Ie){if(Ie.size>1)for(var ut=0;ut<Ie.size;++ut){var qe=Ie.name.replace("[0]","["+ut+"]");Ge(Mt,new Ce(qe,N.id(qe),R.getUniformLocation(Ht,qe),Ie))}var ft=Ie.name;Ie.size>1&&(ft=ft.replace("[0]","")),Ge(Mt,new Ce(ft,N.id(ft),R.getUniformLocation(Ht,ft),Ie))}var pt=R.getProgramParameter(Ht,Sc);ye.profile&&(le.stats.attributesCount=pt);var ti=le.attributes;for(Ct=0;Ct<pt;++Ct)Ie=R.getActiveAttrib(Ht,Ct),Ie&&Ge(ti,new Ce(Ie.name,N.id(Ie.name),R.getAttribLocation(Ht,Ie.name),Ie))}ye.profile&&(V.getMaxUniformsCount=function(){var le=0;return rt.forEach(function(be){be.stats.uniformsCount>le&&(le=be.stats.uniformsCount)}),le},V.getMaxAttributesCount=function(){var le=0;return rt.forEach(function(be){be.stats.attributesCount>le&&(le=be.stats.attributesCount)}),le});function Ze(){Le={},ve={};for(var le=0;le<rt.length;++le)We(rt[le],null,rt[le].attributes.map(function(be){return[be.location,be.name]}))}return{clear:function(){var le=R.deleteShader.bind(R);Ar(Le).forEach(le),Le={},Ar(ve).forEach(le),ve={},rt.forEach(function(be){R.deleteProgram(be.program)}),rt.length=0,tt={},V.shaderCount=0},program:function(le,be,Ye,Ct){P.command(le>=0,"missing vertex shader",Ye),P.command(be>=0,"missing fragment shader",Ye);var Ie=tt[be];Ie||(Ie=tt[be]={});var wt=Ie[le];if(wt&&(wt.refCount++,!Ct))return wt;var gt=new ct(be,le);return V.shaderCount++,We(gt,Ye,Ct),wt||(Ie[le]=gt),rt.push(gt),r(gt,{destroy:function(){if(gt.refCount--,gt.refCount<=0){R.deleteProgram(gt.program);var Ht=rt.indexOf(gt);rt.splice(Ht,1),V.shaderCount--}Ie[gt.vertId].refCount<=0&&(R.deleteShader(ve[gt.vertId]),delete ve[gt.vertId],delete tt[gt.fragId][gt.vertId]),Object.keys(tt[gt.fragId]).length||(R.deleteShader(Le[gt.fragId]),delete Le[gt.fragId],delete tt[gt.fragId])}})},restore:Ze,shader:He,frag:-1,vert:-1}}var Rc=6408,vo=5121,Ac=3333,Bo=5126;function Tc(R,N,V,ye,Le,ve,Ce){function Ge(rt){var it;N.next===null?(P(Le.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),it=vo):(P(N.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),it=N.next.colorAttachments[0].texture._texture.type,P.optional(function(){ve.oes_texture_float?(P(it===vo||it===Bo,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),it===Bo&&P(Ce.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):P(it===vo,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ct=0,We=0,Ze=ye.framebufferWidth,le=ye.framebufferHeight,be=null;t(rt)?be=rt:rt&&(P.type(rt,"object","invalid arguments to regl.read()"),ct=rt.x|0,We=rt.y|0,P(ct>=0&&ct<ye.framebufferWidth,"invalid x offset for regl.read"),P(We>=0&&We<ye.framebufferHeight,"invalid y offset for regl.read"),Ze=(rt.width||ye.framebufferWidth-ct)|0,le=(rt.height||ye.framebufferHeight-We)|0,be=rt.data||null),be&&(it===vo?P(be instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):it===Bo&&P(be instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),P(Ze>0&&Ze+ct<=ye.framebufferWidth,"invalid width for read pixels"),P(le>0&&le+We<=ye.framebufferHeight,"invalid height for read pixels"),V();var Ye=Ze*le*4;return be||(it===vo?be=new Uint8Array(Ye):it===Bo&&(be=be||new Float32Array(Ye))),P.isTypedArray(be,"data buffer for regl.read() must be a typedarray"),P(be.byteLength>=Ye,"data buffer for regl.read() too small"),R.pixelStorei(Ac,4),R.readPixels(ct,We,Ze,le,Rc,it,be),be}function He(rt){var it;return N.setFBO({framebuffer:rt.framebuffer},function(){it=Ge(rt)}),it}function tt(rt){return!rt||!("framebuffer"in rt)?Ge(rt):He(rt)}return tt}function Ws(R){return Array.prototype.slice.call(R)}function Vs(R){return Ws(R).join("")}function kc(){var R=0,N=[],V=[];function ye(it){for(var ct=0;ct<V.length;++ct)if(V[ct]===it)return N[ct];var We="g"+R++;return N.push(We),V.push(it),We}function Le(){var it=[];function ct(){it.push.apply(it,Ws(arguments))}var We=[];function Ze(){var le="v"+R++;return We.push(le),arguments.length>0&&(it.push(le,"="),it.push.apply(it,Ws(arguments)),it.push(";")),le}return r(ct,{def:Ze,toString:function(){return Vs([We.length>0?"var "+We.join(",")+";":"",Vs(it)])}})}function ve(){var it=Le(),ct=Le(),We=it.toString,Ze=ct.toString;function le(be,Ye){ct(be,Ye,"=",it.def(be,Ye),";")}return r(function(){it.apply(it,Ws(arguments))},{def:it.def,entry:it,exit:ct,save:le,set:function(be,Ye,Ct){le(be,Ye),it(be,Ye,"=",Ct,";")},toString:function(){return We()+Ze()}})}function Ce(){var it=Vs(arguments),ct=ve(),We=ve(),Ze=ct.toString,le=We.toString;return r(ct,{then:function(){return ct.apply(ct,Ws(arguments)),this},else:function(){return We.apply(We,Ws(arguments)),this},toString:function(){var be=le();return be&&(be="else{"+be+"}"),Vs(["if(",it,"){",Ze(),"}",be])}})}var Ge=Le(),He={};function tt(it,ct){var We=[];function Ze(){var Ie="a"+We.length;return We.push(Ie),Ie}ct=ct||0;for(var le=0;le<ct;++le)Ze();var be=ve(),Ye=be.toString,Ct=He[it]=r(be,{arg:Ze,toString:function(){return Vs(["function(",We.join(),"){",Ye(),"}"])}});return Ct}function rt(){var it=['"use strict";',Ge,"return {"];Object.keys(He).forEach(function(Ze){it.push('"',Ze,'":',He[Ze].toString(),",")}),it.push("}");var ct=Vs(it).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),We=Function.apply(null,N.concat(ct));return We.apply(null,V)}return{global:Ge,link:ye,block:Le,proc:tt,scope:ve,cond:Ce,compile:rt}}var Us="xyzw".split(""),ll=5121,js=1,ha=2,pa=0,ma=1,ga=2,va=3,Ho=4,cl=5,ul=6,fl="dither",dl="blend.enable",hl="blend.color",ya="blend.equation",_a="blend.func",pl="depth.enable",ml="depth.func",gl="depth.range",vl="depth.mask",wa="colorMask",yl="cull.enable",_l="cull.face",ba="frontFace",xa="lineWidth",wl="polygonOffset.enable",Ca="polygonOffset.offset",bl="sample.alpha",xl="sample.enable",Sa="sample.coverage",Cl="stencil.enable",Sl="stencil.mask",Ea="stencil.func",Ra="stencil.opFront",yo="stencil.opBack",El="scissor.enable",Go="scissor.box",Mn="viewport",_o="profile",ys="framebuffer",wo="vert",bo="frag",_s="elements",ws="primitive",bs="count",Wo="offset",Vo="instances",xo="vao",Aa="Width",Ta="Height",qs=ys+Aa,Xs=ys+Ta,Dc=Mn+Aa,Lc=Mn+Ta,Rl="drawingBuffer",Al=Rl+Aa,Tl=Rl+Ta,Mc=[_a,ya,Ea,Ra,yo,Sa,Mn,Go,Ca],Ys=34962,ka=34963,$c=35632,Fc=35633,kl=3553,Pc=34067,Nc=2884,zc=3042,Ic=3024,Oc=2960,Bc=2929,Hc=3089,Gc=32823,Wc=32926,Vc=32928,Da=5126,Uo=35664,jo=35665,qo=35666,La=5124,Xo=35667,Yo=35668,Ko=35669,Ma=35670,Qo=35671,Zo=35672,Jo=35673,Co=35674,So=35675,Eo=35676,Ro=35678,Ao=35680,$a=4,To=1028,xs=1029,Dl=2304,Fa=2305,Uc=32775,jc=32776,qc=519,Xn=7680,Ll=0,Ml=1,$l=32774,Xc=513,Fl=36160,Yc=36064,wn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Pl=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ks={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Yn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Nl={frag:$c,vert:Fc},Pa={cw:Dl,ccw:Fa};function ea(R){return Array.isArray(R)||t(R)||$r(R)}function zl(R){return R.sort(function(N,V){return N===Mn?-1:V===Mn?1:N<V?-1:1})}function Sr(R,N,V,ye){this.thisDep=R,this.contextDep=N,this.propDep=V,this.append=ye}function Kn(R){return R&&!(R.thisDep||R.contextDep||R.propDep)}function mr(R){return new Sr(!1,!1,!1,R)}function Ir(R,N){var V=R.type;if(V===pa){var ye=R.data.length;return new Sr(!0,ye>=1,ye>=2,N)}else if(V===Ho){var Le=R.data;return new Sr(Le.thisDep,Le.contextDep,Le.propDep,N)}else{if(V===cl)return new Sr(!1,!1,!1,N);if(V===ul){for(var ve=!1,Ce=!1,Ge=!1,He=0;He<R.data.length;++He){var tt=R.data[He];if(tt.type===ma)Ge=!0;else if(tt.type===ga)Ce=!0;else if(tt.type===va)ve=!0;else if(tt.type===pa){ve=!0;var rt=tt.data;rt>=1&&(Ce=!0),rt>=2&&(Ge=!0)}else tt.type===Ho&&(ve=ve||tt.data.thisDep,Ce=Ce||tt.data.contextDep,Ge=Ge||tt.data.propDep)}return new Sr(ve,Ce,Ge,N)}else return new Sr(V===va,V===ga,V===ma,N)}}var Il=new Sr(!1,!1,!1,function(){});function Kc(R,N,V,ye,Le,ve,Ce,Ge,He,tt,rt,it,ct,We,Ze){var le=tt.Record,be={add:32774,subtract:32778,"reverse subtract":32779};V.ext_blend_minmax&&(be.min=Uc,be.max=jc);var Ye=V.angle_instanced_arrays,Ct=V.webgl_draw_buffers,Ie=V.oes_vertex_array_object,wt={dirty:!0,profile:Ze.profile},gt={},Ht=[],$e={},De={};function Mt(I){return I.replace(".","_")}function ut(I,F,j){var ae=Mt(I);Ht.push(I),gt[ae]=wt[ae]=!!j,$e[ae]=F}function qe(I,F,j){var ae=Mt(I);Ht.push(I),Array.isArray(j)?(wt[ae]=j.slice(),gt[ae]=j.slice()):wt[ae]=gt[ae]=j,De[ae]=F}ut(fl,Ic),ut(dl,zc),qe(hl,"blendColor",[0,0,0,0]),qe(ya,"blendEquationSeparate",[$l,$l]),qe(_a,"blendFuncSeparate",[Ml,Ll,Ml,Ll]),ut(pl,Bc,!0),qe(ml,"depthFunc",Xc),qe(gl,"depthRange",[0,1]),qe(vl,"depthMask",!0),qe(wa,wa,[!0,!0,!0,!0]),ut(yl,Nc),qe(_l,"cullFace",xs),qe(ba,ba,Fa),qe(xa,xa,1),ut(wl,Gc),qe(Ca,"polygonOffset",[0,0]),ut(bl,Wc),ut(xl,Vc),qe(Sa,"sampleCoverage",[1,!1]),ut(Cl,Oc),qe(Sl,"stencilMask",-1),qe(Ea,"stencilFunc",[qc,0,-1]),qe(Ra,"stencilOpSeparate",[To,Xn,Xn,Xn]),qe(yo,"stencilOpSeparate",[xs,Xn,Xn,Xn]),ut(El,Hc),qe(Go,"scissor",[0,0,R.drawingBufferWidth,R.drawingBufferHeight]),qe(Mn,Mn,[0,0,R.drawingBufferWidth,R.drawingBufferHeight]);var ft={gl:R,context:ct,strings:N,next:gt,current:wt,draw:it,elements:ve,buffer:Le,shader:rt,attributes:tt.state,vao:tt,uniforms:He,framebuffer:Ge,extensions:V,timer:We,isBufferArgs:ea},pt={primTypes:M,compareFuncs:Ks,blendFuncs:wn,blendEquations:be,stencilOps:Yn,glTypes:qi,orientationType:Pa};P.optional(function(){ft.isArrayLike=ci}),Ct&&(pt.backBuffer=[xs],pt.drawBuffer=or(ye.maxDrawbuffers,function(I){return I===0?[0]:or(I,function(F){return Yc+F})}));var ti=0;function Zt(){var I=kc(),F=I.link,j=I.global;I.id=ti++,I.batchId="0";var ae=F(ft),ce=I.shared={props:"a0"};Object.keys(ft).forEach(function(W){ce[W]=j.def(ae,".",W)}),P.optional(function(){I.CHECK=F(P),I.commandStr=P.guessCommand(),I.command=F(I.commandStr),I.assert=function(W,H,pe){W("if(!(",H,"))",this.CHECK,".commandRaise(",F(pe),",",this.command,");")},pt.invalidBlendCombinations=Pl});var te=I.next={},J=I.current={};Object.keys(De).forEach(function(W){Array.isArray(wt[W])&&(te[W]=j.def(ce.next,".",W),J[W]=j.def(ce.current,".",W))});var se=I.constants={};Object.keys(pt).forEach(function(W){se[W]=j.def(JSON.stringify(pt[W]))}),I.invoke=function(W,H){switch(H.type){case pa:var pe=["this",ce.context,ce.props,I.batchId];return W.def(F(H.data),".call(",pe.slice(0,Math.max(H.data.length+1,4)),")");case ma:return W.def(ce.props,H.data);case ga:return W.def(ce.context,H.data);case va:return W.def("this",H.data);case Ho:return H.data.append(I,W),H.data.ref;case cl:return H.data.toString();case ul:return H.data.map(function(fe){return I.invoke(W,fe)})}},I.attribCache={};var B={};return I.scopeAttrib=function(W){var H=N.id(W);if(H in B)return B[H];var pe=tt.scope[H];pe||(pe=tt.scope[H]=new le);var fe=B[H]=F(pe);return fe},I}function vt(I){var F=I.static,j=I.dynamic,ae;if(_o in F){var ce=!!F[_o];ae=mr(function(J,se){return ce}),ae.enable=ce}else if(_o in j){var te=j[_o];ae=Ir(te,function(J,se){return J.invoke(se,te)})}return ae}function bt(I,F){var j=I.static,ae=I.dynamic;if(ys in j){var ce=j[ys];return ce?(ce=Ge.getFramebuffer(ce),P.command(ce,"invalid framebuffer object"),mr(function(J,se){var B=J.link(ce),W=J.shared;se.set(W.framebuffer,".next",B);var H=W.context;return se.set(H,"."+qs,B+".width"),se.set(H,"."+Xs,B+".height"),B})):mr(function(J,se){var B=J.shared;se.set(B.framebuffer,".next","null");var W=B.context;return se.set(W,"."+qs,W+"."+Al),se.set(W,"."+Xs,W+"."+Tl),"null"})}else if(ys in ae){var te=ae[ys];return Ir(te,function(J,se){var B=J.invoke(se,te),W=J.shared,H=W.framebuffer,pe=se.def(H,".getFramebuffer(",B,")");P.optional(function(){J.assert(se,"!"+B+"||"+pe,"invalid framebuffer object")}),se.set(H,".next",pe);var fe=W.context;return se.set(fe,"."+qs,pe+"?"+pe+".width:"+fe+"."+Al),se.set(fe,"."+Xs,pe+"?"+pe+".height:"+fe+"."+Tl),pe})}else return null}function qt(I,F,j){var ae=I.static,ce=I.dynamic;function te(B){if(B in ae){var W=ae[B];P.commandType(W,"object","invalid "+B,j.commandStr);var H=!0,pe=W.x|0,fe=W.y|0,Ae,Fe;return"width"in W?(Ae=W.width|0,P.command(Ae>=0,"invalid "+B,j.commandStr)):H=!1,"height"in W?(Fe=W.height|0,P.command(Fe>=0,"invalid "+B,j.commandStr)):H=!1,new Sr(!H&&F&&F.thisDep,!H&&F&&F.contextDep,!H&&F&&F.propDep,function(Bt,Tt){var Ne=Bt.shared.context,Ee=Ae;"width"in W||(Ee=Tt.def(Ne,".",qs,"-",pe));var zt=Fe;return"height"in W||(zt=Tt.def(Ne,".",Xs,"-",fe)),[pe,fe,Ee,zt]})}else if(B in ce){var lt=ce[B],Kt=Ir(lt,function(Bt,Tt){var Ne=Bt.invoke(Tt,lt);P.optional(function(){Bt.assert(Tt,Ne+"&&typeof "+Ne+'==="object"',"invalid "+B)});var Ee=Bt.shared.context,zt=Tt.def(Ne,".x|0"),Pt=Tt.def(Ne,".y|0"),Xt=Tt.def('"width" in ',Ne,"?",Ne,".width|0:","(",Ee,".",qs,"-",zt,")"),Mi=Tt.def('"height" in ',Ne,"?",Ne,".height|0:","(",Ee,".",Xs,"-",Pt,")");return P.optional(function(){Bt.assert(Tt,Xt+">=0&&"+Mi+">=0","invalid "+B)}),[zt,Pt,Xt,Mi]});return F&&(Kt.thisDep=Kt.thisDep||F.thisDep,Kt.contextDep=Kt.contextDep||F.contextDep,Kt.propDep=Kt.propDep||F.propDep),Kt}else return F?new Sr(F.thisDep,F.contextDep,F.propDep,function(Bt,Tt){var Ne=Bt.shared.context;return[0,0,Tt.def(Ne,".",qs),Tt.def(Ne,".",Xs)]}):null}var J=te(Mn);if(J){var se=J;J=new Sr(J.thisDep,J.contextDep,J.propDep,function(B,W){var H=se.append(B,W),pe=B.shared.context;return W.set(pe,"."+Dc,H[2]),W.set(pe,"."+Lc,H[3]),H})}return{viewport:J,scissor_box:te(Go)}}function ii(I,F){var j=I.static,ae=typeof j[bo]=="string"&&typeof j[wo]=="string";if(ae){if(Object.keys(F.dynamic).length>0)return null;var ce=F.static,te=Object.keys(ce);if(te.length>0&&typeof ce[te[0]]=="number"){for(var J=[],se=0;se<te.length;++se)P(typeof ce[te[se]]=="number","must specify all vertex attribute locations when using vaos"),J.push([ce[te[se]]|0,te[se]]);return J}}return null}function hi(I,F,j){var ae=I.static,ce=I.dynamic;function te(H){if(H in ae){var pe=N.id(ae[H]);P.optional(function(){rt.shader(Nl[H],pe,P.guessCommand())});var fe=mr(function(){return pe});return fe.id=pe,fe}else if(H in ce){var Ae=ce[H];return Ir(Ae,function(Fe,lt){var Kt=Fe.invoke(lt,Ae),Bt=lt.def(Fe.shared.strings,".id(",Kt,")");return P.optional(function(){lt(Fe.shared.shader,".shader(",Nl[H],",",Bt,",",Fe.command,");")}),Bt})}return null}var J=te(bo),se=te(wo),B=null,W;return Kn(J)&&Kn(se)?(B=rt.program(se.id,J.id,null,j),W=mr(function(H,pe){return H.link(B)})):W=new Sr(J&&J.thisDep||se&&se.thisDep,J&&J.contextDep||se&&se.contextDep,J&&J.propDep||se&&se.propDep,function(H,pe){var fe=H.shared.shader,Ae;J?Ae=J.append(H,pe):Ae=pe.def(fe,".",bo);var Fe;se?Fe=se.append(H,pe):Fe=pe.def(fe,".",wo);var lt=fe+".program("+Fe+","+Ae;return P.optional(function(){lt+=","+H.command}),pe.def(lt+")")}),{frag:J,vert:se,progVar:W,program:B}}function Ji(I,F){var j=I.static,ae=I.dynamic,ce={},te=!1;function J(){if(xo in j){var Tt=j[xo];return Tt!==null&&tt.getVAO(Tt)===null&&(Tt=tt.createVAO(Tt)),te=!0,ce.vao=Tt,mr(function(Ee){var zt=tt.getVAO(Tt);return zt?Ee.link(zt):"null"})}else if(xo in ae){te=!0;var Ne=ae[xo];return Ir(Ne,function(Ee,zt){var Pt=Ee.invoke(zt,Ne);return zt.def(Ee.shared.vao+".getVAO("+Pt+")")})}return null}var se=J(),B=!1;function W(){if(_s in j){var Tt=j[_s];if(ce.elements=Tt,ea(Tt)){var Ne=ce.elements=ve.create(Tt,!0);Tt=ve.getElements(Ne),B=!0}else Tt&&(Tt=ve.getElements(Tt),B=!0,P.command(Tt,"invalid elements",F.commandStr));var Ee=mr(function(Pt,Xt){if(Tt){var Mi=Pt.link(Tt);return Pt.ELEMENTS=Mi,Mi}return Pt.ELEMENTS=null,null});return Ee.value=Tt,Ee}else if(_s in ae){B=!0;var zt=ae[_s];return Ir(zt,function(Pt,Xt){var Mi=Pt.shared,Lr=Mi.isBufferArgs,Ss=Mi.elements,$n=Pt.invoke(Xt,zt),xn=Xt.def("null"),Qn=Xt.def(Lr,"(",$n,")"),Es=Pt.cond(Qn).then(xn,"=",Ss,".createStream(",$n,");").else(xn,"=",Ss,".getElements(",$n,");");return P.optional(function(){Pt.assert(Es.else,"!"+$n+"||"+xn,"invalid elements")}),Xt.entry(Es),Xt.exit(Pt.cond(Qn).then(Ss,".destroyStream(",xn,");")),Pt.ELEMENTS=xn,xn})}else if(te)return new Sr(se.thisDep,se.contextDep,se.propDep,function(Pt,Xt){return Xt.def(Pt.shared.vao+".currentVAO?"+Pt.shared.elements+".getElements("+Pt.shared.vao+".currentVAO.elements):null")});return null}var H=W();function pe(){if(ws in j){var Tt=j[ws];return ce.primitive=Tt,P.commandParameter(Tt,M,"invalid primitve",F.commandStr),mr(function(Ee,zt){return M[Tt]})}else if(ws in ae){var Ne=ae[ws];return Ir(Ne,function(Ee,zt){var Pt=Ee.constants.primTypes,Xt=Ee.invoke(zt,Ne);return P.optional(function(){Ee.assert(zt,Xt+" in "+Pt,"invalid primitive, must be one of "+Object.keys(M))}),zt.def(Pt,"[",Xt,"]")})}else{if(B)return Kn(H)?H.value?mr(function(Ee,zt){return zt.def(Ee.ELEMENTS,".primType")}):mr(function(){return $a}):new Sr(H.thisDep,H.contextDep,H.propDep,function(Ee,zt){var Pt=Ee.ELEMENTS;return zt.def(Pt,"?",Pt,".primType:",$a)});if(te)return new Sr(se.thisDep,se.contextDep,se.propDep,function(Ee,zt){return zt.def(Ee.shared.vao+".currentVAO?"+Ee.shared.vao+".currentVAO.primitive:"+$a)})}return null}function fe(Tt,Ne){if(Tt in j){var Ee=j[Tt]|0;return Ne?ce.offset=Ee:ce.instances=Ee,P.command(!Ne||Ee>=0,"invalid "+Tt,F.commandStr),mr(function(Pt,Xt){return Ne&&(Pt.OFFSET=Ee),Ee})}else if(Tt in ae){var zt=ae[Tt];return Ir(zt,function(Pt,Xt){var Mi=Pt.invoke(Xt,zt);return Ne&&(Pt.OFFSET=Mi,P.optional(function(){Pt.assert(Xt,Mi+">=0","invalid "+Tt)})),Mi})}else if(Ne){if(B)return mr(function(Pt,Xt){return Pt.OFFSET=0,0});if(te)return new Sr(se.thisDep,se.contextDep,se.propDep,function(Pt,Xt){return Xt.def(Pt.shared.vao+".currentVAO?"+Pt.shared.vao+".currentVAO.offset:0")})}else if(te)return new Sr(se.thisDep,se.contextDep,se.propDep,function(Pt,Xt){return Xt.def(Pt.shared.vao+".currentVAO?"+Pt.shared.vao+".currentVAO.instances:-1")});return null}var Ae=fe(Wo,!0);function Fe(){if(bs in j){var Tt=j[bs]|0;return ce.count=Tt,P.command(typeof Tt=="number"&&Tt>=0,"invalid vertex count",F.commandStr),mr(function(){return Tt})}else if(bs in ae){var Ne=ae[bs];return Ir(Ne,function(Xt,Mi){var Lr=Xt.invoke(Mi,Ne);return P.optional(function(){Xt.assert(Mi,"typeof "+Lr+'==="number"&&'+Lr+">=0&&"+Lr+"===("+Lr+"|0)","invalid vertex count")}),Lr})}else if(B)if(Kn(H)){if(H)return Ae?new Sr(Ae.thisDep,Ae.contextDep,Ae.propDep,function(Xt,Mi){var Lr=Mi.def(Xt.ELEMENTS,".vertCount-",Xt.OFFSET);return P.optional(function(){Xt.assert(Mi,Lr+">=0","invalid vertex offset/element buffer too small")}),Lr}):mr(function(Xt,Mi){return Mi.def(Xt.ELEMENTS,".vertCount")});var Ee=mr(function(){return-1});return P.optional(function(){Ee.MISSING=!0}),Ee}else{var zt=new Sr(H.thisDep||Ae.thisDep,H.contextDep||Ae.contextDep,H.propDep||Ae.propDep,function(Xt,Mi){var Lr=Xt.ELEMENTS;return Xt.OFFSET?Mi.def(Lr,"?",Lr,".vertCount-",Xt.OFFSET,":-1"):Mi.def(Lr,"?",Lr,".vertCount:-1")});return P.optional(function(){zt.DYNAMIC=!0}),zt}else if(te){var Pt=new Sr(se.thisDep,se.contextDep,se.propDep,function(Xt,Mi){return Mi.def(Xt.shared.vao,".currentVAO?",Xt.shared.vao,".currentVAO.count:-1")});return Pt}return null}var lt=pe(),Kt=Fe(),Bt=fe(Vo,!1);return{elements:H,primitive:lt,count:Kt,instances:Bt,offset:Ae,vao:se,vaoActive:te,elementsActive:B,static:ce}}function ir(I,F){var j=I.static,ae=I.dynamic,ce={};return Ht.forEach(function(te){var J=Mt(te);function se(B,W){if(te in j){var H=B(j[te]);ce[J]=mr(function(){return H})}else if(te in ae){var pe=ae[te];ce[J]=Ir(pe,function(fe,Ae){return W(fe,Ae,fe.invoke(Ae,pe))})}}switch(te){case yl:case dl:case fl:case Cl:case pl:case El:case wl:case bl:case xl:case vl:return se(function(B){return P.commandType(B,"boolean",te,F.commandStr),B},function(B,W,H){return P.optional(function(){B.assert(W,"typeof "+H+'==="boolean"',"invalid flag "+te,B.commandStr)}),H});case ml:return se(function(B){return P.commandParameter(B,Ks,"invalid "+te,F.commandStr),Ks[B]},function(B,W,H){var pe=B.constants.compareFuncs;return P.optional(function(){B.assert(W,H+" in "+pe,"invalid "+te+", must be one of "+Object.keys(Ks))}),W.def(pe,"[",H,"]")});case gl:return se(function(B){return P.command(ci(B)&&B.length===2&&typeof B[0]=="number"&&typeof B[1]=="number"&&B[0]<=B[1],"depth range is 2d array",F.commandStr),B},function(B,W,H){P.optional(function(){B.assert(W,B.shared.isArrayLike+"("+H+")&&"+H+".length===2&&typeof "+H+'[0]==="number"&&typeof '+H+'[1]==="number"&&'+H+"[0]<="+H+"[1]","depth range must be a 2d array")});var pe=W.def("+",H,"[0]"),fe=W.def("+",H,"[1]");return[pe,fe]});case _a:return se(function(B){P.commandType(B,"object","blend.func",F.commandStr);var W="srcRGB"in B?B.srcRGB:B.src,H="srcAlpha"in B?B.srcAlpha:B.src,pe="dstRGB"in B?B.dstRGB:B.dst,fe="dstAlpha"in B?B.dstAlpha:B.dst;return P.commandParameter(W,wn,J+".srcRGB",F.commandStr),P.commandParameter(H,wn,J+".srcAlpha",F.commandStr),P.commandParameter(pe,wn,J+".dstRGB",F.commandStr),P.commandParameter(fe,wn,J+".dstAlpha",F.commandStr),P.command(Pl.indexOf(W+", "+pe)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+W+", "+pe+")",F.commandStr),[wn[W],wn[pe],wn[H],wn[fe]]},function(B,W,H){var pe=B.constants.blendFuncs;P.optional(function(){B.assert(W,H+"&&typeof "+H+'==="object"',"invalid blend func, must be an object")});function fe(Ne,Ee){var zt=W.def('"',Ne,Ee,'" in ',H,"?",H,".",Ne,Ee,":",H,".",Ne);return P.optional(function(){B.assert(W,zt+" in "+pe,"invalid "+te+"."+Ne+Ee+", must be one of "+Object.keys(wn))}),zt}var Ae=fe("src","RGB"),Fe=fe("dst","RGB");P.optional(function(){var Ne=B.constants.invalidBlendCombinations;B.assert(W,Ne+".indexOf("+Ae+'+", "+'+Fe+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var lt=W.def(pe,"[",Ae,"]"),Kt=W.def(pe,"[",fe("src","Alpha"),"]"),Bt=W.def(pe,"[",Fe,"]"),Tt=W.def(pe,"[",fe("dst","Alpha"),"]");return[lt,Bt,Kt,Tt]});case ya:return se(function(B){if(typeof B=="string")return P.commandParameter(B,be,"invalid "+te,F.commandStr),[be[B],be[B]];if(typeof B=="object")return P.commandParameter(B.rgb,be,te+".rgb",F.commandStr),P.commandParameter(B.alpha,be,te+".alpha",F.commandStr),[be[B.rgb],be[B.alpha]];P.commandRaise("invalid blend.equation",F.commandStr)},function(B,W,H){var pe=B.constants.blendEquations,fe=W.def(),Ae=W.def(),Fe=B.cond("typeof ",H,'==="string"');return P.optional(function(){function lt(Kt,Bt,Tt){B.assert(Kt,Tt+" in "+pe,"invalid "+Bt+", must be one of "+Object.keys(be))}lt(Fe.then,te,H),B.assert(Fe.else,H+"&&typeof "+H+'==="object"',"invalid "+te),lt(Fe.else,te+".rgb",H+".rgb"),lt(Fe.else,te+".alpha",H+".alpha")}),Fe.then(fe,"=",Ae,"=",pe,"[",H,"];"),Fe.else(fe,"=",pe,"[",H,".rgb];",Ae,"=",pe,"[",H,".alpha];"),W(Fe),[fe,Ae]});case hl:return se(function(B){return P.command(ci(B)&&B.length===4,"blend.color must be a 4d array",F.commandStr),or(4,function(W){return+B[W]})},function(B,W,H){return P.optional(function(){B.assert(W,B.shared.isArrayLike+"("+H+")&&"+H+".length===4","blend.color must be a 4d array")}),or(4,function(pe){return W.def("+",H,"[",pe,"]")})});case Sl:return se(function(B){return P.commandType(B,"number",J,F.commandStr),B|0},function(B,W,H){return P.optional(function(){B.assert(W,"typeof "+H+'==="number"',"invalid stencil.mask")}),W.def(H,"|0")});case Ea:return se(function(B){P.commandType(B,"object",J,F.commandStr);var W=B.cmp||"keep",H=B.ref||0,pe="mask"in B?B.mask:-1;return P.commandParameter(W,Ks,te+".cmp",F.commandStr),P.commandType(H,"number",te+".ref",F.commandStr),P.commandType(pe,"number",te+".mask",F.commandStr),[Ks[W],H,pe]},function(B,W,H){var pe=B.constants.compareFuncs;P.optional(function(){function lt(){B.assert(W,Array.prototype.join.call(arguments,""),"invalid stencil.func")}lt(H+"&&typeof ",H,'==="object"'),lt('!("cmp" in ',H,")||(",H,".cmp in ",pe,")")});var fe=W.def('"cmp" in ',H,"?",pe,"[",H,".cmp]",":",Xn),Ae=W.def(H,".ref|0"),Fe=W.def('"mask" in ',H,"?",H,".mask|0:-1");return[fe,Ae,Fe]});case Ra:case yo:return se(function(B){P.commandType(B,"object",J,F.commandStr);var W=B.fail||"keep",H=B.zfail||"keep",pe=B.zpass||"keep";return P.commandParameter(W,Yn,te+".fail",F.commandStr),P.commandParameter(H,Yn,te+".zfail",F.commandStr),P.commandParameter(pe,Yn,te+".zpass",F.commandStr),[te===yo?xs:To,Yn[W],Yn[H],Yn[pe]]},function(B,W,H){var pe=B.constants.stencilOps;P.optional(function(){B.assert(W,H+"&&typeof "+H+'==="object"',"invalid "+te)});function fe(Ae){return P.optional(function(){B.assert(W,'!("'+Ae+'" in '+H+")||("+H+"."+Ae+" in "+pe+")","invalid "+te+"."+Ae+", must be one of "+Object.keys(Yn))}),W.def('"',Ae,'" in ',H,"?",pe,"[",H,".",Ae,"]:",Xn)}return[te===yo?xs:To,fe("fail"),fe("zfail"),fe("zpass")]});case Ca:return se(function(B){P.commandType(B,"object",J,F.commandStr);var W=B.factor|0,H=B.units|0;return P.commandType(W,"number",J+".factor",F.commandStr),P.commandType(H,"number",J+".units",F.commandStr),[W,H]},function(B,W,H){P.optional(function(){B.assert(W,H+"&&typeof "+H+'==="object"',"invalid "+te)});var pe=W.def(H,".factor|0"),fe=W.def(H,".units|0");return[pe,fe]});case _l:return se(function(B){var W=0;return B==="front"?W=To:B==="back"&&(W=xs),P.command(!!W,J,F.commandStr),W},function(B,W,H){return P.optional(function(){B.assert(W,H+'==="front"||'+H+'==="back"',"invalid cull.face")}),W.def(H,'==="front"?',To,":",xs)});case xa:return se(function(B){return P.command(typeof B=="number"&&B>=ye.lineWidthDims[0]&&B<=ye.lineWidthDims[1],"invalid line width, must be a positive number between "+ye.lineWidthDims[0]+" and "+ye.lineWidthDims[1],F.commandStr),B},function(B,W,H){return P.optional(function(){B.assert(W,"typeof "+H+'==="number"&&'+H+">="+ye.lineWidthDims[0]+"&&"+H+"<="+ye.lineWidthDims[1],"invalid line width")}),H});case ba:return se(function(B){return P.commandParameter(B,Pa,J,F.commandStr),Pa[B]},function(B,W,H){return P.optional(function(){B.assert(W,H+'==="cw"||'+H+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),W.def(H+'==="cw"?'+Dl+":"+Fa)});case wa:return se(function(B){return P.command(ci(B)&&B.length===4,"color.mask must be length 4 array",F.commandStr),B.map(function(W){return!!W})},function(B,W,H){return P.optional(function(){B.assert(W,B.shared.isArrayLike+"("+H+")&&"+H+".length===4","invalid color.mask")}),or(4,function(pe){return"!!"+H+"["+pe+"]"})});case Sa:return se(function(B){P.command(typeof B=="object"&&B,J,F.commandStr);var W="value"in B?B.value:1,H=!!B.invert;return P.command(typeof W=="number"&&W>=0&&W<=1,"sample.coverage.value must be a number between 0 and 1",F.commandStr),[W,H]},function(B,W,H){P.optional(function(){B.assert(W,H+"&&typeof "+H+'==="object"',"invalid sample.coverage")});var pe=W.def('"value" in ',H,"?+",H,".value:1"),fe=W.def("!!",H,".invert");return[pe,fe]})}}),ce}function gi(I,F){var j=I.static,ae=I.dynamic,ce={};return Object.keys(j).forEach(function(te){var J=j[te],se;if(typeof J=="number"||typeof J=="boolean")se=mr(function(){return J});else if(typeof J=="function"){var B=J._reglType;B==="texture2d"||B==="textureCube"?se=mr(function(W){return W.link(J)}):B==="framebuffer"||B==="framebufferCube"?(P.command(J.color.length>0,'missing color attachment for framebuffer sent to uniform "'+te+'"',F.commandStr),se=mr(function(W){return W.link(J.color[0])})):P.commandRaise('invalid data for uniform "'+te+'"',F.commandStr)}else ci(J)?se=mr(function(W){var H=W.global.def("[",or(J.length,function(pe){return P.command(typeof J[pe]=="number"||typeof J[pe]=="boolean","invalid uniform "+te,W.commandStr),J[pe]}),"]");return H}):P.commandRaise('invalid or missing data for uniform "'+te+'"',F.commandStr);se.value=J,ce[te]=se}),Object.keys(ae).forEach(function(te){var J=ae[te];ce[te]=Ir(J,function(se,B){return se.invoke(B,J)})}),ce}function wr(I,F){var j=I.static,ae=I.dynamic,ce={};return Object.keys(j).forEach(function(te){var J=j[te],se=N.id(te),B=new le;if(ea(J))B.state=js,B.buffer=Le.getBuffer(Le.create(J,Ys,!1,!0)),B.type=0;else{var W=Le.getBuffer(J);if(W)B.state=js,B.buffer=W,B.type=0;else if(P.command(typeof J=="object"&&J,"invalid data for attribute "+te,F.commandStr),"constant"in J){var H=J.constant;B.buffer="null",B.state=ha,typeof H=="number"?B.x=H:(P.command(ci(H)&&H.length>0&&H.length<=4,"invalid constant for attribute "+te,F.commandStr),Us.forEach(function(Bt,Tt){Tt<H.length&&(B[Bt]=H[Tt])}))}else{ea(J.buffer)?W=Le.getBuffer(Le.create(J.buffer,Ys,!1,!0)):W=Le.getBuffer(J.buffer),P.command(!!W,'missing buffer for attribute "'+te+'"',F.commandStr);var pe=J.offset|0;P.command(pe>=0,'invalid offset for attribute "'+te+'"',F.commandStr);var fe=J.stride|0;P.command(fe>=0&&fe<256,'invalid stride for attribute "'+te+'", must be integer betweeen [0, 255]',F.commandStr);var Ae=J.size|0;P.command(!("size"in J)||Ae>0&&Ae<=4,'invalid size for attribute "'+te+'", must be 1,2,3,4',F.commandStr);var Fe=!!J.normalized,lt=0;"type"in J&&(P.commandParameter(J.type,qi,"invalid type for attribute "+te,F.commandStr),lt=qi[J.type]);var Kt=J.divisor|0;P.optional(function(){"divisor"in J&&(P.command(Kt===0||Ye,'cannot specify divisor for attribute "'+te+'", instancing not supported',F.commandStr),P.command(Kt>=0,'invalid divisor for attribute "'+te+'"',F.commandStr));var Bt=F.commandStr,Tt=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(J).forEach(function(Ne){P.command(Tt.indexOf(Ne)>=0,'unknown parameter "'+Ne+'" for attribute pointer "'+te+'" (valid parameters are '+Tt+")",Bt)})}),B.buffer=W,B.state=js,B.size=Ae,B.normalized=Fe,B.type=lt||W.dtype,B.offset=pe,B.stride=fe,B.divisor=Kt}}ce[te]=mr(function(Bt,Tt){var Ne=Bt.attribCache;if(se in Ne)return Ne[se];var Ee={isStream:!1};return Object.keys(B).forEach(function(zt){Ee[zt]=B[zt]}),B.buffer&&(Ee.buffer=Bt.link(B.buffer),Ee.type=Ee.type||Ee.buffer+".dtype"),Ne[se]=Ee,Ee})}),Object.keys(ae).forEach(function(te){var J=ae[te];function se(B,W){var H=B.invoke(W,J),pe=B.shared,fe=B.constants,Ae=pe.isBufferArgs,Fe=pe.buffer;P.optional(function(){B.assert(W,H+"&&(typeof "+H+'==="object"||typeof '+H+'==="function")&&('+Ae+"("+H+")||"+Fe+".getBuffer("+H+")||"+Fe+".getBuffer("+H+".buffer)||"+Ae+"("+H+'.buffer)||("constant" in '+H+"&&(typeof "+H+'.constant==="number"||'+pe.isArrayLike+"("+H+".constant))))",'invalid dynamic attribute "'+te+'"')});var lt={isStream:W.def(!1)},Kt=new le;Kt.state=js,Object.keys(Kt).forEach(function(Ee){lt[Ee]=W.def(""+Kt[Ee])});var Bt=lt.buffer,Tt=lt.type;W("if(",Ae,"(",H,")){",lt.isStream,"=true;",Bt,"=",Fe,".createStream(",Ys,",",H,");",Tt,"=",Bt,".dtype;","}else{",Bt,"=",Fe,".getBuffer(",H,");","if(",Bt,"){",Tt,"=",Bt,".dtype;",'}else if("constant" in ',H,"){",lt.state,"=",ha,";","if(typeof "+H+'.constant === "number"){',lt[Us[0]],"=",H,".constant;",Us.slice(1).map(function(Ee){return lt[Ee]}).join("="),"=0;","}else{",Us.map(function(Ee,zt){return lt[Ee]+"="+H+".constant.length>"+zt+"?"+H+".constant["+zt+"]:0;"}).join(""),"}}else{","if(",Ae,"(",H,".buffer)){",Bt,"=",Fe,".createStream(",Ys,",",H,".buffer);","}else{",Bt,"=",Fe,".getBuffer(",H,".buffer);","}",Tt,'="type" in ',H,"?",fe.glTypes,"[",H,".type]:",Bt,".dtype;",lt.normalized,"=!!",H,".normalized;");function Ne(Ee){W(lt[Ee],"=",H,".",Ee,"|0;")}return Ne("size"),Ne("offset"),Ne("stride"),Ne("divisor"),W("}}"),W.exit("if(",lt.isStream,"){",Fe,".destroyStream(",Bt,");","}"),lt}ce[te]=Ir(J,se)}),ce}function Xi(I){var F=I.static,j=I.dynamic,ae={};return Object.keys(F).forEach(function(ce){var te=F[ce];ae[ce]=mr(function(J,se){return typeof te=="number"||typeof te=="boolean"?""+te:J.link(te)})}),Object.keys(j).forEach(function(ce){var te=j[ce];ae[ce]=Ir(te,function(J,se){return J.invoke(se,te)})}),ae}function gr(I,F,j,ae,ce){var te=I.static,J=I.dynamic;P.optional(function(){var Ne=[ys,wo,bo,_s,ws,Wo,bs,Vo,_o,xo].concat(Ht);function Ee(zt){Object.keys(zt).forEach(function(Pt){P.command(Ne.indexOf(Pt)>=0,'unknown parameter "'+Pt+'"',ce.commandStr)})}Ee(te),Ee(J)});var se=ii(I,F),B=bt(I),W=qt(I,B,ce),H=Ji(I,ce),pe=ir(I,ce),fe=hi(I,ce,se);function Ae(Ne){var Ee=W[Ne];Ee&&(pe[Ne]=Ee)}Ae(Mn),Ae(Mt(Go));var Fe=Object.keys(pe).length>0,lt={framebuffer:B,draw:H,shader:fe,state:pe,dirty:Fe,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(lt.profile=vt(I),lt.uniforms=gi(j,ce),lt.drawVAO=lt.scopeVAO=H.vao,!lt.drawVAO&&fe.program&&!se&&V.angle_instanced_arrays&&H.static.elements){var Kt=!0,Bt=fe.program.attributes.map(function(Ne){var Ee=F.static[Ne];return Kt=Kt&&!!Ee,Ee});if(Kt&&Bt.length>0){var Tt=tt.getVAO(tt.createVAO({attributes:Bt,elements:H.static.elements}));lt.drawVAO=new Sr(null,null,null,function(Ne,Ee){return Ne.link(Tt)}),lt.useVAO=!0}}return se?lt.useVAO=!0:lt.attributes=wr(F,ce),lt.context=Xi(ae),lt}function br(I,F,j){var ae=I.shared,ce=ae.context,te=I.scope();Object.keys(j).forEach(function(J){F.save(ce,"."+J);var se=j[J],B=se.append(I,F);Array.isArray(B)?te(ce,".",J,"=[",B.join(),"];"):te(ce,".",J,"=",B,";")}),F(te)}function xr(I,F,j,ae){var ce=I.shared,te=ce.gl,J=ce.framebuffer,se;Ct&&(se=F.def(ce.extensions,".webgl_draw_buffers"));var B=I.constants,W=B.drawBuffer,H=B.backBuffer,pe;j?pe=j.append(I,F):pe=F.def(J,".next"),ae||F("if(",pe,"!==",J,".cur){"),F("if(",pe,"){",te,".bindFramebuffer(",Fl,",",pe,".framebuffer);"),Ct&&F(se,".drawBuffersWEBGL(",W,"[",pe,".colorAttachments.length]);"),F("}else{",te,".bindFramebuffer(",Fl,",null);"),Ct&&F(se,".drawBuffersWEBGL(",H,");"),F("}",J,".cur=",pe,";"),ae||F("}")}function Er(I,F,j){var ae=I.shared,ce=ae.gl,te=I.current,J=I.next,se=ae.current,B=ae.next,W=I.cond(se,".dirty");Ht.forEach(function(H){var pe=Mt(H);if(!(pe in j.state)){var fe,Ae;if(pe in J){fe=J[pe],Ae=te[pe];var Fe=or(wt[pe].length,function(Kt){return W.def(fe,"[",Kt,"]")});W(I.cond(Fe.map(function(Kt,Bt){return Kt+"!=="+Ae+"["+Bt+"]"}).join("||")).then(ce,".",De[pe],"(",Fe,");",Fe.map(function(Kt,Bt){return Ae+"["+Bt+"]="+Kt}).join(";"),";"))}else{fe=W.def(B,".",pe);var lt=I.cond(fe,"!==",se,".",pe);W(lt),pe in $e?lt(I.cond(fe).then(ce,".enable(",$e[pe],");").else(ce,".disable(",$e[pe],");"),se,".",pe,"=",fe,";"):lt(ce,".",De[pe],"(",fe,");",se,".",pe,"=",fe,";")}}}),Object.keys(j.state).length===0&&W(se,".dirty=false;"),F(W)}function kr(I,F,j,ae){var ce=I.shared,te=I.current,J=ce.current,se=ce.gl;zl(Object.keys(j)).forEach(function(B){var W=j[B];if(!(ae&&!ae(W))){var H=W.append(I,F);if($e[B]){var pe=$e[B];Kn(W)?H?F(se,".enable(",pe,");"):F(se,".disable(",pe,");"):F(I.cond(H).then(se,".enable(",pe,");").else(se,".disable(",pe,");")),F(J,".",B,"=",H,";")}else if(ci(H)){var fe=te[B];F(se,".",De[B],"(",H,");",H.map(function(Ae,Fe){return fe+"["+Fe+"]="+Ae}).join(";"),";")}else F(se,".",De[B],"(",H,");",J,".",B,"=",H,";")}})}function cr(I,F){Ye&&(I.instancing=F.def(I.shared.extensions,".angle_instanced_arrays"))}function ui(I,F,j,ae,ce){var te=I.shared,J=I.stats,se=te.current,B=te.timer,W=j.profile;function H(){return typeof performance>"u"?"Date.now()":"performance.now()"}var pe,fe;function Ae(Ne){pe=F.def(),Ne(pe,"=",H(),";"),typeof ce=="string"?Ne(J,".count+=",ce,";"):Ne(J,".count++;"),We&&(ae?(fe=F.def(),Ne(fe,"=",B,".getNumPendingQueries();")):Ne(B,".beginQuery(",J,");"))}function Fe(Ne){Ne(J,".cpuTime+=",H(),"-",pe,";"),We&&(ae?Ne(B,".pushScopeStats(",fe,",",B,".getNumPendingQueries(),",J,");"):Ne(B,".endQuery();"))}function lt(Ne){var Ee=F.def(se,".profile");F(se,".profile=",Ne,";"),F.exit(se,".profile=",Ee,";")}var Kt;if(W){if(Kn(W)){W.enable?(Ae(F),Fe(F.exit),lt("true")):lt("false");return}Kt=W.append(I,F),lt(Kt)}else Kt=F.def(se,".profile");var Bt=I.block();Ae(Bt),F("if(",Kt,"){",Bt,"}");var Tt=I.block();Fe(Tt),F.exit("if(",Kt,"){",Tt,"}")}function Dr(I,F,j,ae,ce){var te=I.shared;function J(B){switch(B){case Uo:case Xo:case Qo:return 2;case jo:case Yo:case Zo:return 3;case qo:case Ko:case Jo:return 4;default:return 1}}function se(B,W,H){var pe=te.gl,fe=F.def(B,".location"),Ae=F.def(te.attributes,"[",fe,"]"),Fe=H.state,lt=H.buffer,Kt=[H.x,H.y,H.z,H.w],Bt=["buffer","normalized","offset","stride"];function Tt(){F("if(!",Ae,".buffer){",pe,".enableVertexAttribArray(",fe,");}");var Ee=H.type,zt;if(H.size?zt=F.def(H.size,"||",W):zt=W,F("if(",Ae,".type!==",Ee,"||",Ae,".size!==",zt,"||",Bt.map(function(Xt){return Ae+"."+Xt+"!=="+H[Xt]}).join("||"),"){",pe,".bindBuffer(",Ys,",",lt,".buffer);",pe,".vertexAttribPointer(",[fe,zt,Ee,H.normalized,H.stride,H.offset],");",Ae,".type=",Ee,";",Ae,".size=",zt,";",Bt.map(function(Xt){return Ae+"."+Xt+"="+H[Xt]+";"}).join(""),"}"),Ye){var Pt=H.divisor;F("if(",Ae,".divisor!==",Pt,"){",I.instancing,".vertexAttribDivisorANGLE(",[fe,Pt],");",Ae,".divisor=",Pt,";}")}}function Ne(){F("if(",Ae,".buffer){",pe,".disableVertexAttribArray(",fe,");",Ae,".buffer=null;","}if(",Us.map(function(Ee,zt){return Ae+"."+Ee+"!=="+Kt[zt]}).join("||"),"){",pe,".vertexAttrib4f(",fe,",",Kt,");",Us.map(function(Ee,zt){return Ae+"."+Ee+"="+Kt[zt]+";"}).join(""),"}")}Fe===js?Tt():Fe===ha?Ne():(F("if(",Fe,"===",js,"){"),Tt(),F("}else{"),Ne(),F("}"))}ae.forEach(function(B){var W=B.name,H=j.attributes[W],pe;if(H){if(!ce(H))return;pe=H.append(I,F)}else{if(!ce(Il))return;var fe=I.scopeAttrib(W);P.optional(function(){I.assert(F,fe+".state","missing attribute "+W)}),pe={},Object.keys(new le).forEach(function(Ae){pe[Ae]=F.def(fe,".",Ae)})}se(I.link(B),J(B.info.type),pe)})}function Li(I,F,j,ae,ce,te){for(var J=I.shared,se=J.gl,B={},W,H=0;H<ae.length;++H){var pe=ae[H],fe=pe.name,Ae=pe.info.type,Fe=pe.info.size,lt=j.uniforms[fe];if(Fe>1){if(!lt)continue;var Kt=fe.replace("[0]","");if(B[Kt])continue;B[Kt]=1}var Bt=I.link(pe),Tt=Bt+".location",Ne;if(lt){if(!ce(lt))continue;if(Kn(lt)){var Ee=lt.value;if(P.command(Ee!==null&&typeof Ee<"u",'missing uniform "'+fe+'"',I.commandStr),Ae===Ro||Ae===Ao){P.command(typeof Ee=="function"&&(Ae===Ro&&(Ee._reglType==="texture2d"||Ee._reglType==="framebuffer")||Ae===Ao&&(Ee._reglType==="textureCube"||Ee._reglType==="framebufferCube")),"invalid texture for uniform "+fe,I.commandStr);var zt=I.link(Ee._texture||Ee.color[0]._texture);F(se,".uniform1i(",Tt,",",zt+".bind());"),F.exit(zt,".unbind();")}else if(Ae===Co||Ae===So||Ae===Eo){P.optional(function(){P.command(ci(Ee),"invalid matrix for uniform "+fe,I.commandStr),P.command(Ae===Co&&Ee.length===4||Ae===So&&Ee.length===9||Ae===Eo&&Ee.length===16,"invalid length for matrix uniform "+fe,I.commandStr)});var Pt=I.global.def("new Float32Array(["+Array.prototype.slice.call(Ee)+"])"),Xt=2;Ae===So?Xt=3:Ae===Eo&&(Xt=4),F(se,".uniformMatrix",Xt,"fv(",Tt,",false,",Pt,");")}else{switch(Ae){case Da:Fe===1?P.commandType(Ee,"number","uniform "+fe,I.commandStr):P.command(ci(Ee)&&Ee.length===Fe,"uniform "+fe,I.commandStr),W="1f";break;case Uo:P.command(ci(Ee)&&Ee.length&&Ee.length%2===0&&Ee.length<=Fe*2,"uniform "+fe,I.commandStr),W="2f";break;case jo:P.command(ci(Ee)&&Ee.length&&Ee.length%3===0&&Ee.length<=Fe*3,"uniform "+fe,I.commandStr),W="3f";break;case qo:P.command(ci(Ee)&&Ee.length&&Ee.length%4===0&&Ee.length<=Fe*4,"uniform "+fe,I.commandStr),W="4f";break;case Ma:Fe===1?P.commandType(Ee,"boolean","uniform "+fe,I.commandStr):P.command(ci(Ee)&&Ee.length===Fe,"uniform "+fe,I.commandStr),W="1i";break;case La:Fe===1?P.commandType(Ee,"number","uniform "+fe,I.commandStr):P.command(ci(Ee)&&Ee.length===Fe,"uniform "+fe,I.commandStr),W="1i";break;case Qo:P.command(ci(Ee)&&Ee.length&&Ee.length%2===0&&Ee.length<=Fe*2,"uniform "+fe,I.commandStr),W="2i";break;case Xo:P.command(ci(Ee)&&Ee.length&&Ee.length%2===0&&Ee.length<=Fe*2,"uniform "+fe,I.commandStr),W="2i";break;case Zo:P.command(ci(Ee)&&Ee.length&&Ee.length%3===0&&Ee.length<=Fe*3,"uniform "+fe,I.commandStr),W="3i";break;case Yo:P.command(ci(Ee)&&Ee.length&&Ee.length%3===0&&Ee.length<=Fe*3,"uniform "+fe,I.commandStr),W="3i";break;case Jo:P.command(ci(Ee)&&Ee.length&&Ee.length%4===0&&Ee.length<=Fe*4,"uniform "+fe,I.commandStr),W="4i";break;case Ko:P.command(ci(Ee)&&Ee.length&&Ee.length%4===0&&Ee.length<=Fe*4,"uniform "+fe,I.commandStr),W="4i";break}Fe>1?(W+="v",Ee=I.global.def("["+Array.prototype.slice.call(Ee)+"]")):Ee=ci(Ee)?Array.prototype.slice.call(Ee):Ee,F(se,".uniform",W,"(",Tt,",",Ee,");")}continue}else Ne=lt.append(I,F)}else{if(!ce(Il))continue;Ne=F.def(J.uniforms,"[",N.id(fe),"]")}Ae===Ro?(P(!Array.isArray(Ne),"must specify a scalar prop for textures"),F("if(",Ne,"&&",Ne,'._reglType==="framebuffer"){',Ne,"=",Ne,".color[0];","}")):Ae===Ao&&(P(!Array.isArray(Ne),"must specify a scalar prop for cube maps"),F("if(",Ne,"&&",Ne,'._reglType==="framebufferCube"){',Ne,"=",Ne,".color[0];","}")),P.optional(function(){function Ur(Or,ta){I.assert(F,Or,'bad data or missing for uniform "'+fe+'".  '+ta)}function Rs(Or,ta){ta===1&&P(!Array.isArray(Ne),"must not specify an array type for uniform"),Ur("Array.isArray("+Ne+") && typeof "+Ne+'[0]===" '+Or+'" || typeof '+Ne+'==="'+Or+'"',"invalid type, expected "+Or)}function rn(Or,ta,ia){Array.isArray(Ne)?P(Ne.length&&Ne.length%Or===0&&Ne.length<=Or*ia,"must have length of "+(ia===1?"":"n * ")+Or):Ur(J.isArrayLike+"("+Ne+")&&"+Ne+".length && "+Ne+".length % "+Or+" === 0 && "+Ne+".length<="+Or*ia,"invalid vector, should have length of "+(ia===1?"":"n * ")+Or,I.commandStr)}function Ul(Or){P(!Array.isArray(Ne),"must not specify a value type"),Ur("typeof "+Ne+'==="function"&&'+Ne+'._reglType==="texture'+(Or===kl?"2d":"Cube")+'"',"invalid texture type",I.commandStr)}switch(Ae){case La:Rs("number",Fe);break;case Xo:rn(2,"number",Fe);break;case Yo:rn(3,"number",Fe);break;case Ko:rn(4,"number",Fe);break;case Da:Rs("number",Fe);break;case Uo:rn(2,"number",Fe);break;case jo:rn(3,"number",Fe);break;case qo:rn(4,"number",Fe);break;case Ma:Rs("boolean",Fe);break;case Qo:rn(2,"boolean",Fe);break;case Zo:rn(3,"boolean",Fe);break;case Jo:rn(4,"boolean",Fe);break;case Co:rn(4,"number",Fe);break;case So:rn(9,"number",Fe);break;case Eo:rn(16,"number",Fe);break;case Ro:Ul(kl);break;case Ao:Ul(Pc);break}});var Mi=1;switch(Ae){case Ro:case Ao:var Lr=F.def(Ne,"._texture");F(se,".uniform1i(",Tt,",",Lr,".bind());"),F.exit(Lr,".unbind();");continue;case La:case Ma:W="1i";break;case Xo:case Qo:W="2i",Mi=2;break;case Yo:case Zo:W="3i",Mi=3;break;case Ko:case Jo:W="4i",Mi=4;break;case Da:W="1f";break;case Uo:W="2f",Mi=2;break;case jo:W="3f",Mi=3;break;case qo:W="4f",Mi=4;break;case Co:W="Matrix2fv";break;case So:W="Matrix3fv";break;case Eo:W="Matrix4fv";break}if(W.indexOf("Matrix")===-1&&Fe>1&&(W+="v",Mi=1),W.charAt(0)==="M"){F(se,".uniform",W,"(",Tt,",");var Ss=Math.pow(Ae-Co+2,2),$n=I.global.def("new Float32Array(",Ss,")");Array.isArray(Ne)?F("false,(",or(Ss,function(Ur){return $n+"["+Ur+"]="+Ne[Ur]}),",",$n,")"):F("false,(Array.isArray(",Ne,")||",Ne," instanceof Float32Array)?",Ne,":(",or(Ss,function(Ur){return $n+"["+Ur+"]="+Ne+"["+Ur+"]"}),",",$n,")"),F(");")}else if(Mi>1){for(var xn=[],Qn=[],Es=0;Es<Mi;++Es)Array.isArray(Ne)?Qn.push(Ne[Es]):Qn.push(F.def(Ne+"["+Es+"]")),te&&xn.push(F.def());te&&F("if(!",I.batchId,"||",xn.map(function(Ur,Rs){return Ur+"!=="+Qn[Rs]}).join("||"),"){",xn.map(function(Ur,Rs){return Ur+"="+Qn[Rs]+";"}).join("")),F(se,".uniform",W,"(",Tt,",",Qn.join(","),");"),te&&F("}")}else{if(P(!Array.isArray(Ne),"uniform value must not be an array"),te){var Vl=F.def();F("if(!",I.batchId,"||",Vl,"!==",Ne,"){",Vl,"=",Ne,";")}F(se,".uniform",W,"(",Tt,",",Ne,");"),te&&F("}")}}}function Wt(I,F,j,ae){var ce=I.shared,te=ce.gl,J=ce.draw,se=ae.draw;function B(){var zt=se.elements,Pt,Xt=F;return zt?((zt.contextDep&&ae.contextDynamic||zt.propDep)&&(Xt=j),Pt=zt.append(I,Xt),se.elementsActive&&Xt("if("+Pt+")"+te+".bindBuffer("+ka+","+Pt+".buffer.buffer);")):(Pt=Xt.def(),Xt(Pt,"=",J,".",_s,";","if(",Pt,"){",te,".bindBuffer(",ka,",",Pt,".buffer.buffer);}","else if(",ce.vao,".currentVAO){",Pt,"=",I.shared.elements+".getElements("+ce.vao,".currentVAO.elements);",Ie?"":"if("+Pt+")"+te+".bindBuffer("+ka+","+Pt+".buffer.buffer);","}")),Pt}function W(){var zt=se.count,Pt,Xt=F;return zt?((zt.contextDep&&ae.contextDynamic||zt.propDep)&&(Xt=j),Pt=zt.append(I,Xt),P.optional(function(){zt.MISSING&&I.assert(F,"false","missing vertex count"),zt.DYNAMIC&&I.assert(Xt,Pt+">=0","missing vertex count")})):(Pt=Xt.def(J,".",bs),P.optional(function(){I.assert(Xt,Pt+">=0","missing vertex count")})),Pt}var H=B();function pe(zt){var Pt=se[zt];return Pt?Pt.contextDep&&ae.contextDynamic||Pt.propDep?Pt.append(I,j):Pt.append(I,F):F.def(J,".",zt)}var fe=pe(ws),Ae=pe(Wo),Fe=W();if(typeof Fe=="number"){if(Fe===0)return}else j("if(",Fe,"){"),j.exit("}");var lt,Kt;Ye&&(lt=pe(Vo),Kt=I.instancing);var Bt=H+".type",Tt=se.elements&&Kn(se.elements)&&!se.vaoActive;function Ne(){function zt(){j(Kt,".drawElementsInstancedANGLE(",[fe,Fe,Bt,Ae+"<<(("+Bt+"-"+ll+")>>1)",lt],");")}function Pt(){j(Kt,".drawArraysInstancedANGLE(",[fe,Ae,Fe,lt],");")}H&&H!=="null"?Tt?zt():(j("if(",H,"){"),zt(),j("}else{"),Pt(),j("}")):Pt()}function Ee(){function zt(){j(te+".drawElements("+[fe,Fe,Bt,Ae+"<<(("+Bt+"-"+ll+")>>1)"]+");")}function Pt(){j(te+".drawArrays("+[fe,Ae,Fe]+");")}H&&H!=="null"?Tt?zt():(j("if(",H,"){"),zt(),j("}else{"),Pt(),j("}")):Pt()}Ye&&(typeof lt!="number"||lt>=0)?typeof lt=="string"?(j("if(",lt,">0){"),Ne(),j("}else if(",lt,"<0){"),Ee(),j("}")):Ne():Ee()}function mi(I,F,j,ae,ce){var te=Zt(),J=te.proc("body",ce);return P.optional(function(){te.commandStr=F.commandStr,te.command=te.link(F.commandStr)}),Ye&&(te.instancing=J.def(te.shared.extensions,".angle_instanced_arrays")),I(te,J,j,ae),te.compile().body}function Si(I,F,j,ae){cr(I,F),j.useVAO?j.drawVAO?F(I.shared.vao,".setVAO(",j.drawVAO.append(I,F),");"):F(I.shared.vao,".setVAO(",I.shared.vao,".targetVAO);"):(F(I.shared.vao,".setVAO(null);"),Dr(I,F,j,ae.attributes,function(){return!0})),Li(I,F,j,ae.uniforms,function(){return!0},!1),Wt(I,F,F,j)}function ur(I,F){var j=I.proc("draw",1);cr(I,j),br(I,j,F.context),xr(I,j,F.framebuffer),Er(I,j,F),kr(I,j,F.state),ui(I,j,F,!1,!0);var ae=F.shader.progVar.append(I,j);if(j(I.shared.gl,".useProgram(",ae,".program);"),F.shader.program)Si(I,j,F,F.shader.program);else{j(I.shared.vao,".setVAO(null);");var ce=I.global.def("{}"),te=j.def(ae,".id"),J=j.def(ce,"[",te,"]");j(I.cond(J).then(J,".call(this,a0);").else(J,"=",ce,"[",te,"]=",I.link(function(se){return mi(Si,I,F,se,1)}),"(",ae,");",J,".call(this,a0);"))}Object.keys(F.state).length>0&&j(I.shared.current,".dirty=true;"),I.shared.vao&&j(I.shared.vao,".setVAO(null);")}function bn(I,F,j,ae){I.batchId="a1",cr(I,F);function ce(){return!0}Dr(I,F,j,ae.attributes,ce),Li(I,F,j,ae.uniforms,ce,!1),Wt(I,F,F,j)}function Cs(I,F,j,ae){cr(I,F);var ce=j.contextDep,te=F.def(),J="a0",se="a1",B=F.def();I.shared.props=B,I.batchId=te;var W=I.scope(),H=I.scope();F(W.entry,"for(",te,"=0;",te,"<",se,";++",te,"){",B,"=",J,"[",te,"];",H,"}",W.exit);function pe(Bt){return Bt.contextDep&&ce||Bt.propDep}function fe(Bt){return!pe(Bt)}if(j.needsContext&&br(I,H,j.context),j.needsFramebuffer&&xr(I,H,j.framebuffer),kr(I,H,j.state,pe),j.profile&&pe(j.profile)&&ui(I,H,j,!1,!0),ae)j.useVAO?j.drawVAO?pe(j.drawVAO)?H(I.shared.vao,".setVAO(",j.drawVAO.append(I,H),");"):W(I.shared.vao,".setVAO(",j.drawVAO.append(I,W),");"):W(I.shared.vao,".setVAO(",I.shared.vao,".targetVAO);"):(W(I.shared.vao,".setVAO(null);"),Dr(I,W,j,ae.attributes,fe),Dr(I,H,j,ae.attributes,pe)),Li(I,W,j,ae.uniforms,fe,!1),Li(I,H,j,ae.uniforms,pe,!0),Wt(I,W,H,j);else{var Ae=I.global.def("{}"),Fe=j.shader.progVar.append(I,H),lt=H.def(Fe,".id"),Kt=H.def(Ae,"[",lt,"]");H(I.shared.gl,".useProgram(",Fe,".program);","if(!",Kt,"){",Kt,"=",Ae,"[",lt,"]=",I.link(function(Bt){return mi(bn,I,j,Bt,2)}),"(",Fe,");}",Kt,".call(this,a0[",te,"],",te,");")}}function G(I,F){var j=I.proc("batch",2);I.batchId="0",cr(I,j);var ae=!1,ce=!0;Object.keys(F.context).forEach(function(Ae){ae=ae||F.context[Ae].propDep}),ae||(br(I,j,F.context),ce=!1);var te=F.framebuffer,J=!1;te?(te.propDep?ae=J=!0:te.contextDep&&ae&&(J=!0),J||xr(I,j,te)):xr(I,j,null),F.state.viewport&&F.state.viewport.propDep&&(ae=!0);function se(Ae){return Ae.contextDep&&ae||Ae.propDep}Er(I,j,F),kr(I,j,F.state,function(Ae){return!se(Ae)}),(!F.profile||!se(F.profile))&&ui(I,j,F,!1,"a1"),F.contextDep=ae,F.needsContext=ce,F.needsFramebuffer=J;var B=F.shader.progVar;if(B.contextDep&&ae||B.propDep)Cs(I,j,F,null);else{var W=B.append(I,j);if(j(I.shared.gl,".useProgram(",W,".program);"),F.shader.program)Cs(I,j,F,F.shader.program);else{j(I.shared.vao,".setVAO(null);");var H=I.global.def("{}"),pe=j.def(W,".id"),fe=j.def(H,"[",pe,"]");j(I.cond(fe).then(fe,".call(this,a0,a1);").else(fe,"=",H,"[",pe,"]=",I.link(function(Ae){return mi(Cs,I,F,Ae,2)}),"(",W,");",fe,".call(this,a0,a1);"))}}Object.keys(F.state).length>0&&j(I.shared.current,".dirty=true;"),I.shared.vao&&j(I.shared.vao,".setVAO(null);")}function _e(I,F){var j=I.proc("scope",3);I.batchId="a2";var ae=I.shared,ce=ae.current;br(I,j,F.context),F.framebuffer&&F.framebuffer.append(I,j),zl(Object.keys(F.state)).forEach(function(J){var se=F.state[J],B=se.append(I,j);ci(B)?B.forEach(function(W,H){j.set(I.next[J],"["+H+"]",W)}):j.set(ae.next,"."+J,B)}),ui(I,j,F,!0,!0),[_s,Wo,bs,Vo,ws].forEach(function(J){var se=F.draw[J];se&&j.set(ae.draw,"."+J,""+se.append(I,j))}),Object.keys(F.uniforms).forEach(function(J){var se=F.uniforms[J].append(I,j);Array.isArray(se)&&(se="["+se.join()+"]"),j.set(ae.uniforms,"["+N.id(J)+"]",se)}),Object.keys(F.attributes).forEach(function(J){var se=F.attributes[J].append(I,j),B=I.scopeAttrib(J);Object.keys(new le).forEach(function(W){j.set(B,"."+W,se[W])})}),F.scopeVAO&&j.set(ae.vao,".targetVAO",F.scopeVAO.append(I,j));function te(J){var se=F.shader[J];se&&j.set(ae.shader,"."+J,se.append(I,j))}te(wo),te(bo),Object.keys(F.state).length>0&&(j(ce,".dirty=true;"),j.exit(ce,".dirty=true;")),j("a1(",I.shared.context,",a0,",I.batchId,");")}function ge(I){if(!(typeof I!="object"||ci(I))){for(var F=Object.keys(I),j=0;j<F.length;++j)if(Jt.isDynamic(I[F[j]]))return!0;return!1}}function Dt(I,F,j){var ae=F.static[j];if(!ae||!ge(ae))return;var ce=I.global,te=Object.keys(ae),J=!1,se=!1,B=!1,W=I.global.def("{}");te.forEach(function(pe){var fe=ae[pe];if(Jt.isDynamic(fe)){typeof fe=="function"&&(fe=ae[pe]=Jt.unbox(fe));var Ae=Ir(fe,null);J=J||Ae.thisDep,B=B||Ae.propDep,se=se||Ae.contextDep}else{switch(ce(W,".",pe,"="),typeof fe){case"number":ce(fe);break;case"string":ce('"',fe,'"');break;case"object":Array.isArray(fe)&&ce("[",fe.join(),"]");break;default:ce(I.link(fe));break}ce(";")}});function H(pe,fe){te.forEach(function(Ae){var Fe=ae[Ae];if(Jt.isDynamic(Fe)){var lt=pe.invoke(fe,Fe);fe(W,".",Ae,"=",lt,";")}})}F.dynamic[j]=new Jt.DynamicVariable(Ho,{thisDep:J,contextDep:se,propDep:B,ref:W,append:H}),delete F.static[j]}function di(I,F,j,ae,ce){var te=Zt();te.stats=te.link(ce),Object.keys(F.static).forEach(function(se){Dt(te,F,se)}),Mc.forEach(function(se){Dt(te,I,se)});var J=gr(I,F,j,ae,te);return ur(te,J),_e(te,J),G(te,J),r(te.compile(),{destroy:function(){J.shader.program.destroy()}})}return{next:gt,current:wt,procs:function(){var I=Zt(),F=I.proc("poll"),j=I.proc("refresh"),ae=I.block();F(ae),j(ae);var ce=I.shared,te=ce.gl,J=ce.next,se=ce.current;ae(se,".dirty=false;"),xr(I,F),xr(I,j,null,!0);var B;Ye&&(B=I.link(Ye)),V.oes_vertex_array_object&&j(I.link(V.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var W=0;W<ye.maxAttributes;++W){var H=j.def(ce.attributes,"[",W,"]"),pe=I.cond(H,".buffer");pe.then(te,".enableVertexAttribArray(",W,");",te,".bindBuffer(",Ys,",",H,".buffer.buffer);",te,".vertexAttribPointer(",W,",",H,".size,",H,".type,",H,".normalized,",H,".stride,",H,".offset);").else(te,".disableVertexAttribArray(",W,");",te,".vertexAttrib4f(",W,",",H,".x,",H,".y,",H,".z,",H,".w);",H,".buffer=null;"),j(pe),Ye&&j(B,".vertexAttribDivisorANGLE(",W,",",H,".divisor);")}return j(I.shared.vao,".currentVAO=null;",I.shared.vao,".setVAO(",I.shared.vao,".targetVAO);"),Object.keys($e).forEach(function(fe){var Ae=$e[fe],Fe=ae.def(J,".",fe),lt=I.block();lt("if(",Fe,"){",te,".enable(",Ae,")}else{",te,".disable(",Ae,")}",se,".",fe,"=",Fe,";"),j(lt),F("if(",Fe,"!==",se,".",fe,"){",lt,"}")}),Object.keys(De).forEach(function(fe){var Ae=De[fe],Fe=wt[fe],lt,Kt,Bt=I.block();if(Bt(te,".",Ae,"("),ci(Fe)){var Tt=Fe.length;lt=I.global.def(J,".",fe),Kt=I.global.def(se,".",fe),Bt(or(Tt,function(Ne){return lt+"["+Ne+"]"}),");",or(Tt,function(Ne){return Kt+"["+Ne+"]="+lt+"["+Ne+"];"}).join("")),F("if(",or(Tt,function(Ne){return lt+"["+Ne+"]!=="+Kt+"["+Ne+"]"}).join("||"),"){",Bt,"}")}else lt=ae.def(J,".",fe),Kt=ae.def(se,".",fe),Bt(lt,");",se,".",fe,"=",lt,";"),F("if(",lt,"!==",Kt,"){",Bt,"}");j(Bt)}),I.compile()}(),compile:di}}function Qc(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Zc=34918,Jc=34919,Ol=35007,eu=function(R,N){if(!N.ext_disjoint_timer_query)return null;var V=[];function ye(){return V.pop()||N.ext_disjoint_timer_query.createQueryEXT()}function Le(Ye){V.push(Ye)}var ve=[];function Ce(Ye){var Ct=ye();N.ext_disjoint_timer_query.beginQueryEXT(Ol,Ct),ve.push(Ct),We(ve.length-1,ve.length,Ye)}function Ge(){N.ext_disjoint_timer_query.endQueryEXT(Ol)}function He(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var tt=[];function rt(){return tt.pop()||new He}function it(Ye){tt.push(Ye)}var ct=[];function We(Ye,Ct,Ie){var wt=rt();wt.startQueryIndex=Ye,wt.endQueryIndex=Ct,wt.sum=0,wt.stats=Ie,ct.push(wt)}var Ze=[],le=[];function be(){var Ye,Ct,Ie=ve.length;if(Ie!==0){le.length=Math.max(le.length,Ie+1),Ze.length=Math.max(Ze.length,Ie+1),Ze[0]=0,le[0]=0;var wt=0;for(Ye=0,Ct=0;Ct<ve.length;++Ct){var gt=ve[Ct];N.ext_disjoint_timer_query.getQueryObjectEXT(gt,Jc)?(wt+=N.ext_disjoint_timer_query.getQueryObjectEXT(gt,Zc),Le(gt)):ve[Ye++]=gt,Ze[Ct+1]=wt,le[Ct+1]=Ye}for(ve.length=Ye,Ye=0,Ct=0;Ct<ct.length;++Ct){var Ht=ct[Ct],$e=Ht.startQueryIndex,De=Ht.endQueryIndex;Ht.sum+=Ze[De]-Ze[$e];var Mt=le[$e],ut=le[De];ut===Mt?(Ht.stats.gpuTime+=Ht.sum/1e6,it(Ht)):(Ht.startQueryIndex=Mt,Ht.endQueryIndex=ut,ct[Ye++]=Ht)}ct.length=Ye}}return{beginQuery:Ce,endQuery:Ge,pushScopeStats:We,update:be,getNumPendingQueries:function(){return ve.length},clear:function(){V.push.apply(V,ve);for(var Ye=0;Ye<V.length;Ye++)N.ext_disjoint_timer_query.deleteQueryEXT(V[Ye]);ve.length=0,V.length=0},restore:function(){ve.length=0,V.length=0}}},tu=16384,iu=256,ru=1024,nu=34962,Bl="webglcontextlost",Hl="webglcontextrestored",Gl=1,su=2,ou=3;function Wl(R,N){for(var V=0;V<R.length;++V)if(R[V]===N)return V;return-1}function au(R){var N=dn(R);if(!N)return null;var V=N.gl,ye=V.getContextAttributes(),Le=V.isContextLost(),ve=hn(V,N);if(!ve)return null;var Ce=Wi(),Ge=Qc(),He=ve.extensions,tt=eu(V,He),rt=Ai(),it=V.drawingBufferWidth,ct=V.drawingBufferHeight,We={tick:0,time:0,viewportWidth:it,viewportHeight:ct,framebufferWidth:it,framebufferHeight:ct,drawingBufferWidth:it,drawingBufferHeight:ct,pixelRatio:N.pixelRatio},Ze={},le={elements:null,primitive:4,count:-1,offset:0,instances:-1},be=Ps(V,He),Ye=ra(V,Ge,N,wt),Ct=Pr(V,He,Ye,Ge),Ie=bc(V,He,be,Ge,Ye,Ct,le);function wt(Wt){return Ie.destroyBuffer(Wt)}var gt=Ec(V,Ce,Ge,N),Ht=Zl(V,He,be,function(){Mt.procs.poll()},We,Ge,N),$e=Jl(V,He,be,Ge,N),De=_c(V,He,be,Ht,$e,Ge),Mt=Kc(V,Ce,He,be,Ye,Ct,Ht,De,Ze,Ie,gt,le,We,tt,N),ut=Tc(V,De,Mt.procs.poll,We,ye,He,be),qe=Mt.next,ft=V.canvas,pt=[],ti=[],Zt=[],vt=[N.onDestroy],bt=null;function qt(){if(pt.length===0){tt&&tt.update(),bt=null;return}bt=xi.next(qt),kr();for(var Wt=pt.length-1;Wt>=0;--Wt){var mi=pt[Wt];mi&&mi(We,null,0)}V.flush(),tt&&tt.update()}function ii(){!bt&&pt.length>0&&(bt=xi.next(qt))}function hi(){bt&&(xi.cancel(qt),bt=null)}function Ji(Wt){Wt.preventDefault(),Le=!0,hi(),ti.forEach(function(mi){mi()})}function ir(Wt){V.getError(),Le=!1,ve.restore(),gt.restore(),Ye.restore(),Ht.restore(),$e.restore(),De.restore(),Ie.restore(),tt&&tt.restore(),Mt.procs.refresh(),ii(),Zt.forEach(function(mi){mi()})}ft&&(ft.addEventListener(Bl,Ji,!1),ft.addEventListener(Hl,ir,!1));function gi(){pt.length=0,hi(),ft&&(ft.removeEventListener(Bl,Ji),ft.removeEventListener(Hl,ir)),gt.clear(),De.clear(),$e.clear(),Ie.clear(),Ht.clear(),Ct.clear(),Ye.clear(),tt&&tt.clear(),vt.forEach(function(Wt){Wt()})}function wr(Wt){P(!!Wt,"invalid args to regl({...})"),P.type(Wt,"object","invalid args to regl({...})");function mi(ce){var te=r({},ce);delete te.uniforms,delete te.attributes,delete te.context,delete te.vao,"stencil"in te&&te.stencil.op&&(te.stencil.opBack=te.stencil.opFront=te.stencil.op,delete te.stencil.op);function J(se){if(se in te){var B=te[se];delete te[se],Object.keys(B).forEach(function(W){te[se+"."+W]=B[W]})}}return J("blend"),J("depth"),J("cull"),J("stencil"),J("polygonOffset"),J("scissor"),J("sample"),"vao"in ce&&(te.vao=ce.vao),te}function Si(ce,te){var J={},se={};return Object.keys(ce).forEach(function(B){var W=ce[B];if(Jt.isDynamic(W)){se[B]=Jt.unbox(W,B);return}else if(te&&Array.isArray(W)){for(var H=0;H<W.length;++H)if(Jt.isDynamic(W[H])){se[B]=Jt.unbox(W,B);return}}J[B]=W}),{dynamic:se,static:J}}var ur=Si(Wt.context||{},!0),bn=Si(Wt.uniforms||{},!0),Cs=Si(Wt.attributes||{},!1),G=Si(mi(Wt),!1),_e={gpuTime:0,cpuTime:0,count:0},ge=Mt.compile(G,Cs,bn,ur,_e),Dt=ge.draw,di=ge.batch,I=ge.scope,F=[];function j(ce){for(;F.length<ce;)F.push(null);return F}function ae(ce,te){var J;if(Le&&P.raise("context lost"),typeof ce=="function")return I.call(this,null,ce,0);if(typeof te=="function")if(typeof ce=="number")for(J=0;J<ce;++J)I.call(this,null,te,J);else if(Array.isArray(ce))for(J=0;J<ce.length;++J)I.call(this,ce[J],te,J);else return I.call(this,ce,te,0);else if(typeof ce=="number"){if(ce>0)return di.call(this,j(ce|0),ce|0)}else if(Array.isArray(ce)){if(ce.length)return di.call(this,ce,ce.length)}else return Dt.call(this,ce)}return r(ae,{stats:_e,destroy:function(){ge.destroy()}})}var Xi=De.setFBO=wr({framebuffer:Jt.define.call(null,Gl,"framebuffer")});function gr(Wt,mi){var Si=0;Mt.procs.poll();var ur=mi.color;ur&&(V.clearColor(+ur[0]||0,+ur[1]||0,+ur[2]||0,+ur[3]||0),Si|=tu),"depth"in mi&&(V.clearDepth(+mi.depth),Si|=iu),"stencil"in mi&&(V.clearStencil(mi.stencil|0),Si|=ru),P(!!Si,"called regl.clear with no buffer specified"),V.clear(Si)}function br(Wt){if(P(typeof Wt=="object"&&Wt,"regl.clear() takes an object as input"),"framebuffer"in Wt)if(Wt.framebuffer&&Wt.framebuffer_reglType==="framebufferCube")for(var mi=0;mi<6;++mi)Xi(r({framebuffer:Wt.framebuffer.faces[mi]},Wt),gr);else Xi(Wt,gr);else gr(null,Wt)}function xr(Wt){P.type(Wt,"function","regl.frame() callback must be a function"),pt.push(Wt);function mi(){var Si=Wl(pt,Wt);P(Si>=0,"cannot cancel a frame twice");function ur(){var bn=Wl(pt,ur);pt[bn]=pt[pt.length-1],pt.length-=1,pt.length<=0&&hi()}pt[Si]=ur}return ii(),{cancel:mi}}function Er(){var Wt=qe.viewport,mi=qe.scissor_box;Wt[0]=Wt[1]=mi[0]=mi[1]=0,We.viewportWidth=We.framebufferWidth=We.drawingBufferWidth=Wt[2]=mi[2]=V.drawingBufferWidth,We.viewportHeight=We.framebufferHeight=We.drawingBufferHeight=Wt[3]=mi[3]=V.drawingBufferHeight}function kr(){We.tick+=1,We.time=ui(),Er(),Mt.procs.poll()}function cr(){Ht.refresh(),Er(),Mt.procs.refresh(),tt&&tt.update()}function ui(){return(Ai()-rt)/1e3}cr();function Dr(Wt,mi){P.type(mi,"function","listener callback must be a function");var Si;switch(Wt){case"frame":return xr(mi);case"lost":Si=ti;break;case"restore":Si=Zt;break;case"destroy":Si=vt;break;default:P.raise("invalid event, must be one of frame,lost,restore,destroy")}return Si.push(mi),{cancel:function(){for(var ur=0;ur<Si.length;++ur)if(Si[ur]===mi){Si[ur]=Si[Si.length-1],Si.pop();return}}}}var Li=r(wr,{clear:br,prop:Jt.define.bind(null,Gl),context:Jt.define.bind(null,su),this:Jt.define.bind(null,ou),draw:wr({}),buffer:function(Wt){return Ye.create(Wt,nu,!1,!1)},elements:function(Wt){return Ct.create(Wt,!1)},texture:Ht.create2D,cube:Ht.createCube,renderbuffer:$e.create,framebuffer:De.create,framebufferCube:De.createCube,vao:Ie.createVAO,attributes:ye,frame:xr,on:Dr,limits:be,hasExtension:function(Wt){return be.extensions.indexOf(Wt.toLowerCase())>=0},read:ut,destroy:gi,_gl:V,_refresh:cr,poll:function(){kr(),tt&&tt.update()},now:ui,stats:Ge});return N.onDone(null,Li),Li}return au})})(regl);var EPSILON=1e-6,ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function identity$2(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function transpose(i,e){if(i===e){var t=e[1],r=e[2],s=e[3],o=e[6],a=e[7],l=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=o,i[11]=e[14],i[12]=s,i[13]=a,i[14]=l}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function invert(i,e){var t=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],p=e[7],d=e[8],m=e[9],g=e[10],w=e[11],E=e[12],A=e[13],k=e[14],O=e[15],ne=t*l-r*a,Q=t*u-s*a,ue=t*p-o*a,U=r*u-s*l,_=r*p-o*l,Se=s*p-o*u,Me=d*A-m*E,Ke=d*k-g*E,kt=d*O-w*E,Qe=m*k-g*A,ze=m*O-w*A,Je=g*O-w*k,St=ne*Je-Q*ze+ue*Qe+U*kt-_*Ke+Se*Me;return St?(St=1/St,i[0]=(l*Je-u*ze+p*Qe)*St,i[1]=(s*ze-r*Je-o*Qe)*St,i[2]=(A*Se-k*_+O*U)*St,i[3]=(g*_-m*Se-w*U)*St,i[4]=(u*kt-a*Je-p*Ke)*St,i[5]=(t*Je-s*kt+o*Ke)*St,i[6]=(k*ue-E*Se-O*Q)*St,i[7]=(d*Se-g*ue+w*Q)*St,i[8]=(a*ze-l*kt+p*Me)*St,i[9]=(r*kt-t*ze-o*Me)*St,i[10]=(E*_-A*ue+O*ne)*St,i[11]=(m*ue-d*_-w*ne)*St,i[12]=(l*Ke-a*Qe-u*Me)*St,i[13]=(t*Qe-r*Ke+s*Me)*St,i[14]=(A*Q-E*U-k*ne)*St,i[15]=(d*U-m*Q+g*ne)*St,i):null}function determinant(i){var e=i[0],t=i[1],r=i[2],s=i[3],o=i[4],a=i[5],l=i[6],u=i[7],p=i[8],d=i[9],m=i[10],g=i[11],w=i[12],E=i[13],A=i[14],k=i[15],O=e*a-t*o,ne=e*l-r*o,Q=e*u-s*o,ue=t*l-r*a,U=t*u-s*a,_=r*u-s*l,Se=p*E-d*w,Me=p*A-m*w,Ke=p*k-g*w,kt=d*A-m*E,Qe=d*k-g*E,ze=m*k-g*A;return O*ze-ne*Qe+Q*kt+ue*Ke-U*Me+_*Se}function multiply(i,e,t){var r=e[0],s=e[1],o=e[2],a=e[3],l=e[4],u=e[5],p=e[6],d=e[7],m=e[8],g=e[9],w=e[10],E=e[11],A=e[12],k=e[13],O=e[14],ne=e[15],Q=t[0],ue=t[1],U=t[2],_=t[3];return i[0]=Q*r+ue*l+U*m+_*A,i[1]=Q*s+ue*u+U*g+_*k,i[2]=Q*o+ue*p+U*w+_*O,i[3]=Q*a+ue*d+U*E+_*ne,Q=t[4],ue=t[5],U=t[6],_=t[7],i[4]=Q*r+ue*l+U*m+_*A,i[5]=Q*s+ue*u+U*g+_*k,i[6]=Q*o+ue*p+U*w+_*O,i[7]=Q*a+ue*d+U*E+_*ne,Q=t[8],ue=t[9],U=t[10],_=t[11],i[8]=Q*r+ue*l+U*m+_*A,i[9]=Q*s+ue*u+U*g+_*k,i[10]=Q*o+ue*p+U*w+_*O,i[11]=Q*a+ue*d+U*E+_*ne,Q=t[12],ue=t[13],U=t[14],_=t[15],i[12]=Q*r+ue*l+U*m+_*A,i[13]=Q*s+ue*u+U*g+_*k,i[14]=Q*o+ue*p+U*w+_*O,i[15]=Q*a+ue*d+U*E+_*ne,i}function translate(i,e,t){var r=t[0],s=t[1],o=t[2],a,l,u,p,d,m,g,w,E,A,k,O;return e===i?(i[12]=e[0]*r+e[4]*s+e[8]*o+e[12],i[13]=e[1]*r+e[5]*s+e[9]*o+e[13],i[14]=e[2]*r+e[6]*s+e[10]*o+e[14],i[15]=e[3]*r+e[7]*s+e[11]*o+e[15]):(a=e[0],l=e[1],u=e[2],p=e[3],d=e[4],m=e[5],g=e[6],w=e[7],E=e[8],A=e[9],k=e[10],O=e[11],i[0]=a,i[1]=l,i[2]=u,i[3]=p,i[4]=d,i[5]=m,i[6]=g,i[7]=w,i[8]=E,i[9]=A,i[10]=k,i[11]=O,i[12]=a*r+d*s+E*o+e[12],i[13]=l*r+m*s+A*o+e[13],i[14]=u*r+g*s+k*o+e[14],i[15]=p*r+w*s+O*o+e[15]),i}function scale(i,e,t){var r=t[0],s=t[1],o=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*s,i[5]=e[5]*s,i[6]=e[6]*s,i[7]=e[7]*s,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function rotate(i,e,t,r){var s=r[0],o=r[1],a=r[2],l=Math.hypot(s,o,a),u,p,d,m,g,w,E,A,k,O,ne,Q,ue,U,_,Se,Me,Ke,kt,Qe,ze,Je,St,Te;return l<EPSILON?null:(l=1/l,s*=l,o*=l,a*=l,u=Math.sin(t),p=Math.cos(t),d=1-p,m=e[0],g=e[1],w=e[2],E=e[3],A=e[4],k=e[5],O=e[6],ne=e[7],Q=e[8],ue=e[9],U=e[10],_=e[11],Se=s*s*d+p,Me=o*s*d+a*u,Ke=a*s*d-o*u,kt=s*o*d-a*u,Qe=o*o*d+p,ze=a*o*d+s*u,Je=s*a*d+o*u,St=o*a*d-s*u,Te=a*a*d+p,i[0]=m*Se+A*Me+Q*Ke,i[1]=g*Se+k*Me+ue*Ke,i[2]=w*Se+O*Me+U*Ke,i[3]=E*Se+ne*Me+_*Ke,i[4]=m*kt+A*Qe+Q*ze,i[5]=g*kt+k*Qe+ue*ze,i[6]=w*kt+O*Qe+U*ze,i[7]=E*kt+ne*Qe+_*ze,i[8]=m*Je+A*St+Q*Te,i[9]=g*Je+k*St+ue*Te,i[10]=w*Je+O*St+U*Te,i[11]=E*Je+ne*St+_*Te,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function rotateX(i,e,t){var r=Math.sin(t),s=Math.cos(t),o=e[4],a=e[5],l=e[6],u=e[7],p=e[8],d=e[9],m=e[10],g=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=o*s+p*r,i[5]=a*s+d*r,i[6]=l*s+m*r,i[7]=u*s+g*r,i[8]=p*s-o*r,i[9]=d*s-a*r,i[10]=m*s-l*r,i[11]=g*s-u*r,i}function rotateY(i,e,t){var r=Math.sin(t),s=Math.cos(t),o=e[0],a=e[1],l=e[2],u=e[3],p=e[8],d=e[9],m=e[10],g=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*s-p*r,i[1]=a*s-d*r,i[2]=l*s-m*r,i[3]=u*s-g*r,i[8]=o*r+p*s,i[9]=a*r+d*s,i[10]=l*r+m*s,i[11]=u*r+g*s,i}function rotateZ(i,e,t){var r=Math.sin(t),s=Math.cos(t),o=e[0],a=e[1],l=e[2],u=e[3],p=e[4],d=e[5],m=e[6],g=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*s+p*r,i[1]=a*s+d*r,i[2]=l*s+m*r,i[3]=u*s+g*r,i[4]=p*s-o*r,i[5]=d*s-a*r,i[6]=m*s-l*r,i[7]=g*s-u*r,i}function getScaling(i,e){var t=e[0],r=e[1],s=e[2],o=e[4],a=e[5],l=e[6],u=e[8],p=e[9],d=e[10];return i[0]=Math.hypot(t,r,s),i[1]=Math.hypot(o,a,l),i[2]=Math.hypot(u,p,d),i}function fromQuat(i,e){var t=e[0],r=e[1],s=e[2],o=e[3],a=t+t,l=r+r,u=s+s,p=t*a,d=r*a,m=r*l,g=s*a,w=s*l,E=s*u,A=o*a,k=o*l,O=o*u;return i[0]=1-m-E,i[1]=d+O,i[2]=g-k,i[3]=0,i[4]=d-O,i[5]=1-p-E,i[6]=w+A,i[7]=0,i[8]=g+k,i[9]=w-A,i[10]=1-p-m,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function frustum(i,e,t,r,s,o,a){var l=1/(t-e),u=1/(s-r),p=1/(o-a);return i[0]=o*2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*u,i[6]=0,i[7]=0,i[8]=(t+e)*l,i[9]=(s+r)*u,i[10]=(a+o)*p,i[11]=-1,i[12]=0,i[13]=0,i[14]=a*o*2*p,i[15]=0,i}function perspectiveNO(i,e,t,r,s){var o=1/Math.tan(e/2),a;return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0?(a=1/(r-s),i[10]=(s+r)*a,i[14]=2*s*r*a):(i[10]=-1,i[14]=-2*r),i}var perspective=perspectiveNO;function orthoNO(i,e,t,r,s,o,a){var l=1/(e-t),u=1/(r-s),p=1/(o-a);return i[0]=-2*l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*p,i[11]=0,i[12]=(e+t)*l,i[13]=(s+r)*u,i[14]=(a+o)*p,i[15]=1,i}var ortho=orthoNO;function lookAt(i,e,t,r){var s,o,a,l,u,p,d,m,g,w,E=e[0],A=e[1],k=e[2],O=r[0],ne=r[1],Q=r[2],ue=t[0],U=t[1],_=t[2];return Math.abs(E-ue)<EPSILON&&Math.abs(A-U)<EPSILON&&Math.abs(k-_)<EPSILON?identity$2(i):(d=E-ue,m=A-U,g=k-_,w=1/Math.hypot(d,m,g),d*=w,m*=w,g*=w,s=ne*g-Q*m,o=Q*d-O*g,a=O*m-ne*d,w=Math.hypot(s,o,a),w?(w=1/w,s*=w,o*=w,a*=w):(s=0,o=0,a=0),l=m*a-g*o,u=g*s-d*a,p=d*o-m*s,w=Math.hypot(l,u,p),w?(w=1/w,l*=w,u*=w,p*=w):(l=0,u=0,p=0),i[0]=s,i[1]=l,i[2]=d,i[3]=0,i[4]=o,i[5]=u,i[6]=m,i[7]=0,i[8]=a,i[9]=p,i[10]=g,i[11]=0,i[12]=-(s*E+o*A+a*k),i[13]=-(l*E+u*A+p*k),i[14]=-(d*E+m*A+g*k),i[15]=1,i)}function damp(i){var e=i*.9;return Math.abs(e)<.1?0:e}function clamp(i,e,t){return Math.min(Math.max(i,e),t)}class Camera{constructor(e={}){this.cameraState={view:identity$2(new Float32Array(16)),projection:identity$2(new Float32Array(16)),center:e.center||[0,0,0],theta:e.theta||0,phi:e.phi||0,distance:Math.log(e.distance||1e3),eye:new Float32Array(3),up:new Float32Array(e.up||[0,1,0])},this.right=new Float32Array([1,0,0]),this.front=new Float32Array([0,0,1]),this.minDistance=Math.log("minDistance"in e?e.minDistance:.5),this.maxDistance=Math.log("maxDistance"in e?e.maxDistance:1e14),this.dtheta=0,this.dphi=0,this.ddistance=0,this.updateCamera()}mouseChange(e,t){var r=Math.max(this.cameraState.distance,.5);this.dtheta+=r*e,this.dphi+=r*t,this.updateCamera()}getProjection(){return{projection:this.cameraState.projection,view:this.cameraState.view,distance:this.cameraState.distance,eye:this.cameraState.eye}}mouseWheel(e,t){this.ddistance+=t/window.innerHeight,this.updateCamera()}updateCamera(){var e=this.cameraState.center,t=this.cameraState.eye,r=this.cameraState.up;this.cameraState.theta+=this.dtheta,this.cameraState.phi=clamp(this.cameraState.phi+this.dphi,-Math.PI/2,Math.PI/2),this.cameraState.distance=clamp(this.cameraState.distance+this.ddistance,this.minDistance,this.maxDistance),this.dtheta=damp(this.dtheta),this.dphi=damp(this.dphi),this.ddistance=damp(this.ddistance);for(var s=this.cameraState.theta,o=this.cameraState.phi,a=Math.exp(this.cameraState.distance),l=a*Math.sin(s)*Math.cos(o),u=a*Math.cos(s)*Math.cos(o),p=a*Math.sin(o),d=0;d<3;++d)t[d]=e[d]+l*this.front[d]+u*this.right[d]+p*r[d];lookAt(this.cameraState.view,t,e,r)}}class WGL2DI{constructor(e,t){var r=this;t||(t={}),this.config=t,t.offset||(t.offset=[0,0,0,0]),this.mode=t.mode||"2d",this.movingImage=0,this.__doc__=document,this.config.brush=this.config.brush||"default",this.draw_options=t.draw_options?t.draw_options:{depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"src alpha",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}},this.regl=null,this.pick_buffer=null,this.hideOnFilter=!0,this.pointOpacity=.8,this.pointRadius=10,this.isFiltered=!1,this.x_scale=1,this.y_scale=1,this.offset=[0,0],typeof e=="string"?this.div_container=document.getElementById(e):this.div_container=e,this._setUpDocument(t.width,t.height),this.handlers={object_clicked:{},object_over:{},object_out:{},brush_stopped:{},zoom_stopped:{},panning_stopped:{},pan_or_zoom:{}},this.draw_labels=!1,this.object_types=[],this.pointScale=0,this.circle_properties={x_pos:1,y_pos:1,color:1,pick_color:1,localFilter:1,globalFilter:1},this.circles={};for(var s in this.circle_properties)this.circles[s]=[];this.circles.count=0,this.object_types.push({data:this.circles,properties:this.circle_properties,vertices:1,primitive:"points"}),this.line_properties={position:2,color:2,opacity:2},this.lines={};for(var s in this.line_properties)this.lines[s]=[];this.lines.count=0,this.object_types.push({data:this.lines,properties:this.line_properties,vertices:2,primitive:"lines"}),this.image_properties={position:2,color:2,opacity:2},this.images={};for(var s in this.image_properties)this.images[s]=[];this.images.count=0,this.images.props={x_y:[],w_h:[],text:[]},this.object_types.push({data:this.images,properties:this.image_properties,vertices:6,primitive:"triangles"}),this.mode==="3d"&&(this.circle_properties.z_pos=1,this.camera=new Camera({center:t.cameraCenter,distance:t.cameraDistance||500,theta:.75,phi:.5}),this.axisScales=[1,1,1]),this.square_properties={x_pos:1,y_pos:1,color:1,pick_color:1,localFilter:1,globalFilter:1},this.squares={};for(var s in this.square_properties)this.squares[s]=[];this.squares.count=0,this.object_types.push({data:this.squares,properties:this.square_properties,vertices:1,primitive:"points"}),this.mouse_position=null,this.object_clicked=null,this.dragging=!1,this.object_mouse_over=null,this.zoom_amount=0,this.draw_order=this.mode==="3d"?[2,0,1,3]:[2,0,1,3],reglExports({onDone:function(o,a){r.regl=a,a._refresh(),r.pickbuffer=a.framebuffer({colorFormat:"rgba",height:r.height,width:r.width}),r._initDrawMethods(),r.mode==="3d"&&(r.object_types[0].method=r.__draw3DCircles,r.object_types[1].method=r.__draw3DLines),r._addHandlers()},canvas:r.canvas,attributes:{antialias:!1}})}setBackGroundColor(e){e=e||"",this.div_container.style.background=e}_setUpDocument(e,t){if(this.config.brush&&(this.div_container.style.cursor="crosshair"),t)this.height=t,this.width=e,this.div_container.style.height=t+"px",this.div_container.style.width=e+"px";else{const s=this.div_container.getBoundingClientRect();this.height=t=Math.round(s.height),this.width=e=Math.round(s.width)}const r={height:t,width:e,styles:{position:"absolute",left:"0px",top:"0px"}};this.canvas=createEl("canvas",r),this.label_canvas=createEl("canvas",r),this.label_context=this.label_canvas.getContext("2d"),this.div_container.append(this.canvas),this.div_container.append(this.label_canvas)}colorPoints(e){const t=this.circles.count,r=this.circles.color;for(let s=0;s<t;s++){const o=e(s),a=s*3;r[a]=o[0],r[a+1]=o[1],r[a+2]=o[2]}if(this.highlightPoints){const s=this.highlightPoints;for(let o=0;o<s.length;o++){const a=s.indexes[o]*3,l=o*3;s.color[l]=this.circles.color[a],s.color[l+1]=this.circles.color[a+1],s.color[l+2]=this.circles.color[a+2]}}}remove(){this.pickbuffer.destroy(),this.regl.destroy(),this.canvas.remove(),this.label_canvas.remove()}setSize(e,t,r=null){if(this.height===t&&this.width===e)return;let s=this;if(e=Math.round(e),t=Math.round(t),r){const a=r(e,t);this.x_scale=a[0],this.y_scale=a[1]}else{let a=e/this.width,l=t/this.height;this.x_scale=this.x_scale*a,this.y_scale=this.y_scale*l}this.height=t,this.width=e,this.div_container.style.height=t+"px",this.div_container.style.width=e+"px",this.canvas.setAttribute("height",t),this.canvas.setAttribute("width",e),this.label_canvas.setAttribute("height",t),this.label_canvas.setAttribute("width",e),this.pickbuffer.destroy(),this.pickbuffer=this.regl.framebuffer({colorFormat:"rgba",height:t,width:e});let o=this.regl.frame(function(){});setTimeout(()=>{s.refresh(),o.cancel()},200)}_getMousePosition(e){var t=this.canvas.getBoundingClientRect();return[e.clientX-t.left,e.clientY-t.top]}_getActualPosition(e){var t=e[0]/this.x_scale-this.offset[0],r=e[1]/this.y_scale-this.offset[1];return[t,r]}_getCanvasCoords(e){let t=(e[0]+this.offset[0])*this.x_scale,r=(e[1]+this.offset[1])*this.y_scale;return[t,r]}getRange(){let e=this._getActualPosition([0,0]),t=this._getActualPosition([this.width,this.height]);return{x_range:[e[0],t[0]],y_range:[e[1],t[1]],offset:[this.offset[0],this.offset[1]],scale:[this.x_scale,this.y_scale]}}setHighlightPoints(e){if(e==null){this.highlightPoints=null;return}const t={x_pos:[],y_pos:[],color:[],length:e.length,indexes:e};this.mode==="3d"&&(t.z_pos=[]);for(let r of e){t.x_pos.push(this.circles.x_pos[r]),t.y_pos.push(this.circles.y_pos[r]),this.mode==="3d"&&t.z_pos.push(this.circles.z_pos[r]);const s=r*3;t.color.push(this.circles.color[s]),t.color.push(this.circles.color[s+1]),t.color.push(this.circles.color[s+2])}this.highlightPoints=t}setPointRadius(e){(!e||isNaN(e))&&(e=0),this.pointRadius=e}setFilter(e){this.isFiltered=e}setHideOnFilter(e){this.hideOnFilter=e}setPointOpacity(e){e=e>1?1:e,e=e<0?0:e,this.pointOpacity=e}getPointOpacity(){return this.pointOpacity}getPointRadius(){return this.pointRadius}addLine(e,t,r=[0,0,0],s=1){return this.lines.position=this.lines.position.concat(e,t),this.lines.color=this.lines.color.concat(r,r),this.lines.opacity=this.lines.opacity.concat([s,s]),this.lines.count++,this.lines.count-1}changeImage(e,t,r){this.images.props.text[r]=this.regl.texture({data:e,min:"linear"}),this.resizeImage([t.width,t.height],r),this.setImagePosition(t.position[0],t.position[1],r)}changeImageOpacity(e,t){const r=e*6,s=r+6;for(let o=r;o<s;o++)this.images.opacity[o]=t}moveImage(e,t){const r=this.movingImage*6,s=r+6;for(let a=r;a<s;a++){const l=this.images.position[a];l[0]+=e,l[1]+=t}const o=this.images.props.x_y[this.movingImage];o[0]+=e,o[1]+=t}setImagePosition(e,t,r){const s=this.images.position,o=r*6,a=this.images.props.w_h[r][0],l=this.images.props.w_h[r][1];t=-t-l,this.images.props.x_y[r]=[e,t],s[o]=[e,t],s[o+1]=[e,t+l],s[o+2]=[e+a,t+l],s[o+3]=[e+a,t+l],s[o+4]=[e+a,t],s[o+5]=[e,t]}getImageDetails(e){const t=this.images.props.w_h[e],r=this.images.props.x_y[e];return{width:t[0],height:t[1],position:[r[0],r[1]],index:e}}resizeImage(e,t){const r=this.images.props.w_h[t],s=this.images.props.x_y[t];let o,a=null;Array.isArray(e)?(o=e[0],a=e[1],r[0]=o,r[1]=a):(o=r[0]*=e,a=r[1]*=e);const l=s[0],u=s[1];this.images.position[1]=[l,u+a],this.images.position[2]=[l+o,u+a],this.images.position[3]=[l+o,u+a],this.images.position[4]=[l+o,u]}addImage(e,t){const r=t;let s=this,o=r.position[0],a=-r.position[1];const l=r.height,u=r.width;a=a-l,this.images.position.length,this.images.position.push([o,a]),this.images.position.push([o,a+l]),this.images.position.push([o+u,a+l]),this.images.position.push([o+u,a+l]),this.images.position.push([o+u,a]),this.images.position.push([o,a]),this.image_position=[[-1,1],[-1,0],[0,0],[0,0],[0,1],[-1]];const p=r.opacity==null?1:r.opacity;for(var d=0;d<6;d++)this.images.color.push([1,1,1]),this.images.opacity.push(p);return this.images.count++,this.images.props.x_y.push([o,a]),this.images.props.w_h.push([u,l]),this.images.props.text.push(s.regl.texture({data:e,min:"linear"})),this.images.count-1}removeImages(){this.images.position=[],this.images.color=[],this.images.opacity=[],this.images.props.x_y=[],this.images.props.w_h=[],this.images.props.text=[],this.images.count=0}addSquares(e){this.squares.x_pos=e.x,this.squares.y_pos=e.y;const t=e.x.length;this.squares.localFilter=e.localFilter,this.squares.globalFilter=e.globalFilter,this.squares.pick_color=new Uint8Array(t*3),this.squares.color=new Uint8Array(t*3);for(let r=0;r<t;r++){let s=r*3;const o=e.colorFunc(r);this.squares.color[s]=o[0],this.squares.color[s+1]=o[1],this.squares.color[s+2]=o[2];let a=this._getRGBFromIndex(r+1);this.squares.pick_color[s]=a[0],this.squares.pick_color[s+1]=a[1],this.squares.pick_color[s+2]=a[2]}this.squares.count=t}addCircles(e){this.circles.x_pos=e.x,this.circles.y_pos=e.y,this.mode==="3d"&&(this.circles.z_pos=e.z);const t=e.x.length;this.circles.localFilter=e.localFilter,this.circles.globalFilter=e.globalFilter,this.circles.pick_color=new Uint8Array(t*3),this.circles.color=new Uint8Array(t*3);for(let r=0;r<t;r++){let s=r*3;const o=e.colorFunc(r);this.circles.color[s]=o[0],this.circles.color[s+1]=o[1],this.circles.color[s+2]=o[2];let a=this._getRGBFromIndex(r+1);this.circles.pick_color[s]=a[0],this.circles.pick_color[s+1]=a[1],this.circles.pick_color[s+2]=a[2]}this.circles.count=t}updateSize(e,t){this.circles.x_pos=t.x,this.circles.y_pos=t.y,this.mode==="3d"&&(this.circles.z_pos=t.z),this.circles.localFilter=t.localFilter,this.circles.globalFilter=t.globalFilter;let r=new Uint8Array(e*3),s=new Uint8Array(e*3);s.set(this.circles.color),r.set(this.circles.pick_color),this.circles.color=s,this.circles.pick_color=r;for(let o=this.circles.count;o<e;o++){let a=o*3;const l=t.colorFunc(o);this.circles.color[a]=l[0],this.circles.color[a+1]=l[1],this.circles.color[a+2]=l[2];let u=this._getRGBFromIndex(o+1);this.circles.pick_color[a]=u[0],this.circles.pick_color[a+1]=u[1],this.circles.pick_color[a+2]=u[2]}this.circles.count=e}_getRGBFromIndex(e){var t=Math.floor(e/65536),r=e%65536,s=Math.floor(r/256),o=r%256;return[o,s,t]}_getIndexFromRGB(e){return e[2]*65536+e[1]*256+e[0]}_drawPickBuffer(){this.regl.clear({color:[0,0,0,0],depth:1,framebuffer:this.pickbuffer}),this._drawObjects(!0)}refresh(){this.regl.clear({color:[0,0,0,0],depth:1}),this._drawObjects(!1),this._drawPickBuffer(),this.label_context.font="30px Arial"}setCamera(e,t,r){if(this.mode!=="3d")return;const s=this.camera.cameraState;s.distance=Math.log(e),s.theta=t,s.phi=r,this.camera.updateCamera()}getCameraSettings(){if(this.mode!=="3d")return;const e=this.camera.cameraState;return{distance:Math.pow(Math.E,e.distance),theta:e.theta,phi:e.phi}}zoom(e){this.x_scale*=e,this.y_scale*=e,this._drawObjects(!1)}setFilterAction(e){e==="grey"?this.hideOnFilter=!1:this.hideOnFilter=!0}_drawObjects(e){let t=null;if(this.mode==="3d"){const o=this.camera.getProjection();t={cameraProjection:o.projection,cameraView:o.view,cameraDistance:o.distance,axisScales:this.axisScales,cameraEye:o.eye}}else t={x_scale:this.x_scale,y_scale:this.y_scale,offset:this.offset};t.point_scale=this.pointScale?(this.x_scale+this.y_scale)/2/this.pointScale:1,t.point_radius=this.pointRadius,t.is_filtered=this.isFiltered?1:0,t.point_opacity=this.pointOpacity,t.hide_on_filter=this.hideOnFilter?1:0;for(let o of this.draw_order){var r=this.object_types[o];if(r.data.count){if(e){if(!r.properties.pick_color)continue;e=this.pickbuffer}else e=null;if(t.buffer=e,t.count=r.data.count*r.vertices,t.primitive=r.primitive,t.is_buffer=e?1:0,o===2){for(let a=0;a<r.data.count;a++){for(let l in r.properties)t[l]=r.data[l].slice(a*6,a*6+6);for(let l in this.images.props)t[l]=this.images.props[l][a];r.method(t)}continue}if(o===3){if(e)continue;this.x_scale>=this.y_scale?(t.side_length=20*this.x_scale,t.bottom_clip=this.y_scale/this.x_scale,t.right_clip=1):(t.side_length=20*this.y_scale,t.right_clip=this.x_scale/this.y_scale,t.bottom_clip=1)}for(var s in r.properties)if(e){if(s==="pick_color"){t.color=r.data[s];continue}if(s==="color")continue;t[s]=r.data[s]}else{if(s==="pick_color")continue;t[s]=r.data[s]}r.method(t)}}this.highlightPoints&&!e&&(t.x_pos=this.highlightPoints.x_pos,t.y_pos=this.highlightPoints.y_pos,t.color=this.highlightPoints.color,t.primitive="points",t.count=this.highlightPoints.length,this.mode==="3d"?(t.z_pos=this.highlightPoints.z_pos,this.__draw3DHighlights(t)):this.__drawHighlights(t))}getObjectsInRange(e,t,r,s){console.log(`${e},${t},${r},${s}`);const o=r*s*4;var a=this.regl.read({x:e,y:this.height-t-s,width:r,height:s,framebuffer:this.pickbuffer});const l=new Set;for(let u=0;u<o;u+=4){const p=this._getIndexFromRGB([a[u],a[u+1],a[u+2]]);p!==null&&l.add(p-1)}return l}_getObjectAtPosition(e){if(!(e[1]<=0||e[0]<=0)){try{var t=this.regl.read({x:e[0],y:this.height-e[1],width:1,height:1,framebuffer:this.pickbuffer})}catch{console.log(e)}if(t[0]===0&&t[1]===0&&t[2]===0)return null;var r=this._getIndexFromRGB(t);return r>0?r-1:null}}addHandler(e,t,r){var s=this.handlers[e];if(!s)throw"Handler Not Supported";return r||(r=Object.keys(s).length),s[r]=t,r}removeHandler(e,t){var r=this.handlers[e];if(!r)throw"Handler Not Supported";delete r.name}_setUpBrush(e){let t=createEl("div",{classes:["wgl2di-brush"],styles:{top:e[1]+"px",left:e[0]+"px"}},this.div_container);makeDraggable(t,{contain:!0,ondragstart:()=>this.brush_moving=!0,ondragend:()=>this._brushingStopped(),doc:this.__doc__}),this.brush={origin:e,div:t,resizing:!0}}_setUpPolyBrush(e){this.poly_brush={points:[e],active:!0};let t=this.label_context;t.strokeStyle=getComputedStyle(this.canvas).getPropertyValue("color"),t.beginPath(),t.moveTo(e[0],e[1])}_extendPolyBrush(e,t=15){var s;const r=this.label_context;if(this.poly_brush.points.length){const o=this.poly_brush.points[this.poly_brush.points.length-1],a=o[0]-e[0],l=o[1]-e[1];if(Math.sqrt(a**2+l**2)<t)return}r.lineTo(e[0],e[1]),r.stroke(),(s=this.poly_brush)==null||s.points.push(e)}_finishPolyBrush(){if(this.poly_brush.points.length<3){this.clearBrush();return}let e=this.label_context;const t=this.poly_brush.points[0];e.lineTo(t[0],t[1]),e.stroke(),e.closePath(),e.fillStyle="lightgray",e.globalAlpha=.2,e.fill(),e.globalAlpha=1;let r=[];this.poly_brush.active=!1;for(let o of this.poly_brush.points)r.push(this._getActualPosition(o));for(var s in this.handlers.brush_stopped)setTimeout(()=>this.handlers.brush_stopped[s](r,!0),0)}clearBrush(){this.brush&&(this.brush.div.remove(),this.brush=null),this.poly_brush&&(this.label_context.clearRect(0,0,this.width,this.height),this.poly_brush=null)}_brushingStopped(){if(!this.brush)return;this.brush.resizing=!1;const e=this.brush.div,t=e.offsetTop,r=e.offsetLeft,s=e.offsetWidth,o=e.offsetHeight;if(s<2){this.clearBrush();return}if(this.mode==="3d"){const l=this.getObjectsInRange(r,t,s,o);for(var a in this.handlers.brush_stopped)this.handlers.brush_stopped[a](l)}else{let l=this._getActualPosition([r,t]),u=this._getActualPosition([r+s,t+o]),p={x_min:l[0],x_max:u[0],y_max:-l[1],y_min:-u[1]};for(var a in this.handlers.brush_stopped)this.handlers.brush_stopped[a](p)}}setGlobalFilter(e){this.circles.globalFilter=e}_addHandlers(){var e=this;this.div_container.addEventListener("mousemove",function(t){if(e.brush){if(e.brush.resizing){let u=e.brush.origin,p=e._getMousePosition(t),d=Math.round(u[0]<p[0]?u[0]:p[0])+"px",m=Math.round(u[1]<p[1]?u[1]:p[1])+"px",g=Math.abs(u[0]-p[0])+"px",w=Math.abs(u[1]-p[1])+"px";e.brush.div.style.top=m,e.brush.div.style.left=d,e.brush.div.style.width=g,e.brush.div.style.height=w;return}else if(e.brush.moving){e.dragging=!1;return}}if(e.poly_brush&&e.poly_brush.active){let u=e._getMousePosition(t);e._extendPolyBrush(u)}if(e.mouse_position&&!e.dragging){var r=t.pageX-e.mouse_position[0],s=t.pageY-e.mouse_position[1];(Math.abs(r)>3||Math.abs(s)>3)&&(e.dragging=!0)}if(e.dragging){const u=t.pageX-e.mouse_position[0],p=t.pageY-e.mouse_position[1];if(e.mode==="3d")e.camera.mouseChange(u/e.width,p/e.height);else{const d=u/e.x_scale,m=p/e.y_scale;if(e.movingImage!=null&&t.ctrlKey&&e.images.count>0)e.moveImage(d,m),e.imageMoved=e.getImageDetails(e.movingImage);else if(e.offsets&&t.which==3)e.alterOffsets(d,m);else{e.config.lock_x_axis||(e.offset[0]+=d),e.offset[1]+=m;for(var o in e.handlers.pan_or_zoom)e.handlers.pan_or_zoom[o](e.offset,e.x_scale,e.y_scale)}}e.loop||(e.loop=e.regl.frame(()=>{e.regl.clear({color:[0,0,0,0],depth:1}),e._drawObjects(!1)})),e.mouse_position[1]=t.pageY,e.mouse_position[0]=t.pageX}else{var a=e._getMousePosition(t),l=e._getObjectAtPosition(a);if(l!=null&&e.object_mouse_over==null){for(var o in e.handlers.object_over)e.handlers.object_over[o](t,l);e.object_mouse_over=l}else if(l==null&&e.object_mouse_over){for(var o in e.handlers.object_out)e.handlers.object_out[o](t,e.object_mouse_over);e.object_mouse_over=null}else if(l!=null&&l!==e.object_mouse_over){for(var o in e.handlers.object_over)e.handlers.object_over[o](t,l);e.object_mouse_over=l}}}),this.div_container.addEventListener("mouseleave",function(t){if(e.object_mouse_over){for(var r in e.handlers.object_out)e.handlers.object_out[r](e.object_mouse_over[2]);e.object_mouse_over=null}e.brush&&e.brush.resizing&&e._brushingStopped()}),this.div_container.addEventListener("mouseup",function(t){if(e.config.brush&&(e.div_container.style.cursor="crosshair"),e.brush&&e.brush.resizing&&e._brushingStopped(),e.poly_brush&&e.poly_brush.active&&e._finishPolyBrush(),!e.dragging&&!(e.brush||e.poly_brush)){var r=e._getMousePosition(t),s=e._getObjectAtPosition(r);if(s)for(var o in e.handlers.object_clicked)e.handlers.object_clicked[o](s)}else{if(e.object_clicked)e.object_clicked=null,e.refresh(!0);else{let a=e.getRange();e.loop&&(e.loop.cancel(),e.loop=null),e.refresh(),a.imageMoved=e.imageMoved,e.imageMoved=null;for(var o in e.handlers.panning_stopped)e.handlers.panning_stopped[o](a)}e.dragging=!1}e.object_clicked=null,e.mouse_position=null}),this.div_container.addEventListener("wheel",function(t){t.preventDefault();var r=e._getActualPosition(e._getMousePosition(t));let s=0;if(t.wheelDelta>0||t.detail<0?(e.zoom_amount+=.01,s=-30):(e.zoom_amount-=.01,s=30),e.mode==="3d")e.camera.mouseWheel(0,s);else if(e.movingImage!=null&&t.ctrlKey){e.resizeImage(1+e.zoom_amount,e.movingImage);const a=e._getActualPosition(e._getMousePosition(t));e.moveImage(a[0]-r[0],a[1]-r[1]),e.imageMoved=e.getImageDetails(e.movingImage)}else{e.config.lock_x_axis||(e.x_scale*=1+e.zoom_amount),e.config.lock_y_axis||(e.y_scale*=1+e.zoom_amount);const a=e._getActualPosition(e._getMousePosition(t));e.offset[0]+=a[0]-r[0],e.offset[1]+=a[1]-r[1];for(var o in e.handlers.pan_or_zoom)e.handlers.pan_or_zoom[o](e.offset,e.x_scale,e.y_scale)}e.loop||(e.label_context.clearRect(0,0,e.width,e.height),e.loop=e.regl.frame(function(){e.regl.clear({color:[0,0,0,0],depth:1}),e._drawObjects(!1)})),clearTimeout(e._timer),e._timer=setTimeout(function(){e.zoom_amount=0,e.loop.cancel(),e.loop=null,e._drawPickBuffer(!1),e.brush;let a=e.getRange();a.imageMoved=e.imageMoved,e.imageMoved=null;for(let l in e.handlers.zoom_stopped)e.handlers.zoom_stopped[l](a);e.refresh()},350)}),this.div_container.addEventListener("mousedown",function(t){t.which;let r=t.shiftKey||t.ctrlKey||t.which==2||t.which==3;if(e.config.brush&&!r||!e.config.brush&&r){let s=e._getMousePosition(t);if(e.config.brush=="default"){if(t.target.classList.contains("wgl2di-brush"))return;e.brush&&e.clearBrush();let a=e._getMousePosition(t);e._setUpBrush(a);return}else if(e.config.brush==="poly"){e.poly_brush&&e.clearBrush(),e._setUpPolyBrush(s);return}}t.otherKey&&(e.div_container.style.cursor="move"),e._getMousePosition(t),e.mouse_position=[t.pageX,t.pageY],e.clearBrush(),t.preventDefault()})}_initDrawMethods(){var e=this;this.__drawCircles=this.regl({depth:e.draw_options.depth,blend:e.draw_options.blend,frag:`precision mediump float;
			varying vec3 fragColor;
			varying float op;
			varying float has_border;
			varying float grey_out;
			uniform float is_buffer;
			
			void main(){
			
				vec2 cxy = 2.0 * gl_PointCoord - 1.0;
                
				float r = dot(cxy, cxy);
				if (r > 1.0) {
					discard;
				}
				else{					
					if(r>0.60 && has_border==-1.0 && is_buffer==0.0 && grey_out==0.0){
					    gl_FragColor=vec4(0.1,0.1,0.1,1.0);
					}
					else{
						if (grey_out==1.0 && is_buffer==0.0){
							gl_FragColor = vec4(0.2,0.2,0.2,0.4);
						}
						else{
							gl_FragColor = vec4(fragColor,is_buffer==1.0?1.0:op);
						}
						
					}
				}
				
			}`,vert:`attribute float x_pos;
            attribute float y_pos;
			attribute vec3 color;
			attribute float lFilter;
			attribute float gFilter;
			varying vec3 fragColor;
			varying float op;
			varying float has_border;
			varying float grey_out;
			uniform float x_scale;
			uniform float y_scale;
			uniform vec2 offset;
			uniform float stage_height;
			uniform float stage_width;
			uniform float point_radius;
			uniform float is_filtered;
			uniform float point_opacity;
			uniform float hide_on_filter;
			uniform float point_scale;
			
			vec2 normalizeCoords(float posX, float posY){
				float x = (posX+offset[0])*x_scale;
				float y = (posY+offset[1])*y_scale;
				return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
			}
	
			void main() {
				float dd = 0.0;
				grey_out=0.0;
				if (lFilter==2.0){
					return;
				}
			    if (gFilter>0.0 && gFilter != lFilter) {
					if(hide_on_filter==1.0){
						return;
					}
					else{
						grey_out=1.0;
					}
				}
				
			
				float r=point_radius;
			
				gl_PointSize = r*point_scale;
				vec3 c = vec3(255.0,255.0,255.0);
				if (color==c){
					op=0.1;
					fragColor=vec3(0.1,0.1,0.1);
				}
				else{
					op=point_opacity;
					fragColor = color/255.0;
				}
			
				
				
				has_border=lFilter-is_filtered;
			
				
				vec2 real_position = normalizeCoords(x_pos,-y_pos);
				gl_Position = vec4(real_position, 0.0, 1.0);
			}
			`,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),color:e.regl.prop("color"),lFilter:e.regl.prop("localFilter"),gFilter:e.regl.prop("globalFilter")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_width:e.regl.context("viewportWidth"),stage_height:e.regl.context("viewportHeight"),offset:e.regl.prop("offset"),point_radius:e.regl.prop("point_radius"),point_opacity:e.regl.prop("point_opacity"),is_filtered:e.regl.prop("is_filtered"),is_buffer:e.regl.prop("is_buffer"),hide_on_filter:e.regl.prop("hide_on_filter"),point_scale:e.regl.prop("point_scale")},count:e.regl.prop("count"),primitive:e.regl.prop("primitive"),framebuffer:e.regl.prop("buffer")}),this.__drawHighlights=this.regl({depth:e.draw_options.depth,blend:e.draw_options.blend,depth:e.draw_options.depth,blend:e.draw_options.blend,frag:`precision highp float;
			varying vec3 fragColor;
			
			void main(){

				vec2 cxy = 2.0 * gl_PointCoord - 1.0;
                
				float r = dot(cxy, cxy);
				if (r > 1.0) {
					discard;
				}
				else{					
					if(r>0.50) {
					    gl_FragColor=vec4(0.1,0.1,0.1,1.0);
					}
					else{
						gl_FragColor = vec4(fragColor,1);
					}
				}	
			}`,vert:`attribute float x_pos;
            attribute float y_pos;
			attribute vec3 color;
			uniform float point_radius;
			
			varying vec3 fragColor;
		
			uniform float x_scale;
			uniform float y_scale;
			uniform vec2 offset;
			uniform float stage_height;
			uniform float stage_width;
			uniform float point_scale;
			
			vec2 normalizeCoords(float posX, float posY){
				float x = (posX+offset[0])*x_scale;
				float y = (posY+offset[1])*y_scale;
				return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
			}
	
			void main() {
			
				float pr = point_radius*point_scale;
				pr = pr<10.0?10.0:pr;
				gl_PointSize = pr;
				fragColor = color/255.0;
					
				vec2 real_position = normalizeCoords(x_pos,-y_pos);
				gl_Position = vec4(real_position, 0.0, 1.0);
			}
			`,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),color:e.regl.prop("color")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_width:e.regl.context("viewportWidth"),stage_height:e.regl.context("viewportHeight"),offset:e.regl.prop("offset"),point_radius:e.regl.prop("point_radius"),point_scale:e.regl.prop("point_scale")},count:e.regl.prop("count"),primitive:e.regl.prop("primitive")}),this.object_types[0].method=this.__drawCircles,this.__drawLines=this.regl({frag:`precision highp float;
						varying vec3 fragColor;
						void main () {
							 gl_FragColor = vec4(fragColor,1);
						}`,vert:`
						attribute vec2 position;
						attribute vec3 color;
						attribute float opacity;
						uniform float x_scale;
						uniform float y_scale;
						uniform vec2 offset;
						uniform float stage_height;
						uniform float stage_width;
						varying vec3 fragColor;
						//varying float op;
						vec2 normalizeCoords(vec2 position){	    
							float x = (position[0]+offset[0])*x_scale;
							float y = (position[1]+offset[1])*y_scale;
				            return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
						}
						void main () {
							if (opacity==0.0){
								return;
							}
							fragColor=color/255.0;
							vec2 norm_pos =normalizeCoords(position*vec2(1,-1));
							gl_Position = vec4(norm_pos, 0.0, 1.0);
						}`,attributes:{position:e.regl.prop("position"),color:e.regl.prop("color"),opacity:e.regl.prop("opacity")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_height:e.regl.context("viewportHeight"),stage_width:e.regl.context("viewportWidth"),offset:e.regl.prop("offset")},primitive:e.regl.prop("primitive"),count:e.regl.prop("count")}),this.object_types[1].method=this.__drawLines,this.__drawImages=this.regl({frag:`
				precision mediump float;
				uniform sampler2D text;
				varying vec2 uv;
				varying vec3 fragColor;
				varying float op;
				void main () {
					gl_FragColor = vec4(fragColor,op)*texture2D(text, uv);							
				}`,vert:`
				precision mediump float;

				attribute vec2 position;
				attribute vec3 color;
				attribute float opacity;

				uniform vec2 x_y;
				uniform vec2 w_h;
				uniform float stage_height;
				uniform float stage_width;
				uniform float x_scale;
				uniform float y_scale;
				uniform vec2 offset;

				varying vec2 uv;
				varying vec3 fragColor;
				varying float op;
		
				
				vec2 normalizeCoords(vec2 pos){
					float x = (pos[0]+offset[0])*x_scale;
					float y = (pos[1]+offset[1])*y_scale;
					return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
				}

				void main () {
					if (opacity==0.0){
						return;
					}
					op=opacity;
					
					vec2 new_pos=normalizeCoords(position);
					fragColor = color;
				
					float x_factor = 1.0/(((w_h[0]*x_scale)/stage_width)*2.0);
					float y_factor = 1.0/(((w_h[1]*y_scale)/stage_height)*2.0);
					

					float x_offset=(((x_y[0]+offset[0])*x_scale)/stage_width)*2.0*x_factor;
					float y_offset=(((x_y[1]+offset[1])*y_scale)/stage_height)*2.0*y_factor;
					uv = vec2((new_pos[0]*x_factor)+x_factor-x_offset,-(new_pos[1]*y_factor)+y_factor-y_offset);
					gl_Position = vec4(new_pos, 0.0, 1.0);

				}`,attributes:{position:e.regl.prop("position"),color:e.regl.prop("color"),opacity:e.regl.prop("opacity")},uniforms:{stage_height:e.regl.context("viewportHeight"),stage_width:e.regl.context("viewportWidth"),w_h:e.regl.prop("w_h"),x_y:e.regl.prop("x_y"),text:e.regl.prop("text"),x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),offset:e.regl.prop("offset")},count:e.regl.prop("count"),depth:e.draw_options.depth,blend:e.draw_options.blend}),this.object_types[2].method=this.__drawImages,this.__drawSquares=this.regl({frag:`
				precision highp float;
				varying vec3 fragColor;
				varying float r_clip;
				varying float b_clip;
				uniform int is_buffer;
				void main(){
					if (gl_PointCoord[1]<1.0-b_clip){
						discard;
					}
					if (gl_PointCoord[0]> r_clip){
						discard;
					}				
					gl_FragColor = vec4(fragColor,1);					
				}
				`,vert:` 
				attribute float x_pos;
				attribute float y_pos;			
				attribute vec3 color;
			
				varying float r_clip;
				varying float b_clip;
				varying vec3 fragColor;

				uniform float x_scale;
				uniform float y_scale;
				uniform vec2 offset;
				uniform float stage_height;
				uniform float stage_width;
				uniform float right_clip;
				uniform float bottom_clip;
				uniform float side_length;
				
				vec2 normalizeCoords(float posX,float posY){
					float x = (posX+offset[0])*x_scale;
					float y = (posY+offset[1])*y_scale;
					return vec2(2.0 * ((x / stage_width) - 0.5),-(2.0 * ((y / stage_height) - 0.5)));
				}
				void main() {
					gl_PointSize = side_length;
					fragColor = color/255.0;
					r_clip=right_clip;
					b_clip= bottom_clip;
					float y = y_pos;
					float x = x_pos;
					if (bottom_clip!=1.0){
						y-=10.0*(1.0/b_clip)-10.0;
					}
					if (r_clip!=1.0){
						x+=10.0*(1.0/r_clip)-10.0;
					}

					vec2 real_position = normalizeCoords(x,y);
				
					gl_Position = vec4(real_position, 0.0, 1.0);
				}
			`,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),color:e.regl.prop("color")},uniforms:{x_scale:e.regl.prop("x_scale"),y_scale:e.regl.prop("y_scale"),stage_height:e.regl.context("viewportHeight"),stage_width:e.regl.context("viewportWidth"),offset:e.regl.prop("offset"),is_buffer:e.regl.prop("is_buffer"),right_clip:e.regl.prop("right_clip"),bottom_clip:e.regl.prop("bottom_clip"),side_length:e.regl.prop("side_length")},count:e.regl.prop("count"),primitive:e.regl.prop("primitive"),framebuffer:e.regl.prop("buffer")}),this.object_types[3].method=this.__drawSquares,this.__draw3DCircles=this.regl({frag:`
            precision highp float;
            varying vec3 fragColor;
			varying float op;
			varying float has_border;
			uniform float is_buffer;
			varying float grey_out;
            void main () {
			  float r = length(gl_PointCoord.xy - 0.4) ;
              if (r> 0.4) {
                discard;
              }
			  else{
				if(r>0.3 && has_border==-1.0 && is_buffer==0.0 && grey_out==0.0){
					gl_FragColor=vec4(0.1,0.1,0.1,1.0);
				}
				else{
					if (grey_out==1.0 && is_buffer==0.0){
						gl_FragColor = vec4(0.2,0.2,0.2,0.4);
					}
					else{
						gl_FragColor = vec4(fragColor,is_buffer==1.0?1.0:op);
					}
					
				}

			  }
             
            }
            `,vert:`
            precision highp float;

            attribute float x_pos;
            attribute float y_pos;
            attribute float z_pos;
            attribute vec3 color;
            attribute float lFilter;
            attribute float gFilter;
			
			uniform float time;
            uniform float cdistance;
            uniform mat4 view, projection;
			uniform vec3 eye;
			uniform float point_radius;
			uniform float point_opacity;
			uniform float is_buffer;
			uniform float is_filtered;
			uniform float hide_on_filter;
			uniform vec3 axis_scales;


            varying vec3 fragColor;
			varying float op;
			varying float has_border;
			varying float grey_out;

            void main () {
				grey_out=0.0; 
			    if (gFilter>0.0 && gFilter != lFilter) {
					if(hide_on_filter==1.0){
						return;
					}
					else{
						grey_out=1.0;
					}
				}
                vec3 position = vec3(-x_pos *axis_scales.x,y_pos*axis_scales.y,-z_pos*axis_scales.z);
                fragColor=color/255.0;
				op = is_buffer==1.0?1.0:point_opacity;
				has_border=lFilter-is_filtered;
               
				gl_PointSize = point_radius; //(distance(eye, position.xyz) /30.0);
                gl_Position = projection * view * vec4(2.0 * position, 1.0);
            }
            `,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),z_pos:e.regl.prop("z_pos"),color:e.regl.prop("color"),lFilter:e.regl.prop("localFilter"),gFilter:e.regl.prop("globalFilter")},uniforms:{point_radius:e.regl.prop("point_radius"),point_opacity:e.regl.prop("point_opacity"),is_buffer:e.regl.prop("is_buffer"),view:e.regl.prop("cameraView"),cdistance:e.regl.prop("cameraDistance"),eye:e.regl.prop("cameraEye"),is_filtered:e.regl.prop("is_filtered"),hide_on_filter:e.regl.prop("hide_on_filter"),axis_scales:e.regl.prop("axisScales"),projection:(t,r)=>perspective(r.cameraProjection,Math.PI/4,t.viewportWidth/t.viewportHeight,1,1e5)},count:e.regl.prop("count"),framebuffer:e.regl.prop("buffer"),blend:e.draw_options.blend,primitive:"points"}),this.__draw3DHighlights=this.regl({frag:`
            precision mediump float;
            varying vec3 fragColor;
		
            void main () {
			  float r = length(gl_PointCoord.xy - 0.4) ;
              if (r> 0.4) {
                discard;
              }
			  else{
				if(r>0.3){
					gl_FragColor=vec4(0.1,0.1,0.1,1.0);
				}
				else{
					
						gl_FragColor = vec4(fragColor,1.0);
				}
					
			  }
             
            }
            `,vert:`
            precision mediump float;

            attribute float x_pos;
            attribute float y_pos;
            attribute float z_pos;
            attribute vec3 color;
			
			uniform float time;
    
            uniform mat4 view, projection;
			uniform vec3 eye;
			uniform float point_radius;
			uniform vec3 axis_scales;
		


            varying vec3 fragColor;
		

            void main () {
			
                vec3 position = vec3(-x_pos*axis_scales.x,y_pos*axis_scales.y,-z_pos*axis_scales.z);
                fragColor=color/255.0;
               
				gl_PointSize = point_radius*2.0; //(distance(eye, position.xyz) /30.0);
                gl_Position = projection * view * vec4(2.0 * position, 1.0);
            }
            `,attributes:{x_pos:e.regl.prop("x_pos"),y_pos:e.regl.prop("y_pos"),z_pos:e.regl.prop("z_pos"),color:e.regl.prop("color")},uniforms:{point_radius:e.regl.prop("point_radius"),view:e.regl.prop("cameraView"),cdistance:e.regl.prop("cameraDistance"),eye:e.regl.prop("cameraEye"),axis_scales:e.regl.prop("axisScales"),projection:(t,r)=>perspective(r.cameraProjection,Math.PI/4,t.viewportWidth/t.viewportHeight,1,1e5)},count:e.regl.prop("count"),blend:e.draw_options.blend,primitive:"points"}),this.__draw3DLines=this.regl({frag:` precision highp float;
                    varying vec3 fragColor;
                    void main () {
                         gl_FragColor = vec4(fragColor,1);
                    }
`,vert:`
                    attribute vec3 position;
                    attribute vec3 color;
                    uniform mat4 view, projection;
					uniform vec3 axis_scales;
    
                    varying vec3 fragColor;
                  
                    
                    void main () {
                     
                        fragColor=color;
                        gl_Position = projection * view * vec4(2.0 * position*axis_scales*vec3(-1.0,1.0,-1.0), 1.0);
                       
                       
                    }`,attributes:{position:e.regl.prop("position"),color:e.regl.prop("color")},uniforms:{view:e.regl.prop("cameraView"),axis_scales:e.regl.prop("axisScales"),projection:(t,r)=>perspective(r.cameraProjection,Math.PI/4,t.viewportWidth/t.viewportHeight,.01,1e5)},primitive:e.regl.prop("primitive"),framebuffer:e.regl.prop("buffer"),count:e.regl.prop("count"),depth:{enable:!1}})}}class WGLChart extends SVGChart{constructor(e,t,r,s){super(e,t,r,s);const o=this.config;o.tooltip||(o.tooltip={show:!1}),o.default_color=o.default_color||"#377eb8";const a=this._getContentDimensions();this.graphDiv=createEl("div",{styles:{position:"absolute",left:a.left+"px",top:a.top+"px",width:a.width+"px",height:a.height+"px"}},this.contentDiv),this.tooltip=createEl("div",{styles:{position:"absolute",zIndex:100,display:"none","background-color":"lightgray"}},this.graphDiv)}onDataHighlighted(e){this.app.setHighlightPoints(e.indexes),this.app.refresh()}afterAppCreation(){const e=this,t=this.config;this.app.addHandler("object_over",function(o,a){t.tooltip.show&&e.showTooltip(o,a)}),this.app.addHandler("object_out",function(o,a){e.tooltip.style.display="none"}),t.default_color=t.default_color||"#377eb8",t.on_filter=t.on_filter==null?"hide":t.on_filter,this.app.setFilterAction(t.on_filter);const r=hexToRGB(t.default_color);let s=()=>r;if(t.color_by){const o={asArray:!0,overideValues:{colorLogScale:this.config.log_color_scale}};this._addTrimmedColor(t.color_by,o),s=this.dataStore.getColorFunction(t.color_by,o),t.color_legend||(t.color_legend={display:!0}),this.setColorLegend()}return this.app.addHandler("object_clicked",o=>{this.dataStore.dataHighlighted([o],this)}),s}setToolTipColumn(e){this.config.tooltip.column=e}showTooltip(e,t){var r=this.graphDiv.getBoundingClientRect();const s=this.dataStore.getRowAsObject(t),o=e.clientX-r.left,a=e.clientY-r.top;this.tooltip.style.display="block",this.tooltip.style.left=o+"px",this.tooltip.style.top=a+"px",this.tooltip.textContent=s[this.config.tooltip.column]}getSetupConfig(){const e=this.config,t=hexToRGB(e.default_color);let r=()=>t;return e.color_by&&(r=this.dataStore.getColorFunction(e.color_by,{asArray:!0})),{localFilter:this.dim.getLocalFilter(),globalFilter:this.dataStore.getFilter(),colorFunc:r}}setSize(e,t){super.setSize(e,t);const r=this._getContentDimensions();this.app.setSize(r.width,r.height),this.graphDiv.style.left=r.left+"px",this.graphDiv.style.top=r.top+"px",this.updateAxis()}onDataFiltered(e){e==="all_removed"&&(this.app.clearBrush(),this.app.setFilter(!1),this.resetButton.style.display="none"),this.app.setHighlightPoints(null),this.app.refresh()}remove(e=!0){this.dim.destroy(e),this.app.remove(),super.remove()}removeFilter(){this.filter!==null&&(this.dim.removeFilter(),this.app.clearBrush(),this.app.setFilter(!1),this.app.refresh())}colorByColumn(e){this.config.color_by=e;const t=this.getColorFunction(e,!0),r=performance.now();this.app.colorPoints(t),console.log("color time:"+(performance.now()-r)),setTimeout(()=>{this.app.refresh()},50)}colorByDefault(){this.legend&&this.legend.remove();const e=hexToRGB(this.config.default_color);this.app.colorPoints(()=>e),setTimeout(()=>{this.app.refresh()},50)}changeBaseDocument(e){this.app.clearBrush(),this.app.__doc__=e,super.changeBaseDocument(e)}getColorOptions(){return{colorby:"all",has_default_color:!0}}pinChart(){this.isPinned=!0,this.pinnedFilter=this.dataStore.getFilter().slice(0),this.app.setGlobalFilter(this.pinnedFilter)}unpinChart(){this.isPinned=!1,this.pinnedFilter=null,this.app.setGlobalFilter(this.dataStore.getFilter()),this.app.refresh()}addToImage(){this.app.refresh();let e=this.app.canvas.toDataURL("image/png");e=e.replace(/^data:image\/png/,"data:application/octet-stream");const t=this._getContentDimensions();this.svg.append("image").attr("xlink:href",e).attr("width",t.width).attr("height",t.height).attr("x",t.left).attr("y",t.top)}removeFromImage(){this.svg.select("image").remove()}getSettings(e){const t=super.getSettings(),r=this.config,s=this.dataStore.getColumnList();return t.splice(2,0,{type:"slider",max:1,min:0,doc:this.__doc__,current_value:r.opacity,label:"Point Opacity",func:o=>{r.opacity=o,this.app.setPointOpacity(o),this.app.refresh()}},{type:"slider",max:10,min:0,doc:this.__doc__,current_value:r.radius,label:"Point Size",func:o=>{r.radius=o,this.app.setPointRadius(o),this.app.refresh(),console.log(o)}}),t.concat([{type:"check",label:"Show Tooltip",current_value:r.tooltip.show,func:o=>{r.tooltip.show=o;let a=r.tooltip.column||s[0].field;this.setToolTipColumn(a)}},{type:"dropdown",label:"Tooltip value",current_value:r.tooltip.column||s[0].field,values:[s,"name","field"],func:o=>{this.setToolTipColumn(o)}},{type:"button",label:"Centre Plot",func:o=>{this.centerGraph(),this.app.refresh()}},{type:"radiobuttons",label:"Action on Filter",choices:[["Hide Points","hide"],["Gray Out Points","grey"]],current_value:r.on_filter,func:o=>{r.on_filter=o,this.app.setFilterAction(o),this.app.refresh()}}])}}class WGL3DScatterPlot extends WGLChart{constructor(e,t,r){r.title||(r.title=e.getColumnName(r.param[0])+" x "+e.getColumnName(r.param[1])+" x "+e.getColumnName(r.param[2])),super(e,t,r,{});const s=this.config,o=s.param;this.dim=this.dataStore.getDimension("range_dimension",o);const a=o.map(g=>this.dataStore.getColumnRange(g)),l=Math.max(...a);this.defaultCDistance=l*4,s.brush=s.brush||"default",s.center=s.center||[0,0,0],this.app=new WGL2DI(this.graphDiv,{mode:"3d",brush:s.brush,cameraDistance:this.defaultCDistance,cameraCenter:[-s.center[0]*2,s.center[1]*2,-s.center[2]*2]}),this.app.addHandler("brush_stopped",(g,w)=>{this.resetButton.style.display="inline",this.app.setFilter(!0),w?this._createPolyFilter(range):this._createFilter(g)});const u=this.afterAppCreation();let p=this.dataStore.columnIndex[o[0]],d=this.dataStore.columnIndex[o[1]],m=this.dataStore.columnIndex[o[2]];this.app.addCircles({x:p.datatype==="int32"?new Float32Array(p.data):p.data,y:d.datatype==="int32"?new Float32Array(d.data):d.data,z:m.datatype==="int32"?new Float32Array(m.data):m.data,localFilter:this.dim.getLocalFilter(),globalFilter:e.getFilter(),colorFunc:u}),s.radius=s.radius||5,s.opacity=s.opacity||.8,this.app.setPointRadius(s.radius),this.app.setPointOpacity(s.opacity),s.axis_scales=s.axis_scales||[1,1,1],this.app.axisScales=s.axis_scales,this.addAxis(),this.centerGraph(s.camera),this.app.refresh()}setAxisScales(e,t){this.config.axis_scales[e]=t,this.app.refresh()}getSettings(){let e=super.getSettings({pointMax:30,pointMin:1});const t=this.config;return e=e.concat([{type:"slider",max:3,min:.5,doc:this.__doc__,current_value:t.axis_scales[0],label:"X Axis Scale",func:r=>{this.setAxisScales(0,r)}},{type:"slider",max:3,min:.5,doc:this.__doc__,current_value:t.axis_scales[1],label:"Y Axis Scale",func:r=>{this.setAxisScales(1,r)}},{type:"slider",max:3,min:.5,doc:this.__doc__,current_value:t.axis_scales[2],label:"Z Axis Scale",func:r=>{this.setAxisScales(2,r)}}]),e}centerGraph(e){e?this.app.setCamera(e.distance,e.theta,e.phi):this.app.setCamera(this.defaultCDistance,-1.038,.261)}getConfig(){const e=super.getConfig();return e.camera=this.app.getCameraSettings(),e}_createFilter(e){this.dim.filter("filterOnIndex",[],e)}onDataAdded(e){const t=this.config.param,r=this.getSetupConfig();r.x=this.dataStore.getRawColumn(t[0]),r.y=this.dataStore.getRawColumn(t[1]),r.z=this.dataStore.getRawColumn(t[2]),this.app.updateSize(e,r),super.onDataAdded(e)}addAxis(){for(let e=0;e<3;e++){let t=this.dataStore.getMinMaxForColumn(this.config.param[e]);const r=this.config.center.map((a,l)=>a);r[e]=t[0];const s=this.config.center.map((a,l)=>a);s[e]=t[1];const o=[0,0,0];o[e]=255,this.app.addLine(r,s,o)}}}BaseChart.types.wgl_3d_scatter_plot={name:"3D Scatter Plot",class:WGL3DScatterPlot,params:[{type:"number",name:"X axis"},{type:"number",name:"Y axis"},{type:"number",name:"Z axis"}]};class OffsetDialog extends BaseDialog{constructor(e){super({title:"Alter Position",width:300,doc:e.__doc__},e)}init(e){this.plot=e,this.ds=this.plot.dataStore,createEl("div",{text:"Offset"},this.dialog),this.bdiv=createEl("div",{styles:{display:"flex",justifyContent:"center",alignItems:"center",position:"relative",height:"60px"}},this.dialog);for(let a of[["top","up"],["bottom","down"],["right","right"],["left","left"]])this._addPButton(a);createEl("div",{text:"Rotation"},this.dialog),this.rDiv=createEl("div",{styles:{height:"30px",position:"relative"}},this.dialog);for(let a of["left","right"])this._addRButton(a);const t=createEl("div",{},this.dialog),r=this.ds.columnIndex[this.ds.offsets.groups].name;createEl("div",{text:r},t),this.groupSelect=createEl("select",{},t),createEl("button",{classes:["ciview-button-sm"],text:"Reset"},t).addEventListener("click",a=>{this.ds.resetColumnOffsets(this.filter,this.groupSelect.value,!0),this._showOffsets(this.groupSelect.value)});const o=this.ds.columnIndex[this.ds.offsets.groups].values;for(let a of o)createEl("option",{text:a,value:a},this.groupSelect);this.filter=this.plot.config.background_filter?this.plot.config.background_filter.category:null,this.groupSelect.addEventListener("change",()=>{this._showOffsets(this.groupSelect.value)}),this._addOffsetLabels(),this._showOffsets(o[0])}_alterOffset(e){const t=this.plot.dataStore;let r=0,s=0;const o=parseFloat(this.offsetAm.value);if(isNaN(o))return;r+=e==="right"?o:0,r-=e==="left"?o:0,s+=e==="up"?o:0,s-=e==="down"?o:0;const a=this.groupSelect.value;t.setColumnOffset({group:a,offsets:[r,s],filter:this.filter},!0),this._showOffsets(a)}_addOffsetLabels(){const e=createEl("div",{styles:{position:"absolute",top:"20px",left:"20px",display:"flex",justifyContent:"center",gap:"5px"}},this.bdiv);this.xoffset=createEl("span",{},e),this.yoffset=createEl("span",{},e),createEl("span",{text:"step:"},e),this.offsetAm=createEl("input",{styles:{width:"30px"},value:1},e);const t=createEl("div",{styles:{position:"absolute",top:"0px",justifyContent:"center",left:"25px",display:"flex",gap:"5px"}},this.rDiv);this.angle=createEl("span",{},t),createEl("span",{text:"step:"},t),this.offsetAn=createEl("input",{styles:{width:"30px"},value:1},t)}_showOffsets(e){let t=[0,0],r=0;const s=this.ds.offsets.values[this.filter||"all"];s&&s[e]&&(t=s[e].offsets,r=s[e].rotation),this.xoffset.textContent="x:"+t[0].toFixed(1),this.yoffset.textContent="y:"+t[1].toFixed(1),this.angle.textContent="angle:"+r.toFixed(1)}_addPButton(e){const t={position:"absolute",textAlign:"center",cursor:"pointer"};t[e[0]]="0px",createEl("i",{classes:["fas",`fa-arrow-${e[1]}`],styles:t},this.bdiv).addEventListener("click",()=>{this._alterOffset(e[1])})}_addRButton(e){const t={position:"absolute",textAlign:"center"};t[e]="5px",createEl("i",{classes:["fas",`fa-angle-double-${e}`],styles:t,cursor:"pointer"},this.rDiv).addEventListener("click",s=>{const o=parseFloat(this.offsetAn.value);if(isNaN(o))return;const a=e==="left"?-o:o;this.plot.dataStore.setColumnOffset({group:this.groupSelect.value,rotation:a,filter:this.filter},!0),this._showOffsets(this.groupSelect.value)})}}class WGLScatterPlot extends WGLChart{constructor(e,t,r){const s=e.getColumnName(r.param[0]),o=e.getColumnName(r.param[1]);r.axis||(r.axis={x:{size:30,label:s,textsize:13},y:{size:45,label:o,textsize:13}}),r.title||(r.title=s+" x "+o),super(e,t,r,{x:{},y:{}}),this.x=this.config.param[0],this.y=this.config.param[1],this.dim=this.getDimension();const a=r.background_filter;a&&this.dim.setBackgroundFilter(a.column,a.category),this.minMaxX=this.dataStore.getMinMaxForColumn(this.x),this.minMaxY=this.dataStore.getMinMaxForColumn(this.y),this.type="wgl_scatter_plot";let l=this;const u=this.config;u.brush=u.brush||"poly";let p={brush:u.brush};this.app=new WGL2DI(this.graphDiv,p),this.app.addHandler("zoom_stopped",w=>this.handlePanZoom(w)),this.app.addHandler("panning_stopped",w=>this.handlePanZoom(w)),this.centerGraph();const d=this.afterAppCreation();this.app.setBackGroundColor(u.background_color),this.app.addHandler("brush_stopped",function(w,E){l.resetButton.style.display="inline",l.app.setFilter(!0),E?l._createPolyFilter(w):l._createFilter(w)}),u.background_image&&(u.image_opacity=u.image_opacity==null?1:u.image_opacity,this.addBackgroundImage(u.background_image));let m=this.dataStore.columnIndex[this.x],g=this.dataStore.columnIndex[this.y];this.app.addCircles({x:m.datatype==="int32"?new Float32Array(m.data):m.data,y:g.datatype==="int32"?new Float32Array(g.data):g.data,localFilter:this.dim.getLocalFilter(),globalFilter:this.dataStore.getFilter(),colorFunc:d}),this.defaultRadius=this._calculateRadius(),u.radius=u.radius||2,u.opacity=u.opacity==null?.8:u.opacity,this.app.setPointRadius(this.config.radius),this.app.setPointOpacity(this.config.opacity),this.onDataFiltered()}getDimension(){return this.dataStore.getDimension("range_dimension")}handlePanZoom(e){if(e.imageMoved){const t=e.imageMoved,r=this.config,s=r.background_image.name,o=r.image_choices.find(a=>a[0]===s);t.position[1]=-(t.position[1]+t.height),r.background_image.height=t.height,r.background_image.width=t.width,r.background_image.position=t.position,o[2]=t.width,o[3]=t.height,o[4]=t.position[0],o[5]=t.position[1]}else this._updateScale(e),this.updateAxis()}onDataAdded(e){const t=this.getSetupConfig();t.x=this.dataStore.getRawColumn(this.x),t.y=this.dataStore.getRawColumn(this.y),this.app.updateSize(e,t),super.onDataAdded(e)}addBackgroundImage(e,t=!1){const r=new Image,s=this.config;s.image_opacity=s.image_opacity||1,r.src=e.url,r.onload=()=>{t?this.app.changeImage(r,e,0):(this.app.addImage(r,e),this.app.changeImageOpacity(0,s.image_opacity)),this.app.refresh()}}linkToOtherChart(e){this.app.addHandler("pan_or_zoom",(t,r,s)=>{e.app.offset=[t[0],t[1]],e.app.x_scale=r,e.app.y_scale=s,e.app.refresh(),e._updateScale(this.app.getRange()),e.updateAxis()},this.config.id)}highlightDataItem(e){this.app.highlightPoint(e)}getFilter(){if(!this.range||this.range===!0)return null;const e={};return e[this.config.param[0]]=[this.range.x_min,this.range.x_max],e[this.config.param[1]]=[this.range.y_min,this.range.y_max],e}_updateScale(e){this.x_scale.domain([e.x_range[0],e.x_range[1]]),this.y_scale.domain([-e.y_range[0],-e.y_range[1]])}_calculateRadius(){this.width&&this.width;let e=this.config.max_x||this.config.max_x==0?this.config.max_x:this.minMaxX[1],t=this.config.min_x||this.config.min_x==0?this.config.min_x:this.minMaxX[0];this.config.axis.x_log_scale&&(e=this._getLogValue(e),t=this._getLogValue(t));let r=e-t;return Math.pow(r,1.5)/(Math.pow(this.dataStore.size,.8)+r)*5}_createFilter(e){if(this.range=e,e==null)this.dim.removeFilter();else{let t=e.y_max,r=e.y_min,s=e.x_max,o=e.x_min;this.config.axis.y_log_scale&&(t=this._getInverseLogValue(t),r=this._getInverseLogValue(r)),this.config.axis.x_log_scale&&(s=this._getInverseLogValue(s),o=this._getInverseLogValue(o)),this.filter=[[o,s],[r,t]],this.dim.filter("filterSquare",this.config.param,{range1:this.filter[0],range2:this.filter[1]})}}_createPolyFilter(e){this.range=!0;for(let t of e)t[1]=-t[1],this.config.axis.x_log_scale&&(t[0]=this._getInverseLogValue(t[0])),this.config.axis.y_log_scale&&(t[1]=this._getInverseLogValue(t[1]));this.filter=e,this.dim.filter("filterPoly",this.config.param,e)}centerGraph(){const e=this.config,t=e.roi||{};let r=t.max_x||this.minMaxX[1],s=t.max_y||this.minMaxY[1],o=t.min_x||this.minMaxX[0],a=t.min_y||this.minMaxY[0];if(e.center_using_quantiles){const g=this.dataStore.columnIndex[e.param[0]].quantiles,w=this.dataStore.columnIndex[e.param[1]].quantiles;g[e.center_using_quantiles],w[e.center_using_quantiles]}this.config.axis.y_log_scale&&(s=this._getLogValue(s),a=this._getLogValue(a)),this.config.axis.x_log_scale&&(r=this._getLogValue(r),o=this._getLogValue(o));let l=(r-o)/20,u=(s-a)/20,p=r-o+2*l,d=s-a+2*u;const m=this._getContentDimensions();this.app.x_scale=m.width/p,this.app.y_scale=m.height/d,this.app.pointScale=(this.app.x_scale+this.app.y_scale)/2,this.app.offset[0]=-(o-l),this.app.offset[1]=s+u,this._updateScale(this.app.getRange()),this.updateAxis()}getContextMenu(){var s;const e=super.getContextMenu(),t=this.config,r=this.dataStore;if(r.offsets){const o=r.offsets,a=r.getColumnName(o.groups);o.param[0]===t.param[0]&&o.param[1]===t.param[1]&&(!o.background_filter||o.background_filter===((s=t==null?void 0:t.background_filter)==null?void 0:s.column))&&e.push({text:`Adjust ${a} position`,icon:"fas fa-arrows-alt",func:()=>{new OffsetDialog(this)}})}return e}_addSliderToSettings(e,t,r){e.splice(1,0,{type:"slider",current_value:t.opacity,min:0,max:1,func:s=>{t.opacity=s,this.app.changeImageOpacity(r,s),this.app.refresh()}})}getConfig(){const e=super.getConfig();return e.offsets&&(e.offsets.offsets=this.app.offsets.values.offsets),e}getSettings(){const e=super.getSettings({pointMax:30,pointMin:0}),t=this.config;if(t.image_choices){const r=t.image_choices.slice(0);r.unshift(["None","__none__"]);let s="__none__";t.background_image&&(s=t.background_image.url),e.splice(1,0,{type:"dropdown",current_value:s,values:[r,0,1],label:"Change Image",func:o=>{if(o==="__none__"){delete t.background_image,this.app.removeImages(),this.app.refresh();return}let a=!0;t.background_image||(t.background_image={},a=!1),t.background_image.url=o;let l=t.title.split("-")[0];const u=t.image_choices.find(p=>p[1]===o);t.background_image.name=u[0],u[2]&&(t.background_image.width=u[2],t.background_image.height=u[3],t.background_image.position=[u[4],u[5]]),this.setTitle(l+"-"+u[0]),this.addBackgroundImage(t.background_image,a)}})}return t.background_image&&e.splice(2,0,{label:"Image Opacity",type:"slider",current_value:t.image_opacity,max:1,min:0,func:r=>{t.image_opacity=r,this.app.changeImageOpacity(0,r),this.app.refresh()}}),e.push({type:"radiobuttons",label:"Background Color",choices:[["none","none"],["white","white"],["light gray","lightgray"],["gray","gray"],["black","black"]],current_value:t.background_color||"none",func:r=>{r==="none"?delete t.background_color:t.background_color=r,this.app.setBackGroundColor(t.background_color)}}),e.concat([{type:"radiobuttons",label:"Brush Type",choices:[["Free Draw","poly"],["Rectangle","default"]],current_value:t.brush,func:r=>{this.app.clearBrush(),this.app.config.brush=r,t.brush=r}}])}}BaseChart.types.wgl_scatter_plot={name:"2D Scatter Plot",class:WGLScatterPlot,params:[{type:"number",name:"X axis"},{type:"number",name:"Y axis"}]};const pi$3=Math.PI,tau$3=2*pi$3,epsilon$2=1e-6,tauEpsilon$1=tau$3-epsilon$2;function Path$1(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path$1(){return new Path$1}Path$1.prototype=path$1.prototype={constructor:Path$1,moveTo:function(i,e){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(i,e){this._+="L"+(this._x1=+i)+","+(this._y1=+e)},quadraticCurveTo:function(i,e,t,r){this._+="Q"+ +i+","+ +e+","+(this._x1=+t)+","+(this._y1=+r)},bezierCurveTo:function(i,e,t,r,s,o){this._+="C"+ +i+","+ +e+","+ +t+","+ +r+","+(this._x1=+s)+","+(this._y1=+o)},arcTo:function(i,e,t,r,s){i=+i,e=+e,t=+t,r=+r,s=+s;var o=this._x1,a=this._y1,l=t-i,u=r-e,p=o-i,d=a-e,m=p*p+d*d;if(s<0)throw new Error("negative radius: "+s);if(this._x1===null)this._+="M"+(this._x1=i)+","+(this._y1=e);else if(m>epsilon$2)if(!(Math.abs(d*l-u*p)>epsilon$2)||!s)this._+="L"+(this._x1=i)+","+(this._y1=e);else{var g=t-o,w=r-a,E=l*l+u*u,A=g*g+w*w,k=Math.sqrt(E),O=Math.sqrt(m),ne=s*Math.tan((pi$3-Math.acos((E+m-A)/(2*k*O)))/2),Q=ne/O,ue=ne/k;Math.abs(Q-1)>epsilon$2&&(this._+="L"+(i+Q*p)+","+(e+Q*d)),this._+="A"+s+","+s+",0,0,"+ +(d*g>p*w)+","+(this._x1=i+ue*l)+","+(this._y1=e+ue*u)}},arc:function(i,e,t,r,s,o){i=+i,e=+e,t=+t,o=!!o;var a=t*Math.cos(r),l=t*Math.sin(r),u=i+a,p=e+l,d=1^o,m=o?r-s:s-r;if(t<0)throw new Error("negative radius: "+t);this._x1===null?this._+="M"+u+","+p:(Math.abs(this._x1-u)>epsilon$2||Math.abs(this._y1-p)>epsilon$2)&&(this._+="L"+u+","+p),t&&(m<0&&(m=m%tau$3+tau$3),m>tauEpsilon$1?this._+="A"+t+","+t+",0,1,"+d+","+(i-a)+","+(e-l)+"A"+t+","+t+",0,1,"+d+","+(this._x1=u)+","+(this._y1=p):m>epsilon$2&&(this._+="A"+t+","+t+",0,"+ +(m>=pi$3)+","+d+","+(this._x1=i+t*Math.cos(s))+","+(this._y1=e+t*Math.sin(s))))},rect:function(i,e,t,r){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)+"h"+ +t+"v"+ +r+"h"+-t+"Z"},toString:function(){return this._}};function constant$2(i){return function(){return i}}const abs$1=Math.abs,atan2=Math.atan2,cos=Math.cos,max=Math.max,min=Math.min,sin=Math.sin,sqrt$1=Math.sqrt,epsilon$1=1e-12,pi$2=Math.PI,halfPi=pi$2/2,tau$2=2*pi$2;function acos(i){return i>1?0:i<-1?pi$2:Math.acos(i)}function asin(i){return i>=1?halfPi:i<=-1?-halfPi:Math.asin(i)}function arcInnerRadius(i){return i.innerRadius}function arcOuterRadius(i){return i.outerRadius}function arcStartAngle(i){return i.startAngle}function arcEndAngle(i){return i.endAngle}function arcPadAngle(i){return i&&i.padAngle}function intersect(i,e,t,r,s,o,a,l){var u=t-i,p=r-e,d=a-s,m=l-o,g=m*u-d*p;if(!(g*g<epsilon$1))return g=(d*(e-o)-m*(i-s))/g,[i+g*u,e+g*p]}function cornerTangents(i,e,t,r,s,o,a){var l=i-t,u=e-r,p=(a?o:-o)/sqrt$1(l*l+u*u),d=p*u,m=-p*l,g=i+d,w=e+m,E=t+d,A=r+m,k=(g+E)/2,O=(w+A)/2,ne=E-g,Q=A-w,ue=ne*ne+Q*Q,U=s-o,_=g*A-E*w,Se=(Q<0?-1:1)*sqrt$1(max(0,U*U*ue-_*_)),Me=(_*Q-ne*Se)/ue,Ke=(-_*ne-Q*Se)/ue,kt=(_*Q+ne*Se)/ue,Qe=(-_*ne+Q*Se)/ue,ze=Me-k,Je=Ke-O,St=kt-k,Te=Qe-O;return ze*ze+Je*Je>St*St+Te*Te&&(Me=kt,Ke=Qe),{cx:Me,cy:Ke,x01:-d,y01:-m,x11:Me*(s/U-1),y11:Ke*(s/U-1)}}function arc(){var i=arcInnerRadius,e=arcOuterRadius,t=constant$2(0),r=null,s=arcStartAngle,o=arcEndAngle,a=arcPadAngle,l=null;function u(){var p,d,m=+i.apply(this,arguments),g=+e.apply(this,arguments),w=s.apply(this,arguments)-halfPi,E=o.apply(this,arguments)-halfPi,A=abs$1(E-w),k=E>w;if(l||(l=p=path$1()),g<m&&(d=g,g=m,m=d),!(g>epsilon$1))l.moveTo(0,0);else if(A>tau$2-epsilon$1)l.moveTo(g*cos(w),g*sin(w)),l.arc(0,0,g,w,E,!k),m>epsilon$1&&(l.moveTo(m*cos(E),m*sin(E)),l.arc(0,0,m,E,w,k));else{var O=w,ne=E,Q=w,ue=E,U=A,_=A,Se=a.apply(this,arguments)/2,Me=Se>epsilon$1&&(r?+r.apply(this,arguments):sqrt$1(m*m+g*g)),Ke=min(abs$1(g-m)/2,+t.apply(this,arguments)),kt=Ke,Qe=Ke,ze,Je;if(Me>epsilon$1){var St=asin(Me/m*sin(Se)),Te=asin(Me/g*sin(Se));(U-=St*2)>epsilon$1?(St*=k?1:-1,Q+=St,ue-=St):(U=0,Q=ue=(w+E)/2),(_-=Te*2)>epsilon$1?(Te*=k?1:-1,O+=Te,ne-=Te):(_=0,O=ne=(w+E)/2)}var dt=g*cos(O),ot=g*sin(O),yt=m*cos(ue),Ue=m*sin(ue);if(Ke>epsilon$1){var Nt=g*cos(ne),Ot=g*sin(ne),wi=m*cos(Q),Bi=m*sin(Q),Ei;if(A<pi$2&&(Ei=intersect(dt,ot,wi,Bi,Nt,Ot,yt,Ue))){var Zi=dt-Ei[0],fr=ot-Ei[1],Ti=Nt-Ei[0],Lt=Ot-Ei[1],je=1/sin(acos((Zi*Ti+fr*Lt)/(sqrt$1(Zi*Zi+fr*fr)*sqrt$1(Ti*Ti+Lt*Lt)))/2),mt=sqrt$1(Ei[0]*Ei[0]+Ei[1]*Ei[1]);kt=min(Ke,(m-mt)/(je-1)),Qe=min(Ke,(g-mt)/(je+1))}}_>epsilon$1?Qe>epsilon$1?(ze=cornerTangents(wi,Bi,dt,ot,g,Qe,k),Je=cornerTangents(Nt,Ot,yt,Ue,g,Qe,k),l.moveTo(ze.cx+ze.x01,ze.cy+ze.y01),Qe<Ke?l.arc(ze.cx,ze.cy,Qe,atan2(ze.y01,ze.x01),atan2(Je.y01,Je.x01),!k):(l.arc(ze.cx,ze.cy,Qe,atan2(ze.y01,ze.x01),atan2(ze.y11,ze.x11),!k),l.arc(0,0,g,atan2(ze.cy+ze.y11,ze.cx+ze.x11),atan2(Je.cy+Je.y11,Je.cx+Je.x11),!k),l.arc(Je.cx,Je.cy,Qe,atan2(Je.y11,Je.x11),atan2(Je.y01,Je.x01),!k))):(l.moveTo(dt,ot),l.arc(0,0,g,O,ne,!k)):l.moveTo(dt,ot),!(m>epsilon$1)||!(U>epsilon$1)?l.lineTo(yt,Ue):kt>epsilon$1?(ze=cornerTangents(yt,Ue,Nt,Ot,m,-kt,k),Je=cornerTangents(dt,ot,wi,Bi,m,-kt,k),l.lineTo(ze.cx+ze.x01,ze.cy+ze.y01),kt<Ke?l.arc(ze.cx,ze.cy,kt,atan2(ze.y01,ze.x01),atan2(Je.y01,Je.x01),!k):(l.arc(ze.cx,ze.cy,kt,atan2(ze.y01,ze.x01),atan2(ze.y11,ze.x11),!k),l.arc(0,0,m,atan2(ze.cy+ze.y11,ze.cx+ze.x11),atan2(Je.cy+Je.y11,Je.cx+Je.x11),k),l.arc(Je.cx,Je.cy,kt,atan2(Je.y11,Je.x11),atan2(Je.y01,Je.x01),!k))):l.arc(0,0,m,ue,Q,k)}if(l.closePath(),p)return l=null,p+""||null}return u.centroid=function(){var p=(+i.apply(this,arguments)+ +e.apply(this,arguments))/2,d=(+s.apply(this,arguments)+ +o.apply(this,arguments))/2-pi$2/2;return[cos(d)*p,sin(d)*p]},u.innerRadius=function(p){return arguments.length?(i=typeof p=="function"?p:constant$2(+p),u):i},u.outerRadius=function(p){return arguments.length?(e=typeof p=="function"?p:constant$2(+p),u):e},u.cornerRadius=function(p){return arguments.length?(t=typeof p=="function"?p:constant$2(+p),u):t},u.padRadius=function(p){return arguments.length?(r=p==null?null:typeof p=="function"?p:constant$2(+p),u):r},u.startAngle=function(p){return arguments.length?(s=typeof p=="function"?p:constant$2(+p),u):s},u.endAngle=function(p){return arguments.length?(o=typeof p=="function"?p:constant$2(+p),u):o},u.padAngle=function(p){return arguments.length?(a=typeof p=="function"?p:constant$2(+p),u):a},u.context=function(p){return arguments.length?(l=p??null,u):l},u}function array(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function Linear(i){this._context=i}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,e){switch(i=+i,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,e):this._context.moveTo(i,e);break;case 1:this._point=2;default:this._context.lineTo(i,e);break}}};function curveLinear(i){return new Linear(i)}function x$1(i){return i[0]}function y$1(i){return i[1]}function line(i,e){var t=constant$2(!0),r=null,s=curveLinear,o=null;i=typeof i=="function"?i:i===void 0?x$1:constant$2(i),e=typeof e=="function"?e:e===void 0?y$1:constant$2(e);function a(l){var u,p=(l=array(l)).length,d,m=!1,g;for(r==null&&(o=s(g=path$1())),u=0;u<=p;++u)!(u<p&&t(d=l[u],u,l))===m&&((m=!m)?o.lineStart():o.lineEnd()),m&&o.point(+i(d,u,l),+e(d,u,l));if(g)return o=null,g+""||null}return a.x=function(l){return arguments.length?(i=typeof l=="function"?l:constant$2(+l),a):i},a.y=function(l){return arguments.length?(e=typeof l=="function"?l:constant$2(+l),a):e},a.defined=function(l){return arguments.length?(t=typeof l=="function"?l:constant$2(!!l),a):t},a.curve=function(l){return arguments.length?(s=l,r!=null&&(o=s(r)),a):s},a.context=function(l){return arguments.length?(l==null?r=o=null:o=s(r=l),a):r},a}function area(i,e,t){var r=null,s=constant$2(!0),o=null,a=curveLinear,l=null;i=typeof i=="function"?i:i===void 0?x$1:constant$2(+i),e=typeof e=="function"?e:constant$2(e===void 0?0:+e),t=typeof t=="function"?t:t===void 0?y$1:constant$2(+t);function u(d){var m,g,w,E=(d=array(d)).length,A,k=!1,O,ne=new Array(E),Q=new Array(E);for(o==null&&(l=a(O=path$1())),m=0;m<=E;++m){if(!(m<E&&s(A=d[m],m,d))===k)if(k=!k)g=m,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),w=m-1;w>=g;--w)l.point(ne[w],Q[w]);l.lineEnd(),l.areaEnd()}k&&(ne[m]=+i(A,m,d),Q[m]=+e(A,m,d),l.point(r?+r(A,m,d):ne[m],t?+t(A,m,d):Q[m]))}if(O)return l=null,O+""||null}function p(){return line().defined(s).curve(a).context(o)}return u.x=function(d){return arguments.length?(i=typeof d=="function"?d:constant$2(+d),r=null,u):i},u.x0=function(d){return arguments.length?(i=typeof d=="function"?d:constant$2(+d),u):i},u.x1=function(d){return arguments.length?(r=d==null?null:typeof d=="function"?d:constant$2(+d),u):r},u.y=function(d){return arguments.length?(e=typeof d=="function"?d:constant$2(+d),t=null,u):e},u.y0=function(d){return arguments.length?(e=typeof d=="function"?d:constant$2(+d),u):e},u.y1=function(d){return arguments.length?(t=d==null?null:typeof d=="function"?d:constant$2(+d),u):t},u.lineX0=u.lineY0=function(){return p().x(i).y(e)},u.lineY1=function(){return p().x(i).y(t)},u.lineX1=function(){return p().x(r).y(e)},u.defined=function(d){return arguments.length?(s=typeof d=="function"?d:constant$2(!!d),u):s},u.curve=function(d){return arguments.length?(a=d,o!=null&&(l=a(o)),u):a},u.context=function(d){return arguments.length?(d==null?o=l=null:l=a(o=d),u):o},u}function descending(i,e){return e<i?-1:e>i?1:e>=i?0:NaN}function identity$1(i){return i}function pie(){var i=identity$1,e=descending,t=null,r=constant$2(0),s=constant$2(tau$2),o=constant$2(0);function a(l){var u,p=(l=array(l)).length,d,m,g=0,w=new Array(p),E=new Array(p),A=+r.apply(this,arguments),k=Math.min(tau$2,Math.max(-tau$2,s.apply(this,arguments)-A)),O,ne=Math.min(Math.abs(k)/p,o.apply(this,arguments)),Q=ne*(k<0?-1:1),ue;for(u=0;u<p;++u)(ue=E[w[u]=u]=+i(l[u],u,l))>0&&(g+=ue);for(e!=null?w.sort(function(U,_){return e(E[U],E[_])}):t!=null&&w.sort(function(U,_){return t(l[U],l[_])}),u=0,m=g?(k-p*Q)/g:0;u<p;++u,A=O)d=w[u],ue=E[d],O=A+(ue>0?ue*m:0)+Q,E[d]={data:l[d],index:u,value:ue,startAngle:A,endAngle:O,padAngle:ne};return E}return a.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant$2(+l),a):i},a.sortValues=function(l){return arguments.length?(e=l,t=null,a):e},a.sort=function(l){return arguments.length?(t=l,e=null,a):t},a.startAngle=function(l){return arguments.length?(r=typeof l=="function"?l:constant$2(+l),a):r},a.endAngle=function(l){return arguments.length?(s=typeof l=="function"?l:constant$2(+l),a):s},a.padAngle=function(l){return arguments.length?(o=typeof l=="function"?l:constant$2(+l),a):o},a}function point(i,e,t){i._context.bezierCurveTo((2*i._x0+i._x1)/3,(2*i._y0+i._y1)/3,(i._x0+2*i._x1)/3,(i._y0+2*i._y1)/3,(i._x0+4*i._x1+e)/6,(i._y0+4*i._y1+t)/6)}function Basis(i){this._context=i}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:point(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(i,e){switch(i=+i,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(i,e):this._context.moveTo(i,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point(this,i,e);break}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=e}};function curveBasis(i){return new Basis(i)}class RingChart extends CategoryChart{constructor(e,t,r){super(e,t,r,{x:{}}),this.config.type="ring_chart",this.pie=pie().sort(null).value(s=>s[0]),this.arc=arc(),this.onDataFiltered(null)}drawChart(e=1e3){select(this.contentDiv).transition().duration(e).ease(linear);const t=this._getContentDimensions(),r=Math.min(t.width,t.height)/2,s=t.left+t.width/2,o=t.top+t.height/2;this.graph_area.attr("transform",`translate(${s},${o})`),this.arc.innerRadius(r*.5).outerRadius(r*.9);const a=Math.floor(r/8),l=this.dataStore.getColumnValues(this.config.param),u=this.dataStore.getColumnColors(this.config.param),p=this.pie(this.rowData.filter(m=>m[0]!==0)),d=this;this.graph_area.selectAll(".pie-arc").data(p,(m,g)=>{m.data[1]}).join("path").on("click",(m,g)=>{d.filterCategories(l[g.data[1]],m.shiftKey)}).style("fill",(m,g)=>d.filter.length>0&&d.filter.indexOf(l[m.data[1]])===-1?"lightgray":u[m.data[1]]).attr("class","pie-arc").attr("stroke","white").attr("d",this.arc).style("stroke-width","2px"),this.graph_area.selectAll(".pie-text").data(p,(m,g)=>{m.data[1]}).join("text").on("click",(m,g)=>{d.filterCategories(l[g.data[1]],m.shiftKey)}).attr("class","pie-text").text((m,g)=>m.endAngle-m.startAngle>.4?l[m.data[1]]:"").attr("x",m=>d.arc.centroid(m)[0]).attr("font-size",a+"px").attr("y",m=>d.arc.centroid(m)[1]).attr("text-anchor","middle").attr("dominant-baseline","central")}}BaseChart.types.ring_chart={class:RingChart,name:"Pie Chart",params:[{type:"text",name:"Category"}]};const scriptRel="modulepreload",assetsURL=function(i,e){return new URL(i,e).href},seen={},__vitePreload=function i(e,t,r){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=assetsURL(o,r),o in seen)return;seen[o]=!0;const a=o.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!r)for(let d=s.length-1;d>=0;d--){const m=s[d];if(m.href===o&&(!a||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const p=document.createElement("link");if(p.rel=a?"stylesheet":scriptRel,a||(p.as="script",p.crossOrigin=""),p.href=o,document.head.appendChild(p),a)return new Promise((d,m)=>{p.addEventListener("load",d),p.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())};class TextBoxChart extends BaseChart{constructor(e,t,r){super(e,t,r);const s=this.config;s.text=s.text||"",this.para=createEl("div",{styles:{padding:"5px"}},this.contentDiv),__vitePreload(()=>import("./MarkdownText-d15485df.js"),[],import.meta.url).then(({default:o})=>{this.render=o,this.para.innerHTML=this.render(s.text)})}getSettings(){const e=super.getSettings(),t=this.config;return e.push({label:"Text",type:"textbox",current_value:t.text,func:r=>{t.text=r,this.para.innerHTML=this.render(r)}}),e}}BaseChart.types.text_box_chart={class:TextBoxChart,name:"Text Box",params:[],extra_controls:()=>[{type:"textbox",name:"text"}],init:(i,e,t)=>{i.text=t.text}};const distances={euclidean:function(i,e){for(var t=0,r=0;r<i.length;r++)t+=Math.pow(isNaN(e[r])?0:e[r]-i[r],2);return Math.sqrt(t)},manhattan:function(i,e){for(var t=0,r=0;r<i.length;r++)t+=Math.abs(e[r]-i[r]);return t},max:function(i,e){for(var t=0,r=0;r<i.length;r++)t=Math.max(t,Math.abs(e[r]-i[r]));return t}};class HierarchicalClustering{constructor(e,t,r){this.distance=distances[e],this.distance||(this.distance=distances.euclidean),this.linkage=t||"average",this.threshold=r??1/0}cluster(e,t,r){this.clusters=[],this.dists=[],this.mins=[],this.index=[];for(var u=0;u<e.length;u++){var s={value:e[u],key:u,index:u,size:1};this.clusters[u]=s,this.index[u]=s,this.dists[u]=[],this.mins[u]=0}for(var u=0;u<this.clusters.length;u++)for(var o=0;o<=u;o++){var a=u==o?1/0:this.distance(this.clusters[u].value,this.clusters[o].value);this.dists[u][o]=a,this.dists[o][u]=a,a<this.dists[u][this.mins[u]]&&(this.mins[u]=o)}for(var l=this.mergeClosest(),u=0;l;)r&&u++%t==0&&r(this.clusters),l=this.mergeClosest();return this.clusters.forEach(function(p){delete p.key,delete p.index}),this.node_order=[],this.order=0,this.orderClusters(this.clusters[0]),this.clusters}mergeClosest(){for(var e=0,t=1/0,r=0;r<this.clusters.length;r++){var s=this.clusters[r].key,o=this.dists[s][this.mins[s]];o<t&&(e=s,t=o)}if(t>=this.threshold)return!1;var a=this.index[e],l=this.index[this.mins[e]],u={children:[a,l],key:a.key,size:a.size+l.size};this.clusters[a.index]=u,this.clusters.splice(l.index,1),this.index[a.key]=u;for(var r=0;r<this.clusters.length;r++){var p=this.clusters[r],o;a.key==p.key?o=1/0:this.linkage=="single"?(o=this.dists[a.key][p.key],this.dists[a.key][p.key]>this.dists[l.key][p.key]&&(o=this.dists[l.key][p.key])):this.linkage=="complete"?(o=this.dists[a.key][p.key],this.dists[a.key][p.key]<this.dists[l.key][p.key]&&(o=this.dists[l.key][p.key])):this.linkage=="average"?o=(this.dists[a.key][p.key]*a.size+this.dists[l.key][p.key]*l.size)/(a.size+l.size):o=this.distance(p.value,a.value),this.dists[a.key][p.key]=this.dists[p.key][a.key]=o}for(var r=0;r<this.clusters.length;r++){var d=this.clusters[r].key;if(this.mins[d]==a.key||this.mins[d]==l.key){for(var t=d,m=0;m<this.clusters.length;m++){var g=this.clusters[m].key;this.dists[d][g]<this.dists[d][t]&&(t=g)}this.mins[d]=t}this.clusters[r].index=r}return delete a.key,delete l.key,delete a.index,delete l.index,!0}orderClusters(e){for(let t in e)t==="children"&&(this.orderClusters(e[t][0]),this.orderClusters(e[t][1])),t==="value"&&(e[t]._order=this.order++,this.node_order.push(e[t]._id))}}function getHierarchicalNodes(i,e={}){const t=new HierarchicalClustering(e.distance,e.linkage,e.threshold);t.cluster(i);const r=hierarchy(t.clusters[0]);for(let s of r.descendants()){let o=s.data;delete o.size,o.value&&(o.id=o.value._id,o.order=o.value._order,delete o.value)}return{nodes:r,order:t.node_order}}var EOL={},EOF={},QUOTE=34,NEWLINE=10,RETURN=13;function objectConverter(i){return new Function("d","return {"+i.map(function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'}).join(",")+"}")}function customConverter(i,e){var t=objectConverter(i);return function(r,s){return e(t(r),s,i)}}function inferColumns(i){var e=Object.create(null),t=[];return i.forEach(function(r){for(var s in r)s in e||t.push(e[s]=s)}),t}function pad(i,e){var t=i+"",r=t.length;return r<e?new Array(e-r+1).join(0)+t:t}function formatYear(i){return i<0?"-"+pad(-i,6):i>9999?"+"+pad(i,6):pad(i,4)}function formatDate(i){var e=i.getUTCHours(),t=i.getUTCMinutes(),r=i.getUTCSeconds(),s=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":formatYear(i.getUTCFullYear())+"-"+pad(i.getUTCMonth()+1,2)+"-"+pad(i.getUTCDate(),2)+(s?"T"+pad(e,2)+":"+pad(t,2)+":"+pad(r,2)+"."+pad(s,3)+"Z":r?"T"+pad(e,2)+":"+pad(t,2)+":"+pad(r,2)+"Z":t||e?"T"+pad(e,2)+":"+pad(t,2)+"Z":"")}function dsvFormat(i){var e=new RegExp('["'+i+`
\r]`),t=i.charCodeAt(0);function r(m,g){var w,E,A=s(m,function(k,O){if(w)return w(k,O-1);E=k,w=g?customConverter(k,g):objectConverter(k)});return A.columns=E||[],A}function s(m,g){var w=[],E=m.length,A=0,k=0,O,ne=E<=0,Q=!1;m.charCodeAt(E-1)===NEWLINE&&--E,m.charCodeAt(E-1)===RETURN&&--E;function ue(){if(ne)return EOF;if(Q)return Q=!1,EOL;var _,Se=A,Me;if(m.charCodeAt(Se)===QUOTE){for(;A++<E&&m.charCodeAt(A)!==QUOTE||m.charCodeAt(++A)===QUOTE;);return(_=A)>=E?ne=!0:(Me=m.charCodeAt(A++))===NEWLINE?Q=!0:Me===RETURN&&(Q=!0,m.charCodeAt(A)===NEWLINE&&++A),m.slice(Se+1,_-1).replace(/""/g,'"')}for(;A<E;){if((Me=m.charCodeAt(_=A++))===NEWLINE)Q=!0;else if(Me===RETURN)Q=!0,m.charCodeAt(A)===NEWLINE&&++A;else if(Me!==t)continue;return m.slice(Se,_)}return ne=!0,m.slice(Se,E)}for(;(O=ue())!==EOF;){for(var U=[];O!==EOL&&O!==EOF;)U.push(O),O=ue();g&&(U=g(U,k++))==null||w.push(U)}return w}function o(m,g){return m.map(function(w){return g.map(function(E){return d(w[E])}).join(i)})}function a(m,g){return g==null&&(g=inferColumns(m)),[g.map(d).join(i)].concat(o(m,g)).join(`
`)}function l(m,g){return g==null&&(g=inferColumns(m)),o(m,g).join(`
`)}function u(m){return m.map(p).join(`
`)}function p(m){return m.map(d).join(i)}function d(m){return m==null?"":m instanceof Date?formatDate(m):e.test(m+="")?'"'+m.replace(/"/g,'""')+'"':m}return{parse:r,parseRows:s,format:a,formatBody:l,formatRows:u,formatRow:p,formatValue:d}}var csv$1=dsvFormat(","),csvParse=csv$1.parse,tsv$1=dsvFormat("	"),tsvParse=tsv$1.parse;function responseText(i){if(!i.ok)throw new Error(i.status+" "+i.statusText);return i.text()}function text(i,e){return fetch(i,e).then(responseText)}function dsvParse(i){return function(e,t,r){return arguments.length===2&&typeof t=="function"&&(r=t,t=void 0),text(e,t).then(function(s){return i(s,r)})}}var csv=dsvParse(csvParse),tsv=dsvParse(tsvParse);function responseJson(i){if(!i.ok)throw new Error(i.status+" "+i.statusText);if(!(i.status===204||i.status===205))return i.json()}function json(i,e){return fetch(i,e).then(responseJson)}var pi$1=Math.PI,tau$1=pi$1*2,abs=Math.abs,sqrt=Math.sqrt;function noop(){}function streamGeometry(i,e){i&&streamGeometryType.hasOwnProperty(i.type)&&streamGeometryType[i.type](i,e)}var streamObjectType={Feature:function(i,e){streamGeometry(i.geometry,e)},FeatureCollection:function(i,e){for(var t=i.features,r=-1,s=t.length;++r<s;)streamGeometry(t[r].geometry,e)}},streamGeometryType={Sphere:function(i,e){e.sphere()},Point:function(i,e){i=i.coordinates,e.point(i[0],i[1],i[2])},MultiPoint:function(i,e){for(var t=i.coordinates,r=-1,s=t.length;++r<s;)i=t[r],e.point(i[0],i[1],i[2])},LineString:function(i,e){streamLine(i.coordinates,e,0)},MultiLineString:function(i,e){for(var t=i.coordinates,r=-1,s=t.length;++r<s;)streamLine(t[r],e,0)},Polygon:function(i,e){streamPolygon(i.coordinates,e)},MultiPolygon:function(i,e){for(var t=i.coordinates,r=-1,s=t.length;++r<s;)streamPolygon(t[r],e)},GeometryCollection:function(i,e){for(var t=i.geometries,r=-1,s=t.length;++r<s;)streamGeometry(t[r],e)}};function streamLine(i,e,t){var r=-1,s=i.length-t,o;for(e.lineStart();++r<s;)o=i[r],e.point(o[0],o[1],o[2]);e.lineEnd()}function streamPolygon(i,e){var t=-1,r=i.length;for(e.polygonStart();++t<r;)streamLine(i[t],e,1);e.polygonEnd()}function geoStream(i,e){i&&streamObjectType.hasOwnProperty(i.type)?streamObjectType[i.type](i,e):streamGeometry(i,e)}const identity=i=>i;var areaSum=new Adder,areaRingSum=new Adder,x00$2,y00$2,x0$3,y0$3,areaStream={point:noop,lineStart:noop,lineEnd:noop,polygonStart:function(){areaStream.lineStart=areaRingStart,areaStream.lineEnd=areaRingEnd},polygonEnd:function(){areaStream.lineStart=areaStream.lineEnd=areaStream.point=noop,areaSum.add(abs(areaRingSum)),areaRingSum=new Adder},result:function(){var i=areaSum/2;return areaSum=new Adder,i}};function areaRingStart(){areaStream.point=areaPointFirst}function areaPointFirst(i,e){areaStream.point=areaPoint,x00$2=x0$3=i,y00$2=y0$3=e}function areaPoint(i,e){areaRingSum.add(y0$3*i-x0$3*e),x0$3=i,y0$3=e}function areaRingEnd(){areaPoint(x00$2,y00$2)}const pathArea=areaStream;var x0$2=1/0,y0$2=x0$2,x1=-x0$2,y1=x1,boundsStream={point:boundsPoint,lineStart:noop,lineEnd:noop,polygonStart:noop,polygonEnd:noop,result:function(){var i=[[x0$2,y0$2],[x1,y1]];return x1=y1=-(y0$2=x0$2=1/0),i}};function boundsPoint(i,e){i<x0$2&&(x0$2=i),i>x1&&(x1=i),e<y0$2&&(y0$2=e),e>y1&&(y1=e)}const boundsStream$1=boundsStream;var X0=0,Y0=0,Z0=0,X1=0,Y1=0,Z1=0,X2=0,Y2=0,Z2=0,x00$1,y00$1,x0$1,y0$1,centroidStream={point:centroidPoint,lineStart:centroidLineStart,lineEnd:centroidLineEnd,polygonStart:function(){centroidStream.lineStart=centroidRingStart,centroidStream.lineEnd=centroidRingEnd},polygonEnd:function(){centroidStream.point=centroidPoint,centroidStream.lineStart=centroidLineStart,centroidStream.lineEnd=centroidLineEnd},result:function(){var i=Z2?[X2/Z2,Y2/Z2]:Z1?[X1/Z1,Y1/Z1]:Z0?[X0/Z0,Y0/Z0]:[NaN,NaN];return X0=Y0=Z0=X1=Y1=Z1=X2=Y2=Z2=0,i}};function centroidPoint(i,e){X0+=i,Y0+=e,++Z0}function centroidLineStart(){centroidStream.point=centroidPointFirstLine}function centroidPointFirstLine(i,e){centroidStream.point=centroidPointLine,centroidPoint(x0$1=i,y0$1=e)}function centroidPointLine(i,e){var t=i-x0$1,r=e-y0$1,s=sqrt(t*t+r*r);X1+=s*(x0$1+i)/2,Y1+=s*(y0$1+e)/2,Z1+=s,centroidPoint(x0$1=i,y0$1=e)}function centroidLineEnd(){centroidStream.point=centroidPoint}function centroidRingStart(){centroidStream.point=centroidPointFirstRing}function centroidRingEnd(){centroidPointRing(x00$1,y00$1)}function centroidPointFirstRing(i,e){centroidStream.point=centroidPointRing,centroidPoint(x00$1=x0$1=i,y00$1=y0$1=e)}function centroidPointRing(i,e){var t=i-x0$1,r=e-y0$1,s=sqrt(t*t+r*r);X1+=s*(x0$1+i)/2,Y1+=s*(y0$1+e)/2,Z1+=s,s=y0$1*i-x0$1*e,X2+=s*(x0$1+i),Y2+=s*(y0$1+e),Z2+=s*3,centroidPoint(x0$1=i,y0$1=e)}const pathCentroid=centroidStream;function PathContext(i){this._context=i}PathContext.prototype={_radius:4.5,pointRadius:function(i){return this._radius=i,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(i,e){switch(this._point){case 0:{this._context.moveTo(i,e),this._point=1;break}case 1:{this._context.lineTo(i,e);break}default:{this._context.moveTo(i+this._radius,e),this._context.arc(i,e,this._radius,0,tau$1);break}}},result:noop};var lengthSum=new Adder,lengthRing,x00,y00,x0,y0,lengthStream={point:noop,lineStart:function(){lengthStream.point=lengthPointFirst},lineEnd:function(){lengthRing&&lengthPoint(x00,y00),lengthStream.point=noop},polygonStart:function(){lengthRing=!0},polygonEnd:function(){lengthRing=null},result:function(){var i=+lengthSum;return lengthSum=new Adder,i}};function lengthPointFirst(i,e){lengthStream.point=lengthPoint,x00=x0=i,y00=y0=e}function lengthPoint(i,e){x0-=i,y0-=e,lengthSum.add(sqrt(x0*x0+y0*y0)),x0=i,y0=e}const pathMeasure=lengthStream;function PathString(){this._string=[]}PathString.prototype={_radius:4.5,_circle:circle(4.5),pointRadius:function(i){return(i=+i)!==this._radius&&(this._radius=i,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(i,e){switch(this._point){case 0:{this._string.push("M",i,",",e),this._point=1;break}case 1:{this._string.push("L",i,",",e);break}default:{this._circle==null&&(this._circle=circle(this._radius)),this._string.push("M",i,",",e,this._circle);break}}},result:function(){if(this._string.length){var i=this._string.join("");return this._string=[],i}else return null}};function circle(i){return"m0,"+i+"a"+i+","+i+" 0 1,1 0,"+-2*i+"a"+i+","+i+" 0 1,1 0,"+2*i+"z"}function geoPath(i,e){var t=4.5,r,s;function o(a){return a&&(typeof t=="function"&&s.pointRadius(+t.apply(this,arguments)),geoStream(a,r(s))),s.result()}return o.area=function(a){return geoStream(a,r(pathArea)),pathArea.result()},o.measure=function(a){return geoStream(a,r(pathMeasure)),pathMeasure.result()},o.bounds=function(a){return geoStream(a,r(boundsStream$1)),boundsStream$1.result()},o.centroid=function(a){return geoStream(a,r(pathCentroid)),pathCentroid.result()},o.projection=function(a){return arguments.length?(r=a==null?(i=null,identity):(i=a).stream,o):i},o.context=function(a){return arguments.length?(s=a==null?(e=null,new PathString):new PathContext(e=a),typeof t!="function"&&s.pointRadius(t),o):e},o.pointRadius=function(a){return arguments.length?(t=typeof a=="function"?a:(s.pointRadius(+a),+a),o):t},o.projection(i).context(e)}function Transform(i,e,t){this.k=i,this.x=e,this.y=t}Transform.prototype={constructor:Transform,scale:function(i){return i===1?this:new Transform(this.k*i,this.x,this.y)},translate:function(i,e){return i===0&e===0?this:new Transform(this.k,this.x+this.k*i,this.y+this.k*e)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Transform.prototype;class HeatMap extends SVGChart{constructor(e,t,r){r.title=r.title||e.getColumnName(r.param[0]),super(e,t,r,{x:{type:"band"},y:{type:"band"},tx:{custom:!0,size:45}});const s=this.config.param,o=this.dataStore.getColumnValues(s[0]);this.x_scale.domain(o.slice(0));const a=[],l=this.config;l.method=l.method||"mean",l.color_scale=l.color_scale||{log:!1},l.color_legend||(l.color_legend={display:!0}),this.setColorFunction();for(let u=1;u<s.length;u++)a.push(this.dataStore.getColumnName(s[u]));this.cat_scale=linear$1().range([0,40]),this.cat_axis_svg=this.svg.append("g"),this.cat_axis_call=axisLeft(this.cat_scale).ticks(3),this.y_scale.domain(a),this.dim=this.dataStore.getDimension("catcol_dimension"),l.cluster_rows&&(this.margins.right=70),this.addToolTip(),this.onDataFiltered()}remove(e=!0){this.dim.destroy(e),super.remove()}setColorFunction(){const e=this.config.param,t={useValue:!0,overideValues:{colorLogScale:this.config.color_scale.log,colors:["#313695","#4575B4","#74ADD1","#ABD9E9","#E0F3F8","#E0F3F8","#FFFFBF","#FEE090","#FDAE61","#F46D43","#D73027","#A50026"],max:1,min:0}};this.colorFunction=this.dataStore.getColorFunction(e[1],t),this.setColorLegend()}getColorLegend(){const t={overideValues:{max:1,min:0,colorLogScale:this.config.color_scale.log,colors:["#313695","#4575B4","#74ADD1","#ABD9E9","#E0F3F8","#E0F3F8","#FFFFBF","#FEE090","#FDAE61","#F46D43","#D73027","#A50026"]},name:"Scale"};return this.dataStore.getColorLegend(this.config.param[1],t)}onDataFiltered(e){if(this.dim===e||this.isPinned)return;e==="all_removed"&&(this.filter=[],this.resetButton.style.display="none");const t={method:this.config.method,scaleVals:[]},r=this.config.param;let s=this.config.color_scale.trim=="none"?null:this.config.color_scale.trim;for(let o=1;o<r.length;o++){const a=this.dataStore.columnIndex[r[o]];t.scaleVals.push([s?a.quantiles[s][0]:a.minMax[0],s?a.quantiles[s][1]:a.minMax[1]])}this.dim.getAverages(o=>{this.data=o,this.clusterRows(),this.clusterColumns(),this.drawChart()},this.config.param,t)}clusterRows(){this.config.cluster_rows?(this.rowClusterNodes=getHierarchicalNodes(this.data.averages),this.data.averages.sort((e,t)=>e._order-t._order),this.margins.right=70,this.y_scale.domain(this.rowClusterNodes.order.map(e=>this.dataStore.getColumnName(this.config.param[e+1])))):(delete this.rowClusterNodes,this.y_scale.domain(this.config.param.slice(1).map(e=>this.dataStore.getColumnName(e))),this.margins.right=10,this.data.averages.sort((e,t)=>e._id-t._id),this.ry_axis_svg.selectAll("*").remove())}clusterColumns(){const e=this.dataStore.getColumnValues(this.config.param[0]);this.config.cluster_columns?(this.columnClusterNodes=getHierarchicalNodes(this.data.transpose),this.data.transpose.sort((t,r)=>t._order-r._order),this.x_scale.domain(this.columnClusterNodes.order.map(t=>e[t])),this.setAxisSize("tx",85)):(delete this.columnClusterNodes,this.x_scale.domain(this.data.transpose.map(t=>e[t._id])),this.setAxisSize("tx",45),this.data.transpose.sort((t,r)=>t._id-r._id),this.x_scale.domain(this.data.transpose.map(t=>e[t._id])),this.tx_axis_svg.selectAll("path").remove())}drawChart(e=400){const t=select(this.contentDiv).transition().duration(e).ease(linear),r=this.dataStore.getColumnValues(this.config.param[0]),s=this.dataStore.getColumnColors(this.config.param[0]),o=this._getContentDimensions(),a=o.width/this.data.transpose.length,l=a/2,u=Math.max(...this.data.catTotals),p=40;this.cat_scale.domain([u,0]);const d=u===0?0:40/u,m=this.data.transpose.map(A=>[this.data.catTotals[A._id],A._id]),g=this,w=o.height/(this.config.param.length-1);this.graph_area.selectAll(".heatmap-row").data(this.data.averages).join("g").attr("transform",(A,k)=>`translate(0,${k*w})`).attr("class","heatmap-row").selectAll(".heatmap-rect").data(A=>A.map((k,O)=>{const ne=A._id,Q=g.data.transpose[O]._id;return{av:g.data.transpose[O][ne],row_id:ne,col_id:Q,miss:!1}})).join("rect").attr("class","heatmap-rect").attr("x",(A,k)=>k*a).attr("height",w).attr("width",a).on("click",(A,k)=>{const O=g.config.param[k.row_id+1];this._callListeners("cell_clicked",{row:O,col:r[k.col_id],val:k.av})}).on("mouseover mousemove",(A,k)=>{const O=g.dataStore.columnIndex[g.config.param[k.row_id+1]].name;g.showToolTip(A,`${r[k.col_id]}<br>${O}<br>${k.av.toPrecision(2)}`)}).on("mouseleave",()=>{g.hideToolTip()}).transition(t).attr("fill",(A,k)=>A.miss?"#DCDCDC":g.colorFunction(A.av));const E=select(this.contentDiv).transition().duration(e).ease(linear);this.tx_axis_svg.selectAll(".heatmap-catsize").data(m,(A,k)=>A[1]).join(A=>A.append("rect").attr("class","heatmap-catsize").attr("height",0).attr("y",45).attr("x",(k,O)=>l/2+O*a).attr("width",l),A=>A,A=>A.call(k=>k.transition(E).attr("height",0).attr("y",45).remove())).transition(E).attr("y",A=>p-A[0]*d+5).attr("height",A=>A[0]*d).attr("fill",(A,k)=>s[A[1]]).attr("width",l).attr("x",(A,k)=>l/2+k*a),this.cat_axis_svg.attr("transform",`translate(${o.left},5)`),this.cat_axis_svg.transition().call(this.cat_axis_call),this.updateAxis(),this.rowClusterNodes&&this.drawYTree(this.rowClusterNodes.nodes,this.config.param.length-1),this.columnClusterNodes&&this.drawXTree(this.columnClusterNodes.nodes,this.data.transpose.length,40,45)}setSize(e,t){super.setSize(e,t),this.drawChart()}getSettings(){const e=this.config;return super.getSettings().concat([{type:"check",label:"Cluster Rows",current_value:e.cluster_rows,func:r=>{e.cluster_rows=r,this.clusterRows(),this.drawChart()}},{type:"check",label:"Cluster Columns",current_value:e.cluster_columns,func:r=>{e.cluster_columns=r,this.clusterColumns(),this.drawChart()}},{type:"radiobuttons",label:"Averaging Method",current_value:e.method,choices:[["Mean","mean"],["Median","median"]],func:r=>{e.method=r,this.onDataFiltered()}},{type:"radiobuttons",label:"Trim to Percentile",current_value:e.color_scale.trim||"none",choices:[["No Trim","none"],["0.001","0.001"],["0.01","0.01"],["0.05","0.05"]],func:r=>{e.color_scale.trim=r,this.onDataFiltered()}},{label:"Show Color Legend",type:"check",current_value:e.color_legend?e.color_legend.display:!0,func:r=>{e.color_legend.display=r,this.setColorLegend()}},{type:"check",label:"Log Color Scale",current_value:e.color_scale.log,func:r=>{e.color_scale.log=r,this.setColorFunction(),this.drawChart()}}])}}BaseChart.types.heat_map={name:"Heat Map",class:HeatMap,params:[{type:"text",name:"Categories on x-axis"},{type:"_multi_column:number",name:"Fields on y axis"}]};class ViolinPlot extends WGLChart{constructor(e,t,r){const s=e.getColumnName(r.param[0]),o=e.getColumnName(r.param[1]);r.axis||(r.axis={x:{size:30,label:s,textsize:13},y:{size:45,label:o,textsize:13}}),r.title||(r.title=s+" x "+o),super(e,t,r,{x:{type:"band"},y:{}}),this.config.type="violin_plot";const a=this.config;a.brush=a.brush||"poly";let l={brush:a.brush};this.app=new WGL2DI(this.graphDiv,l);const u=this.afterAppCreation(),p=this.dataStore.size;this.xPosBuff=new SharedArrayBuffer(p*4),this.xPos=new Float32Array(this.xPosBuff),this.values=this.dataStore.getColumnValues(a.param[0]);const d=this.dataStore.getRawColumn(a.param[0]);for(let w=0;w<p;w++)this.xPos[w]=d[w]*50+4+Math.random()*42;const m=this.dataStore.getMinMaxForColumn(a.param[1]);this.defaultBandWidth=(m[1]-m[0])/100,a.band_width=a.band_width||this.defaultBandWidth,a.intervals=a.intervals||20,this.dim=this.dataStore.getDimension("catrange_dimension"),this.x_scale.domain(this.values);const g=this.dataStore.columnIndex[a.param[1]];this.app.addCircles({x:this.xPos,y:g.datatype==="int32"?new Float32Array(g.data):g.data,localFilter:this.dim.getLocalFilter(),globalFilter:this.dataStore.getFilter(),colorFunc:u}),this.app.addHandler("brush_stopped",(w,E)=>{this.resetButton.style.display="inline",this.app.setFilter(!0),E?this._createPolyFilter(w):this._createFilter(w)}),a.radius=a.radius||5,a.opacity=a.opacity||.8,this.app.setPointRadius(this.config.radius),this.app.setPointOpacity(this.config.opacity),this.data=[],this.centerGraph(),this.onDataFiltered()}_createFilter(e){if(this.range=e,e==null)this.dim.removeFilter();else{let t=e.y_max,r=e.y_min,s=e.x_max,o=e.x_min;this.filter=[[o,s],[r,t]],this.dim("filterSquare",[this.xPos,this.config.param[1]],{range1:this.filter[0],range2:this.filter[1]},[this.xPos,1]),this.app.refresh()}}onDataFiltered(e){if(!this.isPinned&&e!==this.dim){e==="all_removed"&&(this.app.clearBrush(),this.app.setFilter(!1),this.resetButton.style.display="none");const t=this.config;this.ticks=this.y_scale.ticks(t.intervals),this.dim.getKernalDensity(r=>{this.data=r,this.drawChart()},t.param,{ticks:this.ticks,bandwidth:t.band_width,intervals:t.intervals,xPos:this.xPosBuff})}}drawChart(){const e=select(this.contentDiv).transition().duration(400).ease(linear),t=[],r=this.data.length,s=this._getContentDimensions(),o=s.width/r,a=[];for(let m=0;m<this.data.length;m++)t.push(o/(2*this.data[m].max)*.9),a.push(this.values[this.data[m].id]);this.x_scale.domain(a),this.centerGraph();const l=this.ticks.map(m=>this.y_scale(m)),u=[];for(let m=0;m<this.data.length;m++){const g=m*o+.5*o,w=[];let E=!0;for(let A=0;A<this.data[m].length;A++){const k=this.data[m][A];if(k===0||isNaN(k)){if(!E){if(w[w.length-1][2]==0)continue;w.push([l[A],g,0])}continue}if(w.length===0){if(A===0){w.push([0,g,0]);continue}else w.push([l[A-1],g,0]);E=!1}w.push([l[A],g,t[m]*k])}w.length===0?(w.push([0,g,0]),w.push([0,g,0])):w[w.length-1][2]!==0&&w.push([s.height,g,0]),u.push(w),w.id=this.data[m].id}const p=this.dataStore.getColumnColors(this.config.param[0]);this.graph_area.selectAll(".violin-curve").data(u,m=>"A"+m.id).join("path").attr("class","violin-curve").transition(e).attr("fill","none").attr("stroke",(m,g)=>p[m.id]).attr("stroke-width",2).attr("stroke-linejoin","round").attr("d",line().curve(curveBasis).x(function(m,g){return m[1]+m[2]}).y(function(m,g){return m[0]})),this.graph_area.selectAll(".violin-curve1").data(u,m=>"B"+m.id).join("path").attr("class","violin-curve1").transition(e).attr("fill","none").attr("stroke",(m,g)=>p[m.id]).attr("stroke-width",2).attr("stroke-linejoin","round").attr("d",line().curve(curveBasis).x(function(m,g){return m[1]-m[2]}).y(function(m,g){return m[0]})),this.app.refresh()}unpinChart(){super.unpinChart(),this.onDataFiltered()}onDataAdded(e){const t=this.config.param,r=this.getSetupConfig();let s=new Float32Array(e);s.set(this.xPos),this.values=this.dataStore.getColumnValues(t[0]);const o=this.dataStore.getRawColumn(t[0]);for(let a=this.xPos.length;a<e;a++)s[a]=o[a]*50+4+Math.random()*42;this.xPos=s,r.x=s,r.y=this.dataStore.getRawColumn(t[1]),this.dim.filterColumns&&(this.dimFilterColumns[0]=s),this.app.updateSize(e,r),super.onDataAdded(e)}setSize(e,t){super.setSize(e,t),this.drawChart()}centerGraph(){const e=this.dataStore.getMinMaxForColumn(this.config.param[1]);let t=this.data.length*50,r=e[1],s=0,o=e[0],a=(r-o)/20,l=t-s,u=r-o+2*a;const p=this._getContentDimensions();this.app.x_scale=p.width/l,this.app.y_scale=p.height/u,this.app.offset[0]=-s,this.app.offset[1]=r+a,this._updateScale(this.app.getRange()),this.updateAxis()}_updateScale(e){this.y_scale.domain([-e.y_range[0],-e.y_range[1]])}getSettings(){const e=super.getSettings(),t=this.config,r=this.dataStore.getMinMaxForColumn(t.param[1]);return e.splice(1,0,{type:"slider",max:r[1]/10,min:r[0]<0?0:r[0],doc:this.__doc__,current_value:t.band_width,label:"Band Width",func:s=>{t.band_width=s,this.onDataFiltered()}},{type:"slider",max:100,min:10,step:1,doc:this.__doc__,current_value:t.intervals,label:"Intervals",func:s=>{t.intervals=s,this.onDataFiltered()}}),e}_createPolyFilter(e){this.range=!0;for(let t of e)t[1]=-t[1],this.config.axis.x_log_scale&&(t[0]=this._getInverseLogValue(t[0])),this.config.axis.y_log_scale&&(t[1]=this._getInverseLogValue(t[1]));this.filter=e,this.dim.filter("filterPoly",[this.xPos,this.config.param[1]],e),this.app.refresh()}}BaseChart.types.violin_plot={class:ViolinPlot,name:"Violin Plot",params:[{type:"text",name:"Category (X axis)"},{type:"number",name:"Value (Y axis)"}]};class BoxPlot extends ViolinPlot{constructor(e,t,r){super(e,t,r),this.config.type="box_plot"}onDataFiltered(e){this.isPinned||e!==this.dim&&(e==="all_removed"&&(this.app.clearBrush(),this.app.setFilter(!1),this.resetButton.style.display="none"),this.ticks=this.y_scale.ticks(20),this.dim.getBoxPlotData(t=>{this.data=t,this.drawChart()},this.config.param,{xPos:this.xPosBuff}))}drawChart(){const e=select(this.contentDiv).transition().duration(400).ease(linear),t=this.data.length,r=this.y_scale,s=[];for(let u of this.data)s.push(this.values[u.id]);this.x_scale.domain(s),this.centerGraph();const a=this._getContentDimensions().width/t,l=this.dataStore.getColumnColors(this.config.param[0]);this.graph_area.selectAll(".boxplot-rect").data(this.data,u=>u.id).join("rect").attr("class","boxplot-rect").transition(e).attr("x",(u,p)=>p*(a-3)+(p+1)*3).attr("y",u=>r(u.Q3)).attr("width",a-6).attr("height",u=>{const p=r(u.Q1)-r(u.Q3);return isNaN(p)?0:p}).attr("fill","none").attr("stroke",(u,p)=>l[u.id]).attr("stroke-width",3),this.graph_area.selectAll(".boxplot-whisker").data(this.data,u=>u.id).join("path").attr("class","boxplot-whisker").transition(e).attr("stroke",(u,p)=>l[u.id]).attr("fill","none").attr("stroke-width",3).attr("d",(u,p)=>{if(isNaN(u.med))return"";const d=p*(a-6)+(p+1)*6,m=p*(a-3)+(p+1)*3,g=p*a+.5*a,w=r(u.max),E=r(u.min);return w==null||E==null?"":`
             M${d} ${w} L${d+a-12} ${w}
             M${g} ${w} L${g} ${r(u.Q3)}
             M${m} ${r(u.med)} L${m+a-6} ${r(u.med)}
             M${g} ${E} L${g} ${r(u.Q1)}
             M${d} ${E} L${d+a-12} ${E}`}),this.app.refresh()}}BaseChart.types.box_plot={class:BoxPlot,name:"Box Plot",params:[{type:"text",name:"Category (X axis)"},{type:"number",name:"Value (Y axis)"}]};function justify(i,e){return i.sourceLinks.length?i.depth:e-1}function constant$1(i){return function(){return i}}function ascendingSourceBreadth(i,e){return ascendingBreadth(i.source,e.source)||i.index-e.index}function ascendingTargetBreadth(i,e){return ascendingBreadth(i.target,e.target)||i.index-e.index}function ascendingBreadth(i,e){return i.y0-e.y0}function value(i){return i.value}function defaultId(i){return i.index}function defaultNodes(i){return i.nodes}function defaultLinks(i){return i.links}function find(i,e){const t=i.get(e);if(!t)throw new Error("missing: "+e);return t}function computeLinkBreadths({nodes:i}){for(const e of i){let t=e.y0,r=t;for(const s of e.sourceLinks)s.y0=t+s.width/2,t+=s.width;for(const s of e.targetLinks)s.y1=r+s.width/2,r+=s.width}}function Sankey(){let i=0,e=0,t=1,r=1,s=24,o=8,a,l=defaultId,u=justify,p,d,m=defaultNodes,g=defaultLinks,w=6;function E(){const Te={nodes:m.apply(null,arguments),links:g.apply(null,arguments)};return A(Te),k(Te),O(Te),ne(Te),U(Te),computeLinkBreadths(Te),Te}E.update=function(Te){return computeLinkBreadths(Te),Te},E.nodeId=function(Te){return arguments.length?(l=typeof Te=="function"?Te:constant$1(Te),E):l},E.nodeAlign=function(Te){return arguments.length?(u=typeof Te=="function"?Te:constant$1(Te),E):u},E.nodeSort=function(Te){return arguments.length?(p=Te,E):p},E.nodeWidth=function(Te){return arguments.length?(s=+Te,E):s},E.nodePadding=function(Te){return arguments.length?(o=a=+Te,E):o},E.nodes=function(Te){return arguments.length?(m=typeof Te=="function"?Te:constant$1(Te),E):m},E.links=function(Te){return arguments.length?(g=typeof Te=="function"?Te:constant$1(Te),E):g},E.linkSort=function(Te){return arguments.length?(d=Te,E):d},E.size=function(Te){return arguments.length?(i=e=0,t=+Te[0],r=+Te[1],E):[t-i,r-e]},E.extent=function(Te){return arguments.length?(i=+Te[0][0],t=+Te[1][0],e=+Te[0][1],r=+Te[1][1],E):[[i,e],[t,r]]},E.iterations=function(Te){return arguments.length?(w=+Te,E):w};function A({nodes:Te,links:dt}){for(const[yt,Ue]of Te.entries())Ue.index=yt,Ue.sourceLinks=[],Ue.targetLinks=[];const ot=new Map(Te.map((yt,Ue)=>[l(yt,Ue,Te),yt]));for(const[yt,Ue]of dt.entries()){Ue.index=yt;let{source:Nt,target:Ot}=Ue;typeof Nt!="object"&&(Nt=Ue.source=find(ot,Nt)),typeof Ot!="object"&&(Ot=Ue.target=find(ot,Ot)),Nt.sourceLinks.push(Ue),Ot.targetLinks.push(Ue)}if(d!=null)for(const{sourceLinks:yt,targetLinks:Ue}of Te)yt.sort(d),Ue.sort(d)}function k({nodes:Te}){for(const dt of Te)dt.value=dt.fixedValue===void 0?Math.max(sum(dt.sourceLinks,value),sum(dt.targetLinks,value)):dt.fixedValue}function O({nodes:Te}){const dt=Te.length;let ot=new Set(Te),yt=new Set,Ue=0;for(;ot.size;){for(const Nt of ot){Nt.depth=Ue;for(const{target:Ot}of Nt.sourceLinks)yt.add(Ot)}if(++Ue>dt)throw new Error("circular link");ot=yt,yt=new Set}}function ne({nodes:Te}){const dt=Te.length;let ot=new Set(Te),yt=new Set,Ue=0;for(;ot.size;){for(const Nt of ot){Nt.height=Ue;for(const{source:Ot}of Nt.targetLinks)yt.add(Ot)}if(++Ue>dt)throw new Error("circular link");ot=yt,yt=new Set}}function Q({nodes:Te}){const dt=max$2(Te,Ue=>Ue.depth)+1,ot=(t-i-s)/(dt-1),yt=new Array(dt);for(const Ue of Te){const Nt=Math.max(0,Math.min(dt-1,Math.floor(u.call(null,Ue,dt))));Ue.layer=Nt,Ue.x0=i+Nt*ot,Ue.x1=Ue.x0+s,yt[Nt]?yt[Nt].push(Ue):yt[Nt]=[Ue]}if(p)for(const Ue of yt)Ue.sort(p);return yt}function ue(Te){const dt=min$2(Te,ot=>(r-e-(ot.length-1)*a)/sum(ot,value));for(const ot of Te){let yt=e;for(const Ue of ot){Ue.y0=yt,Ue.y1=yt+Ue.value*dt,yt=Ue.y1+a;for(const Nt of Ue.sourceLinks)Nt.width=Nt.value*dt}yt=(r-yt+a)/(ot.length+1);for(let Ue=0;Ue<ot.length;++Ue){const Nt=ot[Ue];Nt.y0+=yt*(Ue+1),Nt.y1+=yt*(Ue+1)}ze(ot)}}function U(Te){const dt=Q(Te);a=Math.min(o,(r-e)/(max$2(dt,ot=>ot.length)-1)),ue(dt);for(let ot=0;ot<w;++ot){const yt=Math.pow(.99,ot),Ue=Math.max(1-yt,(ot+1)/w);Se(dt,yt,Ue),_(dt,yt,Ue)}}function _(Te,dt,ot){for(let yt=1,Ue=Te.length;yt<Ue;++yt){const Nt=Te[yt];for(const Ot of Nt){let wi=0,Bi=0;for(const{source:Zi,value:fr}of Ot.targetLinks){let Ti=fr*(Ot.layer-Zi.layer);wi+=Je(Zi,Ot)*Ti,Bi+=Ti}if(!(Bi>0))continue;let Ei=(wi/Bi-Ot.y0)*dt;Ot.y0+=Ei,Ot.y1+=Ei,Qe(Ot)}p===void 0&&Nt.sort(ascendingBreadth),Me(Nt,ot)}}function Se(Te,dt,ot){for(let yt=Te.length,Ue=yt-2;Ue>=0;--Ue){const Nt=Te[Ue];for(const Ot of Nt){let wi=0,Bi=0;for(const{target:Zi,value:fr}of Ot.sourceLinks){let Ti=fr*(Zi.layer-Ot.layer);wi+=St(Ot,Zi)*Ti,Bi+=Ti}if(!(Bi>0))continue;let Ei=(wi/Bi-Ot.y0)*dt;Ot.y0+=Ei,Ot.y1+=Ei,Qe(Ot)}p===void 0&&Nt.sort(ascendingBreadth),Me(Nt,ot)}}function Me(Te,dt){const ot=Te.length>>1,yt=Te[ot];kt(Te,yt.y0-a,ot-1,dt),Ke(Te,yt.y1+a,ot+1,dt),kt(Te,r,Te.length-1,dt),Ke(Te,e,0,dt)}function Ke(Te,dt,ot,yt){for(;ot<Te.length;++ot){const Ue=Te[ot],Nt=(dt-Ue.y0)*yt;Nt>1e-6&&(Ue.y0+=Nt,Ue.y1+=Nt),dt=Ue.y1+a}}function kt(Te,dt,ot,yt){for(;ot>=0;--ot){const Ue=Te[ot],Nt=(Ue.y1-dt)*yt;Nt>1e-6&&(Ue.y0-=Nt,Ue.y1-=Nt),dt=Ue.y0-a}}function Qe({sourceLinks:Te,targetLinks:dt}){if(d===void 0){for(const{source:{sourceLinks:ot}}of dt)ot.sort(ascendingTargetBreadth);for(const{target:{targetLinks:ot}}of Te)ot.sort(ascendingSourceBreadth)}}function ze(Te){if(d===void 0)for(const{sourceLinks:dt,targetLinks:ot}of Te)dt.sort(ascendingTargetBreadth),ot.sort(ascendingSourceBreadth)}function Je(Te,dt){let ot=Te.y0-(Te.sourceLinks.length-1)*a/2;for(const{target:yt,width:Ue}of Te.sourceLinks){if(yt===dt)break;ot+=Ue+a}for(const{source:yt,width:Ue}of dt.targetLinks){if(yt===Te)break;ot-=Ue}return ot}function St(Te,dt){let ot=dt.y0-(dt.targetLinks.length-1)*a/2;for(const{source:yt,width:Ue}of dt.targetLinks){if(yt===Te)break;ot+=Ue+a}for(const{target:yt,width:Ue}of Te.sourceLinks){if(yt===dt)break;ot-=Ue}return ot}return E}var pi=Math.PI,tau=2*pi,epsilon=1e-6,tauEpsilon=tau-epsilon;function Path(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function path(){return new Path}Path.prototype=path.prototype={constructor:Path,moveTo:function(i,e){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(i,e){this._+="L"+(this._x1=+i)+","+(this._y1=+e)},quadraticCurveTo:function(i,e,t,r){this._+="Q"+ +i+","+ +e+","+(this._x1=+t)+","+(this._y1=+r)},bezierCurveTo:function(i,e,t,r,s,o){this._+="C"+ +i+","+ +e+","+ +t+","+ +r+","+(this._x1=+s)+","+(this._y1=+o)},arcTo:function(i,e,t,r,s){i=+i,e=+e,t=+t,r=+r,s=+s;var o=this._x1,a=this._y1,l=t-i,u=r-e,p=o-i,d=a-e,m=p*p+d*d;if(s<0)throw new Error("negative radius: "+s);if(this._x1===null)this._+="M"+(this._x1=i)+","+(this._y1=e);else if(m>epsilon)if(!(Math.abs(d*l-u*p)>epsilon)||!s)this._+="L"+(this._x1=i)+","+(this._y1=e);else{var g=t-o,w=r-a,E=l*l+u*u,A=g*g+w*w,k=Math.sqrt(E),O=Math.sqrt(m),ne=s*Math.tan((pi-Math.acos((E+m-A)/(2*k*O)))/2),Q=ne/O,ue=ne/k;Math.abs(Q-1)>epsilon&&(this._+="L"+(i+Q*p)+","+(e+Q*d)),this._+="A"+s+","+s+",0,0,"+ +(d*g>p*w)+","+(this._x1=i+ue*l)+","+(this._y1=e+ue*u)}},arc:function(i,e,t,r,s,o){i=+i,e=+e,t=+t,o=!!o;var a=t*Math.cos(r),l=t*Math.sin(r),u=i+a,p=e+l,d=1^o,m=o?r-s:s-r;if(t<0)throw new Error("negative radius: "+t);this._x1===null?this._+="M"+u+","+p:(Math.abs(this._x1-u)>epsilon||Math.abs(this._y1-p)>epsilon)&&(this._+="L"+u+","+p),t&&(m<0&&(m=m%tau+tau),m>tauEpsilon?this._+="A"+t+","+t+",0,1,"+d+","+(i-a)+","+(e-l)+"A"+t+","+t+",0,1,"+d+","+(this._x1=u)+","+(this._y1=p):m>epsilon&&(this._+="A"+t+","+t+",0,"+ +(m>=pi)+","+d+","+(this._x1=i+t*Math.cos(s))+","+(this._y1=e+t*Math.sin(s))))},rect:function(i,e,t,r){this._+="M"+(this._x0=this._x1=+i)+","+(this._y0=this._y1=+e)+"h"+ +t+"v"+ +r+"h"+-t+"Z"},toString:function(){return this._}};function constant(i){return function(){return i}}function x(i){return i[0]}function y(i){return i[1]}var slice=Array.prototype.slice;function linkSource(i){return i.source}function linkTarget(i){return i.target}function link(i){var e=linkSource,t=linkTarget,r=x,s=y,o=null;function a(){var l,u=slice.call(arguments),p=e.apply(this,u),d=t.apply(this,u);if(o||(o=l=path()),i(o,+r.apply(this,(u[0]=p,u)),+s.apply(this,u),+r.apply(this,(u[0]=d,u)),+s.apply(this,u)),l)return o=null,l+""||null}return a.source=function(l){return arguments.length?(e=l,a):e},a.target=function(l){return arguments.length?(t=l,a):t},a.x=function(l){return arguments.length?(r=typeof l=="function"?l:constant(+l),a):r},a.y=function(l){return arguments.length?(s=typeof l=="function"?l:constant(+l),a):s},a.context=function(l){return arguments.length?(o=l??null,a):o},a}function curveHorizontal(i,e,t,r,s){i.moveTo(e,t),i.bezierCurveTo(e=(e+r)/2,t,e,s,r,s)}function linkHorizontal(){return link(curveHorizontal)}function horizontalSource(i){return[i.source.x1,i.y0]}function horizontalTarget(i){return[i.target.x0,i.y1]}function sankeyLinkHorizontal(){return linkHorizontal().source(horizontalSource).target(horizontalTarget)}class SankeyChart extends SVGChart{constructor(e,t,r){const s={y:{custom:!0},ry:{label:!0}},o=e.getColumnName(r.param[0]),a=e.getColumnName(r.param[1]);r.label||(r.label=`${o} vs. ${a}`),r.axis||(r.axis={}),r.axis.y||(r.axis.y={size:25,textSize:15,label:o}),r.axis.ry||(r.axis.ry={size:25,textSize:15,label:a}),super(e,t,r,s);const l=this.config;l.type="sankey_chart",this.dim=this.dataStore.getDimension("category_dimension"),this.filter=[],this.addToolTip(),this.onDataFiltered()}setSize(e,t){super.setSize(e,t),this.drawChart()}remove(e=!0){this.dim.destroy(e),super.remove()}removeFilter(){this.dim.removeFilter(),this.filter=[],this.nodeFilter=null,this.linkFilter=null,this.drawChart()}onDataFiltered(e){this.dim===e||this.isPinned||(e==="all_removed"&&(this.filter=[],this.nodeFilter=null,this.linkFilter=null,this.resetButton.style.display="none"),this.dim.getSankeyData(t=>{this.sankeyData=t,this.drawChart()},this.config.param))}drawChart(){this.updateAxis();const e=select(this.contentDiv).transition().duration(400).ease(linear),t=this._getContentDimensions(),r=this.config.param,s=[this.dataStore.getColumnColors(r[0]),this.dataStore.getColumnColors(r[1])],o=this;let a=20-this.sankeyData.minNodes;a=a<1?1:a>10?10:a;const u=Sankey().size([t.width,t.height]).nodeId(p=>p.id).nodeWidth(20).nodePadding(a).nodeAlign(justify)(this.sankeyData);this.graph_area.selectAll(".s-links").data(u.links).join("path").on("click",(p,d)=>{o.filterMultipleCategories(d)}).on("mouseover mousemove",(p,d)=>{const m=d.source,g=o.dataStore.getColumnValues(o.config.param[m.param])[m.ind],w=d.target,E=o.dataStore.getColumnValues(o.config.param[w.param])[w.ind];o.showToolTip(p,`${g}<br>${E}<br>${d.trueValue}`)}).on("mouseleave",()=>{o.hideToolTip()}).transition(e).attr("class","s-links").attr("d",sankeyLinkHorizontal()).attr("fill","none").attr("stroke","currentColor").attr("stroke-width",p=>p.width).attr("stoke-opacity",.5).attr("opacity",p=>o.linkFilter?p.source.id===o.linkFilter[0]&&p.target.id===o.linkFilter[1]?.8:.2:o.nodeFilter?p.source.id===o.nodeFilter||p.target.id===o.nodeFilter?.8:.2:.5),this.graph_area.selectAll(".s-nodes").data(u.nodes).join("rect").on("click",(p,d)=>{const m=r[d.param];o.nodeFilter=(d.param===0?"A":"B")+d.ind,o.linkFilter=null;const g=o.dataStore.getColumnValues(m);o.filterCategories(m,g[d.ind])}).on("mouseover mousemove",(p,d)=>{const m=o.dataStore.getColumnValues(o.config.param[d.param])[d.ind];o.showToolTip(p,m)}).on("mouseleave",()=>{o.hideToolTip()}).attr("class","s-nodes").attr("x",p=>p.x0).attr("y",p=>p.y0).attr("width",p=>p.x1-p.x0).attr("height",p=>p.y1-p.y0).attr("fill",p=>s[p.param][p.ind])}getFilter(){const e=this.config.param;if(this.linkFilter){const t={};let r=parseInt(this.linkFilter[0].substring(1));return t[e[0]]=[this.dataStore.getColumnValues(e[0])[r]],r=parseInt(this.linkFilter[1].substring(1)),t[e[1]]=[this.dataStore.getColumnValues(e[1])[r]],t}if(this.nodeFilter){const t={},r=this.nodeFilter.startsWith("A")?0:1;let s=parseInt(this.nodeFilter.substring(1));return t[e[r]]=[this.dataStore.getColumnValues(e[r])[s]],t}return null}filterMultipleCategories(e){const t=this.config.param,r=t[e.source.param],s=this.dataStore.getColumnValues(r)[e.source.ind],o=t[e.target.param],a=this.dataStore.getColumnValues(o)[e.target.ind];this.linkFilter=["A"+e.source.ind,"B"+e.target.ind],this.resetButton.style.display="inline",this.drawChart(),this.dim.filter("filterMultipleCategories",[r,o],[s,a])}filterCategories(e,t,r){r?this.filter.push(t):this.filter=[t],this.resetButton.style.display="inline",this.drawChart(),this.dim.filter("filterCategories",[e],this.filter)}pinChart(){this.isPinned=!0}unpinChart(){this.isPinned=!1,this.onDataFiltered()}getSettings(){const e=super.getSettings();return this.config,e}}BaseChart.types.sankey_chart={name:"Sankey Diagram",class:SankeyChart,params:[{type:"text",name:"First Group"},{type:"text",name:"Second Group"}]};class MultiLineChart extends SVGChart{constructor(e,t,r){const s=e.getColumnName(r.param[0]);r.axis||(r.axis={x:{size:30,label:s,textsize:13},y:{size:45,label:"density",textsize:13}}),r.title||(r.title=s),r.scaletrim&&!r.band_width&&(r.band_width=.1),super(e,t,r,{x:{},y:{type:r.stacked?"band":"linear"}}),this.config.type="multi_line_chart";const o=this.config;o.color_legend||(o.color_legend={display:!o.stacked});let a=this.dataStore.getMinMaxForColumn(o.param[0]),l=a.slice(0);r.scaletrim&&(l=[0,1]),this.x_scale.domain(l),this.defaultBandWidth=(a[1]-a[0])/100,o.band_width=o.band_width||this.defaultBandWidth,o.intervals=o.intervals||40,this.dim=this.dataStore.getDimension("catrange_dimension"),this.data=[],this.addToolTip(),this.setColorLegend(),this.stackLines(o.stacked),this.scaleTrim(o.scaletrim),this.onDataFiltered()}stackLines(e){this.config.stacked=e,e?(this.y_scale=band(),this.y_axis_call=axisLeft(this.y_scale),this.config.color_legend.display=!1,this.setColorLegend(),this.y_scale.domain(this.dataStore.getColumnValues(this.config.param[1]))):(this.y_scale=linear$1(),this.y_axis_call=axisLeft(this.y_scale),this.y_scale.domain([1,0]))}changeCategories(e,t,r){this.config.param[1]=e,this.onDataFiltered()}scaleTrim(e){const t=this.config;if(!e||e==="none"){delete t.scaletrim;const r=this.dataStore.getMinMaxForColumn(t.param[0]);this.x_scale.domain(r)}else t.scaletrim=e+"",this.x_scale.domain([0,1]),t.band_width=.1}getColorLegend(){return this.dataStore.getColorLegend(this.config.param[1])}onDataFiltered(e){if(!this.isPinned&&e!==this.dim){e==="all_removed"&&(this.resetButton.style.display="none");const t=this.config;this.ticks=this.x_scale.ticks(t.intervals),this.dim.getKernalDensity(r=>{this.data=r,this.drawChart()},[t.param[1],t.param[0]],{ticks:this.ticks,bandwidth:t.band_width,intervals:t.intervals,scaletrim:t.scaletrim})}}remove(e=!0){this.dim.destroy(e),super.remove()}drawChart(){const e=this.config,t=this.dataStore.getColumnValues(e.param[1]),r=select(this.contentDiv).transition().duration(400).ease(linear),s=this._getContentDimensions(),o=[],a=s.height/this.data.length,l=[];for(let g=0;g<this.data.length;g++){const w=e.stacked?a/this.data[g].max:s.height/this.data[g].max,E=e.stacked?this.data[g].map(A=>a*g+a-A*w):this.data[g].map(A=>s.height-A*w);E.id=this.data[g].id,l.push(t[E.id]),o.push(E)}this.y_scale.domain(l),this.updateAxis();const u=this.ticks.map(g=>this.x_scale(g)),p=this,d=this.dataStore.getColumnColors(this.config.param[1]);this.graph_area.selectAll(".chart-line").data(o).join("path").attr("class","chart-line").on("mouseover mousemove",(g,w)=>{const E=t[w.id];p.showToolTip(g,E)}).on("mouseout",()=>{p.hideToolTip()}).transition(r).attr("fill","none").attr("stroke",(g,w)=>d[g.id]).attr("stroke-width",2).attr("stroke-linejoin","round").attr("d",line().x((g,w)=>u[w]).y((g,w)=>g)),e.fill?(area().x(function(g,w){return u[w]}).y0(function(g,w){return g}).y1((g,w)=>{e.stacked?a*g.id+a:s.height}),this.graph_area.selectAll(".chart-area").data(o).join("path").attr("class","chart-area").transition(r).attr("fill",g=>d[g.id]).style("opacity",.5).attr("d",function(g,w){return area().x(function(E,A){return u[A]}).y0(function(E){return E}).y1(E=>e.stacked?a*w+a:s.height)(g)})):this.graph_area.selectAll(".chart-area").remove()}unpinChart(){super.unpinChart(),this.onDataFiltered()}setSize(e,t){super.setSize(e,t),this.drawChart()}getSettings(){const e=super.getSettings(),t=this.config,r=this.dataStore.getMinMaxForColumn(t.param[0]),s=this.dataStore.getColumnList("text");return e.splice(1,0,{type:"dropdown",current_value:t.param[1],label:"Change Cetegories (y axis)",values:[s,"name","field"],func:o=>{this.changeCategories(o,"val1","val2")}},{type:"check",current_value:t.stacked,label:"Stack Lines",func:o=>{this.stackLines(o),this.drawChart()}},{type:"check",current_value:t.fill,label:"Fill Lines",func:o=>{t.fill=o,this.drawChart()}},{type:"radiobuttons",label:"Scale/Trim to Percentile",current_value:t.scaletrim||"none",choices:[["No Trim","none"],["0.001","0.001"],["0.01","0.01"],["0.05","0.05"]],func:o=>{this.scaleTrim(o),this.onDataFiltered()}},{type:"slider",max:r[1]/10,min:r[0]<0?0:r[0],doc:this.__doc__,current_value:t.band_width,label:"Band Width",func:o=>{t.band_width=o,this.onDataFiltered()}},{type:"slider",max:100,min:10,step:1,doc:this.__doc__,current_value:t.intervals,label:"Intervals",func:o=>{t.intervals=o,this.onDataFiltered()}},{label:"Show Color Legend",type:"check",current_value:t.color_legend?t.color_legend.display:!0,func:o=>{t.color_legend.display=o,this.setColorLegend()}}),e}}BaseChart.types.multi_line_chart={class:MultiLineChart,name:"Multi Line Chart",methodsUsingColumns:["changeCategories"],params:[{type:"number",name:"Value (X axis)"},{type:"text",name:"Categories to show"}]};class DensityScatterPlot extends WGLScatterPlot{afterAppCreation(){this.contentDiv.prepend(this.app.div_container),this.svg.style("position","absolute").style("pointer-events","none");const e=this.config;e.contour_bandwidth=e.contour_bandwidth||5,e.contour_intensity=e.contour_intensity||.7,e.contour_opacity=e.contour_opacity||1;const t=e.param,r=this.dataStore.getMinMaxForColumn(t[0]),s=this.dataStore.getMinMaxForColumn(t[1]),o=r[1]-r[0],a=s[1]-s[0];return this.whRatio=o/a,this.catKeys=[-1,-1],this.data=[null,null],this.orig_y_scale=this.y_scale.domain(),this.orig_x_scale=this.x_scale.domain(),this.or_y_scale=[0,400/this.whRatio],this.or_x_scale=[0,400],this.app.addHandler("pan_or_zoom",(l,u,p)=>{this._updateScale(this.app.getRange()),this._rescaleSVG()},e.id),super.afterAppCreation()}getDimension(){return this.dataStore.getDimension("density_dimension")}onDataFiltered(e){const t=this.config,r=t.param;super.onDataFiltered(e);const s=this.dataStore.getColumnValues(t.param[2]);if(this.catKeys=[s.indexOf(t.category1),s.indexOf(t.category2)],this.catKeys[0]===-1&&this.catKeys[1]===-1){this.data=[null,null];return}const o={categories:this.catKeys,yscale:[this.orig_y_scale,this.or_y_scale],xscale:[this.orig_x_scale,this.or_x_scale],bandwidth:this.config.contour_bandwidth};this.dim.getDensityContours(a=>{this.data=a,this.drawChart(),this._rescaleSVG()},r,o)}setSize(e,t){super.setSize(e,t),this._rescaleSVG()}_drawContours(e,t,r){const s=`dp-poly-${r}`,o=this.config;this.graph_area.selectAll("."+s).data(this.data[r]).join("path").attr("class",s).attr("stroke",o.contour_fill?"none":e).style("opacity",o.contour_opacity).attr("stroke-linejoin","round").attr("d",geoPath()).attr("fill",a=>o.contour_fill?t(a.value):"none")}removeCategory(e){delete this.config["category"+e],this.data[e-1]=null,this.catKeys[e-1]=-1,this.graph_area.selectAll(`.dp-poly-${e-1}`).remove()}changeContourParameter(e){this.config.param[2]=e,this.removeCategory(1),this.removeCategory(2),this.drawChart()}drawChart(e=400){const t=this.config;for(let r in this.catKeys){let s=this.catKeys[r];if(s===-1)this.graph_area.selectAll(`.dp-poly-${r}`).remove();else{let o=this.dataStore.getColumnColors(t.param[2])[s],a=linear$1([0,1-t.contour_intensity],["white",o]);this._drawContours(o,a,r)}}}_rescaleSVG(){const e=this.x_scale.domain(),t=e[1]-e[0],r=this.x_scale.range()[1]/this.or_x_scale[1],s=(this.orig_x_scale[1]-this.orig_x_scale[0])/t*r,o=linear$1().domain(e).range(this.or_x_scale),a=o(e[0])-o(this.orig_x_scale[0])*r,l=this.y_scale.domain(),u=l[0]-l[1],p=this.y_scale.range()[1]/this.or_y_scale[1],d=(this.orig_y_scale[0]-this.orig_y_scale[1])/u*p,m=linear$1().domain(l).range(this.or_y_scale),g=m(l[0])-m(this.orig_y_scale[0])*p,w=this.margins.left,E=this.margins.top;this.graph_area.attr("transform",`translate(${w-a},${E-g}) scale(${s},${d})  `)}getSettings(){const e=super.getSettings(),t=this.config,r=this.dataStore.getColumnList("text");let s=this.dataStore.getColumnValues(t.param[2]);return s=s.map(o=>({t:o})),s.push({t:"None"}),e.push({type:"dropdown",label:"Contour Parameter",current_value:this.dataStore.getColumnName(t.param[2]),values:[r,"name","field"],func:o=>{this.changeContourParameter(o)},onchange:(o,a)=>{const u=this.dataStore.getColumnValues(a).slice(0);u.push("None");for(let p of["Contour Category 1","Contour Category 2"]){o[p].innerHTML="";for(let d of u)createEl("option",{text:d,value:d},o[p]);o[p].value="None"}}},{type:"dropdown",label:"Contour Category 1",current_value:t.category1||"None",values:[s,"t","t"],func:o=>{o==="None"?this.removeCategory(1):t.category1=o,this.onDataFiltered()}},{type:"dropdown",label:"Contour Category 2",current_value:t.category2||"None",values:[s,"t","t"],func:o=>{o==="None"?this.removeCategory(2):t.category2=o,this.onDataFiltered()}},{type:"slider",max:25,min:1,doc:this.__doc__,current_value:t.contour_bandwidth,label:"KDE Bandwidth",func:o=>{t.contour_bandwidth=o,this.onDataFiltered()}},{label:"Fill Contours",type:"check",current_value:t.contour_fill,func:o=>{t.contour_fill=o,this.drawChart()}},{type:"slider",max:1,min:0,doc:this.__doc__,current_value:t.contour_intensity,label:"Fill Intensity",func:o=>{t.contour_intensity=o,this.drawChart()}},{type:"slider",max:1,min:0,doc:this.__doc__,current_value:t.contour_opacity,label:"Contour opacity",func:o=>{t.contour_opacity=o,this.drawChart()}}),e}}BaseChart.types.density_scatter_plot={name:"Density Scatter Plot",class:DensityScatterPlot,params:[{type:"number",name:"X axis"},{type:"number",name:"Y axis"},{type:"text",name:"Category Column"}]};class SelectionDialog extends BaseChart{constructor(e,t,r){super(e,t,r);const s=this.config,o=s.param;this.dims={},this.textFilters={},this.numberFilters={},s.filters=s.filters||{},this.hasFiltred=!1,this.contentDiv.style.overflowY="auto";for(let a of o){const l=e.columnIndex[a],u=createEl("div",{styles:{padding:"5px"}},this.contentDiv);u.__fcol__=l.field,createEl("div",{text:l.name,classes:["i-title"],styles:{fontWeight:"bold"}},u),l.datatype==="text"?this.addTextFilter(l,u):l.datatype==="multitext"?this.addMultiTextFilter(l,u):(l.datatype==="integer"||l.datatype==="double")&&this.addNumberFilter(l,u)}makeSortable(this.contentDiv,{handle:"i-title",sortEnded:a=>{this.config.param=a.map(l=>l.__fcol__)}}),this.hasFiltered&&setTimeout(()=>this.dataStore.triggerFilter(),0)}removeFilter(){const e=this.config.filters;for(let t in this.textFilters){const r=this.textFilters[t],s=e[t].operand;s?r[1].innerHTML="":(r[0].value="__none__",r[1].checked=!1),e[t].category=s?[]:"__none__",e[t].exclude=!1}for(let t in this.numberFilters){const r=this.dataStore.getMinMaxForColumn(t);this.numberFilters[t].noUiSlider.set([r[0],r[1]]),e[t]=null}this.resetButton.style.display="none";for(let t in this.dims)this.dims[t].removeFilter(!1);this.dataStore.triggerFilter()}onDataFiltered(e){}addNumberFilter(e,t){const r=createEl("div",{styles:{margin:"10px 10px"}},t),s=createEl("div",{styles:{padding:"3px 10px",overflow:"hidden"}},t);createEl("span",{text:">",styles:{float:"left",fontWeight:"bold"}},s);const o=createEl("input",{styles:{width:"70px",float:"left"}},s);createEl("span",{text:"<",styles:{float:"right",fontWeight:"bold"}},s);const a=createEl("input",{styles:{width:"70px",float:"right"}},s),l=this.config,u=this.dataStore.getDimension("range_dimension");u.noclear=!0,this.dims[e.field]=u;const p=this.dataStore.getMinMaxForColumn(e.field),d=l.filters[e.field];let m=[p[0],p[1]];d&&(m=[d[0],d[1]]),noUiSlider.create(r,{start:[m[0],m[1]],range:{min:p[0],max:p[1]},tooltips:!0,documentElement:this.__doc__}),r.noUiSlider.on("set",g=>{const w=parseFloat(g[0]),E=parseFloat(g[1]);w<=p[0]&&E>=p[1]?l.filters[e.field]=null:l.filters[e.field]=[w,E],a.value=E,o.value=w,this.filterCategories(e.field)}),a.value=m[1],o.value=m[0],o.addEventListener("blur",g=>{let w=parseFloat(o.value);const E=r.noUiSlider.get();isNaN(w)||w>E[1]||(w=w<p[0]?p[0]:w,r.noUiSlider.set([w,E[1]],!0,!0))}),o.addEventListener("keypress",g=>{g.key==="Enter"&&o.blur()}),a.addEventListener("blur",g=>{let w=parseFloat(a.value);const E=r.noUiSlider.get();isNaN(w)||w<E[0]||(w=w>p[1]?p[1]:w,r.noUiSlider.set([E[0],w],!0,!0))}),a.addEventListener("keypress",g=>{g.key==="Enter"&&a.blur()}),d&&(this.filterCategories(e.field,!1),this.hasFiltered=!0),this.numberFilters[e.field]=r}filterCategories(e,t=!0){const r=this.config.filters[e],s=this.dataStore.columnIndex[e].datatype;if(s==="text")if(r.category==="__none__")this.dims[e].removeFilter();else{let o=[r.category];r.exclude&&(o=this.dataStore.getColumnValues(e).filter(a=>a!==r.category)),this.resetButton.style.display="inline",this.dims[e].filter("filterCategories",[e],o,t)}else if(s==="multitext")if(r.category.length===0)this.dims[e].removeFilter();else{this.resetButton.style.display="inline";const o=r.category.slice(0);o.operand=r.operand,this.dims[e].filter("filterCategories",[e],o,t)}else r?(this.resetButton.style.display="inline",this.dims[e].filter("filterRange",[e],{min:r[0],max:r[1]},t)):this.dims[e].removeFilter()}createTag(e,t,r,s=!0){s&&this.config.filters[t.field].category.push(r);const o=createEl("div",{},e);createEl("span",{text:r},o),createEl("i",{classes:["fas","fa-times"]},o).addEventListener("click",l=>{this.config.filters[t.field].category=this.config.filters[t.field].category.filter(u=>u!==r),console.log(this.config.filters[t.field].category),o.remove(),this.filterCategories(t.field)})}addMultiTextFilter(e,t){let r=createEl("div",{style:{whiteSpace:"nowrap"}},t);const s=this.config,o=this.dataStore.getDimension("category_dimension");o.noclear=!0,this.dims[e.field]=o,s.filters[e.field]?(this.filterCategories(e.field,!1),this.hasFiltered=!0):s.filters[e.field]={operand:"or",category:[]};const a=s.filters[e.field],l=createEl("select",{classes:["mdv-select"],styles:{maxWidth:"200px"}});for(let w of e.values.slice(0).sort())createEl("option",{text:w,value:w},l);r.append(l);const u=createEl("button",{classes:["ciview-button-sm"],text:"Add"},r),p=createEl("div",{},r);u.addEventListener("click",w=>{a.category.indexOf(l.value)===-1&&(this.createTag(p,e,l.value),this.filterCategories(e.field))}),r=createEl("div",{},t);const d=getRandomString();createEl("span",{text:"and"},r);const m=createEl("input",{type:"radio",name:d,value:"and"},r);m.checked=a.operand==="and",m.addEventListener("click",w=>{a.operand="and",this.filterCategories(e.field)}),createEl("span",{text:"or"},r);const g=createEl("input",{type:"radio",name:d,value:"or"},r);g.checked=a.operand==="or",g.addEventListener("click",w=>{a.operand="or",this.filterCategories(e.field)});for(let w of a.category)this.createTag(p,e,w,!1);this.textFilters[e.field]=[l,p]}addTextFilter(e,t){t.style.whiteSpace="nowrap";const r=this.config,s=this.dataStore.getDimension("category_dimension");s.noclear=!0,this.dims[e.field]=s,r.filters[e.field]?(this.filterCategories(e.field,!1),this.hasFiltered=!0):r.filters[e.field]={exclude:!1,category:"__none__"};const o=r.filters[e.field],a=createEl("select",{classes:["mdv-select"],styles:{maxWidth:"200px"}});createEl("option",{text:"None",value:"__none__"},a);for(let u of e.values)createEl("option",{text:u,value:u},a);t.append(a),a.value=o.category,a.addEventListener("change",u=>{o.category=a.value,this.filterCategories(e.field)});const l=createEl("input",{classes:["mdv-checkbox"],type:"checkbox"},t);l.checked=o.exclude,l.addEventListener("click",u=>{o.exclude=l.checked,this.filterCategories(e.field)}),createEl("span",{text:"exclude",style:{fontSize:"11px",verticalAlign:"middle"}},t),this.textFilters[e.field]=[a,l]}remove(e=!0){for(let t in this.dims)this.dims[t].destroy(!1);e&&this.dataStore.triggerFilter(),super.remove()}}BaseChart.types.selection_dialog={name:"Selection Dialog",class:SelectionDialog,params:[{type:"_multi_column:all",name:"Columns To filter"}]};class AutoComplete{constructor(e,t,r={}){this.__doc__=r.doc||document,this.input=e,this.listeners=[],r.minLength=r.minLength||2,this.input.addEventListener("input",s=>{this.input.value.length<r.minLength||(this.text=this.input.value,t(this.text).then(o=>{this.list=o,this.createDropDown()}))}),this.dli=s=>{s.target.parent!==this.lisHolder&&this.listHolder&&(this.listHolder.remove(),this.listHolder=null)},this.__doc__.addEventListener("mousedown",this.dli)}getSelectedItem(){return this.selectedItem}addListener(e){this.listeners.push(e)}destroy(){this.listholder&&this.listholder.remove(),this.__doc__.removeEventListener("click",this.dli)}setSelectedItem(e,t=!0){this.selectedItem=e,this.input.value=e.value,t&&this.listeners.map(r=>r("item_chose",e))}addItemEventListener(e,t){e.addEventListener("click",r=>{this.listHolder.remove(),this.listHolder=null,this.setSelectedItem(t)})}createDropDown(){if(this.listHolder&&this.listHolder.remove(),!this.text)return;const e=getElDim(this.input);this.listHolder=createEl("div",{classes:["autocomplete-items"],styles:{top:e.top+e.height+"px",left:e.left+"px",width:e.width+"px",zIndex:1200}},this.__doc__.body);for(let t=0;t<this.list.length;t++){const r=this.list[t].value;let s=createEl("div",{text:r},this.listHolder);this.addItemEventListener(s,this.list[t])}}}const max_genes=500;class AddColumnsFromRowsDialog extends BaseDialog{constructor(e,t,r,s){const o={title:`Add ${r.name}`,footer:!0,columns:2,width:380};super(o,{ds:e,ds_to:t,link:r,cm:s})}init(e){this.ds=e.ds,this.ds_to=e.ds_to,this.link=e.link,this.cm=e.cm;const t=createEl("div",{classes:["mdv-section"]},this.columns[0]),r=createEl("input",{},t);this.ac=new AutoComplete(r,async u=>this.ds_to.dataStore.getSuggestedValues(u,this.link.name_column,8)),this.ac.addListener((u,p)=>this.addColumn(p)),this.rn=getRandomString();for(let u in this.link.subgroups)createEl("label",{text:this.link.subgroups[u].label},this.footer),createEl("input",{type:"radio",name:this.rn,value:u,checked:!0},this.footer);this._addOptionsSection(),createEl("button",{classes:["ciview-button-sm"],styles:[],text:"Apply"},this.columns[0]).addEventListener("click",()=>{this.addColumn(this.ac.getSelectedItem())}),this.ta=createEl("textarea",{rows:10},this.columns[1]),this.errorDiv=createEl("div",{classes:["mdv-section"]},this.columns[1]);let o=createEl("div",{classes:["mdv-section"]},this.columns[1]);this.addHeatMapCheck=createEl("input",{type:"checkbox"},o),createEl("span",{text:"Create Heat Map:",styles:{marginRight:"4px"}},o),o=createEl("div",{classes:["mdv-section"]},this.columns[1]),createEl("span",{text:"Categories:",styles:{marginRight:"4px"}},o),this.heatMapSel=createEl("select",{styles:{maxWidth:"150px"}},o),this.ds.dataStore.getColumnList("text").forEach(u=>createEl("option",{value:u.field,text:u.name},this.heatMapSel)),createEl("button",{classes:["ciview-button-sm"],text:"Add All"},this.columns[1]).addEventListener("click",u=>{this.parseNames()}),this.cm.addListener(this.rn,(u,p,d)=>{switch(u){case"chart_added":this._addColorChartOption(d);break;case"chart_removed":this._addColorChartOption(d,!0);break;case"filtered":console.log("ss");break;case"view_laoded":this.close()}}),this.itemList=[];const l=this.ds_to.dataStore;l.addListener(this.rn,(u,p)=>{if(u==="data_highlighted"){const d=p.indexes.length;if(d==1){const m=p.indexes[0],g=l.getRowText(m,this.link.name_column);this.ac.setSelectedItem({value:g,index:m})}else d<200?this.ta.value=p.indexes.map(m=>l.getRowText(m,this.link.name_column)).join(`
`):this.ta.value="Too many items selected"}else u==="filtered"&&(l.filterSize<max_genes&&l.isFiltered()?this.ta.value=l.getFilteredValues(this.link.name_column).join(`
`):this.ta.value="Too many items selected")})}addFilteredItems(){const e=this.ds_to.dataStore;for(let t=0;t<e.size;t++)e.filterArray[t]===0&&(this.itemList.push(t),createEl("div",{text:e.getRowText(t,this.link.name_column)},this.columns[1]))}close(){this.cm.removeListener(this.rn),this.ds_to.dataStore.removeListener(this.rn),this.ac.destroy(),super.close()}_addColorChartOption(e,t=!1){const r=e.config;if(!(e.dataStore!==this.ds.dataStore||!e.getColorOptions().colorby)){if(t){const s=this.colorChartSelect.querySelector(`[value='${r.id}']`);s&&s.remove(),this.colorChartSelect.children.length===0&&this.colorDiv.classList.add("mdv-disabled");return}createEl("option",{value:r.id,text:r.title},this.colorChartSelect),this.colorDiv.classList.remove("mdv-disabled")}}_addOptionsSection(){this.colorDiv=createEl("div",{classes:["mdv-section","mdv-disabled"]},this.columns[0]),this.colorCheck=createEl("input",{type:"checkbox"},this.colorDiv),createEl("span",{text:"Color Chart:",styles:{marginRight:"4px"}},this.colorDiv),createEl("br",{},this.colorDiv),this.colorChartSelect=createEl("select",{styles:{maxWidth:"150px"}},this.colorDiv);for(let t in this.cm.charts)this._addColorChartOption(this.cm.charts[t].chart);const e=createEl("div",{classes:["mdv-section"]},this.columns[0]);this.histoCheck=createEl("input",{type:"checkbox"},e),createEl("span",{text:"Create Histogram:",styles:{marginRight:"4px"}},e)}parseNames(){let e=this.ta.value.replaceAll('"',"").split(/[,\s]+/);e=e.filter(o=>o!=="");const t=this.ds_to.dataStore.getColumnIndex(this.link.name_column);let r=!1;const s=new Array(e.length);for(let o=0;o<e.length;o++){const a=t[e[o]];a!==void 0?s[o]={value:e[o],index:a}:(r=!0,e[o]=e[o]+"??")}r?(this.errorDiv.textContent="Some Entries were unrecognised",this.ta.value="",this.ta.value=e.join(`
`)):(this.errorDiv.textContent="",this.addColumn(s))}addColumn(e){const r=document.querySelector(`input[name='${this.rn}']:checked`).value,s=Array.isArray(e),o=s?e:[e],a=[];for(let l of o){const u=`${r}|${l.value}(${r})|${l.index}`;if(this.ds.dataStore.addColumnFromField(u),a.push(u),!s){if(this.colorCheck.checked){const p=this.colorChartSelect.value;p&&this.cm.getChart(p).colorByColumn(u)}this.histoCheck.checked&&this.cm.addChart(this.ds.name,{type:"bar_chart",param:u});return}}this.addHeatMapCheck.checked&&this.cm.addChart(this.ds.name,{type:"heat_map",param:[this.heatMapSel.value].concat(a)})}}class ColorChooser extends BaseDialog{constructor(e,t){const r={footer:!0,width:500,maxHeight:500,title:"Field Colors For "+t.name,columns:2,buttons:[{text:"Apply",method:"applyColor"}]};super(r,{cm:e,ds:t})}init(e){this.cm=e.cm,this.ds=e.ds;const t=this.columns[1];this.columns[0].style.overflowY="auto";const r={whiteSpace:"nowrap",padding:"2px"};createEl("div",{styles:r},t);const s={width:"70px",display:"inline-block"},o=createEl("div",{styles:r},t);createEl("label",{text:"Field:",styles:s},o),this.columnSelect=createEl("select",{classes:["mdv-select"],styles:{maxWidth:"150px"}},o);const a=createEl("div",{styles:r},t);createEl("div",{text:"Color Scheme",styles:{fontWeight:"bold"}},a),createEl("span",{classes:["mdv-info-text"],text:"Paste list of colors (hex)"},a);const l=createEl("div",{styles:{display:"flex",alignItems:"flex-start",marginTop:"2px"}},t);this.colorList=createEl("textarea",{classes:["mdv-select"],styles:{width:"100px",padding:"2px",height:"150px"}},l),this.setDataSource(this.ds.dataStore.name),createEl("button",{classes:["ciview-button-sm"],text:"Use Scheme"},l).addEventListener("click",()=>{this.parseColors(this.colorList.value)})}parseColors(e){const t=/^#[0-9A-F]{6}$/i;let r=e.replaceAll('"',"").split(/[,\s]+/);r=r.filter(a=>a.match(t));const s=r.join(`
`);this.colorList.value=s;let o=0;if(s.length>0)for(let a=0;a<this.colorChoosers.length;a++)this.colorChoosers[a].value=r[o],o++,o===r.length&&(o=0)}setDataSource(e){this.columnSelect.innerHTML="";const t=this.cm.getDataSource(e);this.dataSource=t,this.dsName=e;const r=t.getColumnList("text");for(let s of r)createEl("option",{text:s.name,value:s.field},this.columnSelect);this.columnSelect.addEventListener("change",()=>{this.setColumn(this.columnSelect.value)}),this.setColumn(r[0].field)}applyColor(){const e=new Array(this.colorChoosers.length);this.colorChoosers.forEach(t=>e[t.__index]=t.value),this.dataSource.setColumnColors(this.column,e),this.dataSource.dataChanged([this.column],!1,!1);for(let t of this.cm.dataSources){const r=t.dataStore,s=r.syncColumnColors.find(a=>a.dataSource===this.dataSource.name);if(s){const a=s.columns.find(l=>l.link_to===this.column);a&&(this.cm._sync_colors([a],this.dataSource,r),r.dataChanged([a.col],!1,!1))}const o=r.linkColumns.find(a=>a.dataSource===this.dataSource.name);o&&o.columns.indexOf(this.column)!==-1&&(r.setColumnColors(this.column,e),r.dataChanged([this.column],!1,!1))}}setColumn(e){const t=this.columns[0];this.column=e,t.innerHTML="";const r=this.dataSource.getColumnValues(e),s=r.slice(0).sort(),o=this.dataSource.getColumnColors(e),a=o.map((l,u)=>{const p=r.indexOf(s[u]);return{index:p,color:o[p]}});this.colorChoosers=[];for(let l=0;l<s.length;l++){const u=createEl("div",{styles:{display:"flex",flexWrap:"nowrap"}},t);createEl("span",{styles:{display:"inline-block",fontSize:"0.8erm"},classes:["mdv-flex-dynamic"],text:s[l]},u);const p=createEl("input",{classes:["mdv-flex-fixed"],styles:{width:"25px",height:"20px",padding:"0px"},type:"color",value:a[l].color},u);p.__index=a[l].index,this.colorChoosers.push(p)}}}const gridstack_min="";var gridstack={},gridstackEngine={},utils={};Object.defineProperty(utils,"__esModule",{value:!0});utils.Utils=utils.obsoleteAttr=utils.obsoleteOptsDel=utils.obsoleteOpts=utils.obsolete=void 0;function obsolete(i,e,t,r,s){let o=(...a)=>(console.warn("gridstack.js: Function `"+t+"` is deprecated in "+s+" and has been replaced with `"+r+"`. It will be **removed** in a future release"),e.apply(i,a));return o.prototype=e.prototype,o}utils.obsolete=obsolete;function obsoleteOpts(i,e,t,r){i[e]!==void 0&&(i[t]=i[e],console.warn("gridstack.js: Option `"+e+"` is deprecated in "+r+" and has been replaced with `"+t+"`. It will be **removed** in a future release"))}utils.obsoleteOpts=obsoleteOpts;function obsoleteOptsDel(i,e,t,r){i[e]!==void 0&&console.warn("gridstack.js: Option `"+e+"` is deprecated in "+t+r)}utils.obsoleteOptsDel=obsoleteOptsDel;function obsoleteAttr(i,e,t,r){let s=i.getAttribute(e);s!==null&&(i.setAttribute(t,s),console.warn("gridstack.js: attribute `"+e+"`="+s+" is deprecated on this object in "+r+" and has been replaced with `"+t+"`. It will be **removed** in a future release"))}utils.obsoleteAttr=obsoleteAttr;class Utils{static getElements(e){if(typeof e=="string"){let t=document.querySelectorAll(e);return!t.length&&e[0]!=="."&&e[0]!=="#"&&(t=document.querySelectorAll("."+e),t.length||(t=document.querySelectorAll("#"+e))),Array.from(t)}return[e]}static getElement(e){if(typeof e=="string"){if(!e.length)return null;if(e[0]==="#")return document.getElementById(e.substring(1));if(e[0]==="."||e[0]==="[")return document.querySelector(e);if(!isNaN(+e[0]))return document.getElementById(e);let t=document.querySelector(e);return t||(t=document.getElementById(e)),t||(t=document.querySelector("."+e)),t}return e}static isIntercepted(e,t){return!(e.y>=t.y+t.h||e.y+e.h<=t.y||e.x+e.w<=t.x||e.x>=t.x+t.w)}static isTouching(e,t){return Utils.isIntercepted(e,{x:t.x-.5,y:t.y-.5,w:t.w+1,h:t.h+1})}static areaIntercept(e,t){let r=e.x>t.x?e.x:t.x,s=e.x+e.w<t.x+t.w?e.x+e.w:t.x+t.w;if(s<=r)return 0;let o=e.y>t.y?e.y:t.y,a=e.y+e.h<t.y+t.h?e.y+e.h:t.y+t.h;return a<=o?0:(s-r)*(a-o)}static area(e){return e.w*e.h}static sort(e,t,r){return r=r||e.reduce((s,o)=>Math.max(o.x+o.w,s),0)||12,t===-1?e.sort((s,o)=>o.x+o.y*r-(s.x+s.y*r)):e.sort((s,o)=>s.x+s.y*r-(o.x+o.y*r))}static createStylesheet(e,t){let r=document.createElement("style");return r.setAttribute("type","text/css"),r.setAttribute("gs-style-id",e),r.styleSheet?r.styleSheet.cssText="":r.appendChild(document.createTextNode("")),t?t.insertBefore(r,t.firstChild):(t=document.getElementsByTagName("head")[0],t.appendChild(r)),r.sheet}static removeStylesheet(e){let t=document.querySelector("STYLE[gs-style-id="+e+"]");t&&t.parentNode&&t.remove()}static addCSSRule(e,t,r){typeof e.addRule=="function"?e.addRule(t,r):typeof e.insertRule=="function"&&e.insertRule(`${t}{${r}}`)}static toBool(e){return typeof e=="boolean"?e:typeof e=="string"?(e=e.toLowerCase(),!(e===""||e==="no"||e==="false"||e==="0")):!!e}static toNumber(e){return e===null||e.length===0?void 0:Number(e)}static parseHeight(e){let t,r="px";if(typeof e=="string"){let s=e.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw|%)?$/);if(!s)throw new Error("Invalid height");r=s[2]||"px",t=parseFloat(s[1])}else t=e;return{h:t,unit:r}}static defaults(e,...t){return t.forEach(r=>{for(const s in r){if(!r.hasOwnProperty(s))return;e[s]===null||e[s]===void 0?e[s]=r[s]:typeof r[s]=="object"&&typeof e[s]=="object"&&this.defaults(e[s],r[s])}}),e}static same(e,t){if(typeof e!="object")return e==t;if(typeof e!=typeof t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}static copyPos(e,t,r=!1){return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,r&&(t.minW&&(e.minW=t.minW),t.minH&&(e.minH=t.minH),t.maxW&&(e.maxW=t.maxW),t.maxH&&(e.maxH=t.maxH)),e}static samePos(e,t){return e&&t&&e.x===t.x&&e.y===t.y&&e.w===t.w&&e.h===t.h}static removeInternalAndSame(e,t){if(!(typeof e!="object"||typeof t!="object"))for(let r in e){let s=e[r];if(r[0]==="_"||s===t[r])delete e[r];else if(s&&typeof s=="object"&&t[r]!==void 0){for(let o in s)(s[o]===t[r][o]||o[0]==="_")&&delete s[o];Object.keys(s).length||delete e[r]}}}static removeInternalForSave(e,t=!0){for(let r in e)(r[0]==="_"||e[r]===null||e[r]===void 0)&&delete e[r];delete e.grid,t&&delete e.el,e.autoPosition||delete e.autoPosition,e.noResize||delete e.noResize,e.noMove||delete e.noMove,e.locked||delete e.locked,(e.w===1||e.w===e.minW)&&delete e.w,(e.h===1||e.h===e.minH)&&delete e.h}static closestUpByClass(e,t){for(;e;){if(e.classList.contains(t))return e;e=e.parentElement}return null}static throttle(e,t){let r=!1;return(...s)=>{r||(r=!0,setTimeout(()=>{e(...s),r=!1},t))}}static removePositioningStyles(e){let t=e.style;t.position&&t.removeProperty("position"),t.left&&t.removeProperty("left"),t.top&&t.removeProperty("top"),t.width&&t.removeProperty("width"),t.height&&t.removeProperty("height")}static getScrollElement(e){if(!e)return document.scrollingElement||document.documentElement;const t=getComputedStyle(e);return/(auto|scroll)/.test(t.overflow+t.overflowY)?e:this.getScrollElement(e.parentElement)}static updateScrollPosition(e,t,r){let s=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight;if(s.top<0||s.bottom>o){let a=s.bottom-o,l=s.top,u=this.getScrollElement(e);if(u!==null){let p=u.scrollTop;s.top<0&&r<0?e.offsetHeight>o?u.scrollTop+=r:u.scrollTop+=Math.abs(l)>Math.abs(r)?r:l:r>0&&(e.offsetHeight>o?u.scrollTop+=r:u.scrollTop+=a>r?r:a),t.top+=u.scrollTop-p}}}static updateScrollResize(e,t,r){const s=this.getScrollElement(t),o=s.clientHeight,a=s===this.getScrollElement()?0:s.getBoundingClientRect().top,l=e.clientY-a,u=l<r,p=l>o-r;u?s.scrollBy({behavior:"smooth",top:l-r}):p&&s.scrollBy({behavior:"smooth",top:r-(o-l)})}static clone(e){return e==null||typeof e!="object"?e:e instanceof Array?[...e]:Object.assign({},e)}static cloneDeep(e){const t=["parentGrid","el","grid","subGrid","engine"],r=Utils.clone(e);for(const s in r)r.hasOwnProperty(s)&&typeof r[s]=="object"&&s.substring(0,2)!=="__"&&!t.find(o=>o===s)&&(r[s]=Utils.cloneDeep(e[s]));return r}static cloneNode(e){const t=e.cloneNode(!0);return t.removeAttribute("id"),t}static appendTo(e,t){let r;typeof t=="string"?r=document.querySelector(t):r=t,r&&r.appendChild(e)}static addElStyles(e,t){if(t instanceof Object)for(const r in t)t.hasOwnProperty(r)&&(Array.isArray(t[r])?t[r].forEach(s=>{e.style[r]=s}):e.style[r]=t[r])}static initEvent(e,t){const r={type:t.type},s={button:0,which:0,buttons:1,bubbles:!0,cancelable:!0,target:t.target?t.target:e.target};return e.dataTransfer&&(r.dataTransfer=e.dataTransfer),["altKey","ctrlKey","metaKey","shiftKey"].forEach(o=>r[o]=e[o]),["pageX","pageY","clientX","clientY","screenX","screenY"].forEach(o=>r[o]=e[o]),Object.assign(Object.assign({},r),s)}static simulateMouseEvent(e,t,r){const s=document.createEvent("MouseEvents");s.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,e.target),(r||e.target).dispatchEvent(s)}}utils.Utils=Utils;Object.defineProperty(gridstackEngine,"__esModule",{value:!0});gridstackEngine.GridStackEngine=void 0;const utils_1=utils;class GridStackEngine{constructor(e={}){this.addedNodes=[],this.removedNodes=[],this.column=e.column||12,this.maxRow=e.maxRow,this._float=e.float,this.nodes=e.nodes||[],this.onChange=e.onChange}batchUpdate(e=!0){return!!this.batchMode===e?this:(this.batchMode=e,e?(this._prevFloat=this._float,this._float=!0,this.saveInitial()):(this._float=this._prevFloat,delete this._prevFloat,this._packNodes()._notify()),this)}_useEntireRowArea(e,t){return!this.float&&!this._hasLocked&&(!e._moving||e._skipDown||t.y<=e.y)}_fixCollisions(e,t=e,r,s={}){if(this.sortNodes(-1),r=r||this.collide(e,t),!r)return!1;if(e._moving&&!s.nested&&!this.float&&this.swap(e,r))return!0;let o=t;this._useEntireRowArea(e,t)&&(o={x:0,w:this.column,y:t.y,h:t.h},r=this.collide(e,o,s.skip));let a=!1,l={nested:!0,pack:!1};for(;r=r||this.collide(e,o,s.skip);){let u;if(r.locked||e._moving&&!e._skipDown&&t.y>e.y&&!this.float&&(!this.collide(r,Object.assign(Object.assign({},r),{y:e.y}),e)||!this.collide(r,Object.assign(Object.assign({},r),{y:t.y-r.h}),e))?(e._skipDown=e._skipDown||t.y>e.y,u=this.moveNode(e,Object.assign(Object.assign(Object.assign({},t),{y:r.y+r.h}),l)),r.locked&&u?utils_1.Utils.copyPos(t,e):!r.locked&&u&&s.pack&&(this._packNodes(),t.y=r.y+r.h,utils_1.Utils.copyPos(e,t)),a=a||u):u=this.moveNode(r,Object.assign(Object.assign(Object.assign({},r),{y:t.y+t.h,skip:e}),l)),!u)return a;r=void 0}return a}collide(e,t=e,r){return this.nodes.find(s=>s!==e&&s!==r&&utils_1.Utils.isIntercepted(s,t))}collideAll(e,t=e,r){return this.nodes.filter(s=>s!==e&&s!==r&&utils_1.Utils.isIntercepted(s,t))}directionCollideCoverage(e,t,r){if(!t.rect||!e._rect)return;let s=e._rect,o=Object.assign({},t.rect);o.y>s.y?(o.h+=o.y-s.y,o.y=s.y):o.h+=s.y-o.y,o.x>s.x?(o.w+=o.x-s.x,o.x=s.x):o.w+=s.x-o.x;let a;return r.forEach(l=>{if(l.locked||!l._rect)return;let u=l._rect,p=Number.MAX_VALUE,d=Number.MAX_VALUE,m=.5;s.y<u.y?p=(o.y+o.h-u.y)/u.h:s.y+s.h>u.y+u.h&&(p=(u.y+u.h-o.y)/u.h),s.x<u.x?d=(o.x+o.w-u.x)/u.w:s.x+s.w>u.x+u.w&&(d=(u.x+u.w-o.x)/u.w);let g=Math.min(d,p);g>m&&(m=g,a=l)}),t.collide=a,a}cacheRects(e,t,r,s,o,a){return this.nodes.forEach(l=>l._rect={y:l.y*t+r,x:l.x*e+a,w:l.w*e-a-s,h:l.h*t-r-o}),this}swap(e,t){if(!t||t.locked||!e||e.locked)return!1;function r(){let o=t.x,a=t.y;return t.x=e.x,t.y=e.y,e.h!=t.h?(e.x=o,e.y=t.y+t.h):e.w!=t.w?(e.x=t.x+t.w,e.y=a):(e.x=o,e.y=a),e._dirty=t._dirty=!0,!0}let s;if(e.w===t.w&&e.h===t.h&&(e.x===t.x||e.y===t.y)&&(s=utils_1.Utils.isTouching(e,t)))return r();if(s!==!1){if(e.w===t.w&&e.x===t.x&&(s||(s=utils_1.Utils.isTouching(e,t)))){if(t.y<e.y){let o=e;e=t,t=o}return r()}if(s!==!1){if(e.h===t.h&&e.y===t.y&&(s||(s=utils_1.Utils.isTouching(e,t)))){if(t.x<e.x){let o=e;e=t,t=o}return r()}return!1}}}isAreaEmpty(e,t,r,s){let o={x:e||0,y:t||0,w:r||1,h:s||1};return!this.collide(o)}compact(){if(this.nodes.length===0)return this;this.batchUpdate().sortNodes();let e=this.nodes;return this.nodes=[],e.forEach(t=>{t.locked||(t.autoPosition=!0),this.addNode(t,!1),t._dirty=!0}),this.batchUpdate(!1)}set float(e){this._float!==e&&(this._float=e||!1,e||this._packNodes()._notify())}get float(){return this._float||!1}sortNodes(e){return this.nodes=utils_1.Utils.sort(this.nodes,e,this.column),this}_packNodes(){return this.batchMode?this:(this.sortNodes(),this.float?this.nodes.forEach(e=>{if(e._updating||e._orig===void 0||e.y===e._orig.y)return;let t=e.y;for(;t>e._orig.y;)--t,this.collide(e,{x:e.x,y:t,w:e.w,h:e.h})||(e._dirty=!0,e.y=t)}):this.nodes.forEach((e,t)=>{if(!e.locked)for(;e.y>0;){let r=t===0?0:e.y-1;if(!(t===0||!this.collide(e,{x:e.x,y:r,w:e.w,h:e.h})))break;e._dirty=e.y!==r,e.y=r}}),this)}prepareNode(e,t){e=e||{},e._id=e._id||GridStackEngine._idSeq++,(e.x===void 0||e.y===void 0||e.x===null||e.y===null)&&(e.autoPosition=!0);let r={x:0,y:0,w:1,h:1};return utils_1.Utils.defaults(e,r),e.autoPosition||delete e.autoPosition,e.noResize||delete e.noResize,e.noMove||delete e.noMove,typeof e.x=="string"&&(e.x=Number(e.x)),typeof e.y=="string"&&(e.y=Number(e.y)),typeof e.w=="string"&&(e.w=Number(e.w)),typeof e.h=="string"&&(e.h=Number(e.h)),isNaN(e.x)&&(e.x=r.x,e.autoPosition=!0),isNaN(e.y)&&(e.y=r.y,e.autoPosition=!0),isNaN(e.w)&&(e.w=r.w),isNaN(e.h)&&(e.h=r.h),this.nodeBoundFix(e,t)}nodeBoundFix(e,t){let r=e._orig||utils_1.Utils.copyPos({},e);if(e.maxW&&(e.w=Math.min(e.w,e.maxW)),e.maxH&&(e.h=Math.min(e.h,e.maxH)),e.minW&&e.minW<=this.column&&(e.w=Math.max(e.w,e.minW)),e.minH&&(e.h=Math.max(e.h,e.minH)),(this.column===1||e.x+e.w>this.column)&&this.column<12&&!this._inColumnResize&&!e.autoPosition&&e._id&&this.findCacheLayout(e,12)===-1){let o=Object.assign({},e);o.x=Math.min(11,o.x),o.w=Math.min(12,o.w),this.cacheOneLayout(o,12)}return e.w>this.column?e.w=this.column:e.w<1&&(e.w=1),this.maxRow&&e.h>this.maxRow?e.h=this.maxRow:e.h<1&&(e.h=1),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x+e.w>this.column&&(t?e.w=this.column-e.x:e.x=this.column-e.w),this.maxRow&&e.y+e.h>this.maxRow&&(t?e.h=this.maxRow-e.y:e.y=this.maxRow-e.h),utils_1.Utils.samePos(e,r)||(e._dirty=!0),e}getDirtyNodes(e){return e?this.nodes.filter(t=>t._dirty&&!utils_1.Utils.samePos(t,t._orig)):this.nodes.filter(t=>t._dirty)}_notify(e){if(this.batchMode||!this.onChange)return this;let t=(e||[]).concat(this.getDirtyNodes());return this.onChange(t),this}cleanNodes(){return this.batchMode?this:(this.nodes.forEach(e=>{delete e._dirty,delete e._lastTried}),this)}saveInitial(){return this.nodes.forEach(e=>{e._orig=utils_1.Utils.copyPos({},e),delete e._dirty}),this._hasLocked=this.nodes.some(e=>e.locked),this}restoreInitial(){return this.nodes.forEach(e=>{utils_1.Utils.samePos(e,e._orig)||(utils_1.Utils.copyPos(e,e._orig),e._dirty=!0)}),this._notify(),this}findEmptyPosition(e){this.sortNodes();let t=!1;for(let r=0;!t;++r){let s=r%this.column,o=Math.floor(r/this.column);if(s+e.w>this.column)continue;let a={x:s,y:o,w:e.w,h:e.h};this.nodes.find(l=>utils_1.Utils.isIntercepted(a,l))||(e.x=s,e.y=o,t=!0)}return t}addNode(e,t=!1){let r=this.nodes.find(s=>s._id===e._id);return r||(e=this._inColumnResize?this.nodeBoundFix(e):this.prepareNode(e),delete e._temporaryRemoved,delete e._removeDOM,e.autoPosition&&this.findEmptyPosition(e)&&delete e.autoPosition,this.nodes.push(e),t&&this.addedNodes.push(e),this._fixCollisions(e),this.batchMode||this._packNodes()._notify(),e)}removeNode(e,t=!0,r=!1){return this.nodes.find(s=>s===e)?(r&&this.removedNodes.push(e),t&&(e._removeDOM=!0),this.nodes=this.nodes.filter(s=>s!==e),this._packNodes()._notify([e])):this}removeAll(e=!0){return delete this._layouts,this.nodes.length===0?this:(e&&this.nodes.forEach(t=>t._removeDOM=!0),this.removedNodes=this.nodes,this.nodes=[],this._notify(this.removedNodes))}moveNodeCheck(e,t){if(!this.changedPosConstrain(e,t))return!1;if(t.pack=!0,!this.maxRow)return this.moveNode(e,t);let r,s=new GridStackEngine({column:this.column,float:this.float,nodes:this.nodes.map(a=>a===e?(r=Object.assign({},a),r):Object.assign({},a))});if(!r)return!1;let o=s.moveNode(r,t)&&s.getRow()<=this.maxRow;if(!o&&!t.resizing&&t.collide){let a=t.collide.el.gridstackNode;if(this.swap(e,a))return this._notify(),!0}return o?(s.nodes.filter(a=>a._dirty).forEach(a=>{let l=this.nodes.find(u=>u._id===a._id);l&&(utils_1.Utils.copyPos(l,a),l._dirty=!0)}),this._notify(),!0):!1}willItFit(e){if(delete e._willFitPos,!this.maxRow)return!0;let t=new GridStackEngine({column:this.column,float:this.float,nodes:this.nodes.map(s=>Object.assign({},s))}),r=Object.assign({},e);return this.cleanupNode(r),delete r.el,delete r._id,delete r.content,delete r.grid,t.addNode(r),t.getRow()<=this.maxRow?(e._willFitPos=utils_1.Utils.copyPos({},r),!0):!1}changedPosConstrain(e,t){return t.w=t.w||e.w,t.h=t.h||e.h,e.x!==t.x||e.y!==t.y?!0:(e.maxW&&(t.w=Math.min(t.w,e.maxW)),e.maxH&&(t.h=Math.min(t.h,e.maxH)),e.minW&&(t.w=Math.max(t.w,e.minW)),e.minH&&(t.h=Math.max(t.h,e.minH)),e.w!==t.w||e.h!==t.h)}moveNode(e,t){var r,s;if(!e||!t)return!1;let o;t.pack===void 0&&(o=t.pack=!0),typeof t.x!="number"&&(t.x=e.x),typeof t.y!="number"&&(t.y=e.y),typeof t.w!="number"&&(t.w=e.w),typeof t.h!="number"&&(t.h=e.h);let a=e.w!==t.w||e.h!==t.h,l=utils_1.Utils.copyPos({},e,!0);if(utils_1.Utils.copyPos(l,t),l=this.nodeBoundFix(l,a),utils_1.Utils.copyPos(t,l),utils_1.Utils.samePos(e,t))return!1;let u=utils_1.Utils.copyPos({},e),p=this.collideAll(e,l,t.skip),d=!0;if(p.length){let m=e._moving&&!t.nested,g=m?this.directionCollideCoverage(e,t,p):p[0];if(m&&g&&(!((s=(r=e.grid)===null||r===void 0?void 0:r.opts)===null||s===void 0)&&s.subGridDynamic)&&!e.grid._isTemp){let w=utils_1.Utils.areaIntercept(t.rect,g._rect),E=utils_1.Utils.area(t.rect),A=utils_1.Utils.area(g._rect);w/(E<A?E:A)>.8&&(g.grid.makeSubGrid(g.el,void 0,e),g=void 0)}g?d=!this._fixCollisions(e,l,g,t):(d=!1,o&&delete t.pack)}return d&&(e._dirty=!0,utils_1.Utils.copyPos(e,l)),t.pack&&this._packNodes()._notify(),!utils_1.Utils.samePos(e,u)}getRow(){return this.nodes.reduce((e,t)=>Math.max(e,t.y+t.h),0)}beginUpdate(e){return e._updating||(e._updating=!0,delete e._skipDown,this.batchMode||this.saveInitial()),this}endUpdate(){let e=this.nodes.find(t=>t._updating);return e&&(delete e._updating,delete e._skipDown),this}save(e=!0){var t;let r=(t=this._layouts)===null||t===void 0?void 0:t.length,s=r&&this.column!==r-1?this._layouts[r-1]:null,o=[];return this.sortNodes(),this.nodes.forEach(a=>{let l=s==null?void 0:s.find(p=>p._id===a._id),u=Object.assign({},a);l&&(u.x=l.x,u.y=l.y,u.w=l.w),utils_1.Utils.removeInternalForSave(u,!e),o.push(u)}),o}layoutsNodesChange(e){return!this._layouts||this._inColumnResize?this:(this._layouts.forEach((t,r)=>{if(!t||r===this.column)return this;if(r<this.column)this._layouts[r]=void 0;else{let s=r/this.column;e.forEach(o=>{if(!o._orig)return;let a=t.find(l=>l._id===o._id);a&&(o.y!==o._orig.y&&(a.y+=o.y-o._orig.y),o.x!==o._orig.x&&(a.x=Math.round(o.x*s)),o.w!==o._orig.w&&(a.w=Math.round(o.w*s)))})}}),this)}updateNodeWidths(e,t,r,s="moveScale"){var o;if(!this.nodes.length||!t||e===t)return this;this.cacheLayout(this.nodes,e),this.batchUpdate();let a=[],l=!1;if(t===1&&(r!=null&&r.length)){l=!0;let p=0;r.forEach(d=>{d.x=0,d.w=1,d.y=Math.max(d.y,p),p=d.y+d.h}),a=r,r=[]}else r=utils_1.Utils.sort(this.nodes,-1,e);let u=[];if(t>e){u=this._layouts[t]||[];let p=this._layouts.length-1;!u.length&&e!==p&&(!((o=this._layouts[p])===null||o===void 0)&&o.length)&&(e=p,this._layouts[p].forEach(d=>{let m=r.find(g=>g._id===d._id);m&&(m.x=d.x,m.y=d.y,m.w=d.w)}))}if(u.forEach(p=>{let d=r.findIndex(m=>m._id===p._id);d!==-1&&(r[d].x=p.x,r[d].y=p.y,r[d].w=p.w,a.push(r[d]),r.splice(d,1))}),r.length){if(typeof s=="function")s(t,e,a,r);else if(!l){let p=t/e,d=s==="move"||s==="moveScale",m=s==="scale"||s==="moveScale";r.forEach(g=>{g.x=t===1?0:d?Math.round(g.x*p):Math.min(g.x,t-1),g.w=t===1||e===1?1:m?Math.round(g.w*p)||1:Math.min(g.w,t),a.push(g)}),r=[]}}return l||(a=utils_1.Utils.sort(a,-1,t)),this._inColumnResize=!0,this.nodes=[],a.forEach(p=>{this.addNode(p,!1),delete p._orig}),this.batchUpdate(!1),delete this._inColumnResize,this}cacheLayout(e,t,r=!1){let s=[];return e.forEach((o,a)=>{o._id=o._id||GridStackEngine._idSeq++,s[a]={x:o.x,y:o.y,w:o.w,_id:o._id}}),this._layouts=r?[]:this._layouts||[],this._layouts[t]=s,this}cacheOneLayout(e,t){e._id=e._id||GridStackEngine._idSeq++;let r={x:e.x,y:e.y,w:e.w,_id:e._id};this._layouts=this._layouts||[],this._layouts[t]=this._layouts[t]||[];let s=this.findCacheLayout(e,t);return s===-1?this._layouts[t].push(r):this._layouts[t][s]=r,this}findCacheLayout(e,t){var r,s,o;return(o=(s=(r=this._layouts)===null||r===void 0?void 0:r[t])===null||s===void 0?void 0:s.findIndex(a=>a._id===e._id))!==null&&o!==void 0?o:-1}cleanupNode(e){for(let t in e)t[0]==="_"&&t!=="_id"&&delete e[t];return this}}gridstackEngine.GridStackEngine=GridStackEngine;GridStackEngine._idSeq=1;var types={};Object.defineProperty(types,"__esModule",{value:!0});types.dragInDefaultOptions=types.gridDefaults=void 0;types.gridDefaults={alwaysShowResizeHandle:"mobile",animate:!0,auto:!0,cellHeight:"auto",cellHeightThrottle:100,cellHeightUnit:"px",column:12,draggable:{handle:".grid-stack-item-content",appendTo:"body"},handle:".grid-stack-item-content",itemClass:"grid-stack-item",margin:10,marginUnit:"px",maxRow:0,minRow:0,oneColumnSize:768,placeholderClass:"grid-stack-placeholder",placeholderText:"",removableOptions:{accept:".grid-stack-item"},resizable:{handles:"se"},rtl:"auto"};types.dragInDefaultOptions={handle:".grid-stack-item-content",appendTo:"body"};var ddTouch={},ddManager={},hasRequiredDdManager;function requireDdManager(){if(hasRequiredDdManager)return ddManager;hasRequiredDdManager=1,Object.defineProperty(ddManager,"__esModule",{value:!0}),ddManager.DDManager=void 0;class i{}return ddManager.DDManager=i,ddManager}var hasRequiredDdTouch;function requireDdTouch(){if(hasRequiredDdTouch)return ddTouch;hasRequiredDdTouch=1,Object.defineProperty(ddTouch,"__esModule",{value:!0}),ddTouch.pointerleave=ddTouch.pointerenter=ddTouch.pointerdown=ddTouch.touchend=ddTouch.touchmove=ddTouch.touchstart=ddTouch.isTouch=void 0;const i=requireDdManager();ddTouch.isTouch=typeof window<"u"&&typeof document<"u"&&("ontouchstart"in document||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0);class e{}function t(d,m){if(d.touches.length>1)return;d.cancelable&&d.preventDefault();const g=d.changedTouches[0],w=document.createEvent("MouseEvents");w.initMouseEvent(m,!0,!0,window,1,g.screenX,g.screenY,g.clientX,g.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(w)}function r(d,m){d.cancelable&&d.preventDefault();const g=document.createEvent("MouseEvents");g.initMouseEvent(m,!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(g)}function s(d){e.touchHandled||(e.touchHandled=!0,t(d,"mousedown"))}ddTouch.touchstart=s;function o(d){e.touchHandled&&t(d,"mousemove")}ddTouch.touchmove=o;function a(d){if(!e.touchHandled)return;e.pointerLeaveTimeout&&(window.clearTimeout(e.pointerLeaveTimeout),delete e.pointerLeaveTimeout);const m=!!i.DDManager.dragElement;t(d,"mouseup"),m||t(d,"click"),e.touchHandled=!1}ddTouch.touchend=a;function l(d){d.target.releasePointerCapture(d.pointerId)}ddTouch.pointerdown=l;function u(d){i.DDManager.dragElement&&r(d,"mouseenter")}ddTouch.pointerenter=u;function p(d){i.DDManager.dragElement&&(e.pointerLeaveTimeout=window.setTimeout(()=>{delete e.pointerLeaveTimeout,r(d,"mouseleave")},10))}return ddTouch.pointerleave=p,ddTouch}var ddGridstack={},ddElement={},ddResizable={},ddResizableHandle={},hasRequiredDdResizableHandle;function requireDdResizableHandle(){if(hasRequiredDdResizableHandle)return ddResizableHandle;hasRequiredDdResizableHandle=1,Object.defineProperty(ddResizableHandle,"__esModule",{value:!0}),ddResizableHandle.DDResizableHandle=void 0;const i=requireDdTouch();class e{constructor(r,s,o){this.moving=!1,this.host=r,this.dir=s,this.option=o,this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this._init()}_init(){const r=document.createElement("div");return r.classList.add("ui-resizable-handle"),r.classList.add(`${e.prefix}${this.dir}`),r.style.zIndex="100",r.style.userSelect="none",this.el=r,this.host.appendChild(this.el),this.el.addEventListener("mousedown",this._mouseDown),i.isTouch&&(this.el.addEventListener("touchstart",i.touchstart),this.el.addEventListener("pointerdown",i.pointerdown)),this}destroy(){return this.moving&&this._mouseUp(this.mouseDownEvent),this.el.removeEventListener("mousedown",this._mouseDown),i.isTouch&&(this.el.removeEventListener("touchstart",i.touchstart),this.el.removeEventListener("pointerdown",i.pointerdown)),this.host.removeChild(this.el),delete this.el,delete this.host,this}_mouseDown(r){this.mouseDownEvent=r,document.addEventListener("mousemove",this._mouseMove,!0),document.addEventListener("mouseup",this._mouseUp,!0),i.isTouch&&(this.el.addEventListener("touchmove",i.touchmove),this.el.addEventListener("touchend",i.touchend)),r.stopPropagation(),r.preventDefault()}_mouseMove(r){let s=this.mouseDownEvent;this.moving?this._triggerEvent("move",r):Math.abs(r.x-s.x)+Math.abs(r.y-s.y)>2&&(this.moving=!0,this._triggerEvent("start",this.mouseDownEvent),this._triggerEvent("move",r)),r.stopPropagation(),r.preventDefault()}_mouseUp(r){this.moving&&this._triggerEvent("stop",r),document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp,!0),i.isTouch&&(this.el.removeEventListener("touchmove",i.touchmove),this.el.removeEventListener("touchend",i.touchend)),delete this.moving,delete this.mouseDownEvent,r.stopPropagation(),r.preventDefault()}_triggerEvent(r,s){return this.option[r]&&this.option[r](s),this}}return ddResizableHandle.DDResizableHandle=e,e.prefix="ui-resizable-",ddResizableHandle}var ddBaseImpl={},hasRequiredDdBaseImpl;function requireDdBaseImpl(){if(hasRequiredDdBaseImpl)return ddBaseImpl;hasRequiredDdBaseImpl=1,Object.defineProperty(ddBaseImpl,"__esModule",{value:!0}),ddBaseImpl.DDBaseImplement=void 0;class i{constructor(){this._eventRegister={}}get disabled(){return this._disabled}on(t,r){this._eventRegister[t]=r}off(t){delete this._eventRegister[t]}enable(){this._disabled=!1}disable(){this._disabled=!0}destroy(){delete this._eventRegister}triggerEvent(t,r){if(!this.disabled&&this._eventRegister&&this._eventRegister[t])return this._eventRegister[t](r)}}return ddBaseImpl.DDBaseImplement=i,ddBaseImpl}var hasRequiredDdResizable;function requireDdResizable(){if(hasRequiredDdResizable)return ddResizable;hasRequiredDdResizable=1,Object.defineProperty(ddResizable,"__esModule",{value:!0}),ddResizable.DDResizable=void 0;const i=requireDdResizableHandle(),e=requireDdBaseImpl(),t=utils,r=requireDdManager();class s extends e.DDBaseImplement{constructor(a,l={}){super(),this._ui=()=>{const p=this.el.parentElement.getBoundingClientRect(),d={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},m=this.temporalRect||d;return{position:{left:m.left-p.left,top:m.top-p.top},size:{width:m.width,height:m.height}}},this.el=a,this.option=l,this._mouseOver=this._mouseOver.bind(this),this._mouseOut=this._mouseOut.bind(this),this.enable(),this._setupAutoHide(this.option.autoHide),this._setupHandlers()}on(a,l){super.on(a,l)}off(a){super.off(a)}enable(){super.enable(),this.el.classList.add("ui-resizable"),this.el.classList.remove("ui-resizable-disabled"),this._setupAutoHide(this.option.autoHide)}disable(){super.disable(),this.el.classList.add("ui-resizable-disabled"),this.el.classList.remove("ui-resizable"),this._setupAutoHide(!1)}destroy(){this._removeHandlers(),this._setupAutoHide(!1),this.el.classList.remove("ui-resizable"),delete this.el,super.destroy()}updateOption(a){let l=a.handles&&a.handles!==this.option.handles,u=a.autoHide&&a.autoHide!==this.option.autoHide;return Object.keys(a).forEach(p=>this.option[p]=a[p]),l&&(this._removeHandlers(),this._setupHandlers()),u&&this._setupAutoHide(this.option.autoHide),this}_setupAutoHide(a){return a?(this.el.classList.add("ui-resizable-autohide"),this.el.addEventListener("mouseover",this._mouseOver),this.el.addEventListener("mouseout",this._mouseOut)):(this.el.classList.remove("ui-resizable-autohide"),this.el.removeEventListener("mouseover",this._mouseOver),this.el.removeEventListener("mouseout",this._mouseOut),r.DDManager.overResizeElement===this&&delete r.DDManager.overResizeElement),this}_mouseOver(a){r.DDManager.overResizeElement||r.DDManager.dragElement||(r.DDManager.overResizeElement=this,this.el.classList.remove("ui-resizable-autohide"))}_mouseOut(a){r.DDManager.overResizeElement===this&&(delete r.DDManager.overResizeElement,this.el.classList.add("ui-resizable-autohide"))}_setupHandlers(){let a=this.option.handles||"e,s,se";return a==="all"&&(a="n,e,s,w,se,sw,ne,nw"),this.handlers=a.split(",").map(l=>l.trim()).map(l=>new i.DDResizableHandle(this.el,l,{start:u=>{this._resizeStart(u)},stop:u=>{this._resizeStop(u)},move:u=>{this._resizing(u,l)}})),this}_resizeStart(a){this.originalRect=this.el.getBoundingClientRect(),this.scrollEl=t.Utils.getScrollElement(this.el),this.scrollY=this.scrollEl.scrollTop,this.scrolled=0,this.startEvent=a,this._setupHelper(),this._applyChange();const l=t.Utils.initEvent(a,{type:"resizestart",target:this.el});return this.option.start&&this.option.start(l,this._ui()),this.el.classList.add("ui-resizable-resizing"),this.triggerEvent("resizestart",l),this}_resizing(a,l){this.scrolled=this.scrollEl.scrollTop-this.scrollY,this.temporalRect=this._getChange(a,l),this._applyChange();const u=t.Utils.initEvent(a,{type:"resize",target:this.el});return this.option.resize&&this.option.resize(u,this._ui()),this.triggerEvent("resize",u),this}_resizeStop(a){const l=t.Utils.initEvent(a,{type:"resizestop",target:this.el});return this.option.stop&&this.option.stop(l),this.el.classList.remove("ui-resizable-resizing"),this.triggerEvent("resizestop",l),this._cleanHelper(),delete this.startEvent,delete this.originalRect,delete this.temporalRect,delete this.scrollY,delete this.scrolled,this}_setupHelper(){return this.elOriginStyleVal=s._originStyleProp.map(a=>this.el.style[a]),this.parentOriginStylePosition=this.el.parentElement.style.position,window.getComputedStyle(this.el.parentElement).position.match(/static/)&&(this.el.parentElement.style.position="relative"),this.el.style.position="absolute",this.el.style.opacity="0.8",this}_cleanHelper(){return s._originStyleProp.forEach((a,l)=>{this.el.style[a]=this.elOriginStyleVal[l]||null}),this.el.parentElement.style.position=this.parentOriginStylePosition||null,this}_getChange(a,l){const u=this.startEvent,p={width:this.originalRect.width,height:this.originalRect.height+this.scrolled,left:this.originalRect.left,top:this.originalRect.top-this.scrolled},d=a.clientX-u.clientX,m=a.clientY-u.clientY;l.indexOf("e")>-1?p.width+=d:l.indexOf("w")>-1&&(p.width-=d,p.left+=d),l.indexOf("s")>-1?p.height+=m:l.indexOf("n")>-1&&(p.height-=m,p.top+=m);const g=this._constrainSize(p.width,p.height);return Math.round(p.width)!==Math.round(g.width)&&(l.indexOf("w")>-1&&(p.left+=p.width-g.width),p.width=g.width),Math.round(p.height)!==Math.round(g.height)&&(l.indexOf("n")>-1&&(p.top+=p.height-g.height),p.height=g.height),p}_constrainSize(a,l){const u=this.option.maxWidth||Number.MAX_SAFE_INTEGER,p=this.option.minWidth||a,d=this.option.maxHeight||Number.MAX_SAFE_INTEGER,m=this.option.minHeight||l,g=Math.min(u,Math.max(p,a)),w=Math.min(d,Math.max(m,l));return{width:g,height:w}}_applyChange(){let a={left:0,top:0,width:0,height:0};if(this.el.style.position==="absolute"){const l=this.el.parentElement,{left:u,top:p}=l.getBoundingClientRect();a={left:u,top:p,width:0,height:0}}return this.temporalRect?(Object.keys(this.temporalRect).forEach(l=>{const u=this.temporalRect[l];this.el.style[l]=u-a[l]+"px"}),this):this}_removeHandlers(){return this.handlers.forEach(a=>a.destroy()),delete this.handlers,this}}return ddResizable.DDResizable=s,s._originStyleProp=["width","height","position","left","top","opacity","zIndex"],ddResizable}var ddDraggable={},hasRequiredDdDraggable;function requireDdDraggable(){if(hasRequiredDdDraggable)return ddDraggable;hasRequiredDdDraggable=1,Object.defineProperty(ddDraggable,"__esModule",{value:!0}),ddDraggable.DDDraggable=void 0;const i=requireDdManager(),e=utils,t=requireDdBaseImpl(),r=requireDdTouch();class s extends t.DDBaseImplement{constructor(a,l={}){super(),this.el=a,this.option=l;let u=l.handle.substring(1);this.dragEl=a.classList.contains(u)?a:a.querySelector(l.handle)||a,this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this),this.enable()}on(a,l){super.on(a,l)}off(a){super.off(a)}enable(){this.disabled!==!1&&(super.enable(),this.dragEl.addEventListener("mousedown",this._mouseDown),r.isTouch&&(this.dragEl.addEventListener("touchstart",r.touchstart),this.dragEl.addEventListener("pointerdown",r.pointerdown)),this.el.classList.remove("ui-draggable-disabled"),this.el.classList.add("ui-draggable"))}disable(a=!1){this.disabled!==!0&&(super.disable(),this.dragEl.removeEventListener("mousedown",this._mouseDown),r.isTouch&&(this.dragEl.removeEventListener("touchstart",r.touchstart),this.dragEl.removeEventListener("pointerdown",r.pointerdown)),this.el.classList.remove("ui-draggable"),a||this.el.classList.add("ui-draggable-disabled"))}destroy(){this.dragTimeout&&window.clearTimeout(this.dragTimeout),delete this.dragTimeout,this.dragging&&this._mouseUp(this.mouseDownEvent),this.disable(!0),delete this.el,delete this.helper,delete this.option,super.destroy()}updateOption(a){return Object.keys(a).forEach(l=>this.option[l]=a[l]),this}_mouseDown(a){if(i.DDManager.mouseHandled)return;if(a.button!==0)return!0;const l=["input","textarea","button","select","option"],u=a.target.nodeName.toLowerCase();return l.find(p=>p===u)||a.target.closest('[contenteditable="true"]')||(this.mouseDownEvent=a,delete this.dragging,delete i.DDManager.dragElement,delete i.DDManager.dropElement,document.addEventListener("mousemove",this._mouseMove,!0),document.addEventListener("mouseup",this._mouseUp,!0),r.isTouch&&(this.dragEl.addEventListener("touchmove",r.touchmove),this.dragEl.addEventListener("touchend",r.touchend)),a.preventDefault(),document.activeElement&&document.activeElement.blur(),i.DDManager.mouseHandled=!0),!0}_callDrag(a){if(!this.dragging)return;const l=e.Utils.initEvent(a,{target:this.el,type:"drag"});this.option.drag&&this.option.drag(l,this.ui()),this.triggerEvent("drag",l)}_mouseMove(a){var l;let u=this.mouseDownEvent;if(this.dragging)if(this._dragFollow(a),i.DDManager.pauseDrag){const p=Number.isInteger(i.DDManager.pauseDrag)?i.DDManager.pauseDrag:100;this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>this._callDrag(a),p)}else this._callDrag(a);else if(Math.abs(a.x-u.x)+Math.abs(a.y-u.y)>3){this.dragging=!0,i.DDManager.dragElement=this;let p=(l=this.el.gridstackNode)===null||l===void 0?void 0:l.grid;p?i.DDManager.dropElement=p.el.ddElement.ddDroppable:delete i.DDManager.dropElement,this.helper=this._createHelper(a),this._setupHelperContainmentStyle(),this.dragOffset=this._getDragOffset(a,this.el,this.helperContainment);const d=e.Utils.initEvent(a,{target:this.el,type:"dragstart"});this._setupHelperStyle(a),this.option.start&&this.option.start(d,this.ui()),this.triggerEvent("dragstart",d)}return a.preventDefault(),!0}_mouseUp(a){var l;if(document.removeEventListener("mousemove",this._mouseMove,!0),document.removeEventListener("mouseup",this._mouseUp,!0),r.isTouch&&(this.dragEl.removeEventListener("touchmove",r.touchmove,!0),this.dragEl.removeEventListener("touchend",r.touchend,!0)),this.dragging){delete this.dragging,((l=i.DDManager.dropElement)===null||l===void 0?void 0:l.el)===this.el.parentElement&&delete i.DDManager.dropElement,this.helperContainment.style.position=this.parentOriginStylePosition||null,this.helper===this.el?this._removeHelperStyle():this.helper.remove();const u=e.Utils.initEvent(a,{target:this.el,type:"dragstop"});this.option.stop&&this.option.stop(u),this.triggerEvent("dragstop",u),i.DDManager.dropElement&&i.DDManager.dropElement.drop(a)}delete this.helper,delete this.mouseDownEvent,delete i.DDManager.dragElement,delete i.DDManager.dropElement,delete i.DDManager.mouseHandled,a.preventDefault()}_createHelper(a){let l=this.el;return typeof this.option.helper=="function"?l=this.option.helper(a):this.option.helper==="clone"&&(l=e.Utils.cloneNode(this.el)),document.body.contains(l)||e.Utils.appendTo(l,this.option.appendTo==="parent"?this.el.parentNode:this.option.appendTo),l===this.el&&(this.dragElementOriginStyle=s.originStyleProp.map(u=>this.el.style[u])),l}_setupHelperStyle(a){this.helper.classList.add("ui-draggable-dragging");const l=this.helper.style;return l.pointerEvents="none",l["min-width"]=0,l.width=this.dragOffset.width+"px",l.height=this.dragOffset.height+"px",l.willChange="left, top",l.position="fixed",this._dragFollow(a),l.transition="none",setTimeout(()=>{this.helper&&(l.transition=null)},0),this}_removeHelperStyle(){var a;this.helper.classList.remove("ui-draggable-dragging");let l=(a=this.helper)===null||a===void 0?void 0:a.gridstackNode;if(this.dragElementOriginStyle&&(!l||!l._isAboutToRemove)){let u=this.helper,p=this.dragElementOriginStyle.transition||null;u.style.transition=this.dragElementOriginStyle.transition="none",s.originStyleProp.forEach(d=>u.style[d]=this.dragElementOriginStyle[d]||null),setTimeout(()=>u.style.transition=p,50)}return delete this.dragElementOriginStyle,this}_dragFollow(a){let l={left:0,top:0};const u=this.helper.style,p=this.dragOffset;u.left=a.clientX+p.offsetLeft-l.left+"px",u.top=a.clientY+p.offsetTop-l.top+"px"}_setupHelperContainmentStyle(){return this.helperContainment=this.helper.parentElement,this.helper.style.position!=="fixed"&&(this.parentOriginStylePosition=this.helperContainment.style.position,window.getComputedStyle(this.helperContainment).position.match(/static/)&&(this.helperContainment.style.position="relative")),this}_getDragOffset(a,l,u){let p=0,d=0;if(u){const g=document.createElement("div");e.Utils.addElStyles(g,{opacity:"0",position:"fixed",top:"0px",left:"0px",width:"1px",height:"1px",zIndex:"-999999"}),u.appendChild(g);const w=g.getBoundingClientRect();u.removeChild(g),p=w.left,d=w.top}const m=l.getBoundingClientRect();return{left:m.left,top:m.top,offsetLeft:-a.clientX+m.left-p,offsetTop:-a.clientY+m.top-d,width:m.width,height:m.height}}ui(){const l=this.el.parentElement.getBoundingClientRect(),u=this.helper.getBoundingClientRect();return{position:{top:u.top-l.top,left:u.left-l.left}}}}return ddDraggable.DDDraggable=s,s.originStyleProp=["transition","pointerEvents","position","left","top"],ddDraggable}var ddDroppable={},hasRequiredDdDroppable;function requireDdDroppable(){if(hasRequiredDdDroppable)return ddDroppable;hasRequiredDdDroppable=1,Object.defineProperty(ddDroppable,"__esModule",{value:!0}),ddDroppable.DDDroppable=void 0;const i=requireDdManager(),e=requireDdBaseImpl(),t=utils,r=requireDdTouch();class s extends e.DDBaseImplement{constructor(a,l={}){super(),this.el=a,this.option=l,this._mouseEnter=this._mouseEnter.bind(this),this._mouseLeave=this._mouseLeave.bind(this),this.enable(),this._setupAccept()}on(a,l){super.on(a,l)}off(a){super.off(a)}enable(){this.disabled!==!1&&(super.enable(),this.el.classList.add("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),this.el.addEventListener("mouseenter",this._mouseEnter),this.el.addEventListener("mouseleave",this._mouseLeave),r.isTouch&&(this.el.addEventListener("pointerenter",r.pointerenter),this.el.addEventListener("pointerleave",r.pointerleave)))}disable(a=!1){this.disabled!==!0&&(super.disable(),this.el.classList.remove("ui-droppable"),a||this.el.classList.add("ui-droppable-disabled"),this.el.removeEventListener("mouseenter",this._mouseEnter),this.el.removeEventListener("mouseleave",this._mouseLeave),r.isTouch&&(this.el.removeEventListener("pointerenter",r.pointerenter),this.el.removeEventListener("pointerleave",r.pointerleave)))}destroy(){this.disable(!0),this.el.classList.remove("ui-droppable"),this.el.classList.remove("ui-droppable-disabled"),super.destroy()}updateOption(a){return Object.keys(a).forEach(l=>this.option[l]=a[l]),this._setupAccept(),this}_mouseEnter(a){if(!i.DDManager.dragElement||!this._canDrop(i.DDManager.dragElement.el))return;a.preventDefault(),a.stopPropagation(),i.DDManager.dropElement&&i.DDManager.dropElement!==this&&i.DDManager.dropElement._mouseLeave(a),i.DDManager.dropElement=this;const l=t.Utils.initEvent(a,{target:this.el,type:"dropover"});this.option.over&&this.option.over(l,this._ui(i.DDManager.dragElement)),this.triggerEvent("dropover",l),this.el.classList.add("ui-droppable-over")}_mouseLeave(a){var l;if(!i.DDManager.dragElement||i.DDManager.dropElement!==this)return;a.preventDefault(),a.stopPropagation();const u=t.Utils.initEvent(a,{target:this.el,type:"dropout"});if(this.option.out&&this.option.out(u,this._ui(i.DDManager.dragElement)),this.triggerEvent("dropout",u),i.DDManager.dropElement===this){delete i.DDManager.dropElement;let p,d=this.el.parentElement;for(;!p&&d;)p=(l=d.ddElement)===null||l===void 0?void 0:l.ddDroppable,d=d.parentElement;p&&p._mouseEnter(a)}}drop(a){a.preventDefault();const l=t.Utils.initEvent(a,{target:this.el,type:"drop"});this.option.drop&&this.option.drop(l,this._ui(i.DDManager.dragElement)),this.triggerEvent("drop",l)}_canDrop(a){return a&&(!this.accept||this.accept(a))}_setupAccept(){return this.option.accept?(typeof this.option.accept=="string"?this.accept=a=>a.matches(this.option.accept):this.accept=this.option.accept,this):this}_ui(a){return Object.assign({draggable:a.el},a.ui())}}return ddDroppable.DDDroppable=s,ddDroppable}var hasRequiredDdElement;function requireDdElement(){if(hasRequiredDdElement)return ddElement;hasRequiredDdElement=1,Object.defineProperty(ddElement,"__esModule",{value:!0}),ddElement.DDElement=void 0;const i=requireDdResizable(),e=requireDdDraggable(),t=requireDdDroppable();class r{constructor(o){this.el=o}static init(o){return o.ddElement||(o.ddElement=new r(o)),o.ddElement}on(o,a){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(o)>-1?this.ddDraggable.on(o,a):this.ddDroppable&&["drop","dropover","dropout"].indexOf(o)>-1?this.ddDroppable.on(o,a):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(o)>-1&&this.ddResizable.on(o,a),this}off(o){return this.ddDraggable&&["drag","dragstart","dragstop"].indexOf(o)>-1?this.ddDraggable.off(o):this.ddDroppable&&["drop","dropover","dropout"].indexOf(o)>-1?this.ddDroppable.off(o):this.ddResizable&&["resizestart","resize","resizestop"].indexOf(o)>-1&&this.ddResizable.off(o),this}setupDraggable(o){return this.ddDraggable?this.ddDraggable.updateOption(o):this.ddDraggable=new e.DDDraggable(this.el,o),this}cleanDraggable(){return this.ddDraggable&&(this.ddDraggable.destroy(),delete this.ddDraggable),this}setupResizable(o){return this.ddResizable?this.ddResizable.updateOption(o):this.ddResizable=new i.DDResizable(this.el,o),this}cleanResizable(){return this.ddResizable&&(this.ddResizable.destroy(),delete this.ddResizable),this}setupDroppable(o){return this.ddDroppable?this.ddDroppable.updateOption(o):this.ddDroppable=new t.DDDroppable(this.el,o),this}cleanDroppable(){return this.ddDroppable&&(this.ddDroppable.destroy(),delete this.ddDroppable),this}}return ddElement.DDElement=r,ddElement}var hasRequiredDdGridstack;function requireDdGridstack(){if(hasRequiredDdGridstack)return ddGridstack;hasRequiredDdGridstack=1,Object.defineProperty(ddGridstack,"__esModule",{value:!0}),ddGridstack.DDGridStack=void 0;const i=types,e=requireGridstack(),t=utils,r=requireDdManager(),s=requireDdElement();class o{static get(){return a}resizable(p,d,m,g){return this._getDDElements(p).forEach(w=>{if(d==="disable"||d==="enable")w.ddResizable&&w.ddResizable[d]();else if(d==="destroy")w.ddResizable&&w.cleanResizable();else if(d==="option")w.setupResizable({[m]:g});else{const E=w.el.gridstackNode.grid;let A=w.el.getAttribute("gs-resize-handles")?w.el.getAttribute("gs-resize-handles"):E.opts.resizable.handles,k=!E.opts.alwaysShowResizeHandle;w.setupResizable(Object.assign(Object.assign(Object.assign({},E.opts.resizable),{handles:A,autoHide:k}),{start:d.start,stop:d.stop,resize:d.resize}))}}),this}draggable(p,d,m,g){return this._getDDElements(p).forEach(w=>{if(d==="disable"||d==="enable")w.ddDraggable&&w.ddDraggable[d]();else if(d==="destroy")w.ddDraggable&&w.cleanDraggable();else if(d==="option")w.setupDraggable({[m]:g});else{const E=w.el.gridstackNode.grid;w.setupDraggable(Object.assign(Object.assign({},E.opts.draggable),{start:d.start,stop:d.stop,drag:d.drag}))}}),this}dragIn(p,d){return this._getDDElements(p).forEach(m=>m.setupDraggable(d)),this}droppable(p,d,m,g){return typeof d.accept=="function"&&!d._accept&&(d._accept=d.accept,d.accept=w=>d._accept(w)),this._getDDElements(p).forEach(w=>{d==="disable"||d==="enable"?w.ddDroppable&&w.ddDroppable[d]():d==="destroy"?w.ddDroppable&&w.cleanDroppable():d==="option"?w.setupDroppable({[m]:g}):w.setupDroppable(d)}),this}isDroppable(p){return!!(p&&p.ddElement&&p.ddElement.ddDroppable&&!p.ddElement.ddDroppable.disabled)}isDraggable(p){return!!(p&&p.ddElement&&p.ddElement.ddDraggable&&!p.ddElement.ddDraggable.disabled)}isResizable(p){return!!(p&&p.ddElement&&p.ddElement.ddResizable&&!p.ddElement.ddResizable.disabled)}on(p,d,m){return this._getDDElements(p).forEach(g=>g.on(d,w=>{m(w,r.DDManager.dragElement?r.DDManager.dragElement.el:w.target,r.DDManager.dragElement?r.DDManager.dragElement.helper:null)})),this}off(p,d){return this._getDDElements(p).forEach(m=>m.off(d)),this}_getDDElements(p,d=!0){let m=t.Utils.getElements(p);if(!m.length)return[];let g=m.map(w=>w.ddElement||(d?s.DDElement.init(w):null));return d||g.filter(w=>w),g}}ddGridstack.DDGridStack=o;const a=new o;e.GridStack.prototype._setupAcceptWidget=function(){if(this.opts.staticGrid||!this.opts.acceptWidgets&&!this.opts.removable)return a.droppable(this.el,"destroy"),this;let u,p,d=(m,g,w)=>{let E=g.gridstackNode;if(!E)return;w=w||g;let A=this.el.getBoundingClientRect(),{top:k,left:O}=w.getBoundingClientRect();O-=A.left,k-=A.top;let ne={position:{top:k,left:O}};if(E._temporaryRemoved){if(E.x=Math.max(0,Math.round(O/p)),E.y=Math.max(0,Math.round(k/u)),delete E.autoPosition,this.engine.nodeBoundFix(E),!this.engine.willItFit(E)){if(E.autoPosition=!0,!this.engine.willItFit(E)){a.off(g,"drag");return}E._willFitPos&&(t.Utils.copyPos(E,E._willFitPos),delete E._willFitPos)}this._onStartMoving(w,m,ne,E,p,u)}else this._dragOrResize(w,m,ne,E,p,u)};return a.droppable(this.el,{accept:m=>{let g=m.gridstackNode;if((g==null?void 0:g.grid)===this)return!0;if(!this.opts.acceptWidgets)return!1;let w=!0;if(typeof this.opts.acceptWidgets=="function")w=this.opts.acceptWidgets(m);else{let E=this.opts.acceptWidgets===!0?".grid-stack-item":this.opts.acceptWidgets;w=m.matches(E)}if(w&&g&&this.opts.maxRow){let E={w:g.w,h:g.h,minW:g.minW,minH:g.minH};w=this.engine.willItFit(E)}return w}}).on(this.el,"dropover",(m,g,w)=>{let E=g.gridstackNode;if((E==null?void 0:E.grid)===this&&!E._temporaryRemoved)return!1;E!=null&&E.grid&&E.grid!==this&&!E._temporaryRemoved&&E.grid._leave(g,w),p=this.cellWidth(),u=this.getCellHeight(!0),E||(E=this._readAttr(g)),E.grid||(E._isExternal=!0,g.gridstackNode=E),w=w||g;let A=E.w||Math.round(w.offsetWidth/p)||1,k=E.h||Math.round(w.offsetHeight/u)||1;return E.grid&&E.grid!==this?(g._gridstackNodeOrig||(g._gridstackNodeOrig=E),g.gridstackNode=E=Object.assign(Object.assign({},E),{w:A,h:k,grid:this}),this.engine.cleanupNode(E).nodeBoundFix(E),E._initDD=E._isExternal=E._temporaryRemoved=!0):(E.w=A,E.h=k,E._temporaryRemoved=!0),l(E.el,!1),a.on(g,"drag",d),d(m,g,w),!1}).on(this.el,"dropout",(m,g,w)=>{let E=g.gridstackNode;return E&&(!E.grid||E.grid===this)&&(this._leave(g,w),this._isTemp&&this.removeAsSubGrid(E)),!1}).on(this.el,"drop",(m,g,w)=>{var E,A;let k=g.gridstackNode;if((k==null?void 0:k.grid)===this&&!k._isExternal)return!1;let O=!!this.placeholder.parentElement;this.placeholder.remove();let ne=g._gridstackNodeOrig;if(delete g._gridstackNodeOrig,O&&(ne!=null&&ne.grid)&&ne.grid!==this){let ue=ne.grid;ue.engine.removedNodes.push(ne),ue._triggerRemoveEvent(),ue.parentGridItem&&!ue.engine.nodes.length&&ue.opts.subGridDynamic&&ue.removeAsSubGrid()}if(!k||(O&&(this.engine.cleanupNode(k),k.grid=this),a.off(g,"drag"),w!==g?(w.remove(),g.gridstackNode=ne,O&&(g=g.cloneNode(!0))):(g.remove(),this._removeDD(g)),!O))return!1;g.gridstackNode=k,k.el=g;let Q=(A=(E=k.subGrid)===null||E===void 0?void 0:E.el)===null||A===void 0?void 0:A.gridstack;return t.Utils.copyPos(k,this._readAttr(this.placeholder)),t.Utils.removePositioningStyles(g),this._writeAttr(g,k),this.el.appendChild(g),Q&&(Q.parentGridItem=k,Q.opts.styleInHead||Q._updateStyles(!0)),this._updateContainerHeight(),this.engine.addedNodes.push(k),this._triggerAddEvent(),this._triggerChangeEvent(),this.engine.endUpdate(),this._gsEventHandler.dropped&&this._gsEventHandler.dropped(Object.assign(Object.assign({},m),{type:"dropped"}),ne&&ne.grid?ne:void 0,k),window.setTimeout(()=>{k.el&&k.el.parentElement?this._prepareDragDropByNode(k):this.engine.removeNode(k),delete k.grid._isTemp}),!1}),this};function l(u,p){let d=u?u.gridstackNode:void 0;!d||!d.grid||(p?d._isAboutToRemove=!0:delete d._isAboutToRemove,p?u.classList.add("grid-stack-item-removing"):u.classList.remove("grid-stack-item-removing"))}return e.GridStack.prototype._setupRemoveDrop=function(){if(!this.opts.staticGrid&&typeof this.opts.removable=="string"){let u=document.querySelector(this.opts.removable);if(!u)return this;a.isDroppable(u)||a.droppable(u,this.opts.removableOptions).on(u,"dropover",(p,d)=>l(d,!0)).on(u,"dropout",(p,d)=>l(d,!1))}return this},e.GridStack.setupDragIn=function(u,p){(p==null?void 0:p.pause)!==void 0&&(r.DDManager.pauseDrag=p.pause),typeof u=="string"&&(p=Object.assign(Object.assign({},i.dragInDefaultOptions),p||{}),t.Utils.getElements(u).forEach(d=>{a.isDraggable(d)||a.dragIn(d,p)}))},e.GridStack.prototype._prepareDragDropByNode=function(u){let p=u.el;const d=u.noMove||this.opts.disableDrag,m=u.noResize||this.opts.disableResize;if(this.opts.staticGrid||d&&m)return u._initDD&&(this._removeDD(p),delete u._initDD),p.classList.add("ui-draggable-disabled","ui-resizable-disabled"),this;if(!u._initDD){let g,w,E=(O,ne)=>{this._gsEventHandler[O.type]&&this._gsEventHandler[O.type](O,O.target),g=this.cellWidth(),w=this.getCellHeight(!0),this._onStartMoving(p,O,ne,u,g,w)},A=(O,ne)=>{this._dragOrResize(p,O,ne,u,g,w)},k=O=>{this.placeholder.remove(),delete u._moving,delete u._event,delete u._lastTried;let ne=O.target;if(!(!ne.gridstackNode||ne.gridstackNode.grid!==this)){if(u.el=ne,u._isAboutToRemove){let Q=p.gridstackNode.grid;Q._gsEventHandler[O.type]&&Q._gsEventHandler[O.type](O,ne),this._removeDD(p),Q.engine.removedNodes.push(u),Q._triggerRemoveEvent(),delete p.gridstackNode,delete u.el,p.remove()}else t.Utils.removePositioningStyles(ne),u._temporaryRemoved?(t.Utils.copyPos(u,u._orig),this._writePosAttr(ne,u),this.engine.addNode(u)):this._writePosAttr(ne,u),this._gsEventHandler[O.type]&&this._gsEventHandler[O.type](O,ne);this._extraDragRow=0,this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()}};a.draggable(p,{start:E,stop:k,drag:A}).resizable(p,{start:E,stop:k,resize:A}),u._initDD=!0}return a.draggable(p,d?"disable":"enable").resizable(p,m?"disable":"enable"),this},e.GridStack.prototype._onStartMoving=function(u,p,d,m,g,w){this.engine.cleanNodes().beginUpdate(m),this._writePosAttr(this.placeholder,m),this.el.appendChild(this.placeholder),m.el=this.placeholder,m._lastUiPosition=d.position,m._prevYPix=d.position.top,m._moving=p.type==="dragstart",delete m._lastTried,p.type==="dropover"&&m._temporaryRemoved&&(this.engine.addNode(m),m._moving=!0),this.engine.cacheRects(g,w,this.opts.marginTop,this.opts.marginRight,this.opts.marginBottom,this.opts.marginLeft),p.type==="resizestart"&&(a.resizable(u,"option","minWidth",g*(m.minW||1)).resizable(u,"option","minHeight",w*(m.minH||1)),m.maxW&&a.resizable(u,"option","maxWidth",g*m.maxW),m.maxH&&a.resizable(u,"option","maxHeight",w*m.maxH))},e.GridStack.prototype._leave=function(u,p){let d=u.gridstackNode;d&&(a.off(u,"drag"),!d._temporaryRemoved&&(d._temporaryRemoved=!0,this.engine.removeNode(d),d.el=d._isExternal&&p?p:u,this.opts.removable===!0&&l(u,!0),u._gridstackNodeOrig?(u.gridstackNode=u._gridstackNodeOrig,delete u._gridstackNodeOrig):d._isExternal&&(delete d.el,delete u.gridstackNode,this.engine.restoreInitial())))},e.GridStack.prototype._dragOrResize=function(u,p,d,m,g,w){let E=Object.assign({},m._orig),A,k=this.opts.marginLeft,O=this.opts.marginRight,ne=this.opts.marginTop,Q=this.opts.marginBottom,ue=Math.round(w*.1),U=Math.round(g*.1);if(k=Math.min(k,U),O=Math.min(O,U),ne=Math.min(ne,ue),Q=Math.min(Q,ue),p.type==="drag"){if(m._temporaryRemoved)return;let Se=d.position.top-m._prevYPix;m._prevYPix=d.position.top,t.Utils.updateScrollPosition(u,d.position,Se);let Me=d.position.left+(d.position.left>m._lastUiPosition.left?-O:k),Ke=d.position.top+(d.position.top>m._lastUiPosition.top?-Q:ne);E.x=Math.round(Me/g),E.y=Math.round(Ke/w);let kt=this._extraDragRow;if(this.engine.collide(m,E)){let Qe=this.getRow(),ze=Math.max(0,E.y+m.h-Qe);this.opts.maxRow&&Qe+ze>this.opts.maxRow&&(ze=Math.max(0,this.opts.maxRow-Qe)),this._extraDragRow=ze}else this._extraDragRow=0;if(this._extraDragRow!==kt&&this._updateContainerHeight(),m.x===E.x&&m.y===E.y)return}else if(p.type==="resize"){if(E.x<0||(t.Utils.updateScrollResize(p,u,w),E.w=Math.round((d.size.width-k)/g),E.h=Math.round((d.size.height-ne)/w),m.w===E.w&&m.h===E.h)||m._lastTried&&m._lastTried.w===E.w&&m._lastTried.h===E.h)return;let Se=d.position.left+k,Me=d.position.top+ne;E.x=Math.round(Se/g),E.y=Math.round(Me/w),A=!0}m._event=p,m._lastTried=E;let _={x:d.position.left+k,y:d.position.top+ne,w:(d.size?d.size.width:m.w*g)-k-O,h:(d.size?d.size.height:m.h*w)-ne-Q};if(this.engine.moveNodeCheck(m,Object.assign(Object.assign({},E),{cellWidth:g,cellHeight:w,rect:_,resizing:A}))){m._lastUiPosition=d.position,this.engine.cacheRects(g,w,ne,O,Q,k),delete m._skipDown,A&&m.subGrid&&m.subGrid.onParentResize(),this._extraDragRow=0,this._updateContainerHeight();let Se=p.target;this._writePosAttr(Se,m),this._gsEventHandler[p.type]&&this._gsEventHandler[p.type](p,Se)}},e.GridStack.prototype.movable=function(u,p){return this.opts.staticGrid?this:(e.GridStack.getElements(u).forEach(d=>{let m=d.gridstackNode;m&&(p?delete m.noMove:m.noMove=!0,this._prepareDragDropByNode(m))}),this)},e.GridStack.prototype.resizable=function(u,p){return this.opts.staticGrid?this:(e.GridStack.getElements(u).forEach(d=>{let m=d.gridstackNode;m&&(p?delete m.noResize:m.noResize=!0,this._prepareDragDropByNode(m))}),this)},e.GridStack.prototype.disable=function(){if(!this.opts.staticGrid)return this.enableMove(!1),this.enableResize(!1),this._triggerEvent("disable"),this},e.GridStack.prototype.enable=function(){if(!this.opts.staticGrid)return this.enableMove(!0),this.enableResize(!0),this._triggerEvent("enable"),this},e.GridStack.prototype.enableMove=function(u){return this.opts.staticGrid?this:(this.opts.disableDrag=!u,this.engine.nodes.forEach(p=>this.movable(p.el,u)),this)},e.GridStack.prototype.enableResize=function(u){return this.opts.staticGrid?this:(this.opts.disableResize=!u,this.engine.nodes.forEach(p=>this.resizable(p.el,u)),this)},e.GridStack.prototype._removeDD=function(u){return a.draggable(u,"destroy").resizable(u,"destroy"),u.gridstackNode&&delete u.gridstackNode._initDD,delete u.ddElement,this},ddGridstack}var hasRequiredGridstack;function requireGridstack(){return hasRequiredGridstack||(hasRequiredGridstack=1,function(i){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(p,d,m,g){g===void 0&&(g=m),Object.defineProperty(p,g,{enumerable:!0,get:function(){return d[m]}})}:function(p,d,m,g){g===void 0&&(g=m),p[g]=d[m]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(p,d){for(var m in p)m!=="default"&&!d.hasOwnProperty(m)&&e(d,p,m)};Object.defineProperty(i,"__esModule",{value:!0}),i.GridStack=void 0;/*!
 * GridStack 7.1.1
 * https://gridstackjs.com/
 *
 * Copyright (c) 2021-2022 Alain Dumesny
 * see root license https://github.com/gridstack/gridstack.js/tree/master/LICENSE
 */const r=gridstackEngine,s=utils,o=types;t(types,i),t(utils,i),t(gridstackEngine,i);class a{constructor(d,m={}){var g,w;this._gsEventHandler={},this._extraDragRow=0,this.el=d,m=m||{},m.row&&(m.minRow=m.maxRow=m.row,delete m.row);let E=s.Utils.toNumber(d.getAttribute("gs-row"));m.column==="auto"&&delete m.column;let A=m;A.minWidth!==void 0&&(m.oneColumnSize=m.oneColumnSize||A.minWidth,delete A.minWidth),m.alwaysShowResizeHandle!==void 0&&(m._alwaysShowResizeHandle=m.alwaysShowResizeHandle);let k=Object.assign(Object.assign({},s.Utils.cloneDeep(o.gridDefaults)),{column:s.Utils.toNumber(d.getAttribute("gs-column"))||o.gridDefaults.column,minRow:E||s.Utils.toNumber(d.getAttribute("gs-min-row"))||o.gridDefaults.minRow,maxRow:E||s.Utils.toNumber(d.getAttribute("gs-max-row"))||o.gridDefaults.maxRow,staticGrid:s.Utils.toBool(d.getAttribute("gs-static"))||o.gridDefaults.staticGrid,draggable:{handle:(m.handleClass?"."+m.handleClass:m.handle?m.handle:"")||o.gridDefaults.draggable.handle},removableOptions:{accept:m.itemClass?"."+m.itemClass:o.gridDefaults.removableOptions.accept}});d.getAttribute("gs-animate")&&(k.animate=s.Utils.toBool(d.getAttribute("gs-animate"))),this.opts=s.Utils.defaults(m,k),m=null,this._initMargin(),this.opts.column!==1&&!this.opts.disableOneColumnMode&&this._widthOrContainer()<=this.opts.oneColumnSize&&(this._prevColumn=this.getColumn(),this.opts.column=1),this.opts.rtl==="auto"&&(this.opts.rtl=d.style.direction==="rtl"),this.opts.rtl&&this.el.classList.add("grid-stack-rtl");let O=(g=s.Utils.closestUpByClass(this.el,o.gridDefaults.itemClass))===null||g===void 0?void 0:g.gridstackNode;O&&(O.subGrid=this,this.parentGridItem=O,this.el.classList.add("grid-stack-nested"),O.el.classList.add("grid-stack-sub-grid")),this._isAutoCellHeight=this.opts.cellHeight==="auto",this._isAutoCellHeight||this.opts.cellHeight==="initial"?this.cellHeight(void 0,!1):(typeof this.opts.cellHeight=="number"&&this.opts.cellHeightUnit&&this.opts.cellHeightUnit!==o.gridDefaults.cellHeightUnit&&(this.opts.cellHeight=this.opts.cellHeight+this.opts.cellHeightUnit,delete this.opts.cellHeightUnit),this.cellHeight(this.opts.cellHeight,!1)),this.opts.alwaysShowResizeHandle==="mobile"&&(this.opts.alwaysShowResizeHandle=l.isTouch),this._styleSheetClass="grid-stack-instance-"+r.GridStackEngine._idSeq++,this.el.classList.add(this._styleSheetClass),this._setStaticClass();let ne=this.opts.engineClass||a.engineClass||r.GridStackEngine;if(this.engine=new ne({column:this.getColumn(),float:this.opts.float,maxRow:this.opts.maxRow,onChange:Q=>{let ue=0;this.engine.nodes.forEach(U=>{ue=Math.max(ue,U.y+U.h)}),Q.forEach(U=>{let _=U.el;_&&(U._removeDOM?(_&&_.remove(),delete U._removeDOM):this._writePosAttr(_,U))}),this._updateStyles(!1,ue)}}),this.opts.auto){this.batchUpdate();let Q=[],ue=this.getColumn();ue===1&&this._prevColumn&&(ue=this._prevColumn),this.getGridItems().forEach(U=>{let _=parseInt(U.getAttribute("gs-x")),Se=parseInt(U.getAttribute("gs-y"));Q.push({el:U,i:(Number.isNaN(_)?1e3:_)+(Number.isNaN(Se)?1e3:Se)*ue})}),Q.sort((U,_)=>_.i-U.i).forEach(U=>this._prepareElement(U.el)),this.batchUpdate(!1)}this.setAnimation(this.opts.animate),this._updateStyles(),this.opts.column!=12&&this.el.classList.add("grid-stack-"+this.opts.column),this.opts.dragIn&&a.setupDragIn(this.opts.dragIn,this.opts.dragInOptions),delete this.opts.dragIn,delete this.opts.dragInOptions,this.opts.subGridDynamic&&!u.DDManager.pauseDrag&&(u.DDManager.pauseDrag=!0),((w=this.opts.draggable)===null||w===void 0?void 0:w.pause)!==void 0&&(u.DDManager.pauseDrag=this.opts.draggable.pause),this._setupRemoveDrop(),this._setupAcceptWidget(),this._updateWindowResizeEvent()}static init(d={},m=".grid-stack"){let g=a.getGridElement(m);return g?(g.gridstack||(g.gridstack=new a(g,s.Utils.cloneDeep(d))),g.gridstack):(console.error(typeof m=="string"?'GridStack.initAll() no grid was found with selector "'+m+`" - element missing or wrong selector ?
Note: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.`:"GridStack.init() no grid element was passed."),null)}static initAll(d={},m=".grid-stack"){let g=[];return a.getGridElements(m).forEach(w=>{w.gridstack||(w.gridstack=new a(w,s.Utils.cloneDeep(d)),delete d.dragIn,delete d.dragInOptions),g.push(w.gridstack)}),g.length===0&&console.error('GridStack.initAll() no grid was found with selector "'+m+`" - element missing or wrong selector ?
Note: ".grid-stack" is required for proper CSS styling and drag/drop, and is the default selector.`),g}static addGrid(d,m={}){if(!d)return null;let g=d;if(!d.classList.contains("grid-stack")){let E=document.implementation.createHTMLDocument("");E.body.innerHTML=`<div class="grid-stack ${m.class||""}"></div>`,g=E.body.children[0],d.appendChild(g)}let w=a.init(m,g);if(w.opts.children){let E=w.opts.children;delete w.opts.children,w.load(E)}return w}static registerEngine(d){a.engineClass=d}get placeholder(){if(!this._placeholder){let d=document.createElement("div");d.className="placeholder-content",this.opts.placeholderText&&(d.innerHTML=this.opts.placeholderText),this._placeholder=document.createElement("div"),this._placeholder.classList.add(this.opts.placeholderClass,o.gridDefaults.itemClass,this.opts.itemClass),this.placeholder.appendChild(d)}return this._placeholder}addWidget(d,m){function g(k){return k.x!==void 0||k.y!==void 0||k.w!==void 0||k.h!==void 0||k.content!==void 0}let w;if(typeof d=="string"){let k=document.implementation.createHTMLDocument("");k.body.innerHTML=d,w=k.body.children[0]}else if(arguments.length===0||arguments.length===1&&g(d)){let k=d&&d.content||"";m=d;let O=document.implementation.createHTMLDocument("");O.body.innerHTML=`<div class="grid-stack-item ${this.opts.itemClass||""}"><div class="grid-stack-item-content">${k}</div></div>`,w=O.body.children[0]}else w=d;let E=this._readAttr(w);m=s.Utils.cloneDeep(m)||{},s.Utils.defaults(m,E);let A=this.engine.prepareNode(m);return this._writeAttr(w,m),this._insertNotAppend?this.el.prepend(w):this.el.appendChild(w),this._prepareElement(w,!0,m),this._updateContainerHeight(),A.subGrid&&this.makeSubGrid(A.el,void 0,void 0,!1),this._prevColumn&&this.opts.column===1&&(this._ignoreLayoutsNodeChange=!0),this._triggerAddEvent(),this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,w}makeSubGrid(d,m,g,w=!0){var E;let A=d.gridstackNode;if(A||(A=this.makeWidget(d).gridstackNode),!((E=A.subGrid)===null||E===void 0)&&E.el)return A.subGrid;m=s.Utils.cloneDeep(m||A.subGrid||Object.assign(Object.assign({},this.opts.subGrid),{children:void 0})),m.subGrid=s.Utils.cloneDeep(m),A.subGrid=m;let k;m.column==="auto"&&(k=!0,m.column=Math.max(A.w||1,(g==null?void 0:g.w)||1),m.disableOneColumnMode=!0);let O=A.el.querySelector(".grid-stack-item-content"),ne,Q;if(w){this._removeDD(A.el);let U=document.implementation.createHTMLDocument("");U.body.innerHTML='<div class="grid-stack-item"></div>',ne=U.body.children[0],ne.appendChild(O),Q=Object.assign(Object.assign({},A),{x:0,y:0}),s.Utils.removeInternalForSave(Q),delete Q.subGrid,A.content&&(Q.content=A.content,delete A.content),U.body.innerHTML='<div class="grid-stack-item-content"></div>',O=U.body.children[0],A.el.appendChild(O),this._prepareDragDropByNode(A)}if(g){let U=k?m.column:A.w,_=A.h+g.h,Se=A.el.style;Se.transition="none",this.update(A.el,{w:U,h:_}),setTimeout(()=>Se.transition=null)}let ue=A.subGrid=a.addGrid(O,m);return g!=null&&g._moving&&(ue._isTemp=!0),k&&(ue._autoColumn=!0),w&&ue.addWidget(ne,Q),g&&(g._moving?window.setTimeout(()=>s.Utils.simulateMouseEvent(g._event,"mouseenter",ue.el),0):ue.addWidget(A.el,A)),ue}removeAsSubGrid(d){var m;let g=(m=this.parentGridItem)===null||m===void 0?void 0:m.grid;g&&(g.batchUpdate(),g.removeWidget(this.parentGridItem.el,!0,!0),this.engine.nodes.forEach(w=>{w.x+=this.parentGridItem.x,w.y+=this.parentGridItem.y,g.addWidget(w.el,w)}),g.batchUpdate(!1),delete this.parentGridItem,d&&window.setTimeout(()=>s.Utils.simulateMouseEvent(d._event,"mouseenter",g.el),0))}save(d=!0,m=!1){let g=this.engine.save(d);if(g.forEach(w=>{if(d&&w.el&&!w.subGrid){let E=w.el.querySelector(".grid-stack-item-content");w.content=E?E.innerHTML:void 0,w.content||delete w.content}else d||delete w.content,w.subGrid&&(w.subGrid=w.subGrid.save(d,!0));delete w.el}),m){let w=s.Utils.cloneDeep(this.opts);w.marginBottom===w.marginTop&&w.marginRight===w.marginLeft&&w.marginTop===w.marginRight&&(w.margin=w.marginTop,delete w.marginTop,delete w.marginRight,delete w.marginBottom,delete w.marginLeft),w.rtl===(this.el.style.direction==="rtl")&&(w.rtl="auto"),this._isAutoCellHeight&&(w.cellHeight="auto"),this._autoColumn&&(w.column="auto",delete w.disableOneColumnMode);const E=w._alwaysShowResizeHandle;return delete w._alwaysShowResizeHandle,E!==void 0?w.alwaysShowResizeHandle=E:delete w.alwaysShowResizeHandle,s.Utils.removeInternalAndSame(w,o.gridDefaults),w.children=g,w}return g}load(d,m=!0){let g=a.Utils.sort([...d],-1,this._prevColumn||this.getColumn());this._insertNotAppend=!0,this._prevColumn&&this._prevColumn!==this.opts.column&&g.some(E=>E.x+E.w>this.opts.column)&&(this._ignoreLayoutsNodeChange=!0,this.engine.cacheLayout(g,this._prevColumn,!0));let w=[];return this.batchUpdate(),m&&[...this.engine.nodes].forEach(A=>{g.find(O=>A.id===O.id)||(typeof m=="function"?m(this,A,!1):(w.push(A),this.removeWidget(A.el,!0,!1)))}),g.forEach(E=>{let A=E.id||E.id===0?this.engine.nodes.find(k=>k.id===E.id):void 0;if(A){if(this.update(A.el,E),E.subGrid&&E.subGrid.children){let k=A.el.querySelector(".grid-stack");k&&k.gridstack&&(k.gridstack.load(E.subGrid.children),this._insertNotAppend=!0)}}else m&&(typeof m=="function"?E=m(this,E,!0).gridstackNode:E=this.addWidget(E).gridstackNode)}),this.engine.removedNodes=w,this.batchUpdate(!1),delete this._ignoreLayoutsNodeChange,delete this._insertNotAppend,this}batchUpdate(d=!0){return this.engine.batchUpdate(d),d||(this._triggerRemoveEvent(),this._triggerAddEvent(),this._triggerChangeEvent()),this}getCellHeight(d=!1){if(this.opts.cellHeight&&this.opts.cellHeight!=="auto"&&(!d||!this.opts.cellHeightUnit||this.opts.cellHeightUnit==="px"))return this.opts.cellHeight;let m=this.el.querySelector("."+this.opts.itemClass);if(m){let w=s.Utils.toNumber(m.getAttribute("gs-h"));return Math.round(m.offsetHeight/w)}let g=parseInt(this.el.getAttribute("gs-current-row"));return g?Math.round(this.el.getBoundingClientRect().height/g):this.opts.cellHeight}cellHeight(d,m=!0){if(m&&d!==void 0&&this._isAutoCellHeight!==(d==="auto")&&(this._isAutoCellHeight=d==="auto",this._updateWindowResizeEvent()),(d==="initial"||d==="auto")&&(d=void 0),d===void 0){let w=-this.opts.marginRight-this.opts.marginLeft+this.opts.marginTop+this.opts.marginBottom;d=this.cellWidth()+w}let g=s.Utils.parseHeight(d);return this.opts.cellHeightUnit===g.unit&&this.opts.cellHeight===g.h?this:(this.opts.cellHeightUnit=g.unit,this.opts.cellHeight=g.h,m&&this._updateStyles(!0),this)}cellWidth(){return this._widthOrContainer()/this.getColumn()}_widthOrContainer(){return this.el.clientWidth||this.el.parentElement.clientWidth||window.innerWidth}compact(){return this.engine.compact(),this._triggerChangeEvent(),this}column(d,m="moveScale"){if(d<1||this.opts.column===d)return this;let g=this.getColumn();d===1?this._prevColumn=g:delete this._prevColumn,this.el.classList.remove("grid-stack-"+g),this.el.classList.add("grid-stack-"+d),this.opts.column=this.engine.column=d;let w;return d===1&&this.opts.oneColumnModeDomSort&&(w=[],this.getGridItems().forEach(E=>{E.gridstackNode&&w.push(E.gridstackNode)}),w.length||(w=void 0)),this.engine.updateNodeWidths(g,d,w,m),this._isAutoCellHeight&&this.cellHeight(),this._ignoreLayoutsNodeChange=!0,this._triggerChangeEvent(),delete this._ignoreLayoutsNodeChange,this}getColumn(){return this.opts.column}getGridItems(){return Array.from(this.el.children).filter(d=>d.matches("."+this.opts.itemClass)&&!d.matches("."+this.opts.placeholderClass))}destroy(d=!0){if(this.el)return this._updateWindowResizeEvent(!0),this.setStatic(!0,!1),this.setAnimation(!1),d?this.el.parentNode.removeChild(this.el):(this.removeAll(d),this.el.classList.remove(this._styleSheetClass)),this._removeStylesheet(),this.el.removeAttribute("gs-current-row"),delete this.parentGridItem,delete this.opts,delete this._placeholder,delete this.engine,delete this.el.gridstack,delete this.el,this}float(d){return this.opts.float!==d&&(this.opts.float=this.engine.float=d,this._triggerChangeEvent()),this}getFloat(){return this.engine.float}getCellFromPixel(d,m=!1){let g=this.el.getBoundingClientRect(),w;m?w={top:g.top+document.documentElement.scrollTop,left:g.left}:w={top:this.el.offsetTop,left:this.el.offsetLeft};let E=d.left-w.left,A=d.top-w.top,k=g.width/this.getColumn(),O=g.height/parseInt(this.el.getAttribute("gs-current-row"));return{x:Math.floor(E/k),y:Math.floor(A/O)}}getRow(){return Math.max(this.engine.getRow(),this.opts.minRow)}isAreaEmpty(d,m,g,w){return this.engine.isAreaEmpty(d,m,g,w)}makeWidget(d){let m=a.getElement(d);return this._prepareElement(m,!0),this._updateContainerHeight(),this._triggerAddEvent(),this._triggerChangeEvent(),m}on(d,m){return d.indexOf(" ")!==-1?(d.split(" ").forEach(w=>this.on(w,m)),this):(d==="change"||d==="added"||d==="removed"||d==="enable"||d==="disable"?(d==="enable"||d==="disable"?this._gsEventHandler[d]=w=>m(w):this._gsEventHandler[d]=w=>m(w,w.detail),this.el.addEventListener(d,this._gsEventHandler[d])):d==="drag"||d==="dragstart"||d==="dragstop"||d==="resizestart"||d==="resize"||d==="resizestop"||d==="dropped"?this._gsEventHandler[d]=m:console.log("GridStack.on("+d+') event not supported, but you can still use $(".grid-stack").on(...) while jquery-ui is still used internally.'),this)}off(d){return d.indexOf(" ")!==-1?(d.split(" ").forEach(g=>this.off(g)),this):((d==="change"||d==="added"||d==="removed"||d==="enable"||d==="disable")&&this._gsEventHandler[d]&&this.el.removeEventListener(d,this._gsEventHandler[d]),delete this._gsEventHandler[d],this)}removeWidget(d,m=!0,g=!0){return a.getElements(d).forEach(w=>{if(w.parentElement&&w.parentElement!==this.el)return;let E=w.gridstackNode;E||(E=this.engine.nodes.find(A=>w===A.el)),E&&(delete w.gridstackNode,this._removeDD(w),this.engine.removeNode(E,m,g),m&&w.parentElement&&w.remove())}),g&&(this._triggerRemoveEvent(),this._triggerChangeEvent()),this}removeAll(d=!0){return this.engine.nodes.forEach(m=>{delete m.el.gridstackNode,this._removeDD(m.el)}),this.engine.removeAll(d),this._triggerRemoveEvent(),this}setAnimation(d){return d?this.el.classList.add("grid-stack-animate"):this.el.classList.remove("grid-stack-animate"),this}setStatic(d,m=!0){return this.opts.staticGrid===d?this:(this.opts.staticGrid=d,this._setupRemoveDrop(),this._setupAcceptWidget(),this.engine.nodes.forEach(g=>this._prepareDragDropByNode(g)),m&&this._setStaticClass(),this)}update(d,m){if(arguments.length>2){console.warn("gridstack.ts: `update(el, x, y, w, h)` is deprecated. Use `update(el, {x, w, content, ...})`. It will be removed soon");let g=arguments,w=1;return m={x:g[w++],y:g[w++],w:g[w++],h:g[w++]},this.update(d,m)}return a.getElements(d).forEach(g=>{if(!g||!g.gridstackNode)return;let w=g.gridstackNode,E=s.Utils.cloneDeep(m);delete E.autoPosition;let A=["x","y","w","h"],k;if(A.some(Q=>E[Q]!==void 0&&E[Q]!==w[Q])&&(k={},A.forEach(Q=>{k[Q]=E[Q]!==void 0?E[Q]:w[Q],delete E[Q]})),!k&&(E.minW||E.minH||E.maxW||E.maxH)&&(k={}),E.content){let Q=g.querySelector(".grid-stack-item-content");Q&&Q.innerHTML!==E.content&&(Q.innerHTML=E.content),delete E.content}let O=!1,ne=!1;for(const Q in E)Q[0]!=="_"&&w[Q]!==E[Q]&&(w[Q]=E[Q],O=!0,ne=ne||!this.opts.staticGrid&&(Q==="noResize"||Q==="noMove"||Q==="locked"));k&&(this.engine.cleanNodes().beginUpdate(w).moveNode(w,k),this._updateContainerHeight(),this._triggerChangeEvent(),this.engine.endUpdate()),O&&this._writeAttr(g,w),ne&&this._prepareDragDropByNode(w)}),this}margin(d){if(!(typeof d=="string"&&d.split(" ").length>1)){let g=s.Utils.parseHeight(d);if(this.opts.marginUnit===g.unit&&this.opts.margin===g.h)return}return this.opts.margin=d,this.opts.marginTop=this.opts.marginBottom=this.opts.marginLeft=this.opts.marginRight=void 0,this._initMargin(),this._updateStyles(!0),this}getMargin(){return this.opts.margin}willItFit(d){if(arguments.length>1){console.warn("gridstack.ts: `willItFit(x,y,w,h,autoPosition)` is deprecated. Use `willItFit({x, y,...})`. It will be removed soon");let m=arguments,g=0,w={x:m[g++],y:m[g++],w:m[g++],h:m[g++],autoPosition:m[g++]};return this.willItFit(w)}return this.engine.willItFit(d)}_triggerChangeEvent(){if(this.engine.batchMode)return this;let d=this.engine.getDirtyNodes(!0);return d&&d.length&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(d),this._triggerEvent("change",d)),this.engine.saveInitial(),this}_triggerAddEvent(){return this.engine.batchMode?this:(this.engine.addedNodes&&this.engine.addedNodes.length>0&&(this._ignoreLayoutsNodeChange||this.engine.layoutsNodesChange(this.engine.addedNodes),this.engine.addedNodes.forEach(d=>{delete d._dirty}),this._triggerEvent("added",this.engine.addedNodes),this.engine.addedNodes=[]),this)}_triggerRemoveEvent(){return this.engine.batchMode?this:(this.engine.removedNodes&&this.engine.removedNodes.length>0&&(this._triggerEvent("removed",this.engine.removedNodes),this.engine.removedNodes=[]),this)}_triggerEvent(d,m){let g=m?new CustomEvent(d,{bubbles:!1,detail:m}):new Event(d);return this.el.dispatchEvent(g),this}_removeStylesheet(){return this._styles&&(s.Utils.removeStylesheet(this._styleSheetClass),delete this._styles),this}_updateStyles(d=!1,m){if(d&&this._removeStylesheet(),m||(m=this.getRow()),this._updateContainerHeight(),this.opts.cellHeight===0)return this;let g=this.opts.cellHeight,w=this.opts.cellHeightUnit,E=`.${this._styleSheetClass} > .${this.opts.itemClass}`;if(!this._styles){let A=this.opts.styleInHead?void 0:this.el.parentNode;if(this._styles=s.Utils.createStylesheet(this._styleSheetClass,A),!this._styles)return this;this._styles._max=0,s.Utils.addCSSRule(this._styles,E,`min-height: ${g}${w}`);let k=this.opts.marginTop+this.opts.marginUnit,O=this.opts.marginBottom+this.opts.marginUnit,ne=this.opts.marginRight+this.opts.marginUnit,Q=this.opts.marginLeft+this.opts.marginUnit,ue=`${E} > .grid-stack-item-content`,U=`.${this._styleSheetClass} > .grid-stack-placeholder > .placeholder-content`;s.Utils.addCSSRule(this._styles,ue,`top: ${k}; right: ${ne}; bottom: ${O}; left: ${Q};`),s.Utils.addCSSRule(this._styles,U,`top: ${k}; right: ${ne}; bottom: ${O}; left: ${Q};`),s.Utils.addCSSRule(this._styles,`${E} > .ui-resizable-ne`,`right: ${ne}`),s.Utils.addCSSRule(this._styles,`${E} > .ui-resizable-e`,`right: ${ne}`),s.Utils.addCSSRule(this._styles,`${E} > .ui-resizable-se`,`right: ${ne}; bottom: ${O}`),s.Utils.addCSSRule(this._styles,`${E} > .ui-resizable-nw`,`left: ${Q}`),s.Utils.addCSSRule(this._styles,`${E} > .ui-resizable-w`,`left: ${Q}`),s.Utils.addCSSRule(this._styles,`${E} > .ui-resizable-sw`,`left: ${Q}; bottom: ${O}`)}if(m=m||this._styles._max,m>this._styles._max){let A=k=>g*k+w;for(let k=this._styles._max+1;k<=m;k++){let O=A(k);s.Utils.addCSSRule(this._styles,`${E}[gs-y="${k-1}"]`,`top: ${A(k-1)}`),s.Utils.addCSSRule(this._styles,`${E}[gs-h="${k}"]`,`height: ${O}`),s.Utils.addCSSRule(this._styles,`${E}[gs-min-h="${k}"]`,`min-height: ${O}`),s.Utils.addCSSRule(this._styles,`${E}[gs-max-h="${k}"]`,`max-height: ${O}`)}this._styles._max=m}return this}_updateContainerHeight(){if(!this.engine||this.engine.batchMode)return this;let d=this.getRow()+this._extraDragRow;if(this.el.setAttribute("gs-current-row",String(d)),d===0)return this.el.style.removeProperty("min-height"),this;let m=this.opts.cellHeight,g=this.opts.cellHeightUnit;return m?(this.el.style.minHeight=d*m+g,this):this}_prepareElement(d,m=!1,g){g||(d.classList.add(this.opts.itemClass),g=this._readAttr(d)),d.gridstackNode=g,g.el=d,g.grid=this;let w=Object.assign({},g);return g=this.engine.addNode(g,m),s.Utils.same(g,w)||this._writeAttr(d,g),this._prepareDragDropByNode(g),this}_writePosAttr(d,m){return m.x!==void 0&&m.x!==null&&d.setAttribute("gs-x",String(m.x)),m.y!==void 0&&m.y!==null&&d.setAttribute("gs-y",String(m.y)),m.w&&d.setAttribute("gs-w",String(m.w)),m.h&&d.setAttribute("gs-h",String(m.h)),this}_writeAttr(d,m){if(!m)return this;this._writePosAttr(d,m);let g={autoPosition:"gs-auto-position",minW:"gs-min-w",minH:"gs-min-h",maxW:"gs-max-w",maxH:"gs-max-h",noResize:"gs-no-resize",noMove:"gs-no-move",locked:"gs-locked",id:"gs-id",resizeHandles:"gs-resize-handles"};for(const w in g)m[w]?d.setAttribute(g[w],String(m[w])):d.removeAttribute(g[w]);return this}_readAttr(d){let m={};m.x=s.Utils.toNumber(d.getAttribute("gs-x")),m.y=s.Utils.toNumber(d.getAttribute("gs-y")),m.w=s.Utils.toNumber(d.getAttribute("gs-w")),m.h=s.Utils.toNumber(d.getAttribute("gs-h")),m.maxW=s.Utils.toNumber(d.getAttribute("gs-max-w")),m.minW=s.Utils.toNumber(d.getAttribute("gs-min-w")),m.maxH=s.Utils.toNumber(d.getAttribute("gs-max-h")),m.minH=s.Utils.toNumber(d.getAttribute("gs-min-h")),m.autoPosition=s.Utils.toBool(d.getAttribute("gs-auto-position")),m.noResize=s.Utils.toBool(d.getAttribute("gs-no-resize")),m.noMove=s.Utils.toBool(d.getAttribute("gs-no-move")),m.locked=s.Utils.toBool(d.getAttribute("gs-locked")),m.resizeHandles=d.getAttribute("gs-resize-handles"),m.id=d.getAttribute("gs-id");for(const g in m){if(!m.hasOwnProperty(g))return;!m[g]&&m[g]!==0&&delete m[g]}return m}_setStaticClass(){let d=["grid-stack-static"];return this.opts.staticGrid?(this.el.classList.add(...d),this.el.setAttribute("gs-static","true")):(this.el.classList.remove(...d),this.el.removeAttribute("gs-static")),this}onParentResize(){if(!this.el||!this.el.clientWidth)return;let d=!1;if(this._autoColumn&&this.parentGridItem)this.opts.column!==this.parentGridItem.w&&(d=!0,this.column(this.parentGridItem.w,"none"));else{let m=!this.opts.disableOneColumnMode&&this.el.clientWidth<=this.opts.oneColumnSize;this.opts.column===1!==m&&(d=!0,this.opts.animate&&this.setAnimation(!1),this.column(m?1:this._prevColumn),this.opts.animate&&this.setAnimation(!0))}return this._isAutoCellHeight&&(!d&&this.opts.cellHeightThrottle?(this._cellHeightThrottle||(this._cellHeightThrottle=s.Utils.throttle(()=>this.cellHeight(),this.opts.cellHeightThrottle)),this._cellHeightThrottle()):this.cellHeight()),this.engine.nodes.forEach(m=>{m.subGrid&&m.subGrid.onParentResize()}),this}_updateWindowResizeEvent(d=!1){const m=(this._isAutoCellHeight||!this.opts.disableOneColumnMode)&&!this.parentGridItem;return!d&&m&&!this._windowResizeBind?(this._windowResizeBind=this.onParentResize.bind(this),window.addEventListener("resize",this._windowResizeBind)):(d||!m)&&this._windowResizeBind&&(window.removeEventListener("resize",this._windowResizeBind),delete this._windowResizeBind),this}static getElement(d=".grid-stack-item"){return s.Utils.getElement(d)}static getElements(d=".grid-stack-item"){return s.Utils.getElements(d)}static getGridElement(d){return a.getElement(d)}static getGridElements(d){return s.Utils.getElements(d)}_initMargin(){let d,m=0,g=[];return typeof this.opts.margin=="string"&&(g=this.opts.margin.split(" ")),g.length===2?(this.opts.marginTop=this.opts.marginBottom=g[0],this.opts.marginLeft=this.opts.marginRight=g[1]):g.length===4?(this.opts.marginTop=g[0],this.opts.marginRight=g[1],this.opts.marginBottom=g[2],this.opts.marginLeft=g[3]):(d=s.Utils.parseHeight(this.opts.margin),this.opts.marginUnit=d.unit,m=this.opts.margin=d.h),this.opts.marginTop===void 0?this.opts.marginTop=m:(d=s.Utils.parseHeight(this.opts.marginTop),this.opts.marginTop=d.h,delete this.opts.margin),this.opts.marginBottom===void 0?this.opts.marginBottom=m:(d=s.Utils.parseHeight(this.opts.marginBottom),this.opts.marginBottom=d.h,delete this.opts.margin),this.opts.marginRight===void 0?this.opts.marginRight=m:(d=s.Utils.parseHeight(this.opts.marginRight),this.opts.marginRight=d.h,delete this.opts.margin),this.opts.marginLeft===void 0?this.opts.marginLeft=m:(d=s.Utils.parseHeight(this.opts.marginLeft),this.opts.marginLeft=d.h,delete this.opts.margin),this.opts.marginUnit=d.unit,this.opts.marginTop===this.opts.marginBottom&&this.opts.marginLeft===this.opts.marginRight&&this.opts.marginTop===this.opts.marginRight&&(this.opts.margin=this.opts.marginTop),this}static setupDragIn(d,m){}movable(d,m){return this}resizable(d,m){return this}disable(){return this}enable(){return this}enableMove(d){return this}enableResize(d){return this}_removeDD(d){return this}_setupAcceptWidget(){return this}_setupRemoveDrop(){return this}_prepareDragDropByNode(d){return this}_onStartMoving(d,m,g,w,E,A){}_dragOrResize(d,m,g,w,E,A){}_leave(d,m){}commit(){return s.obsolete(this,this.batchUpdate(!1),"commit","batchUpdate","5.2"),this}}i.GridStack=a,a.Utils=s.Utils,a.Engine=r.GridStackEngine,a.GDRev="7.1.1";const l=requireDdTouch(),u=requireDdManager();t(requireDdGridstack(),i)}(gridstack)),gridstack}var gridstackExports=requireGridstack();function clearPosition(i){i.style.position="",i.style.left="",i.style.right="",i.style.top="",i.style.bottom="",i.style.width="",i.style.height=""}class GridStackManager{constructor(e){As(this,"cellHeight",150);As(this,"cellApproxWidth",300);As(this,"grids");As(this,"dragHandle",".ciview-chart-title");As(this,"chartManager");this.grids=new Map,this.chartManager=e}getGrid(e){if(!this.grids.has(e)){const t=e.contentDiv;t.classList.add("grid-stack");const r=t.getBoundingClientRect(),s=Math.round(r.width/this.cellApproxWidth);console.log(s);const o=Math.round(r.height/this.cellHeight);this.cellHeight=r.height/o,console.log("gridstack cellHeight",this.cellHeight);const a=gridstackExports.GridStack.init({cellHeight:this.cellHeight,handle:this.dragHandle,float:!0,oneColumnSize:400},t);a.on("resizestop",(u,p)=>{p instanceof HTMLElement&&(p.style.filter="")}),a.on("resizestart",(u,p)=>{p instanceof HTMLElement&&(p.style.filter="blur(1px) opacity(0.5)")});const l=this.chartManager.addMenuIcon(e.name,"fas fa-compress-arrows-alt","compact layout",()=>a.compact());this.grids.set(e,{grid:a,charts:new Set,icon:l})}return this.grids.get(e)}destroy(e){this.grids.has(e)||console.error(`destroying non-existent gridstack - ${e.name}`);const t=this.grids.get(e),r=e.contentDiv,s=new Map;for(let o of t.charts){const a=o.getDiv();s.set(a,[a.offsetWidth,a.offsetHeight,a.offsetLeft,a.offsetTop]),o.removeLayout(),delete o.config.gssize,delete o.config.gsposition}t.grid.destroy(!1);for(let o of t.charts){const a=o.getDiv(),l=s.get(a);a.style.position="absolute",a.style.width=l[0]-5+"px",a.style.height=l[1]-5+"px",a.style.left=l[2]+"px",a.style.top=l[3]+"px",o.config.size=[l[0]-5,l[1]-5],o.config.position=[l[2],l[3]],a.classList.remove("grid-stack-item")}r.classList.remove("grid-stack"),t.icon.remove(),this.grids.delete(e)}getCellDimensions(e){return[this.getGrid(e).grid.cellWidth(),this.cellHeight]}manageChart(e,t,r){const s=this.getGrid(t),o=s.grid;s.charts.add(e);const a=e.getDiv(),l=a.getBoundingClientRect();let u=Math.round(l.width/o.cellWidth()),p=Math.round(l.height/this.cellHeight),d=Math.round(a.offsetLeft/o.cellWidth());d=d>11?11:d;let m=Math.floor(a.offsetTop/this.cellHeight);e.config.gsposition&&([d,m]=e.config.gsposition,[u,p]=e.config.gssize,r=!1),clearPosition(a),a.style.transition="filter 0.5s ease";const g=new ResizeObserver(debounce(()=>{try{e.setSize()}catch{}},20));g.observe(a),o.makeWidget(a),r?o.update(a,{w:u,h:p}):(console.log({w:u,h:p,x:d,y:m}),o.update(a,{w:u,h:p,x:d,y:m}));const w=ne(),E=k(),A=O();function k(){let ue=!1;const U=e.addMenuIcon("fas fa-unlock","lock position"),_=U.children[0];return U.addEventListener("click",()=>{ue=!ue,_.classList.toggle("fa-lock",ue),_.classList.toggle("fa-unlock",!ue),o.update(a,{locked:ue}),a.classList.toggle("gridLock",ue)}),U}function O(){const{remove:ue}=e;return e.remove=()=>{o.removeWidget(a,!0),s.charts.delete(e),ue.apply(e)},ue}function ne(){const{changeBaseDocument:ue}=e;return a.gridstackPopoutCallback=()=>{o.removeWidget(a,!0)},e.changeBaseDocument=U=>{ue.apply(e,[U]),U===document&&console.error("changeBaseDocument should be restored to normal by the time we get here..."),Q()},ue}function Q(){o.removeWidget(a,!0),E.remove(),e.remove=A,e.changeBaseDocument=w}e.removeLayout=()=>{o.removeWidget(a,!1),E.remove(),delete a.gridstackPopoutCallback,e.remove=A,e.changeBaseDocument=w,g.disconnect()}}}const column_orders={double:0,integer:0,int32:0,multitext:1,text:2,unique:2},themes={Dark:{title_bar_color:"#222",main_panel_color:"black",text_color:"white",background_color:"#333"},Light:{title_bar_color:"white",main_panel_color:"#f1f1f1",text_color:"black",background_color:"#bababa"}};function getPreferredColorScheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"Dark":"Light"}function listenPreferredColorScheme(i){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>i(getPreferredColorScheme()))}class ChartManager{constructor(e,t,r,s={},o=null){this.listeners={},this.infoAlerts={},this.progressBars={},this.setTheme(getPreferredColorScheme()),listenPreferredColorScheme(u=>this.setTheme(u)),this.dataSources=[],this.dsIndex={},this.columnsLoading={};for(const u of t){const p={name:u.name,dataStore:new DataStore(u.size,u),link_to:u.link_to,index_link_to:u.index_link_to,color:u.color||themes[this.theme].background_color,column_link_to:u.column_link_to,links:u.links,custom:u.custom||{}};this.dataSources.push(p),this.dsIndex[u.name]=p,this._addDSListeners(p),this.columnsLoading[u.name]={}}if(o&&this.addListener("_default",o),this.transactions={},this.containerDiv=typeof e=="string"?document.getElementById(e):e,this.containerDiv.style.display="flex",this.containerDiv.style.flexDirection="column",this.menuBar=createEl("div",{classes:["ciview-main-menu-bar"]},this.containerDiv),this.leftMenuBar=createEl("span",{},this.menuBar),this.rightMenuBar=createEl("span",{styles:{float:"right"}},this.menuBar),createEl("span",{classes:["mdv-divider"]},this.menuBar),s.all_views){this.viewSelect=createEl("select",{},this.menuBar);for(let u of s.all_views)createEl("option",{text:u,value:u},this.viewSelect);this.viewSelect.addEventListener("change",u=>{this.config.show_save_view_dialog&&s.permission==="edit"?this.showSaveViewDialog(()=>this.changeView(this.viewSelect.value)):this.changeView(this.viewSelect.value)})}s.permission==="edit"&&createMenuIcon("fas fa-save",{tooltip:{text:"Save View",position:"bottom-right"},func:()=>{const u=this.getState();this._callListeners("state_saved",u)}},this.menuBar),s.permission==="edit"&&s.all_views&&(createMenuIcon("fas fa-plus",{tooltip:{text:"Create New View",position:"bottom-right"},func:()=>{this.showSaveViewDialog(()=>this.showAddViewDialog())}},this.menuBar),createMenuIcon("fas fa-minus",{tooltip:{text:"Delete Current View",position:"bottom-right"},func:()=>{this.showDeleteViewDialog()}},this.menuBar));const a=createMenuIcon("fas fa-adjust",{tooltip:{text:"Change Theme",position:"bottom-left"},func:u=>{this.themeMenu.show(u)}},this.rightMenuBar);a.style.margin="3px",this._setupThemeContextMenu(),this.contentDiv=createEl("div",{styles:{flex:"1 1 auto",position:"relative"}},this.containerDiv),this.contentDiv.classList.add("ciview-contentDiv"),this.gridStack=new GridStackManager(this),this.charts={},this.config=s;const l=this.config;if(l.chart_color=l.chart_color||"white",this.dataLoader=r.function,this.viewLoader=r.viewLoader,this.layoutMenus={},r.files){this.filesToLoad=r.files.length;for(let u of r.files)this.loadFile(u,()=>{this.filesToLoad--,this.filesToLoad===0&&this._loadView(s,r,!0)})}else this._loadView(s,r,!0)}_setUpChangeLayoutMenu(e){this.layoutMenus[e.name]=new ContextMenu(()=>{const t=this.viewData.dataSources[e.name].layout||"absolute";return[{text:"Absolute",ghosted:t==="absolute",func:()=>this.changeLayout("absolute",e)},{text:"Grid Stack",ghosted:t==="gridstack",func:()=>this.changeLayout("gridstack",e)}]})}changeLayout(e,t){const r=this.viewData.dataSources[t.name],s=r.layout||"absolute";e!==s&&(s==="gridstack"?this.gridStack.destroy(t):s==="absolute"&&this.getAllCharts(t.name).forEach(o=>{const a=o.getDiv();removeResizable(a),removeDraggable(a)}),r.layout=e,e==="absolute"?this.getAllCharts(t.name).forEach(o=>this._makeChartRD(o,t)):e==="gridstack"&&this.getAllCharts(t.name).forEach(o=>{this.gridStack.manageChart(o,t,this._inInit)}))}_setupThemeContextMenu(){this.themeMenu=new ContextMenu(()=>{const e=[];for(let t in themes)e.push(this.__getMenuItem(t));return e})}__getMenuItem(e){return{text:e,ghosted:this.theme===e,func:()=>this.setTheme(e)}}setTheme(e){if(this.theme=e,document.getElementsByTagName("html")[0].className=e,!!this.charts)for(let t in this.charts){const r=this.charts[t];r.chart.themeChanged&&r.chart.themeChanged()}}_sync_colors(e,t,r){for(let s of e){const o=t.columnIndex[s.link_to],a=r.columnIndex[s.col],l=new Array(a.values),u=t.getColumnColors(s.link_to);for(let p=0;p<o.values.length;p++){const d=o.values[p],m=a.values.indexOf(d);m!==-1&&(l[m]=u[p])}a.colors=l}}_initiateOffsets(e){const t=e.dataStore,r=t.offsets,s=r.param,o=[s[0],s[1],r.groups];r.background_filter&&o.push(r.background_filter),this._getColumnsThen(e.name,o,()=>{t.initiateOffsets(),t.updateColumnOffsets(),t.updateColumnOffsets(null,!0,!0)})}_loadView(e,t,r=!1){e.all_views?(this.currentView=e.initial_view||e.all_views[0],this.viewSelect.value=this.currentView,t.viewLoader(this.currentView).then(s=>{this._init(s,r)})):this._init(e.only_view,r)}getDataSource(e){return this.dsIndex[e].dataStore}_init(e,t=!1){if(e){if(!e.dataSources){e.dataSources={};for(let l in e.initialCharts)e.dataSources[l]={}}this.viewData=e}else{const l={};for(let u in this.dsIndex)l[u]={layout:"gridstack"};this.viewData={dataSources:l,initialCharts:{}}}for(let l of this.dataSources)delete l.contentDiv,delete l.menuBar;const r=Object.keys(this.viewData.dataSources);let s=[];for(let l of r){let u=this.viewData.dataSources[l].panelWidth;if(!u){s=null;break}s.push(u)}this.dsPanes={};const o=splitPane(this.contentDiv,{number:r.length,sizes:s});for(let l=0;l<r.length;l++){const u=o[l];u.style.display="flex",u.style.flexDirection="column";const p=this.dsIndex[r[l]];this.dsPanes[p.name]=u,this.columnsLoading[p.name]={},p.charts=[],p.menuBar=createEl("div",{classes:["ciview-menu-bar"]},u);const d=createEl("div",{styles:{flex:"1 1 auto",position:"relative",overflow:"auto",height:"100px"}},u);this._setUpMenu(p),p.contentDiv=createEl("div",{styles:{position:"relative",height:"100%"}},d),p.contentDiv.classList.add("ciview-contentDiv"),this._setUpChangeLayoutMenu(p)}if(t)for(let l of this.dataSources){const u=l.dataStore;u.offsets&&this._initiateOffsets(l),l.column_link_to&&this._sync_colors(l.column_link_to.columns,this.dsIndex[l.column_link_to.dataSource].dataStore,u);for(let p of u.syncColumnColors)this._sync_colors(p.columns,this.dsIndex[p.dataSource].dataStore,u)}const a=e.initialCharts||{};this._toLoadCharts=new Set;for(let l in a)for(let u of a[l])this._toLoadCharts.add(u);this._toLoadCharts.size==0&&(delete this._toLoadCharts,this._callListeners("view_loaded",this.currentView)),this._inInit=!0;for(let l in a)for(let u of a[l])this.addChart(l,u);this._inInit=!1}_addDSListeners(e){e.dataStore.addListener("l1",(t,r)=>{if(t==="column_removed")this._columnRemoved(e,r);else if(t==="data_highlighted")r.dataStore=e.dataStore,this._callListeners(t,r);else if(t==="filtered"){if(!this.progressBars[e.name])return;e.dataStore.size;const s=e.dataStore.filterSize;this.progressBars[e.name].setValue(s),this.progressBars[e.name].setText(s),this._callListeners(t,r)}})}showAddViewDialog(){const e=[{type:"checkbox",id:"clone-view",label:"Clone current view"},{type:"text",id:"name",label:"name"}];if(this.dataSources.length>1)for(let t of this.dataSources)e.push({type:"checkbox",id:t.name,label:`Include ${t.name}`});new CustomDialog({title:"Add New View",controls:e,buttons:[{text:"Create New View",method:t=>{if(createEl("option",{text:t.name,value:t.name},this.viewSelect),this.viewSelect.value=t.name,this.currentView=t.name,t["clone-view"]){const r=this.getState();this._callListeners("state_saved",r)}else{for(let s in this.viewData.dataSources)this.viewData.dataSources[s].layout==="gridstack"&&this.gridStack.destroy(this.dsIndex[s]);this.removeAllCharts(),this.viewData.links=[];const r=this.getState();if(r.view.initialCharts={},r.view.dataSources={},this.dataSources.length===1)r.view.initialCharts[this.dataSources[0].name]=[],r.viewDataSources[this.dataSources[0].name]={};else for(let s in this.dsIndex)t[s]&&(r.view.initialCharts[s]=[],r.view.dataSources[s]={});this._callListeners("state_saved",r),this.contentDiv.innerHTML="",this._init(r.view)}}}]})}showSaveViewDialog(e){new CustomDialog({title:"Save View",text:"Do you want to save the current view",buttons:[{text:"YES",method:()=>{const t=this.getState();this._callListeners("state_saved",t),e()}},{text:"NO",method:()=>{e()}}]})}showDeleteViewDialog(){new CustomDialog({title:"Delete View",text:"Do you want to delete the current view?",buttons:[{text:"YES",method:()=>{this.deleteCurrentView()}},{text:"NO",method:()=>{}}]})}changeView(e){for(let t in this.viewData.dataSources)this.viewData.dataSources[t].layout==="gridstack"&&this.gridStack.destroy(this.dsIndex[t]);this.removeAllCharts(),this.contentDiv.innerHTML="",this.currentView=e,this.viewLoader(e).then(t=>{this._init(t)})}deleteCurrentView(){const e=this.viewSelect.querySelector(`option[value='${this.viewSelect.value}']`);this.getState(),this.currentView=this.viewSelect.value,e.remove(),this.changeView(this.viewSelect.value)}_columnRemoved(e,t){const r=[];for(let s in this.charts){const o=this.charts[s];if(o.dataSource===e){const a=o.chart,l=a.getDiv();a.onColumnRemoved(t)&&(l.remove(!1),r.push(s),this._removeLinks(a),this._callListeners("chart_removed",a))}}r.length>0&&e.dataStore._callListeners("filtered");for(let s of r)delete this.charts[s]}_getColumnsRequiredForChart(e,t){const r=e.param;if(!r)return;if(typeof r=="string")t.add(r);else for(let o of r)t.add(o);e.color_by&&(e.color_by.column?t.add(e.color_by.column.field):t.add(e.color_by)),e.tooltip&&e.tooltip.column&&t.add(e.tooltip.column),e.background_filter&&t.add(e.background_filter.column);const s=BaseChart.types[e.type];s.configEntriesUsingColumns&&s.configEntriesUsingColumns.forEach(o=>{let a=e[o];if(a){a=Array.isArray(a)?a:[a];for(let l of a)t.add(l)}})}loadFile(e,t){const r={csv,json,tsv},s=this.createInfoAlert("loading file",{spinner:!0});r[e.type](e.url).then(o=>{const a={},l=e.dataSource,u=this.dsIndex[l].dataStore,p=u.getAllColumns();for(let m of o.columns)u.columnIndex[m]&&(a[m]=[]);for(let m=0;m<o.length;m++){const g=o[m];m+1%100===0&&this.updateInfoAlert(s,`processed ${m}/${o.length} rows`);for(let w in a)a[w].push(g[w])}let d=0;for(let m in a)u.setColumnData(m,a[m]),d++,this.updateInfoAlert(s,`processed ${d}/${p.length} columns`);this.updateInfoAlert(s,"complete",{duration:2e3}),t&&t()})}_getUpdatedColumns(e){const t=e.dirtyColumns,r={columns:[],added:[],removed:[],colors_changed:[]};for(let o in t.added){const a=s(o);r.columns.push(a),r.added.push(o)}for(let o in t.removed)r.removed.push(o);for(let o in t.data_changed)if(!r.columns[o]){const a=s(o);r.columns.push(a)}for(let o in t.colors_changed)r.colors_changed.push({column:o,colors:e.columnIndex[o].colors});return r;function s(o){const a=e.columnIndex[o],l={values:a.values,datatype:a.datatype,name:a.name,editable:!0,field:a.field},u=new Array(a.data.length);for(let p=0;p<a.data.length;p++)u[p]=a.data[p];return{metadata:l,data:u}}}getState(){const e={},t={},r={};this.contentDiv.offsetWidth;for(const a of this.dataSources){if(a.contentDiv){e[a.name]=[];let u=this.dsPanes[a.name].style.width;const p=/calc\((.+)\%.+/;this.viewData.dataSources[a.name].panelWidth=parseFloat(u.match(p)[1])}t[a.name]=this._getUpdatedColumns(a.dataStore);const l=a.dataStore;if(l.dirtyMetadata.size!==0){r[a.name]={};for(let u of l.dirtyMetadata)r[a.name][u]=l[u]}}for(let a in this.charts){const l=this.charts[a],u=l.chart,p=u.getConfig(),d=u.getDiv();this.viewData.dataSources[l.dataSource.name].layout==="gridstack"?(p.gsposition=[parseInt(d.getAttribute("gs-x")),parseInt(d.getAttribute("gs-y"))],p.gssize=[parseInt(d.getAttribute("gs-w")),parseInt(d.getAttribute("gs-h"))]):p.position=[d.offsetLeft,d.offsetTop],e[l.dataSource.name].push(p)}const s=JSON.parse(JSON.stringify(this.viewData));s.initialCharts=e;const o=this.viewSelect?Array.from(this.viewSelect.children,a=>a.value):null;return{view:s,currentView:this.currentView,all_views:o,updatedColumns:t,metadata:r}}setAllColumnsClean(){for(let e of this.dataSources)e.dataStore.setAllColumnsClean()}showCustomDialog(e){new CustomDialog(e)}addMenuIcon(e,t,r,s){const o=e==="_main"?"bottom-right":"bottom",a=e==="_main"?this.leftMenuBar:this.dsIndex[e].menuBar;return createMenuIcon(t,{tooltip:{text:r,position:o},func:s},a)}createInfoAlert(e,t={}){let r=getRandomString();const s=Object.keys(this.infoAlerts).length;t.type=t.type||"info";const o=createEl("div",{classes:["ciview-info-alert","ciview-alert-"+t.type],styles:{right:"10px",top:50+s*40+"px"}},this.containerDiv);let a=null;const l=createEl("span",{text:e},o);return t.spinner&&(a=createEl("i",{classes:["fas","fa-spinner","fa-spin","ciview-info-alert-spin"]},o)),this.infoAlerts[r]={div:o,text:l,spinner:a,type:t.type},t.duration&&this.removeInfoAlert(r,t.duration),r}updateInfoAlert(e,t,r={}){const s=this.infoAlerts[e];r.type&&s.type!==r.type&&(s.div.classList.remove("ciview-alert-"+s.type),s.div.classList.add("ciview-alert-"+r.type),s.type=r.type),s.text.textContent=t,r.duration&&this.removeInfoAlert(e,r.duration)}removeInfoAlert(e,t=2e3){const r=this.infoAlerts[e].spinner;r&&r.remove(),setTimeout(()=>{if(!this.infoAlerts[e])return;this.infoAlerts[e].div.remove(),delete this.infoAlerts[e];let s=50;for(let o in this.infoAlerts)this.infoAlerts[o].div.style.top=s+"px",s+=40},t)}clearInfoAlerts(){for(const e in this.infoAlerts)this.infoAlerts[e].div.remove();this.infoAlerts={}}loadColumnSet(e,t,r,s=10,o=2){const a=getRandomString();this.transactions[a]={callback:r,columns:[],totalColumns:e.length,failedColumns:[],nextColumn:0,columnsLoaded:0,id:a};let l=[];const u=this.transactions[a];for(let d of e)this.columnsLoading[t][d]=!0,l.push(d),l.length===s&&(u.columns.push(l),l=[]);l.length!==0&&(u.columns.push(l),l=[]),u.alertID=this.createInfoAlert(`Loading Columns:0/${e.length}`,{spinner:!0});const p=Math.min(u.columns.length,o);for(let d=0;d<p;d++)this._loadColumnData(u,t)}_loadColumnData(e,t){const r=this.dsIndex[t].dataStore,s=e.columns[e.nextColumn++],o=[];for(let a of s)o.push(r.getColumnInfo(a));o.sort((a,l)=>column_orders[a.datatype]-column_orders[l.datatype]),this.dataLoader(o,t,r.size).then(a=>{for(let l of a)r.setColumnData(l.field,l.data);e.columnsLoaded++}).catch(a=>{console.log(a),e.columnsLoaded++,e.failedColumns.push(o)}).finally(()=>{const a=e.columns.length,l=e.columnsLoaded;let u=l*s.length;for(let p of s)delete this.columnsLoading[t][p];u=u>e.totalColumns?e.totalColumns:u,this.updateInfoAlert(e.alertID,`Loading Columns:${u}/${e.totalColumns}`),l>=a&&(this.updateInfoAlert(e.alertID,`Loaded ${a} column${a===1?"":"s"}`,{duration:2e3}),e.callback(e.failedColumns),delete this.transactions[e.id]),e.nextColumn<a&&this._loadColumnData(e,t)})}_addLinkIcon(e,t,r){createMenuIcon("fas fa-plus-square",{tooltip:{text:`Add ${r.name}`,position:"bottom-right"},func:()=>{new AddColumnsFromRowsDialog(e,t,r,this)}},e.menuBar)}_setUpMenu(e){const t=e.dataStore;if(createMenuIcon("fas fa-chart-bar",{tooltip:{text:"Add Chart",position:"bottom-right"},func:()=>{new AddChartDialog(e,l=>this.addChart(e.name,l,!0))}},e.menuBar),createMenuIcon("fas fa-sync-alt",{tooltip:{text:"Reset All Filters",position:"bottom-right"},func:()=>{t.removeAllFilters()}},e.menuBar),createMenuIcon("fas fa-palette",{tooltip:{text:"Change Color Scheme",position:"bottom-right"},func:()=>{try{new ColorChooser(this,e)}catch(l){console.error("error making ColorChooser",l),this.createInfoAlert("Error making color chooser",{type:"warning",duration:2e3})}}},e.menuBar),createMenuIcon("fas fa-th",{tooltip:{text:"Change layout",position:"bottom-right"},func:l=>{this.layoutMenus[e.name].show(l)}},e.menuBar),t.links)for(let l in t.links){const u=t.links[l];u.rows_as_columns&&this._addLinkIcon(e,this.dsIndex[l],u.rows_as_columns)}const r=createEl("div",{styles:{float:"right",lineHeight:"1.0"}},e.menuBar);createEl("span",{text:e.name,styles:{verticalAlign:"top",fontSize:"16px",marginRight:"4px"}},r);const s=e.dataStore.size;e.filterBar=createEl("progress",{value:s},e.menBar);const o=createEl("div",{styles:{width:"100px",display:"inline-block",marginTop:"2px"}},r),a={max:s,value:s,text:`${s}`};this.progressBars[e.name]=new MDVProgress(o,a)}addListener(e,t){this.listeners[e]=t}removeListener(e){delete this.listeners[e]}_callListeners(e,t){for(let r in this.listeners)this.listeners[r](e,this,t)}addChart(e,t,r=!1){const s=new Set;if(this._getColumnsRequiredForChart(t,s),t.location){const E=t.location,A=5;t.size=[E.width*90+E.width*A-A,E.height*40+E.height*A-A],t.position=[(E.x+1)*A+E.x*90,(E.y+1)*A+E.y*40]}const o=this.dsIndex[e];let a=300,l=300,u=10,p=10;if(t.size&&(a=t.size[0],l=t.size[1]),t.position&&(u=t.position[0],p=t.position[1]),this.viewData.dataSources[e].layout==="gridstack"&&t.gssize){const E=this.gridStack.getCellDimensions(this.dsIndex[e]);a=Math.round(t.gssize[0]*E[0]),l=Math.round(t.gssize[1]*E[1]),u=Math.round(t.gsposition[0]*(E[0]+5)),p=Math.floor(t.gsposition[1]*(E[1]+5))}BaseChart.types[t.type];const d=themes[this.theme],m=createEl("div",{styles:{position:"absolute",width:a+"px",height:l+"px",left:u+"px",top:p+"px",background:d.main_panel_color,zIndex:2,display:"flex",alignItems:"center",justifyContent:"center"}},o.contentDiv);createEl("i",{classes:["fas","fa-circle-notch","fa-spin"],styles:{fontSize:"30px",color:d.text_color}},m),createEl("div",{styles:{position:"absolute",overflow:"hide",textAlign:"center",top:"3px",color:d.text_color,textOverflow:"ellipsis",wordBreak:"break-all",fontSize:"16px"},text:t.title},m);const g=()=>{this._addChart(e,t,m,r)},w=Array.from(s);try{this._getColumnsThen(e,w,g)}catch(E){this.clearInfoAlerts();const A=this.createInfoAlert(`Error creating chart with columns [${w.join(", ")}]: '${E}'`,{type:"warning"});console.log(E);const k=this.infoAlerts[A].div;k.onclick=()=>k.remove(),m.remove()}}_getColumnsFromOtherSource(e,t,r,s,o){this._getColumnsThen(t,r.concat(s),()=>{const a=this.dsIndex[e].dataStore,l=this.dsIndex[t].dataStore,u=l.getColumnIndex(s),p=a.columnIndex[s],d=p.values.map(g=>u[g]),m=r.map(g=>{const w=a.columnIndex[g],E=l.columnIndex[g];E.values&&(w.values=E.values),E.minMax&&(w.minMax=E.minMax),E.quantiles&&(w.quantiles=E.quantiles);const A=new SharedArrayBuffer(a.size*(w.datatype==="text"?1:4)),k=w.datatype==="text"?Uint8Array:Float32Array;return{col:g,data:A,arr:new k(A),odata:E.data}});for(let g=0;g<a.size;g++){const w=d[p.data[g]];for(let E of m)E.arr[g]=E.odata[w]}for(let g of m)a.setColumnData(g.col,g.data);o()})}_getColumnsThen(e,t,r){const o=this.dsIndex[e].dataStore;if(o.links)for(let l in o.links){const u=o.links[l];if(u.columns){const p=[],d=[];for(let m of t)u.columns.indexOf(m)===-1?d.push(m):o.columnIndex[m].data||p.push(m);if(p.length>0){this._getColumnsThen(e,[u.index],()=>{this._getColumnsFromOtherSource(e,l,p,u.index,()=>{this._getColumnsThen(e,d,r)})});return}}}const a=t.filter(l=>{if(this.columnsLoading[e][l])return!1;const u=o.columnIndex[l];return u?!u.data:(o.addColumnFromField(l),!0)});a.length===0?this._haveColumnsLoaded(t,e,r):this.loadColumnSet(a,e,()=>{this._haveColumnsLoaded(t,e,r)})}_decorateColumnMethod(e,t,r){const s="_"+e;t[s]=t[e],t[e]=o=>{this._getColumnsThen(r,[o],()=>t[s](o))}}__decorateColumnMethod(e,t,r){const s="_"+e;t[s]=t[e];const o=this;t[e]=function(){if(arguments[0]==null)t[s](...arguments);else{const a=Array.isArray(arguments[0])?arguments[0]:[arguments[0]];o._getColumnsThen(r,a,()=>t[s](...arguments))}}}_haveColumnsLoaded(e,t,r){for(let s of e)if(this.columnsLoading[t][s]){setTimeout(()=>{this._haveColumnsLoaded(e,t,r)},500);return}r()}_addChart(e,t,r,s=!1){const o=this.dsIndex[e];r.innerHTML="",r.style.display="",r.style.alignItems="",r.style.justifyContent="";const a=BaseChart.types[t.type],l=new a.class(o.dataStore,r,t);if(this.charts[l.config.id]={chart:l,dataSource:o},this._makeChartRD(l,o),l.popoutIcon=l.addMenuIcon("fas fa-external-link-alt","popout",{func:()=>{this._popOutChart(l)}}),l.addMenuIcon("fas fa-times","remove chart").addEventListener("click",()=>{l.remove(),r.remove(),delete this.charts[l.config.id],this._removeLinks(l),this._callListeners("chart_removed",l)}),l.colorByColumn&&this._decorateColumnMethod("colorByColumn",l,e),l.setToolTipColumn&&this._decorateColumnMethod("setToolTipColumn",l,e),l.setBackgroundFilter&&this._decorateColumnMethod("setBackgroundFilter",l,e),l.changeContourParameter&&this._decorateColumnMethod("changeContourParameter",l,e),a.methodsUsingColumns)for(let p of a.methodsUsingColumns)this.__decorateColumnMethod(p,l,e);if(l.setupLinks){o.index_link_to&&this._giveChartAccess(l,this.dsIndex[o.index_link_to.dataSource].dataStore,o.index_link_to.index);for(let p of o.dataStore.accessOtherDataStore)this._giveChartAccess(l,this.dsIndex[p.dataSource].dataStore,p.index)}const u=o.column_link_to;if(u&&l.createColumnLinks){const p=(d,m)=>{this._getColumnsThen(u.dataSource,d,m)};l.createColumnLinks(this.dsIndex[u.dataSource].dataStore,u.columns,p)}if(s&&this._callListeners("chart_added",l),this._toLoadCharts&&(this._toLoadCharts.delete(t),this._toLoadCharts.size===0)){if(delete this._toLoadCharts,this.viewData.links)for(let p of this.viewData.links)this._setUpLink(p);this._callListeners("view_loaded",this.currentView)}return l}_giveChartAccess(e,t,r){const s=(o,a)=>{o.push(r),this._getColumnsThen(t.name,o,a)};e.setupLinks(t,r,s)}_setUpLink(e){switch(e.id||(e.id=getRandomString()),e.type){case"color_by_column":const t=this.charts[e.source_chart];t||console.error(`broken link link:${e.id}`),t.chart.addListener(e.id,(r,s)=>{if(r==="cell_clicked")for(let o of e.target_charts)this.getChart(o).colorByColumn(s.row)});break}}_removeLinks(e){const t=[],r=e.config.id,s=this.viewData.links;if(s){for(let o=0;o<s.length;o++){const a=s[o];a.source_chart===r&&t.push(o);const l=a.target_charts.indexOf(r);l!==-1&&(a.target_charts.splice(l,1),a.target_charts.length===0&&t.push(o))}for(let o of t)this.removeLink(o)}}removeLink(e){const t=this.viewData.links[e];switch(t.type){case"color_by_column":this.charts[t.source_chart].chart.removeListener(t.id)}this.viewData.links.splice(e,1)}removeAllCharts(e){const t=[];for(let r in this.charts){const s=this.charts[r];e&&e.indexOf(s.dataSource.name)===-1||t.push([s.chart,s.window])}for(let r of t)r[1]&&r[1].close(),r[0].remove(),r[0].div.remove();this.charts={}}getAllFilters(e){const t=this.getAllCharts(e),r=[];for(let s of t){const o=s.getFilter();o&&r.push(o)}return r}getChart(e){const t=this.charts[e];return t?t.chart:null}getAllCharts(e){const t=[];for(let r in this.charts){const s=this.charts[r];s.dataSource.name===e&&t.push(s.chart)}return t}setChartsAsGrid(e=5,t=[300,300],r=10){let s=r,o=r,a=0;for(let l in this.charts){const p=this.charts[l].chart.getDiv();p.style.left=o+"px",p.style.top=s+"px",o+=t[0]+r,a++,a===e&&(a=0,o=r,s+=t[1]+r)}}addButton(e,t,r){createEl("button",{classes:["ciview-button"],text:e,styles:{position:"fixed",bottom:"40px",right:"40px",fontSize:"18px",zIndex:100}},this.contentDiv).addEventListener("click",()=>t())}_popOutChart(e){const t=e.getDiv(),r=this.charts[e.config.id],s={dim:[e.config.size[0],e.config.size[1]],pos:[t.style.left,t.style.top]};t.gridstackPopoutCallback&&t.gridstackPopoutCallback(),removeResizable(t),removeDraggable(t);const o=new PopOutWindow((a,l)=>{e.setSize(l.width,l.height),t.style.top="5px",t.style.left="5px",a.body.append(t),e.changeBaseDocument(a),a.body.style.overflow="hidden",e.popoutIcon.style.display="none"},(a,l)=>{r.dataSource.contentDiv.append(t),e.changeBaseDocument(document),t.style.left=s.pos[0],t.style.top=s.pos[1],e.setSize(s.dim[0],s.dim[1]),this._makeChartRD(e,r.dataSource),e.popoutIcon.style.display="inline",delete r.window},{onresize:(a,l)=>{e.setSize(l.width,l.height)},url:this.config.popouturl||"/"});r.window=o}_sendAllChartsToBack(e){for(let t in this.charts){const r=this.charts[t];e===r.dataSource&&(r.chart.div.style.zIndex="")}}_makeChartRD(e,t){if(t&&this.gridStack&&this.viewData.dataSources[t.name].layout==="gridstack"){this.gridStack.manageChart(e,t,this._inInit);return}const r=e.getDiv();makeDraggable(r,{handle:".ciview-chart-title",contain:"topleft",ondragstart:s=>{this._sendAllChartsToBack(t),r.style.zIndex=2}}),makeResizable(r,{onResizeStart:()=>{this._sendAllChartsToBack(t),r.style.zIndex=2},onresizeend:(s,o)=>e.setSize(s,o)})}}class ChooseColumnDialog extends BaseDialog{constructor(e,t,r="all"){const s={footer:!0,width:250,maxHeight:500,title:"Select Columns",buttons:[{text:"OK",method:"getColumns"}]};super(s,{dataStore:e,callback:t,filter:r})}init(e){this.ds=e.dataStore;const t=createEl("div",{styles:{padding:"8px"}}),r=getRandomString();createEl("div",{text:"Groups"},this.dialog);const s=Object.keys(this.ds.columnGroups);s.unshift("All");for(let l of s){const u=createEl("span",{styles:{display:"inline-block",whiteSpace:"nowrap",marginRight:"5px"}},t);createEl("span",{text:l},u),createEl("input",{type:"radio",value:l,name:r},u).addEventListener("click",p=>{this.checkAllInGroup(p.target.value)})}this.dialog.append(t),createEl("div",{text:"Select Individual Columns"},this.dialog);const o=createEl("div",{style:{padding:"8px"}}),a=this.ds.getColumnList(e.filter);this.checks=[],this.callback=e.callback;for(let l of a){const u=createEl("div",{styles:{whiteSpace:"nowrap"}},o),p=createEl("input",{type:"checkbox"},u);this.checks.push([p,l.field]),createEl("span",{text:l.name},u)}this.dialog.append(o)}checkAllInGroup(e){if(e==="All")for(let t of this.checks)t[0].checked=!0;else{const t=this.ds.columnGroups[e].columns;for(let r of this.checks)r[0].checked=t.indexOf(r[1])!==-1}}getColumns(){const e=[];for(let t of this.checks)t[0].checked&&e.push(t[1]);this.callback(e),this.close()}}class AddChartDialog extends BaseDialog{constructor(e,t){const r={title:"Add Chart",columns:2,footer:!0,width:380};super(r,{dataSource:e,callback:t})}init(e){this.extraControls={};const t=[];this.dataSource=e.dataSource,this.dataStore=e.dataSource.dataStore;for(let r in BaseChart.types){const s=BaseChart.types[r];let o=!0;if(s.required){for(let a of s.required)this.dataStore[a]||(o=!1);if(!o)continue}s.allow_user_add!==!1&&t.push({name:s.name,type:r})}t.sort((r,s)=>r.name.localeCompare(s.name)),this.defaultType=t[0].type,createEl("div",{text:"Chart Type",classes:["ciview-title-div"]},this.columns[0]),this.chartType=createEl("select",{styles:{maxWidth:"200px"}},this.columns[0]);for(let r of t)createEl("option",{text:r.name,value:r.type},this.chartType);this.chartType.addEventListener("change",r=>{this.setParamDiv(this.chartType.value,e.dataStore)}),createEl("div",{text:"Title",classes:["ciview-title-div"]},this.columns[0]),this.chartName=createEl("input",{},this.columns[0]),createEl("div",{text:"Description",classes:["ciview-title-div"]},this.columns[0]),this.chartDescription=createEl("textarea",{styles:{height:"100px"}},this.columns[0]),createEl("div",{text:"Columns",classes:["ciview-title-div"]},this.columns[1]),this.paramDiv=createEl("div",{},this.columns[1]),this.setParamDiv(t[0].type,e.dataStore),createEl("button",{text:"Add",classes:["ciview-button"]},this.footer).addEventListener("click",()=>this.submit(e.callback))}submit(e){const t={title:this.chartName.value,legend:this.chartDescription.value,type:this.chartType.value,param:this.paramSelects.map(o=>o.value)},r={};for(let o in this.extraControls){const a=this.extraControls[o];r[o]=a.type==="checkbox"?a.value==="on":a.value,t[o]=r[o]}this.multiColumns&&(t.param=t.param.concat(this.multiColumns)),console.log("config from add chart dialog",t);const s=BaseChart.types[this.chartType.value];s.init&&s.init(t,this.dataSource.dataStore,r),e(t),this.chartName.value="",this.chartDescription.value="",this.close()}_addMultiColumnSelect(e,t){const r=this.dataStore.getColumnList(t);let s="";r.length>1&&(s=`${r[0].name},... (1)`,this.multiColumns=[r[0].field]);const o=createEl("span",{text:s},e);createEl("i",{classes:["fas","fa-plus"]},e),e.style.cursor="pointer",e.addEventListener("click",()=>{new ChooseColumnDialog(this.dataStore,a=>{this.multiColumns=a;let l="";if(a.length>0){const u=a.length<3?a.length:3,p=[];for(let d=0;d<u;d++)p.push(this.dataStore.getColumnName(a[d]));l=p.join(","),a.length>3&&(l+=",...."),l+=`(${a.length})`,o.textContent=l}},t)})}setParamDiv(e){this.paramDiv.innerHTML="";const t=BaseChart.types[e].params;if(this.paramSelects=[],t)for(let s of t){const o=createEl("div",{styles:{padding:"4px"}},this.paramDiv);createEl("div",{text:s.name+":"},o);const a=createEl("div",{},this.paramDiv);if(!Array.isArray(s.type)&&s.type.startsWith("_multi"))this._addMultiColumnSelect(a,s.type.split(":")[1]);else{this.multiColumns=null;const l=createEl("select",{styles:{maxWidth:"200px"}},a),u=this.dataStore.getColumnList(s.type),p={};for(let d of this.dataStore.subgroupDataSources)p[d]=createEl("optgroup",{label:d});for(let d of u){let m=l;d.subgroup&&(m=p[d.subgroup.dataSource]),createEl("option",{text:d.name,value:d.field},m)}for(let d of this.dataStore.subgroupDataSources)l.append(p[d]);this.paramSelects.push(l)}}const r=BaseChart.types[this.chartType.value];if(this.extraControls={},r.extra_controls){const s=r.extra_controls(this.dataSource.dataStore),o=this.paramDiv;for(let a of s)if(createEl("div",{text:a.label,classes:["ciview-title-div"]},o),a.type==="dropdown"){const l=createEl("select",{styles:{maxWidth:"200px"}},o);for(let u of a.values)createEl("option",{text:u.name,value:u.value},l);this.extraControls[a.name]=l}else if(a.type==="string"){const l=createEl("input",{value:a.defaultVal},o);this.extraControls[a.name]=l}else if(a.type==="textbox"){const l=createEl("textarea",{value:a.defaultVal,styles:{height:"300px"}},o);this.extraControls[a.name]=l}else if(a.type==="checkbox"||a.type==="check"){const l=createEl("input",{type:"checkbox"},o);l.checked=a.defaultVal,this.extraControls[a.name]=l}}}}export{ARRAY_TYPE as A,BaseChart as B,ChartManager as C,DataModel as D,EPSILON as E,RGBToHex as R,__vitePreload as _,makeSortable as a,frustum as b,createEl as c,determinant as d,multiply as e,fromQuat as f,rotateY as g,rotateZ as h,invert as i,rotate as j,translate as k,lookAt as l,makeDraggable as m,DensityScatterPlot as n,ortho as o,perspective as p,BaseDialog as q,rotateX as r,scale as s,transpose as t,noUiSlider as u,getScaling as v,hexToRGB as w,getRandomString as x};
