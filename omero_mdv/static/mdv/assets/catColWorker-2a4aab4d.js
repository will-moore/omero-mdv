(function(){"use strict";onmessage=function(i){const s=[];for(let t of i.data[3])s.push(t[1]==="int32"?new int32Array(t[0]):new Float32Array(t[0]));const c=s.length,d=new Uint8Array(i.data[2]),l=i.data[4],A=d.length;let r=l.values.length;const h=l.scaleVals,y=new Uint8Array(i.data[0]),w=new Uint8Array(i.data[1]);let n=new Array(c);for(let t=0;t<c;t++){const a=new Array(r);for(let N=0;N<r;N++)a[N]=l.method==="mean"?[0,0]:[0,0,0];n[t]=a,n[t]._id=t}const e=new Array(r).fill(0);l.method==="mean"?m(n,s,A,c,w,y,d,e,r,h):g(n,s,A,c,w,y,d,e,r,h);const o=[];for(let t=0;t<r;t++)e[t]!==0&&o.push(t);for(let t=0;t<c;t++)n[t]=n[t].filter((a,N)=>e[N]!==0),n[t]._id=t;r=o.length;const f=new Array(r);for(let t=0;t<r;t++){f[t]=new Array(c),f[t]._id=o[t];for(let a=0;a<c;a++)f[t][a]=isNaN(n[a][t])?0:n[a][t]}postMessage({averages:n,transpose:f,catTotals:e})};function g(i,s,c,d,l,A,r,h,y,w){performance.now();for(let n=0;n<c;n++){if(l[n]!==0&&l[n]!==A[n])continue;let e=r[n];h[e]++;for(let o=0;o<d;o++)isNaN(s[o][n])||i[o][e][0]++}for(let n=0;n<d;n++)for(let e=0;e<y;e++)i[n][e][0]&&(i[n][e][1]=new Float32Array(i[n][e][0]));for(let n=0;n<c;n++){if(l[n]!==0&&l[n]!==A[n])continue;let e=r[n];for(let o=0;o<d;o++){if(isNaN(s[o][n]))continue;const f=i[o][e];f[1][f[2]++]=s[o][n]}}for(let n=0;n<d;n++){const e=w[n][1]-w[n][0];for(let o=0;o<y;o++){const t=i[n][o][1];if(!t){i[n][o]=NaN;continue}t.sort();let a=t[Math.floor(t.length/2)];a=(a-w[n][0])/e,i[n][o]=a<0?0:a>1?1:a}}}function m(i,s,c,d,l,A,r,h,y,w){for(let n=0;n<c;n++){if(l[n]!==0&&l[n]!==A[n])continue;let e=r[n];h[e]++;for(let o=0;o<d;o++){if(isNaN(s[o][n]))continue;const f=i[o][e];f[0]+=s[o][n],f[1]++}}for(let n=0;n<d;n++){const e=w[n][1]-w[n][0];for(let o=0;o<y;o++){let f=i[n][o],t=f[0]/f[1];t=(t-w[n][0])/e,i[n][o]=t<0?0:t>1?1:t}}}})();
